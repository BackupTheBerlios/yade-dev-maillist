From eudoxos at arcig.cz  Mon Feb  4 16:17:04 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Mon, 04 Feb 2008 16:17:04 +0100
Subject: [yade-dev] metaengines etc.
Message-ID: <47A72C70.5060900@arcig.cz>

Hi everybody (but mostly Janek),

I have a few questions / suggestions.

1. What is the purpose of MetaEngine, if only MetaDispatchingEngine is used?

2. Shouldn't I add a macro to EngineUnit's so that what types they take
as arguments is inside the class? Then instead of saying
dispatcher->add("InteractingBox","InteractingSphere","InteractingBox2InteractingSphere4SpheresContactGeometry"),
one would only have to say
dispatcher->add(instanceOfInteractingBox2InteractingSphere4SpheresContactGeometry)
and the instance would say to the dispatcher what types it takes - like
we have RENDERS in gl drawers, there would be something like
DISPATCHES(InteractingBox,InteractingSphere) inside the
InteractingBox2InteractingSphere4SpheresContactGeometry class. Sounds
reasonable?

3. Why do we distinguish DeusExMachina and StandAloneEngine, if they do
the same thing? I know it is supposed to apply different effects
(kinematic vs. dynamic), but from programming point of view, is there a
difference?

4. What is the status of boost::serialization in yade, what is the
status of removing singletons, moving to the boost factory (?) etc? I am
asking because I want to know how much force should I put into python
wrapper now, since it relies quite heavily on the old serialization model.

Regards,

Vaclav


From janek_listy at wp.pl  Mon Feb  4 21:58:41 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Mon, 4 Feb 2008 21:58:41 +0100
Subject: [yade-dev] metaengines etc.
In-Reply-To: <47A72C70.5060900@arcig.cz>
References: <47A72C70.5060900@arcig.cz>
Message-ID: <20080204215841.5ee73d17@szpak>

V?clav ?milauer said:     (by the date of Mon, 04 Feb 2008 16:17:04 +0100)

> Hi everybody (but mostly Janek),

Hi Vaclav,

> 1. What is the purpose of MetaEngine, if only MetaDispatchingEngine is used?

MetaEngine was "just in case" if we wanted to do something else than
dispatching. But it turned out to be useless. Refactor this out,
then ;-) There will be just MetaDispatcher.

I've sent to you some time ago the article submitted to CMAME, the
articles uses new class names.

 
> 2. Shouldn't I add a macro to EngineUnit's so that what types they take
> as arguments is inside the class? Then instead of saying
> dispatcher->add("InteractingBox","InteractingSphere","InteractingBox2InteractingSphere4SpheresContactGeometry"),
> one would only have to say
> dispatcher->add(instanceOfInteractingBox2InteractingSphere4SpheresContactGeometry)
> and the instance would say to the dispatcher what types it takes - like
> we have RENDERS in gl drawers, there would be something like
> DISPATCHES(InteractingBox,InteractingSphere) inside the
> InteractingBox2InteractingSphere4SpheresContactGeometry class. Sounds
> reasonable?

yeah, sounds good. I can't remember why I didn't do it before. Maybe
only because there wasn't enough time. I'm sure that when I get to
this I will soon recall the whole issue to my mind.

 
> 3. Why do we distinguish DeusExMachina and StandAloneEngine, if they do
> the same thing? I know it is supposed to apply different effects
> (kinematic vs. dynamic), but from programming point of view, is there a
> difference?

StandAloneEngine will be removed, we will have only EgiConditionApplier here.


 
> 4. What is the status of boost::serialization in yade, what is the
> status of removing singletons, moving to the boost factory (?) etc? I am
> asking because I want to know how much force should I put into python
> wrapper now, since it relies quite heavily on the old serialization model.


yeah. Why I'm still not working on yade?? It's already 3 weeks since
I'm in Grenoble ;-) Of course I want to do all of this ASAP.


- until 15 february I must submit 2 conference proceeding papers
  (6-12 pages each). And 2 conference abstracts (2 pages). That's 4 in total.

- I must keep the "snow" people happy about my progress with respect
  to modelling snow using yade. We have a meeting this week. There
  wasn't money available to work directly on yade. I'm supposed to
  implement snow modelling. So during my work on yade I got to keep
  them happy.


Because of this I'm slower with yade development than I'd like to :(


The rough yade dev schedule for me looks like this:


1. change all class names, as they appear in the CMAME article

1a. modify yade::serialization to understand both old and new names
    during serialization (if everyone agrees that it's necessary)

2. add boost::serialization, don't remove yade serialization (becomes
   deprecated, be removed later)

3. about two week regression testing if nothing got broken with respect to
   simulation results.

4. remove yade ClassFactory and use boost counterpart (I got to check
   which one we need here: boost::extension, or class factory provided with
   boost::serialization) 

4a. boost::extension is not yet formal part of boost, there will be a
    review this year, and I guess it will be released with 1.35:
       svn checkout http://svn.boost.org/svn/boost/sandbox/libs/extension
       svn checkout http://svn.boost.org/svn/boost/sandbox/boost/extension

4b. because boost::extension is not yet in boost, the
    boost::serialization has to use it's own micro-factory - because
    otherwise it would be impossible to instatinate classes during
    deserialization. And I know that this micro-factory works well
    with plugins (*.dll and *.so). So I got to check if it's enough for
    our needs, or whether we need boost::extension.

5. again two weeks of regression testing

6. remove remaining singletons, prepare grounds for real unit tests.
   (they work only without singletons). Learn boost::test, and start
   writing unit tests for every classes - will take a long time...

7. change the container layout to use boost::multi_index, drop
   BodyContainer and InterctionContainer. Look at thread with words
   "good example" in the subject:
      http://lists.boost.org/Archives/boost/2007/07/index.php
   This is a major change, and it is pending for quite a long time.


Smaller stuff, which should go in parallel, but not restricted to go
somewhere between one thing and other thing.


1. investigate if my QT4-serialization applet works well with
   boost::serialization. Fix if it isn't. Then we have a GUI that can
   communicate with boost::serialization and we can drop
   REGISTER_ATTRIBUTE altogether.

2. Start slow switch to QT4, by writing a new simple QT4 gui. When it
   becomes usable the old gui will become depraceted. Removal of
   yade::serialization equals to removal of QT3 GUI.

3. finally separate BodyState from BodyConstitutiveParameters

4. Write documentation (when?, I dunno, we got a lot of work here :-P )

5. Perhaps implement a "serialization on demand" interface. It uses
   boost::serialization, and can be used to check values when their name
   is given. The name is provided using syntax similar to directory/file.
   So you would ask gimmie("SomeClass/SomeMember/torsionalStiffness");
   and get the answer - the value. That could be later used for tracking
   variables maybe obtaining simulation results, and debugging.

6. implement some simple parallelization on single multi-core
   computer (shared memory), using boost::threads. Easy to do even now -
   just divide a container into several parts, and process each part on
   different CPU.

7. stop using yade::MultiMethods. Use a similar library from boost
   (that's a too complicated library to be part of yade, it should be
   outside)

7a. check if there is a similar library in boost (gotta look at the
    boost mailing list archives), if there is one, then start using it

7b. if there isn't any in boost, then clean our MultiMethods,
    boostify them and submit to become part of boost.

7c. In either way we will be using MultiMethods from boost ;-D



You want to ask when all that? Good point. First of all I get to
finish those conference articles, and make something for snow meeting
this week.

Realistically speaking I think that I should be somewhere around
point (4) by middle/end of March.

Sounds good?

PS: maybe I missed several points. I should put this on wiki, and keep
up to date.
-- 
Janek Kozicki                                                         |


From janek_listy at wp.pl  Tue Feb  5 00:54:43 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Tue, 5 Feb 2008 00:54:43 +0100
Subject: [yade-dev] metaengines etc.
In-Reply-To: <20080204215841.5ee73d17@szpak>
References: <47A72C70.5060900@arcig.cz>
	<20080204215841.5ee73d17@szpak>
Message-ID: <20080205005443.218bbc97@szpak>

> PS: maybe I missed several points. I should put this on wiki, and keep
> up to date.

ok, it's on http://yade.wikia.com/wiki/Development_schedeule

-- 
Janek Kozicki                                                         |


From bruno.chareyre at hmg.inpg.fr  Tue Feb  5 09:43:25 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Tue, 05 Feb 2008 09:43:25 +0100
Subject: [yade-dev] metaengines etc.
In-Reply-To: <20080204215841.5ee73d17@szpak>
References: <47A72C70.5060900@arcig.cz> <20080204215841.5ee73d17@szpak>
Message-ID: <47A821AD.6030009@hmg.inpg.fr>


>
> - I must keep the "snow" people happy about my progress with respect
>   to modelling snow using yade. We have a meeting this week. There
>   wasn't money available to work directly on yade. I'm supposed to
>   implement snow modelling. So during my work on yade I got to keep
>   them happy.
>
>   

Yeah... That's true, and I'm one of the "happy" guys... ;-)

Bruno

 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Tue Feb  5 15:58:33 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Tue, 05 Feb 2008 15:58:33 +0100
Subject: [yade-dev] metaengines etc.
In-Reply-To: <20080204215841.5ee73d17@szpak>
References: <47A72C70.5060900@arcig.cz> <20080204215841.5ee73d17@szpak>
Message-ID: <47A87999.1000905@arcig.cz>

Nice plans, some points, though.

For the regression tests, there is no single reference test in yade
proper, so how are you going to test that? (besides that, I don't see
how serialization could affect test results, except that the XML file is
badly written/read, which can be checked IMHO rather easily by hand).

If boost::extension is needed, we can have it in-tree and then just
switch to the packaged version, once it is available in boost. The same
BTW for loki, which we don't really need inside yade anymore, I think?

> 5. Perhaps implement a "serialization on demand" interface. It uses
>    boost::serialization, and can be used to check values when their name
>    is given. The name is provided using syntax similar to directory/file.
>    So you would ask gimmie("SomeClass/SomeMember/torsionalStiffness");
>    and get the answer - the value. That could be later used for tracking
>    variables maybe obtaining simulation results, and debugging.
>   
Good, python wrapper currently modifies all attributes by
serializing/deserializing them and until c++ classes are reflexted in
python directly (using py++, perhaps), I would like to keep this
functionality.

For the qt4 stuff: I think that many people would be happier using
scripting interface than clickable interface (I prefer it very much: you
can reproduce what you do exactly, save it to file etc). WRT qt3 gui,
the missing part of python now is 3d-view. It freezes X on my notebook,
for unknown reasons. If you dare, go try it on yours
(gui/cmd/yadeControl.cpp, class pyView), perhaps it is some threading
issue that I don't understand. I would be gald if you could help me with
that - I don't like hard-rebooting my computer. Perhaps it is only a
driver issue (realtively new i965), it used to work on ATI.

Vaclav


From bruno.chareyre at hmg.inpg.fr  Wed Feb  6 20:39:35 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Wed, 06 Feb 2008 20:39:35 +0100
Subject: [yade-dev] Triaxial classes "cerr" output
Message-ID: <47AA0CF7.3010807@hmg.inpg.fr>

Hey Va?lav,

I'm sure you are doing a good job with triaxial classes, but... well... 
I just found an exception ;-)
Almost everybody using triaxial stuff SHOULD need the unbalancedForce 
parameter printed somewhere, during confinment, during compression, 
anytime in fact, and without the GUI you need it even more badly; 
because its the only way to check that you are simulating a mechanical 
test and not the random explosion of random pieces of shit.
Then, I just realized that you removed "cerr << "UnbalancedForce=" << 
UnbalancedForce << endl;" at line 68 of TriaxialCompressionEngine.
Could you please revert that on SVN?

Are you planning to remove all cerr messages?
Let us try and speak about that on irc later.

Bruno



-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Sat Feb  9 16:22:03 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Sat, 09 Feb 2008 16:22:03 +0100
Subject: [yade-dev] Triaxial classes "cerr" output
In-Reply-To: <47AA0CF7.3010807@hmg.inpg.fr>
References: <47AA0CF7.3010807@hmg.inpg.fr>
Message-ID: <47ADC51B.1030207@arcig.cz>

Sorry, fixed in svn1243. V.
> Hey Va?lav,
>
> I'm sure you are doing a good job with triaxial classes, but... well... 
> I just found an exception ;-)
> Almost everybody using triaxial stuff SHOULD need the unbalancedForce 
> parameter printed somewhere, during confinment, during compression, 
> anytime in fact, and without the GUI you need it even more badly; 
> because its the only way to check that you are simulating a mechanical 
> test and not the random explosion of random pieces of shit.
> Then, I just realized that you removed "cerr << "UnbalancedForce=" << 
> UnbalancedForce << endl;" at line 68 of TriaxialCompressionEngine.
> Could you please revert that on SVN?
>
> Are you planning to remove all cerr messages?
> Let us try and speak about that on irc later.
>
> Bruno
>
>
>
>   



From janek_listy at wp.pl  Tue Feb 12 00:30:20 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Tue, 12 Feb 2008 00:30:20 +0100
Subject: [yade-dev] python-scientific problems on debian etch.
Message-ID: <20080212003020.4d547d84@szpak>

OK, I thought I'll give it a try and installed:

  [INSTALL, DEPENDENCIES] blt
  [INSTALL, DEPENDENCIES] liblog4cxx9c2a
  [INSTALL, DEPENDENCIES] libnetcdf3
  [INSTALL, DEPENDENCIES] python-netcdf
  [INSTALL, DEPENDENCIES] python-numeric-ext
  [INSTALL, DEPENDENCIES] python-tk
  [INSTALL] liblog4cxx9-dev
  [INSTALL] python-scientific

that's a copy'n'paste from /var/log/aptitude


So I got this:

Checking whether c++ compiler "distcc g++" works...yes
Checking for pthread_exit(NULL) in C library pthread... yes
Checking for glutGetModifiers() in C library glut... yes
Checking for boost::posix_time::time_duration::time_duration() in C++ library boost_date_time-mt... no
Checking for boost::posix_time::time_duration::time_duration() in C++ library boost_date_time... yes
Checking for boost::thread::thread() in C++ library boost_thread-mt... no
Checking for boost::thread::thread() in C++ library boost_thread... yes
Checking for boost::filesystem::path() in C++ library boost_filesystem-mt... no
Checking for boost::filesystem::path() in C++ library boost_filesystem... yes
Checking for Wm3::Math<double>::PI in C++ library Wm3Foundation... yes
Checking for qt-mt in /usr/share/qt3... yes
Checking for QGLViewer(1) in C++ library QGLViewer... no
Checking for QGLViewer(1) in C++ library qglviewer... yes
Checking for log4cxx::Logger::getLogger("foo") in C++ library log4cxx... yes
Checking for Python development files... yes
Checking for scientific python module (debian: python-scientific)... (cached) yes
Checking for boost::python::scope() in C++ library boost_python-mt... no
Checking for boost::python::scope() in C++ library boost_python... yes
scons: done reading SConscript files.


And so I got this error:


/usr/include/python2.4/object.h:343: error: expected unqualified-id before ';' token
/usr/include/python2.4/object.h:343: error: abstract declarator 'PyObject*' used as declaration
distcc[9016] ERROR: compile gui/qt3/GLViewer.cpp on localhost failed
scons: *** [/home/janek/20-Programowanie/10-cpp/50-Yade/Code/CURRENT/build-svn1244-moment_law2/gui/qt3/GLViewer.os] Error 1
/usr/include/python2.4/object.h:343: error: expected unqualified-id before ';' token
/usr/include/python2.4/object.h:343: error: abstract declarator 'PyObject*' used as declaration
distcc[9031] ERROR: compile gui/qt3/QtCodeGenerator.cpp on localhost failed
scons: *** [/home/janek/20-Programowanie/10-cpp/50-Yade/Code/CURRENT/build-svn1244-moment_law2/gui/qt3/QtCodeGenerator.os] Error 1
extra/BrefcomTestGen.cpp: In member function 'virtual bool BrefcomTestGen::generate()':
extra/BrefcomTestGen.cpp:136: warning: unused variable 'id3'
/usr/include/python2.4/object.h:343: error: expected unqualified-id before ';' token
/usr/include/python2.4/object.h:343: error: abstract declarator 'PyObject*' used as declaration
distcc[9015] ERROR: compile gui/qt3/GLSimulationPlayerViewer.cpp on tien/2 failed
scons: *** [/home/janek/20-Programowanie/10-cpp/50-Yade/Code/CURRENT/build-svn1244-moment_law2/gui/qt3/GLSimulationPlayerViewer.os] Error 1
scons: building terminated because of errors.

Vaclav, I have no idea how to fix those python 2.4 related errors. I
guess that I cannot run pyView in that case?



So now I'm gonna uninstall those packages and use yade as before. BUT
I had python-devel installed. So yade is compiling when following
stuff is detected:


Checking whether c++ compiler "distcc g++" works...yes
Checking for pthread_exit(NULL) in C library pthread... yes
Checking for glutGetModifiers() in C library glut... yes
Checking for boost::posix_time::time_duration::time_duration() in C++ library boost_date_time-mt... no
Checking for boost::posix_time::time_duration::time_duration() in C++ library boost_date_time... yes
Checking for boost::thread::thread() in C++ library boost_thread-mt... no 
Checking for boost::thread::thread() in C++ library boost_thread... yes 
Checking for boost::filesystem::path() in C++ library boost_filesystem-mt... no
Checking for boost::filesystem::path() in C++ library boost_filesystem... yes
Checking for Wm3::Math<double>::PI in C++ library Wm3Foundation... yes
Checking for qt-mt in /usr/share/qt3... yes 
Checking for QGLViewer(1) in C++ library QGLViewer... no
Checking for QGLViewer(1) in C++ library qglviewer... yes 
Checking for log4cxx::Logger::getLogger("foo") in C++ library log4cxx... no
Checking for Python development files... yes 
Checking for scientific python module (debian: python-scientific)... (cached) no
scons: done reading SConscript files.


Care to help with that?

-- 
Janek Kozicki


From janek_listy at wp.pl  Tue Feb 12 02:47:36 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Tue, 12 Feb 2008 02:47:36 +0100
Subject: [yade-dev] SDECSpheresPlane 1241 vs. 1244
Message-ID: <20080212024736.339ac6f8@szpak>

Vaclav, would you mind running default filegenerator for
SDECSpheresPlane in 1241 and compare it with HEAD?

You gotta fix this since you have broken it ;p

we are in dire need of regression tests. Any tests :(

How about committing an .xml for each filegenerator, and some
comparison result, with a commandline invocation to run it and
compare. A job for cron, or sth, after each commit.

-- 
Janek Kozicki                                                         |


From eudoxos at arcig.cz  Tue Feb 12 10:47:57 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 12 Feb 2008 10:47:57 +0100
Subject: [yade-dev] python-scientific problems on debian etch.
In-Reply-To: <20080212003020.4d547d84@szpak>
References: <20080212003020.4d547d84@szpak>
Message-ID: <47B16B4D.6000002@arcig.cz>

have a look at that line

/usr/include/python2.4/object.h:343

And if necessary, run compilation with -fsave-temps and have a look at the preprocessed code. This is typically that an empty macro is accidentally an identifier in the header. I had this with qt3 & python, where qt3 #defined slot, which was a variable name inside python. Qt3 sucks. Send me that file 
/usr/include/python2.4/object.h if in doubt.

Regards, Vaclav

> OK, I thought I'll give it a try and installed:
>
>   [INSTALL, DEPENDENCIES] blt
>   [INSTALL, DEPENDENCIES] liblog4cxx9c2a
>   [INSTALL, DEPENDENCIES] libnetcdf3
>   [INSTALL, DEPENDENCIES] python-netcdf
>   [INSTALL, DEPENDENCIES] python-numeric-ext
>   [INSTALL, DEPENDENCIES] python-tk
>   [INSTALL] liblog4cxx9-dev
>   [INSTALL] python-scientific
>
> that's a copy'n'paste from /var/log/aptitude
>
>
> So I got this:
>
> Checking whether c++ compiler "distcc g++" works...yes
> Checking for pthread_exit(NULL) in C library pthread... yes
> Checking for glutGetModifiers() in C library glut... yes
> Checking for boost::posix_time::time_duration::time_duration() in C++ library boost_date_time-mt... no
> Checking for boost::posix_time::time_duration::time_duration() in C++ library boost_date_time... yes
> Checking for boost::thread::thread() in C++ library boost_thread-mt... no
> Checking for boost::thread::thread() in C++ library boost_thread... yes
> Checking for boost::filesystem::path() in C++ library boost_filesystem-mt... no
> Checking for boost::filesystem::path() in C++ library boost_filesystem... yes
> Checking for Wm3::Math<double>::PI in C++ library Wm3Foundation... yes
> Checking for qt-mt in /usr/share/qt3... yes
> Checking for QGLViewer(1) in C++ library QGLViewer... no
> Checking for QGLViewer(1) in C++ library qglviewer... yes
> Checking for log4cxx::Logger::getLogger("foo") in C++ library log4cxx... yes
> Checking for Python development files... yes
> Checking for scientific python module (debian: python-scientific)... (cached) yes
> Checking for boost::python::scope() in C++ library boost_python-mt... no
> Checking for boost::python::scope() in C++ library boost_python... yes
> scons: done reading SConscript files.
>
>
> And so I got this error:
>
>
> /usr/include/python2.4/object.h:343: error: expected unqualified-id before ';' token
> /usr/include/python2.4/object.h:343: error: abstract declarator 'PyObject*' used as declaration
> distcc[9016] ERROR: compile gui/qt3/GLViewer.cpp on localhost failed
> scons: *** [/home/janek/20-Programowanie/10-cpp/50-Yade/Code/CURRENT/build-svn1244-moment_law2/gui/qt3/GLViewer.os] Error 1
> /usr/include/python2.4/object.h:343: error: expected unqualified-id before ';' token
> /usr/include/python2.4/object.h:343: error: abstract declarator 'PyObject*' used as declaration
> distcc[9031] ERROR: compile gui/qt3/QtCodeGenerator.cpp on localhost failed
> scons: *** [/home/janek/20-Programowanie/10-cpp/50-Yade/Code/CURRENT/build-svn1244-moment_law2/gui/qt3/QtCodeGenerator.os] Error 1
> extra/BrefcomTestGen.cpp: In member function 'virtual bool BrefcomTestGen::generate()':
> extra/BrefcomTestGen.cpp:136: warning: unused variable 'id3'
> /usr/include/python2.4/object.h:343: error: expected unqualified-id before ';' token
> /usr/include/python2.4/object.h:343: error: abstract declarator 'PyObject*' used as declaration
> distcc[9015] ERROR: compile gui/qt3/GLSimulationPlayerViewer.cpp on tien/2 failed
> scons: *** [/home/janek/20-Programowanie/10-cpp/50-Yade/Code/CURRENT/build-svn1244-moment_law2/gui/qt3/GLSimulationPlayerViewer.os] Error 1
> scons: building terminated because of errors.
>
> Vaclav, I have no idea how to fix those python 2.4 related errors. I
> guess that I cannot run pyView in that case?
>
>
>
> So now I'm gonna uninstall those packages and use yade as before. BUT
> I had python-devel installed. So yade is compiling when following
> stuff is detected:
>
>
> Checking whether c++ compiler "distcc g++" works...yes
> Checking for pthread_exit(NULL) in C library pthread... yes
> Checking for glutGetModifiers() in C library glut... yes
> Checking for boost::posix_time::time_duration::time_duration() in C++ library boost_date_time-mt... no
> Checking for boost::posix_time::time_duration::time_duration() in C++ library boost_date_time... yes
> Checking for boost::thread::thread() in C++ library boost_thread-mt... no 
> Checking for boost::thread::thread() in C++ library boost_thread... yes 
> Checking for boost::filesystem::path() in C++ library boost_filesystem-mt... no
> Checking for boost::filesystem::path() in C++ library boost_filesystem... yes
> Checking for Wm3::Math<double>::PI in C++ library Wm3Foundation... yes
> Checking for qt-mt in /usr/share/qt3... yes 
> Checking for QGLViewer(1) in C++ library QGLViewer... no
> Checking for QGLViewer(1) in C++ library qglviewer... yes 
> Checking for log4cxx::Logger::getLogger("foo") in C++ library log4cxx... no
> Checking for Python development files... yes 
> Checking for scientific python module (debian: python-scientific)... (cached) no
> scons: done reading SConscript files.
>
>
> Care to help with that?
>
>   



From eudoxos at arcig.cz  Tue Feb 12 12:10:01 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 12 Feb 2008 12:10:01 +0100
Subject: [yade-dev] SDECSpheresPlane 1241 vs. 1244
In-Reply-To: <20080212024736.339ac6f8@szpak>
References: <20080212024736.339ac6f8@szpak>
Message-ID: <47B17E89.3000705@arcig.cz>

It works for me. I need to get and compile 1241 though to see what the
result should be. V.
> Vaclav, would you mind running default filegenerator for
> SDECSpheresPlane in 1241 and compare it with HEAD?
>
> You gotta fix this since you have broken it ;p
>
> we are in dire need of regression tests. Any tests :(
>
> How about committing an .xml for each filegenerator, and some
> comparison result, with a commandline invocation to run it and
> compare. A job for cron, or sth, after each commit.
>
>   



From bruno.chareyre at hmg.inpg.fr  Tue Feb 12 13:13:21 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Tue, 12 Feb 2008 13:13:21 +0100
Subject: [yade-dev] SDECSpheresPlane 1241 vs. 1244
In-Reply-To: <47B17E89.3000705@arcig.cz>
References: <20080212024736.339ac6f8@szpak> <47B17E89.3000705@arcig.cz>
Message-ID: <47B18D61.70708@hmg.inpg.fr>

A good regression test could be based on a triaxial test (compaction 
and/or compression test) based on a ascii file with initial coordinates 
of 50 spheres (like the famous smallsdec.xyz). But the comparison should 
be done on stress-strain curves, which is hard to automatize... or 
perhaps just checking stress/strain values after 50k iterations.

Bruno

V?clav S a ?crit :
> It works for me. I need to get and compile 1241 though to see what the
> result should be. V.
>   
>> Vaclav, would you mind running default filegenerator for
>> SDECSpheresPlane in 1241 and compare it with HEAD?
>>
>> You gotta fix this since you have broken it ;p
>>
>> we are in dire need of regression tests. Any tests :(
>>
>> How about committing an .xml for each filegenerator, and some
>> comparison result, with a commandline invocation to run it and
>> compare. A job for cron, or sth, after each commit.
>>
>>   
>>     
>
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From janek_listy at wp.pl  Tue Feb 12 13:31:22 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Tue, 12 Feb 2008 13:31:22 +0100
Subject: [yade-dev] SDECSpheresPlane 1241 vs. 1244
In-Reply-To: <47B17E89.3000705@arcig.cz>
References: <20080212024736.339ac6f8@szpak>
	<47B17E89.3000705@arcig.cz>
Message-ID: <20080212133122.48c00926@szpak>

V?clav S(milauer said:     (by the date of Tue, 12 Feb 2008 12:10:01 +0100)

> It works for me. I need to get and compile 1241 though to see what the
> result should be. V.

for me spheres behave in different manner in HEAD - they bounce a lot
and fell of the "floor". This was not the case in 1241 and older

-- 
Janek Kozicki                                                         |


From janek_listy at wp.pl  Tue Feb 12 14:10:49 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Tue, 12 Feb 2008 14:10:49 +0100
Subject: [yade-dev] SDECSpheresPlane 1241 vs. 1244
In-Reply-To: <20080212133122.48c00926@szpak>
References: <20080212024736.339ac6f8@szpak> <47B17E89.3000705@arcig.cz>
	<20080212133122.48c00926@szpak>
Message-ID: <20080212141049.364af388@szpak>

Janek Kozicki said:     (by the date of Tue, 12 Feb 2008 13:31:22 +0100)

> for me spheres behave in different manner in HEAD - they bounce a lot
> and fell of the "floor". This was not the case in 1241 and older

apparently damping is not working. I can "fix" by hand the scene.xml
from HEAD, here's the diff:

-                       <engines _className_="PhysicalActionDamper"
functorNames="[[Force ParticleParameters
CundallNonViscousForceDamping] [Force RigidBodyParameters
CundallNonViscousMomentumDamping]]">

+                       <engines _className_="PhysicalActionDamper"
functorNames="[[Force RigidBodyParameters
CundallNonViscousForceDamping] [Momentum RigidBodyParameters
CundallNonViscousMomentumDamping]]">


then it works. It means that some FUNCTOR autodetection is not working.

-- 
Janek Kozicki                                                         |


From janek_listy at wp.pl  Tue Feb 12 16:47:30 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Tue, 12 Feb 2008 16:47:30 +0100
Subject: [yade-dev] SDECSpheresPlane 1241 vs. 1244
In-Reply-To: <20080212141049.364af388@szpak>
References: <20080212024736.339ac6f8@szpak> <47B17E89.3000705@arcig.cz>
	<20080212133122.48c00926@szpak> <20080212141049.364af388@szpak>
Message-ID: <20080212164730.4438a8b3@szpak>

ok, I got it. You made a mistake here:

--- pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping.hpp   (revision 1244)
+++ pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping.hpp   (working copy)
@@ -25,7 +25,7 @@
        protected :
                 virtual void registerAttributes();

-       FUNCTOR2D(Force,RigidBodyParameters);
+       FUNCTOR2D(Momentum,RigidBodyParameters);
        REGISTER_CLASS_NAME(CundallNonViscousMomentumDamping);
        REGISTER_BASE_CLASS_NAME(PhysicalActionDamperUnit);
 };

fix will go with next commit.

-- 
Janek Kozicki                                                         |


From eudoxos at arcig.cz  Tue Feb 12 18:57:17 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 12 Feb 2008 18:57:17 +0100
Subject: [yade-dev] SDECSpheresPlane 1241 vs. 1244
In-Reply-To: <20080212164730.4438a8b3@szpak>
References: <20080212024736.339ac6f8@szpak>
	<47B17E89.3000705@arcig.cz>	<20080212133122.48c00926@szpak>
	<20080212141049.364af388@szpak> <20080212164730.4438a8b3@szpak>
Message-ID: <47B1DDFD.1010409@arcig.cz>

Sorry, thanks for the fix. V.
> ok, I got it. You made a mistake here:
>
> --- pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping.hpp   (revision 1244)
> +++ pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping.hpp   (working copy)
> @@ -25,7 +25,7 @@
>         protected :
>                  virtual void registerAttributes();
>
> -       FUNCTOR2D(Force,RigidBodyParameters);
> +       FUNCTOR2D(Momentum,RigidBodyParameters);
>         REGISTER_CLASS_NAME(CundallNonViscousMomentumDamping);
>         REGISTER_BASE_CLASS_NAME(PhysicalActionDamperUnit);
>  };
>
> fix will go with next commit.
>
>   



From janek_listy at wp.pl  Wed Feb 13 04:09:16 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Wed, 13 Feb 2008 04:09:16 +0100
Subject: [yade-dev] trying cmdGui
Message-ID: <20080213040916.4cf6084f@szpak>

Hi,

I made it compile with qt3 "slots" and committed fix. Now I can
finally have a look at python scripting. So I try to launch this
example, cmdGui1.py (I copied it into /bin/ where yade executable
resides).

$ ./yade-svn1244 -N cmdGui -- -s ./cmdGui1.py

Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
Traceback (most recent call last):
  File "<string>", line 1, in ?
ImportError: /home/janek/40-Yade/Bin/HEAD/lib/yade-svn1244/gui/yadeControl.so: undefined symbol: __stack_chk_fail_local
Traceback (most recent call last):
  File "./cmdGui1.py", line 6, in ?
    p=Preprocessor()
NameError: name 'Preprocessor' is not defined
>>> ^D

what now? :)
-- 
Janek Kozicki                                                         |


From eudoxos at arcig.cz  Wed Feb 13 15:53:29 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 13 Feb 2008 15:53:29 +0100
Subject: [yade-dev] trying cmdGui
In-Reply-To: <20080213040916.4cf6084f@szpak>
References: <20080213040916.4cf6084f@szpak>
Message-ID: <47B30469.4060900@arcig.cz>

Jank, I have no idea, try googling it out (will try myself). Seems like
linking issue, definitely not something I know from the top of my head. V
> Hi,
>
> I made it compile with qt3 "slots" and committed fix. Now I can
> finally have a look at python scripting. So I try to launch this
> example, cmdGui1.py (I copied it into /bin/ where yade executable
> resides).
>
> $ ./yade-svn1244 -N cmdGui -- -s ./cmdGui1.py
>
> Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
> Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
> WARNING: cannot open file used for capillary law, in TriaxalTestWater
> Traceback (most recent call last):
>   File "<string>", line 1, in ?
> ImportError: /home/janek/40-Yade/Bin/HEAD/lib/yade-svn1244/gui/yadeControl.so: undefined symbol: __stack_chk_fail_local
> Traceback (most recent call last):
>   File "./cmdGui1.py", line 6, in ?
>     p=Preprocessor()
> NameError: name 'Preprocessor' is not defined
>   
>>>> ^D
>>>>         
>
> what now? :)
>   



From eudoxos at arcig.cz  Wed Feb 13 16:23:25 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 13 Feb 2008 16:23:25 +0100
Subject: [yade-dev] trying cmdGui
In-Reply-To: <20080213040916.4cf6084f@szpak>
References: <20080213040916.4cf6084f@szpak>
Message-ID: <47B30B6D.9060408@arcig.cz>

Possible cause is the stack protector, you will need to disable it (see
CXXFLAGS option for scons):

http://code.google.com/p/modwsgi/wiki/InstallationIssues (under GNU C
Stack Smashing Extensions)

https://bugs.launchpad.net/ubuntu/+source/iptables/+bug/66681

https://wiki.ubuntu.com/GccSsp

http://www.thescripts.com/forum/thread476894.html :
> Make sure you have a recent version of GCC and binutils. I just ran
> into the same problem with python 2.4.3. It had nothing to do with the
> code base. The linker was broken and an update of my binutils fixed the
> issue.
> Kind regards,
> Chris
V.

> Hi,
>
> I made it compile with qt3 "slots" and committed fix. Now I can
> finally have a look at python scripting. So I try to launch this
> example, cmdGui1.py (I copied it into /bin/ where yade executable
> resides).
>
> $ ./yade-svn1244 -N cmdGui -- -s ./cmdGui1.py
>
> Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
> Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
> WARNING: cannot open file used for capillary law, in TriaxalTestWater
> Traceback (most recent call last):
>   File "<string>", line 1, in ?
> ImportError: /home/janek/40-Yade/Bin/HEAD/lib/yade-svn1244/gui/yadeControl.so: undefined symbol: __stack_chk_fail_local
> Traceback (most recent call last):
>   File "./cmdGui1.py", line 6, in ?
>     p=Preprocessor()
> NameError: name 'Preprocessor' is not defined
>   
>>>> ^D
>>>>         
>
> what now? :)
>   



From janek_listy at wp.pl  Wed Feb 13 16:30:42 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Wed, 13 Feb 2008 16:30:42 +0100
Subject: [yade-dev] [Yade-commits] r1246 - in trunk:
In-Reply-To: <200802131456.m1DEuLJJ008697@sheep.berlios.de>
References: <200802131456.m1DEuLJJ008697@sheep.berlios.de>
Message-ID: <20080213163042.4b6f6d3b@szpak>

> 1. Preliminary recovery of simulation accross runs (try sending SIGHUP to yade)
> 2. Python wrapper for body parameters.
> 3. Misc fixes of engines.
> 4. Allow Omega to stop at predefined iteration number (for regression tests, I work on that ;-) )

I guess that -m parameter for NullGUI is of no use for you? I was
thinking to use NullGUI for regressions, and then it would simply
work.

> 5. ...

what is that?

-- 
Janek Kozicki                                                         |


From janek_listy at wp.pl  Wed Feb 13 17:03:17 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Wed, 13 Feb 2008 17:03:17 +0100
Subject: [yade-dev] trying cmdGui
In-Reply-To: <47B30B6D.9060408@arcig.cz>
References: <20080213040916.4cf6084f@szpak>
	<47B30B6D.9060408@arcig.cz>
Message-ID: <20080213170317.314b5acc@szpak>

$ scons CXXFLAGS=-fno-stack-protector


OK, now I got his:




janek at szpak:~/20-Programowanie/10-cpp/50-Yade/Bin/moment_law2/bin$ ./yade-svn1244-moment_law2 -N cmdGui -- -s ./cmdGui1.py
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
Available generators: ['BoxStack', 'BrefcomTestGen', 'ClumpTestGen', 'CohesiveTriaxialTest', 'FEMBeam', 'Funnel', 'HangingCloth', 'HydraulicTest', 'LatticeExample', 'RotatingBox', 'SDECImpactTest', 'SDECLinkedSpheres', 'SDECMovingWall', 'SDECSpheresPlane', 'ScrewGen', 'TetraTestGen', 'TetrahedronsTest', 'ThreePointBending', 'TriaxialTest', 'TriaxialTestWater', 'USCTGen']
Available serializers: ['BINFormatManager', 'XMLFormatManager']
2960 [3056416480] FATAL yade.FileGenerator  - core/FileGenerator.cpp:71 generateAndSave: Unhandled exception: St13runtime_error : Class `InteractingSphere2InteractingSphere4ClosestFeatures' could not be cast to required 2D EngineUnit
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/janek/.yade-svn1244-moment_law2/gdb_crash_batch-pid19492'
GNU gdb 6.4.90-debian
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i486-linux-gnu".
Using host libthread_db library "/lib/tls/i686/cmov/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread -1238550816 (LWP 19492)]
0xffffe410 in __kernel_vsyscall ()
No symbol "info" in current context.

Thread 1 (Thread -1238550816 (LWP 19492)):
#0  0xffffe410 in __kernel_vsyscall ()
#1  0xb721f2f3 in waitpid () from /lib/tls/i686/cmov/libc.so.6
#2  0xb71c7669 in strtold_l () from /lib/tls/i686/cmov/libc.so.6
#3  0xb7e6aadd in system () from /lib/tls/i686/cmov/libpthread.so.0
#4  0x0812ec71 in sigHandler (sig=6) at core/yade.cpp:52
#5  <signal handler called>
#6  0xffffe410 in __kernel_vsyscall ()
#7  0xb71ba811 in raise () from /lib/tls/i686/cmov/libc.so.6
#8  0xb71bbfb9 in abort () from /lib/tls/i686/cmov/libc.so.6
#9  0x080d5034 in FileGenerator::generateAndSave (this=0x81b1358) at core/FileGenerator.cpp:72
#10 0xb25a73fa in pyPreprocessor::generate (this=0x8240a88) at gui/cmd/yadeControl.cpp:229
#11 0xb259a1fc in boost::python::detail::invoke<boost::python::to_python_value<bool const&>, bool (pyPreprocessor::*)(), boost::python::arg_from_python<pyPreprocessor&> > (rc=@0xbfb4bfba, f=@0x823e664, tc=@0xbfb4bfb0) at /usr/include/boost/python/detail/invoke.hpp:88
#12 0xb259a2e5 in boost::python::detail::caller_arity<1u>::impl<bool (pyPreprocessor::*)(), boost::python::default_call_policies, boost::mpl::vector2<bool, pyPreprocessor&> >::operator() (this=0x823e664, args_=0xb621992c) at /usr/include/boost/python/detail/caller.hpp:199
#13 0xb259a340 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<bool (pyPreprocessor::*)(), boost::python::default_call_policies, boost::mpl::vector2<bool, pyPreprocessor&> > >::operator() (this=0x823e660, args=0xb621992c, kw=0x0)
    at /usr/include/boost/python/object/py_function.hpp:38
#14 0xb7479f56 in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc41-mt-1_34_1.so.1.34.1
#15 0xb747bf37 in boost::detail::function::void_function_ref_invoker0<boost::python::objects::(anonymous namespace)::bind_return, void>::invoke ()
   from /usr/lib/libboost_python-gcc41-mt-1_34_1.so.1.34.1
#16 0xb7e1702a in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc41-mt-1_34_1.so.1.34.1
#17 0xb74812eb in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc41-mt-1_34_1.so.1.34.1
#18 0xb747b45e in boost::python::handle_exception<boost::python::objects::(anonymous namespace)::bind_return> ()
   from /usr/lib/libboost_python-gcc41-mt-1_34_1.so.1.34.1
#19 0xb7477f9a in boost::python::objects::function::add_overload () from /usr/lib/libboost_python-gcc41-mt-1_34_1.so.1.34.1
#20 0xb7e91237 in PyObject_Call () from /usr/lib/libpython2.4.so.1.0
#21 0xb7ef8fa1 in PyEval_EvalFrame () from /usr/lib/libpython2.4.so.1.0
---Type <return> to continue, or q <return> to quit---
#22 0xb7efc77a in PyEval_EvalCodeEx () from /usr/lib/libpython2.4.so.1.0
#23 0xb7efc7e5 in PyEval_EvalCode () from /usr/lib/libpython2.4.so.1.0
#24 0xb7f21357 in PyRun_FileExFlags () from /usr/lib/libpython2.4.so.1.0
#25 0xb7f21566 in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.4.so.1.0
#26 0xb7f21781 in PyRun_SimpleFileEx () from /usr/lib/libpython2.4.so.1.0
#27 0xb7f217ba in PyRun_SimpleFile () from /usr/lib/libpython2.4.so.1.0
#28 0xb4d2febd in cmdGui::run (this=0x81daca8, argc=3, argv=0xbfb4c960) at gui/cmd/cmdGui.cpp:67
#29 0x0812e6e6 in main (argc=3, argv=0xbfb4c960) at core/yade.cpp:207
#0  0xffffe410 in __kernel_vsyscall ()
(gdb)


-- 
Janek Kozicki                                                         |


From janek_listy at wp.pl  Wed Feb 13 18:16:35 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Wed, 13 Feb 2008 18:16:35 +0100
Subject: [yade-dev] trying cmdGui
In-Reply-To: <20080213170317.314b5acc@szpak>
References: <20080213040916.4cf6084f@szpak> <47B30B6D.9060408@arcig.cz>
	<20080213170317.314b5acc@szpak>
Message-ID: <20080213181635.394395ea@szpak>

Now after svn update. SVN-HEAD. I tried to play with python
So here's my session (crashed at the end):


janek at szpak:~/20-Programowanie/10-cpp/50-Yade/Bin/moment_law2/bin$ ./yade-svn1246-moment_law2 -N cmdGui
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
>>> o.engines
Traceback (most recent call last):
  File "<console>", line 1, in ?
NameError: name 'o' is not defined
>>> o=Omega()
>>> o.engines
Traceback (most recent call last):
  File "<console>", line 1, in ?
RuntimeError: No root body.
>>> p=Preprocessor()
>>> p.generator="BoxStack"
>>> p.generate()
110650 [3055924960] FATAL yade.FileGenerator  - core/FileGenerator.cpp:71 generateAndSave: Unhandled exception: St13runtime_error : Class `InteractingSphere2InteractingSphere4ClosestFeatures' could not be cast to required 2D EngineUnit
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/janek/.yade-svn1246-moment_law2/gdb_crash_batch-pid22642'
GNU gdb 6.4.90-debian
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i486-linux-gnu".
Using host libthread_db library "/lib/tls/i686/cmov/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread -1239042336 (LWP 22642)]
0xffffe410 in __kernel_vsyscall ()
No symbol "info" in current context.

Thread 1 (Thread -1239042336 (LWP 22642)):
#0  0xffffe410 in __kernel_vsyscall ()
#1  0xb71a72f3 in waitpid () from /lib/tls/i686/cmov/libc.so.6
#2  0xb714f669 in strtold_l () from /lib/tls/i686/cmov/libc.so.6
#3  0xb7df9add in system () from /lib/tls/i686/cmov/libpthread.so.0
#4  0x08131d8d in sigHandler (sig=6) at core/yade.cpp:53
#5  <signal handler called>
#6  0xffffe410 in __kernel_vsyscall ()
#7  0xb7142811 in raise () from /lib/tls/i686/cmov/libc.so.6
#8  0xb7143fb9 in abort () from /lib/tls/i686/cmov/libc.so.6
#9  0x080d54c0 in FileGenerator::generateAndSave (this=0x82465e0) at core/FileGenerator.cpp:72
#10 0xb25155ba in pyPreprocessor::generate (this=0x82423f8) at gui/cmd/yadeControl.cpp:255
#11 0xb25056c6 in boost::python::detail::invoke<boost::python::to_python_value<bool const&>, bool (pyPreprocessor::*)(), boost::python::arg_from_python<pyPreprocessor&> > (rc=@0xbfbf082a, f=@0x824278c, tc=@0xbfbf0820) at /usr/include/boost/python/detail/invoke.hpp:88
#12 0xb25057af in boost::python::detail::caller_arity<1u>::impl<bool (pyPreprocessor::*)(), boost::python::default_call_policies, boost::mpl::vector2<bool, pyPreprocessor&> >::operator() (this=0x824278c, args_=0xb61e786c) at /usr/include/boost/python/detail/caller.hpp:199
#13 0xb250580a in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<bool (pyPreprocessor::*)(), boost::python::default_call_policies, boost::mpl::vector2<bool, pyPreprocessor&> > >::operator() (this=0x8242788, args=0xb61e786c, kw=0x0)
    at /usr/include/boost/python/object/py_function.hpp:38
#14 0xb7408f56 in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc41-mt-1_34_1.so.1.34.1
#15 0xb740af37 in boost::detail::function::void_function_ref_invoker0<boost::python::objects::(anonymous namespace)::bind_return, void>::invoke ()
   from /usr/lib/libboost_python-gcc41-mt-1_34_1.so.1.34.1
#16 0xb7da602a in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc41-mt-1_34_1.so.1.34.1
#17 0xb74102eb in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc41-mt-1_34_1.so.1.34.1
#18 0xb740a45e in boost::python::handle_exception<boost::python::objects::(anonymous namespace)::bind_return> ()
   from /usr/lib/libboost_python-gcc41-mt-1_34_1.so.1.34.1
#19 0xb7406f9a in boost::python::objects::function::add_overload () from /usr/lib/libboost_python-gcc41-mt-1_34_1.so.1.34.1
---Type <return> to continue, or q <return> to quit---
#20 0xb7e20237 in PyObject_Call () from /usr/lib/libpython2.4.so.1.0
#21 0xb7e87fa1 in PyEval_EvalFrame () from /usr/lib/libpython2.4.so.1.0
#22 0xb7e8b77a in PyEval_EvalCodeEx () from /usr/lib/libpython2.4.so.1.0
#23 0xb7e8b7e5 in PyEval_EvalCode () from /usr/lib/libpython2.4.so.1.0
#24 0xb7eafeed in PyRun_InteractiveOneFlags () from /usr/lib/libpython2.4.so.1.0
#25 0xb7eb0023 in PyRun_InteractiveLoopFlags () from /usr/lib/libpython2.4.so.1.0
#26 0xb7eb00fa in PyRun_InteractiveLoop () from /usr/lib/libpython2.4.so.1.0
#27 0xb4c877e3 in cmdGui::run (this=0x81fe4b8, argc=1, argv=0xbfbf11fc) at gui/cmd/cmdGui.cpp:85
#28 0x081317d1 in main (argc=1, argv=0xbfbf11fc) at core/yade.cpp:242
#0  0xffffe410 in __kernel_vsyscall ()
(gdb)
(gdb) q
The program is running.  Quit anyway (and detach it)? (y or n) y




But I think I made it work with >>> p.generator="SDECSpheresPlane"
The simulation was running, only things that didn't work was:

>>> v=View()

Opened a view, but with unrefreshable remnants of QTFileGenerator
inside (the same that we see in QtGUI). Maybe it was simply in that
part of memory, not something that current session created. And lots
of errors:

QGLContext::makeCurrent(): Failed.

I remember this error. We had it, and yade was frequently crashing.
Olivier's laptop was hanging sometimes. And later I've found some
solution for that and it works cleanly now. I forgot what it was....
gotta look into SVN history for that.

I remember you talking something about pyView() so I tried:

>>> v=pyView()
Traceback (most recent call last):
  File "<console>", line 1, in ?
NameError: name 'pyView' is not defined

But nothing,

And finally - crash at exit:



>>> QGLContext::makeCurrent(): Failed.
sys.exit(0)
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/janek/.yade-svn1246-moment_law2/gdb_crash_batch-pid24230'
janek at szpak:~/20-Programowanie/10-cpp/50-Yade/Bin/moment_law2/bin$ GNU gdb 6.4.90-debian
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i486-linux-gnu".
/home/janek/.yade-svn1246-moment_law2/gdb_crash_batch-pid24230:1: Error in sourced command file:
ptrace: No such process.
(gdb) q
zsh: command not found: q


Looks like gdb tried to start, but failed: ptrace: No such process. I
hope that you can distinguish copy/pastes from my comments ;-)


-- 
Janek Kozicki                                                         |


From eudoxos at arcig.cz  Thu Feb 14 12:03:36 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Thu, 14 Feb 2008 12:03:36 +0100
Subject: [yade-dev] trying cmdGui
In-Reply-To: <20080213181635.394395ea@szpak>
References: <20080213040916.4cf6084f@szpak>
	<47B30B6D.9060408@arcig.cz>	<20080213170317.314b5acc@szpak>
	<20080213181635.394395ea@szpak>
Message-ID: <47B42008.30208@arcig.cz>

Hi, the crash is from MetaDispatchingEngine2D.hpp:60. Could you think of
solution how to typecast that factored class (by its name) if the
template arg EngineUnitType is (in this case) already a shared_ptr,
namely shared_ptr<InteractingGeometry>&  (in
InteractingGeometryEngineUnit.cpp:39)?

(I will be off till sunday)

Vaclav
> Now after svn update. SVN-HEAD. I tried to play with python
> So here's my session (crashed at the end):
>
>
> janek at szpak:~/20-Programowanie/10-cpp/50-Yade/Bin/moment_law2/bin$ ./yade-svn1246-moment_law2 -N cmdGui
> Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
> Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
> WARNING: cannot open file used for capillary law, in TriaxalTestWater
>   
>>>> o.engines
>>>>         
> Traceback (most recent call last):
>   File "<console>", line 1, in ?
> NameError: name 'o' is not defined
>   
>>>> o=Omega()
>>>> o.engines
>>>>         
> Traceback (most recent call last):
>   File "<console>", line 1, in ?
> RuntimeError: No root body.
>   
>>>> p=Preprocessor()
>>>> p.generator="BoxStack"
>>>> p.generate()
>>>>         
> 110650 [3055924960] FATAL yade.FileGenerator  - core/FileGenerator.cpp:71 generateAndSave: Unhandled exception: St13runtime_error : Class `InteractingSphere2InteractingSphere4ClosestFeatures' could not be cast to required 2D EngineUnit
> SIGSEGV/SIGABRT handler called; gdb batch file is `/home/janek/.yade-svn1246-moment_law2/gdb_crash_batch-pid22642'
> GNU gdb 6.4.90-debian
> Copyright (C) 2006 Free Software Foundation, Inc.
> GDB is free software, covered by the GNU General Public License, and you are
> welcome to change it and/or distribute copies of it under certain conditions.
> Type "show copying" to see the conditions.
> There is absolutely no warranty for GDB.  Type "show warranty" for details.
> This GDB was configured as "i486-linux-gnu".
> Using host libthread_db library "/lib/tls/i686/cmov/libthread_db.so.1".
> [Thread debugging using libthread_db enabled]
> [New Thread -1239042336 (LWP 22642)]
> 0xffffe410 in __kernel_vsyscall ()
> No symbol "info" in current context.
>
> Thread 1 (Thread -1239042336 (LWP 22642)):
> #0  0xffffe410 in __kernel_vsyscall ()
> #1  0xb71a72f3 in waitpid () from /lib/tls/i686/cmov/libc.so.6
> #2  0xb714f669 in strtold_l () from /lib/tls/i686/cmov/libc.so.6
> #3  0xb7df9add in system () from /lib/tls/i686/cmov/libpthread.so.0
> #4  0x08131d8d in sigHandler (sig=6) at core/yade.cpp:53
> #5  <signal handler called>
> #6  0xffffe410 in __kernel_vsyscall ()
> #7  0xb7142811 in raise () from /lib/tls/i686/cmov/libc.so.6
> #8  0xb7143fb9 in abort () from /lib/tls/i686/cmov/libc.so.6
> #9  0x080d54c0 in FileGenerator::generateAndSave (this=0x82465e0) at core/FileGenerator.cpp:72
> #10 0xb25155ba in pyPreprocessor::generate (this=0x82423f8) at gui/cmd/yadeControl.cpp:255
> #11 0xb25056c6 in boost::python::detail::invoke<boost::python::to_python_value<bool const&>, bool (pyPreprocessor::*)(), boost::python::arg_from_python<pyPreprocessor&> > (rc=@0xbfbf082a, f=@0x824278c, tc=@0xbfbf0820) at /usr/include/boost/python/detail/invoke.hpp:88
> #12 0xb25057af in boost::python::detail::caller_arity<1u>::impl<bool (pyPreprocessor::*)(), boost::python::default_call_policies, boost::mpl::vector2<bool, pyPreprocessor&> >::operator() (this=0x824278c, args_=0xb61e786c) at /usr/include/boost/python/detail/caller.hpp:199
> #13 0xb250580a in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<bool (pyPreprocessor::*)(), boost::python::default_call_policies, boost::mpl::vector2<bool, pyPreprocessor&> > >::operator() (this=0x8242788, args=0xb61e786c, kw=0x0)
>     at /usr/include/boost/python/object/py_function.hpp:38
> #14 0xb7408f56 in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc41-mt-1_34_1.so.1.34.1
> #15 0xb740af37 in boost::detail::function::void_function_ref_invoker0<boost::python::objects::(anonymous namespace)::bind_return, void>::invoke ()
>    from /usr/lib/libboost_python-gcc41-mt-1_34_1.so.1.34.1
> #16 0xb7da602a in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc41-mt-1_34_1.so.1.34.1
> #17 0xb74102eb in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc41-mt-1_34_1.so.1.34.1
> #18 0xb740a45e in boost::python::handle_exception<boost::python::objects::(anonymous namespace)::bind_return> ()
>    from /usr/lib/libboost_python-gcc41-mt-1_34_1.so.1.34.1
> #19 0xb7406f9a in boost::python::objects::function::add_overload () from /usr/lib/libboost_python-gcc41-mt-1_34_1.so.1.34.1
> ---Type <return> to continue, or q <return> to quit---
> #20 0xb7e20237 in PyObject_Call () from /usr/lib/libpython2.4.so.1.0
> #21 0xb7e87fa1 in PyEval_EvalFrame () from /usr/lib/libpython2.4.so.1.0
> #22 0xb7e8b77a in PyEval_EvalCodeEx () from /usr/lib/libpython2.4.so.1.0
> #23 0xb7e8b7e5 in PyEval_EvalCode () from /usr/lib/libpython2.4.so.1.0
> #24 0xb7eafeed in PyRun_InteractiveOneFlags () from /usr/lib/libpython2.4.so.1.0
> #25 0xb7eb0023 in PyRun_InteractiveLoopFlags () from /usr/lib/libpython2.4.so.1.0
> #26 0xb7eb00fa in PyRun_InteractiveLoop () from /usr/lib/libpython2.4.so.1.0
> #27 0xb4c877e3 in cmdGui::run (this=0x81fe4b8, argc=1, argv=0xbfbf11fc) at gui/cmd/cmdGui.cpp:85
> #28 0x081317d1 in main (argc=1, argv=0xbfbf11fc) at core/yade.cpp:242
> #0  0xffffe410 in __kernel_vsyscall ()
> (gdb)
> (gdb) q
> The program is running.  Quit anyway (and detach it)? (y or n) y
>
>
>
>
> But I think I made it work with >>> p.generator="SDECSpheresPlane"
> The simulation was running, only things that didn't work was:
>
>   
>>>> v=View()
>>>>         
>
> Opened a view, but with unrefreshable remnants of QTFileGenerator
> inside (the same that we see in QtGUI). Maybe it was simply in that
> part of memory, not something that current session created. And lots
> of errors:
>
> QGLContext::makeCurrent(): Failed.
>
> I remember this error. We had it, and yade was frequently crashing.
> Olivier's laptop was hanging sometimes. And later I've found some
> solution for that and it works cleanly now. I forgot what it was....
> gotta look into SVN history for that.
>
> I remember you talking something about pyView() so I tried:
>
>   
>>>> v=pyView()
>>>>         
> Traceback (most recent call last):
>   File "<console>", line 1, in ?
> NameError: name 'pyView' is not defined
>
> But nothing,
>
> And finally - crash at exit:
>
>
>
>   
>>>> QGLContext::makeCurrent(): Failed.
>>>>         
> sys.exit(0)
> SIGSEGV/SIGABRT handler called; gdb batch file is `/home/janek/.yade-svn1246-moment_law2/gdb_crash_batch-pid24230'
> janek at szpak:~/20-Programowanie/10-cpp/50-Yade/Bin/moment_law2/bin$ GNU gdb 6.4.90-debian
> Copyright (C) 2006 Free Software Foundation, Inc.
> GDB is free software, covered by the GNU General Public License, and you are
> welcome to change it and/or distribute copies of it under certain conditions.
> Type "show copying" to see the conditions.
> There is absolutely no warranty for GDB.  Type "show warranty" for details.
> This GDB was configured as "i486-linux-gnu".
> /home/janek/.yade-svn1246-moment_law2/gdb_crash_batch-pid24230:1: Error in sourced command file:
> ptrace: No such process.
> (gdb) q
> zsh: command not found: q
>
>
> Looks like gdb tried to start, but failed: ptrace: No such process. I
> hope that you can distinguish copy/pastes from my comments ;-)
>
>
>   



From bruno.chareyre at hmg.inpg.fr  Fri Feb 15 17:16:54 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Fri, 15 Feb 2008 17:16:54 +0100
Subject: [yade-dev] Triaxial classes "cerr" output
In-Reply-To: <47ADC51B.1030207@arcig.cz>
References: <47AA0CF7.3010807@hmg.inpg.fr> <47ADC51B.1030207@arcig.cz>
Message-ID: <47B5BAF6.9060000@hmg.inpg.fr>

It looks like cerr messages are still not displayed.

Bruno


V?clav S a ?crit :
> Sorry, fixed in svn1243. V.
>   
>> Hey Va?lav,
>>
>> I'm sure you are doing a good job with triaxial classes, but... well... 
>> I just found an exception ;-)
>> Almost everybody using triaxial stuff SHOULD need the unbalancedForce 
>> parameter printed somewhere, during confinment, during compression, 
>> anytime in fact, and without the GUI you need it even more badly; 
>> because its the only way to check that you are simulating a mechanical 
>> test and not the random explosion of random pieces of shit.
>> Then, I just realized that you removed "cerr << "UnbalancedForce=" << 
>> UnbalancedForce << endl;" at line 68 of TriaxialCompressionEngine.
>> Could you please revert that on SVN?
>>
>> Are you planning to remove all cerr messages?
>> Let us try and speak about that on irc later.
>>
>> Bruno
>>
>>
>>
>>   
>>     
>
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Fri Feb 15 17:25:57 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Fri, 15 Feb 2008 17:25:57 +0100
Subject: [yade-dev] Triaxial classes "cerr" output
In-Reply-To: <47B5BAF6.9060000@hmg.inpg.fr>
References: <47AA0CF7.3010807@hmg.inpg.fr> <47ADC51B.1030207@arcig.cz>
	<47B5BAF6.9060000@hmg.inpg.fr>
Message-ID: <47B5BD15.3020005@hmg.inpg.fr>

Ok, I'm puting some "cerr" again at different places. Please don't 
remove them this time.
I need them for debugging (I guess you use all those "LOG" instructions 
for that but I don't know how to work with it).

Bruno
 

Bruno Chareyre a ?crit :
> It looks like cerr messages are still not displayed.
>
> Bruno
>
>
> V?clav S a ?crit :
>   
>> Sorry, fixed in svn1243. V.
>>   
>>     
>>> Hey Va?lav,
>>>
>>> I'm sure you are doing a good job with triaxial classes, but... well... 
>>> I just found an exception ;-)
>>> Almost everybody using triaxial stuff SHOULD need the unbalancedForce 
>>> parameter printed somewhere, during confinment, during compression, 
>>> anytime in fact, and without the GUI you need it even more badly; 
>>> because its the only way to check that you are simulating a mechanical 
>>> test and not the random explosion of random pieces of shit.
>>> Then, I just realized that you removed "cerr << "UnbalancedForce=" << 
>>> UnbalancedForce << endl;" at line 68 of TriaxialCompressionEngine.
>>> Could you please revert that on SVN?
>>>
>>> Are you planning to remove all cerr messages?
>>> Let us try and speak about that on irc later.
>>>
>>> Bruno
>>>
>>>
>>>
>>>   
>>>     
>>>       
>> _______________________________________________
>> yade-dev mailing list
>> yade-dev at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/yade-dev
>>
>>   
>>     
>
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From janek_listy at wp.pl  Fri Feb 15 17:36:09 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Fri, 15 Feb 2008 17:36:09 +0100
Subject: [yade-dev] dt meddling.
Message-ID: <20080215173609.04600769@szpak>

svn 1248 seemingly random, when loadinf .xml generates this error:

Bad Attribute value (bad lexical_cast), Tag: "rootBody", Attribute:
"recoverSimulationTime", Line: 2518

-- 
Janek Kozicki                                                         |


From janek_listy at wp.pl  Fri Feb 15 17:43:03 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Fri, 15 Feb 2008 17:43:03 +0100
Subject: [yade-dev] dt meddling.
In-Reply-To: <20080215173609.04600769@szpak>
References: <20080215173609.04600769@szpak>
Message-ID: <20080215174303.7f7dac81@szpak>

Janek Kozicki said:     (by the date of Fri, 15 Feb 2008 17:36:09 +0100)

> svn 1248 seemingly random, when loadinf .xml generates this error:

ok, fixed in 1249. It was "nan" in .xml.


-- 
Janek Kozicki                                                         |


From janek_listy at wp.pl  Fri Feb 15 18:11:05 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Fri, 15 Feb 2008 18:11:05 +0100
Subject: [yade-dev] [Yade-commits] r1247 - in trunk: yade.cpp
In-Reply-To: <200802151612.m1FGCAFT026604@sheep.berlios.de>
References: <200802151612.m1FGCAFT026604@sheep.berlios.de>
Message-ID: <20080215181105.5a96abc2@szpak>

> +#if BOOST_VERSION > 103400

to be precise this problem arised due to 

core/yade.cpp:94: error: 'is_regular' is not a member of 'boost::filesystem'

is_regular was added in 1.34.

-- 
Janek Kozicki                                                         |


From Bruno.Chareyre at bvra.inpg.fr  Fri Feb 15 20:21:51 2008
From: Bruno.Chareyre at bvra.inpg.fr (Chareyre Bruno)
Date: Fri, 15 Feb 2008 20:21:51 +0100
Subject: [yade-dev] Triaxial classes "cerr" output
Message-ID: <98A90BEE3EE7E54680B190558276253BA5D818@GREXCHESV1.bvra.fr>


Va?lav, I suggest that when you modify some code I've written, you don't remove lines you don't want but comment them instead.
Something is broken in the TimeStepper, or in the StressController, I don't know exactly, and I just spent more than one hour trying to drop cerr's in the correct places for debugging. It means that I spent time typing code that I already typed months ago. Uncommenting would have been a lot easier...

Also note that I reversed one of your change in GlobalStiffnessCounter.cpp l. 56  :

 if(fn==0) return false;//This test really means "is it zero?", not "is it smaller than epsilon?"

I didn't reverse the tests in the other function for non-spherical bodies, but it should probably be the same.
 

Bruno
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080215/13ac0c25/attachment.html>

From eudoxos at arcig.cz  Mon Feb 18 12:23:12 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Mon, 18 Feb 2008 12:23:12 +0100
Subject: [yade-dev] Triaxial classes "cerr" output
In-Reply-To: <98A90BEE3EE7E54680B190558276253BA5D818@GREXCHESV1.bvra.fr>
References: <98A90BEE3EE7E54680B190558276253BA5D818@GREXCHESV1.bvra.fr>
Message-ID: <47B96AA0.9090508@arcig.cz>

Bruno, I am sorry for regressions I introduced - I was away since
thursday and couldn't react. The LOG_* stuff doesn't work for you?
LOG_INFO and higer (WARN, ERROR and FATAL) are converted to
cerr<<message<<endl if you don't have log4cxx, so you should be able to
see those. Regards, Vaclav
>
> Va?lav, I suggest that when you modify some code I've written, you
> don't remove lines you don't want but comment them instead.
> Something is broken in the TimeStepper, or in the StressController, I
> don't know exactly, and I just spent more than one hour trying to drop
> cerr's in the correct places for debugging. It means that I spent time
> typing code that I already typed months ago. Uncommenting would have
> been a lot easier...
>
> Also note that I reversed one of your change in
> GlobalStiffnessCounter.cpp l. 56  :
>
>  if(fn==0) return false;//This test really means "is it zero?", not
> "is it smaller than epsilon?"
>
> I didn't reverse the tests in the other function for non-spherical
> bodies, but it should probably be the same.
>
>
> Bruno
>
> ------------------------------------------------------------------------
>
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>   



From eudoxos at arcig.cz  Mon Feb 18 12:25:30 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Mon, 18 Feb 2008 12:25:30 +0100
Subject: [yade-dev] trying cmdGui
In-Reply-To: <20080213181635.394395ea@szpak>
References: <20080213040916.4cf6084f@szpak>
	<47B30B6D.9060408@arcig.cz>	<20080213170317.314b5acc@szpak>
	<20080213181635.394395ea@szpak>
Message-ID: <47B96B2A.1000108@arcig.cz>

Janek, I hope it works now for you. I converted the exception into a
plain error message on the console and the simulation continues. Vaclav



From bruno.chareyre at hmg.inpg.fr  Mon Feb 18 15:34:32 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Mon, 18 Feb 2008 15:34:32 +0100
Subject: [yade-dev] Triaxial classes "cerr" output
In-Reply-To: <47B96AA0.9090508@arcig.cz>
References: <98A90BEE3EE7E54680B190558276253BA5D818@GREXCHESV1.bvra.fr>
	<47B96AA0.9090508@arcig.cz>
Message-ID: <47B99778.2080303@hmg.inpg.fr>

V?clav S a ?crit :
> Bruno, I am sorry for regressions I introduced - I was away since
> thursday and couldn't react. The LOG_* stuff doesn't work for you?
> LOG_INFO and higer (WARN, ERROR and FATAL) are converted to
> cerr<<message<<endl if you don't have log4cxx, so you should be able to
> see those. Regards, Vaclav
>   
Ok. So there must be a small bug somewhere because I see nothing. 
scons.config contains this :

features = 'log4cxx,python'

Do you think I should disable log4cxx to get messages? It would sound 
bizzare...
And in case I use log4cxx feature, how to tune the output I get?

Bruno




>> Va?lav, I suggest that when you modify some code I've written, you
>> don't remove lines you don't want but comment them instead.
>> Something is broken in the TimeStepper, or in the StressController, I
>> don't know exactly, and I just spent more than one hour trying to drop
>> cerr's in the correct places for debugging. It means that I spent time
>> typing code that I already typed months ago. Uncommenting would have
>> been a lot easier...
>>
>> Also note that I reversed one of your change in
>> GlobalStiffnessCounter.cpp l. 56  :
>>
>>  if(fn==0) return false;//This test really means "is it zero?", not
>> "is it smaller than epsilon?"
>>
>> I didn't reverse the tests in the other function for non-spherical
>> bodies, but it should probably be the same.
>>
>>
>> Bruno
>>
>> ------------------------------------------------------------------------
>>
>> _______________________________________________
>> yade-dev mailing list
>> yade-dev at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/yade-dev
>>   
>>     
>
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Mon Feb 18 16:41:35 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Mon, 18 Feb 2008 16:41:35 +0100
Subject: [yade-dev] Triaxial classes "cerr" output
In-Reply-To: <47B99778.2080303@hmg.inpg.fr>
References: <98A90BEE3EE7E54680B190558276253BA5D818@GREXCHESV1.bvra.fr>	<47B96AA0.9090508@arcig.cz>
	<47B99778.2080303@hmg.inpg.fr>
Message-ID: <47B9A72F.5060104@arcig.cz>


>> The LOG_* stuff doesn't work for you?
>> LOG_INFO and higer (WARN, ERROR and FATAL) are converted to
>> cerr<<message<<endl if you don't have log4cxx, so you should be able to
>> see those. Regards, Vaclav  
>>     
> Ok. So there must be a small bug somewhere because I see nothing. 
> scons.config contains this :
>
> features = 'log4cxx,python'
>
> Do you think I should disable log4cxx to get messages? It would sound 
> bizzare...
> And in case I use log4cxx feature, how to tune the output I get?
>   
Keep log4cxx enabled, that is OK. Have a look at the file
doc/logging.conf.sample in trunk and copy it over to
~/.yade-$VERSION/logging.conf (the same directory where is your
preferences.xml and other files). I tried to put comments into that file
so that it is clear what is going on. If you say

 log4j.logger.yade.TriaxialCompressionEngine=DEBUG

you will see all messages from TriaxialCompressionEngine, for example.

Vaclav


From janek.kozicki at hmg.inpg.fr  Mon Feb 18 16:45:49 2008
From: janek.kozicki at hmg.inpg.fr (Janek Kozicki)
Date: Mon, 18 Feb 2008 16:45:49 +0100
Subject: [yade-dev] test
Message-ID: <20080218164549.22cdb132@szpak>

I'm testing if yade-dev will accept all senders from ^.*inpg.fr

-- 
# Janek Kozicki


From bruno.chareyre at hmg.inpg.fr  Mon Feb 18 18:10:51 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Mon, 18 Feb 2008 18:10:51 +0100
Subject: [yade-dev] TriaxialTest is broken in current SVN
Message-ID: <47B9BC1B.8010901@hmg.inpg.fr>

1. Launch Yade
2. Create a TriaxialTest example, setting autoCompressionActivation = true
3. Start the simulation
4. Watch the compaction stage
5. See the spheres disapearing when compression is supposed toi start

I now set autoCompressionActivatuin = true by default, so that the 
default TriaxialTest is a good regression test.

Also, I noticed that interaction types are SDECLinks in the triaxial 
test, which is not supposed to happen.

Bruno

-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Mon Feb 18 21:26:11 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Mon, 18 Feb 2008 21:26:11 +0100
Subject: [yade-dev] TriaxialTest is broken in current SVN
In-Reply-To: <47B9BC1B.8010901@hmg.inpg.fr>
References: <47B9BC1B.8010901@hmg.inpg.fr>
Message-ID: <47B9E9E3.7080102@arcig.cz>

>
> 4. Watch the compaction stage
> 5. See the spheres disapearing when compression is supposed toi start
>
> Also, I noticed that interaction types are SDECLinks in the triaxial 
> test, which is not supposed to happen.
>   

Huh, that is my fault again. TriaxialCompressionEngine:86 should be
if(0), not if(1); and the whole block can be effectively deleted. It was
an experimental stuff to test what happens if I glue particles together
after compaction.  I just commited the fix.

Do you have some precise idea what the regression test will look like?
Notably, what will be the reference value checked after the run.

V.



From bruno.chareyre at hmg.inpg.fr  Tue Feb 19 15:13:50 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Tue, 19 Feb 2008 15:13:50 +0100
Subject: [yade-dev] TriaxialTest is broken in current SVN
In-Reply-To: <47B9E9E3.7080102@arcig.cz>
References: <47B9BC1B.8010901@hmg.inpg.fr> <47B9E9E3.7080102@arcig.cz>
Message-ID: <47BAE41E.3030102@hmg.inpg.fr>

I


V?clav S a ?crit :
>> 4. Watch the compaction stage
>> 5. See the spheres disapearing when compression is supposed toi start
>>
>> Also, I noticed that interaction types are SDECLinks in the triaxial 
>> test, which is not supposed to happen.
>>   
>>     
>
> Huh, that is my fault again. TriaxialCompressionEngine:86 should be
> if(0), not if(1); and the whole block can be effectively deleted. It was
> an experimental stuff to test what happens if I glue particles together
> after compaction.  I just commited the fix.
>   
Ok. Does it fix the SDECLink problem?
TriaxialTest.cpp was also using elasticContactLaw and 
elasticCohesiveContactLaw at the same time, I don't know if you or me 
commited that but I reverted that and will commit soon : TriaxialTest is 
not supposed to be cohesive + 2 simultaneous contact laws makes no sense.

> Do you have some precise idea what the regression test will look like?
> Notably, what will be the reference value checked after the run.
>
>   
I think the value of stress and strain after X iterations + the peak 
stress value would make good tests. If they don't change you can be sure 
that the physics and mathematics in Yade were not affected, because they 
result from very complex processes, highly sensitive to initial 
conditions (Lorentz sort of).

The only thing is we need to swith from random positioning to a text 
file, I still have to create this file and to get the code for loading 
positions back.

Bruno




> V.
>
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Tue Feb 19 15:35:52 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 19 Feb 2008 15:35:52 +0100
Subject: [yade-dev] TriaxialTest is broken in current SVN
In-Reply-To: <47BAE41E.3030102@hmg.inpg.fr>
References: <47B9BC1B.8010901@hmg.inpg.fr> <47B9E9E3.7080102@arcig.cz>
	<47BAE41E.3030102@hmg.inpg.fr>
Message-ID: <47BAE948.70708@arcig.cz>

Don't go too far with code loading spheres, have a look at
Shop::loadSpheresFromFile (just returns pairs of center-radius); and
Shop::saveSpheresToFile. Vaclav
> I
>
>
> V?clav S a ?crit :
>   
>>> 4. Watch the compaction stage
>>> 5. See the spheres disapearing when compression is supposed toi start
>>>
>>> Also, I noticed that interaction types are SDECLinks in the triaxial 
>>> test, which is not supposed to happen.
>>>   
>>>     
>>>       
>> Huh, that is my fault again. TriaxialCompressionEngine:86 should be
>> if(0), not if(1); and the whole block can be effectively deleted. It was
>> an experimental stuff to test what happens if I glue particles together
>> after compaction.  I just commited the fix.
>>   
>>     
> Ok. Does it fix the SDECLink problem?
> TriaxialTest.cpp was also using elasticContactLaw and 
> elasticCohesiveContactLaw at the same time, I don't know if you or me 
> commited that but I reverted that and will commit soon : TriaxialTest is 
> not supposed to be cohesive + 2 simultaneous contact laws makes no sense.
>
>   
>> Do you have some precise idea what the regression test will look like?
>> Notably, what will be the reference value checked after the run.
>>
>>   
>>     
> I think the value of stress and strain after X iterations + the peak 
> stress value would make good tests. If they don't change you can be sure 
> that the physics and mathematics in Yade were not affected, because they 
> result from very complex processes, highly sensitive to initial 
> conditions (Lorentz sort of).
>
> The only thing is we need to swith from random positioning to a text 
> file, I still have to create this file and to get the code for loading 
> positions back.
>
> Bruno
>
>
>
>
>   
>> V.
>>
>> _______________________________________________
>> yade-dev mailing list
>> yade-dev at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/yade-dev
>>
>>   
>>     
>
>
>   



From bruno.chareyre at hmg.inpg.fr  Tue Feb 19 16:12:00 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Tue, 19 Feb 2008 16:12:00 +0100
Subject: [yade-dev] TriaxialTest is broken in current SVN
In-Reply-To: <47BAE948.70708@arcig.cz>
References: <47B9BC1B.8010901@hmg.inpg.fr>
	<47B9E9E3.7080102@arcig.cz>	<47BAE41E.3030102@hmg.inpg.fr>
	<47BAE948.70708@arcig.cz>
Message-ID: <47BAF1C0.7010800@hmg.inpg.fr>





V?clav S a ?crit :
> Don't go too far with code loading spheres, have a look at
> Shop::loadSpheresFromFile (just returns pairs of center-radius); and
> Shop::saveSpheresToFile. Vaclav
>   
Ok, I will look at this.

I had this with last revision :

155 [3056965904] FATAL yade.Omega  - core/Omega.cpp:252 scanPlugins: 
Undefined symbol `vtable for GLDrawBrefcomContact' 
(/home/bruno/YADE/lib/yade-svn1257/pkg-dem/libGlobalStiffnessCounter.so: 
undefined symbol: _ZTV20GLDrawBrefcomContact).
298 [3056965904] FATAL yade.Omega  - core/Omega.cpp:252 scanPlugins: 
Undefined symbol `vtable for GLDrawBrefcomContact' 
(/home/bruno/YADE/lib/yade-svn1257/pkg-dem/libGlobalStiffnessCounter.so: 
undefined symbol: _ZTV20GLDrawBrefcomContact).
348 [3056965904] FATAL yade.Omega  - core/Omega.cpp:252 scanPlugins: 
Undefined symbol `vtable for GLDrawBrefcomContact' 
(/home/bruno/YADE/lib/yade-svn1257/pkg-dem/libGlobalStiffnessCounter.so: 
undefined symbol: _ZTV20GLDrawBrefcomContact).
358 [3056965904] FATAL yade.Omega  - core/Omega.cpp:252 scanPlugins: 
Undefined symbol `vtable for GLDrawBrefcomContact' 
(/home/bruno/YADE/lib/yade-svn1257/pkg-dem/libGlobalStiffnessCounter.so: 
undefined symbol: _ZTV20GLDrawBrefcomContact).
364 [3056965904] FATAL yade.Omega  - core/Omega.cpp:252 scanPlugins: 
Undefined symbol `vtable for GLDrawBrefcomContact' 
(/home/bruno/YADE/lib/yade-svn1257/pkg-dem/libGlobalStiffnessCounter.so: 
undefined symbol: _ZTV20GLDrawBrefcomContact).
433 [3056965904] FATAL yade.Omega  - core/Omega.cpp:252 scanPlugins: 
Undefined symbol `vtable for GLDrawBrefcomContact' 
(/home/bruno/YADE/lib/yade-svn1257/pkg-dem/libGlobalStiffnessCounter.so: 
undefined symbol: _ZTV20GLDrawBrefcomContact).
464 [3056965904] WARN yade.Omega  - core/Omega.cpp:267 scanPlugins: 
Couldn't load everything, some stuff may work incorrectly.
X Error: BadDevice, invalid or uninitialized input device




>> I
>>
>>
>> V?clav S a ?crit :
>>   
>>     
>>>> 4. Watch the compaction stage
>>>> 5. See the spheres disapearing when compression is supposed toi start
>>>>
>>>> Also, I noticed that interaction types are SDECLinks in the triaxial 
>>>> test, which is not supposed to happen.
>>>>   
>>>>     
>>>>       
>>>>         
>>> Huh, that is my fault again. TriaxialCompressionEngine:86 should be
>>> if(0), not if(1); and the whole block can be effectively deleted. It was
>>> an experimental stuff to test what happens if I glue particles together
>>> after compaction.  I just commited the fix.
>>>   
>>>     
>>>       
>> Ok. Does it fix the SDECLink problem?
>> TriaxialTest.cpp was also using elasticContactLaw and 
>> elasticCohesiveContactLaw at the same time, I don't know if you or me 
>> commited that but I reverted that and will commit soon : TriaxialTest is 
>> not supposed to be cohesive + 2 simultaneous contact laws makes no sense.
>>
>>   
>>     
>>> Do you have some precise idea what the regression test will look like?
>>> Notably, what will be the reference value checked after the run.
>>>
>>>   
>>>     
>>>       
>> I think the value of stress and strain after X iterations + the peak 
>> stress value would make good tests. If they don't change you can be sure 
>> that the physics and mathematics in Yade were not affected, because they 
>> result from very complex processes, highly sensitive to initial 
>> conditions (Lorentz sort of).
>>
>> The only thing is we need to swith from random positioning to a text 
>> file, I still have to create this file and to get the code for loading 
>> positions back.
>>
>> Bruno
>>
>>
>>
>>
>>   
>>     
>>> V.
>>>
>>> _______________________________________________
>>> yade-dev mailing list
>>> yade-dev at lists.berlios.de
>>> https://lists.berlios.de/mailman/listinfo/yade-dev
>>>
>>>   
>>>     
>>>       
>>   
>>     
>
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Tue Feb 19 16:21:14 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Tue, 19 Feb 2008 16:21:14 +0100
Subject: [yade-dev] TriaxialTest is broken in current SVN
In-Reply-To: <47BAE948.70708@arcig.cz>
References: <47B9BC1B.8010901@hmg.inpg.fr>
	<47B9E9E3.7080102@arcig.cz>	<47BAE41E.3030102@hmg.inpg.fr>
	<47BAE948.70708@arcig.cz>
Message-ID: <47BAF3EA.9030104@hmg.inpg.fr>

Va?lav,

Could you explain what you are doing with SDECLinks please?
I feel like you are going to use permanent link for your new law... is 
that true?

Bruno


V?clav S a ?crit :
> Don't go too far with code loading spheres, have a look at
> Shop::loadSpheresFromFile (just returns pairs of center-radius); and
> Shop::saveSpheresToFile. Vaclav
>   
>> I
>>
>>
>> V?clav S a ?crit :
>>   
>>     
>>>> 4. Watch the compaction stage
>>>> 5. See the spheres disapearing when compression is supposed toi start
>>>>
>>>> Also, I noticed that interaction types are SDECLinks in the triaxial 
>>>> test, which is not supposed to happen.
>>>>   
>>>>     
>>>>       
>>>>         
>>> Huh, that is my fault again. TriaxialCompressionEngine:86 should be
>>> if(0), not if(1); and the whole block can be effectively deleted. It was
>>> an experimental stuff to test what happens if I glue particles together
>>> after compaction.  I just commited the fix.
>>>   
>>>     
>>>       
>> Ok. Does it fix the SDECLink problem?
>> TriaxialTest.cpp was also using elasticContactLaw and 
>> elasticCohesiveContactLaw at the same time, I don't know if you or me 
>> commited that but I reverted that and will commit soon : TriaxialTest is 
>> not supposed to be cohesive + 2 simultaneous contact laws makes no sense.
>>
>>   
>>     
>>> Do you have some precise idea what the regression test will look like?
>>> Notably, what will be the reference value checked after the run.
>>>
>>>   
>>>     
>>>       
>> I think the value of stress and strain after X iterations + the peak 
>> stress value would make good tests. If they don't change you can be sure 
>> that the physics and mathematics in Yade were not affected, because they 
>> result from very complex processes, highly sensitive to initial 
>> conditions (Lorentz sort of).
>>
>> The only thing is we need to swith from random positioning to a text 
>> file, I still have to create this file and to get the code for loading 
>> positions back.
>>
>> Bruno
>>
>>
>>
>>
>>   
>>     
>>> V.
>>>
>>> _______________________________________________
>>> yade-dev mailing list
>>> yade-dev at lists.berlios.de
>>> https://lists.berlios.de/mailman/listinfo/yade-dev
>>>
>>>   
>>>     
>>>       
>>   
>>     
>
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Tue Feb 19 16:55:13 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Tue, 19 Feb 2008 16:55:13 +0100
Subject: [yade-dev] TriaxialTest is broken in current SVN
In-Reply-To: <47BAE948.70708@arcig.cz>
References: <47B9BC1B.8010901@hmg.inpg.fr>
	<47B9E9E3.7080102@arcig.cz>	<47BAE41E.3030102@hmg.inpg.fr>
	<47BAE948.70708@arcig.cz>
Message-ID: <47BAFBE1.7020405@hmg.inpg.fr>

To balance some of previous mails : I just had a look at the doxygen doc 
(about TriaxialTest).
That is really nice! :-) Congrats Va?lav for making all this automatic.
New users can find there a good entry point to understand what is 
happening in Yade. I'm slowly commenting more and more.

Just one comment, inheritence tree could be moved at the end of pages 
(html version) or even perhaps removed from the first class page (I bet 
the current behaviour is default though). It is too big to be readable 
and the risk is that people won't browse past this to see comments at 
the bottom of pages (see for instance the page about TriaxialTest).

Bruno


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Tue Feb 19 17:08:06 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Tue, 19 Feb 2008 17:08:06 +0100
Subject: [yade-dev] Missing pageson the wiki
Message-ID: <47BAFEE6.8040205@hmg.inpg.fr>

I guess this is not intentional : pages about profiling have been 
removed from the wiki.
See :

http://yade.wikia.com/wiki/Debugging_and_speed_profiling

Bruno
-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Tue Feb 19 17:55:31 2008
From: eudoxos at arcig.cz (=?windows-1252?Q?V=E1clav_=8Amilauer?=)
Date: Tue, 19 Feb 2008 17:55:31 +0100
Subject: [yade-dev] Missing pageson the wiki
In-Reply-To: <47BAFEE6.8040205@hmg.inpg.fr>
References: <47BAFEE6.8040205@hmg.inpg.fr>
Message-ID: <47BB0A03.4070409@arcig.cz>


> I guess this is not intentional : pages about profiling have been 
> removed from the wiki.
> See :
>
> http://yade.wikia.com/wiki/Debugging_and_speed_profiling
>   
The page never existed, I will put some initial stuff there (about 
compilation). You can go on and say something about valgrind then. V.


From bruno.chareyre at hmg.inpg.fr  Tue Feb 19 18:03:33 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Tue, 19 Feb 2008 18:03:33 +0100
Subject: [yade-dev] Missing pageson the wiki
In-Reply-To: <47BB0A03.4070409@arcig.cz>
References: <47BAFEE6.8040205@hmg.inpg.fr> <47BB0A03.4070409@arcig.cz>
Message-ID: <47BB0BE5.1020309@hmg.inpg.fr>


>> I guess this is not intentional : pages about profiling have been 
>> removed from the wiki.
>> See :
>>
>> http://yade.wikia.com/wiki/Debugging_and_speed_profiling
>>   
>>     
> The page never existed, I will put some initial stuff there (about 
> compilation). You can go on and say something about valgrind then. V.
>   
There is something already, it is from the berlios website and it is in 
in the wiki :

http://yade.wikia.com/wiki/Speed_profiling_using_KCachegrind

perhaps there is even more.




> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Wed Feb 20 13:05:09 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Wed, 20 Feb 2008 13:05:09 +0100
Subject: [yade-dev] getting rid of ../data
Message-ID: <47BC1775.60806@arcig.cz>

Hi everybody, I am planning to remove any references to this ugly
../data thing. All files will be created in the current working
directory (instead of ../data), as sane programs do. Is that OK with
most of us? Regards, Vaclav


From janek_listy at wp.pl  Wed Feb 20 20:25:36 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Wed, 20 Feb 2008 20:25:36 +0100
Subject: [yade-dev] getting rid of ../data
In-Reply-To: <47BC1775.60806@arcig.cz>
References: <47BC1775.60806@arcig.cz>
Message-ID: <20080220202536.10f622f0@absurd>

V?clav ?milauer said:     (by the date of Wed, 20 Feb 2008 13:05:09 +0100)

> Hi everybody, I am planning to remove any references to this ugly
> ../data thing. All files will be created in the current working
> directory (instead of ../data), as sane programs do. Is that OK with
> most of us? Regards, Vaclav

yeah, go on. That was Olivier's idea :>

-- 
Janek Kozicki                                                         |


From bruno.chareyre at hmg.inpg.fr  Thu Feb 21 15:21:31 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Thu, 21 Feb 2008 15:21:31 +0100
Subject: [yade-dev] getting rid of ../data
In-Reply-To: <47BC1775.60806@arcig.cz>
References: <47BC1775.60806@arcig.cz>
Message-ID: <47BD88EB.7070905@hmg.inpg.fr>

No problemo.

Bruno

V?clav ?milauer a ?crit :
> Hi everybody, I am planning to remove any references to this ugly
> ../data thing. All files will be created in the current working
> directory (instead of ../data), as sane programs do. Is that OK with
> most of us? Regards, Vaclav
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From janek_listy at wp.pl  Thu Feb 21 18:07:16 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Thu, 21 Feb 2008 18:07:16 +0100
Subject: [yade-dev] getting rid of ../data
In-Reply-To: <20080220202536.10f622f0@absurd>
References: <47BC1775.60806@arcig.cz>
	<20080220202536.10f622f0@absurd>
Message-ID: <20080221180716.670378b8@absurd>

Janek Kozicki said:     (by the date of Wed, 20 Feb 2008 20:25:36 +0100)

> yeah, go on. That was Olivier's idea :>

Oh Vaclav, you must keep two things still working:

- installing yade in $HOME (not in /usr/local)
- and installing several copies of yade

Ideally, I both commands should just work:

 cd ~/snow/creep/test1 ; yade-svn1450
 cd ~/concrete/tension/results1 ; yade-svn1400

So in this scenario all versions of yade-svn* are installed in my $PATH
(eg. in ~/bin/) but still not in /usr/local 


-- 
Janek Kozicki                                                         |


From bruno.chareyre at hmg.inpg.fr  Thu Feb 21 19:53:09 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Thu, 21 Feb 2008 19:53:09 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
	profiling results
Message-ID: <47BDC895.8010608@hmg.inpg.fr>

Hi guys

After a carefull inspection of valgrind outputs, I came to the 
conclusion that

(1) this line :

for(InteractionContainer::iterator I=interactions->begin(); 
I!=interactions->end(); ++I)

is not optimized with my compiler. It means that interactions->end() 
will be executed at each iteration, and it needs a lot of time in loops.

(2) Even worse, in this code from PhysicalActionVectorVector.cpp :

shared_ptr<PhysicalAction>& PhysicalActionVectorVector::find(unsigned 
int id , int actionIndex )
{
    if( physicalActions.size() <= id ) // this is very rarely executed, 
only at beginning.
    // somebody is accesing out of bounds, make sure he will find, what 
he needs - a resetted PhysicalAction of his type
    { ....


the size of physicalActions WILL BE COMPUTED each time somebody type 
physicalActions.find(i,j) !!! As a result, size() is executed around 
4500 times per timestep in a TriaxialTest with 400 spheres, which 
represents around 20% of the cost of a function like 
ElasticContactLaw.action().


(3) actionStiffness->getClassIndex() is always executed too. It is 
better to add a member data stiffnessIndex to the engine, then define it 
only once as stiffnessIndex=actionStiffness->getClassIndex() in the 
constructor, and finally use stiffnessIndex for internal tests instead 
of getClassIndex(). 


I'm a bit surprised because I thought the compiler would fix all that 
alone. It looks like it doesn't. I don't know if this is because of 
debug symbols or something else limiting optimization (what is the 
optimization level whith scons flag "optimization=True", is it 
equivalent to -O3?).
Afer fixing things here and there concerning those 3 points above (e.g. 
I added a member data called "size" to the container to avoid computing 
it all the time), I could run the triaxial test around 25% faster.
I can commit those changes soon, I'm curious to know the results on 
other computers.

Bruno







 

-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Thu Feb 21 20:04:52 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Thu, 21 Feb 2008 20:04:52 +0100
Subject: [yade-dev] getting rid of ../data
In-Reply-To: <20080221180716.670378b8@absurd>
References: <47BC1775.60806@arcig.cz>	<20080220202536.10f622f0@absurd>
	<20080221180716.670378b8@absurd>
Message-ID: <47BDCB54.5000701@arcig.cz>


>> yeah, go on. That was Olivier's idea :>
>>     
>
> Oh Vaclav, you must keep two things still working:
>
> - installing yade in $HOME (not in /usr/local)
> - and installing several copies of yade
>
> Ideally, I both commands should just work:
>
>  cd ~/snow/creep/test1 ; yade-svn1450
>  cd ~/concrete/tension/results1 ; yade-svn1400
>   
That is OK, it will continue to work as long as you have that bin
directory in your path. But install to /usr/local will nevertheless be
the default. (Which is by the way what I recommend anyway, since
/usr/local/bin is in path normally and if you have your own workstation,
you can just do "chown user: -R /usr/local" and have that dir for you
forever.)


From janek_listy at wp.pl  Thu Feb 21 20:52:39 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Thu, 21 Feb 2008 20:52:39 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47BDC895.8010608@hmg.inpg.fr>
References: <47BDC895.8010608@hmg.inpg.fr>
Message-ID: <20080221205239.68c2695b@absurd>

Bruno Chareyre said:     (by the date of Thu, 21 Feb 2008 19:53:09 +0100)

> Hi guys
> 
> After a carefull inspection of valgrind outputs, I came to the 
> conclusion that
> 
> (1) this line :
> 
> for(InteractionContainer::iterator I=interactions->begin(); 
> I!=interactions->end(); ++I)

ok, this one is easy - just declare another variable before the loop,

InteractionContainer::iterator e=interactions->end();
 for(InteractionContainer::iterator I=interactions->begin(); I!=e; ++I)

I suppose this is how you fixed it?


> (2) Even worse, in this code from PhysicalActionVectorVector.cpp :
> 
> shared_ptr<PhysicalAction>& PhysicalActionVectorVector::find(unsigned 
> int id , int actionIndex )
> {
>     if( physicalActions.size() <= id ) // this is very rarely executed, 
> only at beginning.
>     // somebody is accesing out of bounds, make sure he will find, what 
> he needs - a resetted PhysicalAction of his type
>     { ....
> 
> 
> the size of physicalActions WILL BE COMPUTED each time somebody type 
> physicalActions.find(i,j) !!! As a result, size() is executed around 
> 4500 times per timestep in a TriaxialTest with 400 spheres, which 
> represents around 20% of the cost of a function like 
> ElasticContactLaw.action().


so you have added member data called "size" to physicalActions ?
Did you check carefully to increment and decrement it everytime when
new data is added/removed? You know - if it gets out of sync with the
"real size" we will get many crashes, and it will be difficult to
find out why.
 
 
> (3) actionStiffness->getClassIndex() is always executed too. It is 
> better to add a member data stiffnessIndex to the engine, then define it 
> only once as stiffnessIndex=actionStiffness->getClassIndex() in the 
> constructor, and finally use stiffnessIndex for internal tests instead 
> of getClassIndex(). 

getClassIndex() returns only a member static variable of a class.
I can't belive that it will be faster more than 0.5% if you create
another variable and access this one instead of that original static
one. Is that really the case?

Remember that too much optimization results in fast code, which
becomes very difficult to keep without bugs. Donald Knuth in his book
"The Art of Computer Programming", had written "Premature optimization is
the root of all evil". Just be careful.


But anyway, with switching to boost::serialization (real soon now,
like before th eend of March), I will have to reconsider ClassIndex
stuff, becasue boost::serialization also provides this mechanism, so
it may be better to switch to using that one. But I'll have to
investigate it beforehand.



> (what is the optimization level whith scons flag "optimization=True", is it 
> equivalent to -O3?).

if you look into SConscript, you will see that it's '-O3 -ffast-math'


> Afer fixing things here and there concerning those 3 points above (e.g. 
> I added a member data called "size" to the container to avoid computing 
> it all the time), 

in fact you can do whatever you want with the containers, because we
are switching boost::multi_index as soon as I ... do all my non-yade
development work. Uh, I wish I've been paid to work on yade, not some
other unrelated stuff, this is killing me. I want to develop yade
itself but I can't. But everyone is using yade and they need it better.
But now I have to do snow, concrete and that stuff...


> I could run the triaxial test around 25% faster.
> I can commit those changes soon, I'm curious to know the results on 
> other computers.

would be kind of you if you answer to my concerns I mentioned above
before you commit ;-)

I you want to check on other computers - you can use mine. I'll only need
to create an account for you, do you want to?


best regards
-- 
Janek Kozicki                                                         |


From eudoxos at arcig.cz  Fri Feb 22 08:06:34 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Fri, 22 Feb 2008 08:06:34 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <20080221205239.68c2695b@absurd>
References: <47BDC895.8010608@hmg.inpg.fr> <20080221205239.68c2695b@absurd>
Message-ID: <47BE747A.9070603@arcig.cz>


> ok, this one is easy - just declare another variable before the loop,
>
> InteractionContainer::iterator e=interactions->end();
>  for(InteractionContainer::iterator I=interactions->begin(); I!=e; ++I)
>   
I was trying to adapt Yade containers to boost::range recently so that
BOOST_FOREACH would work with them. It does exactly this optimization
(it is called "hoisting", they say) and is much nicer:
foreach(interactions,I){...}. Will retry.

It can't be optimized by the compiler, since the container may change
during the loop body execution... (perhaps I did say once it would...
sorry).
>> (3) actionStiffness->getClassIndex() is always executed too. It is 
>> better to add a member data stiffnessIndex to the engine, then define it 
>> only once as stiffnessIndex=actionStiffness->getClassIndex() in the 
>> constructor, and finally use stiffnessIndex for internal tests instead 
>> of getClassIndex(). 
>>     
>
> getClassIndex() returns only a member static variable of a class.
> I can't belive that it will be faster more than 0.5% if you create
> another variable and access this one instead of that original static
> one. Is that really the case?
>   
getClassIndex is still a virtual function which has some dispatch
overhead, and there is a function call (getClassIndexStatic) inside.
There will be some cost of that.
> "Premature optimization is the root of all evil".
>   
Last time I had flu and headache it was not because of premature
optimization. If that is not "evil", consider 2nd world was, which was
not caused by premature optimization either.
>   
>> (what is the optimization level whith scons flag "optimization=True", is it 
>> equivalent to -O3?).
>>     
>
> if you look into SConscript, you will see that it's '-O3 -ffast-math'
>   
Or if you run scons pretty=0, which will show all commands.
>> Afer fixing things here and there concerning those 3 points above (e.g. 
>> I added a member data called "size" to the container to avoid computing 
>> it all the time), 
>>     
>
> in fact you can do whatever you want with the containers, because we
> are switching boost::multi_index as soon as I ... do all my non-yade
> development work. Uh, I wish I've been paid to work on yade, not some
> other unrelated stuff, this is killing me. I want to develop yade
> itself but I can't. But everyone is using yade and they need it better.
> But now I have to do snow, concrete and that stuff...
>   
Janek, is multi_index random-access in O(1)? That is important if we try
to use openMP, which can parallelize some loops by itself.
>> I could run the triaxial test around 25% faster.
>> I can commit those changes soon, I'm curious to know the results on 
>> other computers.
>>     
Great improvement, Bruno. I will run kcallgrind also, it seems very useful.

V.





From bruno.chareyre at hmg.inpg.fr  Fri Feb 22 14:24:12 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Fri, 22 Feb 2008 14:24:12 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <20080221205239.68c2695b@absurd>
References: <47BDC895.8010608@hmg.inpg.fr> <20080221205239.68c2695b@absurd>
Message-ID: <47BECCFC.7040100@hmg.inpg.fr>


>
> ok, this one is easy - just declare another variable before the loop,
>
> InteractionContainer::iterator e=interactions->end();
>  for(InteractionContainer::iterator I=interactions->begin(); I!=e; ++I)
>
> I suppose this is how you fixed it?
>   
Yes.


>
>
>
> so you have added member data called "size" to physicalActions ?
> Did you check carefully to increment and decrement it everytime when
> new data is added/removed? You know - if it gets out of sync with the
> "real size" we will get many crashes, and it will be difficult to
> find out why.
>  
>   
It should be synchronized. Data is never removed at the moment (we can't 
remove bodies), and only one function can add new data : find(), so this 
function now set "current_size". clear() also set size, just to be sure...


>  
>   
>> (3) actionStiffness->getClassIndex() is always executed too. It is 
>> better to add a member data stiffnessIndex to the engine, then define it 
>> only once as stiffnessIndex=actionStiffness->getClassIndex() in the 
>> constructor, and finally use stiffnessIndex for internal tests instead 
>> of getClassIndex(). 
>>     
>
> getClassIndex() returns only a member static variable of a class.
> I can't belive that it will be faster more than 0.5% if you create
> another variable and access this one instead of that original static
> one. Is that really the case?
>
>   
So perhaps the speedup is only due to the first 2 points.



> Remember that too much optimization results in fast code, which
> becomes very difficult to keep without bugs. Donald Knuth in his book
> "The Art of Computer Programming", had written "Premature optimization is
> the root of all evil". Just be careful.
>
>
>   
Tell Luc Scholtes, who is finishing is PhD and wait days to get results, 
that this is "premature" ;-)


> But anyway, with switching to boost::serialization (real soon now,
> like before th eend of March), I will have to reconsider ClassIndex
> stuff, becasue boost::serialization also provides this mechanism, so
> it may be better to switch to using that one. But I'll have to
> investigate it beforehand.
>
>
>   
I think speed should be kept in mind with high priority when 
implementing new serialization and new container.

> in fact you can do whatever you want with the containers, because we
> are switching boost::multi_index as soon as I ... do all my non-yade
> development work. Uh, I wish I've been paid to work on yade, not some
> other unrelated stuff, this is killing me. I want to develop yade
> itself but I can't. But everyone is using yade and they need it better.
> But now I have to do snow, concrete and that stuff...
>
>
>   
Hehe, I think you can't develop in a really approriate way if you are 
not a user at the same time. Guess why Va?lav is implementing command 
line interface with Python... :)
Real 100% developers usualy create beautiful concepts and codes, but 
nobody use their code because it is not designed for a end-users. I know 
dozens of examples like this.
Speed, for instance, is one of the major issue for most users.

>> I could run the triaxial test around 25% faster.
>> I can commit those changes soon, I'm curious to know the results on 
>> other computers.
>>     
>
>
> I you want to check on other computers - you can use mine. I'll only need
> to create an account for you, do you want to?
>
>
>   
Yes, we can try that before I commit.


Bruno

-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Fri Feb 22 17:24:59 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Fri, 22 Feb 2008 17:24:59 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47BECCFC.7040100@hmg.inpg.fr>
References: <47BDC895.8010608@hmg.inpg.fr> <20080221205239.68c2695b@absurd>
	<47BECCFC.7040100@hmg.inpg.fr>
Message-ID: <47BEF75B.4010300@hmg.inpg.fr>

Few interesting numbers (from my already optimized version) :

-Each loop on interactions represents 1.47% of cpu time (1.47% = cost of 
it++ operator only, disregarding time to access data).
-There are 4 loops in each timestep (Collider, InteractionPhysics, 
InteractionGeometry, ContactLaw), so that 
InteractionHashMapIterator::increment() represents alone 6% of CPU time.


-InteractionGeometryMetaEngine::action represents 27% of each timestep 
(inclusive cost), and elasticContactLaw::action represents 20%. Those 
two functions are where most of the mathematics is.
-The time that is really spent for mathematics and associated code is 
less than 7% for interaction geometry and less than 12% for ContactLaw 
(7 and 12 are estimates based on non-inclusive costs, i.e. time really 
spent in contact and geometry dyn libs) .
-Summing : 19% CPU time in maths and 28% in dispatching and operations 
on containers.


Bruno

-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From janek_listy at wp.pl  Fri Feb 22 22:57:38 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Fri, 22 Feb 2008 22:57:38 +0100
Subject: [yade-dev] [Yade-commits] r1261 - in trunk
In-Reply-To: <200802222145.m1MLjee1012037@sheep.berlios.de>
References: <200802222145.m1MLjee1012037@sheep.berlios.de>
Message-ID: <20080222225738.18487a39@absurd>

eudoxos at BerliOS said:     (by the date of Fri, 22 Feb 2008 22:45:40 +0100)

>  				}
> +				else cerr<<"COOL! Dynamic cast of type "<<libName<<" successful!"<<endl;
>  			}

LOL! :-)

-- 
Janek Kozicki                                                         |


From janek_listy at wp.pl  Fri Feb 22 23:10:21 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Fri, 22 Feb 2008 23:10:21 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47BE747A.9070603@arcig.cz>
References: <47BDC895.8010608@hmg.inpg.fr> <20080221205239.68c2695b@absurd>
	<47BE747A.9070603@arcig.cz>
Message-ID: <20080222231021.38b930f5@absurd>

V?clav S(milauer said:     (by the date of Fri, 22 Feb 2008 08:06:34 +0100)

> > "Premature optimization is the root of all evil".
> >   
> Last time I had flu and headache it was not because of premature
> optimization. If that is not "evil", consider 2nd world war, which was
> not caused by premature optimization either.

Hitler was optimizing the human race :-)

  http://en.wikipedia.org/wiki/Godwin's_law

Man, this was quick :^)


> Janek, is multi_index random-access in O(1)? That is important if we try
> to use openMP, which can parallelize some loops by itself.

yes, of course. Every action has constant time. No matter if you have
only 100 or 10^10 elements, the time to access 50th element consumes
the same constant amount of time. You could have a look at my
concerns about this in that boost mailing list thread (which I linked
from Development_schedule on wiki)

http://lists.boost.org/Archives/boost/2007/07/124768.php

specifically here:

http://lists.boost.org/Archives/boost/2007/07/124868.php

Author of boost::multi_index writes: "Indices are hashed so as to
provide constant time lookup complexities."


-- 
Janek Kozicki                                                         |


From janek_listy at wp.pl  Fri Feb 22 23:20:38 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Fri, 22 Feb 2008 23:20:38 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47BECCFC.7040100@hmg.inpg.fr>
References: <47BDC895.8010608@hmg.inpg.fr> <20080221205239.68c2695b@absurd>
	<47BECCFC.7040100@hmg.inpg.fr>
Message-ID: <20080222232038.30a5cc37@absurd>

Bruno Chareyre said:     (by the date of Fri, 22 Feb 2008 14:24:12 +0100)

> I think speed should be kept in mind with high priority when 
> implementing new serialization and new container.

I expect some speed improvement here. If it will be slower that will
be an unpleasant surprise.


> Hehe, I think you can't develop in a really approriate way if you are 
> not a user at the same time.

true :-)


> Speed, for instance, is one of the major issue for most users.

I still prefer to look at design quality, because with good quality
we can win much more speed than with only "optimizations".

For example going parallel in a "more optimized" design like
in /extra/spherical-dem-simulator/ is much more difficult.
So SphericalDEMSimulator.cpp is currently faster because it was
totally optimized, but it cannot use the power of multiprocessor
computations. This is just one example, but I hope that you grasp
what I mean here.

Of course those decisions must be balanced, so that's why we are
having this discussion. It is good. And of course it's good that I'm
yade user too.

> >> I could run the triaxial test around 25% faster.

congrats!

> >> I can commit those changes soon, I'm curious to know the results on 
> >> other computers.

Go on and commit. I suppose that you already checked on my  computer.


best regards
-- 
Janek Kozicki                                                         |


From eudoxos at arcig.cz  Sat Feb 23 07:37:07 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Sat, 23 Feb 2008 07:37:07 +0100
Subject: [yade-dev] [Yade-commits] r1261 - in trunk
In-Reply-To: <20080222225738.18487a39@absurd>
References: <200802222145.m1MLjee1012037@sheep.berlios.de>
	<20080222225738.18487a39@absurd>
Message-ID: <47BFBF13.2060503@arcig.cz>


>>  				}
>> +				else cerr<<"COOL! Dynamic cast of type "<<libName<<" successful!"<<endl;
>>  			}
>>     
>
> LOL! :-)
>
>   
You laugh, but I _never_ actually saw that message in terminal. I was
wondering twhether failing dynamic_cast was something exceptional, but
it is a rule that is 100% valid, it seems. V.



From eudoxos at arcig.cz  Sat Feb 23 07:45:13 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Sat, 23 Feb 2008 07:45:13 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47BEF75B.4010300@hmg.inpg.fr>
References: <47BDC895.8010608@hmg.inpg.fr>
	<20080221205239.68c2695b@absurd>	<47BECCFC.7040100@hmg.inpg.fr>
	<47BEF75B.4010300@hmg.inpg.fr>
Message-ID: <47BFC0F9.3050502@arcig.cz>


> -The time that is really spent for mathematics and associated code is 
> less than 7% for interaction geometry and less than 12% for ContactLaw 
> (7 and 12 are estimates based on non-inclusive costs, i.e. time really 
> spent in contact and geometry dyn libs) .
>   
Bruno, these are really important numbers, many thanks. That also means
that I will not go on to vectorize (=multiplex) operations on vectors
and quaternions (addition of all 3 elements in one CPU instruction),
since that would yield very small speedups.

Recently looking at interfaces of many classes (like containers),
methods are not properly marked const if they do not change the current
instance. That, I think, prevents many optimizations. Like,
container.size() should be declared as

class container{
...
 size_t size(void) const {...}
...
}

since it will never change the container.

BTW Janek, for the class index: the index could be a (really) static
variable, which would have to be allocated inside .cpp files (by some
macro, say CREATE_CLASS_INDEX(className) would expand to "int
className::index=-1", or even YADE_PLUGIN could do this for all classes
it receives), in this way the plugin _loader_ would assign the index
right after the plugin is loaded and you could get it simply by
className::index (but the index would r/w and some _stupid_ user might
fiddle with it).


Vaclav.


From eudoxos at arcig.cz  Sat Feb 23 07:54:00 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Sat, 23 Feb 2008 07:54:00 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <20080222231021.38b930f5@absurd>
References: <47BDC895.8010608@hmg.inpg.fr>
	<20080221205239.68c2695b@absurd>	<47BE747A.9070603@arcig.cz>
	<20080222231021.38b930f5@absurd>
Message-ID: <47BFC308.5010409@arcig.cz>


>> Janek, is multi_index random-access in O(1)? That is important if we try
>> to use openMP, which can parallelize some loops by itself.
>>     
>
> yes, of course. Every action has constant time. No matter if you have
> only 100 or 10^10 elements, the time to access 50th element consumes
> the same constant amount of time. You could have a look at my
> concerns about this in that boost mailing list thread (which I linked
> from Development_schedule on wiki)
>   
OK. That is scaling issue. But can it access elements by a number
(without any particular order) directly, just by dereferencing, without
any big computations? For openMP, parallel loops must loop over numbers,
so instead of interactionContainer iterator, it must be rewritten in
something like this:
 
 #pragma parallel for
 for(int i=0; i<interactions.size(); i++){
    const Interaction& i(interactions[i]);
  ...
 }

You get the idea, right? If getting "interactions[i]" is just a bit
slower than pointer arithmetics in old-style array or std::vector, it
will be much slower in total, I think.

Read this, very nice: http://bisqwit.iki.fi/story/howto/openmp/



From bruno.chareyre at hmg.inpg.fr  Mon Feb 25 18:01:28 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Mon, 25 Feb 2008 18:01:28 +0100
Subject: [yade-dev] [Yade-commits] r1261 - in trunk
In-Reply-To: <47BFBF13.2060503@arcig.cz>
References: <200802222145.m1MLjee1012037@sheep.berlios.de>	<20080222225738.18487a39@absurd>
	<47BFBF13.2060503@arcig.cz>
Message-ID: <47C2F468.4020307@hmg.inpg.fr>

V?clav S a ?crit :
>>>  				}
>>> +				else cerr<<"COOL! Dynamic cast of type "<<libName<<" successful!"<<endl;
>>>  			}
>>>     
>>>       
>> LOL! :-)
>>
>>   
>>     
> You laugh, but I _never_ actually saw that message in terminal. I was
> wondering twhether failing dynamic_cast was something exceptional, but
> it is a rule that is 100% valid, it seems. V.
>   
Huh!!! Is it a general rule in Yade or just in one given function? That 
could explain why interactions were all turned into SDEC_links before!






-

 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Mon Feb 25 19:21:42 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Mon, 25 Feb 2008 19:21:42 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47BFC0F9.3050502@arcig.cz>
References: <47BDC895.8010608@hmg.inpg.fr>	<20080221205239.68c2695b@absurd>	<47BECCFC.7040100@hmg.inpg.fr>	<47BEF75B.4010300@hmg.inpg.fr>
	<47BFC0F9.3050502@arcig.cz>
Message-ID: <47C30736.5050403@hmg.inpg.fr>

V?clav S a ?crit :
>> -The time that is really spent for mathematics and associated code is 
>> less than 7% for interaction geometry and less than 12% for ContactLaw 
>> (7 and 12 are estimates based on non-inclusive costs, i.e. time really 
>> spent in contact and geometry dyn libs) .
>>   
>>     
> Bruno, these are really important numbers, many thanks. That also means
> that I will not go on to vectorize (=multiplex) operations on vectors
> and quaternions (addition of all 3 elements in one CPU instruction),
> since that would yield very small speedups.
>   
That is THE big problem actualy, if you ask me. Each time you see a way 
to gain speed, you (I) realize that it is negligible compared to 
something else. Everything is a little bit slow, so that there is 
nothing you can do to significantly speed things up. I'm tempted to 
blame partly boost (I may be wrong though), which make every simple 
operation like shared_ptr(new something) or i++ (when i points to 
shared_ptr container)  slower than normal, and also some useless tests 
and operations in some containers (due to defensive programming most of 
the time).

Let me illustrate that point with the function 
PhysicalActionDamper::action ().

This dispatching function takes 10% of the total simulation time. It is 
supposed to damp force and momentum.

Guess what time is spent for actually damping? 5.7% for force and 5.7% 
for moment (i.e. 0.10*0.057 of total cpu time for each of 
CundallNonViscousForceDamping and CundallNonViscousMomentumDamping). 
Amazing isn't it? The damping dispatcher takes 89% of cpu time to do 
something else, namely :
- LocateMultivirtualFunctor : 50%
- PhysicalActionIterator::Increment : 6%
- BodyRedirectionVector::operator[] : 4%
-PhysicalActionVector::getValue() : 3%
-PhysicalActionVector::isDifferent() : 3%
- etc...

So that damping in a more efficient way would be totaly futile.

That is why I keep insisting for thinking about speed constantly. 
Because if one part is slow, everybody give up speeding things in his 
own area of interest, and we get a slow code as a result.

I really think I will try and merge some engines soon (same as Luc 
Sibille idea), to reduce container operations and see the result. But my 
impression is that containers themselves could be a lot faster, so that 
merging would be useless.

A simple example :

shared_ptr<PhysicalAction>& PhysicalActionVectorVector::find(unsigned 
int id , int actionIndex )
{
    if( current_size <= id ) // this is very rarely executed, only at 
beginning.
    // somebody is accesing out of bounds, make sure he will find, what 
he needs - a resetted PhysicalAction of his type
    {
        ....
    }
    usedIds[id] = true;
    return physicalActions[id][actionIndex];
}

1. There is this test at the begining, that is useless all the time 
except at iteration 1.
2. there is this usedIds[id] affectation (same remark again, only 
modified at iteration 1).
3. Then return a reference to a shared pointer (while shared_ptr 
operations are slower than normal).

Of course, this function "find" is used many many times. Result 3.81% of 
total CPU time just for it, while we could just use 
physicalActions[id][actionIndex] instead of find(), and reduce that time 
a lot. But of course physicalActions is private...

You may think 3.81% is negligible, yes, that is true, like everything 
else is negligible. That is the problem.

Janek : I know that containers will be changed anyway, and that is why I 
think this is the right moment to cry about speed. :)
Users don't care about Godwin's law, they need SPEED!!!

> Recently looking at interfaces of many classes (like containers),
> methods are not properly marked const if they do not change the current
> instance. That, I think, prevents many optimizations. Like,
> container.size() should be declared as
>
> class container{
> ...
>  size_t size(void) const {...}
> ...
> }
>
>   
Yes, I thought to that too, but I was not expert enough to be sure. 
Can't the compiler check that nothing will be affected in some situations?

Bruno

-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Mon Feb 25 19:24:45 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Mon, 25 Feb 2008 19:24:45 +0100
Subject: [yade-dev] [Fwd: [Yade-users] Simulation with 100,000 sphere]
Message-ID: <47C307ED.40108@hmg.inpg.fr>

LOL!!

Godwin's law says 100k spheres is premature ;-)

Bruno

-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________

-------------- next part --------------
An embedded message was scrubbed...
From: "Kien Dang, Mr" <kien.dang at mail.mcgill.ca>
Subject: [Yade-users] Simulation with 100,000 sphere
Date: Sat, 23 Feb 2008 21:35:31 -0500
Size: 3903
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080225/0177df30/attachment.mht>

From janek_listy at wp.pl  Mon Feb 25 20:34:12 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Mon, 25 Feb 2008 20:34:12 +0100
Subject: [yade-dev] [Yade-commits] r1261 - in trunk
In-Reply-To: <47C2F468.4020307@hmg.inpg.fr>
References: <200802222145.m1MLjee1012037@sheep.berlios.de>
	<20080222225738.18487a39@absurd> <47BFBF13.2060503@arcig.cz>
	<47C2F468.4020307@hmg.inpg.fr>
Message-ID: <20080225203412.00ae12a3@absurd>

Bruno Chareyre said:     (by the date of Mon, 25 Feb 2008 18:01:28 +0100)

> > You laugh, but I _never_ actually saw that message in terminal. I was
> > wondering twhether failing dynamic_cast was something exceptional, but
> > it is a rule that is 100% valid, it seems. V.
> >   

> Huh!!! Is it a general rule in Yade or just in one given function? That 

it happens only when loading plugins. You know what you are loading
from file, but dynamic cast is not working.

> could explain why interactions were all turned into SDEC_links before!

no. It was Vaclav experimenting with SDEClinks, his fault.
Not some dark mystery about broken dynamic casts.

-- 
Janek Kozicki                                                         |


From bruno.chareyre at hmg.inpg.fr  Mon Feb 25 19:34:49 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Mon, 25 Feb 2008 19:34:49 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47C30736.5050403@hmg.inpg.fr>
References: <47BDC895.8010608@hmg.inpg.fr>	<20080221205239.68c2695b@absurd>	<47BECCFC.7040100@hmg.inpg.fr>	<47BEF75B.4010300@hmg.inpg.fr>	<47BFC0F9.3050502@arcig.cz>
	<47C30736.5050403@hmg.inpg.fr>
Message-ID: <47C30A49.60603@hmg.inpg.fr>

Sorry, I forgot to attach this little snapshot. Give a look at it.


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________

-------------- next part --------------
A non-text attachment was scrubbed...
Name: DampingDispatcher.jpg
Type: image/jpeg
Size: 388947 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080225/da7cf62d/attachment.jpg>

From eudoxos at arcig.cz  Mon Feb 25 22:50:34 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Mon, 25 Feb 2008 22:50:34 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47C30736.5050403@hmg.inpg.fr>
References: <47BDC895.8010608@hmg.inpg.fr>	<20080221205239.68c2695b@absurd>	<47BECCFC.7040100@hmg.inpg.fr>	<47BEF75B.4010300@hmg.inpg.fr>	<47BFC0F9.3050502@arcig.cz>
	<47C30736.5050403@hmg.inpg.fr>
Message-ID: <47C3382A.6090503@arcig.cz>

>
> The damping dispatcher takes 89% of cpu time to do 
> something else, namely :
> - LocateMultivirtualFunctor : 50%
Good to know. If Janek listens: wouldn't it be much faster to have an 1D
or 2D array, sized maxClassIndex (? maxClassIndex), that would be used
for lookup? Just pointer arithmetics. This array could even be shared
for different dispatchers, since no pair of classes can (probably) be
used in different dispatchers, right?

Another way would be to have boost::ublas::compressed_matrix for the 2D
case, if 2D array of some 10000 elements is too much (OK, if we have
1000 classes once, that would mean 1e6 which is not nice). Should be
reasonably fast as well. No 3D functors, though ;-).

Will play with that if I find some time. That would sound like big speed
improvement (there is quite a few dispatchers in the simulation, if they
take 30% of time, that means 15% for dispatching... wow.

I thought originally this stuff was part of Loki and was well optimized.

> A simple example :
>
> shared_ptr<PhysicalAction>& PhysicalActionVectorVector::find(unsigned 
> int id , int actionIndex )
> {
>     if( current_size <= id ) // this is very rarely executed, only at 
> beginning.
>     // somebody is accesing out of bounds, make sure he will find, what 
> he needs - a resetted PhysicalAction of his type
>     {
>         ....
>     }
>     usedIds[id] = true;
>     return physicalActions[id][actionIndex];
> }
>
> 1. There is this test at the begining, that is useless all the time 
> except at iteration 1.
> 2. there is this usedIds[id] affectation (same remark again, only 
> modified at iteration 1).
> 3. Then return a reference to a shared pointer (while shared_ptr 
> operations are slower than normal).
>   
You're right, I thought that 1. and 2. was the business of ::prepare,
which is called from PhysicalActionContainerInitializer. It should be
the user's responsibility to use valid indices, right?

UsedIds, that's a different story; it says what index contains a
non-null action so that we can iterate over non-null actions. But this
flag could be put into the action instance itself. Then
physicalActions[id][actionIndex] could be used directly.
> Of course, this function "find" is used many many times. Result 3.81% of 
> total CPU time just for it, while we could just use 
> physicalActions[id][actionIndex] instead of find(), and reduce that time 
> a lot. But of course physicalActions is private...
>   
Just change that in the header and make it public, no problem. If the
"user" screws stuff, it it his problem, not mine. I think Olivier liked
having lot of stuff private, but then we have overheads for for
accessors. Sadly, c++ has no way to say: this member is public for
reading and private for writing, which could help in many cases.
> Janek : I know that containers will be changed anyway, and that is why I 
> think this is the right moment to cry about speed. :)
> Users don't care about Godwin's law, they need SPEED!!!
>   
Cosurgi, should I fiddle with PhysicalActionContainer or is it going to
be changed anyway?
> Yes, I thought to that too, but I was not expert enough to be sure. 
> Can't the compiler check that nothing will be affected in some situations?
>   
It can in some, but I don't know in which ones. Putting const everywhere
also checks that there are no side-effects of the method on its
instance, for example.

Another thing is that many methods should be inlined, but grepping
through headers reveals that only very small subset is: for the most
part, the openGl wrapper. Inlining functions is turned on by the -O3
flag to g++, so we don't gain nothing here probably. But gcc manpage
says for -finline-limit: " This option is particularly useful for
programs that use inlining heavily such as those based on recursive
templates with C++." which is just our case.

And by the way, I just found out that assert(...) is not compiled-out in
optimized builds of scons, since we don't define NDEBUG. Will be fixed
in next commit. No big deal ;-)


From eudoxos at arcig.cz  Tue Feb 26 09:16:04 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 26 Feb 2008 09:16:04 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47C3382A.6090503@arcig.cz>
References: <47BDC895.8010608@hmg.inpg.fr>	<20080221205239.68c2695b@absurd>	<47BECCFC.7040100@hmg.inpg.fr>	<47BEF75B.4010300@hmg.inpg.fr>	<47BFC0F9.3050502@arcig.cz>	<47C30736.5050403@hmg.inpg.fr>
	<47C3382A.6090503@arcig.cz>
Message-ID: <47C3CAC4.2070609@arcig.cz>

OK,  a few ideas for low-hanging optimizations. Tell me if you thing
they will not work.

1. LocateMultivirtualFunctor can cache last arguments as well as the
return value at successful lookup. Since it typically does the same
lookup over and over (takes 50% of Cundall damping), it could be reduced
to almost zero (I think):

 if(index1==cachedIndex1 && index2==cachedIndex2) return cachedResult;
/* at the beginning of LocateMultivirtualFunctor */

Given c++ short-circuits conditions, it will add one integer comparison
if we have a "cache miss", no big deal.

(BTW, Janek, couldn't we use some template and virtual functions magic
to have the compiler do the dispatching code? There is plenty of stuff
like that in boost, have a look at extending boost::range with new
classes. Don't know how it works internally, though. We also probably
would have to know all candidates at compile-time.)

2. I will create a new class CundallForceAndMomentumDamping, which will
act on RigidBodyParameters and will be inside the same dispatcher as
CundallnonViscousForceDamping (for ParticleParameters). This way, one
loop over bodies will be gotten rid of. I know the force damping code
will be duplicated at 2 places, but it is just a few lines of code.

3. Physical action appliers could reset those physical actions that have
been applied. This way, we save yet another loop, in
PhysicalActionContainerResetter. LeapFrogPositionIntegrator will apply
force and set it to 0 etc. Is that OK?

Bruno, what do you use to measure time of execution? Small.xyz and
TriaxialTest or something else?

Vaclav



From bruno.chareyre at hmg.inpg.fr  Tue Feb 26 14:37:40 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Tue, 26 Feb 2008 14:37:40 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47C3382A.6090503@arcig.cz>
References: <47BDC895.8010608@hmg.inpg.fr>	<20080221205239.68c2695b@absurd>	<47BECCFC.7040100@hmg.inpg.fr>	<47BEF75B.4010300@hmg.inpg.fr>	<47BFC0F9.3050502@arcig.cz>	<47C30736.5050403@hmg.inpg.fr>
	<47C3382A.6090503@arcig.cz>
Message-ID: <47C41624.4050602@hmg.inpg.fr>

V?clav S a ?crit :
>> The damping dispatcher takes 89% of cpu time to do 
>> something else, namely :
>> - LocateMultivirtualFunctor : 50%
>>     
> Good to know.
>   

Let me precise this : I'm not sure the dispatching mecanism is slow by 
itself. What takes a lot of time in the dispatcher is for instance 
BodyMacroParameters::getBaseClassIndex()  (around 50%), or the function 
find() I spoke about before (10%). I'm attaching a file with the list of 
function costs in LocateMultivirtualFunctor .

Note that getBaseClassIndex() is 10 times slower that getClassIndex(), I 
wonder why...

Bruno





> Another way would be to have boost::ublas::compressed_matrix for the 2D
> case, if 2D array of some 10000 elements is too much (OK, if we have
> 1000 classes once, that would mean 1e6 which is not nice). Should be
> reasonably fast as well. No 3D functors, though ;-).
>
> Will play with that if I find some time. That would sound like big speed
> improvement (there is quite a few dispatchers in the simulation, if they
> take 30% of time, that means 15% for dispatching... wow.
>
> I thought originally this stuff was part of Loki and was well optimized.
>
>   
>> A simple example :
>>
>> shared_ptr<PhysicalAction>& PhysicalActionVectorVector::find(unsigned 
>> int id , int actionIndex )
>> {
>>     if( current_size <= id ) // this is very rarely executed, only at 
>> beginning.
>>     // somebody is accesing out of bounds, make sure he will find, what 
>> he needs - a resetted PhysicalAction of his type
>>     {
>>         ....
>>     }
>>     usedIds[id] = true;
>>     return physicalActions[id][actionIndex];
>> }
>>
>> 1. There is this test at the begining, that is useless all the time 
>> except at iteration 1.
>> 2. there is this usedIds[id] affectation (same remark again, only 
>> modified at iteration 1).
>> 3. Then return a reference to a shared pointer (while shared_ptr 
>> operations are slower than normal).
>>   
>>     
> You're right, I thought that 1. and 2. was the business of ::prepare,
> which is called from PhysicalActionContainerInitializer. It should be
> the user's responsibility to use valid indices, right?
>
> UsedIds, that's a different story; it says what index contains a
> non-null action so that we can iterate over non-null actions. But this
> flag could be put into the action instance itself. Then
> physicalActions[id][actionIndex] could be used directly.
>   
>> Of course, this function "find" is used many many times. Result 3.81% of 
>> total CPU time just for it, while we could just use 
>> physicalActions[id][actionIndex] instead of find(), and reduce that time 
>> a lot. But of course physicalActions is private...
>>   
>>     
> Just change that in the header and make it public, no problem. If the
> "user" screws stuff, it it his problem, not mine. I think Olivier liked
> having lot of stuff private, but then we have overheads for for
> accessors. Sadly, c++ has no way to say: this member is public for
> reading and private for writing, which could help in many cases.
>   
>> Janek : I know that containers will be changed anyway, and that is why I 
>> think this is the right moment to cry about speed. :)
>> Users don't care about Godwin's law, they need SPEED!!!
>>   
>>     
> Cosurgi, should I fiddle with PhysicalActionContainer or is it going to
> be changed anyway?
>   
>> Yes, I thought to that too, but I was not expert enough to be sure. 
>> Can't the compiler check that nothing will be affected in some situations?
>>   
>>     
> It can in some, but I don't know in which ones. Putting const everywhere
> also checks that there are no side-effects of the method on its
> instance, for example.
>
> Another thing is that many methods should be inlined, but grepping
> through headers reveals that only very small subset is: for the most
> part, the openGl wrapper. Inlining functions is turned on by the -O3
> flag to g++, so we don't gain nothing here probably. But gcc manpage
> says for -finline-limit: " This option is particularly useful for
> programs that use inlining heavily such as those based on recursive
> templates with C++." which is just our case.
>
> And by the way, I just found out that assert(...) is not compiled-out in
> optimized builds of scons, since we don't define NDEBUG. Will be fixed
> in next commit. No big deal ;-)
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Tue Feb 26 14:44:49 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Tue, 26 Feb 2008 14:44:49 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47C3CAC4.2070609@arcig.cz>
References: <47BDC895.8010608@hmg.inpg.fr>	<20080221205239.68c2695b@absurd>	<47BECCFC.7040100@hmg.inpg.fr>	<47BEF75B.4010300@hmg.inpg.fr>	<47BFC0F9.3050502@arcig.cz>	<47C30736.5050403@hmg.inpg.fr>	<47C3382A.6090503@arcig.cz>
	<47C3CAC4.2070609@arcig.cz>
Message-ID: <47C417D1.4090004@hmg.inpg.fr>


> 2. I will create a new class CundallForceAndMomentumDamping, which will
> act on RigidBodyParameters and will be inside the same dispatcher as
> CundallnonViscousForceDamping (for ParticleParameters). This way, one
> loop over bodies will be gotten rid of. I know the force damping code
> will be duplicated at 2 places, but it is just a few lines of code.
>
>   
There is no need for a damping dispatcher IMHO.
Damping is a part of the numerical integration scheme, and as such it 
would be consistent to damp equations at the same time you integrate 
laws of motion.
What I plan is to simply merge MomentumDamping, ForceDamping, 
LeapfrogMomentum and LeapFrogPosition.
It will make only one loop for integrating damped equations of motion 
(i.e. what 99% of simulations need), rather than 4.

Bruno

> 3. Physical action appliers could reset those physical actions that have
> been applied. This way, we save yet another loop, in
> PhysicalActionContainerResetter. LeapFrogPositionIntegrator will apply
> force and set it to 0 etc. Is that OK?
>
> Bruno, what do you use to measure time of execution? Small.xyz and
> TriaxialTest or something else?
>
> Vaclav
>
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Tue Feb 26 14:49:53 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Tue, 26 Feb 2008 14:49:53 +0100
Subject: [yade-dev] LocateMultivirtual cost -> callgrind
Message-ID: <47C41901.3040108@hmg.inpg.fr>


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________

-------------- next part --------------
A non-text attachment was scrubbed...
Name: DampingDispatcher2.jpg
Type: image/jpeg
Size: 270944 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080226/d1b3f412/attachment.jpg>

From eudoxos at arcig.cz  Tue Feb 26 17:42:54 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 26 Feb 2008 17:42:54 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47C41624.4050602@hmg.inpg.fr>
References: <47BDC895.8010608@hmg.inpg.fr>	<20080221205239.68c2695b@absurd>	<47BECCFC.7040100@hmg.inpg.fr>	<47BEF75B.4010300@hmg.inpg.fr>	<47BFC0F9.3050502@arcig.cz>	<47C30736.5050403@hmg.inpg.fr>	<47C3382A.6090503@arcig.cz>
	<47C41624.4050602@hmg.inpg.fr>
Message-ID: <47C4418E.2010309@arcig.cz>


> Note that getBaseClassIndex() is 10 times slower that getClassIndex(), I 
> wonder why...
>   
getBaseClassIndex creates an instance of the base class at every call,
getClassIndex just returns a number. Not good. Janek, what it the
boost::serialization solution of that?

from Indexable.hpp


    public: virtual int& getBaseClassIndex(int depth)            \
    {                                    \
        static boost::scoped_ptr<BaseClass> baseClass(new BaseClass);    \
        if(depth == 1)                            \
            return baseClass->getClassIndex();            \
        else                                \
            return baseClass->getBaseClassIndex(--depth);        \
    }


From bruno.chareyre at hmg.inpg.fr  Tue Feb 26 17:42:28 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Tue, 26 Feb 2008 17:42:28 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47C3CAC4.2070609@arcig.cz>
References: <47BDC895.8010608@hmg.inpg.fr>	<20080221205239.68c2695b@absurd>	<47BECCFC.7040100@hmg.inpg.fr>	<47BEF75B.4010300@hmg.inpg.fr>	<47BFC0F9.3050502@arcig.cz>	<47C30736.5050403@hmg.inpg.fr>	<47C3382A.6090503@arcig.cz>
	<47C3CAC4.2070609@arcig.cz>
Message-ID: <47C44174.7010505@hmg.inpg.fr>


>
> Bruno, what do you use to measure time of execution? Small.xyz and
> TriaxialTest or something else?
>
>   
time ./yade-svn1258 -n -- -f /home/bruno/YADE/data/scene_test.xml -v 100 
-p  -m 40000

Where scene_test.xml is a 4000 particles triaxial test, with enabled 
autoCompressionActivation, a low strain rate  (strainRate="0.01"), and a 
strict equilibrium criterion (StabilityCriterion="0.001"). Everything 
else is default IIRC.
I send you that scene.xml.

"time" gives this sort of result :

real    13m10.555s
user    12m33.367s
sys     0m4.988s

You must consider "user" time, wich can differ a lot from "real" in case 
you do something else during computation.

Bruno



 


> Vaclav
>
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________

-------------- next part --------------
A non-text attachment was scrubbed...
Name: scene_test.xml.tar.gz
Type: application/x-gzip
Size: 442491 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080226/00eb576e/attachment.bin>

From janek_listy at wp.pl  Tue Feb 26 18:36:57 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Tue, 26 Feb 2008 18:36:57 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47C4418E.2010309@arcig.cz>
References: <47BDC895.8010608@hmg.inpg.fr> <20080221205239.68c2695b@absurd>
	<47BECCFC.7040100@hmg.inpg.fr> <47BEF75B.4010300@hmg.inpg.fr>
	<47BFC0F9.3050502@arcig.cz> <47C30736.5050403@hmg.inpg.fr>
	<47C3382A.6090503@arcig.cz> <47C41624.4050602@hmg.inpg.fr>
	<47C4418E.2010309@arcig.cz>
Message-ID: <20080226183657.10a7be22@absurd>

V?clav S(milauer said:     (by the date of Tue, 26 Feb 2008 17:42:54 +0100)

> getBaseClassIndex creates an instance of the base class at every call,
> 
> from Indexable.hpp
> 
>         static boost::scoped_ptr<BaseClass> baseClass(new BaseClass);    \


It does NOT create an instance at every call. The variable
"baseClass" is static. It is created just once, on the first call.
It should, at least. We can put cerr << into the constructor to
verify this.

I must have some snow working with moment-rotation for the
meeting on 5th march.

I really want to join you with optimizing yade, especially because
Bruno is doing all those benchmarks now. But SNOW is what I must
do :(((

I hope it will be better after that meeting on 5 march. 

Then I will read all your posts on this mailing list and answer to
your questions. As well as join "yade-optimizations" movement :)



-- 
Janek Kozicki                                                         |


From janek_listy at wp.pl  Tue Feb 26 20:15:10 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Tue, 26 Feb 2008 20:15:10 +0100
Subject: [yade-dev] CohesiveFrictionalContactLaw "box"
Message-ID: <20080226201510.11b09062@absurd>

Bruno,

I'm trying to add moment rotation into CohesiveFrictionalContactLaw,
it will use that flag "momentRotationLaw" (which is true by default -
so it will modify all existing simulations!)

And I've seen this line in CohesiveFrictionalContactLaw.cpp:83

if (detectBrokenBodies &&
(*bodies)[(*ii)->getId1()]->interactingGeometry->getClassName() !=
"box"  &&
(*bodies)[(*ii)->getId2()]->interactingGeometry->getClassName() !=
"box") 

there are two things wrong with it:

1. interactingGeometry->getClassName() returns "InteractingBox" not "box"
2. comparing strings is not fast.

-- 
Janek Kozicki                                                         |


From bruno.chareyre at hmg.inpg.fr  Wed Feb 27 12:18:21 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Wed, 27 Feb 2008 12:18:21 +0100
Subject: [yade-dev] CohesiveFrictionalContactLaw "box"
In-Reply-To: <20080226201510.11b09062@absurd>
References: <20080226201510.11b09062@absurd>
Message-ID: <47C546FD.9010609@hmg.inpg.fr>

Janek Kozicki a ?crit :
> Bruno,
>
> I'm trying to add moment rotation into CohesiveFrictionalContactLaw,
> it will use that flag "momentRotationLaw" (which is true by default -
> so it will modify all existing simulations!)
>
> And I've seen this line in CohesiveFrictionalContactLaw.cpp:83
>
> if (detectBrokenBodies &&
> (*bodies)[(*ii)->getId1()]->interactingGeometry->getClassName() !=
> "box"  &&
> (*bodies)[(*ii)->getId2()]->interactingGeometry->getClassName() !=
> "box") 
>
> there are two things wrong with it:
>
> 1. interactingGeometry->getClassName() returns "InteractingBox" not "box"
> 2. comparing strings is not fast.
>
>   
Ok thank you. This is just experimental code actually, in order to 
change color of bodies which have at least one broken interaction. But 
let you correct this if you feel like doing it (based on classIndex 
probably?).

One technical question : when one write "if (c1 && c2 && c3)", are tests 
c2 and c3 still evaluated when c1 is  "false"?

Bruno







-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Wed Feb 27 12:53:28 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Wed, 27 Feb 2008 12:53:28 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <20080226183657.10a7be22@absurd>
References: <47BDC895.8010608@hmg.inpg.fr>
	<20080221205239.68c2695b@absurd>	<47BECCFC.7040100@hmg.inpg.fr>
	<47BEF75B.4010300@hmg.inpg.fr>	<47BFC0F9.3050502@arcig.cz>
	<47C30736.5050403@hmg.inpg.fr>	<47C3382A.6090503@arcig.cz>
	<47C41624.4050602@hmg.inpg.fr>	<47C4418E.2010309@arcig.cz>
	<20080226183657.10a7be22@absurd>
Message-ID: <47C54F38.5020404@hmg.inpg.fr>

Janek Kozicki a ?crit :
> V?clav S(milauer said:     (by the date of Tue, 26 Feb 2008 17:42:54 +0100)
>
>   
>> getBaseClassIndex creates an instance of the base class at every call,
>>
>> from Indexable.hpp
>>
>>         static boost::scoped_ptr<BaseClass> baseClass(new BaseClass);    \
>>     
>
>
> It does NOT create an instance at every call. The variable
> "baseClass" is static. It is created just once, on the first call.
> It should, at least. We can put cerr << into the constructor to
> verify this.
>   
That is true : valgrind shows only one call to "new" in 100k iterations.
Time is spent in another function that I can't identify (named 
"0x000F..."), probably because it is a macro, an inlined function, or 
something like that.

Bruno

-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Wed Feb 27 16:00:12 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 27 Feb 2008 16:00:12 +0100
Subject: [yade-dev] CohesiveFrictionalContactLaw "box"
In-Reply-To: <47C546FD.9010609@hmg.inpg.fr>
References: <20080226201510.11b09062@absurd> <47C546FD.9010609@hmg.inpg.fr>
Message-ID: <47C57AFC.70601@arcig.cz>


> One technical question : when one write "if (c1 && c2 && c3)", are tests 
> c2 and c3 still evaluated when c1 is  "false"?
>   
no, not in c (and c++). It's called short-cirtuited evaluation and it
allows you to write things like:

int* a=NULL;
/* do something */
if (a && (*a)<10) { /* *a is a number */}
else{ /* a is NULL */ }

Otherwise if a were still NULL, you would get segfault at the
dereference *a.

(Pascal doesn't have that, for instance, unless specifically requsted.)

Vaclav



From eudoxos at arcig.cz  Wed Feb 27 16:02:36 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Wed, 27 Feb 2008 16:02:36 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47C54F38.5020404@hmg.inpg.fr>
References: <47BDC895.8010608@hmg.inpg.fr>	<20080221205239.68c2695b@absurd>	<47BECCFC.7040100@hmg.inpg.fr>	<47BEF75B.4010300@hmg.inpg.fr>	<47BFC0F9.3050502@arcig.cz>	<47C30736.5050403@hmg.inpg.fr>	<47C3382A.6090503@arcig.cz>	<47C41624.4050602@hmg.inpg.fr>	<47C4418E.2010309@arcig.cz>	<20080226183657.10a7be22@absurd>
	<47C54F38.5020404@hmg.inpg.fr>
Message-ID: <47C57B8C.2050302@arcig.cz>


> That is true : valgrind shows only one call to "new" in 100k iterations.
> Time is spent in another function that I can't identify (named 
> "0x000F..."), probably because it is a macro, an inlined function, or 
> something like that.
>   
That is a library function (boost, libstdc++, ...?) and the library was
compiled without debugging symbols. If a function is inlined, it is not
a separate function but the compiler inserts the code at that place
where called (hence valgrind would attribute it to the caller). The same
with macros, where preprocessor inserts the program text at the place
where used.

Vaclav



From bruno.chareyre at hmg.inpg.fr  Wed Feb 27 16:25:59 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Wed, 27 Feb 2008 16:25:59 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47C57B8C.2050302@arcig.cz>
References: <47BDC895.8010608@hmg.inpg.fr>	<20080221205239.68c2695b@absurd>	<47BECCFC.7040100@hmg.inpg.fr>	<47BEF75B.4010300@hmg.inpg.fr>	<47BFC0F9.3050502@arcig.cz>	<47C30736.5050403@hmg.inpg.fr>	<47C3382A.6090503@arcig.cz>	<47C41624.4050602@hmg.inpg.fr>	<47C4418E.2010309@arcig.cz>	<20080226183657.10a7be22@absurd>	<47C54F38.5020404@hmg.inpg.fr>
	<47C57B8C.2050302@arcig.cz>
Message-ID: <47C58107.1060807@hmg.inpg.fr>

V?clav ?milauer a ?crit :
>> That is true : valgrind shows only one call to "new" in 100k iterations.
>> Time is spent in another function that I can't identify (named 
>> "0x000F..."), probably because it is a macro, an inlined function, or 
>> something like that.
>>   
>>     
> That is a library function (boost, libstdc++, ...?) and the library was
> compiled without debugging symbols. If a function is inlined, it is not
> a separate function but the compiler inserts the code at that place
> where called (hence valgrind would attribute it to the caller). The same
> with macros, where preprocessor inserts the program text at the place
> where used.
>
>   
Problem is vallgrind see this 0x00.. as a function of 
libBodyMacroParameters.so, does it make sense for you?



-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Wed Feb 27 17:24:13 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Wed, 27 Feb 2008 17:24:13 +0100
Subject: [yade-dev] Damping clumps
Message-ID: <47C58EAD.7090208@hmg.inpg.fr>

Hello Va?lav

What is the idea for damping the motion of clumps currently?

It looks like forces on each member of a clump is damped independently 
rather than damped in a global way at the clump's scale. Is that true?

If, yes, I think it would be more consistent to damp the motion of the 
clump itself (it would also make less operations, which is never bad).

Bruno

-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Wed Feb 27 17:35:27 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Wed, 27 Feb 2008 17:35:27 +0100
Subject: [yade-dev] Damping clumps
In-Reply-To: <47C58EAD.7090208@hmg.inpg.fr>
References: <47C58EAD.7090208@hmg.inpg.fr>
Message-ID: <47C5914F.2050402@hmg.inpg.fr>

Also Va?lav : Could you please run a quick test to check that the result 
with clumps is exactly the same?


Bruno Chareyre a ?crit :
> Hello Va?lav
>
> What is the idea for damping the motion of clumps currently?
>
> It looks like forces on each member of a clump is damped independently 
> rather than damped in a global way at the clump's scale. Is that true?
>
> If, yes, I think it would be more consistent to damp the motion of the 
> clump itself (it would also make less operations, which is never bad).
>
> Bruno
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Thu Feb 28 12:50:38 2008
From: eudoxos at arcig.cz (=?windows-1252?Q?V=E1clav_=8Amilauer?=)
Date: Thu, 28 Feb 2008 12:50:38 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47C58107.1060807@hmg.inpg.fr>
References: <47BDC895.8010608@hmg.inpg.fr>	<20080221205239.68c2695b@absurd>	<47BECCFC.7040100@hmg.inpg.fr>	<47BEF75B.4010300@hmg.inpg.fr>	<47BFC0F9.3050502@arcig.cz>	<47C30736.5050403@hmg.inpg.fr>	<47C3382A.6090503@arcig.cz>	<47C41624.4050602@hmg.inpg.fr>	<47C4418E.2010309@arcig.cz>	<20080226183657.10a7be22@absurd>	<47C54F38.5020404@hmg.inpg.fr>	<47C57B8C.2050302@arcig.cz>
	<47C58107.1060807@hmg.inpg.fr>
Message-ID: <47C6A00E.4040807@arcig.cz>


> Problem is vallgrind see this 0x00.. as a function of 
> libBodyMacroParameters.so, does it make sense for you?
>   
Frankly, no. You could try

  objdump -T libBodyMacroParameters.so

and look for that address. There are many symbols that come from other
libs (inlined by the linker?!) and those ones could be identified in
this way, perhaps. Otherwise, no idea. V.




From dorofeenko at icp.ac.ru  Thu Feb 28 17:19:23 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Thu, 28 Feb 2008 19:19:23 +0300
Subject: [yade-dev] svn1269 SConstruct bugs
Message-ID: <200802281919.23634.dorofeenko@icp.ac.ru>

Hello!

In version svn1269 of SConstruct on 244 line must be 'elif...' instead 
of 'if...', is'n it?

On openSUSE qt3 path is 
/usr/lib/qt3/

Can be add this path to SConstruct?


From eudoxos at arcig.cz  Fri Feb 29 11:53:10 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Fri, 29 Feb 2008 11:53:10 +0100
Subject: [yade-dev] svn1269 SConstruct bugs
In-Reply-To: <200802281919.23634.dorofeenko@icp.ac.ru>
References: <200802281919.23634.dorofeenko@icp.ac.ru>
Message-ID: <47C7E416.9040001@arcig.cz>


> In version svn1269 of SConstruct on 244 line must be 'elif...' instead 
> of 'if...', is'n it?
>   
Yes, there are cases where it wouldn't work now. Fixed, will be commited
shortly.
> On openSUSE qt3 path is 
> /usr/lib/qt3/
>   
OK. I added that to the probed defaults (which are currently
['/usr/share/qt3','/usr/lib/qt','/usr/qt/3','/usr/lib/qt-3.3'] ) so that
you don't have it specify by hand on openSuse. Commit very soon.


Good to know someone reads scons files and know how they work :-)

Regards, Vaclav



From eudoxos at arcig.cz  Sat Mar  1 22:57:43 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Sat, 01 Mar 2008 22:57:43 +0100
Subject: [yade-dev] broken preprocessors after recent optimizations
Message-ID: <47C9D157.8000200@arcig.cz>

Hi folks,

I cooked up a simple "regression test" tool that lives in
scripts/default-test.py. Its purpose is to run all preprocessors, one
after another, generating a simulation and running 100 iterations of it.
It was meant as a simple test that should be routinely performed before
a commit to ensure nothing got broken as well as very basic benchmark
tool. (it takes 23secs to run it on my laptop, nothing bothering)

Sure enough, I bumped into quite a few of them that don't work:
SDECLinkedSpheres, SDECMovingWall, SDECSpheresPlane, ThreePointBending.

That SDEC things crashes are (debugger says) caused by not using
dynamic_casts in
InteractingSphere2InteractingSphere4SpheresContactGeometry, which will
crash on SDEC links (instead of SpheresContactGeometry) (with debug
builds at least). No idea for ThreePointBending (crashes at
BodyRedirectionVector::operator[])

(USCTGen was fixed, GlobalStiffnessCounter was assuming spherical
elastic interactions. I added an attribute to preserve speed gain unless
requested specifically - see last commit.)

Bruno, can you review (and revert?) some of your changes in 1264 and
find a way how to have those things work again?

Oh, the script can be run like this from the 'trunk' directory:

 yade-trunk -N cmdGui -- -s scripts/default-test.py

Best regards,

Vaclav


From eudoxos at arcig.cz  Sun Mar  2 11:26:53 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Sun, 02 Mar 2008 11:26:53 +0100
Subject: [yade-dev] corrigenda: broken preprocessors after recent
	optimizations
In-Reply-To: <47C9D157.8000200@arcig.cz>
References: <47C9D157.8000200@arcig.cz>
Message-ID: <47CA80ED.6060208@arcig.cz>

I added all yade components and have the following results now (cut&paste):

=========================================
SUMMARY ======================================

                      BoxStack passed (257.02 iter/sec)
                BrefcomTestGen passed (4955.9 iter/sec)
                  ClumpTestGen passed (1252.3 iter/sec)
          CohesiveTriaxialTest passed (145.84 iter/sec)
                       FEMBeam passed (39078. iter/sec)
                        Funnel passed (2077.1 iter/sec)
                  HangingCloth passed (125.63 iter/sec)
                 HydraulicTest passed (4963.0 iter/sec)
                LatticeExample passed (5.6667 iter/sec)
                   RotatingBox passed (795.01 iter/sec)
                SDECImpactTest passed (8748.8 iter/sec)
             SDECLinkedSpheres CRASHED (backtrace above)
                SDECMovingWall passed (110.93 iter/sec)
              SDECSpheresPlane passed (4219.4 iter/sec)
                      ScrewGen passed (164.65 iter/sec)
                  TetraTestGen passed (13255. iter/sec)
              TetrahedronsTest passed (34.514 iter/sec)
             ThreePointBending CRASHED (backtrace above)
                  TriaxialTest passed (82.461 iter/sec)
             TriaxialTestWater passed (14.811 iter/sec)
                       USCTGen passed (33.228 iter/sec)

====================================== END OF
SUMMARY ==================================


And parts of backtraces:

SDECLinkedSpheres:

#4  <signal handler called>
#5  0x00007f8cb7948095 in raise () from /lib/libc.so.6
#6  0x00007f8cb7949af0 in abort () from /lib/libc.so.6
#7  0x00007f8cb79413df in __assert_fail () from /lib/libc.so.6
#8  0x00007f8cad197add in
boost::shared_ptr<SpheresContactGeometry>::operator-> (this=0x4134dcd0)
at /usr/include/boost/shared_ptr.hpp:315
#9  0x00007f8cad18cdd4 in
InteractingSphere2InteractingSphere4SpheresContactGeometry::go
(this=0x981930, cm1=@0x986198, cm2=@0x987238, se31=@0x987110,
se32=@0x988320, c=@0x4134ddf0) at
pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp:78


ThreePointBending:

#4  <signal handler called>
#5  0x00007f5980310161 in BodyRedirectionVector::operator[]
(this=0x9811e0, id=0) at pkg/common/Container/BodyRedirectionVector.cpp:159
#6  0x00007f5977a3d731 in TranslationEngine::applyCondition
(this=0x980c90, body=0x97ecc0) at
pkg/common/Engine/DeusExMachina/TranslationEngine.cpp:47
#7  0x000000000048e83c in DeusExMachina::action (this=0x980c90,
b=0x97ecc0) at core/DeusExMachina.cpp:27



From bruno.chareyre at hmg.inpg.fr  Mon Mar  3 10:45:11 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Mon, 03 Mar 2008 10:45:11 +0100
Subject: [yade-dev] broken preprocessors after recent optimizations
In-Reply-To: <47C9D157.8000200@arcig.cz>
References: <47C9D157.8000200@arcig.cz>
Message-ID: <47CBC8A7.5060906@hmg.inpg.fr>

Great!

Ok, I can revert some changes to let SDEClinks work...
... or we remove SDECLinks now!

Janek, do you have this transient version of a moment-rotation law that 
we could use instead of SDEC links?

Bruno

V?clav ?milauer a ?crit :
> Hi folks,
>
> I cooked up a simple "regression test" tool that lives in
> scripts/default-test.py. Its purpose is to run all preprocessors, one
> after another, generating a simulation and running 100 iterations of it.
> It was meant as a simple test that should be routinely performed before
> a commit to ensure nothing got broken as well as very basic benchmark
> tool. (it takes 23secs to run it on my laptop, nothing bothering)
>
> Sure enough, I bumped into quite a few of them that don't work:
> SDECLinkedSpheres, SDECMovingWall, SDECSpheresPlane, ThreePointBending.
>
> That SDEC things crashes are (debugger says) caused by not using
> dynamic_casts in
> InteractingSphere2InteractingSphere4SpheresContactGeometry, which will
> crash on SDEC links (instead of SpheresContactGeometry) (with debug
> builds at least). No idea for ThreePointBending (crashes at
> BodyRedirectionVector::operator[])
>
> (USCTGen was fixed, GlobalStiffnessCounter was assuming spherical
> elastic interactions. I added an attribute to preserve speed gain unless
> requested specifically - see last commit.)
>
> Bruno, can you review (and revert?) some of your changes in 1264 and
> find a way how to have those things work again?
>
> Oh, the script can be run like this from the 'trunk' directory:
>
>  yade-trunk -N cmdGui -- -s scripts/default-test.py
>
> Best regards,
>
> Vaclav
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Mon Mar  3 11:29:04 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Mon, 03 Mar 2008 11:29:04 +0100
Subject: [yade-dev] broken preprocessors after recent optimizations
In-Reply-To: <47C9D157.8000200@arcig.cz>
References: <47C9D157.8000200@arcig.cz>
Message-ID: <47CBD2F0.2080405@hmg.inpg.fr>

Is





> Oh, the script can be run like this from the 'trunk' directory:
>
>  yade-trunk -N cmdGui -- -s scripts/default-test.py
>
>   
Is it from the trunk or from the bin directory?

 From bin, I have this below - I can't start cmdGui, what am I missing? :

bruno at r1arduina:~/YADE/bin$ ./yade-svn1272 -N cmdGui -- -s scripts/default-test.py
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
terminate called after throwing an instance of 'FactoryCantCreate'
  what():  ClassFactory::create - cannot create class named: cmdGui
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/bruno/.yade-svn1272/gdb_crash_batch-pid29497'
GNU gdb 6.6-debian
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i486-linux-gnu".
Using host libthread_db library "/lib/tls/i686/cmov/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread -1237743888 (LWP 29497)]
0xffffe410 in __kernel_vsyscall ()
No symbol "info" in current context.

Thread 1 (Thread -1237743888 (LWP 29497)):
#0  0xffffe410 in __kernel_vsyscall ()
#1  0xb71d46a3 in __waitpid_nocancel () from /lib/tls/i686/cmov/libc.so.6
#2  0xb717ba3f in do_system () from /lib/tls/i686/cmov/libc.so.6
#3  0xb7df153d in system () from /lib/tls/i686/cmov/libpthread.so.0
#4  0x08103cea in sigHandler (sig=6) at core/yade.cpp:57
#5  <signal handler called>
#6  0xffffe410 in __kernel_vsyscall ()
#7  0xb716edf0 in raise () from /lib/tls/i686/cmov/libc.so.6
#8  0xb7170641 in abort () from /lib/tls/i686/cmov/libc.so.6
#9  0xb7371270 in __gnu_cxx::__verbose_terminate_handler () from /usr/lib/libstdc++.so.6
#10 0xb736eca5 in ?? () from /usr/lib/libstdc++.so.6
#11 0xb736ece2 in std::terminate () from /usr/lib/libstdc++.so.6
#12 0xb736ee1a in __cxa_throw () from /usr/lib/libstdc++.so.6
#13 0xb73ad78f in ClassFactory::createShared (this=0x813ad58, name=@0xbfd53280) at lib/factory/ClassFactory.cpp:68
#14 0x08101f14 in main (argc=6, argv=0xbfd534a4) at core/yade.cpp:247
#0  0xffffe410 in __kernel_vsyscall ()
Abandon (core dumped)








> Best regards,
>
> Vaclav
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Mon Mar  3 12:22:18 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Mon, 03 Mar 2008 12:22:18 +0100
Subject: [yade-dev] broken preprocessors after recent optimizations
In-Reply-To: <47CBD2F0.2080405@hmg.inpg.fr>
References: <47C9D157.8000200@arcig.cz> <47CBD2F0.2080405@hmg.inpg.fr>
Message-ID: <47CBDF69.6020705@arcig.cz>


>> Oh, the script can be run like this from the 'trunk' directory:
>>
>>  yade-trunk -N cmdGui -- -s scripts/default-test.py  
>>     
> Is it from the trunk or from the bin directory?
>   

From bruno.chareyre at hmg.inpg.fr  Mon Mar  3 17:31:30 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Mon, 03 Mar 2008 17:31:30 +0100
Subject: [yade-dev] NaN/null positions in collider
Message-ID: <47CC27E2.8050005@hmg.inpg.fr>

About last commit :

"1. Remove NaN's in PersistentSAPCollider for bodies that don't have bounding box: use zero-size degenerate box at its position instead. (fixes warning when running ClumpTestGen)"

I don't know the details of what happens when bodies don't have a BBox, so it may be a dumb questions :
1. Does the collider make operations on bodies wich have no BBox? (?!!!)
2. In case yes, wouldn't it be better to set position at +/- MAX_REAL to avoid sorting operations in the collider?

Bruno




-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Mon Mar  3 17:47:16 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Mon, 03 Mar 2008 17:47:16 +0100
Subject: [yade-dev] NaN/null positions in collider
In-Reply-To: <47CC27E2.8050005@hmg.inpg.fr>
References: <47CC27E2.8050005@hmg.inpg.fr>
Message-ID: <47CC2B94.8010207@arcig.cz>


> I don't know the details of what happens when bodies don't have a BBox, so it may be a dumb questions :
> 1. Does the collider make operations on bodies wich have no BBox? (?!!!)
>   
Yes, it loops over all bodies. Go have a look in the code.
> 2. In case yes, wouldn't it be better to set position at +/- MAX_REAL to avoid sorting operations in the collider?
>   
Yes, it would make sense to assign +inf to minima and -inf to maxima.
Will try that.



From nicessgg at gmail.com  Wed Mar  5 17:30:28 2008
From: nicessgg at gmail.com (kan)
Date: Wed, 5 Mar 2008 10:30:28 -0600
Subject: [yade-dev] Could I ask the method to calculate the shear forces?
Message-ID: <45213f870803050830g47e237hed5a66af7a104597@mail.gmail.com>

Hi, dear all,

When I develop my code to calculate the shear force I meet some problem.

From bruno.chareyre at hmg.inpg.fr  Wed Mar  5 19:19:13 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Wed, 05 Mar 2008 19:19:13 +0100
Subject: [yade-dev] Could I ask the method to calculate the shear forces?
In-Reply-To: <45213f870803050830g47e237hed5a66af7a104597@mail.gmail.com>
References: <45213f870803050830g47e237hed5a66af7a104597@mail.gmail.com>
Message-ID: <47CEE421.8090701@hmg.inpg.fr>




kan a ?crit :
> Hi, dear all,
>  
> When I develop my code to calculate the shear force I meet some problem.
> From the literature, we know that
> Deta_Shear Force = ks*deta_shear_displacement
> while the deta_shear_displacement is the deta displacement at the 
> shear direction at each contact.
> my problem now is that, how to calculate this displacement ?
>  
> I know for normal displacement at each contact, at each time step, 
> when we get the resultant displacement during this time step, then we 
> get the new position for each particle, so we can get the distance 
> between the center of the particles, which is the normal distance. so 
> we can get the normal displacement and use the 
> NormalForce=kn*normal_displacement.
Its a matter of vocabulary.
I think you make a confusion between "displacement" and "position". In 
the normal direction, you get at each time-step the "POSITION" (i.e. 
interpenetration), not the displacement.
So that NormalForce=kn*interpenetration.

>  
> but how can I calculate the deta shear displacement? it seems that I 
> need to store the old position of each particles, which means a 
> doubled storage of the memory and lower speed.
shear_displacement = (velocity1 - velocity2 + r1*rotational_velocity1 - 
r2*rotational_velocity2)*dt

This IS a displacement.

So that shear_force = shear_force + shear_displacement*ks

No need to store initial orientations.

Check ElasticContactLaw.

Bruno

>  
> ------------------------------------------------------------------------
>
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Thu Mar  6 19:24:52 2008
From: eudoxos at arcig.cz (=?UTF-8?B?VsOhY2xhdiDFoG1pbGF1ZXI=?=)
Date: Thu, 06 Mar 2008 19:24:52 +0100
Subject: [yade-dev] Could I ask the method to calculate the shear forces?
In-Reply-To: <47CEE421.8090701@hmg.inpg.fr>
References: <45213f870803050830g47e237hed5a66af7a104597@mail.gmail.com>
	<47CEE421.8090701@hmg.inpg.fr>
Message-ID: <47D036F4.1090109@arcig.cz>


> Check ElasticContactLaw.
>   
Or BrefcomLaw::action, where the first part of the loop calculates
normal and shear strain (epsN and epsT) - same formular, but written not
in such a hairy way.


From nicessgg at gmail.com  Fri Mar  7 05:35:37 2008
From: nicessgg at gmail.com (kan)
Date: Thu, 6 Mar 2008 22:35:37 -0600
Subject: [yade-dev] yade-dev Digest, Vol 16, Issue 5
In-Reply-To: <mailman.59.1204801280.17254.yade-dev@lists.berlios.de>
References: <mailman.59.1204801280.17254.yade-dev@lists.berlios.de>
Message-ID: <45213f870803062035w76c1b180p4865e003766a6ab4@mail.gmail.com>

Get it, thank you so much , Mr. Bruno .

Regards.
Kan.


On 3/6/08, yade-dev-request at lists.berlios.de <
yade-dev-request at lists.berlios.de> wrote:
>
> Send yade-dev mailing list submissions to
>        yade-dev at lists.berlios.de
>
> To subscribe or unsubscribe via the World Wide Web, visit
>        https://lists.berlios.de/mailman/listinfo/yade-dev
> or, via email, send a message with subject or body 'help' to
>        yade-dev-request at lists.berlios.de
>
> You can reach the person managing the list at
>        yade-dev-owner at lists.berlios.de
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of yade-dev digest..."
>
>
> Today's Topics:
>
>   1. Could I ask the method to calculate the shear forces? (kan)
>   2. (no subject)
>   3. Re: Could I ask the method to calculate the shear forces?
>      (Bruno Chareyre)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Wed, 5 Mar 2008 10:30:28 -0600
> From: kan <nicessgg at gmail.com>
> Subject: [yade-dev] Could I ask the method to calculate the shear
>        forces?
> To: yade-dev at lists.berlios.de
> Message-ID:
>        <45213f870803050830g47e237hed5a66af7a104597 at mail.gmail.com>
> Content-Type: text/plain; charset="utf-8"
>
> Hi, dear all,
>
> When I develop my code to calculate the shear force I meet some problem.
>
> ------------------------------
>
> Message: 2
> Message-ID: <mailman.60.1204801280.17254.yade-dev at lists.berlios.de>
>
> Deta_Shear Force = ks*deta_shear_displacement
> while the deta_shear_displacement is the deta displacement at the shear
> direction at each contact.
> my problem now is that, how to calculate this displacement ?
>
> I know for normal displacement at each contact, at each time step, when we
> get the resultant displacement during this time step,
> then we get the new position for each particle, so we can get the distance
> between the center of the particles, which is the normal distance. so we
> can
> get the normal displacement and use the
> NormalForce=kn*normal_displacement.
>
> but how can I calculate the deta shear displacement? it seems that I need
> to
> store the old position of each particles, which means a doubled storage of
> the memory and lower speed.
>
> could you please give me a hint, and which file is it in to calculate the
> shear force or the resultant forces?
>
> Thanks for your nice information in advance.
>
> Kan
>
> ------=_Part_27553_5946959.1204734628668
> Content-Type: text/html; charset=UTF-8
> Content-Transfer-Encoding: 7bit
> Content-Disposition: inline
>
> <div>Hi, dear all,</div>
> <div>&nbsp;</div>
> <div>When I develop my code to calculate the shear force I meet some
> problem.</div>
> <div>From the literature, we know that</div>
> <div>Deta_Shear Force = ks*deta_shear_displacement</div>
> <div>while the deta_shear_displacement is the deta displacement at the
> shear direction&nbsp;at each contact. </div>
> <div>my&nbsp;problem now is that,&nbsp;how to calculate this displacement
> ?</div>
> <div>&nbsp;</div>
> <div>I know for normal displacement at each contact, at each time step,
> when we get the resultant displacement during this time step, </div>
> <div>then we get the new position for each particle, so we can get the
> distance between the center of the particles, which is the normal distance.
> so we can get the normal displacement and use the
> NormalForce=kn*normal_displacement.</div>
>
> <div>&nbsp;</div>
> <div>but how can I calculate the deta shear displacement? it seems that I
> need to store the old position of each particles, which means a doubled
> storage of the memory and lower speed.</div>
> <div>&nbsp;</div>
> <div>could you please give me a hint, and which file is it in to calculate
> the shear force or the resultant forces?</div>
> <div>&nbsp;</div>
> <div>Thanks for your nice information in advance.</div>
> <div>&nbsp;</div>
> <div>Kan</div>
> <div>&nbsp;</div>
>
> ------=_Part_27553_5946959.1204734628668--
>
>
> ------------------------------
>
> Message: 3
> Date: Wed, 05 Mar 2008 19:19:13 +0100
> From: Bruno Chareyre <bruno.chareyre at hmg.inpg.fr>
> Subject: Re: [yade-dev] Could I ask the method to calculate the shear
>        forces?
> To: Yade Development Group <yade-dev at lists.berlios.de>
> Message-ID: <47CEE421.8090701 at hmg.inpg.fr>
> Content-Type: text/plain; charset=UTF-8; format=flowed
>
>
>
>
> kan a ?crit :
> > Hi, dear all,
> >
> > When I develop my code to calculate the shear force I meet some problem.
> > From the literature, we know that
> > Deta_Shear Force = ks*deta_shear_displacement
> > while the deta_shear_displacement is the deta displacement at the
> > shear direction at each contact.
> > my problem now is that, how to calculate this displacement ?
> >
> > I know for normal displacement at each contact, at each time step,
> > when we get the resultant displacement during this time step, then we
> > get the new position for each particle, so we can get the distance
> > between the center of the particles, which is the normal distance. so
> > we can get the normal displacement and use the
> > NormalForce=kn*normal_displacement.
> Its a matter of vocabulary.
> I think you make a confusion between "displacement" and "position". In
> the normal direction, you get at each time-step the "POSITION" (i.e.
> interpenetration), not the displacement.
> So that NormalForce=kn*interpenetration.
>
> >
> > but how can I calculate the deta shear displacement? it seems that I
> > need to store the old position of each particles, which means a
> > doubled storage of the memory and lower speed.
> shear_displacement = (velocity1 - velocity2 + r1*rotational_velocity1 -
> r2*rotational_velocity2)*dt
>
> This IS a displacement.
>
> So that shear_force = shear_force + shear_displacement*ks
>
> No need to store initial orientations.
>
> Check ElasticContactLaw.
>
> Bruno
>
> >
> > ------------------------------------------------------------------------
> >
> > _______________________________________________
> > yade-dev mailing list
> > yade-dev at lists.berlios.de
> > https://lists.berlios.de/mailman/listinfo/yade-dev
> >
>
>
> --
>
> _______________
> Chareyre Bruno
> Maitre de conference
>
> Institut National Polytechnique de Grenoble
> Laboratoire 3S (Soils Solids Structures) - bureau E145
> BP 53 - 38041, Grenoble cedex 9 - France
> T?l : 33 4 56 52 86 21
> Fax : 33 4 76 82 70 43
> ________________
>
>
>
> ------------------------------
>
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>
> End of yade-dev Digest, Vol 16, Issue 5
> ***************************************
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080306/62fc9ce0/attachment.html>

From janek_listy at wp.pl  Sun Mar  9 21:31:31 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Sun, 9 Mar 2008 21:31:31 +0100
Subject: [yade-dev] Triaxial classes "cerr" output
In-Reply-To: <47B9A72F.5060104@arcig.cz>
References: <98A90BEE3EE7E54680B190558276253BA5D818@GREXCHESV1.bvra.fr>
	<47B96AA0.9090508@arcig.cz> <47B99778.2080303@hmg.inpg.fr>
	<47B9A72F.5060104@arcig.cz>
Message-ID: <20080309213131.72ed9847@szpak>

V?clav S(milauer said:     (by the date of Mon, 18 Feb 2008 16:41:35 +0100)

> so that it is clear what is going on. If you say
> 
>  log4j.logger.yade.TriaxialCompressionEngine=DEBUG
> 
> you will see all messages from TriaxialCompressionEngine, for example.

Why not simply:

  TriaxialCompressionEngine=DEBUG

or

  yade.TriaxialCompressionEngine=DEBUG

but what else can be there than preceding "yade." ?


regards
-- 
Janek Kozicki                                                         |


From janek_listy at wp.pl  Sun Mar  9 21:40:01 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Sun, 9 Mar 2008 21:40:01 +0100
Subject: [yade-dev] TriaxialTest is broken in current SVN
In-Reply-To: <47BAFBE1.7020405@hmg.inpg.fr>
References: <47B9BC1B.8010901@hmg.inpg.fr> <47B9E9E3.7080102@arcig.cz>
	<47BAE41E.3030102@hmg.inpg.fr> <47BAE948.70708@arcig.cz>
	<47BAFBE1.7020405@hmg.inpg.fr>
Message-ID: <20080309214001.4a90a675@szpak>

Bruno Chareyre said:     (by the date of Tue, 19 Feb 2008 16:55:13 +0100)

> To balance some of previous mails : I just had a look at the doxygen doc 
> (about TriaxialTest).

note to self: I should make a cronjob that will automatically upload
latest doxygen docs to our website.

http://yade.berlios.de/doxygen/html/index.html

-- 
Janek Kozicki                                                         |


From eudoxos at arcig.cz  Sun Mar  9 22:20:51 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Sun, 09 Mar 2008 22:20:51 +0100
Subject: [yade-dev] Triaxial classes "cerr" output
In-Reply-To: <20080309213131.72ed9847@szpak>
References: <98A90BEE3EE7E54680B190558276253BA5D818@GREXCHESV1.bvra.fr>	<47B96AA0.9090508@arcig.cz>
	<47B99778.2080303@hmg.inpg.fr>	<47B9A72F.5060104@arcig.cz>
	<20080309213131.72ed9847@szpak>
Message-ID: <47D454B3.8090900@arcig.cz>

Janek Kozicki napsal(a):
> V?clav S(milauer said:     (by the date of Mon, 18 Feb 2008 16:41:35 +0100)
>
>   
>> so that it is clear what is going on. If you say
>>
>>  log4j.logger.yade.TriaxialCompressionEngine=DEBUG
>>
>> you will see all messages from TriaxialCompressionEngine, for example.
>>     
>
> Why not simply:
>
>   TriaxialCompressionEngine=DEBUG
>
> or
>
>   yade.TriaxialCompressionEngine=DEBUG
>
> but what else can be there than preceding "yade." ?
>   
This is the way it is in log4j ("property file", key=value type of
format that is standard for java apps; every key has to be qualified by
the module/class it belongs to) and log4cxx config files want to be
compatible with that. That's all. I did not write that config file
parser, it's been done thosand time already.

Regards, Vaclav



From janek_listy at wp.pl  Mon Mar 10 00:41:38 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Mon, 10 Mar 2008 00:41:38 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47BFC308.5010409@arcig.cz>
References: <47BDC895.8010608@hmg.inpg.fr> <20080221205239.68c2695b@absurd>
	<47BE747A.9070603@arcig.cz> <20080222231021.38b930f5@absurd>
	<47BFC308.5010409@arcig.cz>
Message-ID: <20080310004138.6184e384@szpak>

V?clav ?milauer said:     (by the date of Sat, 23 Feb 2008 07:54:00 +0100)

> For openMP, parallel loops must loop over numbers,
> so instead of interactionContainer iterator, it must be rewritten in
> something like this:
>  
>  #pragma parallel for
>  for(int i=0; i<interactions.size(); i++){
>     const Interaction& i(interactions[i]);
>   ...
>  }
> 
> You get the idea, right? If getting "interactions[i]" is just a bit
> slower than pointer arithmetics in old-style array or std::vector, it
> will be much slower in total, I think.

I'm not sure, gotta check this.

I want to point out that I prefer to parallelize stuff using
boost::thread, instead of openMP #pragma parallel. I would prefer to
fork several loops with boost thread, where each loop is for selected
start-end pairs.

Later, possibly, the start-end pairs can be adjusted depending on how
much time was spent on them.

-- 
Janek Kozicki                                                         |


From janek_listy at wp.pl  Mon Mar 10 00:48:57 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Mon, 10 Mar 2008 00:48:57 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47BFC0F9.3050502@arcig.cz>
References: <47BDC895.8010608@hmg.inpg.fr> <20080221205239.68c2695b@absurd>
	<47BECCFC.7040100@hmg.inpg.fr> <47BEF75B.4010300@hmg.inpg.fr>
	<47BFC0F9.3050502@arcig.cz>
Message-ID: <20080310004857.4fd07332@szpak>

V?clav S(milauer said:     (by the date of Sat, 23 Feb 2008 07:45:13 +0100)

> BTW Janek, for the class index: the index could be a (really) static
> variable, which would have to be allocated inside .cpp files (by some
> macro, say CREATE_CLASS_INDEX(className) would expand to "int
> className::index=-1", or even YADE_PLUGIN could do this for all classes
> it receives), in this way the plugin _loader_ would assign the index
> right after the plugin is loaded and you could get it simply by
> className::index (but the index would r/w and some _stupid_ user might
> fiddle with it).

that's an interesting idea. I should keep it in mind if it turns out
that boost cannot provide us with class indexes. But the real
question is - will it speed up things?
Maybe we could try that now... it shouldn't hurt too much.

-- 
Janek Kozicki                                                         |


From janek_listy at wp.pl  Mon Mar 10 01:33:40 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Mon, 10 Mar 2008 01:33:40 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47C57B8C.2050302@arcig.cz>
References: <47BDC895.8010608@hmg.inpg.fr> <20080221205239.68c2695b@absurd>
	<47BECCFC.7040100@hmg.inpg.fr> <47BEF75B.4010300@hmg.inpg.fr>
	<47BFC0F9.3050502@arcig.cz> <47C30736.5050403@hmg.inpg.fr>
	<47C3382A.6090503@arcig.cz> <47C41624.4050602@hmg.inpg.fr>
	<47C4418E.2010309@arcig.cz> <20080226183657.10a7be22@absurd>
	<47C54F38.5020404@hmg.inpg.fr> <47C57B8C.2050302@arcig.cz>
Message-ID: <20080310013340.38599bfe@szpak>

V?clav ?milauer said:     (by the date of Wed, 27 Feb 2008 16:02:36 +0100)

> > Time is spent in another function that I can't identify (named 
> > "0x000F..."), probably because it is a macro, an inlined function, or 
>
> That is a library function (boost, libstdc++, ...?) and the library was
> compiled without debugging symbols. If a function is inlined, it is not

There are debian packages like libstdc++6-dbg or libboost-dbg, if
they are installed, the compiler should link with them if compiled
with debug symbols. We should check if it works.

This would be extremely useful for Bruno.

-- 
Janek Kozicki                                                         |


From janek_listy at wp.pl  Mon Mar 10 03:21:50 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Mon, 10 Mar 2008 03:21:50 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47C3CAC4.2070609@arcig.cz>
References: <47BDC895.8010608@hmg.inpg.fr> <20080221205239.68c2695b@absurd>
	<47BECCFC.7040100@hmg.inpg.fr> <47BEF75B.4010300@hmg.inpg.fr>
	<47BFC0F9.3050502@arcig.cz> <47C30736.5050403@hmg.inpg.fr>
	<47C3382A.6090503@arcig.cz> <47C3CAC4.2070609@arcig.cz>
Message-ID: <20080310032150.79362b64@szpak>

V?clav S(milauer said:     (by the date of Tue, 26 Feb 2008 09:16:04 +0100)

> OK,  a few ideas for low-hanging optimizations. Tell me if you thing
> they will not work.
> 
> 1. LocateMultivirtualFunctor can cache last arguments as well as the
> return value at successful lookup. Since it typically does the same
> lookup over and over (takes 50% of Cundall damping), it could be reduced
> to almost zero (I think):
> 
>  if(index1==cachedIndex1 && index2==cachedIndex2) return cachedResult;
> /* at the beginning of LocateMultivirtualFunctor */
> 
> Given c++ short-circuits conditions, it will add one integer comparison
> if we have a "cache miss", no big deal.

yeah. I can't tell now, because I don't remember how I did this. I've
put weeks of effort into MultiMethods stuff (and I tried to make it
as fast as possible). So I'm curious why now it takes 40% of
execution time. After some digging in it I will remember what I've
been doing there.

 
> (BTW, Janek, couldn't we use some template and virtual functions magic
> to have the compiler do the dispatching code? There is plenty of stuff
> like that in boost, have a look at extending boost::range with new
> classes. Don't know how it works internally, though.

> We also probably would have to know all candidates at compile-time.)

Yes. That's the issue. If we know all candidates at compile time 
this and other stuff [*] can be optimized using templates.
Unfortunately the initial design was to allow adding plugins to
already compiled binaries. If we decided now to change this thing
(and tell compiler to make dispatching) - it will require to
recompile more stuff, when you add a new EngineUnit.

Maybe we should do this? I dunno. I'm sure there will be some speed gain.

And lot's of problems with dynamic plugin loading will disappear.

Serious drawback is that later it won't be possible to use yade as a
library (well, it's also not possible now ;). By using as a library I
mean - only headers and binaries are installed. You write some
engines in your homedir (outside of yade directory, which by the way
does not exist anywhere on the computer), compile them and they work
when you execute /usr/bin/yade binary (assuming that yade is
installed on the system just like eny other software).



> 2. I will create a new class CundallForceAndMomentumDamping, which will
> act on RigidBodyParameters and will be inside the same dispatcher as
> CundallnonViscousForceDamping (for ParticleParameters). This way, one

yeah, Bruno already did this :)

> loop over bodies will be gotten rid of. I know the force damping code
> will be duplicated at 2 places, but it is just a few lines of code.

About code duplication: Bruno told me that he doesn't care. And he
can copy hundreds of lines (single file) to write a new contact Law.
I consider this very bad, because when you find a bug, or improve
something so it works faster/better only a single copy is changed, and
all the others get out of sync. And finally you get a mess in which
you don't know what is fast and/or correct.


I want to avoid code duplication whenever possible. I believe there
is a way to do that without any speed penalty, we only need to think
about this a bit. And I'm willing to "shrink" yade code by removing
all duplicates.

First, obvious way, is to correctly inherit classes from each other,
and call virtual functions which contain the code (previously
duplicated).

Another way, if we decided to go template-way (see above [*]) is to
use template inlines, which would even remove the cost of calling
virtual function (the compiler will insert the right code directly
into the spot). I like this solution a bit. But all inheritance will
have to be done by templates, without virtual functions.

Static inheritance (by templates, on compile time) is mutually
exclusive with dynamic inheritance (by virtual calls, on runtime).
But is also faster. Due to C++ limitations we cannot mix both.


Oh, you may say that in yade they are mixed. So OK, to be more
correct: when you go from top to bottom of inheritance tree - once
you start dynamic inheritances you cannot go back and use static
inheritances in levels below. The solution I mentioned above assumes
that we have static inheritance at the very bottom of inheritance
tree.


regards
-- 
Janek Kozicki                                                         |


From janek_listy at wp.pl  Mon Mar 10 03:31:48 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Mon, 10 Mar 2008 03:31:48 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <47C3382A.6090503@arcig.cz>
References: <47BDC895.8010608@hmg.inpg.fr> <20080221205239.68c2695b@absurd>
	<47BECCFC.7040100@hmg.inpg.fr> <47BEF75B.4010300@hmg.inpg.fr>
	<47BFC0F9.3050502@arcig.cz> <47C30736.5050403@hmg.inpg.fr>
	<47C3382A.6090503@arcig.cz>
Message-ID: <20080310033148.1dfb32ad@szpak>

V?clav S(milauer said:     (by the date of Mon, 25 Feb 2008 22:50:34 +0100)


> Just change that in the header and make it public, no problem. If the
> "user" screws stuff, it it his problem, not mine. I think Olivier liked
> having lot of stuff private, but then we have overheads for for
> accessors.

if accessor methods are in *.hpp file they are ALWAYS inlined, and
there is zero overhead in call: the function call is directly
translated into direct variable access. Go ahead and test this by some
benchmark. Or even examine the produced assembly code, AFAIK there
was some flag to g++ to save assembly result in text file (not
binary).

Another thing: we should inline many methods :)


> Sadly, c++ has no way to say: this member is public for
> reading and private for writing, which could help in many cases.

Hm, there is a mutable keyword. But it wasn't intended for this sort
of use - I'm not sure if this would work correctly.


best regards
-- 
Janek Kozicki                                                         |


From janek_listy at wp.pl  Mon Mar 10 03:40:11 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Mon, 10 Mar 2008 03:40:11 +0100
Subject: [yade-dev] voting: what to fix?
Message-ID: <20080310034011.79efcdf0@szpak>

Hi,

Vaclav had a great idea today on IRC - we should make up some list
with what stuff is most important to fix. I want you to add there
things which you consider important. When the list grows big enough
we will start the voting phase.

See on the bottom of:

http://yade.wikia.com/wiki/Development_schedule


After the voting, people will offfer who does what (presumably
scratching his itch). I don't think there will be many volunteers for
writing documentation ;-p


thanks.
-- 
Janek Kozicki                                                         |


From eudoxos at arcig.cz  Mon Mar 10 15:17:02 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Mon, 10 Mar 2008 15:17:02 +0100
Subject: [yade-dev] Note on optimized compilation / optimized coding /
 profiling results
In-Reply-To: <20080310004138.6184e384@szpak>
References: <47BDC895.8010608@hmg.inpg.fr>
	<20080221205239.68c2695b@absurd>	<47BE747A.9070603@arcig.cz>
	<20080222231021.38b930f5@absurd>	<47BFC308.5010409@arcig.cz>
	<20080310004138.6184e384@szpak>
Message-ID: <47D542DE.2090008@arcig.cz>


> I want to point out that I prefer to parallelize stuff using
> boost::thread, instead of openMP #pragma parallel. I would prefer to
> fork several loops with boost thread, where each loop is for selected
> start-end pairs.
>   
OK, but openMP doesn't alter the code in any way unless tunrned on by
compiler flag. And later we can change stuff with boost::thread.
> Later, possibly, the start-end pairs can be adjusted depending on how
> much time was spent on them.
>   
openMP has support for (automatic or manual) load-balancing as well.

Anyway, the loops have to be over integer indices (with random access to
elements), not iterators. That's what I meant.


From dorofeenko at icp.ac.ru  Tue Mar 11 10:02:35 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Tue, 11 Mar 2008 12:02:35 +0300
Subject: [yade-dev] question about ElasticContactLaw
In-Reply-To: <mailman.48.1205146866.15357.yade-dev@lists.berlios.de>
References: <mailman.48.1205146866.15357.yade-dev@lists.berlios.de>
Message-ID: <200803111202.35711.dorofeenko@icp.ac.ru>

Hello.
What do doing the code on line 79-83 in ElasticContactLaw::action :

axis =currentContactPhysics->prevNormal.Cross(currentContactGeometry->normal);
shearForce -= shearForce.Cross(axis);
angle = 
dt*0.5*currentContactGeometry->normal.Dot(de1->angularVelocity+de2->angularVelocity);
axis = angle*currentContactGeometry->normal;
shearForce -= shearForce.Cross(axis);

Thanks.



From dorofeenko at icp.ac.ru  Tue Mar 11 10:29:29 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Tue, 11 Mar 2008 12:29:29 +0300
Subject: [yade-dev] new contact models
In-Reply-To: <mailman.48.1205146866.15357.yade-dev@lists.berlios.de>
References: <mailman.48.1205146866.15357.yade-dev@lists.berlios.de>
Message-ID: <200803111229.29858.dorofeenko@icp.ac.ru>

Hello.  

I want realize the viscoelastic contact model (Cundall-Strack) and
elastoplastic contact model (Walton-Braun) 
(from Phys. Rev. E, 2001, 65, 011302 
http://link.aps.org/abstract/PRE/v65/e011302).  

What can I do for this in the YADE framework? 

For example, viscoelastic model is

Fn = kn * xn + cn * vn // normal, xn - normal penetration, vn - normal 
velocity
Fs = ks * xs + cs * vs // tangential, xs - shear displacement, vs - shear 
velocity
Fs <= Fn*mu // Coulumb friction

where kn, ks, cn, cs is a functions of restitution coefficient and collision 
time.

Can I realize new PhysicalParameters class:

class EmpyreanBodyParameters : public RigidBodyParameters {
public:
    double tc; // collision time
    double epsilon; // restitution coefficient
    double mu; // friction coefficient
};

new InteractionPhysics class:

class CundallStrackInteraction : public InteractionPhysics {
public:
    double kn, ks; // elastic
    double cn, cs; // viscous
}

new InteractionPhysicsEngineUnit:

class CundallStrackPhysics : public InteractionPhysicsEngineUnit {
    tc, epsilon -> kn, kt, cn, cs
}

and new InteractionSolver class?

class CundallStrackContactLaw : public InteractionSolver {
    This is analog ElasticContactLaw but with viscous damping
}

Is this right?

Thanks.


From bruno.chareyre at hmg.inpg.fr  Tue Mar 11 11:18:55 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Tue, 11 Mar 2008 11:18:55 +0100
Subject: [yade-dev] question about ElasticContactLaw
In-Reply-To: <200803111202.35711.dorofeenko@icp.ac.ru>
References: <mailman.48.1205146866.15357.yade-dev@lists.berlios.de>
	<200803111202.35711.dorofeenko@icp.ac.ru>
Message-ID: <47D65C8F.8070707@hmg.inpg.fr>

sega a ?crit :
> Hello.
> What do doing the code on line 79-83 in ElasticContactLaw::action :
>
> axis =currentContactPhysics->prevNormal.Cross(currentContactGeometry->normal);
> shearForce -= shearForce.Cross(axis);
> angle = 
> dt*0.5*currentContactGeometry->normal.Dot(de1->angularVelocity+de2->angularVelocity);
> axis = angle*currentContactGeometry->normal;
> shearForce -= shearForce.Cross(axis);
>
> Thanks.
>
>   
They rotate current shear force according to contact rotation. So that 
if a pair of grain is subjected to a rigid body rotation (like a 360? 
turn without relative displacement between the grains), the force 
between grains is rotated as well.
Note that the same is done (implicitly) on the normal component, since 
Fn is always colinear with the normal, and the normal rotate with grains.

Bruno




> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Tue Mar 11 11:24:27 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Tue, 11 Mar 2008 11:24:27 +0100
Subject: [yade-dev] new contact models
In-Reply-To: <200803111229.29858.dorofeenko@icp.ac.ru>
References: <mailman.48.1205146866.15357.yade-dev@lists.berlios.de>
	<200803111229.29858.dorofeenko@icp.ac.ru>
Message-ID: <47D65DDB.2060705@hmg.inpg.fr>


Yes, you got the idea. It should work.
Remember to list your new classes in the scons file (again with existing 
classes as exemple) or they won't compile.
Also remember that you can commit the new code to the svn base.

Bruno


sega a ?crit :
> Hello.  
>
> I want realize the viscoelastic contact model (Cundall-Strack) and
> elastoplastic contact model (Walton-Braun) 
> (from Phys. Rev. E, 2001, 65, 011302 
> http://link.aps.org/abstract/PRE/v65/e011302).  
>
> What can I do for this in the YADE framework? 
>
> For example, viscoelastic model is
>
> Fn = kn * xn + cn * vn // normal, xn - normal penetration, vn - normal 
> velocity
> Fs = ks * xs + cs * vs // tangential, xs - shear displacement, vs - shear 
> velocity
> Fs <= Fn*mu // Coulumb friction
>
> where kn, ks, cn, cs is a functions of restitution coefficient and collision 
> time.
>
> Can I realize new PhysicalParameters class:
>
> class EmpyreanBodyParameters : public RigidBodyParameters {
> public:
>     double tc; // collision time
>     double epsilon; // restitution coefficient
>     double mu; // friction coefficient
> };
>
> new InteractionPhysics class:
>
> class CundallStrackInteraction : public InteractionPhysics {
> public:
>     double kn, ks; // elastic
>     double cn, cs; // viscous
> }
>
> new InteractionPhysicsEngineUnit:
>
> class CundallStrackPhysics : public InteractionPhysicsEngineUnit {
>     tc, epsilon -> kn, kt, cn, cs
> }
>
> and new InteractionSolver class?
>
> class CundallStrackContactLaw : public InteractionSolver {
>     This is analog ElasticContactLaw but with viscous damping
> }
>
> Is this right?
>
> Thanks.
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Wed Mar 12 09:19:58 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Wed, 12 Mar 2008 09:19:58 +0100
Subject: [yade-dev] moving qglviewer into our tree
Message-ID: <47D7922E.4020309@arcig.cz>

Hi,

given the never-ceasing troubles with qglviewer (no packages, packages
in hardy are broken, they work only with qt3 and not qt4 and so on), I
propose to copy the whole qglviewer sources to yade/lib. It is about 50
files/1Mb worth of sources (no examples, no docs, of course). I will
write simple scons stuff to compile that.

Since everything else is more or less packaged, it should make yade
installation much easier. Once qglviewer is packages properly, we can
always revert to packaged version. No changes in souce files will be
necessary.

What do you think? You know I am against doing this (wm3, etc.), but
this is just too much.

Regards, V?clav


From bruno.chareyre at hmg.inpg.fr  Wed Mar 12 14:22:20 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Wed, 12 Mar 2008 14:22:20 +0100
Subject: [yade-dev] moving qglviewer into our tree
In-Reply-To: <47D7922E.4020309@arcig.cz>
References: <47D7922E.4020309@arcig.cz>
Message-ID: <47D7D90C.5020607@hmg.inpg.fr>

You have my vote!
In fact I thought qglviewer package was fixed already... but  if it is 
not, go on.

Bruno

V?clav ?milauer a ?crit :
> Hi,
>
> given the never-ceasing troubles with qglviewer (no packages, packages
> in hardy are broken, they work only with qt3 and not qt4 and so on), I
> propose to copy the whole qglviewer sources to yade/lib. It is about 50
> files/1Mb worth of sources (no examples, no docs, of course). I will
> write simple scons stuff to compile that.
>
> Since everything else is more or less packaged, it should make yade
> installation much easier. Once qglviewer is packages properly, we can
> always revert to packaged version. No changes in souce files will be
> necessary.
>
> What do you think? You know I am against doing this (wm3, etc.), but
> this is just too much.
>
> Regards, V?clav
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From janek_listy at wp.pl  Wed Mar 12 16:28:05 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Wed, 12 Mar 2008 16:28:05 +0100
Subject: [yade-dev] moving qglviewer into our tree
In-Reply-To: <47D7922E.4020309@arcig.cz>
References: <47D7922E.4020309@arcig.cz>
Message-ID: <20080312162805.16bdf91b@szpak>

V?clav ?milauer said:     (by the date of Wed, 12 Mar 2008 09:19:58 +0100)

> What do you think? You know I am against doing this (wm3, etc.), but
> this is just too much.

I don't like the idea either. But if it's really necessary to make
python+qglviewer(+qt4) working please go on.

The best as I'd like it to see is:

- still have qt3 gui
- use python + qglviewer + qt4

both mutually exclusive due to possible qt3-dev qt4-dev compilation
conflicts, if there are really any. So you would say:

  scons exclude='qt3'       # and get python+qt4, or:
  scons exclude='qt4python' # and get qt3 gui AND python without qt4+qglviewer

is that possible, or maybe you see another way? (or use different
name for qt4python option)


But also, add an option to use local qglviewer, just like the
useMiniWm3 option. So finally, to use python+qglviewer(+qt4) you
would need to run scons as:

  scons exclude='qt3' useLocalQGLViewer=True

or, sth. like that. Is it how you see it happening? Or use different
names of course :)

-- 
Janek Kozicki                                                         |


From eudoxos at arcig.cz  Wed Mar 12 18:03:19 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Wed, 12 Mar 2008 18:03:19 +0100
Subject: [yade-dev] moving qglviewer into our tree
In-Reply-To: <20080312162805.16bdf91b@szpak>
References: <47D7922E.4020309@arcig.cz> <20080312162805.16bdf91b@szpak>
Message-ID: <47D80CD7.40000@arcig.cz>


> I don't like the idea either. But if it's really necessary to make
> python+qglviewer(+qt4) working please go on.
>   
In default builds, the 3d view in python will be disabled, so no need
for qt4, that is just my experimentation.

I've been (again) solving the problem with qglviewer debian package
during installation and that was the last drop.

I'll figure out something. Not sure whether using system libqglviewer
has any benefit (hence whether to have an option for that); with wm3, it
is the fact the our version is quite minimal, whereas here we will have
the full thing in-tree.

V.


From eudoxos at arcig.cz  Thu Mar 13 18:29:55 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Thu, 13 Mar 2008 18:29:55 +0100
Subject: [yade-dev] moving qglviewer into our tree
In-Reply-To: <20080312162805.16bdf91b@szpak>
References: <47D7922E.4020309@arcig.cz> <20080312162805.16bdf91b@szpak>
Message-ID: <47D96493.4050700@arcig.cz>

Janek, are you SURE some will want to use system-installed libqglviewer?
It adds some pain, because we need to make sure the right headers are
included, if both are present and versions are different. The local
thing works now nicely. V.



From eudoxos at arcig.cz  Thu Mar 13 21:12:15 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Thu, 13 Mar 2008 21:12:15 +0100
Subject: [yade-dev] moving qglviewer into our tree
In-Reply-To: <47D96493.4050700@arcig.cz>
References: <47D7922E.4020309@arcig.cz> <20080312162805.16bdf91b@szpak>
	<47D96493.4050700@arcig.cz>
Message-ID: <47D98A9F.9010604@arcig.cz>

Please do not use current trunk 1275, that qglviewer thing has some
underined references in it. I will have to figure it out tomorrow. V.
> Janek, are you SURE some will want to use system-installed libqglviewer?
> It adds some pain, because we need to make sure the right headers are
> included, if both are present and versions are different. The local
> thing works now nicely. V.
>
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   



From eudoxos at arcig.cz  Thu Mar 13 21:37:52 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Thu, 13 Mar 2008 21:37:52 +0100
Subject: [yade-dev] moving qglviewer into our tree
In-Reply-To: <47D98A9F.9010604@arcig.cz>
References: <47D7922E.4020309@arcig.cz>
	<20080312162805.16bdf91b@szpak>	<47D96493.4050700@arcig.cz>
	<47D98A9F.9010604@arcig.cz>
Message-ID: <47D990A0.9010903@arcig.cz>

>
> Please do not use current trunk 1275, that qglviewer thing has some
> underined references in it. I will have to figure it out tomorrow. V.
>   
It should be OK as of rev 1276. Easier than I thought. Good night. V.


From janek_listy at wp.pl  Fri Mar 14 03:13:51 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Fri, 14 Mar 2008 03:13:51 +0100
Subject: [yade-dev] learning scons
Message-ID: <20080314031351.245acf4a@szpak>

Hi Vaclav, what should I read?

434 pages!   http://www.scons.org/doc/PDF/scons-api.pdf
42 pages:    http://www.scons.org/doc/PDF/scons-design.pdf
14 pages:    http://www.scons.org/doc/PDF/scons-reference.pdf
202 pages!   http://www.scons.org/doc/PDF/scons-user.pdf

I thought to print something and read it, while I travel to Poland in
a bus (almost 30 hours).

-- 
Janek Kozicki                                                         |


From janek_listy at wp.pl  Fri Mar 14 03:33:22 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Fri, 14 Mar 2008 03:33:22 +0100
Subject: [yade-dev] moving qglviewer into our tree
In-Reply-To: <47D990A0.9010903@arcig.cz>
References: <47D7922E.4020309@arcig.cz> <20080312162805.16bdf91b@szpak>
	<47D96493.4050700@arcig.cz> <47D98A9F.9010604@arcig.cz>
	<47D990A0.9010903@arcig.cz>
Message-ID: <20080314033322.58dba828@szpak>

V?clav S(milauer said:     (by the date of Thu, 13 Mar 2008 21:37:52 +0100)

> >
> > Please do not use current trunk 1275, that qglviewer thing has some
> > underined references in it. I will have to figure it out tomorrow. V.
> >   
> It should be OK as of rev 1276. Easier than I thought. Good night. V.

so what are the scons options to choose between qt3 gui, and
python+qglviewer+qt4 ?

-- 
Janek Kozicki                                                         |


From eudoxos at arcig.cz  Fri Mar 14 07:18:38 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Fri, 14 Mar 2008 07:18:38 +0100
Subject: [yade-dev] learning scons
In-Reply-To: <20080314031351.245acf4a@szpak>
References: <20080314031351.245acf4a@szpak>
Message-ID: <47DA18BE.5030508@arcig.cz>


> 202 pages!   http://www.scons.org/doc/PDF/scons-user.pdf
>   
I think this one, to get the idea. (And the manpage, which is the most
up-to-date reference.)

For python, see http://wiki.python.org/moin/BeginnersGuide/Programmers,
in particular http://docs.python.org/tut/ (PDF is inside
http://docs.python.org/ftp/python/doc/2.5/pdf-a4-2.5.zip )
> I thought to print something and read it, while I travel to Poland in
> a bus (almost 30 hours).
>   
Good luck... :-|

V.



From dorofeenko at icp.ac.ru  Mon Mar 24 07:32:24 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Mon, 24 Mar 2008 09:32:24 +0300
Subject: [yade-dev] new contact model
In-Reply-To: <mailman.47.1205492470.17147.yade-dev@lists.berlios.de>
References: <mailman.47.1205492470.17147.yade-dev@lists.berlios.de>
Message-ID: <200803240932.25071.dorofeenko@icp.ac.ru>

Hello.
1. I provided viscoelastic contact model. How can I submit it to YADE?

2. yade-svn1283 crashed after Edit->Preferences:

terminate called after throwing an instance of 'FactoryCantCreate'
  what():  ClassFactory::create - cannot create class named: 
QtPreferencesEditor


From dorofeenko at icp.ac.ru  Mon Mar 24 08:05:40 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Mon, 24 Mar 2008 10:05:40 +0300
Subject: [yade-dev] cmdGui
In-Reply-To: <mailman.47.1205492470.17147.yade-dev@lists.berlios.de>
References: <mailman.47.1205492470.17147.yade-dev@lists.berlios.de>
Message-ID: <200803241005.40404.dorofeenko@icp.ac.ru>

I can't load file a.xml generated by simple-scene.py.
Loading stoped after message:
"INFO  core/Omega.cpp:326 loadSimulation: Loading file a.xml"
File a.xml contain strange symbols, for example as viewing in vim:
line 10 <functorArguments^C^@^@^@ _className_=...
I attached this a.xml.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: a.xml.gz
Type: application/x-gzip
Size: 1444 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080324/06961f2c/attachment.bin>

From janek_listy at wp.pl  Mon Mar 24 09:33:23 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Mon, 24 Mar 2008 09:33:23 +0100
Subject: [yade-dev] new contact model
In-Reply-To: <200803240932.25071.dorofeenko@icp.ac.ru>
References: <mailman.47.1205492470.17147.yade-dev@lists.berlios.de>
	<200803240932.25071.dorofeenko@icp.ac.ru>
Message-ID: <20080324093323.2ab32fab@absurd>

sega said:     (by the date of Mon, 24 Mar 2008 09:32:24 +0300)

> Hello.
> 1. I provided viscoelastic contact model. How can I submit it to YADE?

please create an account on berlios.de and give us your login name. I
will add you to the project, and you will have direct SVN write access.


> 2. yade-svn1283 crashed after Edit->Preferences:
> 
> terminate called after throwing an instance of 'FactoryCantCreate'
>   what():  ClassFactory::create - cannot create class named: 
> QtPreferencesEditor

I think that Vaclav has just deleted it. yade auto detects
directories now, so perhaps it's unnecessary - unless someone wants
to add some other extra directories. Vaclav, what do you think?

-- 
Janek Kozicki                                                         |


From janek_listy at wp.pl  Mon Mar 24 12:03:57 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Mon, 24 Mar 2008 12:03:57 +0100
Subject: [yade-dev] new contact model
In-Reply-To: <200803241219.11913.dorofeenko@icp.ac.ru>
References: <mailman.47.1205492470.17147.yade-dev@lists.berlios.de>
	<200803240932.25071.dorofeenko@icp.ac.ru>
	<20080324093323.2ab32fab@absurd>
	<200803241219.11913.dorofeenko@icp.ac.ru>
Message-ID: <20080324120357.657d132d@absurd>

sega said:     (by the date of Mon, 24 Mar 2008 12:19:11 +0300)

> My login on berlios.de is sega

OK, welcome on board! Write access should work for you now.

have a look at

http://yade.wikia.com/wiki/Quick_subversion_tutorial

-- 
Janek Kozicki                                                         |


From eudoxos at arcig.cz  Tue Mar 25 09:38:46 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Tue, 25 Mar 2008 09:38:46 +0100
Subject: [yade-dev] cmdGui
In-Reply-To: <200803241005.40404.dorofeenko@icp.ac.ru>
References: <mailman.47.1205492470.17147.yade-dev@lists.berlios.de>
	<200803241005.40404.dorofeenko@icp.ac.ru>
Message-ID: <47E8BA16.4090206@arcig.cz>


> I can't load file a.xml generated by simple-scene.py.
> Loading stoped after message:
> "INFO  core/Omega.cpp:326 loadSimulation: Loading file a.xml"
> File a.xml contain strange symbols, for example as viewing in vim:
> line 10 <functorArguments^C^@^@^@ _className_=...
> I attached this a.xml.
>   
Hi, I am wondering what the cause of that might be, since serialization
to xml is completely independent of python and cmdGui. It seems there is
some binary garbage instead of the first tag. Are you running the latest
SVN? I am attaching my a.xml, which works very well. Can you try loading
it and the saving again (run "yade-something -N cmdGui", then type
o=Omega(); o.load('a.xml'); o.save('b.xml'); ) to see if you get correct
output or not?

Regards, Vaclav

-------------- next part --------------
A non-text attachment was scrubbed...
Name: a.xml
Type: text/xml
Size: 6281 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080325/c01c08e1/attachment.xml>

From janek_listy at wp.pl  Tue Mar 25 11:58:57 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Tue, 25 Mar 2008 11:58:57 +0100
Subject: [yade-dev] new contact model
In-Reply-To: <20080324120357.657d132d@absurd>
References: <mailman.47.1205492470.17147.yade-dev@lists.berlios.de>
	<200803240932.25071.dorofeenko@icp.ac.ru>
	<20080324093323.2ab32fab@absurd>
	<200803241219.11913.dorofeenko@icp.ac.ru>
	<20080324120357.657d132d@absurd>
Message-ID: <20080325115857.5d3d6eb3@absurd>

Hi,

Please don't be afraid to commit new things to SVN repo. Everyone
will benefit from your work, and if you are worried to make any
mistake - it's always easy to fix - because in SVN we have a full
history of all changes ;-)

Would be kind if you also added yourself to contributors:

http://yade.wikia.com/wiki/Authors

thanks!
-- 
Janek Kozicki                                                         |


From eudoxos at arcig.cz  Tue Mar 25 12:18:42 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 25 Mar 2008 12:18:42 +0100
Subject: [yade-dev] new contact model
In-Reply-To: <20080324093323.2ab32fab@absurd>
References: <mailman.47.1205492470.17147.yade-dev@lists.berlios.de>	<200803240932.25071.dorofeenko@icp.ac.ru>
	<20080324093323.2ab32fab@absurd>
Message-ID: <47E8DF92.20907@arcig.cz>


>> 2. yade-svn1283 crashed after Edit->Preferences:
>>
>> terminate called after throwing an instance of 'FactoryCantCreate'
>>   what():  ClassFactory::create - cannot create class named: 
>> QtPreferencesEditor
>>     
>
> I think that Vaclav has just deleted it. yade auto detects
> directories now, so perhaps it's unnecessary - unless someone wants
> to add some other extra directories. Vaclav, what do you think?
>   
My fault, I probably forgot to delete that entry form the menu. I wanted
to scrap useless stuff from the qt3 gui so that porting is easier, but
it didn't happen. You can edit ~/yade-*/preferences.xml by hand to
add/remove a dir though.



From dorofeenko at icp.ac.ru  Tue Mar 25 16:19:14 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Tue, 25 Mar 2008 18:19:14 +0300
Subject: [yade-dev] cmdGui
In-Reply-To: <mailman.55.1206442881.24454.yade-dev@lists.berlios.de>
References: <mailman.55.1206442881.24454.yade-dev@lists.berlios.de>
Message-ID: <200803251819.14526.dorofeenko@icp.ac.ru>

> Are you running the latest SVN? 
revision 1283
> I am attaching my a.xml, which works very well. Can you try loading 
> it and the saving again (run "yade-something -N cmdGui", then type
> o=Omega(); o.load('a.xml'); o.save('b.xml'); ) to see if you get correct
> output or not?

Yes, load, save and run this file is ok. 
Furthermore, default-test.py is correct and own scripts too.
For example,  this works correct:
$ yade -N cmdGui
>>> o=Omega()
>>> pp=Preprocessor('SDECSpheresPlane')
>>> pp.generate('scene.xml')
>>> o.load('scene.xml')
>>> import os
>>> os.system(yadeExecutable+' -N QtGUI -S ./sceneB.xml')






From eudoxos at arcig.cz  Tue Mar 25 20:01:56 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 25 Mar 2008 20:01:56 +0100
Subject: [yade-dev] cmdGui
In-Reply-To: <200803251819.14526.dorofeenko@icp.ac.ru>
References: <mailman.55.1206442881.24454.yade-dev@lists.berlios.de>
	<200803251819.14526.dorofeenko@icp.ac.ru>
Message-ID: <47E94C24.6040804@arcig.cz>

Call for testers: can someone test the simple-scene.py so that I am able
to figure out what those failures have in common, if they are reproduced?
>> Are you running the latest SVN? 
>>     
> revision 1283
>   
Would you mind trying 1284 (I don't suspect that, but I am at loss about
what the cause might be)?

Second guess: what g++ version do you use? What arch? I am unable to
test on 32bit i386, all my machines are native amd64. (There is some
typeid() logic in IOFormatManager and maybe older compilers get it wrong?)
>> I am attaching my a.xml, which works very well. Can you try loading 
>> it and the saving again (run "yade-something -N cmdGui", then type
>> o=Omega(); o.load('a.xml'); o.save('b.xml'); ) to see if you get correct
>> output or not?
>>     
>
> Yes, load, save and run this file is ok. 
> Furthermore, default-test.py is correct and own scripts too.
> For example,  this works correct:
> $ yade -N cmdGui
>   
>>>> o=Omega()
>>>> pp=Preprocessor('SDECSpheresPlane')
>>>> pp.generate('scene.xml')
>>>> o.load('scene.xml')
>>>> import os
>>>> os.system(yadeExecutable+' -N QtGUI -S ./sceneB.xml')
>>>>         
The difference is that here you run a preprocessor (c++ code) to
generate the scene. On the other hand, simple-scene.py is entirely in
python. But I can't see how that does affect serializer so that it spews
binary instead of XML for those tags.

Janek, you know the serializer well, can you comment on that? Are you
able to reproduce it? (I am not.)

Regards, Vaclav


From janek_listy at wp.pl  Tue Mar 25 20:48:28 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Tue, 25 Mar 2008 20:48:28 +0100
Subject: [yade-dev] cmdGui
In-Reply-To: <47E94C24.6040804@arcig.cz>
References: <mailman.55.1206442881.24454.yade-dev@lists.berlios.de>
	<200803251819.14526.dorofeenko@icp.ac.ru>
	<47E94C24.6040804@arcig.cz>
Message-ID: <20080325204828.4f4c0560@absurd>

V?clav S(milauer said:     (by the date of Tue, 25 Mar 2008 20:01:56 +0100)

> I am unable to test on 32bit i386, all my machines are native amd64.
> (There is some typeid() logic in IOFormatManager and maybe older compilers get it wrong?)

I can create an account for you on my computer I use in Grenoble. It's 32bit.

> Janek, you know the serializer well, can you comment on that? Are you
> able to reproduce it? (I am not.)

not yet, I need to reproduce first. I will try...

-- 
Janek Kozicki                                                         |


From dorofeenko at icp.ac.ru  Wed Mar 26 08:23:01 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Wed, 26 Mar 2008 10:23:01 +0300
Subject: [yade-dev] svn-1284 compile error
In-Reply-To: <mailman.55.1206442881.24454.yade-dev@lists.berlios.de>
References: <mailman.55.1206442881.24454.yade-dev@lists.berlios.de>
Message-ID: <200803261023.01711.dorofeenko@icp.ac.ru>

Hello. I have following compile error after update to svn-1284:

gui/cmd/yadeControl.cpp:271:   instantiated from here
/usr/local/include/boost/shared_ptr.hpp:199: error: invalid static_cast from type 'Factorable* const' to type 'Indexable*'

ps. I add linear viscoelastic contact model in svn-1285 but email to yade-commits been rejected due to my fault.


From janek_listy at wp.pl  Wed Mar 26 10:29:00 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Wed, 26 Mar 2008 10:29:00 +0100
Subject: [yade-dev] svn-1284 compile error
In-Reply-To: <200803261023.01711.dorofeenko@icp.ac.ru>
References: <mailman.55.1206442881.24454.yade-dev@lists.berlios.de>
	<200803261023.01711.dorofeenko@icp.ac.ru>
Message-ID: <20080326102900.649c195e@absurd>

sega said:     (by the date of Wed, 26 Mar 2008 10:23:01 +0300)

> Hello. I have following compile error after update to svn-1284:
> 
> gui/cmd/yadeControl.cpp:271:   instantiated from here
> /usr/local/include/boost/shared_ptr.hpp:199: error: invalid static_cast from type 'Factorable* const' to type 'Indexable*'

yes, I got this too. It occurs only in optimized builds, the fix is
to replace YADE_PTR_CAST by dynamic_pointer_cast in
yadeControl.cpp:271

You can commit that fix if you want, or we can wait for Vaclav,
because that's his code.


> ps. I add linear viscoelastic contact model in svn-1285 but email to 
> yade-commits been rejected due to my fault.

Great, do you have that email somewhere? Would be useful if you can send it
again to yade-commits (or even yade-dev) - I like to browse commits when
looking through my inbox ;-)


-- 
Janek Kozicki                                                         |


From dorofeenko at icp.ac.ru  Wed Mar 26 10:38:26 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Wed, 26 Mar 2008 12:38:26 +0300
Subject: [yade-dev] Fwd: r1285 - in trunk/pkg/dem: .
	DataClass/InteractionPhysics DataClass/PhysicalParameters
	Engine/EngineUnit Engine/StandAloneEngine PreProcessor
	RenderingEngine RenderingEngine/GLDrawSimpleViscoelasticInteraction
Message-ID: <200803261238.26791.dorofeenko@icp.ac.ru>

Author: sega
Date: 2008-03-25 20:13:54 +0100 (Tue, 25 Mar 2008)
New Revision: 1285

Added:
   trunk/pkg/dem/DataClass/InteractionPhysics/SimpleViscoelasticInteraction.cpp
   trunk/pkg/dem/DataClass/InteractionPhysics/SimpleViscoelasticInteraction.hpp
   trunk/pkg/dem/DataClass/PhysicalParameters/SimpleViscoelasticBodyParameters.cpp
   trunk/pkg/dem/DataClass/PhysicalParameters/SimpleViscoelasticBodyParameters.hpp
   trunk/pkg/dem/Engine/EngineUnit/SimpleViscoelasticRelationships.cpp
   trunk/pkg/dem/Engine/EngineUnit/SimpleViscoelasticRelationships.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/RigidBodyRecorder.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/RigidBodyRecorder.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticContactLaw.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticContactLaw.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticSpheresInteractionRecorder.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticSpheresInteractionRecorder.hpp
   trunk/pkg/dem/PreProcessor/TestSimpleViscoelastic.cpp
   trunk/pkg/dem/PreProcessor/TestSimpleViscoelastic.hpp
   trunk/pkg/dem/RenderingEngine/GLDrawSimpleViscoelasticInteraction/
   trunk/pkg/dem/RenderingEngine/GLDrawSimpleViscoelasticInteraction/GLDrawSimpleViscoelasticInteraction.cpp
   trunk/pkg/dem/RenderingEngine/GLDrawSimpleViscoelasticInteraction/GLDrawSimpleViscoelasticInteraction.hpp
Modified:
   trunk/pkg/dem/SConscript
Log:
Add linear viscoelastic contact model


Added: trunk/pkg/dem/DataClass/InteractionPhysics/SimpleViscoelasticInteraction.cpp
===================================================================
--- trunk/pkg/dem/DataClass/InteractionPhysics/SimpleViscoelasticInteraction.cpp	2008-03-25 09:54:02 UTC (rev 1284)
+++ trunk/pkg/dem/DataClass/InteractionPhysics/SimpleViscoelasticInteraction.cpp	2008-03-25 19:13:54 UTC (rev 1285)
@@ -0,0 +1,31 @@
+/*************************************************************************
+*  Copyright (C) 2008 by Dorofeenko Sergei                               *
+*  sega at users.berlios.de						 *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#include "SimpleViscoelasticInteraction.hpp"
+
+
+SimpleViscoelasticInteraction::SimpleViscoelasticInteraction()
+{
+	createIndex();
+}
+
+SimpleViscoelasticInteraction::~SimpleViscoelasticInteraction()
+{
+}
+
+void SimpleViscoelasticInteraction::registerAttributes()
+{
+	REGISTER_ATTRIBUTE(kn);
+	REGISTER_ATTRIBUTE(ks);
+	REGISTER_ATTRIBUTE(cn);
+	REGISTER_ATTRIBUTE(cs);
+	REGISTER_ATTRIBUTE(prevNormal);
+	REGISTER_ATTRIBUTE(normalForce);
+	REGISTER_ATTRIBUTE(shearForce);
+}
+YADE_PLUGIN();

Added: trunk/pkg/dem/DataClass/InteractionPhysics/SimpleViscoelasticInteraction.hpp
===================================================================
--- trunk/pkg/dem/DataClass/InteractionPhysics/SimpleViscoelasticInteraction.hpp	2008-03-25 09:54:02 UTC (rev 1284)
+++ trunk/pkg/dem/DataClass/InteractionPhysics/SimpleViscoelasticInteraction.hpp	2008-03-25 19:13:54 UTC (rev 1285)
@@ -0,0 +1,50 @@
+/*************************************************************************
+*  Copyright (C) 2008 by Sergei Dorofeenko                               *
+*  sega at users.berlios.de						 *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#ifndef SIMPLEVISCOELASTICINTERACTION_HPP 
+#define SIMPLEVISCOELASTICINTERACTION_HPP
+
+#include<yade/core/InteractionPhysics.hpp>
+
+class SimpleViscoelasticInteraction : public InteractionPhysics
+{
+	public :
+	    
+	    /// Normal interaction elastic constants.
+	    Real kn;
+	    /// Normal interaction viscous constants.
+	    Real cn;
+	    /// Shear interaction elastic constants.
+	    Real ks;
+	    /// Shear interaction viscous constants.
+	    Real cs;
+	    /// Coulomb friction
+	    Real mu;
+	    /// Unit normal of the contact plane
+	    Vector3r prevNormal;
+	    /// Normal force
+	    Vector3r normalForce;
+	    /// Incremental shear force
+	    Vector3r shearForce;
+	
+		SimpleViscoelasticInteraction();
+		virtual ~SimpleViscoelasticInteraction();
+	protected :
+		virtual void registerAttributes();
+
+	REGISTER_CLASS_NAME(SimpleViscoelasticInteraction);
+	REGISTER_BASE_CLASS_NAME(InteractionPhysics);
+
+	REGISTER_CLASS_INDEX(SimpleViscoelasticInteraction,InteractionPhysics);
+
+};
+
+REGISTER_SERIALIZABLE(SimpleViscoelasticInteraction,false);
+
+#endif // SIMPLEVISCOELASTICINTERACTION_HPP
+

Added: trunk/pkg/dem/DataClass/PhysicalParameters/SimpleViscoelasticBodyParameters.cpp
===================================================================
--- trunk/pkg/dem/DataClass/PhysicalParameters/SimpleViscoelasticBodyParameters.cpp	2008-03-25 09:54:02 UTC (rev 1284)
+++ trunk/pkg/dem/DataClass/PhysicalParameters/SimpleViscoelasticBodyParameters.cpp	2008-03-25 19:13:54 UTC (rev 1285)
@@ -0,0 +1,41 @@
+/*************************************************************************
+*  Copyright (C) 2008 by Sergei Dorofeenko				 *
+*  sega at users.berlios.de						 *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#include "SimpleViscoelasticBodyParameters.hpp"
+
+SimpleViscoelasticBodyParameters::SimpleViscoelasticBodyParameters() : RigidBodyParameters()
+{
+	createIndex();
+}
+
+SimpleViscoelasticBodyParameters::~SimpleViscoelasticBodyParameters()
+{
+}
+
+void SimpleViscoelasticBodyParameters::registerAttributes()
+{
+	RigidBodyParameters::registerAttributes();
+	REGISTER_ATTRIBUTE(kn);
+	REGISTER_ATTRIBUTE(ks);
+	REGISTER_ATTRIBUTE(cn);
+	REGISTER_ATTRIBUTE(cs);
+	REGISTER_ATTRIBUTE(mu);
+}
+
+void SimpleViscoelasticBodyParameters::setViscoelastic(Real m, Real tc, Real en, Real es)
+{
+    kn = m/tc/tc * ( Mathr::PI*Mathr::PI + Mathr::Pow(Mathr::Log(en),2) );
+    cn = -2.0*m/tc * Mathr::Log(en);
+    ks = 2.0/7.0 * m/tc/tc * ( Mathr::PI*Mathr::PI + Mathr::Pow(Mathr::Log(es),2) );
+    cs = -2.0/7.0 * m/tc * Mathr::Log(es);
+
+    if (Math<Real>::FAbs(cn) <= Math<Real>::ZERO_TOLERANCE ) cn=0;
+    if (Math<Real>::FAbs(cs) <= Math<Real>::ZERO_TOLERANCE ) cs=0;
+}
+YADE_PLUGIN();
+

Added: trunk/pkg/dem/DataClass/PhysicalParameters/SimpleViscoelasticBodyParameters.hpp
===================================================================
--- trunk/pkg/dem/DataClass/PhysicalParameters/SimpleViscoelasticBodyParameters.hpp	2008-03-25 09:54:02 UTC (rev 1284)
+++ trunk/pkg/dem/DataClass/PhysicalParameters/SimpleViscoelasticBodyParameters.hpp	2008-03-25 19:13:54 UTC (rev 1285)
@@ -0,0 +1,48 @@
+/*************************************************************************
+*  Copyright (C) 2008 by Sergei Dorofeenko				 *
+*  sega at users.berlios.de						 *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#ifndef SIMPLEVISCOELASTICBODYPARAMETERS_HPP
+#define SIMPLEVISCOELASTICBODYPARAMETERS_HPP
+
+#include <yade/pkg-common/RigidBodyParameters.hpp>
+
+class SimpleViscoelasticBodyParameters : public RigidBodyParameters {	
+	public :
+
+	    /// Normal elastic constants of the body
+	    Real kn; 
+	    /// Normal viscous constants of the body
+	    Real cn; 
+	    /// Shear elastic constants of the body
+	    Real ks; 
+	    /// Shear viscous constants of the body
+	    Real cs; 
+	    /// Coulomb friction
+	    Real mu; 
+	
+		SimpleViscoelasticBodyParameters();
+		virtual ~SimpleViscoelasticBodyParameters();
+
+	    /// Set viscoelastic parameters kn,cn,ks,cs of the sphere from its
+	    /// mass m, collision time tc and restitution coefficients en,es.
+	    void setViscoelastic(Real m, Real tc, Real en, Real es);
+
+	protected :
+		/// Serialization
+		void registerAttributes();
+	REGISTER_CLASS_NAME(SimpleViscoelasticBodyParameters);
+	REGISTER_BASE_CLASS_NAME(RigidBodyParameters);
+	
+/// Indexable	
+	REGISTER_CLASS_INDEX(SimpleViscoelasticBodyParameters,RigidBodyParameters);
+};
+
+REGISTER_SERIALIZABLE(SimpleViscoelasticBodyParameters,false);
+
+#endif // SIMPLEVISCOELASTICBODYPARAMETERS_HPP
+

Added: trunk/pkg/dem/Engine/EngineUnit/SimpleViscoelasticRelationships.cpp
===================================================================
--- trunk/pkg/dem/Engine/EngineUnit/SimpleViscoelasticRelationships.cpp	2008-03-25 09:54:02 UTC (rev 1284)
+++ trunk/pkg/dem/Engine/EngineUnit/SimpleViscoelasticRelationships.cpp	2008-03-25 19:13:54 UTC (rev 1285)
@@ -0,0 +1,54 @@
+/*************************************************************************
+*  Copyright (C) 2008 by Dorofeenko Sergei				 *
+*  sega at users.berlios.de						 *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#include"SimpleViscoelasticRelationships.hpp"
+#include<yade/pkg-dem/SimpleViscoelasticBodyParameters.hpp>
+#include<yade/pkg-dem/SimpleViscoelasticInteraction.hpp>
+#include<yade/pkg-dem/SpheresContactGeometry.hpp>
+#include<yade/core/Omega.hpp>
+#include<yade/core/MetaBody.hpp>
+
+
+SimpleViscoelasticRelationships::SimpleViscoelasticRelationships()
+{
+}
+
+
+void SimpleViscoelasticRelationships::registerAttributes()
+{
+}
+
+
+void SimpleViscoelasticRelationships::go(	  const shared_ptr<PhysicalParameters>& b1 // SimpleViscoelasticBodyParameters
+					, const shared_ptr<PhysicalParameters>& b2 // SimpleViscoelasticBodyParameters
+					, const shared_ptr<Interaction>& interaction)
+{
+    if( !interaction->isNew ) return;
+
+    SimpleViscoelasticBodyParameters* sdec1 = static_cast<SimpleViscoelasticBodyParameters*>(b1.get());
+    SimpleViscoelasticBodyParameters* sdec2 = static_cast<SimpleViscoelasticBodyParameters*>(b2.get());
+    
+    interaction->interactionPhysics = shared_ptr<SimpleViscoelasticInteraction>(new SimpleViscoelasticInteraction());
+    SimpleViscoelasticInteraction* contactPhysics = YADE_CAST<SimpleViscoelasticInteraction*>(interaction->interactionPhysics.get());
+
+    contactPhysics->kn = sdec1->kn * sdec2->kn / (sdec1->kn + sdec2->kn);
+    contactPhysics->ks = sdec1->ks * sdec2->ks / (sdec1->ks + sdec2->ks);
+    
+    contactPhysics->cn = ( (sdec1->cn==0) ? 0 : 1/sdec1->cn ) + ( (sdec2->cn==0) ? 0 : 1/sdec2->cn );
+    contactPhysics->cs = ( (sdec1->cs==0) ? 0 : 1/sdec1->cs ) + ( (sdec2->cs==0) ? 0 : 1/sdec2->cs );
+    if (contactPhysics->cn) contactPhysics->cn = 1/contactPhysics->cn;
+    if (contactPhysics->cs) contactPhysics->cs = 1/contactPhysics->cs;
+   
+    contactPhysics->mu = std::min(sdec1->mu, sdec2->mu); // FIXME: May be (mu1+mu2)/2???
+
+    contactPhysics->shearForce = Vector3r(0,0,0);
+    contactPhysics->prevNormal = Vector3r(0,0,0);
+
+}
+
+YADE_PLUGIN();

Added: trunk/pkg/dem/Engine/EngineUnit/SimpleViscoelasticRelationships.hpp
===================================================================
--- trunk/pkg/dem/Engine/EngineUnit/SimpleViscoelasticRelationships.hpp	2008-03-25 09:54:02 UTC (rev 1284)
+++ trunk/pkg/dem/Engine/EngineUnit/SimpleViscoelasticRelationships.hpp	2008-03-25 19:13:54 UTC (rev 1285)
@@ -0,0 +1,38 @@
+/*************************************************************************
+*  Copyright (C) 2008 by Sergei Dorofeenko				 *
+*  sega at users.berlios.de						 *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#ifndef SIMPLEVISCOELASTICRELATIIONSHIPS_HPP 
+#define SIMPLEVISCOELASTICRELATIIONSHIPS_HPP
+
+#include<yade/pkg-common/InteractionPhysicsEngineUnit.hpp>
+
+/// From viscoelastic parameters of the pair bodys provides
+/// viscoelastic parameters of their interaction by the rule of consecutively connection.
+class SimpleViscoelasticRelationships : public InteractionPhysicsEngineUnit
+{
+	public :
+
+		SimpleViscoelasticRelationships();
+
+		virtual void go(	const shared_ptr<PhysicalParameters>& b1,
+					const shared_ptr<PhysicalParameters>& b2,
+					const shared_ptr<Interaction>& interaction);
+
+	protected :
+		virtual void registerAttributes();
+
+	FUNCTOR2D(SimpleViscoelasticBodyParameters,SimpleViscoelasticBodyParameters);
+	REGISTER_CLASS_NAME(SimpleViscoelasticRelationships);
+	REGISTER_BASE_CLASS_NAME(InteractionPhysicsEngineUnit);
+
+};
+
+REGISTER_SERIALIZABLE(SimpleViscoelasticRelationships,false);
+
+#endif // SIMPLEVISCOELASTICRELATIIONSHIPS_HPP
+

Added: trunk/pkg/dem/Engine/StandAloneEngine/RigidBodyRecorder.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/RigidBodyRecorder.cpp	2008-03-25 09:54:02 UTC (rev 1284)
+++ trunk/pkg/dem/Engine/StandAloneEngine/RigidBodyRecorder.cpp	2008-03-25 19:13:54 UTC (rev 1285)
@@ -0,0 +1,107 @@
+/*************************************************************************
+*  Copyright (C) 2008 by Sergei Dorofeenko                               *
+*  sega at users.berlios.de                                                 *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+#include "RigidBodyRecorder.hpp"
+#include <yade/core/Omega.hpp>
+#include <yade/core/MetaBody.hpp>
+#include <boost/lexical_cast.hpp>
+
+RigidBodyRecorder::RigidBodyRecorder(): DataRecorder(), rigidBodyParameters(new RigidBodyParameters)
+{
+	outputBase = "rigidbody";
+	interval=50;
+}
+
+
+RigidBodyRecorder::~RigidBodyRecorder ()
+{
+
+}
+
+
+void RigidBodyRecorder::postProcessAttributes(bool deserializing)
+{
+	if(deserializing)
+	{
+        //
+	}
+}
+
+
+void RigidBodyRecorder::registerAttributes()
+{
+	DataRecorder::registerAttributes();
+	REGISTER_ATTRIBUTE(outputBase);
+	REGISTER_ATTRIBUTE(interval);
+}
+
+bool RigidBodyRecorder::isActivated()
+{
+   return ((Omega::instance().getCurrentIteration() % interval == 0));
+}
+
+void RigidBodyRecorder::action(Body * body)
+{
+    MetaBody * ncb = YADE_CAST<MetaBody*>(body);
+    shared_ptr<BodyContainer>& bodies = ncb->bodies;
+
+    BodyContainer::iterator bi	    = bodies->begin();
+    BodyContainer::iterator biEnd   = bodies->end();
+    for(;bi!=biEnd;++bi)
+    {
+	const shared_ptr<Body>& b = *bi;
+	int bId = b->getId();
+
+	const RigidBodyParameters* p = YADE_CAST<RigidBodyParameters*>(b->physicalParameters.get());
+	std::string outputFile = outputBase+lexical_cast<string>(bId) + ".dat";
+
+	std::ofstream ofs;
+	
+	if (body_ids.insert(bId).second)
+	{
+	    ofs.open(outputFile.c_str());
+	    if (!ofs)
+	    {
+		cerr << "ERROR: Can't open file: " << outputFile << std::endl;
+		return;
+	    }
+	    ofs << "#(t - time; c - position; v - velocity; a - acceleration; w - angular velocity; b - angular acceleration)\n" 
+		<< "#t(1)\tcx(2)\tcy(3)\tcz(4)\tvx(5)\tvy(6)\tvz(7)\tax(8)\tay(9)\taz(10)\twx(11)\twy(12)\twz(13)\tbx(14)\tby(15)\tbz(16)" 
+		<< std::endl;
+	}
+	else
+	{
+	    ofs.open(outputFile.c_str(),ios::app);
+	    if (!ofs)
+	    {
+		cerr << "ERROR: Can't open file: " << outputFile << std::endl;
+		return;
+	    }
+	}
+	
+	ofs << lexical_cast<string>( Omega::instance().getCurrentIteration() ) << '\t'
+	    << p->se3.position[0] << '\t'
+	    << p->se3.position[1] << '\t'
+	    << p->se3.position[2] << '\t'
+	    << p->velocity[0] << '\t'
+	    << p->velocity[1] << '\t'
+	    << p->velocity[2] << '\t'
+	    << p->acceleration[0] << '\t'
+	    << p->acceleration[1] << '\t'
+	    << p->acceleration[2] << '\t'
+	    << p->angularVelocity[0] << '\t'
+	    << p->angularVelocity[1] << '\t'
+	    << p->angularVelocity[2] << '\t'
+	    << p->angularAcceleration[0] << '\t'
+	    << p->angularAcceleration[1] << '\t'
+	    << p->angularAcceleration[2] << '\t'
+	    << endl;
+	ofs.close();
+    }
+}
+
+YADE_PLUGIN();

Added: trunk/pkg/dem/Engine/StandAloneEngine/RigidBodyRecorder.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/RigidBodyRecorder.hpp	2008-03-25 09:54:02 UTC (rev 1284)
+++ trunk/pkg/dem/Engine/StandAloneEngine/RigidBodyRecorder.hpp	2008-03-25 19:13:54 UTC (rev 1285)
@@ -0,0 +1,42 @@
+/*************************************************************************
+*  Copyright (C) 2008 by Sergei Dorofeenko                               *
+*  sega at users.berlios.de                                                 *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+#ifndef RIGIDBODYRECORDER_HPP
+#define RIGIDBODYRECORDER_HPP
+
+#include <yade/core/DataRecorder.hpp>
+#include <yade/pkg-common/RigidBodyParameters.hpp>
+#include <set>
+
+/// Saves RigidBodyParameters of the body Id in the file outputBaseId,
+class RigidBodyRecorder : public DataRecorder {
+    private:
+	shared_ptr<RigidBodyParameters> rigidBodyParameters;
+	set<int> body_ids;
+
+
+public :
+    string outputBase; 
+    int interval;
+
+
+    RigidBodyRecorder ();
+    ~RigidBodyRecorder ();
+
+    virtual void action(Body* body);
+      bool isActivated();
+
+protected :
+    virtual void postProcessAttributes(bool deserializing);
+    void registerAttributes();
+    REGISTER_CLASS_NAME(RigidBodyRecorder);
+    REGISTER_BASE_CLASS_NAME(DataRecorder);
+};
+REGISTER_SERIALIZABLE(RigidBodyRecorder ,false);
+
+#endif // RIGIDBODYRECORDER_HPP
+

Added: trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticContactLaw.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticContactLaw.cpp	2008-03-25 09:54:02 UTC (rev 1284)
+++ trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticContactLaw.cpp	2008-03-25 19:13:54 UTC (rev 1285)
@@ -0,0 +1,138 @@
+/*************************************************************************
+*  Copyright (C) 2004 by Olivier Galizzi                                 *
+*  olivier.galizzi at imag.fr                                               *
+*									 *
+*  Copyright (C) 2008 by Sergei Dorofeenko                               *
+*  sega at users.berlios.de                                                 *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#include"SimpleViscoelasticContactLaw.hpp"
+#include<yade/pkg-dem/SimpleViscoelasticBodyParameters.hpp>
+#include<yade/pkg-dem/SimpleViscoelasticInteraction.hpp>
+#include<yade/pkg-dem/SpheresContactGeometry.hpp>
+#include<yade/core/Omega.hpp>
+#include<yade/core/MetaBody.hpp>
+#include<yade/pkg-common/Force.hpp>
+#include<yade/pkg-common/Momentum.hpp>
+#include<yade/core/PhysicalAction.hpp>
+
+
+SimpleViscoelasticContactLaw::SimpleViscoelasticContactLaw() : InteractionSolver() , actionForce(new Force) , actionMomentum(new Momentum)
+{
+//	sdecGroupMask=1;
+	momentRotationLaw = true;
+	actionForceIndex = actionForce->getClassIndex();
+	actionMomentumIndex = actionMomentum->getClassIndex();
+}
+
+
+void SimpleViscoelasticContactLaw::registerAttributes()
+{
+	InteractionSolver::registerAttributes();
+//	REGISTER_ATTRIBUTE(sdecGroupMask);
+	REGISTER_ATTRIBUTE(momentRotationLaw);
+}
+
+
+void SimpleViscoelasticContactLaw::action(Body* body)
+{
+	MetaBody * ncb = YADE_CAST<MetaBody*>(body);
+	shared_ptr<BodyContainer>& bodies = ncb->bodies;
+
+	Real dt = Omega::instance().getTimeStep();
+
+/// Non Permanents Links	///
+
+	InteractionContainer::iterator ii    = ncb->transientInteractions->begin();
+	InteractionContainer::iterator iiEnd = ncb->transientInteractions->end();
+	for(  ; ii!=iiEnd ; ++ii )
+	{
+		if ((*ii)->isReal)
+		{
+			const shared_ptr<Interaction>& contact = *ii;
+			int id1 = contact->getId1();
+			int id2 = contact->getId2();
+			
+//			if( !( (*bodies)[id1]->getGroupMask() & (*bodies)[id2]->getGroupMask() & sdecGroupMask) ) continue;
+
+			SpheresContactGeometry*    currentContactGeometry= YADE_CAST<SpheresContactGeometry*>(contact->interactionGeometry.get());
+			SimpleViscoelasticInteraction*  currentContactPhysics = YADE_CAST<SimpleViscoelasticInteraction*> (contact->interactionPhysics.get());
+			if((!currentContactGeometry)||(!currentContactPhysics)) continue;
+	
+			SimpleViscoelasticBodyParameters* de1	= YADE_CAST<SimpleViscoelasticBodyParameters*>((*bodies)[id1]->physicalParameters.get());
+			SimpleViscoelasticBodyParameters* de2	= YADE_CAST<SimpleViscoelasticBodyParameters*>((*bodies)[id2]->physicalParameters.get());
+			
+			Vector3r& normal			= currentContactGeometry->normal;
+			Vector3r x				= currentContactGeometry->contactPoint;
+			Vector3r c1x				= (x - de1->se3.position);
+			Vector3r c2x				= (x - de2->se3.position);
+			Vector3r relativeVelocity		= (de2->velocity+de2->angularVelocity.Cross(c2x)) - (de1->velocity+de1->angularVelocity.Cross(c1x));
+			Real     normalVelocity			= normal.Dot(relativeVelocity);
+			Vector3r shearVelocity			= relativeVelocity-normalVelocity*normal;
+
+			Real kn=currentContactPhysics->kn;
+			Real cn=currentContactPhysics->cn;
+			Real un=currentContactGeometry->penetrationDepth;
+			currentContactPhysics->normalForce = ( kn * un - cn * normalVelocity ) * normal;
+	
+			Vector3r& shearForce 			= currentContactPhysics->shearForce;
+
+			Vector3r axis;
+			Real angle;
+	
+	/// Here is the code with approximated rotations 	 ///
+			
+			axis = currentContactPhysics->prevNormal.Cross(normal);
+			shearForce -= shearForce.Cross(axis);
+			angle = dt*0.5*normal.Dot(de1->angularVelocity+de2->angularVelocity);
+			axis = angle*normal;
+			shearForce -= shearForce.Cross(axis);
+		
+	/// Here is the code with exact rotations 		 ///
+	
+	// 		Quaternionr q;
+	//
+	// 		axis					= currentContactPhysics->prevNormal.cross(currentContactGeometry->normal);
+	// 		angle					= acos(currentContactGeometry->normal.dot(currentContactPhysics->prevNormal));
+	// 		q.fromAngleAxis(angle,axis);
+	//
+	// 		currentContactPhysics->shearForce	= currentContactPhysics->shearForce*q;
+	//
+	// 		angle					= dt*0.5*currentContactGeometry->normal.dot(de1->angularVelocity+de2->angularVelocity);
+	// 		axis					= currentContactGeometry->normal;
+	// 		q.fromAngleAxis(angle,axis);
+	// 		currentContactPhysics->shearForce	= q*currentContactPhysics->shearForce;
+	
+	
+			Real ks = currentContactPhysics->ks;
+			Real cs = currentContactPhysics->cs;
+			shearForce 			       -= (ks*dt+cs)*shearVelocity;
+	
+	// PFC3d SlipModel, is using friction angle. CoulombCriterion
+			Real maxFs = currentContactPhysics->normalForce.SquaredLength() * std::pow(currentContactPhysics->mu,2);
+			if( shearForce.SquaredLength() > maxFs )
+			{
+				maxFs = Mathr::Sqrt(maxFs) / shearForce.Length();
+				shearForce *= maxFs;
+			}
+	////////// PFC3d SlipModel
+	
+			Vector3r f				= currentContactPhysics->normalForce + shearForce;
+			
+	// it will be some macro(	body->physicalActions,	ActionType , bodyId )
+			static_cast<Force*>   ( ncb->physicalActions->find( id1 , actionForceIndex).get() )->force    -= f;
+			static_cast<Force*>   ( ncb->physicalActions->find( id2 , actionForceIndex ).get() )->force   += f;
+			
+			static_cast<Momentum*>( ncb->physicalActions->find( id1 , actionMomentumIndex ).get() )->momentum -= c1x.Cross(f);
+			static_cast<Momentum*>( ncb->physicalActions->find( id2 , actionMomentumIndex ).get() )->momentum += c2x.Cross(f);
+			
+			currentContactPhysics->prevNormal = normal;
+		}
+	}
+}
+
+
+YADE_PLUGIN();

Added: trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticContactLaw.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticContactLaw.hpp	2008-03-25 09:54:02 UTC (rev 1284)
+++ trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticContactLaw.hpp	2008-03-25 19:13:54 UTC (rev 1285)
@@ -0,0 +1,45 @@
+/*************************************************************************
+*  Copyright (C) 2004 by Olivier Galizzi                                 *
+*  olivier.galizzi at imag.fr                                               *
+*									 *
+*  Copyright (C) 2008 by Sergei Dorofeenko                               *
+*  sega at users.berlios.de                                                 *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#ifndef SIMPLEVISCOELASTIC_CONTACT_LAW_HPP
+#define SIMPLEVISCOELASTIC_CONTACT_LAW_HPP
+
+#include<yade/core/InteractionSolver.hpp>
+
+class PhysicalAction;
+
+/// This class provides linear viscoelastic contact model
+class SimpleViscoelasticContactLaw : public InteractionSolver
+{
+/// Attributes
+	private :
+		shared_ptr<PhysicalAction> actionForce;
+		shared_ptr<PhysicalAction> actionMomentum;
+		int actionForceIndex;
+		int actionMomentumIndex;
+		
+	public :
+//		int sdecGroupMask;
+		bool momentRotationLaw;
+	
+		SimpleViscoelasticContactLaw();
+		void action(Body* body);
+
+	protected :
+		void registerAttributes();
+	REGISTER_CLASS_NAME(SimpleViscoelasticContactLaw);
+	REGISTER_BASE_CLASS_NAME(InteractionSolver);
+};
+
+REGISTER_SERIALIZABLE(SimpleViscoelasticContactLaw,false);
+
+#endif // SIMPLEVISCOELASTIC_CONTACT_LAW_HPP
+

Added: trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticSpheresInteractionRecorder.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticSpheresInteractionRecorder.cpp	2008-03-25 09:54:02 UTC (rev 1284)
+++ trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticSpheresInteractionRecorder.cpp	2008-03-25 19:13:54 UTC (rev 1285)
@@ -0,0 +1,104 @@
+/*************************************************************************
+*  Copyright (C) 2006 by Sergei Dorofeenko				 *
+*  sega at users.berlios.de                                                 *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+#include "SimpleViscoelasticSpheresInteractionRecorder.hpp"
+#include <yade/core/Omega.hpp>
+#include <yade/core/MetaBody.hpp>
+#include <boost/lexical_cast.hpp>
+
+SimpleViscoelasticSpheresInteractionRecorder::SimpleViscoelasticSpheresInteractionRecorder (): DataRecorder(), interactionSphere(new SpheresContactGeometry), viscoelasticInteraction(new SimpleViscoelasticInteraction)
+{
+	outputBase = "contacts";
+	interval=50;
+}
+
+
+SimpleViscoelasticSpheresInteractionRecorder::~SimpleViscoelasticSpheresInteractionRecorder ()
+{
+
+}
+
+
+void SimpleViscoelasticSpheresInteractionRecorder::postProcessAttributes(bool deserializing)
+{
+	if(deserializing)
+	{
+        //
+	}
+}
+
+
+void SimpleViscoelasticSpheresInteractionRecorder::registerAttributes()
+{
+	DataRecorder::registerAttributes();
+	REGISTER_ATTRIBUTE(outputBase);
+	REGISTER_ATTRIBUTE(interval);
+}
+
+bool SimpleViscoelasticSpheresInteractionRecorder::isActivated()
+{
+   return ((Omega::instance().getCurrentIteration() % interval == 0));
+}
+
+void SimpleViscoelasticSpheresInteractionRecorder::action(Body * body)
+{
+    MetaBody * ncb = YADE_CAST<MetaBody*>(body);
+    shared_ptr<InteractionContainer>& interactions = ncb->transientInteractions;
+  
+    InteractionContainer::iterator ii    = interactions->begin();
+    InteractionContainer::iterator iiEnd = interactions->end();
+    for(  ; ii!=iiEnd ; ++ii )
+    {
+	const shared_ptr<Interaction>& i = *ii;
+	if ( !i->isReal ) continue;
+	if ( i->interactionGeometry->getClassIndex() != interactionSphere->getClassIndex() ) continue;
+	if ( i->interactionPhysics->getClassIndex() != viscoelasticInteraction->getClassIndex() ) continue;
+
+	const SpheresContactGeometry* s = static_cast<SpheresContactGeometry*>(i->interactionGeometry.get());
+	const SimpleViscoelasticInteraction* p = static_cast<SimpleViscoelasticInteraction*>(i->interactionPhysics.get());
+
+	std::string outputFile = outputBase+lexical_cast<string>(i->getId1())+"-"+lexical_cast<string>(i->getId2())+".dat";
+	
+	std::ofstream ofs;
+
+	if (interaction_ids.insert(pair<int,int>(i->getId1(),i->getId2())).second)
+	{
+	    ofs.open(outputFile.c_str());
+	    if (!ofs)
+	    {
+		std::cerr << "ERROR: Can't open file: " << outputFile << std::endl;
+		return;
+	    }
+	    ofs << "#(t - time; d - penetration depth; F - normal force; S - shear force)\n"
+		<< "#t(1)\td(2)\tFx(3)\tFy(4)\tFz(5)\tSx(6)\tSy(7)\tSz(8)"
+		<< std::endl;
+	}
+	else
+	{
+	    ofs.open(outputFile.c_str(),std::ios::app);
+	    if (!ofs)
+	    {
+		std::cerr << "ERROR: Can't open file: " << outputFile << std::endl;
+		return;
+	    }
+	}
+
+	ofs << lexical_cast<string>( Omega::instance().getCurrentIteration() ) << '\t'
+	    << s->penetrationDepth << '\t'
+	    << p->normalForce[0] << '\t'
+	    << p->normalForce[1] << '\t'
+	    << p->normalForce[2] << '\t'
+	    << p->shearForce[0] << '\t'
+	    << p->shearForce[1] << '\t'
+	    << p->shearForce[2] << '\t'
+	    << std::endl;
+	ofs.close();
+    }
+}
+
+YADE_PLUGIN();
+

Added: trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticSpheresInteractionRecorder.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticSpheresInteractionRecorder.hpp	2008-03-25 09:54:02 UTC (rev 1284)
+++ trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticSpheresInteractionRecorder.hpp	2008-03-25 19:13:54 UTC (rev 1285)
@@ -0,0 +1,45 @@
+/*************************************************************************
+*  Copyright (C) 2006 by Sergei Dorofeenko				 *
+*  sega at users.berlios.de                                                 *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+#ifndef SIMPLEVISCOELASTICSPHERESINTERACTIONRECORDER_HPP
+#define SIMPLEVISCOELASTICSPHERESINTERACTIONRECORDER_HPP
+
+#include <yade/core/DataRecorder.hpp>
+#include <yade/pkg-dem/SpheresContactGeometry.hpp>
+#include <yade/pkg-dem/SimpleViscoelasticInteraction.hpp>
+#include <set>
+
+/// Save SpheresContactGeometry and SimpleViscoelasticInteraction of the
+/// interaction between the body Id1 and the body Id2 into the file
+/// outputBaseId1-Id2.
+class SimpleViscoelasticSpheresInteractionRecorder : public DataRecorder {
+private: 
+    shared_ptr<SpheresContactGeometry> interactionSphere;
+    shared_ptr<SimpleViscoelasticInteraction> viscoelasticInteraction;
+    set<pair<int,int> > interaction_ids;
+
+public :
+    /// Base name of output file.
+    string outputBase;
+    /// Saves interval
+    int interval;
+
+    SimpleViscoelasticSpheresInteractionRecorder();
+    ~SimpleViscoelasticSpheresInteractionRecorder();
+
+    virtual void action(Body* body);
+    bool isActivated();
+
+protected :
+    virtual void postProcessAttributes(bool deserializing);
+    void registerAttributes();
+    REGISTER_CLASS_NAME(SimpleViscoelasticSpheresInteractionRecorder);
+    REGISTER_BASE_CLASS_NAME(DataRecorder);
+};
+REGISTER_SERIALIZABLE(SimpleViscoelasticSpheresInteractionRecorder,false);
+
+#endif // SIMPLEVISCOELASTICSPHERESINTERACTIONRECORDER_HPP

Added: trunk/pkg/dem/PreProcessor/TestSimpleViscoelastic.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/TestSimpleViscoelastic.cpp	2008-03-25 09:54:02 UTC (rev 1284)
+++ trunk/pkg/dem/PreProcessor/TestSimpleViscoelastic.cpp	2008-03-25 19:13:54 UTC (rev 1285)
@@ -0,0 +1,290 @@
+/*************************************************************************
+*  Copyright (C) 2006 by Sergei Dorofeenko				 *
+*  sega at users.berlios.de                                                 *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+#include "TestSimpleViscoelastic.hpp"
+#include <yade/core/Body.hpp>
+#include <yade/core/MetaBody.hpp>
+#include<yade/core/Body.hpp>
+#include<yade/core/Interaction.hpp>
+#include<yade/core/MetaBody.hpp>
+#include<yade/pkg-common/AABB.hpp>
+#include<yade/pkg-common/BodyRedirectionVector.hpp>
+#include<yade/pkg-common/BoundingVolumeMetaEngine.hpp>
+#include<yade/pkg-common/InteractingSphere.hpp>
+#include<yade/pkg-common/InteractingBox.hpp>
+#include<yade/pkg-common/InteractionGeometryMetaEngine.hpp>
+#include<yade/pkg-common/InteractionPhysicsMetaEngine.hpp>
+#include<yade/pkg-common/InteractionVecSet.hpp>
+#include<yade/pkg-common/MetaInteractingGeometry.hpp>
+#include<yade/pkg-common/MetaInteractingGeometry2AABB.hpp>
+#include<yade/pkg-common/PersistentSAPCollider.hpp>
+#include<yade/pkg-common/PhysicalActionApplier.hpp>
+#include<yade/pkg-common/PhysicalActionContainerInitializer.hpp>
+#include<yade/pkg-common/PhysicalActionContainerReseter.hpp>
+#include<yade/pkg-common/PhysicalActionVectorVector.hpp>
+#include<yade/pkg-common/PhysicalParametersMetaEngine.hpp>
+#include<yade/pkg-common/Sphere.hpp>
+#include<yade/pkg-common/Box.hpp>
+#include<yade/pkg-dem/RigidBodyRecorder.hpp>
+#include<yade/pkg-dem/SimpleViscoelasticSpheresInteractionRecorder.hpp>
+#include<yade/pkg-dem/SimpleViscoelasticBodyParameters.hpp>
+#include<yade/pkg-dem/SimpleViscoelasticContactLaw.hpp>
+#include<yade/pkg-dem/SimpleViscoelasticRelationships.hpp>
+#include<yade/pkg-common/GravityEngine.hpp>
+
+TestSimpleViscoelastic::TestSimpleViscoelastic() : FileGenerator()
+{
+    tc = 0.001;
+    en = 0.3;
+    es = 0.3;
+    mu = 0.1;
+    R  = 1;
+    density = 2600;
+    nbSpheres = 10;
+    h  = 1;
+    velocity = Vector3r(0,-1,0);
+    angular_vel = Vector3r(0,0,0);
+    rotationBlocked=false;
+    groundSize = Vector3r(10,1,10);
+    gravity = Vector3r(0,-9.81,0);
+    outputBase="test";
+    interval=50;
+}
+
+TestSimpleViscoelastic::~TestSimpleViscoelastic()
+{}
+
+void TestSimpleViscoelastic::postProcessAttributes(bool)
+{}
+
+void TestSimpleViscoelastic::registerAttributes()
+{
+    FileGenerator::registerAttributes();
+    REGISTER_ATTRIBUTE(tc);
+    REGISTER_ATTRIBUTE(en);
+    REGISTER_ATTRIBUTE(es);
+    REGISTER_ATTRIBUTE(mu);
+    REGISTER_ATTRIBUTE(R);
+    REGISTER_ATTRIBUTE(density);
+    REGISTER_ATTRIBUTE(nbSpheres);
+    REGISTER_ATTRIBUTE(h);
+    REGISTER_ATTRIBUTE(velocity);
+    REGISTER_ATTRIBUTE(angular_vel);
+    REGISTER_ATTRIBUTE(rotationBlocked);
+    REGISTER_ATTRIBUTE(gravity);
+    REGISTER_ATTRIBUTE(groundSize);
+    REGISTER_ATTRIBUTE(outputBase);
+    REGISTER_ATTRIBUTE(interval);
+}
+
+bool TestSimpleViscoelastic::generate()
+{
+    rootBody = shared_ptr<MetaBody>(new MetaBody);
+    createActors(rootBody);
+    positionRootBody(rootBody);
+    
+////////////////////////////////////
+///////// Container
+	
+    rootBody->persistentInteractions	= shared_ptr<InteractionContainer>(new InteractionVecSet);
+    rootBody->transientInteractions	= shared_ptr<InteractionContainer>(new InteractionVecSet);
+    rootBody->physicalActions		= shared_ptr<PhysicalActionContainer>(new PhysicalActionVectorVector);
+    rootBody->bodies			= shared_ptr<BodyContainer>(new BodyRedirectionVector);
+
+////////////////////////////////////
+///////// ground
+    
+    shared_ptr<Body> ground;
+    createBox(ground, Vector3r(0,0,0),groundSize);
+    rootBody->bodies->insert(ground);
+
+////////////////////////////////////
+///////// Spheres
+
+    float all = nbSpheres;
+    float current = 0.0;
+    for(int i=0; i<nbSpheres; ++i)
+    {
+	if (shouldTerminate()) return false;
+	shared_ptr<Body> sphere;
+	createSphere(sphere,i);
+	rootBody->bodies->insert(sphere);
+
+	setProgress(current++/all);
+    }
+    return true;
+}
+
+void TestSimpleViscoelastic::createBox(shared_ptr<Body>& body, Vector3r position, Vector3r extents)
+{
+	body = shared_ptr<Body>(new Body(body_id_t(0),1));
+	shared_ptr<SimpleViscoelasticBodyParameters> physics(new SimpleViscoelasticBodyParameters);
+	shared_ptr<AABB> aabb(new AABB);
+	shared_ptr<Box> gBox(new Box);
+	shared_ptr<InteractingBox> iBox(new InteractingBox);
+	
+	
+	Quaternionr q;
+	q.FromAxisAngle( Vector3r(0,0,1),0);
+
+	body->isDynamic			= false;
+	
+	physics->angularVelocity	= Vector3r(0,0,0);
+	physics->velocity		= Vector3r(0,0,0);
+	physics->mass			= extents[0]*extents[1]*extents[2]*density*8; 
+	physics->inertia		= Vector3r(physics->mass*(extents[1]*extents[1]+extents[2]*extents[2])/3
+						, physics->mass*(extents[0]*extents[0]+extents[2]*extents[2])/3
+						, physics->mass*(extents[1]*extents[1]+extents[0]*extents[0])/3);
+	physics->se3			= Se3r(position,q);
+	physics->setViscoelastic(physics->mass, tc, en, es);
+	physics->mu			= mu;
+
+	aabb->diffuseColor		= Vector3r(1,0,0);
+
+	gBox->extents			= extents;
+	gBox->diffuseColor		= Vector3r(1,1,1);
+	gBox->wire			= false;
+	gBox->visible			= true;
+	gBox->shadowCaster		= true;
+	
+	iBox->extents			= extents;
+	iBox->diffuseColor		= Vector3r(1,1,1);
+
+	body->boundingVolume		= aabb;
+	body->interactingGeometry	= iBox;
+	body->geometricalModel		= gBox;
+	body->physicalParameters	= physics;
+}
+
+void TestSimpleViscoelastic::createActors(shared_ptr<MetaBody>& rootBody)
+{
+    shared_ptr<PhysicalActionContainerInitializer> physicalActionInitializer(new PhysicalActionContainerInitializer);
+    physicalActionInitializer->physicalActionNames.push_back("Force");
+    physicalActionInitializer->physicalActionNames.push_back("Momentum");
+    
+    shared_ptr<InteractionGeometryMetaEngine> interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
+    interactionGeometryDispatcher->add("InteractingSphere2InteractingSphere4SpheresContactGeometry");
+    interactionGeometryDispatcher->add("InteractingBox2InteractingSphere4SpheresContactGeometry");
+
+    shared_ptr<InteractionPhysicsMetaEngine> interactionPhysicsDispatcher(new InteractionPhysicsMetaEngine);
+    interactionPhysicsDispatcher->add("SimpleViscoelasticRelationships");
+	    
+    shared_ptr<BoundingVolumeMetaEngine> boundingVolumeDispatcher	= shared_ptr<BoundingVolumeMetaEngine>(new BoundingVolumeMetaEngine);
+    boundingVolumeDispatcher->add("InteractingSphere2AABB");
+    boundingVolumeDispatcher->add("InteractingBox2AABB");
+    boundingVolumeDispatcher->add("MetaInteractingGeometry2AABB");
+    
+    shared_ptr<GravityEngine> gravityCondition(new GravityEngine);
+    gravityCondition->gravity = gravity;
+    
+    shared_ptr<PhysicalActionApplier> applyActionDispatcher(new PhysicalActionApplier);
+    applyActionDispatcher->add("NewtonsForceLaw");
+    applyActionDispatcher->add("NewtonsMomentumLaw");
+    
+    shared_ptr<PhysicalParametersMetaEngine> positionIntegrator(new PhysicalParametersMetaEngine);
+    positionIntegrator->add("LeapFrogPositionIntegrator");
+    shared_ptr<PhysicalParametersMetaEngine> orientationIntegrator(new PhysicalParametersMetaEngine);
+    orientationIntegrator->add("LeapFrogOrientationIntegrator");
+    
+    rootBody->engines.clear();
+    rootBody->engines.push_back(shared_ptr<Engine>(new PhysicalActionContainerReseter));
+    rootBody->engines.push_back(boundingVolumeDispatcher);	
+    rootBody->engines.push_back(shared_ptr<Engine>(new PersistentSAPCollider));
+    rootBody->engines.push_back(interactionGeometryDispatcher);
+    rootBody->engines.push_back(interactionPhysicsDispatcher);
+    rootBody->engines.push_back(shared_ptr<Engine>(new SimpleViscoelasticContactLaw));
+    rootBody->engines.push_back(gravityCondition);
+    rootBody->engines.push_back(applyActionDispatcher);
+    rootBody->engines.push_back(positionIntegrator);
+    if(!rotationBlocked) rootBody->engines.push_back(orientationIntegrator);
+
+    shared_ptr<RigidBodyRecorder> rigidBodyRecorder(new RigidBodyRecorder);
+    rigidBodyRecorder->outputBase = outputBase+string("-body");
+    rigidBodyRecorder->interval = interval;
+    rootBody->engines.push_back(rigidBodyRecorder);
+
+    shared_ptr<SimpleViscoelasticSpheresInteractionRecorder> interactionRecorder(new SimpleViscoelasticSpheresInteractionRecorder);
+    interactionRecorder->outputBase = outputBase+string("-interaction");
+    interactionRecorder->interval = interval;
+    rootBody->engines.push_back(interactionRecorder);
+
+    rootBody->initializers.clear();
+    rootBody->initializers.push_back(physicalActionInitializer);
+    rootBody->initializers.push_back(boundingVolumeDispatcher);
+}
+
+void TestSimpleViscoelastic::createSphere(shared_ptr<Body>& body, int i)
+{
+	body = shared_ptr<Body>(new Body(body_id_t(0),1));
+	shared_ptr<SimpleViscoelasticBodyParameters> physics(new SimpleViscoelasticBodyParameters);
+	shared_ptr<AABB> aabb(new AABB);
+	shared_ptr<Sphere> gSphere(new Sphere);
+	shared_ptr<InteractingSphere> iSphere(new InteractingSphere);
+	
+	Quaternionr q;
+	q.FromAxisAngle( Vector3r(0,0,1),0);
+	
+	Vector3r position = Vector3r(0,i*(2.0*R+h)+2*groundSize[1]+h,0);
+	
+//	Real radius 			= (Mathr::IntervalRandom(minRadius,maxRadius));
+	Real radius = R;
+	
+	body->isDynamic	= true;
+	
+	physics->angularVelocity	= angular_vel;
+	physics->velocity		= velocity;
+	physics->mass			= 4.0/3.0*Mathr::PI*radius*radius*radius*density;
+	physics->inertia		= Vector3r(2.0/5.0*physics->mass*radius*radius,2.0/5.0*physics->mass*radius*radius,2.0/5.0*physics->mass*radius*radius); //
+	physics->se3			= Se3r(position,q);
+	physics->setViscoelastic(physics->mass, tc, en, es);
+//	physics->frictionAngle		= sphereFrictionDeg * Mathr::PI/180.0;
+	physics->mu			= mu;
+
+	aabb->diffuseColor		= Vector3r(0,1,0);
+
+	gSphere->radius			= radius;
+	gSphere->diffuseColor		= Vector3r(Mathr::UnitRandom(),Mathr::UnitRandom(),Mathr::UnitRandom());
+	gSphere->wire			= false;
+	gSphere->visible		= true;
+	gSphere->shadowCaster		= true;
+	
+	iSphere->radius			= radius;
+	iSphere->diffuseColor		= Vector3r(0.8,0.3,0.3);
+
+	body->interactingGeometry	= iSphere;
+	body->geometricalModel		= gSphere;
+	body->boundingVolume		= aabb;
+	body->physicalParameters	= physics;
+}
+    
+
+void TestSimpleViscoelastic::positionRootBody(shared_ptr<MetaBody>& rootBody) 
+{
+	rootBody->isDynamic		= false;
+	
+	Quaternionr q;
+	q.FromAxisAngle( Vector3r(0,0,1),0);
+
+	shared_ptr<ParticleParameters> physics(new ParticleParameters); 
+	physics->se3				= Se3r(Vector3r(0,0,0),q);
+	physics->mass				= 0;
+	physics->velocity			= Vector3r(0,0,0);
+	physics->acceleration			= Vector3r::ZERO;
+		
+	shared_ptr<MetaInteractingGeometry> set(new MetaInteractingGeometry());
+	set->diffuseColor			= Vector3r(0,0,1);
+	
+	shared_ptr<AABB> aabb(new AABB);
+	aabb->diffuseColor			= Vector3r(0,0,1);
+	
+	rootBody->interactingGeometry		= YADE_PTR_CAST<InteractingGeometry>(set);	
+	rootBody->boundingVolume		= YADE_PTR_CAST<BoundingVolume>(aabb);
+	rootBody->physicalParameters 		= physics;
+}
+
+    
+    

Added: trunk/pkg/dem/PreProcessor/TestSimpleViscoelastic.hpp
===================================================================
--- trunk/pkg/dem/PreProcessor/TestSimpleViscoelastic.hpp	2008-03-25 09:54:02 UTC (rev 1284)
+++ trunk/pkg/dem/PreProcessor/TestSimpleViscoelastic.hpp	2008-03-25 19:13:54 UTC (rev 1285)
@@ -0,0 +1,70 @@
+/*************************************************************************
+*  Copyright (C) 2006 by Sergei Dorofeenko				 *
+*  sega at users.berlios.de                                                 *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#ifndef TESTSIMPLEVISCOELASTIC_HPP 
+#define TESTSIMPLEVISCOELASTIC_HPP
+
+#include <yade/core/FileGenerator.hpp>
+
+class TestSimpleViscoelastic : public FileGenerator {
+    private:
+	
+	/// Collision time
+	Real tc; 
+	/// Normal restitution coefficient
+	Real en;
+	/// Shear restitution coefficient
+       	Real es;
+	/// Coulomb friction
+	Real mu;
+	/// Spheres radius
+	Real R;
+	/// Materials density
+	Real density;
+	/// Number of spheres
+	Real nbSpheres;
+	/// Height between spheres
+	Real h;
+	/// Initial velocity of spheres
+	Vector3r velocity; 
+	/// Initial angular velocity of spheres
+	Vector3r angular_vel; 
+	/// Gravity
+	Vector3r gravity;
+	/// Size of bottom box
+	Vector3r groundSize;
+	/// Base name of results file
+	std::string outputBase;
+	/// Saves interval
+	int interval;
+	
+	bool rotationBlocked;
+
+	void createActors(shared_ptr<MetaBody>& rootBody);
+	void createSphere(shared_ptr<Body>& body, int i);
+	void createBox(shared_ptr<Body>& body, Vector3r position, Vector3r extents);
+	void positionRootBody(shared_ptr<MetaBody>& rootBody);
+
+    public:
+	TestSimpleViscoelastic();
+	~TestSimpleViscoelastic();
+
+    protected:
+	bool generate();
+
+	virtual void postProcessAttributes(bool deserializing);
+	void registerAttributes();
+
+	REGISTER_CLASS_NAME(TestSimpleViscoelastic);
+	REGISTER_BASE_CLASS_NAME(FileGenerator);
+};
+
+REGISTER_SERIALIZABLE(TestSimpleViscoelastic,false);
+
+#endif // TESTSIMPLEVISCOELASTIC_HPP
+

Added: trunk/pkg/dem/RenderingEngine/GLDrawSimpleViscoelasticInteraction/GLDrawSimpleViscoelasticInteraction.cpp
===================================================================
--- trunk/pkg/dem/RenderingEngine/GLDrawSimpleViscoelasticInteraction/GLDrawSimpleViscoelasticInteraction.cpp	2008-03-25 09:54:02 UTC (rev 1284)
+++ trunk/pkg/dem/RenderingEngine/GLDrawSimpleViscoelasticInteraction/GLDrawSimpleViscoelasticInteraction.cpp	2008-03-25 19:13:54 UTC (rev 1285)
@@ -0,0 +1,38 @@
+/*************************************************************************
+*  Copyright (C) 2006 by Sergei Dorofeenko				 *
+*  sega at users.berlios.de                                                 *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#include "GLDrawSimpleViscoelasticInteraction.hpp"
+#include <yade/pkg-dem/SimpleViscoelasticInteraction.hpp>
+#include<yade/lib-opengl/OpenGLWrapper.hpp>
+
+
+void GLDrawSimpleViscoelasticInteraction::go(
+		const shared_ptr<InteractionPhysics>& ip,
+		const shared_ptr<Interaction>&,
+		const shared_ptr<Body>& b1,
+		const shared_ptr<Body>& b2,
+		bool wireFrame)
+{
+	SimpleViscoelasticInteraction* p = static_cast<SimpleViscoelasticInteraction*>(ip.get());
+	Vector3r mid = 0.5*(b1->physicalParameters->se3.position+b2->physicalParameters->se3.position);
+	glTranslatev(mid);
+	glColor3(1.0,0.0,0.0);
+	
+	glPushMatrix();
+	glRasterPos2i(0,0);
+	std::string str;
+	str = std::string("  kn=") + boost::lexical_cast<std::string>((float)(p->kn))
+	    + std::string("  cn=") + boost::lexical_cast<std::string>((float)(p->cn))
+	    + std::string("  ks=") + boost::lexical_cast<std::string>((float)(p->ks))
+	    + std::string("  cs=") + boost::lexical_cast<std::string>((float)(p->cs));
+	for(unsigned int i=0;i<str.length();i++)
+		glutBitmapCharacter(GLUT_BITMAP_HELVETICA_12, str[i]);
+	glPopMatrix();
+}
+
+YADE_PLUGIN();

Added: trunk/pkg/dem/RenderingEngine/GLDrawSimpleViscoelasticInteraction/GLDrawSimpleViscoelasticInteraction.hpp
===================================================================
--- trunk/pkg/dem/RenderingEngine/GLDrawSimpleViscoelasticInteraction/GLDrawSimpleViscoelasticInteraction.hpp	2008-03-25 09:54:02 UTC (rev 1284)
+++ trunk/pkg/dem/RenderingEngine/GLDrawSimpleViscoelasticInteraction/GLDrawSimpleViscoelasticInteraction.hpp	2008-03-25 19:13:54 UTC (rev 1285)
@@ -0,0 +1,27 @@
+/*************************************************************************
+*  Copyright (C) 2006 by Sergei Dorofeenko				 *
+*  sega at users.berlios.de                                                 *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#ifndef GLDRAW_SIMPLEVISCOELASTIC_INTERACTION_HPP
+#define GLDRAW_SIMPLEVISCOELASTIC_INTERACTION_HPP
+
+#include <yade/pkg-common/GLDrawInteractionPhysicsFunctor.hpp>
+
+class GLDrawSimpleViscoelasticInteraction : public GLDrawInteractionPhysicsFunctor
+{
+	public :
+		virtual void go(const shared_ptr<InteractionPhysics>&,const shared_ptr<Interaction>&,const shared_ptr<Body>&,const shared_ptr<Body>&,bool wireFrame);
+
+	RENDERS(SimpleViscoelasticInteraction);
+	REGISTER_CLASS_NAME(GLDrawSimpleViscoelasticInteraction);
+	REGISTER_BASE_CLASS_NAME(GLDrawInteractionPhysicsFunctor);
+};
+
+REGISTER_SERIALIZABLE(GLDrawSimpleViscoelasticInteraction,false);
+
+#endif //GLDRAW_SIMPLEVISCOELASTIC_INTERACTION_HPP
+

Modified: trunk/pkg/dem/SConscript
===================================================================
--- trunk/pkg/dem/SConscript	2008-03-25 09:54:02 UTC (rev 1284)
+++ trunk/pkg/dem/SConscript	2008-03-25 19:13:54 UTC (rev 1285)
@@ -1,3 +1,4 @@
+# vim: set filetype=python :
 Import('*')
 env.Install('$PREFIX/lib/yade$SUFFIX/pkg-dem',[
 
@@ -869,9 +870,73 @@
 			'RigidBodyParameters'
 			 ]),
 
+	env.SharedLibrary('SimpleViscoelasticBodyParameters'
+		,['DataClass/PhysicalParameters/SimpleViscoelasticBodyParameters.cpp']
+		,LIBS=env['LIBS']+['RigidBodyParameters'])
 
+	,env.SharedLibrary('SimpleViscoelasticInteraction'
+		,['DataClass/InteractionPhysics/SimpleViscoelasticInteraction.cpp'])
+    
+	,env.SharedLibrary('GLDrawSimpleViscoelasticInteraction'
+	    ,['RenderingEngine/GLDrawSimpleViscoelasticInteraction/GLDrawSimpleViscoelasticInteraction.cpp']
+	    ,LIBS=env['LIBS']+['yade-opengl','SimpleViscoelasticInteraction'])
 
+	,env.SharedLibrary('SimpleViscoelasticRelationships'
+		,['Engine/EngineUnit/SimpleViscoelasticRelationships.cpp']
+		,LIBS=env['LIBS']+['SimpleViscoelasticBodyParameters'
+		    ,'SimpleViscoelasticInteraction'
+		    ,'SpheresContactGeometry'
+		    ])
 
+	,env.SharedLibrary('SimpleViscoelasticContactLaw'
+		,['Engine/StandAloneEngine/SimpleViscoelasticContactLaw.cpp']
+		,LIBS=env['LIBS']+['SimpleViscoelasticInteraction'
+		    ,'SimpleViscoelasticBodyParameters'
+		    ,'SpheresContactGeometry'
+		    ,'Force'
+		    ,'Momentum'
+		    ])
+	
+	,env.SharedLibrary('SimpleViscoelasticSpheresInteractionRecorder'
+	    ,['Engine/StandAloneEngine/SimpleViscoelasticSpheresInteractionRecorder.cpp']
+	    ,LIBS=env['LIBS']+['SpheresContactGeometry','SimpleViscoelasticInteraction'])
 
+	,env.SharedLibrary('RigidBodyRecorder'
+	,['Engine/StandAloneEngine/RigidBodyRecorder.cpp']
+	,LIBS=env['LIBS']+['RigidBodyParameters'])
+
+	,env.SharedLibrary('TestSimpleViscoelastic'
+		,['PreProcessor/TestSimpleViscoelastic.cpp']
+		,LIBS=env['LIBS']+['AABB'
+			    ,'Box'
+			    ,'InteractingBox'
+			    ,'SimpleViscoelasticRelationships'
+			    ,'SimpleViscoelasticContactLaw'
+			    ,'SimpleViscoelasticBodyParameters'
+			    ,'SimpleViscoelasticInteraction'
+			    ,'SimpleViscoelasticSpheresInteractionRecorder'
+			    ,'GravityEngine'
+			    ,'BodyRedirectionVector'
+			    ,'BoundingVolumeMetaEngine'
+			    ,'InteractingSphere'
+			    ,'InteractionGeometryMetaEngine'
+			    ,'InteractionPhysicsMetaEngine'
+			    ,'InteractionVecSet'
+			    ,'MetaInteractingGeometry'
+			    ,'MetaInteractingGeometry2AABB'
+			    ,'ParticleParameters'
+			    ,'RigidBodyRecorder'
+			    ,'PhysicalActionApplier'
+			    ,'PhysicalActionContainerInitializer'
+			    ,'PhysicalActionContainerReseter'
+			    ,'PhysicalActionVectorVector'
+			    ,'PhysicalParametersMetaEngine'
+			    ,'PersistentSAPCollider'
+			    ,'Sphere'
+			    ])
+
+
+
+
 ])
 



-------------------------------------------------------


-------------------------------------------------------


From janek_listy at wp.pl  Wed Mar 26 11:02:09 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Wed, 26 Mar 2008 11:02:09 +0100
Subject: [yade-dev] cmdGui
In-Reply-To: <20080325204828.4f4c0560@absurd>
References: <mailman.55.1206442881.24454.yade-dev@lists.berlios.de>
	<200803251819.14526.dorofeenko@icp.ac.ru>
	<47E94C24.6040804@arcig.cz> <20080325204828.4f4c0560@absurd>
Message-ID: <20080326110209.7f66950a@absurd>

Janek Kozicki said:     (by the date of Tue, 25 Mar 2008 20:48:28 +0100)

> V?clav S(milauer said:     (by the date of Tue, 25 Mar 2008 20:01:56 +0100)
> 
> > I am unable to test on 32bit i386, all my machines are native amd64.
> > (There is some typeid() logic in IOFormatManager and maybe older compilers get it wrong?)
> 
> I can create an account for you on my computer I use in Grenoble. It's 32bit.
> 
> > Janek, you know the serializer well, can you comment on that? Are you
> > able to reproduce it? (I am not.)
> 
> not yet, I need to reproduce first. I will try...

OK, I reproduced this, both optimized and non-optimized build have
this problem. For some reason the static methods from
BINFormatManager are called instead of XMLFormatManager. Totally
strange. I tried several various hacks to fix this and none worked.
So after few hours I would prefer to give up instead of spend more time
on this, because yade::serialization is flawed anyway and if all goes
well we all will be using boost::serialization in 3 or 4 weeks.

Assuming that this will not render useless the regression tests. We
will see.

-- 
Janek Kozicki                                                         |


From janek_listy at wp.pl  Wed Mar 26 16:12:56 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Wed, 26 Mar 2008 16:12:56 +0100
Subject: [yade-dev] svn-1284 compile error
In-Reply-To: <20080326102900.649c195e@absurd>
References: <mailman.55.1206442881.24454.yade-dev@lists.berlios.de>
	<200803261023.01711.dorofeenko@icp.ac.ru>
	<20080326102900.649c195e@absurd>
Message-ID: <20080326161256.52020369@absurd>

Janek Kozicki said:     (by the date of Wed, 26 Mar 2008 10:29:00 +0100)

> sega said:     (by the date of Wed, 26 Mar 2008 10:23:01 +0300)
> 
> > Hello. I have following compile error after update to svn-1284:
> > 
> > gui/cmd/yadeControl.cpp:271:   instantiated from here
> > /usr/local/include/boost/shared_ptr.hpp:199: error: invalid static_cast from type 'Factorable* const' to type 'Indexable*'
> 
> yes, I got this too. It occurs only in optimized builds, the fix is
> to replace YADE_PTR_CAST by dynamic_pointer_cast in
> yadeControl.cpp:271
> 
> You can commit that fix if you want, or we can wait for Vaclav,
> because that's his code.


So I committed this fix.

-- 
Janek Kozicki                                                         |


From eudoxos at arcig.cz  Fri Mar 28 12:23:43 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Fri, 28 Mar 2008 12:23:43 +0100
Subject: [yade-dev] using cerr in TriaxialTest
Message-ID: <47ECD53F.8090705@arcig.cz>

Bruno,

may I ask you to find out why using
LOG_INFO("UnbalancedForce="<<UnbalancedForce) doesn't work for you? I
have to remove those cerr<< things since I they create so much noise on
the console where I want to see things that are more important for me at
the moment. If you have log4cxx installed, you need to create
~/.yade-*/logging.conf - the doc/logging.conf.sample will set level for
all messages to INFO, so you should see by default what unbalanced force is.

I am a bit pressed to have results before monday, sorry to write in such
a short way.

Vaclav


From bruno.chareyre at hmg.inpg.fr  Fri Mar 28 14:24:20 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Fri, 28 Mar 2008 14:24:20 +0100
Subject: [yade-dev] using cerr in TriaxialTest
In-Reply-To: <47ECD53F.8090705@arcig.cz>
References: <47ECD53F.8090705@arcig.cz>
Message-ID: <47ECF184.9060709@hmg.inpg.fr>

Ok, I created the file and I can see some DEBUG and INFO messages.
Anyway, do what you have to do if you need fast results.

Bruno

V?clav ?milauer a ?crit :
> Bruno,
>
> may I ask you to find out why using
> LOG_INFO("UnbalancedForce="<<UnbalancedForce) doesn't work for you? I
> have to remove those cerr<< things since I they create so much noise on
> the console where I want to see things that are more important for me at
> the moment. If you have log4cxx installed, you need to create
> ~/.yade-*/logging.conf - the doc/logging.conf.sample will set level for
> all messages to INFO, so you should see by default what unbalanced force is.
>
> I am a bit pressed to have results before monday, sorry to write in such
> a short way.
>
> Vaclav
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Fri Mar 28 19:52:18 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Fri, 28 Mar 2008 19:52:18 +0100
Subject: [yade-dev] [Yade-commits] r1283 - in trunk: . core extra
 extra/clump gui gui/cmd lib/serialization
 pkg/common/DataClass/PhysicalParameters	pkg/common/Engine/EngineUnit
 pkg/common/Engine/StandAloneEngine pkg/dem/Engine/EngineUnit scripts
In-Reply-To: <200803220840.m2M8eHqQ028074@sheep.berlios.de>
References: <200803220840.m2M8eHqQ028074@sheep.berlios.de>
Message-ID: <47ED3E62.1040906@hmg.inpg.fr>

Compilation is broken for me after this commit, because I don't have 
boost/foreach.hpp.
It is a file from boost 1.34 and I can install only 1.33 on feisty.

Bruno



eudoxos at BerliOS a ?crit :
> Author: eudoxos
> Date: 2008-03-22 09:40:15 +0100 (Sat, 22 Mar 2008)
> New Revision: 1283
>
> Added:
>    trunk/scripts/simple-scene.py
> Modified:
>    trunk/SConstruct
>    trunk/core/GeometricalModel.hpp
>    trunk/extra/Brefcom.hpp
>    trunk/extra/clump/Shop.cpp
>    trunk/gui/SConscript
>    trunk/gui/cmd/attrUtils.cpp
>    trunk/gui/cmd/yadeControl.cpp
>    trunk/lib/serialization/Serializable.hpp
>    trunk/pkg/common/DataClass/PhysicalParameters/ParticleParameters.cpp
>    trunk/pkg/common/Engine/EngineUnit/InteractingSphere2AABB.cpp
>    trunk/pkg/common/Engine/EngineUnit/InteractingSphere2AABB.hpp
>    trunk/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider.cpp
>    trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4DistantSpheresContactGeometry.cpp
>    trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4DistantSpheresContactGeometry.hpp
>    trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp
>    trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.hpp
> Log:
> 1. MAJOR improvements of the python wrappers (constructors take attributes etc.)
> 2. FIRST proof-of-implementation simulation completely created in python: scripts/simple-scene.py. This file will be commented abundantly shortly.
> 3. Add default values to some bool params so that there is no serializer error if they are uninitialized.
> 4. Add aabbEnlargeFactor to InteractingSphere2AABB?\194?\160(should be added to InteractingBox2AABB as well?) (not tested yet)
> 5. rename InteractionDetectionFactor to interactinDetectionFactor
> 6. Serialization now registers only attributes that have not yet been registered (there were problems with python because of that: at first save, attributes were duplicated and the xml file was less readble, although loadable)
> 7. Scan .tpp and .ipp for c++ tags as well
> 8. Some documentation.
>
> [scripts/default-test.py passes as normally]
>
>
>
> Modified: trunk/SConstruct
> ===================================================================
> --- trunk/SConstruct	2008-03-20 20:14:47 UTC (rev 1282)
> +++ trunk/SConstruct	2008-03-22 08:40:15 UTC (rev 1283)
> @@ -161,7 +161,7 @@
>  		else: print "Nothing to clean: %s."%buildDir
>  		sys.argv.remove('clean')
>  	if 'tags' in sys.argv:
> -		cmd="ctags -R --extra=+q --fields=+n --exclude='.*' --exclude=scons-local --exclude=include --exclude='*.so' --langmap=c++:+.inl"
> +		cmd="ctags -R --extra=+q --fields=+n --exclude='.*' --exclude=scons-local --exclude=include --exclude='*.so' --langmap=c++:+.inl,c++:+.tpp,c++:+.ipp"
>  		print cmd; os.system(cmd)
>  		sys.argv.remove('tags')
>  	if 'doc' in sys.argv:
>
> Modified: trunk/core/GeometricalModel.hpp
> ===================================================================
> --- trunk/core/GeometricalModel.hpp	2008-03-20 20:14:47 UTC (rev 1282)
> +++ trunk/core/GeometricalModel.hpp	2008-03-22 08:40:15 UTC (rev 1283)
> @@ -26,6 +26,8 @@
>  
>  		Vector3r	diffuseColor;
>  
> +		GeometricalModel(): visible(true),wire(false),shadowCaster(false),diffuseColor(Vector3r(1,1,1)){}
> +
>  	protected : 
>  		void registerAttributes();
>  
>
> Modified: trunk/extra/Brefcom.hpp
> ===================================================================
> --- trunk/extra/Brefcom.hpp	2008-03-20 20:14:47 UTC (rev 1282)
> +++ trunk/extra/Brefcom.hpp	2008-03-22 08:40:15 UTC (rev 1283)
> @@ -159,8 +159,8 @@
>  			Real E=Shop::getDefault<double>("phys_young");
>  			Real epsCrackOnset=sigmaC/E;
>  			calibratedEpsFracture=BrefcomLaw::calibrateEpsFracture(Gf,E,expBending,epsCrackOnset);
> -			assert(calibratedEpsFracture>epsCrackOnset);
> -			LOG_DEBUG("calibratedEpsFracture="<<calibratedEpsFracture<<" for Gf="<<Gf<<", expCrackOnset="<<epsCrackOnset<<", E="<<E<<" and expBending="<<expBending);
> +			LOG_DEBUG("calibratedEpsFracture="<<calibratedEpsFracture);
> +			if(calibratedEpsFracture>epsCrackOnset) LOG_WARN("calibratedEpsFracture="<<calibratedEpsFracture<<" < epsCrackOnset="<<epsCrackOnset<<", Gf="<<Gf<<", E="<<E<<", expBending="<<expBending);
>  		}
>  
>  		virtual void go(const shared_ptr<PhysicalParameters>& pp1, const shared_ptr<PhysicalParameters>& pp2, const shared_ptr<Interaction>& interaction);
>
> Modified: trunk/extra/clump/Shop.cpp
> ===================================================================
> --- trunk/extra/clump/Shop.cpp	2008-03-20 20:14:47 UTC (rev 1282)
> +++ trunk/extra/clump/Shop.cpp	2008-03-22 08:40:15 UTC (rev 1283)
> @@ -106,7 +106,7 @@
>  	setDefault<int>("body_sdecGroupMask",55);
>  	
>  	setDefault("phys_density",2e3);
> -	setDefault("phys_young",30e10);
> +	setDefault("phys_young",30e9);
>  	setDefault("phys_poisson",.3);
>  	setDefault("phys_frictionAngle",0.5236); //30?
>  	setDefault("phys_se3_orientation",Quaternionr(Vector3r(0,0,1),0));
>
> Modified: trunk/gui/SConscript
> ===================================================================
> --- trunk/gui/SConscript	2008-03-20 20:14:47 UTC (rev 1282)
> +++ trunk/gui/SConscript	2008-03-22 08:40:15 UTC (rev 1283)
> @@ -38,7 +38,14 @@
>  	env.Install('$PREFIX/lib/yade$SUFFIX/gui',[
>  		env.SharedLibrary('cmdGui',['cmd/cmdGui.cpp']),
>  		env.SharedLibrary('yadeControl',['cmd/yadeControl.cpp','cmd/GLViewer4.cpp'],SHLIBPREFIX='',
> -			LIBS=env['LIBS']+['yade-base','libboost_python','XMLFormatManager','yade-factory','yade-serialization',],
> +			LIBS=env['LIBS']+['yade-base','libboost_python','XMLFormatManager','yade-factory','yade-serialization','Shop',
> +				'BoundingVolumeMetaEngine',
> +				'GeometricalModelMetaEngine',
> +				'InteractingGeometryMetaEngine',
> +				'InteractionGeometryMetaEngine',
> +				'InteractionPhysicsMetaEngine',
> +				'PhysicalParametersMetaEngine',
> +			],
>  			# '$QGLVIEWER_LIB'
>  			#CPPPATH=env['CPPPATH']+['/usr/include/qt4','/usr/include/qt4/Qt','/usr/include/qt4/QtXml','/usr/include/qt4/QtOpenGL','/usr/include/qt4/QtCore','/usr/include/qt4/QtGui'],
>  			CPPDEFINES=env['CPPDEFINES']+['NO_PYGLVIEWER'],
>
> Modified: trunk/gui/cmd/attrUtils.cpp
> ===================================================================
> --- trunk/gui/cmd/attrUtils.cpp	2008-03-20 20:14:47 UTC (rev 1282)
> +++ trunk/gui/cmd/attrUtils.cpp	2008-03-22 08:40:15 UTC (rev 1283)
> @@ -32,7 +32,7 @@
>   * This class exposes pySet, pyGet and pyKeys methods to python so that associated object supports python syntax for dictionary member access.
>   */
>  class AttrAccess{
> -	struct AttrDesc{vector<int> types; shared_ptr<Archive> archive;};
> +	struct AttrDesc{int type; shared_ptr<Archive> archive;};
>  	private:
>  		const shared_ptr<Serializable> ser;
>  		Serializable::Archives archives;
> @@ -42,7 +42,7 @@
>  		//! maps attribute name to its archive and vector of its types (given as ints, from the following enum)
>  		DescriptorMap descriptors;
>  		//! allowed types
> -		enum {BOOL,STRING,NUMBER}; // allowed types
> +		enum {BOOL,STRING,NUMBER, SEQ_NUMBER, SEQ_STRING }; // allowed types
>  		
>  		AttrAccess(Serializable* _ser): ser(shared_ptr<Serializable>(_ser)){init();}
>  		AttrAccess(shared_ptr<Serializable> _ser):ser(_ser){init();}
> @@ -55,14 +55,14 @@
>  				if((*ai)->isFundamental() && (*ai)->getName()!="serializationDynlib"){
>  					AttrDesc desc; 
>  					desc.archive=*ai;
> -					// serialize to get size
> -					stringstream stream; vector<string> values;
> -					(*ai)->serialize(stream,**ai,0); IOFormatManager::parseFundamental(stream.str(),values);
>  					any instance=(*ai)->getAddress(); // gets pointer to the stored value
>  					// 3 possibilities: one BOOL, one STRING, one or more NUMBERs
> -					if     (values.size()==1 && any_cast<bool*>(&instance))   desc.types.push_back(AttrAccess::BOOL);
> -					else if(values.size()==1 && any_cast<string*>(&instance)) desc.types.push_back(AttrAccess::STRING);
> -					else {for(size_t i=0; i<values.size(); i++)               desc.types.push_back(AttrAccess::NUMBER);};
> +					if      (any_cast<string*>(&instance)) desc.type=AttrAccess::STRING;
> +					else if (any_cast<bool*>(&instance))   desc.type=AttrAccess::BOOL;
> +					else if (any_cast<Real*>(&instance) || any_cast<int*>(&instance) || any_cast<unsigned int*>(&instance) || any_cast<long*>(&instance) || any_cast<unsigned long*>(&instance)) desc.type=AttrAccess::NUMBER;
> +					else if (any_cast<vector<string>*>(&instance)) desc.type=AttrAccess::SEQ_STRING;
> +					//else if (any_cast<vector<Real>*>(&instance)) desc.type=AttrAccess::SEQ_NUMBER;
> +					else desc.type=AttrAccess::SEQ_NUMBER;
>  					descriptors[(*ai)->getName()]=desc;
>  				}
>  			}
> @@ -81,8 +81,8 @@
>  		string dumpAttr(string name){
>  			string vals,types; AttrDesc desc=descriptors[name]; vector<string> values=getAttrStr(name);
>  			for(size_t i=0; i<values.size(); i++) vals+=(i>0?" ":"")+values[i];
> -			for(size_t i=0; i<desc.types.size(); i++) types+=string(i>0?" ":"")+(desc.types[i]==BOOL?"BOOL":(desc.types[i]==STRING?"STRING":"NUMBER"));
> -			return name+" =\t"+vals+"\t ("+types+")";
> +			string typeDesc(desc.type==BOOL?"BOOL":(desc.type==STRING?"STRING":(desc.type==NUMBER?"NUMBER":(desc.type==SEQ_NUMBER?"SEQ_NUMBER":(desc.type==SEQ_STRING?"SEQ_STRING":"<unknown>")))));
> +			return name+" =\t"+vals+"\t ("+typeDesc+")";
>  		}
>  		//! call dumpAttr for all attributes (used for debugging)
>  		string dumpAttrs(){ string ret; for(DescriptorMap::iterator I=descriptors.begin();I!=descriptors.end();I++) ret+=dumpAttr(I->first)+"\n"; return ret;}
> @@ -92,12 +92,6 @@
>  			stringstream voidStream;
>  			descriptors[name].archive->deserialize(voidStream,*(descriptors[name].archive),value);
>  		}
> -		//! set attribute from its (non-serialized) value, for all possible types
> -		void setAttr(string name, bool value){setAttrStr(name,value?"1":"0");}
> -		void setAttr(string name, string value){setAttrStr(name,value);}
> -		void setAttr(string name, double value){setAttrStr(name,lexical_cast<string>(value));}
> -		void setAttr(string name, vector<double> values){string val("{"); for(size_t i=0; i<values.size();i++) val+=(lexical_cast<string>(values[i]))+" "; setAttrStr(name,val+"}"); }
> -
>  		//! return python list of keys (attribute names)
>  		boost::python::list pyKeys(){boost::python::list ret; for(DescriptorMap::iterator I=descriptors.begin();I!=descriptors.end();I++)ret.append(I->first); return ret;}
>  
> @@ -106,34 +100,39 @@
>  			DescriptorMap::iterator I=descriptors.find(key);
>  			if(I==descriptors.end()) throw std::invalid_argument(string("Invalid key: `")+key+"'.");
>  			vector<string> raw=getAttrStr(key);
> -			if(raw.size()==1){
> -				if(descriptors[key].types[0]==BOOL) return boost::python::object(lexical_cast<bool>(raw[0]));
> -				if(descriptors[key].types[0]==STRING) return boost::python::object(raw[0]);
> -				if(descriptors[key].types[0]==NUMBER) return boost::python::object(lexical_cast<double>(raw[0]));
> -			} else { // list of numbers
> -				/*list<double> ret;
> -				for(vector<string>::iterator I=raw.begin();I!=raw.end();I++)ret.push_back(lexical_cast<double>(*I));
> -				return boost::python::object<list<double> >(ret);*/
> -				boost::python::list ret;
> -				for(vector<string>::iterator I=raw.begin();I!=raw.end();I++)ret.append(lexical_cast<double>(*I));
> -				return ret;
> +			switch(descriptors[key].type){
> +				case BOOL: return python::object(lexical_cast<bool>(raw[0]));
> +				case NUMBER: return python::object(lexical_cast<double>(raw[0]));
> +				case STRING: return python::object(raw[0]);
> +				case SEQ_STRING: {python::list ret; for(size_t i=0; i<raw.size(); i++) ret.append(python::object(raw[i])); return ret;}
> +				case SEQ_NUMBER: {python::list ret; for(size_t i=0; i<raw.size(); i++) ret.append(python::object(lexical_cast<double>(raw[i]))); return ret; }
> +				default: throw runtime_error("Unhandled attribute type!");
>  			}
> -			return boost::python::object();
>  		}
>  		//! set attribute value from python object
>  		void pySet(std::string key, python::object val){
>  			DescriptorMap::iterator I=descriptors.find(key);
>  			if(I==descriptors.end()) throw std::invalid_argument(string("Invalid key: `")+key+"'.");
> -			if(descriptors[key].types.size()==1){
> -				if(descriptors[key].types[0]==BOOL) { setAttr(key,python::extract<bool>(val)); return;}
> -				if(descriptors[key].types[0]==STRING){setAttr(key,python::extract<string>(val)); return;}
> -				if(descriptors[key].types[0]==NUMBER){setAttr(key,python::extract<double>(val)); return;}
> -			} else {
> -				if(PySequence_Check(val.ptr()) && PySequence_Size(val.ptr())==(int)descriptors[key].types.size()){
> -					vector<double> cval;
> -					for(int i=0; i<PySequence_Size(val.ptr()); i++) cval.push_back(python::extract<double>(PySequence_GetItem(val.ptr(),i)));
> -					setAttr(key,cval);
> -				} else {	throw std::invalid_argument(string("Value for `")+key+"' not sequence or not of the expected length ("+lexical_cast<string>(descriptors[key].types.size())+")"); }
> +			#define SAFE_EXTRACT(from,to,type) python::extract<type> to(from); if(!to.check()) throw invalid_argument(string("Could not extract type ")+#type);
> +			switch(descriptors[key].type){
> +				case BOOL: {SAFE_EXTRACT(val.ptr(),extr,bool); setAttrStr(key,extr()?"1":"0"); break;}
> +				case NUMBER: {SAFE_EXTRACT(val.ptr(),extr,double); setAttrStr(key,lexical_cast<string>(extr())); break; }
> +				case STRING: {SAFE_EXTRACT(val.ptr(),extr,string); setAttrStr(key,extr()); break;}
> +				case SEQ_STRING:{
> +					if(!PySequence_Check(val.ptr())) throw invalid_argument("String sequence argument required.");
> +					string strVal("[");
> +					for(int i=0; i<PySequence_Size(val.ptr()); i++){SAFE_EXTRACT(PySequence_GetItem(val.ptr(),i),extr,string); strVal+=extr()+" ";}
> +					setAttrStr(key,strVal+"]");
> +				} 
> +				break;
> +				case SEQ_NUMBER:{
> +					if(!PySequence_Check(val.ptr())) throw invalid_argument("Number sequence argument required.");
> +					string strVal("{");
> +					for(int i=0; i<PySequence_Size(val.ptr()); i++){SAFE_EXTRACT(PySequence_GetItem(val.ptr(),i),extr,double); strVal+=lexical_cast<string>(extr())+" ";}
> +					setAttrStr(key,strVal+"}");
> +				}
> +				break;
> +				default: throw runtime_error("Invalid argument types!!");
>  			}
>  		}
>  };
>
> Modified: trunk/gui/cmd/yadeControl.cpp
> ===================================================================
> --- trunk/gui/cmd/yadeControl.cpp	2008-03-20 20:14:47 UTC (rev 1282)
> +++ trunk/gui/cmd/yadeControl.cpp	2008-03-22 08:40:15 UTC (rev 1283)
> @@ -13,6 +13,7 @@
>  #include<boost/any.hpp>
>  #include<boost/shared_ptr.hpp>
>  #include<boost/python.hpp>
> +#include<boost/foreach.hpp>
>  // [boost1.34] #include<boost/python/stl_iterator.hpp>
>  
>  #include<yade/lib-base/Logging.hpp>
> @@ -22,12 +23,34 @@
>  
>  
>  #include<yade/core/MetaDispatchingEngine.hpp>
> +#include<yade/core/MetaDispatchingEngine1D.hpp>
> +#include<yade/core/MetaDispatchingEngine2D.hpp>
>  #include<yade/core/StandAloneEngine.hpp>
>  #include<yade/core/DeusExMachina.hpp>
>  #include<yade/core/EngineUnit.hpp>
>  #include<yade/core/EngineUnit1D.hpp>
>  #include<yade/core/EngineUnit2D.hpp>
>  
> +#include<yade/pkg-common/BoundingVolumeMetaEngine.hpp>
> +#include<yade/pkg-common/GeometricalModelMetaEngine.hpp>
> +#include<yade/pkg-common/InteractingGeometryMetaEngine.hpp>
> +#include<yade/pkg-common/InteractionGeometryMetaEngine.hpp>
> +#include<yade/pkg-common/InteractionPhysicsMetaEngine.hpp>
> +#include<yade/pkg-common/PhysicalParametersMetaEngine.hpp>
> +#include<yade/pkg-common/PhysicalActionDamper.hpp>
> +#include<yade/pkg-common/PhysicalActionApplier.hpp>
> +
> +#include<yade/pkg-common/BoundingVolumeEngineUnit.hpp>
> +#include<yade/pkg-common/GeometricalModelEngineUnit.hpp>
> +#include<yade/pkg-common/InteractingGeometryEngineUnit.hpp>
> +#include<yade/pkg-common/InteractionGeometryEngineUnit.hpp>
> +#include<yade/pkg-common/InteractionPhysicsEngineUnit.hpp>
> +#include<yade/pkg-common/PhysicalParametersEngineUnit.hpp>
> +#include<yade/pkg-common/PhysicalActionDamperUnit.hpp>
> +#include<yade/pkg-common/PhysicalActionApplierUnit.hpp>
> +
> +#include<yade/extra/Shop.hpp>
> +
>  #ifdef USE_PYGLVIEWER
>  	#include"GLViewer4.hpp"
>  	#include<Qt/qapplication.h>
> @@ -43,16 +66,17 @@
>  
>  /*
>  TODO:
> -	1. InteractionContainer with iteration
> +	1. [DONE] InteractionContainer with iteration
>  	2. PhysicalActionContainer (constructor with actionName) with iteration
>  	3. from yadeControl import Omega as _Omega, inherit from that and add other convenience functions
>  */
>  
>  #define BASIC_PY_PROXY_HEAD(pyClass,yadeClass) \
>  class pyClass{shared_ptr<AttrAccess> accessor; \
> +	private: void init(string clss){ proxee=dynamic_pointer_cast<yadeClass>(ClassFactory::instance().createShared(clss.empty()? #yadeClass : clss)); if(!proxee) throw runtime_error("Invalid class `"+clss+"': either nonexistent, or unable to cast to `"+#yadeClass+"'"); } \
>  	public: shared_ptr<yadeClass> proxee; \
>  		void ensureAcc(void){ if(!proxee) throw runtime_error(string("No proxied `")+#yadeClass+"'."); if(!accessor) accessor=shared_ptr<AttrAccess>(new AttrAccess(proxee));} \
> -		pyClass(string clss=""){proxee=dynamic_pointer_cast<yadeClass>(ClassFactory::instance().createShared(clss.empty()? #yadeClass : clss)); if(!proxee) throw runtime_error("Invalid class `"+clss+"': either nonexistent, or unable to cast to `"+#yadeClass+"'"); } \
> +		pyClass(string clss="", python::dict attrs=python::dict()){ init(clss); python::list l=attrs.items(); int len=PySequence_Size(l.ptr()); for(int i=0; i<len; i++){ python::extract<python::tuple> t(l[i]); python::extract<string> keyEx(t()[0]); if(!keyEx.check()) throw invalid_argument("Attribute keys must be strings."); wrappedPySet(keyEx(),t()[1]); } } \
>  		pyClass(const shared_ptr<yadeClass>& _proxee): proxee(_proxee) {} \
>  		std::string pyStr(void){ ensureAcc(); return string(proxee->getClassName()==#yadeClass ? "<"+proxee->getClassName()+">" : "<"+proxee->getClassName()+" "+ #yadeClass +">"); } \
>  		string className(void){ ensureAcc(); return proxee->getClassName(); } \
> @@ -80,6 +104,8 @@
>  
>  
>  BASIC_PY_PROXY_HEAD(pyMetaEngine,MetaDispatchingEngine)
> +		// additional constructor
> +		pyMetaEngine(string clss, python::list functors){init(clss); functors_set(functors);}
>  		python::list functors_get(void){
>  			ensureAcc(); shared_ptr<MetaDispatchingEngine> me=dynamic_pointer_cast<MetaDispatchingEngine>(proxee); if(!me) throw runtime_error("Proxied class not a MetaDispatchingEngine (WTF?)"); python::list ret;
>  			/* garbage design: functorArguments are instances of EngineUnits, but they may not be present; therefore, only use them if they exist; our pyMetaEngine, however, will always have both names and EnguneUnit objects in the same count */
> @@ -95,10 +121,27 @@
>  			}
>  			return ret;
>  		}
> -		void functors_set(python::object ftrs){
> +		void functors_set(python::list ftrs){
>  			ensureAcc(); shared_ptr<MetaDispatchingEngine> me=dynamic_pointer_cast<MetaDispatchingEngine>(proxee); if(!me) throw runtime_error("Proxied class not a MetaDispatchingEngine. (WTF?)");
>  			me->clear(); int len=PySequence_Size(ftrs.ptr()) /*[boost1.34] python::len(ftrs)*/;
> -			for(int i=0; i<len; i++){ const pyEngineUnit& eu=python::extract<pyEngineUnit>(PySequence_GetItem(ftrs.ptr(),i)); me->add(eu.proxee); }
> +			for(int i=0; i<len; i++){
> +				python::extract<pyEngineUnit> euEx(ftrs[i]); if(!euEx.check()) throw invalid_argument("Unable to extract type EngineUnit from sequence.");
> +				bool ok=false;
> +				/* FIXME: casting engine unit to the right type via dynamic_cast doesn't work (always unusuccessful),
> +				 * do static_cast and if the EngineUnit is of wrong type, it will crash badly immediately. */
> +				#define TRY_ADD_FUNCTOR(P,Q) {shared_ptr<P> p(dynamic_pointer_cast<P>(me)); shared_ptr<EngineUnit> eu(euEx().proxee); if(p&&eu){p->add(static_pointer_cast<Q>(eu)); ok=true; }}
> +				// shared_ptr<Q> q(dynamic_pointer_cast<Q>(eu)); cerr<<#P<<" "<<#Q<<":"<<(bool)p<<" "<<(bool)q<<endl;
> +				TRY_ADD_FUNCTOR(BoundingVolumeMetaEngine,BoundingVolumeEngineUnit);
> +				TRY_ADD_FUNCTOR(GeometricalModelMetaEngine,GeometricalModelEngineUnit);
> +				TRY_ADD_FUNCTOR(InteractingGeometryMetaEngine,InteractingGeometryEngineUnit);
> +				TRY_ADD_FUNCTOR(InteractionGeometryMetaEngine,InteractionGeometryEngineUnit);
> +				TRY_ADD_FUNCTOR(InteractionPhysicsMetaEngine,InteractionPhysicsEngineUnit);
> +				TRY_ADD_FUNCTOR(PhysicalParametersMetaEngine,PhysicalParametersEngineUnit);
> +				TRY_ADD_FUNCTOR(PhysicalActionDamper,PhysicalActionDamperUnit);
> +				TRY_ADD_FUNCTOR(PhysicalActionApplier,PhysicalActionApplierUnit);
> +				if(!ok) throw runtime_error(string("Unable to cast to suitable MetaEngine type when adding functor (MetaEngine: ")+me->getClassName()+", functor: "+euEx().proxee->getClassName()+")");
> +				#undef TRY_ADD_FUNCTOR
> +			}
>  		}
>  BASIC_PY_PROXY_TAIL;
>  
> @@ -129,8 +172,35 @@
>  		if(id>=proxee->size()){ PyErr_SetString(PyExc_IndexError, "Body id out of range."); python::throw_error_already_set(); /* make compiler happy; never reached */ return pyBody(); }
>  		else return pyBody(proxee->operator[](id));
>  	}
> +	body_id_t insert(pyBody b){return proxee->insert(b.proxee);}
> +	void clear(){proxee->clear();}
>  };
>  
> +class pyInteractionIterator{
> +	InteractionContainer::iterator I, Iend;
> +	public:
> +	pyInteractionIterator(const shared_ptr<InteractionContainer>& ic){ I=ic->begin(); Iend=ic->end(); }
> +	pyInteractionIterator pyIter(){return *this;}
> +	pyInteraction pyNext(){ if(!(I!=Iend)){ PyErr_SetNone(PyExc_StopIteration); python::throw_error_already_set(); }
> +		InteractionContainer::iterator ret=I; ++I; return pyInteraction(*ret); }
> +};
> +
> +class pyInteractionContainer{
> +	public:
> +		const shared_ptr<InteractionContainer> proxee;
> +		pyInteractionContainer(const shared_ptr<InteractionContainer>& _proxee): proxee(_proxee){}
> +		pyInteractionIterator pyIter(){return pyInteractionIterator(proxee);}
> +		pyInteraction pyGetitem(python::object id12){
> +			if(!PySequence_Check(id12.ptr())) throw invalid_argument("Key must be a tuple");
> +			if(PySequence_Size(id12.ptr())!=2) throw invalid_argument("Key must be a 2-tuple: id1,id2.");
> +			python::extract<body_id_t> id1_(PySequence_GetItem(id12.ptr(),0)), id2_(PySequence_GetItem(id12.ptr(),1));
> +			if(!id1_.check()) throw invalid_argument("Could not extract id1");
> +			if(!id2_.check()) throw invalid_argument("Could not extract id2");
> +			shared_ptr<Interaction> i=proxee->find(id1_(),id2_());
> +			if(i) return pyInteraction(i); else throw invalid_argument("No such interaction.");
> +		}
> +};
> +
>  BASIC_PY_PROXY_HEAD(pyFileGenerator,FileGenerator)
>  	bool generate(string outFile){ensureAcc(); proxee->setFileName(outFile); proxee->setSerializationLibrary("XMLFormatManager"); bool ret=proxee->generateAndSave(); cerr<<(ret?"SUCCESS:\n":"FAILURE:\n")<<proxee->message<<endl; return ret; };
>  BASIC_PY_PROXY_TAIL;
> @@ -139,9 +209,10 @@
>  class pyOmega{
>  	#define OMEGA Omega::instance()
>  	private:
> +		// can be safely removed now, since pyOmega makes an empty rootBody in the constructor, if there is none
>  		void assertRootBody(){if(!OMEGA.getRootBody()) throw std::runtime_error("No root body."); }
>  	public:
> -	pyOmega(){};
> +	pyOmega(){ if(!OMEGA.getRootBody()){shared_ptr<MetaBody> mb=Shop::rootBody(); OMEGA.setRootBody(mb);} };
>  
>  	long iter(){ return OMEGA.getCurrentIteration();}
>  	double simulationTime(){return OMEGA.getSimulationTime();}
> @@ -187,29 +258,38 @@
>  		cerr<<"SAVE!"<<endl;
>  	}
>  
> -	python::list engines_get(void){
> -		assertRootBody(); python::list ret; const shared_ptr<MetaBody>& rootBody=OMEGA.getRootBody();
> -		for(vector<shared_ptr<Engine> >::iterator I=rootBody->engines.begin(); I!=rootBody->engines.end(); ++I){
> -			#define APPEND_ENGINE_IF_POSSIBLE(engineType,pyEngineType) { shared_ptr<engineType> e=dynamic_pointer_cast<engineType>(*I); if(e) { ret.append(pyEngineType(e)); continue; } }
> +	python::list anyEngines_get(vector<shared_ptr<Engine> >& engContainer){
> +		python::list ret; 
> +		//for(vector<shared_ptr<Engine> >::iterator I=engContainer.begin(); I!=engContainer.end(); ++I){
> +		BOOST_FOREACH(shared_ptr<Engine>& eng, engContainer){
> +			#define APPEND_ENGINE_IF_POSSIBLE(engineType,pyEngineType) { shared_ptr<engineType> e=dynamic_pointer_cast<engineType>(eng); if(e) { ret.append(pyEngineType(e)); continue; } }
>  			APPEND_ENGINE_IF_POSSIBLE(MetaDispatchingEngine,pyMetaEngine); APPEND_ENGINE_IF_POSSIBLE(StandAloneEngine,pyStandAloneEngine); APPEND_ENGINE_IF_POSSIBLE(DeusExMachina,pyDeusExMachina);
> -			throw std::runtime_error("Unknown engine type: `"+(*I)->getClassName()+"' (only MetaDispatchingEngine, StandAloneEngine and DeusExMachina are supported)");
> +			throw std::runtime_error("Unknown engine type: `"+eng->getClassName()+"' (only MetaDispatchingEngine, StandAloneEngine and DeusExMachina are supported)");
>  		}
>  		return ret;
>  	}
>  
> -	void engines_set(python::object egs){
> -		assertRootBody(); int len=PySequence_Size(egs.ptr()) /*[boost1.34] python::len(egs)*/; const shared_ptr<MetaBody>& rootBody=OMEGA.getRootBody(); rootBody->engines.clear();
> +	void anyEngines_set(vector<shared_ptr<Engine> >& engContainer, python::object egs){
> +		assertRootBody(); int len=PySequence_Size(egs.ptr()) /*[boost1.34] python::len(egs)*/;
> +		//const shared_ptr<MetaBody>& rootBody=OMEGA.getRootBody(); rootBody->engines.clear();
> +		engContainer.clear();
>  		for(int i=0; i<len; i++){
> -			#define PUSH_BACK_ENGINE_IF_POSSIBLE(pyEngineType) if(python::extract<pyEngineType>(PySequence_GetItem(egs.ptr(),i)).check()){ pyEngineType e=python::extract<pyEngineType>(PySequence_GetItem(egs.ptr(),i)); rootBody->engines.push_back(e.proxee); /* cerr<<"added "<<e.pyStr()<<", a "<<#pyEngineType<<endl; */ continue; }
> +			#define PUSH_BACK_ENGINE_IF_POSSIBLE(pyEngineType) if(python::extract<pyEngineType>(PySequence_GetItem(egs.ptr(),i)).check()){ pyEngineType e=python::extract<pyEngineType>(PySequence_GetItem(egs.ptr(),i)); engContainer.push_back(e.proxee); /* cerr<<"added "<<e.pyStr()<<", a "<<#pyEngineType<<endl; */ continue; }
>  			PUSH_BACK_ENGINE_IF_POSSIBLE(pyStandAloneEngine); PUSH_BACK_ENGINE_IF_POSSIBLE(pyMetaEngine); PUSH_BACK_ENGINE_IF_POSSIBLE(pyDeusExMachina);
>  			throw std::runtime_error("Encountered unknown engine type (unable to extract from python object)");
>  		}
>  	}
> +	python::list engines_get(void){assertRootBody(); return anyEngines_get(OMEGA.getRootBody()->engines);}
> +	void engines_set(python::object egs){assertRootBody(); anyEngines_set(OMEGA.getRootBody()->engines,egs);}
> +	python::list initializers_get(void){assertRootBody(); return anyEngines_get(OMEGA.getRootBody()->initializers);}
> +	void initializers_set(python::object egs){assertRootBody(); anyEngines_set(OMEGA.getRootBody()->initializers,egs);}
>  
> +
>  	//void join(){cerr<<"JOIN!"<<endl; OMEGA.joinSimulationLoop(); /* FIXME: this is OK, but must create simulation loop again! */ }
>  	void wait(){ if(OMEGA.isRunning()){cerr<<"WAIT!"<<endl;} while(OMEGA.isRunning()) usleep(20000 /*20 ms*/); }
>  	
>  	pyBodyContainer bodies_get(void){assertRootBody(); return pyBodyContainer(OMEGA.getRootBody()->bodies); }
> +	pyInteractionContainer interactions_get(void){assertRootBody(); return pyInteractionContainer(OMEGA.getRootBody()->transientInteractions); }
>  
>  	boost::python::list listChildClasses(const string& base){
>  		boost::python::list ret;
> @@ -340,13 +420,27 @@
>  		.def("step",&pyOmega::step)
>  		.def("wait",&pyOmega::wait)
>  		.add_property("engines",&pyOmega::engines_get,&pyOmega::engines_set)
> +		.add_property("initializers",&pyOmega::initializers_get,&pyOmega::initializers_set)
>  		.add_property("bodies",&pyOmega::bodies_get)
> +		.add_property("interactions",&pyOmega::interactions_get)
>  		.def("childClasses",&pyOmega::listChildClasses)
>  		;
>  	
>  	boost::python::class_<pyBodyContainer>("BodyContainer",python::init<pyBodyContainer&>())
> -		.def("__getitem__",&pyBodyContainer::pyGetitem);
> +		.def("__getitem__",&pyBodyContainer::pyGetitem)
> +		.def("append",&pyBodyContainer::insert)
> +		.def("clear", &pyBodyContainer::clear);
> +	boost::python::class_<pyInteractionContainer>("InteractionContainer",python::init<pyInteractionContainer&>())
> +		.def("__iter__",&pyInteractionContainer::pyIter)
> +		.def("__getitem__",&pyInteractionContainer::pyGetitem);
> +	boost::python::class_<pyInteractionIterator>("InteractionIterator",python::init<pyInteractionIterator&>())
> +		.def("__iter__",&pyInteractionIterator::pyIter)
> +		.def("next",&pyInteractionIterator::pyNext);
> +	
>  
> +//	boost::python::class_<pyBodyContainer>("BodyContainer",python::init<pyBodyContainer&>())
> +//		.def("__getitem__",&pyBodyContainer::pyGetitem);
> +
>  		#if 0
>  			.def("oneStep",&oneStep)
>  			.def("newView", &newView)
> @@ -358,24 +452,25 @@
>  #endif
>  
>  #define BASIC_PY_PROXY_WRAPPER(pyClass,pyName)  \
> -	boost::python::class_<pyClass>(pyName,python::init<python::optional<string> >()) \
> +	boost::python::class_<pyClass>(pyName,python::init<python::optional<string,python::dict> >()) \
>  	.ATTR_ACCESS_PY(pyClass) \
>  	.def("__str__",&pyClass::pyStr).def("__repr__",&pyClass::pyStr) \
>  	.add_property("name",&pyClass::className)
>  
>  	BASIC_PY_PROXY_WRAPPER(pyStandAloneEngine,"StandAloneEngine");
>  	BASIC_PY_PROXY_WRAPPER(pyMetaEngine,"MetaEngine")
> -		.add_property("functors",&pyMetaEngine::functors_get,&pyMetaEngine::functors_set);
> +		.add_property("functors",&pyMetaEngine::functors_get,&pyMetaEngine::functors_set)
> +		.def(python::init<string,python::list>());
>  	BASIC_PY_PROXY_WRAPPER(pyDeusExMachina,"DeusExMachina");
>  	BASIC_PY_PROXY_WRAPPER(pyEngineUnit,"EngineUnit")
>  		.add_property("bases",&pyEngineUnit::bases_get);
>  
> -	BASIC_PY_PROXY_WRAPPER(pyGeometricalModel,"Shape");
> -	BASIC_PY_PROXY_WRAPPER(pyInteractingGeometry,"Mold");
> -	BASIC_PY_PROXY_WRAPPER(pyPhysicalParameters,"Phys");
> -	BASIC_PY_PROXY_WRAPPER(pyBoundingVolume,"Bound");
> -	BASIC_PY_PROXY_WRAPPER(pyInteractionGeometry,"InterGeom");
> -	BASIC_PY_PROXY_WRAPPER(pyInteractionPhysics,"InterPhys");
> +	BASIC_PY_PROXY_WRAPPER(pyGeometricalModel,"GeometricalModel");
> +	BASIC_PY_PROXY_WRAPPER(pyInteractingGeometry,"InteractingGeometry");
> +	BASIC_PY_PROXY_WRAPPER(pyPhysicalParameters,"PhysicalParameters");
> +	BASIC_PY_PROXY_WRAPPER(pyBoundingVolume,"BoundingVolume");
> +	BASIC_PY_PROXY_WRAPPER(pyInteractionGeometry,"InteractionGeometry");
> +	BASIC_PY_PROXY_WRAPPER(pyInteractionPhysics,"InteractionPhysics");
>  
>  	BASIC_PY_PROXY_WRAPPER(pyBody,"Body")
>  		.add_property("shape",&pyBody::shape_get,&pyBody::shape_set)
> @@ -389,7 +484,9 @@
>  
>  	BASIC_PY_PROXY_WRAPPER(pyInteraction,"Interaction")
>  		.add_property("phys",&pyInteraction::phys_get,&pyInteraction::phys_set)
> -		.add_property("geom",&pyInteraction::geom_get,&pyInteraction::geom_set);
> +		.add_property("geom",&pyInteraction::geom_get,&pyInteraction::geom_set)
> +		.add_property("id1",&pyInteraction::id1_get)
> +		.add_property("id2",&pyInteraction::id2_get);
>  
>  	BASIC_PY_PROXY_WRAPPER(pyFileGenerator,"Preprocessor")
>  		.def("generate",&pyFileGenerator::generate);
>
> Modified: trunk/lib/serialization/Serializable.hpp
> ===================================================================
> --- trunk/lib/serialization/Serializable.hpp	2008-03-20 20:14:47 UTC (rev 1282)
> +++ trunk/lib/serialization/Serializable.hpp	2008-03-22 08:40:15 UTC (rev 1283)
> @@ -12,6 +12,7 @@
>  #define SERIALIZABLE_HPP
>  
>  #include <boost/any.hpp>
> +#include <boost/foreach.hpp>
>  #include <boost/shared_ptr.hpp>
>  #include <boost/type_traits.hpp>
>  #include <boost/lexical_cast.hpp>
> @@ -71,6 +72,7 @@
>  		template <typename Type>
>  		void registerAttribute(const string& name, Type& attribute)
>  		{
> +			BOOST_FOREACH(shared_ptr<Archive> a,archives){if(a->getName()==name){ /* cerr<<"Attribute "<<name<<" already registered."<<endl; */ return;}};
>  			shared_ptr<Archive> ac = Archive::create(name,attribute);
>  			archives.push_back(ac);
>  		}
>
> Modified: trunk/pkg/common/DataClass/PhysicalParameters/ParticleParameters.cpp
> ===================================================================
> --- trunk/pkg/common/DataClass/PhysicalParameters/ParticleParameters.cpp	2008-03-20 20:14:47 UTC (rev 1282)
> +++ trunk/pkg/common/DataClass/PhysicalParameters/ParticleParameters.cpp	2008-03-22 08:40:15 UTC (rev 1283)
> @@ -15,6 +15,8 @@
>  {
>  	createIndex();
>  	acceleration = Vector3r(0,0,0);
> +	velocity = Vector3r(0,0,0);
> +	mass=0;
>  }
>  
>  ParticleParameters::~ParticleParameters()
>
> Modified: trunk/pkg/common/Engine/EngineUnit/InteractingSphere2AABB.cpp
> ===================================================================
> --- trunk/pkg/common/Engine/EngineUnit/InteractingSphere2AABB.cpp	2008-03-20 20:14:47 UTC (rev 1282)
> +++ trunk/pkg/common/Engine/EngineUnit/InteractingSphere2AABB.cpp	2008-03-22 08:40:15 UTC (rev 1283)
> @@ -10,21 +10,14 @@
>  #include "InteractingSphere.hpp"
>  #include "AABB.hpp"
>  
> -void InteractingSphere2AABB::go(	  const shared_ptr<InteractingGeometry>& cm
> -				, shared_ptr<BoundingVolume>& bv
> -				, const Se3r& se3
> -				, const Body*	)
> -{
> +void InteractingSphere2AABB::go(const shared_ptr<InteractingGeometry>& cm, shared_ptr<BoundingVolume>& bv, const Se3r& se3, const Body*){
>  	InteractingSphere* sphere = static_cast<InteractingSphere*>(cm.get());
>  	AABB* aabb = static_cast<AABB*>(bv.get());
> -	
>  	aabb->center = se3.position;
> -	
>  	aabb->halfSize = Vector3r(sphere->radius,sphere->radius,sphere->radius);
>  	
> -	aabb->min = aabb->center-aabb->halfSize;
> -	aabb->max = aabb->center+aabb->halfSize;	
> -
> +	aabb->min = aabb->center-aabb->halfSize*aabbEnlargeFactor;
> +	aabb->max = aabb->center+aabb->halfSize*aabbEnlargeFactor;	
>  }
>  	
>  YADE_PLUGIN();
>
> Modified: trunk/pkg/common/Engine/EngineUnit/InteractingSphere2AABB.hpp
> ===================================================================
> --- trunk/pkg/common/Engine/EngineUnit/InteractingSphere2AABB.hpp	2008-03-20 20:14:47 UTC (rev 1282)
> +++ trunk/pkg/common/Engine/EngineUnit/InteractingSphere2AABB.hpp	2008-03-22 08:40:15 UTC (rev 1283)
> @@ -14,11 +14,11 @@
>  class InteractingSphere2AABB : public BoundingVolumeEngineUnit
>  {
>  	public :
> -		void go(	  const shared_ptr<InteractingGeometry>& cm
> -				, shared_ptr<BoundingVolume>& bv
> -				, const Se3r& se3
> -				, const Body*	);
> +		InteractingSphere2AABB(): aabbEnlargeFactor(1.) {}
> +		void go(const shared_ptr<InteractingGeometry>& cm, shared_ptr<BoundingVolume>& bv, const Se3r& se3, const Body*);
> +		double aabbEnlargeFactor;
>  	FUNCTOR2D(InteractingSphere,AABB);
> +	virtual void registerAttributes(){REGISTER_ATTRIBUTE(aabbEnlargeFactor);}
>  	REGISTER_CLASS_NAME(InteractingSphere2AABB);
>  	REGISTER_BASE_CLASS_NAME(BoundingVolumeEngineUnit);
>  };
>
> Modified: trunk/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider.cpp
> ===================================================================
> --- trunk/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider.cpp	2008-03-20 20:14:47 UTC (rev 1282)
> +++ trunk/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider.cpp	2008-03-22 08:40:15 UTC (rev 1283)
> @@ -20,11 +20,6 @@
>  	haveDistantTransient=false;
>  
>  	nbObjects=0;
> -	//xBounds.resize(2*maxObject);
> -	//yBounds.resize(2*maxObject);
> -	//zBounds.resize(2*maxObject);
> -	//minima = new Real[3*maxObject];
> -	//maxima = new Real[3*maxObject];
>  	xBounds.clear();
>  	yBounds.clear();
>  	zBounds.clear();
> @@ -67,8 +62,6 @@
>  			maxima[offset+0]=max[0]; maxima[offset+1]=max[1]; maxima[offset+2]=max[2];
>  		}
>  		else {
> -			// double nan=std::numeric_limits<Real>::quiet_NaN();
> -			// cerr<<"Assigning nan's, not tested! (hangs during sort?)"<<endl;
>  			/* assign the center of gravity as zero-volume bounding box;
>  			 * it should not create spurious interactions and
>  			 * is a better solution that putting nan's into minima and maxima which crashes on _some_ machines */
>
> Modified: trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4DistantSpheresContactGeometry.cpp
> ===================================================================
> --- trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4DistantSpheresContactGeometry.cpp	2008-03-20 20:14:47 UTC (rev 1282)
> +++ trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4DistantSpheresContactGeometry.cpp	2008-03-22 08:40:15 UTC (rev 1283)
> @@ -18,12 +18,12 @@
>  
>  InteractingSphere2InteractingSphere4DistantSpheresContactGeometry::InteractingSphere2InteractingSphere4DistantSpheresContactGeometry()
>  {
> -	InteractionDetectionFactor = 1;
> +	interactionDetectionFactor = 1;
>  }
>  
>  void InteractingSphere2InteractingSphere4DistantSpheresContactGeometry::registerAttributes()
>  {	
> -	REGISTER_ATTRIBUTE(InteractionDetectionFactor);
> +	REGISTER_ATTRIBUTE(interactionDetectionFactor);
>  }
>  
>  bool InteractingSphere2InteractingSphere4DistantSpheresContactGeometry::go(	const shared_ptr<InteractingGeometry>& cm1,
> @@ -36,7 +36,7 @@
>  	InteractingSphere* s2 = static_cast<InteractingSphere*>(cm2.get());
>  
>  	Vector3r normal = se32.position-se31.position;
> -	Real penetrationDepth = pow(InteractionDetectionFactor*(s1->radius+s2->radius), 2) - normal.SquaredLength();// Compute a wrong value just to check sign - faster than computing distances
> +	Real penetrationDepth = pow(interactionDetectionFactor*(s1->radius+s2->radius), 2) - normal.SquaredLength();// Compute a wrong value just to check sign - faster than computing distances
>  	//Real penetrationDepth = s1->radius+s2->radius-normal.Normalize();
>  
>  	shared_ptr<SpheresContactGeometry> scm;
>
> Modified: trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4DistantSpheresContactGeometry.hpp
> ===================================================================
> --- trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4DistantSpheresContactGeometry.hpp	2008-03-20 20:14:47 UTC (rev 1282)
> +++ trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4DistantSpheresContactGeometry.hpp	2008-03-22 08:40:15 UTC (rev 1283)
> @@ -31,7 +31,7 @@
>  					
>  		InteractingSphere2InteractingSphere4DistantSpheresContactGeometry();		
>  					
> -		double InteractionDetectionFactor;// InteractionGeometry will be computed when InteractionDetectionFactor*(rad1+rad2) > distance 		
> +		double interactionDetectionFactor;// InteractionGeometry will be computed when interactionDetectionFactor*(rad1+rad2) > distance 		
>  	
>  	FUNCTOR2D(InteractingSphere,InteractingSphere);
>  
>
> Modified: trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp
> ===================================================================
> --- trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp	2008-03-20 20:14:47 UTC (rev 1282)
> +++ trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp	2008-03-22 08:40:15 UTC (rev 1283)
> @@ -18,12 +18,12 @@
>  
>  InteractingSphere2InteractingSphere4SpheresContactGeometry::InteractingSphere2InteractingSphere4SpheresContactGeometry()
>  {
> -	InteractionDetectionFactor = 1;
> +	interactionDetectionFactor = 1;
>  }
>  
>  void InteractingSphere2InteractingSphere4SpheresContactGeometry::registerAttributes()
>  {	
> -	REGISTER_ATTRIBUTE(InteractionDetectionFactor);
> +	REGISTER_ATTRIBUTE(interactionDetectionFactor);
>  }
>  
>  bool InteractingSphere2InteractingSphere4SpheresContactGeometry::go(	const shared_ptr<InteractingGeometry>& cm1,
> @@ -36,58 +36,44 @@
>  	InteractingSphere* s2 = static_cast<InteractingSphere*>(cm2.get());
>  
>  	Vector3r normal = se32.position-se31.position;
> -	Real penetrationDepth = pow(InteractionDetectionFactor*(s1->radius+s2->radius), 2) - normal.SquaredLength();// Compute a wrong value just to check sign - faster than computing distances
> +	Real penetrationDepth = pow(interactionDetectionFactor*(s1->radius+s2->radius), 2) - normal.SquaredLength();// Compute a wrong value just to check sign - faster than computing distances
>  	//Real penetrationDepth = s1->radius+s2->radius-normal.Normalize();
> -	if (penetrationDepth>0 || c->isReal)
> -	{
> -
> -	shared_ptr<SpheresContactGeometry> scm;
> -	if (c->interactionGeometry)
> -	{
> -		//scm = YADE_PTR_CAST<SpheresContactGeometry>(c->interactionGeometry);
> -	//
> -	// WARNING! 
> -	//
> -	// FIXME - this must be dynamic cast until the contaners are rewritten to support multiple interactions types
> -	//         the problem is that scm can be either SDECLinkGeometry or SpheresContactGeometry and the only way CURRENTLY
> -	//         to check this is by dynamic cast. This has to be fixed.
> -	//
> -		scm = YADE_PTR_CAST<SpheresContactGeometry>(c->interactionGeometry);
> -		//scm = dynamic_cast<SpheresContactGeometry*>(c->interactionGeometry.get());
> -	// BEGIN .......  FIXME FIXME	- wrong hack, to make cohesion work.
> -// 		if(! scm) // this is not SpheresContactGeometry, so it is SDECLinkGeometry, dispatcher should do this job.
> -// 		{
> -// 			shared_ptr<SDECLinkGeometry> linkGeometry = dynamic_pointer_cast<SDECLinkGeometry>(c->interactionGeometry);
> -// //			cerr << "it is SpringGeometry ???: " << c->interactionGeometry->getClassName() << endl;
> -// //			assert(linkGeometry);
> -// 			if(linkGeometry)
> -// 			{
> -// 				linkGeometry->normal 			= se32.position-se31.position;
> -// 				linkGeometry->normal.Normalize();
> -// 				return true;
> -// 			}
> -// 			else
> -// 				return false; // SpringGeometry !!!???????
> -// 		}
> -	// END
> -	}
> -	else
> -		scm = shared_ptr<SpheresContactGeometry>(new SpheresContactGeometry());
> -		
> -	
> +	if (penetrationDepth>0 || c->isReal){
> +		shared_ptr<SpheresContactGeometry> scm;
> +		if (c->interactionGeometry){
> +			// WARNING! 
> +			// FIXME - this must be dynamic cast until the contaners are rewritten to support multiple interactions types
> +			//         the problem is that scm can be either SDECLinkGeometry or SpheresContactGeometry and the only way CURRENTLY
> +			//         to check this is by dynamic cast. This has to be fixed.
> +			scm = YADE_PTR_CAST<SpheresContactGeometry>(c->interactionGeometry);
> +			#if 0
> +				// BEGIN .......  FIXME FIXME	- wrong hack, to make cohesion work.
> +					if(! scm) // this is not SpheresContactGeometry, so it is SDECLinkGeometry, dispatcher should do this job.
> +					{
> +						shared_ptr<SDECLinkGeometry> linkGeometry = dynamic_pointer_cast<SDECLinkGeometry>(c->interactionGeometry);
> +							cerr << "it is SpringGeometry ???: " << c->interactionGeometry->getClassName() << endl;
> +							assert(linkGeometry);
> +						if(linkGeometry)
> +						{
> +							linkGeometry->normal 			= se32.position-se31.position;
> +							linkGeometry->normal.Normalize();
> +							return true;
> +						}
> +						else
> +							return false; // SpringGeometry !!!???????
> +					}
> +					// END
> +			#endif
> +		} else scm = shared_ptr<SpheresContactGeometry>(new SpheresContactGeometry());
>  		penetrationDepth = s1->radius+s2->radius-normal.Normalize();
>  		scm->contactPoint = se31.position+(s1->radius-0.5*penetrationDepth)*normal;//0.5*(pt1+pt2);
>  		scm->normal = normal;
>  		scm->penetrationDepth = penetrationDepth;
>  		scm->radius1 = s1->radius;
>  		scm->radius2 = s2->radius;
> -				
> -		if (!c->interactionGeometry)
> -			c->interactionGeometry = scm;
> -	
> +		if (!c->interactionGeometry) c->interactionGeometry = scm;
>  		return true;
> -	}
> -	else return false;
> +	} else return false;
>  }
>  
>  
>
> Modified: trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.hpp
> ===================================================================
> --- trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.hpp	2008-03-20 20:14:47 UTC (rev 1282)
> +++ trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.hpp	2008-03-22 08:40:15 UTC (rev 1283)
> @@ -14,21 +14,18 @@
>  class InteractingSphere2InteractingSphere4SpheresContactGeometry : public InteractionGeometryEngineUnit
>  {
>  	public :
> -		virtual bool go(	const shared_ptr<InteractingGeometry>& cm1,
> -					const shared_ptr<InteractingGeometry>& cm2,
> -					const Se3r& se31,
> -					const Se3r& se32,
> -					const shared_ptr<Interaction>& c);
> -		virtual bool goReverse(	const shared_ptr<InteractingGeometry>& cm1,
> -					const shared_ptr<InteractingGeometry>& cm2,
> -					const Se3r& se31,
> -					const Se3r& se32,
> -					const shared_ptr<Interaction>& c);
> +		virtual bool go(const shared_ptr<InteractingGeometry>& cm1, const shared_ptr<InteractingGeometry>& cm2, const Se3r& se31, const Se3r& se32, const shared_ptr<Interaction>& c);
> +		virtual bool goReverse(	const shared_ptr<InteractingGeometry>& cm1, const shared_ptr<InteractingGeometry>& cm2, const Se3r& se31, const Se3r& se32, const shared_ptr<Interaction>& c);
>  					
>  		InteractingSphere2InteractingSphere4SpheresContactGeometry();		
> -					
> -		double InteractionDetectionFactor;// InteractionGeometry will be computed when InteractionDetectionFactor*(rad1+rad2) > distance 		
> -	
> +		
> +		/*! enlarge both radii by this factor (if >1), to permit creation of distant interactions.
> +		 *
> +		 * InteractionGeometry will be computed when interactionDetectionFactor*(rad1+rad2) > distance.
> +		 *
> +		 * @note This parameter is functionally coupled with InteractinSphere2AABB::aabbEnlargeFactor,
> +		 * which will create larger bounding boxes and should be of the same value. */
> +		double interactionDetectionFactor;
>  
>  	REGISTER_CLASS_NAME(InteractingSphere2InteractingSphere4SpheresContactGeometry);
>  	REGISTER_BASE_CLASS_NAME(InteractionGeometryEngineUnit);
>
> Added: trunk/scripts/simple-scene.py
> ===================================================================
> --- trunk/scripts/simple-scene.py	2008-03-20 20:14:47 UTC (rev 1282)
> +++ trunk/scripts/simple-scene.py	2008-03-22 08:40:15 UTC (rev 1283)
> @@ -0,0 +1,58 @@
> +# -*- encoding=utf-8 -*-
> +o=Omega() # this creates default rootBody as well
> +
> +# is used in both initializers and engines, assign to a temporary
> +aabbDisp=MetaEngine('BoundingVolumeMetaEngine',[EngineUnit('InteractingSphere2AABB'),EngineUnit('InteractingBox2AABB'),EngineUnit('MetaInteractingGeometry2AABB')])
> +
> +o.initializers=[
> +	StandAloneEngine('PhysicalActionContainerInitializer',{'physicalActionNames':['Force','Momentum','GlobalStiffness']}),
> +	aabbDisp]
> +
> +o.engines=[
> +	StandAloneEngine('PhysicalActionContainerReseter'),
> +	aabbDisp,
> +	StandAloneEngine('PersistentSAPCollider'),
> +	MetaEngine('InteractionGeometryMetaEngine',[
> +		EngineUnit('InteractingSphere2InteractingSphere4SpheresContactGeometry'),
> +		EngineUnit('InteractingBox2InteractingSphere4SpheresContactGeometry')
> +	]),
> +	MetaEngine('InteractionPhysicsMetaEngine',[EngineUnit('SimpleElasticRelationships')]),
> +	StandAloneEngine('ElasticContactLaw'),
> +	StandAloneEngine('GlobalStiffnessCounter',{'interval':50}),
> +	StandAloneEngine('GlobalStiffnessTimeStepper',{'defaultDt':1e-4,'active':True,'timeStepUpdateInterval':50}),
> +	DeusExMachina('GravityEngine',{'gravity':[0,0,-9.81]}),
> +	MetaEngine('PhysicalActionDamper',[
> +		EngineUnit('CundallNonViscousForceDamping',{'damping':0.2}),
> +		EngineUnit('CundallNonViscousMomentumDamping',{'damping':0.2})
> +	]),
> +	MetaEngine('PhysicalActionApplier',[
> +		EngineUnit('NewtonsForceLaw'),
> +		EngineUnit('NewtonsMomentumLaw'),
> +	]),
> +	MetaEngine('PhysicalParametersMetaEngine',[EngineUnit('LeapFrogPositionIntegrator')]),
> +	MetaEngine('PhysicalParametersMetaEngine',[EngineUnit('LeapFrogOrientationIntegrator')]),
> +]
> +
> +s=Body()
> +s.shape=GeometricalModel('Sphere',{'radius':1,'diffuseColor':[0,1,0]})
> +s.mold=InteractingGeometry('InteractingSphere',{'radius':1,'diffuseColor':[1,0,0]})
> +s.phys=PhysicalParameters('BodyMacroParameters',{'se3':[0,0,2,1,0,0,0],'mass':1000,'inertia':[7e4,7e4,7e4],'young':3e9,'poisson':0.3})
> +s.bound=BoundingVolume('AABB',{'diffuseColor':[0,0,1]})
> +s['isDynamic']=True
> +
> +b=Body()
> +b.shape=GeometricalModel('Box',{'extents':[.5,.5,.5],'diffuseColor':[1,0,0]})
> +b.mold=InteractingGeometry('InteractingBox',{'extents':[.5,.5,.5],'diffuseColor':[0,1,0]})
> +b.phys=PhysicalParameters('BodyMacroParameters',{'se3':[0,0,0,1,0,0,0],'mass':2000,'inertia':[1e5,1e5,1e5],'young':3e9,'poisson':0.3})
> +b.bound=BoundingVolume('AABB',{'diffuseColor':[0,0,1]})
> +b['isDynamic']=False
> +
> +o.bodies.append(b)
> +o.bodies.append(s)
> +
> +o.save('/tmp/a.xml')
> +
> +# load that with the QtGUI
> +import os
> +os.system(yadeExecutable+' -N QtGUI -S /tmp/a.xml')
> +
>
> _______________________________________________
> Yade-commits mailing list
> Yade-commits at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-commits
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Sat Mar 29 09:32:30 2008
From: eudoxos at arcig.cz (=?UTF-8?B?VsOhY2xhdiDFoG1pbGF1ZXI=?=)
Date: Sat, 29 Mar 2008 09:32:30 +0100
Subject: [yade-dev] [Yade-commits] r1283 - in trunk: . core extra
 extra/clump gui gui/cmd lib/serialization
 pkg/common/DataClass/PhysicalParameters	pkg/common/Engine/EngineUnit
 pkg/common/Engine/StandAloneEngine pkg/dem/Engine/EngineUnit scripts
In-Reply-To: <47ED3E62.1040906@hmg.inpg.fr>
References: <200803220840.m2M8eHqQ028074@sheep.berlios.de>
	<47ED3E62.1040906@hmg.inpg.fr>
Message-ID: <47EDFE9E.1040902@arcig.cz>

You can safely copy foreach.hpp from gutsy (boost 1.34) package. It is
only one header, no library. I tried that on amd64 feisty and it worked.
Sorry for inconvenience. Vaclav


From janek_listy at wp.pl  Sat Mar 29 17:28:59 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Sat, 29 Mar 2008 17:28:59 +0100
Subject: [yade-dev] [Yade-commits] r1283 - in trunk: . core extra
 extra/clump gui gui/cmd lib/serialization
 pkg/common/DataClass/PhysicalParameters	pkg/common/Engine/EngineUnit
 pkg/common/Engine/StandAloneEngine pkg/dem/Engine/EngineUnit scripts
In-Reply-To: <47EDFE9E.1040902@arcig.cz>
References: <200803220840.m2M8eHqQ028074@sheep.berlios.de>
	<47ED3E62.1040906@hmg.inpg.fr> <47EDFE9E.1040902@arcig.cz>
Message-ID: <20080329172859.33c06584@absurd>

in the attachment.

-- 
Janek Kozicki                                                         |
-------------- next part --------------
A non-text attachment was scrubbed...
Name: foreach.hpp
Type: text/x-c++hdr
Size: 31098 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080329/5d13debf/attachment.hpp>

From bruno.chareyre at hmg.inpg.fr  Sun Mar 30 22:44:09 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Sun, 30 Mar 2008 22:44:09 +0200
Subject: [yade-dev] [Yade-commits] r1290 - in trunk: core extra
 extra/usct gui/cmd gui/qt3
 pkg/common/Engine/EngineUnit	pkg/common/Engine/MetaEngine
 pkg/dem/Engine/DeusExMachina pkg/dem/Engine/EngineUnit
 pkg/dem/Engine/StandAloneEngine
In-Reply-To: <200803302022.m2UKMMSH008905@sheep.berlios.de>
References: <200803302022.m2UKMMSH008905@sheep.berlios.de>
Message-ID: <47EFFB99.6050008@hmg.inpg.fr>

Hello

I would revert this :

 GlobalStiffnessCounter::GlobalStiffnessCounter() : InteractionSolver() , actionForce(new Force) , actionMomentum(new Momentum), actionStiffness(new GlobalStiffness)
 {
-	interval=1;//FIXME very high frequency - not required 
+	interval=100;


Actually, 1 is just the default value. It is currently modified via a 
registered attribute in TriaxialTest (line 614 : 
globalStiffnessCounter->interval = timeStepUpdateInterval;).
The reason to revert is that one day, someone could use this to compute 
timestep, or just stiffness, and nothing would be computed, most of the 
time, for "unknown" reasons...

Bruno


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Mon Mar 31 07:18:11 2008
From: eudoxos at arcig.cz (=?UTF-8?B?VsOhY2xhdiDFoG1pbGF1ZXI=?=)
Date: Mon, 31 Mar 2008 07:18:11 +0200
Subject: [yade-dev] [Yade-commits] r1290 - in trunk: core extra
 extra/usct gui/cmd gui/qt3
 pkg/common/Engine/EngineUnit	pkg/common/Engine/MetaEngine
 pkg/dem/Engine/DeusExMachina pkg/dem/Engine/EngineUnit
 pkg/dem/Engine/StandAloneEngine
In-Reply-To: <47EFFB99.6050008@hmg.inpg.fr>
References: <200803302022.m2UKMMSH008905@sheep.berlios.de>
	<47EFFB99.6050008@hmg.inpg.fr>
Message-ID: <47F07413.2030905@arcig.cz>


> I would revert this :
>
>  GlobalStiffnessCounter::GlobalStiffnessCounter() : InteractionSolver() , actionForce(new Force) , actionMomentum(new Momentum), actionStiffness(new GlobalStiffness)
>  {
> -	interval=1;//FIXME very high frequency - not required 
> +	interval=100;
>   
Hi, I know it is just the default, but I thought engines should behave
reasonably (question of definition, right) with default attributes. It
was the FIXME that made me think someone actually wants that to be
changed (and wondering why he/she preferred to put FIXME instead of
changing that number, which just about as easy). Let me know if you want
me to revert it and commit next time, otherwise I suppose it will appear
reverted in your next commit.

Regards, Vaclav


From bruno.chareyre at hmg.inpg.fr  Wed Apr  2 18:15:17 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Wed, 02 Apr 2008 18:15:17 +0200
Subject: [yade-dev] QGL cutting plane
Message-ID: <47F3B115.1090200@hmg.inpg.fr>

Hello

I found a fast, dirty, and lazy way of implementing a cutting plane in 
the QGL view.

Line 215 of camera.cpp :

 const float cuttingDistance = 0.5;// 0 = see the full view, 1=see 
nothing, 0.5=cut half of the volume
  float z = distanceToSceneCenter() - 
zClippingCoefficient()*sceneRadius()*(1.f-2*cuttingDistance);

Now, as I would need days to create new widgets alone, could somebody 
link this "cuttingDistance" float to a nice button in the QtGUI?

Perhaps a setCuttingDistance function could be created and Python-binded 
too?

Bruno


 


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Wed Apr  2 19:22:58 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 02 Apr 2008 19:22:58 +0200
Subject: [yade-dev] QGL cutting plane
In-Reply-To: <47F3B115.1090200@hmg.inpg.fr>
References: <47F3B115.1090200@hmg.inpg.fr>
Message-ID: <47F3C0F2.5000505@arcig.cz>


> Hello
>
> I found a fast, dirty, and lazy way of implementing a cutting plane in 
> the QGL view.
>
> Line 215 of camera.cpp :
>
>  const float cuttingDistance = 0.5;// 0 = see the full view, 1=see 
> nothing, 0.5=cut half of the volume
>   float z = distanceToSceneCenter() - 
> zClippingCoefficient()*sceneRadius()*(1.f-2*cuttingDistance);
>
> Now, as I would need days to create new widgets alone, could somebody 
> link this "cuttingDistance" float to a nice button in the QtGUI?
>   
If would be far easier to bind a hotkey in the view itself to that, just
like 'a' toggles axes and 'g' toggles grid. Like 'c' to toggle on/off
and +- or something like that to cut further or closer.

A more proper solution would be to render only bodies of which
se3.position is on a given side of the cutting plane (easy (?), modify
the GL dispatcher) and not render those that are not. That would have
the benefit of not seeing interior of spheres that are cut by the plane.

Vaclav


From janek_listy at wp.pl  Wed Apr  2 20:20:46 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Wed, 2 Apr 2008 20:20:46 +0200
Subject: [yade-dev] QGL cutting plane
In-Reply-To: <47F3C0F2.5000505@arcig.cz>
References: <47F3B115.1090200@hmg.inpg.fr>
	<47F3C0F2.5000505@arcig.cz>
Message-ID: <20080402202046.00af9bbf@szpak>

V?clav S(milauer said:     (by the date of Wed, 02 Apr 2008 19:22:58 +0200)

> If would be far easier to bind a hotkey in the view itself to that, just
> like 'a' toggles axes and 'g' toggles grid. Like 'c' to toggle on/off
> and +- or something like that to cut further or closer.

yes, that could be easy to implement. BTW current list of bindings is here:

http://yade.wikia.com/wiki/Usage_details#QGLViewer_window


> A more proper solution would be to render only bodies of which
> se3.position is on a given side of the cutting plane (easy (?), modify
> the GL dispatcher) and not render those that are not. That would have
> the benefit of not seeing interior of spheres that are cut by the plane.

not exactly. We would need to not draw spheres that have
se3.position+radius*plane.normal before the cutting plane :)

A bit more difficult, and a bit better.

-- 
Janek Kozicki                                                         |


From bruno.chareyre at hmg.inpg.fr  Thu Apr  3 14:02:24 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Thu, 03 Apr 2008 14:02:24 +0200
Subject: [yade-dev] scons
Message-ID: <47F4C750.1020306@hmg.inpg.fr>

Quick question for Va?lav :

Could you send me an exemple (syntax) of how you specify a new include 
path and new libpath for compiling a library in sconscript files.
Currently, I'm copy-pasting or symlinking *.hpp and lib*.a from my CGAL 
project to Yade/lib and Yade/include. It works, but it could be better...

Thank you.

Bruno

-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Thu Apr  3 15:28:30 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Thu, 03 Apr 2008 15:28:30 +0200
Subject: [yade-dev] scons
In-Reply-To: <47F4C750.1020306@hmg.inpg.fr>
References: <47F4C750.1020306@hmg.inpg.fr>
Message-ID: <47F4DB7E.5090304@arcig.cz>

SharedLibrary('libabcd.so',['source1.cc','source2.cc'],LIBPATH=env['LIBPATH']+['/your/new/path1','/your/new/path2'],CPPPATH=env['CPPPATH']+['/your/new/include/path1'])

Untested. man scons for details. V.
> Could you send me an exemple (syntax) of how you specify a new include 
> path and new libpath for compiling a library in sconscript files.
> Currently, I'm copy-pasting or symlinking *.hpp and lib*.a from my CGAL 
> project to Yade/lib and Yade/include. It works, but it could be better...
>
> Thank you.
>
> Bruno
>
>   



From janek_listy at wp.pl  Thu Apr  3 16:46:02 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Thu, 3 Apr 2008 16:46:02 +0200
Subject: [yade-dev] scons, CGAL
In-Reply-To: <47F4DB7E.5090304@arcig.cz>
References: <47F4C750.1020306@hmg.inpg.fr>
	<47F4DB7E.5090304@arcig.cz>
Message-ID: <20080403164602.1b20c493@szpak>

Bruno did not explain precisely, what he really wants.

He has successfully written an engine in yade that uses CGAL library
for triangulation. It compiles and works great. It can be used for
many things - volumetric collision or even for faster collision detection.


What he really wants to do with scons is following:

- detect if CGAL package is installed (just like scons is detecting python)

- if it is installed then during compilation compile that engine, 
  if it's not - don't compile it.

This is where we need your help.
-- 
Janek Kozicki                                                         |


From bruno.chareyre at hmg.inpg.fr  Thu Apr  3 19:39:13 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Thu, 03 Apr 2008 19:39:13 +0200
Subject: [yade-dev] scons, CGAL
In-Reply-To: <20080403164602.1b20c493@szpak>
References: <47F4C750.1020306@hmg.inpg.fr>	<47F4DB7E.5090304@arcig.cz>
	<20080403164602.1b20c493@szpak>
Message-ID: <47F51641.7050100@hmg.inpg.fr>




> Bruno did not explain precisely, what he really wants.
>
>   
Hehe. Let's say I started with simple questions and that Va?lav's answer 
is enough for now (thanks). ;-)

But yes, perhaps later we can think about commiting stuff : add to trunk 
my own code and some classes using it. And compile it only if CGAL is 
installed (otherwise compilation would be broken due to linker not 
finding some libraries).

Bye.

Bruno

> He has successfully written an engine in yade that uses CGAL library
> for triangulation. It compiles and works great. It can be used for
> many things - volumetric collision or even for faster collision detection.
>
>
> What he really wants to do with scons is following:
>
> - detect if CGAL package is installed (just like scons is detecting python)
>
> - if it is installed then during compilation compile that engine, 
>   if it's not - don't compile it.
>
> This is where we need your help.
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From janek_listy at wp.pl  Thu Apr  3 21:12:55 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Thu, 3 Apr 2008 21:12:55 +0200
Subject: [yade-dev] QGL cutting plane
In-Reply-To: <20080402202046.00af9bbf@szpak>
References: <47F3B115.1090200@hmg.inpg.fr> <47F3C0F2.5000505@arcig.cz>
	<20080402202046.00af9bbf@szpak>
Message-ID: <20080403211255.35b02838@szpak>

I did it in 1293 commit.

-- 
Janek Kozicki                                                         |


From eudoxos at arcig.cz  Thu Apr  3 23:23:51 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Thu, 03 Apr 2008 23:23:51 +0200
Subject: [yade-dev] QGL cutting plane
In-Reply-To: <20080403211255.35b02838@szpak>
References: <47F3B115.1090200@hmg.inpg.fr>
	<47F3C0F2.5000505@arcig.cz>	<20080402202046.00af9bbf@szpak>
	<20080403211255.35b02838@szpak>
Message-ID: <47F54AE7.6010002@arcig.cz>

>
> I did it in 1293 commit.
> 3. it's possible that GLViewer4 will have to be modified - to use YadeCamera to
>    have this new feature - front cutting plane. I didn't touch it.
Cool. Don't worry about GLViewer4, it is dead code now.

Guys, I will be on Moucherotte tuesday (weather permitting) with a group
of highschool students. Unfortunately we come from the other direction
(from Hauterives, Drome (Palais ideal)) so I can't go down to Grenoble.
I will pass you all my hellos from the top... :-)

Vaclav



From bruno.chareyre at hmg.inpg.fr  Fri Apr  4 10:17:14 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Fri, 04 Apr 2008 10:17:14 +0200
Subject: [yade-dev] QGL cutting plane
In-Reply-To: <47F54AE7.6010002@arcig.cz>
References: <47F3B115.1090200@hmg.inpg.fr>	<47F3C0F2.5000505@arcig.cz>	<20080402202046.00af9bbf@szpak>	<20080403211255.35b02838@szpak>
	<47F54AE7.6010002@arcig.cz>
Message-ID: <47F5E40A.2000503@hmg.inpg.fr>

Nice! You have my hello from the ground. :)

Enjoy.

Bruno


V?clav S a ?crit :
>> I did it in 1293 commit.
>> 3. it's possible that GLViewer4 will have to be modified - to use YadeCamera to
>>    have this new feature - front cutting plane. I didn't touch it.
>>     
> Cool. Don't worry about GLViewer4, it is dead code now.
>
> Guys, I will be on Moucherotte tuesday (weather permitting) with a group
> of highschool students. Unfortunately we come from the other direction
> (from Hauterives, Drome (Palais ideal)) so I can't go down to Grenoble.
> I will pass you all my hellos from the top... :-)
>
> Vaclav
>
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From duriez at geo.hmg.inpg.fr  Fri Apr  4 18:49:25 2008
From: duriez at geo.hmg.inpg.fr (Jerome Duriez)
Date: Fri, 04 Apr 2008 18:49:25 +0200
Subject: [yade-dev] [Fwd: r1294 - in trunk/pkg: common
 common/Engine/DeusExMachina dem dem/Engine/StandAloneEngine
 dem/PreProcessor]
Message-ID: <47F65C15.1020304@geo.hmg.inpg.fr>


-------------- next part --------------
An embedded message was scrubbed...
From: jduriez at BerliOS <jduriez at mail.berlios.de>
Subject: r1294 - in trunk/pkg: common common/Engine/DeusExMachina dem dem/Engine/StandAloneEngine dem/PreProcessor
Date: Fri, 4 Apr 2008 18:47:01 +0200
Size: 51096
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080404/aed0b9fa/attachment.eml>

From cosurgi at gmail.com  Tue Apr 15 17:12:50 2008
From: cosurgi at gmail.com (Janek Kozicki)
Date: Tue, 15 Apr 2008 17:12:50 +0200
Subject: [yade-dev] yade compilation problem
In-Reply-To: <4804B877.2090607@hmg.inpg.fr>
References: <4804B877.2090607@hmg.inpg.fr>
Message-ID: <20080415171250.26edd24b@szpak>

R?mi Cailletaud said:     (by the date of Tue, 15 Apr 2008 16:15:19 +0200)

> hi janek,
> I try to compile yade on a server, and get this error :
> AttributeError: 'NoneType' object has no attribute 'group':
> did you have any idea about this problem ? it seems to be a python one, 
> may be with rigths ??
> all needed libraries are installed on the server...
> ++
> rem

Hi Remi, you forgot to tell which version of yade you want to
compile.

Without this information I can suggest only to try option:  features='none'


-- 
# Janek Kozicki


From eudoxos at arcig.cz  Tue Apr 15 21:51:58 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Tue, 15 Apr 2008 21:51:58 +0200
Subject: [yade-dev] yade compilation problem
In-Reply-To: <20080415171250.26edd24b@szpak>
References: <4804B877.2090607@hmg.inpg.fr> <20080415171250.26edd24b@szpak>
Message-ID: <4805075E.50305@arcig.cz>


>> hi janek,
>> I try to compile yade on a server, and get this error :
>> AttributeError: 'NoneType' object has no attribute 'group':
>> did you have any idea about this problem ? it seems to be a python one, 
>> may be with rigths ??
>>     
If it is around line 423 in SConstruct, then it is fixed in 1320 (give
warning but continue; issue known for a long time).

V.


From eudoxos at arcig.cz  Fri Apr 18 15:25:56 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Fri, 18 Apr 2008 15:25:56 +0200
Subject: [yade-dev] extra/triangulation/etat{1,2}
Message-ID: <4808A164.5040101@arcig.cz>

Hi there,

is there a good reason why putting extra/triangulation/etat{1,2} into
svn, as they have 6MB each? If yes, they should be at least bzip2ed.

Best, Vaclav


From bruno.chareyre at hmg.inpg.fr  Fri Apr 18 16:13:56 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Fri, 18 Apr 2008 16:13:56 +0200
Subject: [yade-dev] extra/triangulation/etat{1,2}
In-Reply-To: <4808A164.5040101@arcig.cz>
References: <4808A164.5040101@arcig.cz>
Message-ID: <4808ACA4.3040307@hmg.inpg.fr>

They are used for testing. This commit is just to help developing the 
triangulation classes in a collaborative way with Jean-Francois, we need 
example files to test the code, and we need big samples (16k particles 
in each file) to test also speed.
But well... we won't modify those files, so I can as well remove them 
from svn, Jean-Francois already has them. It just means some executable 
can be compiled but can't be executed by anybody else as they will miss 
those files.

Bruno


V?clav ?milauer a ?crit :
> Hi there,
>
> is there a good reason why putting extra/triangulation/etat{1,2} into
> svn, as they have 6MB each? If yes, they should be at least bzip2ed.
>
> Best, Vaclav
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From nicessgg at gmail.com  Sat Apr 19 04:35:25 2008
From: nicessgg at gmail.com (kan)
Date: Fri, 18 Apr 2008 21:35:25 -0500
Subject: [yade-dev] what is a reasonable dt?
Message-ID: <45213f870804181935l6b49a3das386e865923891458@mail.gmail.com>

Hi,dear all,

 I am sorry for sending this kind of question again, but I really have
problem , for my program, the calculated dt is at the lever of 10^(-8), it
is too small, what is a reasonable dt for practical computation.
my parameters are:
density of particle: 2600 kg/m^3
radius of particle : 0.001 m
kn=120 Gpa
kn/ks=2.5
the bond :
kn_bond=120 GPa,
kn/ks_bond =1;

is the 10^-8 reasonable?
how chould I increase the dt?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080418/6c12e310/attachment.html>

From eudoxos at arcig.cz  Sat Apr 19 08:46:07 2008
From: eudoxos at arcig.cz (=?windows-1252?Q?V=E1clav_=8Amilauer?=)
Date: Sat, 19 Apr 2008 08:46:07 +0200
Subject: [yade-dev] extra/triangulation/etat{1,2}
In-Reply-To: <4808ACA4.3040307@hmg.inpg.fr>
References: <4808A164.5040101@arcig.cz> <4808ACA4.3040307@hmg.inpg.fr>
Message-ID: <4809952F.4040404@arcig.cz>

I suggest bzipping those files and you can use libboost::iostreams to
read it directly from the compressed form. They compress to about .3 of
the original size.

Regards, Vaclav
> They are used for testing. This commit is just to help developing the 
> triangulation classes in a collaborative way with Jean-Francois, we need 
> example files to test the code, and we need big samples (16k particles 
> in each file) to test also speed.
> But well... we won't modify those files, so I can as well remove them 
> from svn, Jean-Francois already has them. It just means some executable 
> can be compiled but can't be executed by anybody else as they will miss 
> those files.
>
> Bruno
>   
>
>   



From eudoxos at arcig.cz  Tue Apr 29 14:49:00 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Tue, 29 Apr 2008 14:49:00 +0200
Subject: [yade-dev] python: unable to reproduce serializer problem on ia32
Message-ID: <4817193C.3010806@arcig.cz>

Hello,

I finally tested python wrapper on a 32bit system (debian) and it works.
Sega had problems that one tag was serialized in binary instead of text,
for reasons that were not discovered (discussed on yade-dev about 2
months ago). Can yet someone else reproduce that? You can run something like

    yade-trunk -N cmdGui -- -s trunk/scripts/simple-scene.py

I would like to fix that since I do all preprocessing in python now,
which is quite convenient.

On the other hand, I have segfaults from log4cxx on ia32 on yade
shutdown (debian lenny). Does someone else experience that as well?

Regards, Vaclav


From eudoxos at arcig.cz  Tue Apr 29 20:42:05 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 29 Apr 2008 20:42:05 +0200
Subject: [yade-dev] python: unable to reproduce serializer problem on
 ia32
In-Reply-To: <4817193C.3010806@arcig.cz>
References: <4817193C.3010806@arcig.cz>
Message-ID: <48176BFD.3060002@arcig.cz>


> I finally tested python wrapper on a 32bit system (debian) and it works.
> Sega had problems that one tag was serialized in binary instead of text,
> for reasons that were not discovered (discussed on yade-dev about 2
> months ago). Can yet someone else reproduce that? You can run something like
>
>     yade-trunk -N cmdGui -- -s trunk/scripts/simple-scene.py
>
> I would like to fix that since I do all preprocessing in python now,
> which is quite convenient.
>   
Janek, I just experienced similar problem in the inverse way: when
saving to binary, I get garbage file where binary and XML things are
quite randomly interspersed. Janek, can the problem be that archives are
created separately when constructing scene in python? I thought archive
could be serialized either way. Can you have a look at that again,
please? I know we will switch to boost::serialization, but that doesn't
seem to happen in the timeframe of a few weeks, (which is what I need).

Regards, Vaclav


From eudoxos at arcig.cz  Wed Apr 30 14:12:53 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Wed, 30 Apr 2008 14:12:53 +0200
Subject: [yade-dev] distabling BINFormatManager
Message-ID: <48186245.9060106@arcig.cz>

Hello,

I am planning to disable BINFormatManager (.yade files) in svn because
it has some nasty interactions with python - neither me nor Janek were
able to find solution for that. I will add gzipped xml output (.xml.gz)
to XMLFormatManager, for those where file size is a concern.

It should be only temporary (a few months), since we will move to
boost::serialization later and the problem will (hopefully) go away.

Any objections?

Best regards, Vaclav


From janek_listy at wp.pl  Wed Apr 30 19:44:07 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Wed, 30 Apr 2008 19:44:07 +0200
Subject: [yade-dev] distabling BINFormatManager
In-Reply-To: <48186245.9060106@arcig.cz>
References: <48186245.9060106@arcig.cz>
Message-ID: <20080430194407.269bfb95@szpak>

V?clav ?milauer said:     (by the date of Wed, 30 Apr 2008 14:12:53 +0200)

> Hello,
> 
> I am planning to disable BINFormatManager (.yade files) in svn because
> it has some nasty interactions with python - neither me nor Janek were
> able to find solution for that. I will add gzipped xml output (.xml.gz)
> to XMLFormatManager, for those where file size is a concern.
> 
> It should be only temporary (a few months), since we will move to
> boost::serialization later and the problem will (hopefully) go away.


This sounds good, please go ahead.

-- 
Janek Kozicki                                                         |


From janek_listy at wp.pl  Wed Apr 30 19:58:58 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Wed, 30 Apr 2008 19:58:58 +0200
Subject: [yade-dev] [Yade-commits] r1330 - in trunk: . core gui gui/cmd
 gui/qt3 lib lib/factory lib/serialization lib/serialization-bin
 lib/serialization-xml scripts
In-Reply-To: <200804301415.m3UEFGbx002251@sheep.berlios.de>
References: <200804301415.m3UEFGbx002251@sheep.berlios.de>
Message-ID: <20080430195858.45601840@szpak>

eudoxos at BerliOS said:     (by the date of Wed, 30 Apr 2008 16:15:16 +0200)

> 2. reorganization of cmdGui (will be renamed - perhaps - to pyUi or similar)

if you are going to rename it, please use a full name "python" in it,
instead of "py". We have now (mind the capitalization):

QtGUI
cmdGui
NullGUI

So how about "PythonUI" ? You know, it's "U"ser "I"nterface.

BTW: I fervently hate CamelCase and prefer under_scores. 
But oh, well... I never can have everything.

-- 
Janek Kozicki                                                         |


From eudoxos at arcig.cz  Wed Apr 30 21:43:58 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 30 Apr 2008 21:43:58 +0200
Subject: [yade-dev] [Yade-commits] PythonUI
In-Reply-To: <20080430195858.45601840@szpak>
References: <200804301415.m3UEFGbx002251@sheep.berlios.de>
	<20080430195858.45601840@szpak>
Message-ID: <4818CBFE.6030601@arcig.cz>


> if you are going to rename it, please use a full name "python" in it,
> instead of "py". We have now (mind the capitalization):
>
> So how about "PythonUI" ? You know, it's "U"ser "I"nterface.
>   
I know; I would prefer something shorter (pyUI; py is very common and
everybody knows it stands for python), but it is more or less OK.

BTW if things go the right way, perhaps the next qt/gtk/whatever gui
could be written in python itself. I even had the idea of doing
serialization/deserialization, plugin management and so on in python.
But it is not feasible now - attribute access is "quite slow", since it
relies on text serialization: so every number that is assigned is
converted to string and back, which is obviously not very efficient. But
for typical usage it is OK.

Regards, Vaclav.


From janek_listy at wp.pl  Thu May  1 00:28:58 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Thu, 1 May 2008 00:28:58 +0200
Subject: [yade-dev] [Yade-commits] PythonUI
In-Reply-To: <4818CBFE.6030601@arcig.cz>
References: <200804301415.m3UEFGbx002251@sheep.berlios.de>
	<20080430195858.45601840@szpak> <4818CBFE.6030601@arcig.cz>
Message-ID: <20080501002858.5f7a0c9c@szpak>

V?clav S(milauer said:     (by the date of Wed, 30 Apr 2008 21:43:58 +0200)

> 
> > if you are going to rename it, please use a full name "python" in it,
> > instead of "py". We have now (mind the capitalization):
> >
> > So how about "PythonUI" ? You know, it's "U"ser "I"nterface.
> >   
> I know; I would prefer something shorter (pyUI; py is very common and
> everybody knows it stands for python), but it is more or less OK.

Ok, so how about going the other way round and skip the "UI"?
(right for the next release):

QtGUI   - qt3
cmdGui  - py
NullGUI - cmd

For backward compatibility the yade.cpp would test and recognize
the old names.

-- 
Janek Kozicki                                                         |


From eudoxos at arcig.cz  Thu May  1 16:48:56 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Thu, 01 May 2008 16:48:56 +0200
Subject: [yade-dev] [Yade-commits] PythonUI
In-Reply-To: <20080501002858.5f7a0c9c@szpak>
References: <200804301415.m3UEFGbx002251@sheep.berlios.de>	<20080430195858.45601840@szpak>
	<4818CBFE.6030601@arcig.cz> <20080501002858.5f7a0c9c@szpak>
Message-ID: <4819D858.50809@arcig.cz>


> Ok, so how about going the other way round and skip the "UI"?
> (right for the next release):
>
> QtGUI   - qt3
> cmdGui  - py
> NullGUI - cmd
>   
Too late :-| We already have PythonUI in svn :-)



From eudoxos at arcig.cz  Fri May  2 17:33:41 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Fri, 02 May 2008 17:33:41 +0200
Subject: [yade-dev] [solved?] python: unable to reproduce serializer problem
	on ia32
In-Reply-To: <4817193C.3010806@arcig.cz>
References: <4817193C.3010806@arcig.cz>
Message-ID: <481B3455.9090504@arcig.cz>

Since we have BINFormatManager disabled by default in SVN now, can
someone test (again) the scripts/simple-scene.py file and try loading
the saved simulation from /tmp/a.xml.bz2 ? I modified main() so that you
can pass file as first argument to yade:

 yade-version scripts/simple-scene.py # will run with PythonUI
 yade-version scene.xml # will run with the default UI

For me, it works on ia32 as well as amd64.

BTW for those who don't read commit messages, .xml.gz and .xml.bz2 are
now supported by yade transparently.

Regards,

V?clav



From janek_listy at wp.pl  Thu May  8 10:26:44 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Thu, 8 May 2008 10:26:44 +0200
Subject: [yade-dev] [Yade-commits] r1346 - in trunk: core extra
 extra/tetra extra/usct
In-Reply-To: <200805072148.m47LmxQt026422@sheep.berlios.de>
References: <200805072148.m47LmxQt026422@sheep.berlios.de>
Message-ID: <20080508102644.68d66e56@absurd>

eudoxos at BerliOS said:     (by the date of Wed, 7 May 2008 23:48:59 +0200)

> 1. BOOST_FOREACH now works with InteractionContainer and BodyContainer and is #defined as foreach.
> 
> example:
> 
> 	foreach(shared_ptr<Body> b, *rootBody->bodies) cerr<<"Body id: "<<b->getId()<<endl;


Please don't do this, and revert this quickly. Nobody knows what
foreach() is, because it is not present in boost documentation.

Two names for one thing simplifies nothing and is only confusing.

-- 
Janek Kozicki                                                         |


From eudoxos at arcig.cz  Thu May  8 11:40:24 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Thu, 08 May 2008 11:40:24 +0200
Subject: [yade-dev] [Yade-commits] r1346 - in trunk: core extra
 extra/tetra extra/usct
In-Reply-To: <20080508102644.68d66e56@absurd>
References: <200805072148.m47LmxQt026422@sheep.berlios.de>
	<20080508102644.68d66e56@absurd>
Message-ID: <4822CA88.5030507@arcig.cz>

Sorry, don't understand that such small thing makes you jump; can you
elaborate? The re#definition is suggested in the official
documentation: 
http://www.boost.org/doc/libs/1_35_0/doc/html/foreach.html#foreach.introduction.making__literal_boost_foreach__literal__prettier

If this macro is documented in Yade sources, I don't see a problem with
that. We have bunch of other yade-specific macros.


From eudoxos at arcig.cz  Fri May  9 09:23:38 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Fri, 09 May 2008 09:23:38 +0200
Subject: [yade-dev] the cost of Singleton::instance()
Message-ID: <4823FBFA.2060902@arcig.cz>

Hello (Janek primarily),

can you estimate the cost of calling Omega::instance()? I see it creates
a mutex, but I don't know how much that costs. I have another option of
passing optional MetaBody* mb and then

 (mb?mb:Omega::instance().getRootBody().get())->physicalActions->/*...*/

Is it worth the pain or do I always use Omega::instance() without penalty?

Regards, V.


From eudoxos at arcig.cz  Sat May 10 16:40:09 2008
From: eudoxos at arcig.cz (=?UTF-8?B?VsOhY2xhdiDFoG1pbGF1ZXI=?=)
Date: Sat, 10 May 2008 16:40:09 +0200
Subject: [yade-dev] [Yade-commits] STLImporter
In-Reply-To: <200805101315.m4ADFf5r021034@sheep.berlios.de>
References: <200805101315.m4ADFf5r021034@sheep.berlios.de>
Message-ID: <4825B3C9.5090507@arcig.cz>

Sega, really nice work!

I would ask you to add some documentation to the sources, though.
Generally, we would like to have all classes some documentation, even if
only few lines. The commit message could be a good documentation for
STLImporter. At some place, the "big picture" of why classes like
Interacting{Facet,Edge,Vetex} exist could be given - the wiki, or
perhaps in a sample FileGenerator..

For the collider, you should at least reference the algorithm that is
used (I know what quicksort is, but in what way it is used on bodies
here and so on). Do you plan to adapt the collider to distant
interactions as well? It means just not deleting the interaction and not
setting isReal to false, if the interaction already has already been
real in previous iteration.

If you put FIXME to your code, what follows should be in english. If
something goes wrong during execution, I may look at the code and will
just see FIXME without knowing what it says.

In python scripts (Sconscript), please use tabs consistently, since
mixing spaces with tabs will do havoc for us - I have tabsize of 3
spaces, so your 4 spaces will be after my tab but before your tab etc. I
can fix that in the next commit, no problem.

You may prefer related classes to be put into single source file (using
YADE_PLUGIN("InteractingFacet","InteractngEdge","InteractingVertex"),
for example), but that is matter of tase; for me, sources are more
navigable that way.

Thanks for your contribution.

Vaclav



From dorofeenko at icp.ac.ru  Tue May 13 10:31:48 2008
From: dorofeenko at icp.ac.ru (dorofeenko at icp.ac.ru)
Date: Tue, 13 May 2008 12:31:48 +0400
Subject: [yade-dev] [Yade-commits] STLImporter
In-Reply-To: <4825B3C9.5090507@arcig.cz>
References: <200805101315.m4ADFf5r021034@sheep.berlios.de>
	<4825B3C9.5090507@arcig.cz>
Message-ID: <200805131231.48899.dorofeenko@icp.ac.ru>

> Sega, really nice work!
Thanks!

> For the collider, you should at least reference the algorithm that is
> used (I know what quicksort is, but in what way it is used on bodies
> here and so on). Do you plan to adapt the collider to distant
> interactions as well? It means just not deleting the interaction and not
> setting isReal to false, if the interaction already has already been
> real in previous iteration.

Oh... Perhaps, but not in the near future... 
My immediate plans is modification STLImporter in a manner that edges and 
facets related to the vertices through pointers. This is necessary in order 
to delete extra steps kinematic (because it is now necessary to move / rotate 
all the elements). Then, the creation of python wrapper for the importer. 
Next, a model for my own research (until I study the dynamics of dry bulk 
media), its profiling and optimization (I need 10k, a better 100k particles). 
Also plan to export results in any format (silo, vtk, hdf5?) for the 
postprocessing (paraview, visit?)... will be grateful for assistance in 
selecting... I am inclined now to vtk and paraview. And plan to add simple 
elastoplastic contact model.

Sergei D.







From dorofeenko at icp.ac.ru  Tue May 13 20:06:38 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Tue, 13 May 2008 22:06:38 +0400
Subject: [yade-dev] [Yade-commits] STLImporter
In-Reply-To: <200805131231.48899.dorofeenko@icp.ac.ru>
References: <200805101315.m4ADFf5r021034@sheep.berlios.de>
	<4825B3C9.5090507@arcig.cz>
	<200805131231.48899.dorofeenko@icp.ac.ru>
Message-ID: <200805132206.39055.dorofeenko@icp.ac.ru>

> My immediate plans is modification STLImporter in a manner that edges and 
> facets related to the vertices through pointers. This is necessary in order 
> to delete extra steps kinematic (because it is now necessary to move / rotate 
> all the elements). 

This overrides. Vertices, edges, facets remain independent since it seems that winnings would be negligible.


From eudoxos at arcig.cz  Tue May 13 22:16:15 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 13 May 2008 22:16:15 +0200
Subject: [yade-dev] [Yade-commits] STLImporter
In-Reply-To: <200805131231.48899.dorofeenko@icp.ac.ru>
References: <200805101315.m4ADFf5r021034@sheep.berlios.de>	<4825B3C9.5090507@arcig.cz>
	<200805131231.48899.dorofeenko@icp.ac.ru>
Message-ID: <4829F70F.3080708@arcig.cz>


> Then, the creation of python wrapper for the importer. 
>   
Good to know there are at least 2 python fans amongst yade folks :-)
<secret> I had even such plans that all non-computational stuff (what
doesn't repeat during iterations) would be recoded in python, including
main, plugin manager, gui, serializer/deserializer. But I got blocked on
qglviewer now, which I need to run with qt4 (custom event loop, qt3
doesn't know that) and have no experience with such thing. </secret>
> Next, a model for my own research (until I study the dynamics of dry bulk 
> media), its profiling and optimization (I need 10k, a better 100k particles). 
> Also plan to export results in any format (silo, vtk, hdf5?) for the 
> postprocessing (paraview, visit?)... will be grateful for assistance in 
> selecting... I am inclined now to vtk and paraview.
Can't help you here, but I would be grateful to hear your experience on
that. What kind of postprocessing do you need? Fields plots, contours
and the like?

I am experimenting with matplotlib integration now, for advanced
plotting in yade, but that quite a different thing...
> And plan to add simple 
> elastoplastic contact model.
>   
If you have your constitutive law formulated in terms of strain-stress
rather than displacements and so on, you could base that on BrefcomLaw.
I wanted to rename it to StrainStressLaw and use it as a base class for
almost arbitrary strain-stress models: just plug in some equations and
it's done. Didn't have time for that, though. And it is not (yet?) as
fast as I want it to be.

Regards, Vaclav


From sj2001 at yandex.ru  Thu May 15 19:56:09 2008
From: sj2001 at yandex.ru (sega)
Date: Thu, 15 May 2008 21:56:09 +0400
Subject: [yade-dev] [Yade-commits] STLImporter
In-Reply-To: <4829F70F.3080708@arcig.cz>
References: <200805101315.m4ADFf5r021034@sheep.berlios.de>
	<200805131231.48899.dorofeenko@icp.ac.ru>
	<4829F70F.3080708@arcig.cz>
Message-ID: <200805152156.11343.sj2001@yandex.ru>


> Good to know there are at least 2 python fans amongst yade folks :-)

Python is convenient for preprocessoring at least. :)

>> What kind of postprocessing do you need? Fields plots, contours
> and the like?

Yes. Because I'm going to simulate the larger systems, the simulation will 
take much time. Re-modeling difficult. It is therefore necessary to export 
modelling results in a form suitable for long-term storage and varied 
postprocessing (flow visualization, particle-tracking, current lines, vector 
fields, the calculation of various characteristics, such as contact numbers, 
the coefficient of packaging, etc.). I think that for this purpose a better 
use of existing data formats, because in that case there is an opportunity to 
analyse the data using various third party programs. External postprocessor 
seems preferable to me because of the advanced visualization capabilities. 
Although Yade has a module visualization and must be promoted.

Best regards, Sergei D.



From janek_listy at wp.pl  Thu May 15 20:46:50 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Thu, 15 May 2008 20:46:50 +0200
Subject: [yade-dev] [Yade-commits] r1346 - in trunk: core extra
 extra/tetra extra/usct
In-Reply-To: <4822CA88.5030507@arcig.cz>
References: <200805072148.m47LmxQt026422@sheep.berlios.de>
	<20080508102644.68d66e56@absurd> <4822CA88.5030507@arcig.cz>
Message-ID: <20080515204650.283a67bf@absurd>

V?clav S(milauer said:     (by the date of Thu, 08 May 2008 11:40:24 +0200)

> Sorry, don't understand that such small thing makes you jump; can you
> elaborate? The re#definition is suggested in the official
> documentation: 
> http://www.boost.org/doc/libs/1_35_0/doc/html/foreach.html#foreach.introduction.making__literal_boost_foreach__literal__prettier

OK, after some online chat we decided to use FOREACH, since macros
should be uppercase, and it would not repeat the "#define slots"
problem we had with qt3

-- 
Janek Kozicki                                                         |


From dorofeenko at icp.ac.ru  Sun May 18 13:05:17 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Sun, 18 May 2008 15:05:17 +0400
Subject: [yade-dev] error compiling with log4cxx
In-Reply-To: <482F444B.4030907@arcig.cz>
References: <BAY128-W15A28787786070D519B36EB1CF0@phx.gbl>
	<07200ABDA779AA41BD5747E1FE9E0A0918512B@kstud7.utk.tennessee.edu>
	<482F444B.4030907@arcig.cz>
Message-ID: <200805181505.18267.dorofeenko@icp.ac.ru>

Hello!
I got the following errors when compiling with log4cxx:

Checking for log4cxx::Logger::getLogger("") in C++ library log4cxx... yes
...
core/yade.cpp: In function 'int main(int, char**)':
core/yade.cpp:153: error: 'WARN' is not a member of 'log4cxx::Level'
core/yade.cpp:199: error: 'INFO' is not a member of 'log4cxx::Level'
core/yade.cpp:200: error: 'DEBUG' is not a member of 'log4cxx::Level'

I use apache-log4cxx 0.10.0.



From eudoxos at arcig.cz  Sun May 18 17:32:28 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Sun, 18 May 2008 17:32:28 +0200
Subject: [yade-dev] error compiling with log4cxx
In-Reply-To: <200805181505.18267.dorofeenko@icp.ac.ru>
References: <BAY128-W15A28787786070D519B36EB1CF0@phx.gbl>	<07200ABDA779AA41BD5747E1FE9E0A0918512B@kstud7.utk.tennessee.edu>	<482F444B.4030907@arcig.cz>
	<200805181505.18267.dorofeenko@icp.ac.ru>
Message-ID: <48304C0C.2050008@arcig.cz>

I normally use liblog4cxx9c2a 0.9.7-6ubuntu1, the code probably will
have to adapted; sorry for now. V.
> Hello!
> I got the following errors when compiling with log4cxx:
>   



From dorofeenko at icp.ac.ru  Mon May 19 12:23:49 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Mon, 19 May 2008 14:23:49 +0400
Subject: [yade-dev] new PhysicalAction
Message-ID: <200805191423.50096.dorofeenko@icp.ac.ru>

Hello!
I have created a new PhysicalAction <- Teleportation (and the engines) in order to feed back particles left the simulation space.
However, runtime error arose:

...
DEBUG yade.PhysicalActionContainerInitializer pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.cpp:48 action: allNames after sort and unique:
DEBUG yade.PhysicalActionContainerInitializer pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.cpp:48 action: Force
DEBUG yade.PhysicalActionContainerInitializer pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.cpp:48 action: Momentum
DEBUG yade.PhysicalActionContainerInitializer pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.cpp:48 action: Teleportation
DEBUG yade.Omega core/Omega.cpp:342 loadSimulation: Simulation loaded
yade: /usr/local/include/boost/shared_ptr.hpp:315: T* boost::shared_ptr<T>::operator->() const [with T = PhysicalAction]: Adoption verification `px != 0' failed.
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/sega/.yade-trunk/gdb_crash_batch-pid27822'
GNU gdb 6.5
...

I spent some research and discovered that class Force have ClassIndex 0, class Momentum have ClassIndex 1 but class Teleportation have ClassIndex 3 (need 2???).
Because of this, there are problems in the class PhysicalActionVectorVector:

function PhysicalActionVectorVector::find(...):

93	for( unsigned int j = 0 ; j < actionTypesSize ; ++j )
94		physicalActions[i][j] = actionTypesResetted[j]->clone();

since

actionTypesResetted[0] is Force
actionTypesResetted[1] is Momentum
actionTypesResetted[2] is NULL
actionTypesResetted[3] is Teleportation

I tried to fix it:

93	for( unsigned int j = 0 ; j < actionTypesSize ; ++j )
94		if (actionTypesResetted[j]) physicalActions[i][j] = actionTypesResetted[j]->clone();

and uncomment line 48:

48	if(*vi) // FIXME ?? do not check - all fields are NOT empty.
49			(*vi)->reset();

But the problem persists elsewhere, as the error is not lost...

Best regards, Sergei D.




From eudoxos at arcig.cz  Mon May 19 20:19:50 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Mon, 19 May 2008 20:19:50 +0200
Subject: [yade-dev] new PhysicalAction
In-Reply-To: <200805191423.50096.dorofeenko@icp.ac.ru>
References: <200805191423.50096.dorofeenko@icp.ac.ru>
Message-ID: <4831C4C6.5070406@arcig.cz>


> However, runtime error arose:
>
> ...
> DEBUG yade.PhysicalActionContainerInitializer pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.cpp:48 action: allNames after sort and unique:
> DEBUG yade.PhysicalActionContainerInitializer pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.cpp:48 action: Force
> DEBUG yade.PhysicalActionContainerInitializer pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.cpp:48 action: Momentum
> DEBUG yade.PhysicalActionContainerInitializer pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.cpp:48 action: Teleportation
> DEBUG yade.Omega core/Omega.cpp:342 loadSimulation: Simulation loaded
>   
This is OK, Teleportation will be initialized in the container. So far
good. (You can use NEEDS_BEX("Teleportation") macro with your teleport
engine to register the class to be initialized with the initializer
automagically).
> yade: /usr/local/include/boost/shared_ptr.hpp:315: T* boost::shared_ptr<T>::operator->() const [with T = PhysicalAction]: Adoption verification `px != 0' failed.
> SIGSEGV/SIGABRT handler called; gdb batch file is `/home/sega/.yade-trunk/gdb_crash_batch-pid27822'
> GNU gdb 6.5
> ...
>   
Please provide the backtrace, that is _the_ most valuable information
about such thing.
> I spent some research and discovered that class Force have ClassIndex 0, class Momentum have ClassIndex 1 but class Teleportation have ClassIndex 3 (need 2???).
>   
I think this is OK. Class index is integer that is incremented for every
new class (not instance) factored in the class factory. It can,
therefore, be different from one run to another. Class indices that are
not registered with PhysicalActionContainerInitializer will not be
initialized,  but that is harmless (or should be).

Wouldn't it be easier to have a DeusExMachina teleport all bodies that
are too far away back where they should be? This way you have 1 extra
loop: in one, you detect the body ewnt nuts and create the Teleportation
action, in another loop, this action is performed and the body is
teleported.

Regards, Vaclav


From eudoxos at arcig.cz  Mon May 19 21:02:40 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Mon, 19 May 2008 21:02:40 +0200
Subject: [yade-dev] error compiling with log4cxx
In-Reply-To: <200805181505.18267.dorofeenko@icp.ac.ru>
References: <BAY128-W15A28787786070D519B36EB1CF0@phx.gbl>	<07200ABDA779AA41BD5747E1FE9E0A0918512B@kstud7.utk.tennessee.edu>	<482F444B.4030907@arcig.cz>
	<200805181505.18267.dorofeenko@icp.ac.ru>
Message-ID: <4831CED0.20802@arcig.cz>


> Checking for log4cxx::Logger::getLogger("") in C++ library log4cxx... yes
> ...
> core/yade.cpp: In function 'int main(int, char**)':
> core/yade.cpp:153: error: 'WARN' is not a member of 'log4cxx::Level'
> core/yade.cpp:199: error: 'INFO' is not a member of 'log4cxx::Level'
> core/yade.cpp:200: error: 'DEBUG' is not a member of 'log4cxx::Level'
>   
I looked at the log4cxx website and the documentation (except the
doxygen generated docs) is not updated to 0.10.0 yet, which was released
in March 2008. If you figure out how to make yade work with 0.10, please
let me know (I don't need it now, but it will be needed very likely at
some point); you should just have to redefine macros in
lib/base/Logging.hpp.

Vaclav


From dorofeenko at icp.ac.ru  Tue May 20 10:21:10 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Tue, 20 May 2008 12:21:10 +0400
Subject: [yade-dev] crash svn-1357
Message-ID: <200805201221.11348.dorofeenko@icp.ac.ru>

Hello!

1. After generation scene from action->File Generator menu I get crash yade-svn1357:

==> BEGIN ===
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/sega/.yade-trunk/gdb_crash_batch-pid13959'
GNU gdb 6.5
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "x86_64-suse-linux".
Using host libthread_db library "/lib64/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread 47433347492912 (LWP 13959)]
[New Thread 1090541888 (LWP 13978)]
[New Thread 1082149184 (LWP 13960)]
0x00002b23eb863e1f in waitpid () from /lib64/libc.so.6
No symbol "info" in current context.

Thread 3 (Thread 1082149184 (LWP 13960)):
#0  0x00002b23eb8644f1 in __nanosleep_nocancel () from /lib64/libc.so.6
#1  0x00002b23eb88cab4 in usleep () from /lib64/libc.so.6
#2  0x00002b23e9a52dc9 in log4cxx::helpers::FileWatchdog::run (this=0x7dcf00) at filewatchdog.cpp:70
#3  0x00002b23e9a964fa in threadProc (arg=0x408040a0) at thread.cpp:38
#4  0x00002b23e82e609e in start_thread () from /lib64/libpthread.so.0
#5  0x00002b23eb8924cd in clone () from /lib64/libc.so.6
#6  0x0000000000000000 in ?? ()

Thread 2 (Thread 1090541888 (LWP 13978)):
#0  0x00002b23eb88c302 in __select_nocancel () from /lib64/libc.so.6
#1  0x00002aaad1f2a4c5 in initreadline () from /usr/lib64/python2.5/lib-dynload/readline.so
#2  0x00002b23e7fc2b4f in PyOS_Readline () from /usr/lib64/libpython2.5.so.1.0
#3  0x00002b23e802ec74 in _PyBuiltin_Init () from /usr/lib64/libpython2.5.so.1.0
#4  0x00002b23e803856a in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
#5  0x00002b23e80395ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
#6  0x00002b23e8037cd4 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
#7  0x00002b23e80395ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
#8  0x00002b23e8037cd4 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
#9  0x00002b23e80395ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
#10 0x00002b23e8037cd4 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
#11 0x00002b23e80395ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
#12 0x00002b23e7fe1c48 in PyClassMethod_New () from /usr/lib64/libpython2.5.so.1.0
#13 0x00002b23e7fc4e13 in PyObject_Call () from /usr/lib64/libpython2.5.so.1.0
#14 0x00002b23e7fcbecd in PyClass_IsSubclass () from /usr/lib64/libpython2.5.so.1.0
#15 0x00002b23e7fc4e13 in PyObject_Call () from /usr/lib64/libpython2.5.so.1.0
#16 0x00002b23e7fcc93b in _PyInstance_Lookup () from /usr/lib64/libpython2.5.so.1.0
#17 0x00002b23e7fc4e13 in PyObject_Call () from /usr/lib64/libpython2.5.so.1.0
#18 0x00002b23e8035463 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
#19 0x00002b23e80395ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
#20 0x00002b23e80395f2 in PyEval_EvalCode () from /usr/lib64/libpython2.5.so.1.0
#21 0x00002b23e8052022 in Py_CompileString () from /usr/lib64/libpython2.5.so.1.0
#22 0x00002b23e80520f6 in PyRun_FileExFlags () from /usr/lib64/libpython2.5.so.1.0
#23 0x00002b23e80535b8 in PyRun_SimpleFileExFlags () from /usr/lib64/libpython2.5.so.1.0
#24 0x00002aaab5113773 in PythonUI::execScript (script=@0x41004ff0) at gui/py/PythonUI.cpp:40
#25 0x00002aaab51144c4 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:84
#26 0x00002aaab49efe1b in boost::detail::function::void_function_invoker0<void (*)(), void>::invoke (function_ptr=@0x410050a8) at /usr/local/include/boost/function/function_template.hpp:114
#27 0x00002b23e896154e in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/local/lib64/libboost_thread-gcc41-mt-1_34_1.so.1.34.1
#28 0x00002b23e8961202 in boost::thread_group::add_thread () from /usr/local/lib64/libboost_thread-gcc41-mt-1_34_1.so.1.34.1
#29 0x00002b23e82e609e in start_thread () from /lib64/libpthread.so.0
#30 0x00002b23eb8924cd in clone () from /lib64/libc.so.6
#31 0x0000000000000000 in ?? ()

Thread 1 (Thread 47433347492912 (LWP 13959)):
#0  0x00002b23eb863e1f in waitpid () from /lib64/libc.so.6
#1  0x00002b23eb80c491 in do_system () from /lib64/libc.so.6
#2  0x00002b23eb80c817 in system () from /lib64/libc.so.6
#3  0x000000000055c97d in sigHandler (sig=11) at core/yade.cpp:58
#4  <signal handler called>
#5  0x00002aaab49ab92f in QRect::size (this=0x8c) at /usr/lib/qt3/include/qrect.h:254
#6  0x00002aaab49ab990 in QWidget::size (this=0x0) at /usr/lib/qt3/include/qwidget.h:765
#7  0x00002aaab49bd00d in MessageDialog (this=0x2aaad8000ff0, message=@0x7fffc2d3aa60, parent=0x0, name=0x0, modal=false, fl=0) at gui/qt3/MessageDialog.cpp:34
#8  0x00002aaab49c0067 in QtFileGenerator::timerEvent (this=0x117a570) at gui/qt3/QtFileGenerator.cpp:222
#9  0x00002b23e92c7576 in QObject::event () from /usr/lib64/libqt-mt.so.3
#10 0x00002b23e92fa418 in QWidget::event () from /usr/lib64/libqt-mt.so.3
#11 0x00002b23e9270eb5 in QApplication::internalNotify () from /usr/lib64/libqt-mt.so.3
#12 0x00002b23e9271c40 in QApplication::notify () from /usr/lib64/libqt-mt.so.3
#13 0x00002b23e926750f in QEventLoop::activateTimers () from /usr/lib64/libqt-mt.so.3
#14 0x00002b23e922769d in QEventLoop::processEvents () from /usr/lib64/libqt-mt.so.3
#15 0x00002b23e9285963 in QEventLoop::enterLoop () from /usr/lib64/libqt-mt.so.3
#16 0x00002b23e9285812 in QEventLoop::exec () from /usr/lib64/libqt-mt.so.3
#17 0x00002aaab49ef24c in QtGUI::run (this=0x8b05d0, argc=1, argv=0x7fffc2d3b9a8) at gui/qt3/QtGUI.cpp:65
#18 0x000000000055c441 in main (argc=1, argv=0x7fffc2d3b9a8) at core/yade.cpp:254
#0  0x00002b23eb863e1f in waitpid () from /lib64/libc.so.6
In [1]: Segmentation fault
<===END===

2. New Simulation Controller  allows select fixed time step and time stepper at the same time. 

3. How can I run *.py preprocessor from python console? Seems "yade simple-scene.py" don't work now. 
And from python console "import simple-scene.py" also don't work.

Best regards, Sergei D.



From eudoxos at arcig.cz  Tue May 20 21:09:58 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 20 May 2008 21:09:58 +0200
Subject: [yade-dev] crash svn-1357
In-Reply-To: <200805201221.11348.dorofeenko@icp.ac.ru>
References: <200805201221.11348.dorofeenko@icp.ac.ru>
Message-ID: <48332206.1090102@arcig.cz>


>
> 1. After generation scene from action->File Generator menu I get crash yade-svn1357:
>   
Worked for me, but there is obviously problem with passing NULL as
dialog parent widget. Will try to fix that. Now ti crashes even here, good.
> 2. New Simulation Controller  allows select fixed time step and time stepper at the same time. 
>   
Will have a look.
> 3. How can I run *.py preprocessor from python console? Seems "yade simple-scene.py" don't work now. 
> And from python console "import simple-scene.py" also don't work.
>   
As workaround, you can do execfile('simple-scene.py'). Execfile is a
python builtin. But passing .py as script to be run will be supported. Soon.

Thanks for feedback.


From eudoxos at arcig.cz  Tue May 20 22:05:57 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 20 May 2008 22:05:57 +0200
Subject: [yade-dev] crash svn-1357
In-Reply-To: <200805201221.11348.dorofeenko@icp.ac.ru>
References: <200805201221.11348.dorofeenko@icp.ac.ru>
Message-ID: <48332F25.8050804@arcig.cz>

Some news about this in the last commit; 1. fixed, 2. partially fixed,
3. not yet fixed. V.
> Hello!
>
> 1. After generation scene from action->File Generator menu I get crash yade-svn1357:
>
> 2. New Simulation Controller  allows select fixed time step and time stepper at the same time. 
>
> 3. How can I run *.py preprocessor from python console? Seems "yade simple-scene.py" don't work now. 
> And from python console "import simple-scene.py" also don't work.
>   



From dorofeenko at icp.ac.ru  Wed May 21 08:24:50 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Wed, 21 May 2008 10:24:50 +0400
Subject: [yade-dev] Omega.realtime
In-Reply-To: <48332F25.8050804@arcig.cz>
References: <200805201221.11348.dorofeenko@icp.ac.ru>
	<48332F25.8050804@arcig.cz>
Message-ID: <200805211024.50552.dorofeenko@icp.ac.ru>


Omega.realtime is wrong. I have negative realtime:

In [30]: o.load('/tmp/a.xml')
INFO  core/Omega.cpp:324 loadSimulation: Loading file /tmp/a.xml

In [31]: o.realtime
Out[31]: 7.0750000000000002

In [32]: o.run(10000)

In [33]: o.realtime
Out[33]: 3.5630000000000002

In [34]: o.run(10000)

In [35]: o.realtime
Out[35]: -12.673999999999999

Sergei D.


From eudoxos at arcig.cz  Wed May 21 09:29:32 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 21 May 2008 09:29:32 +0200
Subject: [yade-dev] Omega.realtime
In-Reply-To: <200805211024.50552.dorofeenko@icp.ac.ru>
References: <200805201221.11348.dorofeenko@icp.ac.ru>	<48332F25.8050804@arcig.cz>
	<200805211024.50552.dorofeenko@icp.ac.ru>
Message-ID: <4833CF5C.9080208@arcig.cz>


> Omega.realtime is wrong. I have negative realtime:
>   
I know, that is because I changed SimulationController; it is wrong in
the GUI panel as well. It means just time of calculation. The time in
the virtual world is in Omega().time. I keep that in mind, though.

BTW could we use https://bugs.launchpad.net/yade/ for such things (or
perhaps only bigger issues) so that they are easier to be tracked?

Vaclav.



From eudoxos at arcig.cz  Wed May 21 22:43:52 2008
From: eudoxos at arcig.cz (=?UTF-8?B?VsOhY2xhdiDFoG1pbGF1ZXI=?=)
Date: Wed, 21 May 2008 22:43:52 +0200
Subject: [yade-dev] [Yade-commits] r1359 - in trunk
In-Reply-To: <200805211856.m4LIulMp019593@sheep.berlios.de>
References: <200805211856.m4LIulMp019593@sheep.berlios.de>
Message-ID: <48348988.9070803@arcig.cz>


> 3. Added phase flag "cycle" to Interaction. SpatialQuickSortCollider is modified so interaction's cycle flag is used to mark stale contacts instead isReal flag.
>   
I wanted to address this some time ago. I think though that we could
have a meaningful set of booleans (like isOverlapping, isNew, is*) that
would cover all we need for collisions; otherwise every collider will
have different set of phases of interaction and constitutive laws that
rely on those information will be collider-specific.

I would be also glad if you could document it somehow, since
PersistentSAPCollider would be modified as well, perhaps.

BTW, do you have benchmarks comparing PErsistentSAP and SpationQuickSort?
> 4. Small changed InteractingSphere2InteractingSphere4SpheresContactGeometry and GLDrawElasticContactInteraction. I think, towards an improvement. If there are objections, changes must be reverted.
>   
In GLDrawElasticInteraction, you could use static serializable flags to
control rendering of things (and you would have to make
GLDrawElasticInteraction serializable). Have a look at
GLDrawBrefcomContact, the I use MetaBody::miscParams (which doesn't
serve anything else)

 o.miscParams=[Generic("GLDrawBrefcomContact",{'dmgLabel':False,'epsT':True,'epsTAxes':True,'normal':True})]

to control GL rendering. If you keep the old behavior as default, there
can be no objections ;-)

> 5. pyOmega.save allows recovery 
>   
Good. Although what I want to do is to move virtual time and iteration #
into MetaBody, then there will be no difference of recovery/nonrecovery
save.

BTW this recovery thing is (should be) triggered if you send HUP to yade
- it was meant as a way to save very long simulation when UPS signals
power loss and the system shuts down, so that all what has been
calculated is not lost. Yade should open recovery files automatically at
startup, but this has not been very much tested and probably never used
in real.

Vaclav


From bruno.chareyre at hmg.inpg.fr  Thu May 22 17:08:08 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Thu, 22 May 2008 17:08:08 +0200
Subject: [yade-dev] [Yade-commits] r1359 - in trunk: core gui/py
 lib/import	pkg/common/DataClass/PhysicalParameters
 pkg/common/Engine/DeusExMachina	pkg/common/Engine/StandAloneEngine
 pkg/dem/Engine/EngineUnit
 pkg/dem/Engine/StandAloneEngine	pkg/dem/RenderingEngine/GLDrawElasticContactInteraction
In-Reply-To: <200805211856.m4LIulMp019593@sheep.berlios.de>
References: <200805211856.m4LIulMp019593@sheep.berlios.de>
Message-ID: <48358C58.10705@hmg.inpg.fr>

Hello Sega,

I am not sure I understand everything in this commit, and at least in 
one case i'm sure there is a problem (see first paragraph) :




> Modified: trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp
> ===================================================================
> --- trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp	2008-05-20 20:05:08 UTC (rev 1358)
> +++ trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp	2008-05-21 18:56:45 UTC (rev 1359)
> @@ -38,7 +38,7 @@
>  	Vector3r normal = se32.position-se31.position;
>  	Real penetrationDepth = pow(interactionDetectionFactor*(s1->radius+s2->radius), 2) - normal.SquaredLength();// Compute a wrong value just to check sign - faster than computing distances
>  	//Real penetrationDepth = s1->radius+s2->radius-normal.Normalize();
> -	if (penetrationDepth>0 || c->isReal){
> +	if (penetrationDepth>0 /*|| c->isReal*/){
>   

We need to compute the geometry when c->isReal because an interaction 
under tension, for instance, will not have penetrationDepth>0 but will 
still be a "real" interraction and needs geometrical data. I suspect 
this change actually brakes all cohesive and capillary laws in Yade.


>
> Modified: trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp
> ===================================================================
> --- trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp	2008-05-20 20:05:08 UTC (rev 1358)
> +++ trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp	2008-05-21 18:56:45 UTC (rev 1359)
> @@ -62,7 +62,10 @@
>  	
>
> -			angle = dt*0.5*currentContactGeometry->normal.Dot(de1->angularVelocity+de2->angularVelocity);
> +			//angle = dt*0.5*currentContactGeometry->normal.Dot(de1->angularVelocity+de2->angularVelocity);
> +				//FIXME: if one body is kinematic then assumed its rotation centre does not lies along the normal
> +				//(i.e. virtual sphere, which replaces this kinematic body on contact, does not rotate)
> +			Vector3r summaryAngularVelocity(0,0,0);
> +			if (isDynamic1) summaryAngularVelocity += de1->angularVelocity;
> +			if (isDynamic2) summaryAngularVelocity += de2->angularVelocity;
> +			angle = dt*0.5*currentContactGeometry->normal.Dot(summaryAngularVelocity);
>   
Why wouldn't we take the motion of not-dynamic bodies into account?
A typical situation where isDynamic==false is when bodies are used to 
define prescribed velocity at boundaries.
If you don't account for the kinematics of boundaries in the equation, 
computed rotation will be wrong I think.

>  		
>
> -            		Vector3r _c1x_	= currentContactGeometry->radius1*currentContactGeometry->normal;
> -            		Vector3r _c2x_	= -currentContactGeometry->radius2*currentContactGeometry->normal;
> +            		Vector3r _c1x_	= (isDynamic1) ? currentContactGeometry->radius1*currentContactGeometry->normal : x - de1->zeroPoint;
> +            		Vector3r _c2x_	= (isDynamic2) ? -currentContactGeometry->radius2*currentContactGeometry->normal : x - de2->zeroPoint;
>  			Vector3r relativeVelocity		= (de2->velocity+de2->angularVelocity.Cross(_c2x_)) - (de1->velocity+de1->angularVelocity.Cross(_c1x_));
>  			Vector3r shearVelocity			= relativeVelocity-currentContactGeometry->normal.Dot(relativeVelocity)*currentContactGeometry->normal;
>  			Vector3r shearDisplacement		= shearVelocity*dt;
>  
>   
I'm a bit lost. I agree that when the body is not a sphere, cx must be 
defined relative to the center of mass of the body (and not based on the 
radius of the virtual sphere as it was before). But then, why should it 
be the case only if !isDynamic?

Bruno


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From dorofeenko at icp.ac.ru  Fri May 23 07:59:02 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Fri, 23 May 2008 09:59:02 +0400
Subject: [yade-dev] [Yade-commits] r1359 - in trunk: core gui/py
	lib/import pkg/common/DataClass/PhysicalParameters
	pkg/common/Engine/DeusExMachina
	pkg/common/Engine/StandAloneEngine pkg/dem/Engine/EngineUnit
	pkg/dem/Engine/StandAloneEngine
	pkg/dem/RenderingEngine/GLDrawElasticContactInteraction
Message-ID: <200805230959.02683.dorofeenko@icp.ac.ru>

>We need to compute the geometry when c->isReal because an interaction under 
tension, for instance, will not have penetrationDepth>0 but will still be 
a "real" interraction and needs geometrical data. I suspect this change 
actually brakes all cohesive and capillary laws in Yade.

If it so this changes should be reverted... But that is 
interactionDetectionFactor then? I think it's better to use with cohesive 
interactions. And by default, allow only purely contact interactions... Such 
behaviour is more clear and saves computing resources in many cases.

Best regards, Sergei D.




From dorofeenko at icp.ac.ru  Fri May 23 10:00:57 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Fri, 23 May 2008 12:00:57 +0400
Subject: [yade-dev] [Yade-commits] r1359 - in trunk
In-Reply-To: <48348988.9070803@arcig.cz>
References: <200805211856.m4LIulMp019593@sheep.berlios.de>
	<48348988.9070803@arcig.cz>
Message-ID: <200805231200.57422.dorofeenko@icp.ac.ru>


> BTW, do you have benchmarks comparing PErsistentSAP and SpationQuickSort?

I run STLImporterTest.py with baraban.stl and 3150 spheres with both PersistentSAP and SpatialQuickSort 
I get 10-13 iter/sec for Persistent and 9-11 for Spatial after 3 virtual minutes (with scons pofile=opt). 
So, Persistent is slightly faster...

> In GLDrawElasticInteraction, you could use static serializable flags to
> control rendering of things (and you would have to make
> GLDrawElasticInteraction serializable). Have a look at
> GLDrawBrefcomContact, the I use MetaBody::miscParams (which doesn't
> serve anything else)
> 
>  o.miscParams=[Generic("GLDrawBrefcomContact",{'dmgLabel':False,'epsT':True,'epsTAxes':True,'normal':True})]

Very good. And I wonder what is miscParams?! :)

Best regards, Sergei D.






From eudoxos at arcig.cz  Fri May 23 10:36:32 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Fri, 23 May 2008 10:36:32 +0200
Subject: [yade-dev] [Yade-commits] r1359 - in trunk: core
 gui/py	lib/import
 pkg/common/DataClass/PhysicalParameters	pkg/common/Engine/DeusExMachina	pkg/common/Engine/StandAloneEngine
 pkg/dem/Engine/EngineUnit	pkg/dem/Engine/StandAloneEngine	pkg/dem/RenderingEngine/GLDrawElasticContactInteraction
In-Reply-To: <200805230959.02683.dorofeenko@icp.ac.ru>
References: <200805230959.02683.dorofeenko@icp.ac.ru>
Message-ID: <48368210.2020107@arcig.cz>


>  But that is 
> interactionDetectionFactor then? I think it's better to use with cohesive 
> interactions. And by default, allow only purely contact interactions... 
>   
No. interactionDetectionFactor is for (cohesive or non-cohesive)
contacts if that contact can be initiated over some predefined distance
bigger than the geometrical one.

On the other hand, cohesive contacts never break by virtue of distance
only. It is the constitutive law that takes care of that.
> Such 
> behaviour is more clear and saves computing resources in many cases.
Distant links have (I think) no computation penalty unless you enable
them: haveDistantTransient in PersistentSAPCollider (which only means it
will not delete distant contacs) and by using
InteractinSphere2*4DistantSpheresContactGeometry at the same time.

Good that there is discussion about that, it needs to be clarified.

I created page http://yade.wikia.com/wiki/Sanitizing_Contact_Logic,
please express your opinions there (everybody) and sign it with ~~~~
(will be replaced by username and date)

Regards, Vaclav


From eudoxos at arcig.cz  Fri May 23 10:38:38 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Fri, 23 May 2008 10:38:38 +0200
Subject: [yade-dev] [Yade-commits] r1359 - in trunk
In-Reply-To: <200805231200.57422.dorofeenko@icp.ac.ru>
References: <200805211856.m4LIulMp019593@sheep.berlios.de>	<48348988.9070803@arcig.cz>
	<200805231200.57422.dorofeenko@icp.ac.ru>
Message-ID: <4836828E.3040700@arcig.cz>


>> o.miscParams=[Generic("GLDrawBrefcomContact",{'dmgLabel':False,'epsT':True,'epsTAxes':True,'normal':True})]
>>     
>
> Very good. And I wonder what is miscParams?! :)
>   
Basically, the classes get only deserialized and are never used for
anything else. But if the attribute in question is static, it will be
globally modified at deserialization. There is no other way to
communicate with functors (especially GLDraw functors, since you never
instantiate them by hand - they use the RENDERS(...) magic).



From bruno.chareyre at hmg.inpg.fr  Fri May 23 13:43:53 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Fri, 23 May 2008 13:43:53 +0200
Subject: [yade-dev] [Yade-commits] r1359 - in trunk: core
 gui/py	lib/import
 pkg/common/DataClass/PhysicalParameters	pkg/common/Engine/DeusExMachina	pkg/common/Engine/StandAloneEngine
 pkg/dem/Engine/EngineUnit	pkg/dem/Engine/StandAloneEngine	pkg/dem/RenderingEngine/GLDrawElasticContactInteraction
In-Reply-To: <200805230959.02683.dorofeenko@icp.ac.ru>
References: <200805230959.02683.dorofeenko@icp.ac.ru>
Message-ID: <4836ADF9.40304@hmg.inpg.fr>

sega a ?crit :
>> We need to compute the geometry when c->isReal because an interaction under 
>>     
> tension, for instance, will not have penetrationDepth>0 but will still be 
> a "real" interraction and needs geometrical data. I suspect this change 
> actually brakes all cohesive and capillary laws in Yade.
>
> If it so this changes should be reverted... But that is 
> interactionDetectionFactor then? I think it's better to use with cohesive 
> interactions. And by default, allow only purely contact interactions... Such 
> behaviour is more clear and saves computing resources in many cases.
>
>   

interactionDetectionFactor is more aimed at CREATING distant 
interactions, not for deleting them. It is not supposed to be used for 
cohesive interactions (it's been introduced for capillary interactions).
Using interactionDetectionFactor>1 just to make cohesive contacts work 
in tension would be a waste of resources.
Using interactionDetectionFactor=1 and computing geometry for real 
interactions only is the way to compute only what is needed.


Bruno



-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From duriez at geo.hmg.inpg.fr  Fri May 23 15:24:41 2008
From: duriez at geo.hmg.inpg.fr (Jerome Duriez)
Date: Fri, 23 May 2008 15:24:41 +0200
Subject: [yade-dev] [Yade-commits] r1359 - in trunk: core
 gui/py	lib/import
 pkg/common/DataClass/PhysicalParameters	pkg/common/Engine/DeusExMachina	pkg/common/Engine/StandAloneEngine
 pkg/dem/Engine/EngineUnit	pkg/dem/Engine/StandAloneEngine	pkg/dem/RenderingEngine/GLDrawElasticContactInteraction
In-Reply-To: <48368210.2020107@arcig.cz>
References: <200805230959.02683.dorofeenko@icp.ac.ru>
	<48368210.2020107@arcig.cz>
Message-ID: <4836C599.3020506@geo.hmg.inpg.fr>


> I created page http://yade.wikia.com/wiki/Sanitizing_Contact_Logic,
>   

Very nice idea. I do not know if this was the exact purpose of this page 
but I afford me to add an "introduction" paragraph describing very 
roughly how the contact and contact forces are handled. If you think 
it's better to move this paragraph elsewhere, feel free.

Jerome


From dorofeenko at icp.ac.ru  Fri May 23 15:41:20 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Fri, 23 May 2008 17:41:20 +0400
Subject: [yade-dev]
 =?iso-8859-1?q?=5BYade-commits=5D_r1359_-_in_trunk=3A_?=
 =?iso-8859-1?q?core_gui/py=09lib/import_pkg/common/DataClass/PhysicalPara?=
 =?iso-8859-1?q?meters=09pkg/common/Engine/DeusExMachina=09pkg/common/Engi?=
 =?iso-8859-1?q?ne/StandAloneEngine_pkg/dem/Engine/EngineUnit=09pkg/dem/En?=
 =?iso-8859-1?q?gine/StandAloneEngine=09pkg/dem/RenderingEngine/GLDrawElas?=
 =?iso-8859-1?q?ticContactInteraction?=
In-Reply-To: <48368210.2020107@arcig.cz>
References: <200805230959.02683.dorofeenko@icp.ac.ru>
	<48368210.2020107@arcig.cz>
Message-ID: <200805231741.20667.dorofeenko@icp.ac.ru>

> Using interactionDetectionFactor=1 and computing geometry for real 
> interactions only is the way to compute only what is needed.
> Bruno.

> Distant links have (I think) no computation penalty unless you enable
> them: haveDistantTransient in PersistentSAPCollider (which only means it
> will not delete distant contacs) and by using
> InteractinSphere2*4DistantSpheresContactGeometry at the same time.
> Regards, Vaclav

So, 
1. There is SpheresContactGeometry. Is it supposed to be used _only for contact_ interactions?
2. There is DistantSpheresContactGeometry. Is it supposed to be used for _distant_ interactions?
3. InteractionDetectionFactor is supposed to be used only for _distant_ interactions. Is't it?

If it so, I think the condition for _SpheresContactGeometry_

>if (penetrationDepth>0 || c->isReal)

should be replaced by 

> if (penetrationDepth>0)

as I suggested. And more, InteractionDetectionFactor should be removed from SpheresContactGeometry.

About Interaction's flags: I think, isReal and isNew should be left unchanged, because their meaning is very clear.

I propose to add a flag "cycle" and anticipate its use as a _local_ variable in any Engine. I think such a flag would be useful in any case. Its value it not supposed to be transfer from one Engine to other or through iterations. I have used "cycle" instead of isReal for mark stale contacts, because isReal is also used in GLDrawInteraction * in another thread and when visualization obtained flashing.

Best regards, Sergei D.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080523/878de29c/attachment.html>

From dorofeenko at icp.ac.ru  Fri May 23 15:54:33 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Fri, 23 May 2008 17:54:33 +0400
Subject: [yade-dev]
 =?iso-8859-1?q?=5BYade-commits=5D_r1359_-_in_trunk=3A_?=
 =?iso-8859-1?q?core_gui/py=09lib/import_pkg/common/DataClass/PhysicalPara?=
 =?iso-8859-1?q?meters=09pkg/common/Engine/DeusExMachina=09pkg/common/Engi?=
 =?iso-8859-1?q?ne/StandAloneEngine_pkg/dem/Engine/EngineUnit=09pkg/dem/En?=
 =?iso-8859-1?q?gine/StandAloneEngine=09pkg/dem/RenderingEngine/GLDrawElas?=
 =?iso-8859-1?q?ticContactInteraction?=
In-Reply-To: <4836C599.3020506@geo.hmg.inpg.fr>
References: <200805230959.02683.dorofeenko@icp.ac.ru>
	<48368210.2020107@arcig.cz> <4836C599.3020506@geo.hmg.inpg.fr>
Message-ID: <200805231754.33691.dorofeenko@icp.ac.ru>

>Once the potential interactions are determined (so a lot of couple of bodies 
which will surely not interact are disregarded) it is investigated if the 
bodies are really in contact or not (see flag isReal later), thanks to 
InteractionGeometryMetaEngine.

>After that, the physical properties of the interactions, which will be used 
to compute contact forces (rigidities...) are set by 
InteractionPhysicsMetaEngine which uses classes containing the parameters of 
bodies and classes describing how to compute interactions properties from 
bodies properties (names finishing by ...RelationsShips). 

On the contrary. The first is InteractionPhysics (unique for each pair of 
bodies, calculated at detecting potential contact), then InteractionGeometry 
(calculated for the real contacts)...

Best regards, Sergei D.


From duriez at geo.hmg.inpg.fr  Fri May 23 15:55:15 2008
From: duriez at geo.hmg.inpg.fr (Jerome Duriez)
Date: Fri, 23 May 2008 15:55:15 +0200
Subject: [yade-dev] [Yade-commits] r1359 - in trunk: core gui/py
 lib/import pkg/common/DataClass/PhysicalParameters
 pkg/common/Engine/DeusExMachina pkg/common/Engine/StandAloneEngine
 pkg/dem/Engine/EngineUnit pkg/dem/Engine/StandAloneEngine
 pkg/dem/RenderingEngine/GLDrawElasticContactInteraction
In-Reply-To: <200805231754.33691.dorofeenko@icp.ac.ru>
References: <200805230959.02683.dorofeenko@icp.ac.ru>	<48368210.2020107@arcig.cz>
	<4836C599.3020506@geo.hmg.inpg.fr>
	<200805231754.33691.dorofeenko@icp.ac.ru>
Message-ID: <4836CCC3.5010505@geo.hmg.inpg.fr>



sega a ?crit :
>> Once the potential interactions are determined (so a lot of couple of bodies which will surely not interact are disregarded) it is investigated if the 
>> bodies are really in contact or not (see flag isReal later), thanks to 
>> InteractionGeometryMetaEngine.
>>
>>     
>> After that, the physical properties of the interactions, which will be used to compute contact forces (rigidities...) are set by 
>> InteractionPhysicsMetaEngine which uses classes containing the parameters of 
>> bodies and classes describing how to compute interactions properties from 
>> bodies properties (names finishing by ...RelationsShips). 
>>
>>     
> On the contrary. The first is InteractionPhysics (unique for each pair of 
> bodies, calculated at detecting potential contact), then InteractionGeometry 
> (calculated for the real contacts)...
>
>
>   
Thank your for your opinion. But in my simulations (and because they 
occur often to be false... I would add that it's also the case in the 
TriaxialTest), the first is InteractionGeometry and then 
Interactionphysics. Moreover it seems to me that 
InteractionGeometryMetaEngine doesn't care if interactions are real or 
not. On the contrary it chooses if it is the case or not :
l.46 InteractionGeometryMetaEngine.cpp :
interaction->isReal =
            b1->interactingGeometry && b2->interactingGeometry && // 
some bodies do not have interactingGeometry
            // FIXME put this inside VolatileInteractionCriterion dynlib
            ( 
persistentInteractions->find(interaction->getId1(),interaction->getId2()) 
== 0 )
             &&
            operator()( b1->interactingGeometry , 
b2->interactingGeometry , b1->physicalParameters->se3 , 
b2->physicalParameters->se3 , interaction );

So ???

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080523/719a3bc0/attachment.html>

From dorofeenko at icp.ac.ru  Fri May 23 16:51:11 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Fri, 23 May 2008 18:51:11 +0400
Subject: [yade-dev] [Yade-commits] r1359 - in trunk: core gui/py
	lib/import pkg/common/DataClass/PhysicalParameters
	pkg/common/Engine/DeusExMachina
	pkg/common/Engine/StandAloneEngine pkg/dem/Engine/EngineUnit
	pkg/dem/Engine/StandAloneEngine
	pkg/dem/RenderingEngine/GLDrawElasticContactInteraction
In-Reply-To: <4836CCC3.5010505@geo.hmg.inpg.fr>
References: <200805230959.02683.dorofeenko@icp.ac.ru>
	<200805231754.33691.dorofeenko@icp.ac.ru>
	<4836CCC3.5010505@geo.hmg.inpg.fr>
Message-ID: <200805231851.12263.dorofeenko@icp.ac.ru>

> Moreover it seems to me that  
> InteractionGeometryMetaEngine doesn't care if interactions are real or 
> not. On the contrary it chooses if it is the case or not :
> l.46 InteractionGeometryMetaEngine.cpp :
> interaction->isReal =
>             b1->interactingGeometry && b2->interactingGeometry && // 
> some bodies do not have interactingGeometry
>             // FIXME put this inside VolatileInteractionCriterion dynlib
>             ( 
> persistentInteractions->find(interaction->getId1(),interaction->getId2()) 
> == 0 )
>              &&
>             operator()( b1->interactingGeometry , 
> b2->interactingGeometry , b1->physicalParameters->se3 , 
> b2->physicalParameters->se3 , interaction );
> 
> So ???
> 
> 

Yes. But! Any body that can interact with something gets its 
InteractingGeometry with its creation.
E.q. if (body->interactingGeometry) then body_is_interactable else 
body_is_non_interactable
InteractionGeometryMetaEngine cares about creating the _InteractionGeometry_ 
from two InteractingGeometries.
E.q. the _InteractionGeometryMetaEngine_  determines whether interaction 
isReal or only potential.
Therefore, there is no controversy: 
1. A collider find the potential interaction (intersecting bounding volumes). 
The Interaction isNew=1, isReal=0.
2. InteractionPhysicsMetaEngine create InteractionPhysics for new interaction 
(once for all interaction time). The Interaction isNew=0, isReal=0.
3. InteractionGeometryMetaEngine create InteractingGeometry if the bodies are 
really in contact (on each time step). The Interaction isNew=0, isReal=1.
4. Calculating forces, ect...
5. The bodies separated. They surfaces not intersect, but AABBs intersect yet. 
Interaction potential again. Do not have to calculate physics. Do not have to 
calculate geometry. isNew=0, isReal=0.
6. They AABBs not intersect. The interaction is removed.

-- 
Best regards, Sergei D.


From eudoxos at arcig.cz  Fri May 23 17:58:04 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Fri, 23 May 2008 17:58:04 +0200
Subject: [yade-dev] [Yade-commits] r1359 - in trunk: core gui/py
 lib/import pkg/common/DataClass/PhysicalParameters
 pkg/common/Engine/DeusExMachina pkg/common/Engine/StandAloneEngine
 pkg/dem/Engine/EngineUnit pkg/dem/Engine/StandAloneEngine
 pkg/dem/RenderingEngine/GLDrawElasticContactInteraction
In-Reply-To: <200805231741.20667.dorofeenko@icp.ac.ru>
References: <200805230959.02683.dorofeenko@icp.ac.ru>	<48368210.2020107@arcig.cz>
	<200805231741.20667.dorofeenko@icp.ac.ru>
Message-ID: <4836E98C.8020301@arcig.cz>


> 1. There is SpheresContactGeometry. Is it supposed to be used _only
> for contact_ interactions?
>
> 2. There is DistantSpheresContactGeometry. Is it supposed to be used
> for _distant_ interactions?
>
No; the name is misleding;
InteractingSphere2InteractingSphere4DistantSpheresContactGeometry
creates SpheresContacatGeometry; contrary to IS2IS4SCG however, it will
create SpheresContactGeometry even if penetrationDepth<=0.

[ I eventually want to replace IS2IS4DSCG by IS2IS4SCG with some flag
that will permit distant interactions. There is no reason for such code
duplication ]
>
> >if (penetrationDepth>0 || c->isReal)
>
> should be replaced by
>
> > if (penetrationDepth>0)
>
> as I suggested. And more, InteractionDetectionFactor should be removed
> from SpheresContactGeometry.
>
Both conclusions are drawn from false premise, hence are not true.
>
> About Interaction's flags: I think, isReal and isNew should be left
> unchanged, because their meaning is very clear.
>
isReal is not clear at all and I had to read sources (at all the places
where it is used) to get to know what it means. isReal for distant
contact is false, but the contact is not "unreal" nonetheless. (yes,
isNew is OK)
>
> I propose to add a flag "cycle" and anticipate its use as a _local_
> variable in any Engine. I think such a flag would be useful in any
> case. Its value it not supposed to be transfer from one Engine to
> other or through iterations. I have used "cycle" instead of isReal for
> mark stale contacts
>
Why not call it isStale then or something similar?

Again, I suggest moving this discussion to the wiki page
http://yade.wikia.com/wiki/Sanitizing_Contact_Logic so that we have some
starting point and can decide what and how will change.

Regards, V.



From bruno.chareyre at hmg.inpg.fr  Fri May 23 18:43:22 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Fri, 23 May 2008 18:43:22 +0200
Subject: [yade-dev] [Yade-commits] r1359 - in trunk: core
 gui/py	lib/import
 pkg/common/DataClass/PhysicalParameters	pkg/common/Engine/DeusExMachina	pkg/common/Engine/StandAloneEngine
 pkg/dem/Engine/EngineUnit	pkg/dem/Engine/StandAloneEngine	pkg/dem/RenderingEngine/GLDrawElasticContactInteraction
In-Reply-To: <48368210.2020107@arcig.cz>
References: <200805230959.02683.dorofeenko@icp.ac.ru>
	<48368210.2020107@arcig.cz>
Message-ID: <4836F42A.6020601@hmg.inpg.fr>


> Distant links have (I think) no computation penalty unless you enable
> them: haveDistantTransient in PersistentSAPCollider (which only means it
> will not delete distant contacs) and by using
> InteractinSphere2*4DistantSpheresContactGeometry at the same time.
>
>   
No need to use InteractinSphere2*4DistantSpheresContactGeometry.
The usual "non-distant" version : 
InteractinSphere2*4SpheresContactGeometry will work perfectly since (cpp 
line 41)  :

if (penetrationDepth>0 || c->isReal){
....
return true;}

All features that were previously coded in the "distant" versions of 
classes are now implemented in the standard classes, so we should remove 
all classes with "distant" in the name soon. The last step will be to 
remove persistent links...

> Good that there is discussion about that, it needs to be clarified.
>
>   
Indeed. I'm thinking about a short text to summarize creation/deletion 
of interraction in collider/interactionGeometryEngine/contactLaw.


> I created page http://yade.wikia.com/wiki/Sanitizing_Contact_Logic,
> please express your opinions there (everybody) and sign it with ~~~~
> (will be replaced by username and date)
>
>   
Perfect!

Bruno






> Regards, Vaclav
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From dorofeenko at icp.ac.ru  Fri May 23 18:57:30 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Fri, 23 May 2008 20:57:30 +0400
Subject: [yade-dev] [Yade-commits] r1359 - in trunk: core gui/py
	lib/import pkg/common/DataClass/PhysicalParameters
	pkg/common/Engine/DeusExMachina
	pkg/common/Engine/StandAloneEngine pkg/dem/Engine/EngineUnit
	pkg/dem/Engine/StandAloneEngine
	pkg/dem/RenderingEngine/GLDrawElasticContactInteraction
In-Reply-To: <4836E98C.8020301@arcig.cz>
References: <200805230959.02683.dorofeenko@icp.ac.ru>
	<200805231741.20667.dorofeenko@icp.ac.ru>
	<4836E98C.8020301@arcig.cz>
Message-ID: <200805232057.31165.dorofeenko@icp.ac.ru>

> InteractingSphere2InteractingSphere4DistantSpheresContactGeometry
> creates SpheresContacatGeometry; 
Yes.

> contrary to IS2IS4SCG however, it will 
> create SpheresContactGeometry even if penetrationDepth<=0.
Yes. E.q. will IS2IS4SCG create SCG _only_ if penetrationDepth>0?

> > InteractionDetectionFactor should be removed
> > from SpheresContactGeometry.
No, it's wrong.

> > >if (penetrationDepth>0 || c->isReal)
> > should be replaced by
> > > if (penetrationDepth>0)
Why is it wrong?
 
> [ I eventually want to replace IS2IS4DSCG by IS2IS4SCG with some flag
> that will permit distant interactions. There is no reason for such code
> duplication ]
> >
Yes, IS2IS4SCG::go() and IS2IS4DSCG:go() are now _completely_ identical, 
except that I deactivated the condition (...| | c->isReal) in the first in 
accordance with 
>__contrary to IS2IS4SCG however__, it will
> create SpheresContactGeometry even if penetrationDepth<=0.

So, if we use a special flag for distant case, 
the general condition shall be as follows:

> if ( penetrationDepth>0 || (isDistant && c->isReal) )

Is't it?


> isReal is not clear at all and I had to read sources (at all the places
> where it is used) to get to know what it means. isReal for distant
> contact is false, but the contact is not "unreal" nonetheless. 
No... for distant contact it will be true...in accordance with the same condition:

>if (penetrationDepth>0 || c->isReal)

that implies that if isReal was once set, it is not unset over all interaction.

> >
> Why not call it isStale then or something similar?
I assumed the arbitrary use, but only within Engine, as a local variable related to the interaction.
It seems to me that a non-special flag should be...

-- 
Best regards, Sergei D.


From bruno.chareyre at hmg.inpg.fr  Fri May 23 18:49:31 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Fri, 23 May 2008 18:49:31 +0200
Subject: [yade-dev] [Yade-commits] r1359 - in trunk: core gui/py
 lib/import pkg/common/DataClass/PhysicalParameters
 pkg/common/Engine/DeusExMachina pkg/common/Engine/StandAloneEngine
 pkg/dem/Engine/EngineUnit pkg/dem/Engine/StandAloneEngine
 pkg/dem/RenderingEngine/GLDrawElasticContactInteraction
In-Reply-To: <4836E98C.8020301@arcig.cz>
References: <200805230959.02683.dorofeenko@icp.ac.ru>	<48368210.2020107@arcig.cz>	<200805231741.20667.dorofeenko@icp.ac.ru>
	<4836E98C.8020301@arcig.cz>
Message-ID: <4836F59B.9030402@hmg.inpg.fr>

V?clav S a ?crit :
>> 1. There is SpheresContactGeometry. Is it supposed to be used _only
>> for contact_ interactions?
>>
>> 2. There is DistantSpheresContactGeometry. Is it supposed to be used
>> for _distant_ interactions?
>>
>>     
> No; the name is misleding;
> InteractingSphere2InteractingSphere4DistantSpheresContactGeometry
> creates SpheresContacatGeometry; contrary to IS2IS4SCG however, it will
> create SpheresContactGeometry even if penetrationDepth<=0.
>
> [ I eventually want to replace IS2IS4DSCG by IS2IS4SCG with some flag
> that will permit distant interactions. There is no reason for such code
> duplication ]
>   
Please just forget those "distant" classes, normal classes have the same 
features now.

>>     
> isReal is not clear at all and I had to read sources (at all the places
> where it is used) to get to know what it means. isReal for distant
> contact is false, but the contact is not "unreal" nonetheless. (yes,
> isNew is OK)
>   
Huh?!!! Sure of that?
isReal for distant contacts should be true since only the contact law 
will set it false.

For me the meaning of isReal is clear : isReal = "is there an interaction?".


> Again, I suggest moving this discussion to the wiki page
> http://yade.wikia.com/wiki/Sanitizing_Contact_Logic so that we have some
> starting point and can decide what and how will change.
>
>   
Ok, moving to wiki :)

B



> Regards, V.
>
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Fri May 23 19:07:44 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Fri, 23 May 2008 19:07:44 +0200
Subject: [yade-dev] [Yade-commits] r1359 - in trunk: core gui/py
 lib/import pkg/common/DataClass/PhysicalParameters
 pkg/common/Engine/DeusExMachina pkg/common/Engine/StandAloneEngine
 pkg/dem/Engine/EngineUnit pkg/dem/Engine/StandAloneEngine
 pkg/dem/RenderingEngine/GLDrawElasticContactInteraction
In-Reply-To: <4836F59B.9030402@hmg.inpg.fr>
References: <200805230959.02683.dorofeenko@icp.ac.ru>	<48368210.2020107@arcig.cz>	<200805231741.20667.dorofeenko@icp.ac.ru>	<4836E98C.8020301@arcig.cz>
	<4836F59B.9030402@hmg.inpg.fr>
Message-ID: <4836F9E0.3040101@arcig.cz>


>> isReal is not clear at all and I had to read sources (at all the places
>> where it is used) to get to know what it means. isReal for distant
>> contact is false, but the contact is not "unreal" nonetheless. (yes,
>> isNew is OK)
>>   
>>     
> Huh?!!! Sure of that?
> isReal for distant contacts should be true since only the contact law 
> will set it false.
>   
Sorry, perhaps I am mistaken here.



From bruno.chareyre at hmg.inpg.fr  Fri May 23 19:29:04 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Fri, 23 May 2008 19:29:04 +0200
Subject: [yade-dev] [Yade-commits] r1359 - in trunk: core
 gui/py	lib/import
 pkg/common/DataClass/PhysicalParameters	pkg/common/Engine/DeusExMachina	pkg/common/Engine/StandAloneEngine
 pkg/dem/Engine/EngineUnit	pkg/dem/Engine/StandAloneEngine	pkg/dem/RenderingEngine/GLDrawElasticContactInteraction
In-Reply-To: <48368210.2020107@arcig.cz>
References: <200805230959.02683.dorofeenko@icp.ac.ru>
	<48368210.2020107@arcig.cz>
Message-ID: <4836FEE0.9050100@hmg.inpg.fr>


>
> I created page http://yade.wikia.com/wiki/Sanitizing_Contact_Logic,
> please express your opinions there (everybody) and sign it with ~~~~
> (will be replaced by username and date)
>   

The text describing current status is wrong, at least for the cases when 
haveDistantTransient==true.
I don't really know how to emphazise text modification in wiki so i'm 
pasting both versions here.

IsReal :

before : "isReal
 false: only bounding boxes overlap, but there is no overlap of bodies.
 true: both bounding boxes and bodies overlap (distance < 0)"

after : "isReal
 false: only bounding boxes overlap, but there is no overlap of bodies 
and no physical interaction.
 true: both bounding boxes and bodies overlap (distance < 0) and/or 
there is a physical interaction."

isNew :
 
before : sorry, wrong move, I can't find how it was before... but the 
case of an interaction with isReal=false going back to isReal=true was 
not mentioned (in such case isNew will be true, even if the interaction 
was not just created by the collider, it is still physisally new).


after :"isNew
 true: the interaction has just been created by the collider (there is 
no interaction physics), or if the interaction already existed isReal 
was false in the previous iteration.
 false: the contact was Real during the previous iteration"








> Regards, Vaclav
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Fri May 23 19:52:45 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Fri, 23 May 2008 19:52:45 +0200
Subject: [yade-dev] [Yade-commits] r1359 - in trunk: core
 gui/py	lib/import
 pkg/common/DataClass/PhysicalParameters	pkg/common/Engine/DeusExMachina	pkg/common/Engine/StandAloneEngine
 pkg/dem/Engine/EngineUnit	pkg/dem/Engine/StandAloneEngine	pkg/dem/RenderingEngine/GLDrawElasticContactInteraction
In-Reply-To: <200805232057.31165.dorofeenko@icp.ac.ru>
References: <200805230959.02683.dorofeenko@icp.ac.ru>	<200805231741.20667.dorofeenko@icp.ac.ru>	<4836E98C.8020301@arcig.cz>
	<200805232057.31165.dorofeenko@icp.ac.ru>
Message-ID: <4837046D.2070600@hmg.inpg.fr>


>   
>>>> if (penetrationDepth>0 || c->isReal)
>>>>         
>>> should be replaced by
>>>       
>>>> if (penetrationDepth>0)
>>>>         
> Why is it wrong?
>   

Because the fact that there is no overlap does not mean that there is no 
interraction (tensile force, capillary effect, electrostatic 
interaction, cement between distant bodies, etc.). Did you revert this 
already? Please do it fast as it really brakes Yade for at least 3 users 
(including me).

GeometryEngine is computing the geometry if we need it, and we need it 
if there is an interaction (i.e. isReal = true).

Bruno

-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Sun May 25 15:28:52 2008
From: eudoxos at arcig.cz (eudoxos at arcig.cz)
Date: Sun, 25 May 2008 15:28:52 +0200 (CEST)
Subject: [yade-dev] Automated crash report for
	/tmp/yade-26182/bin/yade-svn1368:	SDECLinkedSpheres, ScrewGen,
	TetraTestGen, ThreePointBending
Message-ID: <20080525132852.0AE12980D1@delta>

################################################################################
SDECLinkedSpheres: simulation CRASH
################################################################################
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
yade-svn1368: /usr/include/boost/shared_ptr.hpp:253: T* boost::shared_ptr<T>::operator->() const [with T = SpheresContactGeometry]: Assertion `px != 0' failed.
Running script /tmp/yade-test-28814.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1368/gdb_crash_batch-pid28873'
GNU gdb 6.6-debian
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Using host libthread_db library "/lib/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread 47449815311040 (LWP 28873)]
[New Thread 1082132800 (LWP 28874)]
0x00000030010961d1 in nanosleep () from /lib/libc.so.6
No symbol "info" in current context.

Thread 2 (Thread 1082132800 (LWP 28874)):
#0  0x0000003001095b2f in waitpid () from /lib/libc.so.6
#1  0x000000300103c763 in ?? () from /lib/libc.so.6
#2  0x000000300103cad7 in system () from /lib/libc.so.6
#3  0x00000000005705c3 in sigHandler (sig=6) at core/yade.cpp:58
#4  <signal handler called>
#5  0x0000003001030cab in raise () from /lib/libc.so.6
#6  0x0000003001032660 in abort () from /lib/libc.so.6
#7  0x000000300102a436 in __assert_fail () from /lib/libc.so.6
#8  0x00002b27cbb90b5b in boost::shared_ptr<SpheresContactGeometry>::operator-> (this=0x407ffca0) at /usr/include/boost/shared_ptr.hpp:253
#9  0x00002b27cbdbedd0 in InteractingSphere2InteractingSphere4SpheresContactGeometry::go (this=0xa574e0, cm1=@0xa5cfd8, cm2=@0xa5bf18, se31=@0xa5d920, se32=@0xa5dca0, c=@0x407ffdd0) at pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp:69
#10 0x00002b27c953e765 in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<InteractingGeometry, Loki::NullType> >, InteractionGeometryEngineUnit, bool, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Se3<double> const&, Loki::Typelist<boost::shared_ptr<Interaction> const&, Loki::NullType> > > > >, false>::operator() (this=0xa56c20, base1=@0xa5cfd8, base2=@0xa5bf18, p3=@0xa5d920, p4=@0xa5dca0, p5=@0x407ffdd0) at /tmp/yade-26182/build-svn1368/include/yade-svn1368/yade/lib-multimethods/DynLibDispatcher.hpp:882
#11 0x00002b27c953388b in InteractionGeometryMetaEngine::action (this=0xa56be0, ncb=0xa54660) at pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.cpp:31
#12 0x0000000000516a47 in MetaBody::moveToNextTimeStep (this=0xa54660) at core/MetaBody.cpp:81
#13 0x0000000000567411 in SimulationFlow::singleAction (this=0x806680) at core/SimulationFlow.cpp:17
#14 0x00000000005691dc in ThreadWorker::callSingleAction (this=0x806680) at core/ThreadWorker.cpp:71
#15 0x0000000000568909 in ThreadRunner::call (this=0xa4e660) at core/ThreadRunner.cpp:42
#16 0x000000000056896d in ThreadRunner::run (this=0xa4e660) at core/ThreadRunner.cpp:21
#17 0x0000000000568d79 in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0xa3af30, p=0xa4e660) at /usr/include/boost/bind/mem_fn_template.hpp:45
#18 0x0000000000568dfa in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0xa3af40, f=@0xa3af30, a=@0x4080004f) at /usr/include/boost/bind.hpp:230
#19 0x0000000000568e3d in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0xa3af30) at /usr/include/boost/bind/bind_template.hpp:20
#20 0x0000000000568e62 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr={obj_ptr = 0xa3af30, const_obj_ptr = 0xa3af30, func_ptr = 0xa3af30, data = "0"}) at /usr/include/boost/function/function_template.hpp:136
#21 0x00002b27c215b8cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#22 0x00002b27c215b2ef in ?? () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#23 0x00000030024062a5 in start_thread () from /lib/libpthread.so.0
#24 0x00000030010cf61d in clone () from /lib/libc.so.6
#25 0x0000000000000000 in ?? ()

Thread 1 (Thread 47449815311040 (LWP 28873)):
#0  0x00000030010961d1 in nanosleep () from /lib/libc.so.6
#1  0x00000030010c9134 in usleep () from /lib/libc.so.6
#2  0x00002b27e81034ee in pyOmega::wait (this=0xa3af20) at gui/py/yadeControl.cpp:386
#3  0x00002b27e8042c77 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0xa26d58, tc=@0x7fffe903fb00) at /usr/include/boost/python/detail/invoke.hpp:94
#4  0x00002b27e8099e9c in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0xa26d58, args_=0x2b27c582dad0) at /usr/include/boost/python/detail/caller.hpp:199
#5  0x00002b27e8099ef5 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0xa26d50, args=0x2b27c582dad0, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#6  0x00002b27c36ed89d in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#7  0x00002b27c36ee825 in boost::detail::function::void_function_obj_invoker0<boost::python::objects::(anonymous namespace)::bind_return, void>::invoke () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#8  0x00002b27c215b8cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#9  0x00002b27c36f38f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#10 0x00002b27c36eddb7 in boost::python::handle_exception<boost::python::objects::(anonymous namespace)::bind_return> () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#11 0x00002b27c36eac9e in ?? () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#12 0x00002b27c1acb033 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#13 0x00002b27c1b46919 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#14 0x00002b27c1b4c6c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#15 0x00002b27c1b4c702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#16 0x00002b27c1b6f561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#17 0x00002b27c1b438a4 in ?? () from /usr/lib/libpython2.5.so.1.0
#18 0x00002b27c1b4b8d5 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#19 0x00002b27c1b4c6c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#20 0x00002b27c1b4c702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#21 0x00002b27c1b6f561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#22 0x00002b27c1b6f7e8 in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#23 0x00002b27cf464c1b in PythonUI::execScript (script=@0x7fffe9040c10) at gui/py/PythonUI.cpp:42
#24 0x00002b27cf465ae2 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:92
#25 0x00002b27cf4662e2 in PythonUI::run (this=0xa298e0, argc=3, argv=0x7fffe90417d0) at gui/py/PythonUI.cpp:121
#26 0x0000000000570061 in main (argc=3, argv=0x7fffe90417d0) at core/yade.cpp:255
#0  0x00000030010961d1 in nanosleep () from /lib/libc.so.6

################################################################################
ScrewGen: generator CRASH
################################################################################
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
yade-svn1368: /tmp/yade-26182/build-svn1368/include/yade-svn1368/yade/lib-multimethods/DynLibDispatcher.hpp:447: bool DynLibDispatcher<BaseClass, Executor, ResultType, TList, autoSymmetry>::locateMultivirtualFunctor2D(int&, int&, boost::shared_ptr<typename Loki::TL::TypeAtNonStrict<typename Loki::TL::Append<Loki::NullType, T>::Result, 0u, Loki::NullType>::Result>&, boost::shared_ptr<typename Loki::TL::TypeAtNonStrict<typename Loki::TL::Append<Loki::NullType, T>::Result, 1u, Loki::NullType>::Result>&) [with BaseClass = Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, Executor = BoundingVolumeEngineUnit, ResultType = void, TList = Loki::Typelist<const boost::shared_ptr<InteractingGeometry>&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<const Se3r&, Loki::Typelist<const Body*, Loki::NullType> > > >, bool autoSymmetry = true]: Assertion `index1 >= 0 && (unsigned int)( index1 ) < callBacks.size() && index2 >= 0 && (unsigned
  int)( index2 ) < callBacks[index1].size()' failed.
Running script /tmp/yade-test-28814.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1368/gdb_crash_batch-pid28896'
GNU gdb 6.6-debian
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Using host libthread_db library "/lib/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread 47510991356608 (LWP 28896)]
0x0000003001095af5 in waitpid () from /lib/libc.so.6
No symbol "info" in current context.

Thread 1 (Thread 47510991356608 (LWP 28896)):
#0  0x0000003001095af5 in waitpid () from /lib/libc.so.6
#1  0x000000300103c763 in ?? () from /lib/libc.so.6
#2  0x00000000005705c3 in sigHandler (sig=6) at core/yade.cpp:58
#3  <signal handler called>
#4  0x0000003001030cab in raise () from /lib/libc.so.6
#5  0x0000003001032660 in abort () from /lib/libc.so.6
#6  0x000000300102a436 in __assert_fail () from /lib/libc.so.6
#7  0x00002b36084a35e1 in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, BoundingVolumeEngineUnit, void, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Body const*, Loki::NullType> > > >, true>::locateMultivirtualFunctor2D (this=0xa4f840, index1=@0x7fffaaa3783c, index2=@0x7fffaaa37838, base1=@0xa59208, base2=@0xa59218) at /tmp/yade-26182/build-svn1368/include/yade-svn1368/yade/lib-multimethods/DynLibDispatcher.hpp:446
#8  0x00002b36084a395b in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, BoundingVolumeEngineUnit, void, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Body const*, Loki::NullType> > > >, true>::operator() (this=0xa4f840, base1=@0xa59208, base2=@0xa59218, p3=@0xa59260, p4=0xa591c0) at /tmp/yade-26182/build-svn1368/include/yade-svn1368/yade/lib-multimethods/DynLibDispatcher.hpp:856
#9  0x00002b3608498e25 in BoundingVolumeMetaEngine::action (this=0xa4f800, ncb=0xa4f4c0) at pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine.cpp:27
#10 0x0000000000516b85 in MetaBody::runInitializers (this=0xa4f4c0) at core/MetaBody.cpp:43
#11 0x0000000000516c44 in MetaBody::postProcessAttributes (this=0xa4f4c0, deserializing=false) at core/MetaBody.cpp:49
#12 0x00002b3602372154 in Serializable::unregisterSerializableAttributes (this=0xa4f4c0, deserializing=false) at lib/serialization/Serializable.cpp:29
#13 0x00002b3603e4c8a5 in XMLFormatManager::serializeSerializable (stream=@0x7fffaaa37bd0, ac=@0xaac080, depth=1) at lib/serialization-xml/XMLFormatManager.cpp:168
#14 0x00002b3603e4b258 in XMLFormatManager::serializeSmartPointer (stream=@0x7fffaaa37bd0, ac=@0xaabff0, depth=1) at lib/serialization-xml/XMLFormatManager.cpp:284
#15 0x0000000000505c62 in IOFormatManager::saveToFile<boost::shared_ptr<MetaBody> > (libName=@0xa4e580, fileName=@0xa4e578, name=@0x7fffaaa380e0, t=@0xa4e568) at /tmp/yade-26182/build-svn1368/include/yade-svn1368/yade/lib-serialization/IOFormatManager.tpp:59
#16 0x00000000004f161f in FileGenerator::generateAndSave (this=0xa4e500) at core/FileGenerator.cpp:89
#17 0x00002b3626704110 in pyFileGenerator::generate (this=0xa4e6a0, outFile=@0x7fffaaa38440) at gui/py/yadeControl.cpp:263
#18 0x00002b36266e69f7 in boost::python::detail::invoke<boost::python::to_python_value<bool const&>, bool (pyFileGenerator::*)(std::string), boost::python::arg_from_python<pyFileGenerator&>, boost::python::arg_from_python<std::string> > (rc=@0x7fffaaa384de, f=@0xa49438, tc=@0x7fffaaa384c0, ac0=@0x7fffaaa384e0) at /usr/include/boost/python/detail/invoke.hpp:88
#19 0x00002b36266e6b5a in boost::python::detail::caller_arity<2u>::impl<bool (pyFileGenerator::*)(std::string), boost::python::default_call_policies, boost::mpl::vector3<bool, pyFileGenerator&, std::string> >::operator() (this=0xa49438, args_=0x2b3603e23ea8) at /usr/include/boost/python/detail/caller.hpp:199
#20 0x00002b36266e6c05 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<bool (pyFileGenerator::*)(std::string), boost::python::default_call_policies, boost::mpl::vector3<bool, pyFileGenerator&, std::string> > >::operator() (this=0xa49430, args=0x2b3603e23ea8, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#21 0x00002b3601cf389d in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#22 0x00002b3601cf4825 in boost::detail::function::void_function_obj_invoker0<boost::python::objects::(anonymous namespace)::bind_return, void>::invoke () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#23 0x00002b36007618cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#24 0x00002b3601cf98f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#25 0x00002b3601cf3db7 in boost::python::handle_exception<boost::python::objects::(anonymous namespace)::bind_return> () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#26 0x00002b3601cf0c9e in ?? () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#27 0x00002b36000d1033 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#28 0x00002b360014c919 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#29 0x00002b36001526c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#30 0x00002b3600152702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#31 0x00002b3600175561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#32 0x00002b36001498a4 in ?? () from /usr/lib/libpython2.5.so.1.0
#33 0x00002b36001518d5 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#34 0x00002b36001526c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#35 0x00002b3600152702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#36 0x00002b3600175561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#37 0x00002b36001757e8 in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#38 0x00002b360da6ac1b in PythonUI::execScript (script=@0x7fffaaa39600) at gui/py/PythonUI.cpp:42
#39 0x00002b360da6bae2 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:92
#40 0x00002b360da6c2e2 in PythonUI::run (this=0xa298e0, argc=3, argv=0x7fffaaa3a1c0) at gui/py/PythonUI.cpp:121
#41 0x0000000000570061 in main (argc=3, argv=0x7fffaaa3a1c0) at core/yade.cpp:255
#0  0x0000003001095af5 in waitpid () from /lib/libc.so.6

################################################################################
TetraTestGen: generator CRASH
################################################################################
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
43520.3
194711
191169
4417.66
-46343.2
11996.2
yade-svn1368: /tmp/yade-26182/build-svn1368/include/yade-svn1368/yade/lib-multimethods/DynLibDispatcher.hpp:447: bool DynLibDispatcher<BaseClass, Executor, ResultType, TList, autoSymmetry>::locateMultivirtualFunctor2D(int&, int&, boost::shared_ptr<typename Loki::TL::TypeAtNonStrict<typename Loki::TL::Append<Loki::NullType, T>::Result, 0u, Loki::NullType>::Result>&, boost::shared_ptr<typename Loki::TL::TypeAtNonStrict<typename Loki::TL::Append<Loki::NullType, T>::Result, 1u, Loki::NullType>::Result>&) [with BaseClass = Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, Executor = BoundingVolumeEngineUnit, ResultType = void, TList = Loki::Typelist<const boost::shared_ptr<InteractingGeometry>&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<const Se3r&, Loki::Typelist<const Body*, Loki::NullType> > > >, bool autoSymmetry = true]: Assertion `index1 >= 0 && (unsigned int)( index1 ) < callBacks.size() && index2 >= 0 && (unsigned
  int)( index2 ) < callBacks[index1].size()' failed.
Running script /tmp/yade-test-28814.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1368/gdb_crash_batch-pid28917'
GNU gdb 6.6-debian
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Using host libthread_db library "/lib/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread 47440684769984 (LWP 28917)]
0x0000003001095af5 in waitpid () from /lib/libc.so.6
No symbol "info" in current context.

Thread 1 (Thread 47440684769984 (LWP 28917)):
#0  0x0000003001095af5 in waitpid () from /lib/libc.so.6
#1  0x000000300103c763 in ?? () from /lib/libc.so.6
#2  0x00000000005705c3 in sigHandler (sig=6) at core/yade.cpp:58
#3  <signal handler called>
#4  0x0000003001030cab in raise () from /lib/libc.so.6
#5  0x0000003001032660 in abort () from /lib/libc.so.6
#6  0x000000300102a436 in __assert_fail () from /lib/libc.so.6
#7  0x00002b25a9b0d5e1 in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, BoundingVolumeEngineUnit, void, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Body const*, Loki::NullType> > > >, true>::locateMultivirtualFunctor2D (this=0xa4eba0, index1=@0x7fff093cf1dc, index2=@0x7fff093cf1d8, base1=@0xa545b8, base2=@0xa545c8) at /tmp/yade-26182/build-svn1368/include/yade-svn1368/yade/lib-multimethods/DynLibDispatcher.hpp:446
#8  0x00002b25a9b0d95b in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, BoundingVolumeEngineUnit, void, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Body const*, Loki::NullType> > > >, true>::operator() (this=0xa4eba0, base1=@0xa545b8, base2=@0xa545c8, p3=@0xa54770, p4=0xa54570) at /tmp/yade-26182/build-svn1368/include/yade-svn1368/yade/lib-multimethods/DynLibDispatcher.hpp:856
#9  0x00002b25a9b02e25 in BoundingVolumeMetaEngine::action (this=0xa4eb60, ncb=0xa4e840) at pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine.cpp:27
#10 0x0000000000516b85 in MetaBody::runInitializers (this=0xa4e840) at core/MetaBody.cpp:43
#11 0x0000000000516c44 in MetaBody::postProcessAttributes (this=0xa4e840, deserializing=false) at core/MetaBody.cpp:49
#12 0x00002b25a39dc154 in Serializable::unregisterSerializableAttributes (this=0xa4e840, deserializing=false) at lib/serialization/Serializable.cpp:29
#13 0x00002b25a54b68a5 in XMLFormatManager::serializeSerializable (stream=@0x7fff093cf570, ac=@0xa58480, depth=1) at lib/serialization-xml/XMLFormatManager.cpp:168
#14 0x00002b25a54b5258 in XMLFormatManager::serializeSmartPointer (stream=@0x7fff093cf570, ac=@0xa583f0, depth=1) at lib/serialization-xml/XMLFormatManager.cpp:284
#15 0x0000000000505c62 in IOFormatManager::saveToFile<boost::shared_ptr<MetaBody> > (libName=@0xa4e580, fileName=@0xa4e578, name=@0x7fff093cfa80, t=@0xa4e568) at /tmp/yade-26182/build-svn1368/include/yade-svn1368/yade/lib-serialization/IOFormatManager.tpp:59
#16 0x00000000004f161f in FileGenerator::generateAndSave (this=0xa4e500) at core/FileGenerator.cpp:89
#17 0x00002b25c7d6e110 in pyFileGenerator::generate (this=0xa4e6a0, outFile=@0x7fff093cfde0) at gui/py/yadeControl.cpp:263
#18 0x00002b25c7d509f7 in boost::python::detail::invoke<boost::python::to_python_value<bool const&>, bool (pyFileGenerator::*)(std::string), boost::python::arg_from_python<pyFileGenerator&>, boost::python::arg_from_python<std::string> > (rc=@0x7fff093cfe7e, f=@0xa49438, tc=@0x7fff093cfe60, ac0=@0x7fff093cfe80) at /usr/include/boost/python/detail/invoke.hpp:88
#19 0x00002b25c7d50b5a in boost::python::detail::caller_arity<2u>::impl<bool (pyFileGenerator::*)(std::string), boost::python::default_call_policies, boost::mpl::vector3<bool, pyFileGenerator&, std::string> >::operator() (this=0xa49438, args_=0x2b25a54809e0) at /usr/include/boost/python/detail/caller.hpp:199
#20 0x00002b25c7d50c05 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<bool (pyFileGenerator::*)(std::string), boost::python::default_call_policies, boost::mpl::vector3<bool, pyFileGenerator&, std::string> > >::operator() (this=0xa49430, args=0x2b25a54809e0, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#21 0x00002b25a335d89d in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#22 0x00002b25a335e825 in boost::detail::function::void_function_obj_invoker0<boost::python::objects::(anonymous namespace)::bind_return, void>::invoke () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#23 0x00002b25a1dcb8cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#24 0x00002b25a33638f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#25 0x00002b25a335ddb7 in boost::python::handle_exception<boost::python::objects::(anonymous namespace)::bind_return> () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#26 0x00002b25a335ac9e in ?? () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#27 0x00002b25a173b033 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#28 0x00002b25a17b6919 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#29 0x00002b25a17bc6c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#30 0x00002b25a17bc702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#31 0x00002b25a17df561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#32 0x00002b25a17b38a4 in ?? () from /usr/lib/libpython2.5.so.1.0
#33 0x00002b25a17bb8d5 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#34 0x00002b25a17bc6c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#35 0x00002b25a17bc702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#36 0x00002b25a17df561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#37 0x00002b25a17df7e8 in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#38 0x00002b25af0d4c1b in PythonUI::execScript (script=@0x7fff093d0fa0) at gui/py/PythonUI.cpp:42
#39 0x00002b25af0d5ae2 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:92
#40 0x00002b25af0d62e2 in PythonUI::run (this=0xa298e0, argc=3, argv=0x7fff093d1b60) at gui/py/PythonUI.cpp:121
#41 0x0000000000570061 in main (argc=3, argv=0x7fff093d1b60) at core/yade.cpp:255
#0  0x0000003001095af5 in waitpid () from /lib/libc.so.6

################################################################################
ThreePointBending: simulation CRASH
################################################################################
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1368/gdb_crash_batch-pid28933'
GNU gdb 6.6-debian
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Using host libthread_db library "/lib/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread 47283464422080 (LWP 28933)]
[New Thread 1082132800 (LWP 28934)]
0x00000030010961d1 in nanosleep () from /lib/libc.so.6
No symbol "info" in current context.

Thread 2 (Thread 1082132800 (LWP 28934)):
#0  0x0000003001095b2f in waitpid () from /lib/libc.so.6
#1  0x000000300103c763 in ?? () from /lib/libc.so.6
#2  0x000000300103cad7 in system () from /lib/libc.so.6
#3  0x00000000005705c3 in sigHandler (sig=11) at core/yade.cpp:58
#4  <signal handler called>
#5  0x0000000000573392 in BodyRedirectionVector::operator[] (this=0xa56f20, id=0) at core/DefaultContainerImplementations/BodyRedirectionVector.cpp:205
#6  0x00002b011bfe02f1 in TranslationEngine::applyCondition (this=0xa58950, ncb=0xa54660) at pkg/common/Engine/DeusExMachina/TranslationEngine.cpp:38
#7  0x00000000004ead25 in DeusExMachina::action (this=0xa58950, b=0xa54660) at core/DeusExMachina.cpp:20
#8  0x0000000000516a47 in MetaBody::moveToNextTimeStep (this=0xa54660) at core/MetaBody.cpp:81
#9  0x0000000000567411 in SimulationFlow::singleAction (this=0x806680) at core/SimulationFlow.cpp:17
#10 0x00000000005691dc in ThreadWorker::callSingleAction (this=0x806680) at core/ThreadWorker.cpp:71
#11 0x0000000000568909 in ThreadRunner::call (this=0xa4e660) at core/ThreadRunner.cpp:42
#12 0x000000000056896d in ThreadRunner::run (this=0xa4e660) at core/ThreadRunner.cpp:21
#13 0x0000000000568d79 in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0xa3af30, p=0xa4e660) at /usr/include/boost/bind/mem_fn_template.hpp:45
#14 0x0000000000568dfa in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0xa3af40, f=@0xa3af30, a=@0x4080004f) at /usr/include/boost/bind.hpp:230
#15 0x0000000000568e3d in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0xa3af30) at /usr/include/boost/bind/bind_template.hpp:20
#16 0x0000000000568e62 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr={obj_ptr = 0xa3af30, const_obj_ptr = 0xa3af30, func_ptr = 0xa3af30, data = "0"}) at /usr/include/boost/function/function_template.hpp:136
#17 0x00002b0106cc98cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#18 0x00002b0106cc92ef in ?? () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#19 0x00000030024062a5 in start_thread () from /lib/libpthread.so.0
#20 0x00000030010cf61d in clone () from /lib/libc.so.6
#21 0x0000000000000000 in ?? ()

Thread 1 (Thread 47283464422080 (LWP 28933)):
#0  0x00000030010961d1 in nanosleep () from /lib/libc.so.6
#1  0x00000030010c9134 in usleep () from /lib/libc.so.6
#2  0x00002b012cc714ee in pyOmega::wait (this=0xa3af20) at gui/py/yadeControl.cpp:386
#3  0x00002b012cbb0c77 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0xa26d58, tc=@0x7fffa44cff90) at /usr/include/boost/python/detail/invoke.hpp:94
#4  0x00002b012cc07e9c in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0xa26d58, args_=0x2b010a39bad0) at /usr/include/boost/python/detail/caller.hpp:199
#5  0x00002b012cc07ef5 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0xa26d50, args=0x2b010a39bad0, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#6  0x00002b010825b89d in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#7  0x00002b010825c825 in boost::detail::function::void_function_obj_invoker0<boost::python::objects::(anonymous namespace)::bind_return, void>::invoke () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#8  0x00002b0106cc98cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#9  0x00002b01082618f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#10 0x00002b010825bdb7 in boost::python::handle_exception<boost::python::objects::(anonymous namespace)::bind_return> () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#11 0x00002b0108258c9e in ?? () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#12 0x00002b0106639033 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#13 0x00002b01066b4919 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#14 0x00002b01066ba6c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#15 0x00002b01066ba702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#16 0x00002b01066dd561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#17 0x00002b01066b18a4 in ?? () from /usr/lib/libpython2.5.so.1.0
#18 0x00002b01066b98d5 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#19 0x00002b01066ba6c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#20 0x00002b01066ba702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#21 0x00002b01066dd561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#22 0x00002b01066dd7e8 in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#23 0x00002b0113fd2c1b in PythonUI::execScript (script=@0x7fffa44d10a0) at gui/py/PythonUI.cpp:42
#24 0x00002b0113fd3ae2 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:92
#25 0x00002b0113fd42e2 in PythonUI::run (this=0xa298e0, argc=3, argv=0x7fffa44d1c60) at gui/py/PythonUI.cpp:121
#26 0x0000000000570061 in main (argc=3, argv=0x7fffa44d1c60) at core/yade.cpp:255
#0  0x00000030010961d1 in nanosleep () from /lib/libc.so.6


From eudoxos at arcig.cz  Sun May 25 16:18:44 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Sun, 25 May 2008 16:18:44 +0200
Subject: [yade-dev] Automated crash report for
 /tmp/yade-26182/bin/yade-svn1368: SDECLinkedSpheres, ScrewGen, TetraTestGen,
 ThreePointBending
In-Reply-To: <20080525132852.0AE12980D1@delta>
References: <20080525132852.0AE12980D1@delta>
Message-ID: <48397544.9060202@arcig.cz>

I added weekly cronjob for downloading latest svn, doing clean build,
running scripts/default-test.py. If there is crash in tests, it will bug
us on the mailing list like this. Complete build logs are located:
http://beta.arcig.cz/~eudoxos/yade/ . Once Janek has regressions tests,
they can be added to the script.

Eh, one minor thing for Bruno: triangulation test data are quite big and
are downloaded every time; given that it is used only for testing by few
peoples, would it be acceptable for you if those files were somewhere
else - on wikia or perhaps in a separate svn branch, with notice
somewhere where they can be downloaded from?

Regards, Vaclav



From bruno.chareyre at hmg.inpg.fr  Mon May 26 18:00:15 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Mon, 26 May 2008 18:00:15 +0200
Subject: [yade-dev] [Yade-commits] r1368 - trunk/scripts
In-Reply-To: <200805251312.m4PDCtjp026209@sheep.berlios.de>
References: <200805251312.m4PDCtjp026209@sheep.berlios.de>
Message-ID: <483ADE8F.7030006@hmg.inpg.fr>

I just commited version 1369 (I removed triangulation data files) but I 
don't see any mail in yade-commits.
Whats happening?

Bruno

-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Mon May 26 21:33:14 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Mon, 26 May 2008 21:33:14 +0200
Subject: [yade-dev] [Yade-commits] r1368 - trunk/scripts
In-Reply-To: <483ADE8F.7030006@hmg.inpg.fr>
References: <200805251312.m4PDCtjp026209@sheep.berlios.de>
	<483ADE8F.7030006@hmg.inpg.fr>
Message-ID: <483B107A.7020301@arcig.cz>


> I just commited version 1369 (I removed triangulation data files) but I 
> don't see any mail in yade-commits.
> Whats happening?
>   
Thanks. If svn puts the 12MB diff in the mail, it doesn't get through
the list limit, I think.

Vaclav



From dorofeenko at icp.ac.ru  Thu May 29 10:25:57 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Thu, 29 May 2008 12:25:57 +0400
Subject: [yade-dev] svn1370 unstable
Message-ID: <200805291225.57407.dorofeenko@icp.ac.ru>

Hello!
Since the YADE interface is changing significantly, and, as me seems, the last 
revisions very unstable, I have the following question. Is it that making 
changes to the trunk should not harm the YADE stability? Or, are active now 
because the changes allowed high instability, and better just wait until all 
the work will be completed? The issue relates to whether that should report 
any problems in the last revisions, or about them and so well known?

Now I can not even run the program:

==========
sega at sega:~/work/yade/trunk/scripts> yade-trunk-opt simple-scene.py
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' 
flag!).
INFO  core/Omega.cpp:34 Omega: Constructing Omega  (if multiple times - 
check '-rdynamic' flag!).
INFO  core/yade.cpp:229 main: Loading configuration 
file: /home/sega/.yade-trunk-opt/preferences.xml
INFO  core/yade.cpp:231 main: Loading plugins...
WARNING: cannot open file used for capillary law, in TriaxalTestWater
INFO  core/yade.cpp:231 main: Plugins loaded.
INFO  gui/qt3/YadeQtMainWindow.cpp:51 YadeQtMainWindow: Loading configuration 
file: /home/sega/.yade-trunk-opt/QtGUIPreferences.xml.
INFO  gui/qt3/QtGUI.cpp:67 run: Launching Python thread now...
Running script simple-scene.py
INFO  core/Omega.cpp:364 saveSimulation: Saving file /tmp/a.xml
__   __    ____          ____                      _
\ \ / /_ _|  _ \  ___   / ___|___  _ __  ___  ___ | | ___
 \ V / _` | | | |/ _ \ | |   / _ \| '_ \/ __|/ _ \| |/ _ \
  | | (_| | |_| |  __/ | |__| (_) | | | \__ \ (_) | |  __/
  |_|\__,_|____/ \___|  \____\___/|_| |_|___/\___/|_|\___|

In [1]: o.run()

In [2]: Segmentation fault.
sega at sega:~/work/yade/trunk/scripts>
==========

I looked up /tmp/a.xml and discovered that isDynamic of rootbody is "88".
I corrected it, but the program still does not work:

===================
sega at sega:~/work/yade/trunk/scripts> yade-trunk-opt -S /tmp/a.xml
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' 
flag!).
INFO  core/Omega.cpp:34 Omega: Constructing Omega  (if multiple times - 
check '-rdynamic' flag!).
INFO  core/yade.cpp:229 main: Loading configuration 
file: /home/sega/.yade-trunk-opt/preferences.xml
INFO  core/yade.cpp:231 main: Loading plugins...
WARNING: cannot open file used for capillary law, in TriaxalTestWater
INFO  core/yade.cpp:231 main: Plugins loaded.
INFO  gui/qt3/YadeQtMainWindow.cpp:51 YadeQtMainWindow: Loading configuration 
file: /home/sega/.yade-trunk-opt/QtGUIPreferences.xml.
Omega::instance().getSimulationFileName()=/tmp/a.xml
INFO  core/Omega.cpp:330 loadSimulation: Loading file /tmp/a.xml
INFO  gui/qt3/QtGUI.cpp:67 run: Launching Python thread now...
Running simulation /tmp/a.xml
INFO  core/Omega.cpp:330 loadSimulation: Loading file /tmp/a.xml
[1]+  Done                    gvim /tmp/a.xml
Segmentation fault.
=========================

--
Best regards, Sergei D.


From eudoxos at arcig.cz  Thu May 29 17:53:43 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Thu, 29 May 2008 17:53:43 +0200
Subject: [yade-dev] svn1370 unstable
In-Reply-To: <200805291225.57407.dorofeenko@icp.ac.ru>
References: <200805291225.57407.dorofeenko@icp.ac.ru>
Message-ID: <483ED187.7070409@arcig.cz>


> Hello!
> Since the YADE interface is changing significantly, and, as me seems, the last 
> revisions very unstable, I have the following question. Is it that making 
> changes to the trunk should not harm the YADE stability? Or, are active now 
> because the changes allowed high instability, and better just wait until all 
> the work will be completed? The issue relates to whether that should report 
> any problems in the last revisions, or about them and so well known?
>   
Yade definitely should not crash. It works for me here, however, could
you try to reproduce with the debugging version (scons profile=default
or like that) and attach backtrace? (isDynamic=88 is weird, but should
be harmless since you only save the .xml and not load it.)

That's why I set up weekly automated tests, but they run on amd64 with
ubuntu feisty, I am running on amd64 hardy.

(You could also purge your plugins install dir to make sure there is no
old plugin left; some of them may have disappeared, old version is not
overwritten by newer version but still loaded by current yade. Perhaps
that is the cause? Get the backtrace, we will see.)

Regards, Vaclav



From eudoxos at arcig.cz  Sun Jun  1 00:09:18 2008
From: eudoxos at arcig.cz (eudoxos at arcig.cz)
Date: Sun,  1 Jun 2008 00:09:18 +0200 (CEST)
Subject: [yade-dev] Automated crash report for
	/tmp/yade-29172/bin/yade-svn1371:	SDECLinkedSpheres, ScrewGen,
	TetraTestGen, ThreePointBending
Message-ID: <20080531220918.345E7980D1@delta>

################################################################################
SDECLinkedSpheres: simulation CRASH
################################################################################
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
yade-svn1371: /usr/include/boost/shared_ptr.hpp:253: T* boost::shared_ptr<T>::operator->() const [with T = SpheresContactGeometry]: Assertion `px != 0' failed.
Running script /tmp/yade-test-31853.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1371/gdb_crash_batch-pid31915'
GNU gdb 6.6-debian
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Using host libthread_db library "/lib/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread 47974251692736 (LWP 31915)]
[New Thread 1082132800 (LWP 31916)]
0x00000030010961d1 in nanosleep () from /lib/libc.so.6
No symbol "info" in current context.

Thread 2 (Thread 1082132800 (LWP 31916)):
#0  0x0000003001095b2f in waitpid () from /lib/libc.so.6
#1  0x000000300103c763 in ?? () from /lib/libc.so.6
#2  0x000000300103cad7 in system () from /lib/libc.so.6
#3  0x00000000005705f3 in sigHandler (sig=6) at core/yade.cpp:58
#4  <signal handler called>
#5  0x0000003001030cab in raise () from /lib/libc.so.6
#6  0x0000003001032660 in abort () from /lib/libc.so.6
#7  0x000000300102a436 in __assert_fail () from /lib/libc.so.6
#8  0x00002ba1e6912b5b in boost::shared_ptr<SpheresContactGeometry>::operator-> (this=0x407ffca0) at /usr/include/boost/shared_ptr.hpp:253
#9  0x00002ba1e6b40dd0 in InteractingSphere2InteractingSphere4SpheresContactGeometry::go (this=0xa53df0, cm1=@0xa5a308, cm2=@0xa5a8d8, se31=@0xa5af30, se32=@0xa5b400, c=@0x407ffdd0) at pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp:69
#10 0x00002ba1e42c0765 in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<InteractingGeometry, Loki::NullType> >, InteractionGeometryEngineUnit, bool, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Se3<double> const&, Loki::Typelist<boost::shared_ptr<Interaction> const&, Loki::NullType> > > > >, false>::operator() (this=0xa54680, base1=@0xa5a308, base2=@0xa5a8d8, p3=@0xa5af30, p4=@0xa5b400, p5=@0x407ffdd0) at /tmp/yade-29172/build-svn1371/include/yade-svn1371/yade/lib-multimethods/DynLibDispatcher.hpp:882
#11 0x00002ba1e42b588b in InteractionGeometryMetaEngine::action (this=0xa54640, ncb=0xa51e10) at pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.cpp:31
#12 0x0000000000516a77 in MetaBody::moveToNextTimeStep (this=0xa51e10) at core/MetaBody.cpp:81
#13 0x0000000000567441 in SimulationFlow::singleAction (this=0x806600) at core/SimulationFlow.cpp:17
#14 0x000000000056920c in ThreadWorker::callSingleAction (this=0x806600) at core/ThreadWorker.cpp:71
#15 0x0000000000568939 in ThreadRunner::call (this=0xa4bda0) at core/ThreadRunner.cpp:42
#16 0x000000000056899d in ThreadRunner::run (this=0xa4bda0) at core/ThreadRunner.cpp:21
#17 0x0000000000568da9 in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0xa38550, p=0xa4bda0) at /usr/include/boost/bind/mem_fn_template.hpp:45
#18 0x0000000000568e2a in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0xa38560, f=@0xa38550, a=@0x4080004f) at /usr/include/boost/bind.hpp:230
#19 0x0000000000568e6d in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0xa38550) at /usr/include/boost/bind/bind_template.hpp:20
#20 0x0000000000568e92 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr={obj_ptr = 0xa38550, const_obj_ptr = 0xa38550, func_ptr = 0xa38550, data = "P"}) at /usr/include/boost/function/function_template.hpp:136
#21 0x00002ba1dcedd8cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#22 0x00002ba1dcedd2ef in ?? () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#23 0x00000030024062a5 in start_thread () from /lib/libpthread.so.0
#24 0x00000030010cf61d in clone () from /lib/libc.so.6
#25 0x0000000000000000 in ?? ()

Thread 1 (Thread 47974251692736 (LWP 31915)):
#0  0x00000030010961d1 in nanosleep () from /lib/libc.so.6
#1  0x00000030010c9134 in usleep () from /lib/libc.so.6
#2  0x00002ba202e854ee in pyOmega::wait (this=0xa38540) at gui/py/yadeControl.cpp:386
#3  0x00002ba202dc4c77 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0x98dde8, tc=@0x7fffce2bc2d0) at /usr/include/boost/python/detail/invoke.hpp:94
#4  0x00002ba202e1be9c in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0x98dde8, args_=0x2ba1e05af990) at /usr/include/boost/python/detail/caller.hpp:199
#5  0x00002ba202e1bef5 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0x98dde0, args=0x2ba1e05af990, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#6  0x00002ba1de46f89d in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#7  0x00002ba1de470825 in boost::detail::function::void_function_obj_invoker0<boost::python::objects::(anonymous namespace)::bind_return, void>::invoke () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#8  0x00002ba1dcedd8cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#9  0x00002ba1de4758f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#10 0x00002ba1de46fdb7 in boost::python::handle_exception<boost::python::objects::(anonymous namespace)::bind_return> () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#11 0x00002ba1de46cc9e in ?? () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#12 0x00002ba1dc84d033 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#13 0x00002ba1dc8c8919 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#14 0x00002ba1dc8ce6c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#15 0x00002ba1dc8ce702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#16 0x00002ba1dc8f1561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#17 0x00002ba1dc8c58a4 in ?? () from /usr/lib/libpython2.5.so.1.0
#18 0x00002ba1dc8cd8d5 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#19 0x00002ba1dc8ce6c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#20 0x00002ba1dc8ce702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#21 0x00002ba1dc8f1561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#22 0x00002ba1dc8f17e8 in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#23 0x00002ba1ea430c1b in PythonUI::execScript (script=@0x7fffce2bd3e0) at gui/py/PythonUI.cpp:42
#24 0x00002ba1ea431ae2 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:92
#25 0x00002ba1ea4322e2 in PythonUI::run (this=0x9c8710, argc=3, argv=0x7fffce2bdfa0) at gui/py/PythonUI.cpp:121
#26 0x0000000000570091 in main (argc=3, argv=0x7fffce2bdfa0) at core/yade.cpp:255
#0  0x00000030010961d1 in nanosleep () from /lib/libc.so.6

################################################################################
ScrewGen: generator CRASH
################################################################################
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
yade-svn1371: /tmp/yade-29172/build-svn1371/include/yade-svn1371/yade/lib-multimethods/DynLibDispatcher.hpp:447: bool DynLibDispatcher<BaseClass, Executor, ResultType, TList, autoSymmetry>::locateMultivirtualFunctor2D(int&, int&, boost::shared_ptr<typename Loki::TL::TypeAtNonStrict<typename Loki::TL::Append<Loki::NullType, T>::Result, 0u, Loki::NullType>::Result>&, boost::shared_ptr<typename Loki::TL::TypeAtNonStrict<typename Loki::TL::Append<Loki::NullType, T>::Result, 1u, Loki::NullType>::Result>&) [with BaseClass = Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, Executor = BoundingVolumeEngineUnit, ResultType = void, TList = Loki::Typelist<const boost::shared_ptr<InteractingGeometry>&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<const Se3r&, Loki::Typelist<const Body*, Loki::NullType> > > >, bool autoSymmetry = true]: Assertion `index1 >= 0 && (unsigned int)( index1 ) < callBacks.size() && index2 >= 0 && (unsigned
  int)( index2 ) < callBacks[index1].size()' failed.
Running script /tmp/yade-test-31853.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1371/gdb_crash_batch-pid31938'
GNU gdb 6.6-debian
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Using host libthread_db library "/lib/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread 47716229718720 (LWP 31938)]
0x0000003001095af5 in waitpid () from /lib/libc.so.6
No symbol "info" in current context.

Thread 1 (Thread 47716229718720 (LWP 31938)):
#0  0x0000003001095af5 in waitpid () from /lib/libc.so.6
#1  0x000000300103c763 in ?? () from /lib/libc.so.6
#2  0x00000000005705f3 in sigHandler (sig=6) at core/yade.cpp:58
#3  <signal handler called>
#4  0x0000003001030cab in raise () from /lib/libc.so.6
#5  0x0000003001032660 in abort () from /lib/libc.so.6
#6  0x000000300102a436 in __assert_fail () from /lib/libc.so.6
#7  0x00002b65d17315e1 in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, BoundingVolumeEngineUnit, void, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Body const*, Loki::NullType> > > >, true>::locateMultivirtualFunctor2D (this=0xa4cf80, index1=@0x7fffe17abb0c, index2=@0x7fffe17abb08, base1=@0xa56948, base2=@0xa56958) at /tmp/yade-29172/build-svn1371/include/yade-svn1371/yade/lib-multimethods/DynLibDispatcher.hpp:446
#8  0x00002b65d173195b in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, BoundingVolumeEngineUnit, void, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Body const*, Loki::NullType> > > >, true>::operator() (this=0xa4cf80, base1=@0xa56948, base2=@0xa56958, p3=@0xa569a0, p4=0xa56900) at /tmp/yade-29172/build-svn1371/include/yade-svn1371/yade/lib-multimethods/DynLibDispatcher.hpp:856
#9  0x00002b65d1726e25 in BoundingVolumeMetaEngine::action (this=0xa4cf40, ncb=0xa4cc00) at pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine.cpp:27
#10 0x0000000000516bb5 in MetaBody::runInitializers (this=0xa4cc00) at core/MetaBody.cpp:43
#11 0x0000000000516c74 in MetaBody::postProcessAttributes (this=0xa4cc00, deserializing=false) at core/MetaBody.cpp:49
#12 0x00002b65cb600154 in Serializable::unregisterSerializableAttributes (this=0xa4cc00, deserializing=false) at lib/serialization/Serializable.cpp:29
#13 0x00002b65cd0da8a5 in XMLFormatManager::serializeSerializable (stream=@0x7fffe17abea0, ac=@0xaa97c0, depth=1) at lib/serialization-xml/XMLFormatManager.cpp:168
#14 0x00002b65cd0d9258 in XMLFormatManager::serializeSmartPointer (stream=@0x7fffe17abea0, ac=@0xaa9730, depth=1) at lib/serialization-xml/XMLFormatManager.cpp:284
#15 0x0000000000505c62 in IOFormatManager::saveToFile<boost::shared_ptr<MetaBody> > (libName=@0xa4bcc0, fileName=@0xa4bcb8, name=@0x7fffe17ac3b0, t=@0xa4bca8) at /tmp/yade-29172/build-svn1371/include/yade-svn1371/yade/lib-serialization/IOFormatManager.tpp:59
#16 0x00000000004f161f in FileGenerator::generateAndSave (this=0xa4bc40) at core/FileGenerator.cpp:89
#17 0x00002b65ef992110 in pyFileGenerator::generate (this=0xa4bde0, outFile=@0x7fffe17ac710) at gui/py/yadeControl.cpp:263
#18 0x00002b65ef9749f7 in boost::python::detail::invoke<boost::python::to_python_value<bool const&>, bool (pyFileGenerator::*)(std::string), boost::python::arg_from_python<pyFileGenerator&>, boost::python::arg_from_python<std::string> > (rc=@0x7fffe17ac7ae, f=@0xa46bb8, tc=@0x7fffe17ac790, ac0=@0x7fffe17ac7b0) at /usr/include/boost/python/detail/invoke.hpp:88
#19 0x00002b65ef974b5a in boost::python::detail::caller_arity<2u>::impl<bool (pyFileGenerator::*)(std::string), boost::python::default_call_policies, boost::mpl::vector3<bool, pyFileGenerator&, std::string> >::operator() (this=0xa46bb8, args_=0x2b65cd0b9cf8) at /usr/include/boost/python/detail/caller.hpp:199
#20 0x00002b65ef974c05 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<bool (pyFileGenerator::*)(std::string), boost::python::default_call_policies, boost::mpl::vector3<bool, pyFileGenerator&, std::string> > >::operator() (this=0xa46bb0, args=0x2b65cd0b9cf8, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#21 0x00002b65caf8189d in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#22 0x00002b65caf82825 in boost::detail::function::void_function_obj_invoker0<boost::python::objects::(anonymous namespace)::bind_return, void>::invoke () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#23 0x00002b65c99ef8cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#24 0x00002b65caf878f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#25 0x00002b65caf81db7 in boost::python::handle_exception<boost::python::objects::(anonymous namespace)::bind_return> () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#26 0x00002b65caf7ec9e in ?? () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#27 0x00002b65c935f033 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#28 0x00002b65c93da919 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#29 0x00002b65c93e06c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#30 0x00002b65c93e0702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#31 0x00002b65c9403561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#32 0x00002b65c93d78a4 in ?? () from /usr/lib/libpython2.5.so.1.0
#33 0x00002b65c93df8d5 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#34 0x00002b65c93e06c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#35 0x00002b65c93e0702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#36 0x00002b65c9403561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#37 0x00002b65c94037e8 in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#38 0x00002b65d6f42c1b in PythonUI::execScript (script=@0x7fffe17ad8d0) at gui/py/PythonUI.cpp:42
#39 0x00002b65d6f43ae2 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:92
#40 0x00002b65d6f442e2 in PythonUI::run (this=0x9c8710, argc=3, argv=0x7fffe17ae490) at gui/py/PythonUI.cpp:121
#41 0x0000000000570091 in main (argc=3, argv=0x7fffe17ae490) at core/yade.cpp:255
#0  0x0000003001095af5 in waitpid () from /lib/libc.so.6

################################################################################
TetraTestGen: generator CRASH
################################################################################
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
43520.3
194711
191169
4417.66
-46343.2
11996.2
yade-svn1371: /tmp/yade-29172/build-svn1371/include/yade-svn1371/yade/lib-multimethods/DynLibDispatcher.hpp:447: bool DynLibDispatcher<BaseClass, Executor, ResultType, TList, autoSymmetry>::locateMultivirtualFunctor2D(int&, int&, boost::shared_ptr<typename Loki::TL::TypeAtNonStrict<typename Loki::TL::Append<Loki::NullType, T>::Result, 0u, Loki::NullType>::Result>&, boost::shared_ptr<typename Loki::TL::TypeAtNonStrict<typename Loki::TL::Append<Loki::NullType, T>::Result, 1u, Loki::NullType>::Result>&) [with BaseClass = Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, Executor = BoundingVolumeEngineUnit, ResultType = void, TList = Loki::Typelist<const boost::shared_ptr<InteractingGeometry>&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<const Se3r&, Loki::Typelist<const Body*, Loki::NullType> > > >, bool autoSymmetry = true]: Assertion `index1 >= 0 && (unsigned int)( index1 ) < callBacks.size() && index2 >= 0 && (unsigned
  int)( index2 ) < callBacks[index1].size()' failed.
Running script /tmp/yade-test-31853.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1371/gdb_crash_batch-pid31958'
GNU gdb 6.6-debian
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Using host libthread_db library "/lib/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread 47267198800576 (LWP 31958)]
0x0000003001095af5 in waitpid () from /lib/libc.so.6
No symbol "info" in current context.

Thread 1 (Thread 47267198800576 (LWP 31958)):
#0  0x0000003001095af5 in waitpid () from /lib/libc.so.6
#1  0x000000300103c763 in ?? () from /lib/libc.so.6
#2  0x00000000005705f3 in sigHandler (sig=6) at core/yade.cpp:58
#3  <signal handler called>
#4  0x0000003001030cab in raise () from /lib/libc.so.6
#5  0x0000003001032660 in abort () from /lib/libc.so.6
#6  0x000000300102a436 in __assert_fail () from /lib/libc.so.6
#7  0x00002afd451f05e1 in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, BoundingVolumeEngineUnit, void, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Body const*, Loki::NullType> > > >, true>::locateMultivirtualFunctor2D (this=0xa4c2e0, index1=@0x7fff6dced04c, index2=@0x7fff6dced048, base1=@0xa51cf8, base2=@0xa51d08) at /tmp/yade-29172/build-svn1371/include/yade-svn1371/yade/lib-multimethods/DynLibDispatcher.hpp:446
#8  0x00002afd451f095b in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, BoundingVolumeEngineUnit, void, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Body const*, Loki::NullType> > > >, true>::operator() (this=0xa4c2e0, base1=@0xa51cf8, base2=@0xa51d08, p3=@0xa51eb0, p4=0xa51cb0) at /tmp/yade-29172/build-svn1371/include/yade-svn1371/yade/lib-multimethods/DynLibDispatcher.hpp:856
#9  0x00002afd451e5e25 in BoundingVolumeMetaEngine::action (this=0xa4c2a0, ncb=0xa4bf80) at pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine.cpp:27
#10 0x0000000000516bb5 in MetaBody::runInitializers (this=0xa4bf80) at core/MetaBody.cpp:43
#11 0x0000000000516c74 in MetaBody::postProcessAttributes (this=0xa4bf80, deserializing=false) at core/MetaBody.cpp:49
#12 0x00002afd3f0bf154 in Serializable::unregisterSerializableAttributes (this=0xa4bf80, deserializing=false) at lib/serialization/Serializable.cpp:29
#13 0x00002afd40b998a5 in XMLFormatManager::serializeSerializable (stream=@0x7fff6dced3e0, ac=@0xa55bc0, depth=1) at lib/serialization-xml/XMLFormatManager.cpp:168
#14 0x00002afd40b98258 in XMLFormatManager::serializeSmartPointer (stream=@0x7fff6dced3e0, ac=@0xa55b30, depth=1) at lib/serialization-xml/XMLFormatManager.cpp:284
#15 0x0000000000505c62 in IOFormatManager::saveToFile<boost::shared_ptr<MetaBody> > (libName=@0xa4bcc0, fileName=@0xa4bcb8, name=@0x7fff6dced8f0, t=@0xa4bca8) at /tmp/yade-29172/build-svn1371/include/yade-svn1371/yade/lib-serialization/IOFormatManager.tpp:59
#16 0x00000000004f161f in FileGenerator::generateAndSave (this=0xa4bc40) at core/FileGenerator.cpp:89
#17 0x00002afd63451110 in pyFileGenerator::generate (this=0xa4bde0, outFile=@0x7fff6dcedc50) at gui/py/yadeControl.cpp:263
#18 0x00002afd634339f7 in boost::python::detail::invoke<boost::python::to_python_value<bool const&>, bool (pyFileGenerator::*)(std::string), boost::python::arg_from_python<pyFileGenerator&>, boost::python::arg_from_python<std::string> > (rc=@0x7fff6dcedcee, f=@0xa46bb8, tc=@0x7fff6dcedcd0, ac0=@0x7fff6dcedcf0) at /usr/include/boost/python/detail/invoke.hpp:88
#19 0x00002afd63433b5a in boost::python::detail::caller_arity<2u>::impl<bool (pyFileGenerator::*)(std::string), boost::python::default_call_policies, boost::mpl::vector3<bool, pyFileGenerator&, std::string> >::operator() (this=0xa46bb8, args_=0x2afd40b77fc8) at /usr/include/boost/python/detail/caller.hpp:199
#20 0x00002afd63433c05 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<bool (pyFileGenerator::*)(std::string), boost::python::default_call_policies, boost::mpl::vector3<bool, pyFileGenerator&, std::string> > >::operator() (this=0xa46bb0, args=0x2afd40b77fc8, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#21 0x00002afd3ea4089d in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#22 0x00002afd3ea41825 in boost::detail::function::void_function_obj_invoker0<boost::python::objects::(anonymous namespace)::bind_return, void>::invoke () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#23 0x00002afd3d4ae8cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#24 0x00002afd3ea468f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#25 0x00002afd3ea40db7 in boost::python::handle_exception<boost::python::objects::(anonymous namespace)::bind_return> () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#26 0x00002afd3ea3dc9e in ?? () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#27 0x00002afd3ce1e033 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#28 0x00002afd3ce99919 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#29 0x00002afd3ce9f6c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#30 0x00002afd3ce9f702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#31 0x00002afd3cec2561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#32 0x00002afd3ce968a4 in ?? () from /usr/lib/libpython2.5.so.1.0
#33 0x00002afd3ce9e8d5 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#34 0x00002afd3ce9f6c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#35 0x00002afd3ce9f702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#36 0x00002afd3cec2561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#37 0x00002afd3cec27e8 in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#38 0x00002afd4aa01c1b in PythonUI::execScript (script=@0x7fff6dceee10) at gui/py/PythonUI.cpp:42
#39 0x00002afd4aa02ae2 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:92
#40 0x00002afd4aa032e2 in PythonUI::run (this=0x9c8710, argc=3, argv=0x7fff6dcef9d0) at gui/py/PythonUI.cpp:121
#41 0x0000000000570091 in main (argc=3, argv=0x7fff6dcef9d0) at core/yade.cpp:255
#0  0x0000003001095af5 in waitpid () from /lib/libc.so.6

################################################################################
ThreePointBending: simulation CRASH
################################################################################
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1371/gdb_crash_batch-pid31971'
GNU gdb 6.6-debian
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Using host libthread_db library "/lib/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread 47717948658368 (LWP 31971)]
[New Thread 1082132800 (LWP 31972)]
0x00000030010961d1 in nanosleep () from /lib/libc.so.6
No symbol "info" in current context.

Thread 2 (Thread 1082132800 (LWP 31972)):
#0  0x0000003001095b2f in waitpid () from /lib/libc.so.6
#1  0x000000300103c763 in ?? () from /lib/libc.so.6
#2  0x000000300103cad7 in system () from /lib/libc.so.6
#3  0x00000000005705f3 in sigHandler (sig=11) at core/yade.cpp:58
#4  <signal handler called>
#5  0x00000000005733c2 in BodyRedirectionVector::operator[] (this=0xa587c0, id=0) at core/DefaultContainerImplementations/BodyRedirectionVector.cpp:205
#6  0x00002b66454552f1 in TranslationEngine::applyCondition (this=0xa56490, ncb=0xa51e10) at pkg/common/Engine/DeusExMachina/TranslationEngine.cpp:38
#7  0x00000000004ead25 in DeusExMachina::action (this=0xa56490, b=0xa51e10) at core/DeusExMachina.cpp:20
#8  0x0000000000516a77 in MetaBody::moveToNextTimeStep (this=0xa51e10) at core/MetaBody.cpp:81
#9  0x0000000000567441 in SimulationFlow::singleAction (this=0x806600) at core/SimulationFlow.cpp:17
#10 0x000000000056920c in ThreadWorker::callSingleAction (this=0x806600) at core/ThreadWorker.cpp:71
#11 0x0000000000568939 in ThreadRunner::call (this=0xa4bda0) at core/ThreadRunner.cpp:42
#12 0x000000000056899d in ThreadRunner::run (this=0xa4bda0) at core/ThreadRunner.cpp:21
#13 0x0000000000568da9 in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0xa38550, p=0xa4bda0) at /usr/include/boost/bind/mem_fn_template.hpp:45
#14 0x0000000000568e2a in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0xa38560, f=@0xa38550, a=@0x4080004f) at /usr/include/boost/bind.hpp:230
#15 0x0000000000568e6d in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0xa38550) at /usr/include/boost/bind/bind_template.hpp:20
#16 0x0000000000568e92 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr={obj_ptr = 0xa38550, const_obj_ptr = 0xa38550, func_ptr = 0xa38550, data = "P"}) at /usr/include/boost/function/function_template.hpp:136
#17 0x00002b663013e8cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#18 0x00002b663013e2ef in ?? () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#19 0x00000030024062a5 in start_thread () from /lib/libpthread.so.0
#20 0x00000030010cf61d in clone () from /lib/libc.so.6
#21 0x0000000000000000 in ?? ()

Thread 1 (Thread 47717948658368 (LWP 31971)):
#0  0x00000030010961d1 in nanosleep () from /lib/libc.so.6
#1  0x00000030010c9134 in usleep () from /lib/libc.so.6
#2  0x00002b66560e64ee in pyOmega::wait (this=0xa38540) at gui/py/yadeControl.cpp:386
#3  0x00002b6656025c77 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0x98dde8, tc=@0x7fff7b05d070) at /usr/include/boost/python/detail/invoke.hpp:94
#4  0x00002b665607ce9c in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0x98dde8, args_=0x2b6633810990) at /usr/include/boost/python/detail/caller.hpp:199
#5  0x00002b665607cef5 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0x98dde0, args=0x2b6633810990, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#6  0x00002b66316d089d in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#7  0x00002b66316d1825 in boost::detail::function::void_function_obj_invoker0<boost::python::objects::(anonymous namespace)::bind_return, void>::invoke () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#8  0x00002b663013e8cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#9  0x00002b66316d68f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#10 0x00002b66316d0db7 in boost::python::handle_exception<boost::python::objects::(anonymous namespace)::bind_return> () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#11 0x00002b66316cdc9e in ?? () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#12 0x00002b662faae033 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#13 0x00002b662fb29919 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#14 0x00002b662fb2f6c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#15 0x00002b662fb2f702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#16 0x00002b662fb52561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#17 0x00002b662fb268a4 in ?? () from /usr/lib/libpython2.5.so.1.0
#18 0x00002b662fb2e8d5 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#19 0x00002b662fb2f6c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#20 0x00002b662fb2f702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#21 0x00002b662fb52561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#22 0x00002b662fb527e8 in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#23 0x00002b663d691c1b in PythonUI::execScript (script=@0x7fff7b05e180) at gui/py/PythonUI.cpp:42
#24 0x00002b663d692ae2 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:92
#25 0x00002b663d6932e2 in PythonUI::run (this=0x9c8710, argc=3, argv=0x7fff7b05ed40) at gui/py/PythonUI.cpp:121
#26 0x0000000000570091 in main (argc=3, argv=0x7fff7b05ed40) at core/yade.cpp:255
#0  0x00000030010961d1 in nanosleep () from /lib/libc.so.6


From dorofeenko at icp.ac.ru  Mon Jun  2 13:36:23 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Mon, 2 Jun 2008 15:36:23 +0400
Subject: [yade-dev] svn1370 unstable
In-Reply-To: <200805291225.57407.dorofeenko@icp.ac.ru>
References: <200805291225.57407.dorofeenko@icp.ac.ru>
Message-ID: <200806021536.23370.dorofeenko@icp.ac.ru>

Hi. I made a clear build but YADE still crashes.
I run yade-trunk simple-scene.py and click on the Controller button.
(I note that isDynamic of rootbody have wrong value, the file a.xml is attached).
(my system is amd64, openSUSE 10.2, gcc 4.1.2)
 I get:

==================
sega at sega:~/work/yade/trunk/scripts> yade-trunk simple-scene.py
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
Running script simple-scene.py
__   __    ____          ____                      _
\ \ / /_ _|  _ \  ___   / ___|___  _ __  ___  ___ | | ___
 \ V / _` | | | |/ _ \ | |   / _ \| '_ \/ __|/ _ \| |/ _ \
  | | (_| | |_| |  __/ | |__| (_) | | | \__ \ (_) | |  __/
  |_|\__,_|____/ \___|  \____\___/|_| |_|___/\___/|_|\___|


In [1]: Omega::instance().getSimulationFileName()=
yade-trunk: /home/sega/build/yade/build-trunk/include/yade-trunk/yade/lib-multimethods/DynLibDispatcher.hpp:322: bool DynLibDispatcher<BaseClass, Executor, ResultType, TList, autoSymmetry>::locateMultivirtualFunctor1D(int&, boost::shared_ptr<typename Loki::TL::TypeAtNonStrict<typename Loki::TL::Append<Loki::NullType, T>::Result, 0u, Loki::NullType>::Result>&) [with BaseClass = Loki::Typelist<PhysicalParameters, Loki::NullType>, Executor = PhysicalParametersEngineUnit, ResultType = void, TList = Loki::Typelist<const boost::shared_ptr<PhysicalParameters>&, Loki::Typelist<Body*, Loki::NullType> >, bool autoSymmetry = true]: ??????????? ??????????? `index >= 0 && (unsigned int)( index ) < callBacks.size()' ?? ?????????.
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/sega/.yade-trunk/gdb_crash_batch-pid7314'
GNU gdb 6.5
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "x86_64-suse-linux".
Using host libthread_db library "/lib64/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread 47532414684208 (LWP 7314)]
[New Thread 1091017024 (LWP 7465)]
[New Thread 1082149184 (LWP 7366)]
0x00002b3afc662302 in __select_nocancel () from /lib64/libc.so.6
No symbol "info" in current context.

Thread 3 (Thread 1082149184 (LWP 7366)):
#0  0x00002b3afc662302 in __select_nocancel () from /lib64/libc.so.6
#1  0x00002aaad0b124c5 in initreadline () from /usr/lib64/python2.5/lib-dynload/readline.so
#2  0x00002b3af8d98b4f in PyOS_Readline () from /usr/lib64/libpython2.5.so.1.0
#3  0x00002b3af8e04c74 in _PyBuiltin_Init () from /usr/lib64/libpython2.5.so.1.0
#4  0x00002b3af8e0e56a in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
#5  0x00002b3af8e0f5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
#6  0x00002b3af8e0dcd4 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
#7  0x00002b3af8e0f5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
#8  0x00002b3af8e0dcd4 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
#9  0x00002b3af8e0f5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
#10 0x00002b3af8e0dcd4 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
#11 0x00002b3af8e0f5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
#12 0x00002b3af8db7c48 in PyClassMethod_New () from /usr/lib64/libpython2.5.so.1.0
#13 0x00002b3af8d9ae13 in PyObject_Call () from /usr/lib64/libpython2.5.so.1.0
#14 0x00002b3af8da1ecd in PyClass_IsSubclass () from /usr/lib64/libpython2.5.so.1.0
#15 0x00002b3af8d9ae13 in PyObject_Call () from /usr/lib64/libpython2.5.so.1.0
#16 0x00002b3af8da293b in _PyInstance_Lookup () from /usr/lib64/libpython2.5.so.1.0
#17 0x00002b3af8d9ae13 in PyObject_Call () from /usr/lib64/libpython2.5.so.1.0
#18 0x00002b3af8e0b463 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
#19 0x00002b3af8e0f5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
#20 0x00002b3af8e0f5f2 in PyEval_EvalCode () from /usr/lib64/libpython2.5.so.1.0
#21 0x00002b3af8e28022 in Py_CompileString () from /usr/lib64/libpython2.5.so.1.0
#22 0x00002b3af8e280f6 in PyRun_FileExFlags () from /usr/lib64/libpython2.5.so.1.0
#23 0x00002b3af8e295b8 in PyRun_SimpleFileExFlags () from /usr/lib64/libpython2.5.so.1.0
#24 0x00002aaab50667d5 in PythonUI::execScript (script=@0x40803fd0) at gui/py/PythonUI.cpp:42
#25 0x00002aaab50676e8 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:92
#26 0x00002aaab494f6d1 in boost::detail::function::void_function_invoker0<void (*)(), void>::invoke (function_ptr=@0x408040a8) at /usr/local/include/boost/function/function_template.hpp:114
#27 0x00002b3af973754e in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/local/lib64/libboost_thread-gcc41-mt-1_34_1.so.1.34.1
#28 0x00002b3af9737202 in boost::thread_group::add_thread () from /usr/local/lib64/libboost_thread-gcc41-mt-1_34_1.so.1.34.1
#29 0x00002b3af90bc09e in start_thread () from /lib64/libpthread.so.0
#30 0x00002b3afc6684cd in clone () from /lib64/libc.so.6
#31 0x0000000000000000 in ?? ()

Thread 2 (Thread 1091017024 (LWP 7465)):
#0  0x00002b3afc639e1f in waitpid () from /lib64/libc.so.6
#1  0x00002b3afc5e2491 in do_system () from /lib64/libc.so.6
#2  0x00002b3afc5e2817 in system () from /lib64/libc.so.6
#3  0x000000000056f82b in sigHandler (sig=6) at core/yade.cpp:58
#4  <signal handler called>
#5  0x00002b3afc5d7535 in raise () from /lib64/libc.so.6
#6  0x00002b3afc5d8990 in abort () from /lib64/libc.so.6
#7  0x00002b3afc5d0c16 in __assert_fail () from /lib64/libc.so.6
#8  0x00002aaaae3407fe in DynLibDispatcher<Loki::Typelist<PhysicalParameters, Loki::NullType>, PhysicalParametersEngineUnit, void, Loki::Typelist<boost::shared_ptr<PhysicalParameters> const&, Loki::Typelist<Body*, Loki::NullType> >, true>::locateMultivirtualFunctor1D (this=0xa4d0c0, index=@0x41078dac, base=@0x94cc88) at /home/sega/build/yade/build-trunk/include/yade-trunk/yade/lib-multimethods/DynLibDispatcher.hpp:322
#9  0x00002aaaae3409fd in DynLibDispatcher<Loki::Typelist<PhysicalParameters, Loki::NullType>, PhysicalParametersEngineUnit, void, Loki::Typelist<boost::shared_ptr<PhysicalParameters> const&, Loki::Typelist<Body*, Loki::NullType> >, true>::operator() (this=0xa4d0c0, base=@0x94cc88, p2=0x94cc60) at /home/sega/build/yade/build-trunk/include/yade-trunk/yade/lib-multimethods/DynLibDispatcher.hpp:537
#10 0x00002aaaae32d1ee in PhysicalParametersMetaEngine::action (this=0xa4d080, ncb=0x94cc60) at pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine.cpp:27
#11 0x00000000005105a3 in MetaBody::moveToNextTimeStep (this=0x94cc60) at core/MetaBody.cpp:81
#12 0x00000000005664b9 in SimulationFlow::singleAction (this=0x80dd60) at core/SimulationFlow.cpp:17
#13 0x0000000000568344 in ThreadWorker::callSingleAction (this=0x80dd60) at core/ThreadWorker.cpp:71
#14 0x0000000000567a25 in ThreadRunner::call (this=0xa45770) at core/ThreadRunner.cpp:42
#15 0x0000000000567a89 in ThreadRunner::run (this=0xa45770) at core/ThreadRunner.cpp:21
#16 0x0000000000567f9d in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x410790a8, p=0xa45770) at /usr/local/include/boost/bind/mem_fn_template.hpp:49
#17 0x000000000056801e in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x410790b8, f=@0x410790a8, a=@0x4107900f) at /usr/local/include/boost/bind.hpp:231
#18 0x0000000000568061 in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x410790a8) at /usr/local/include/boost/bind/bind_template.hpp:20
#19 0x0000000000568086 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x410790a8) at /usr/local/include/boost/function/function_template.hpp:155
#20 0x00002b3af973754e in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/local/lib64/libboost_thread-gcc41-mt-1_34_1.so.1.34.1
#21 0x00002b3af9737202 in boost::thread_group::add_thread () from /usr/local/lib64/libboost_thread-gcc41-mt-1_34_1.so.1.34.1
#22 0x00002b3af90bc09e in start_thread () from /lib64/libpthread.so.0
#23 0x00002b3afc6684cd in clone () from /lib64/libc.so.6
#24 0x0000000000000000 in ?? ()

Thread 1 (Thread 47532414684208 (LWP 7314)):
#0  0x00002b3afc662302 in __select_nocancel () from /lib64/libc.so.6
#1  0x00002b3af9ffd24b in QEventLoop::processEvents () from /usr/lib64/libqt-mt.so.3
#2  0x00002b3afa05b963 in QEventLoop::enterLoop () from /usr/lib64/libqt-mt.so.3
#3  0x00002b3afa05b812 in QEventLoop::exec () from /usr/lib64/libqt-mt.so.3
#4  0x00002aaab494eccb in QtGUI::run (this=0x93e110, argc=2, argv=0x7fffb1f66e88) at gui/qt3/QtGUI.cpp:72
#5  0x000000000056f2f0 in main (argc=2, argv=0x7fffb1f66e88) at core/yade.cpp:255
#0  0x00002b3afc662302 in __select_nocancel () from /lib64/libc.so.6
=======================
-- 
Best regards, Sergei D.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: a.xml.gz
Type: application/x-gzip
Size: 1303 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080602/7b1101d8/attachment.bin>

From eudoxos at arcig.cz  Mon Jun  2 17:43:46 2008
From: eudoxos at arcig.cz (=?UTF-8?B?VsOhY2xhdiDFoG1pbGF1ZXI=?=)
Date: Mon, 02 Jun 2008 17:43:46 +0200
Subject: [yade-dev] svn1370 unstable
In-Reply-To: <200806021536.23370.dorofeenko@icp.ac.ru>
References: <200805291225.57407.dorofeenko@icp.ac.ru>
	<200806021536.23370.dorofeenko@icp.ac.ru>
Message-ID: <48441532.2050506@arcig.cz>

It is fixed in last SVN. I bumped into it today as well: for some
reason, PhysicalParametersMetaEngine wants rootBody to have
ParticleParameters, not PhysicalParameters (bug?). Please confirm that
it works now as expected. Thanks.

Vaclav
> Hi. I made a clear build but YADE still crashes.
> I run yade-trunk simple-scene.py and click on the Controller button.
> (I note that isDynamic of rootbody have wrong value, the file a.xml is attached).
> (my system is amd64, openSUSE 10.2, gcc 4.1.2)
>  I get:
>
> ==================
> sega at sega:~/work/yade/trunk/scripts> yade-trunk simple-scene.py
> Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
> Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
> WARNING: cannot open file used for capillary law, in TriaxalTestWater
> Running script simple-scene.py
> __   __    ____          ____                      _
> \ \ / /_ _|  _ \  ___   / ___|___  _ __  ___  ___ | | ___
>  \ V / _` | | | |/ _ \ | |   / _ \| '_ \/ __|/ _ \| |/ _ \
>   | | (_| | |_| |  __/ | |__| (_) | | | \__ \ (_) | |  __/
>   |_|\__,_|____/ \___|  \____\___/|_| |_|___/\___/|_|\___|
>
>
> In [1]: Omega::instance().getSimulationFileName()=
> yade-trunk: /home/sega/build/yade/build-trunk/include/yade-trunk/yade/lib-multimethods/DynLibDispatcher.hpp:322: bool DynLibDispatcher<BaseClass, Executor, ResultType, TList, autoSymmetry>::locateMultivirtualFunctor1D(int&, boost::shared_ptr<typename Loki::TL::TypeAtNonStrict<typename Loki::TL::Append<Loki::NullType, T>::Result, 0u, Loki::NullType>::Result>&) [with BaseClass = Loki::Typelist<PhysicalParameters, Loki::NullType>, Executor = PhysicalParametersEngineUnit, ResultType = void, TList = Loki::Typelist<const boost::shared_ptr<PhysicalParameters>&, Loki::Typelist<Body*, Loki::NullType> >, bool autoSymmetry = true]: ??????????? ??????????? `index >= 0 && (unsigned int)( index ) < callBacks.size()' ?? ?????????.
> SIGSEGV/SIGABRT handler called; gdb batch file is `/home/sega/.yade-trunk/gdb_crash_batch-pid7314'
> GNU gdb 6.5
> Copyright (C) 2006 Free Software Foundation, Inc.
> GDB is free software, covered by the GNU General Public License, and you are
> welcome to change it and/or distribute copies of it under certain conditions.
> Type "show copying" to see the conditions.
> There is absolutely no warranty for GDB.  Type "show warranty" for details.
> This GDB was configured as "x86_64-suse-linux".
> Using host libthread_db library "/lib64/libthread_db.so.1".
> [Thread debugging using libthread_db enabled]
> [New Thread 47532414684208 (LWP 7314)]
> [New Thread 1091017024 (LWP 7465)]
> [New Thread 1082149184 (LWP 7366)]
> 0x00002b3afc662302 in __select_nocancel () from /lib64/libc.so.6
> No symbol "info" in current context.
>
> Thread 3 (Thread 1082149184 (LWP 7366)):
> #0  0x00002b3afc662302 in __select_nocancel () from /lib64/libc.so.6
> #1  0x00002aaad0b124c5 in initreadline () from /usr/lib64/python2.5/lib-dynload/readline.so
> #2  0x00002b3af8d98b4f in PyOS_Readline () from /usr/lib64/libpython2.5.so.1.0
> #3  0x00002b3af8e04c74 in _PyBuiltin_Init () from /usr/lib64/libpython2.5.so.1.0
> #4  0x00002b3af8e0e56a in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
> #5  0x00002b3af8e0f5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
> #6  0x00002b3af8e0dcd4 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
> #7  0x00002b3af8e0f5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
> #8  0x00002b3af8e0dcd4 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
> #9  0x00002b3af8e0f5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
> #10 0x00002b3af8e0dcd4 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
> #11 0x00002b3af8e0f5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
> #12 0x00002b3af8db7c48 in PyClassMethod_New () from /usr/lib64/libpython2.5.so.1.0
> #13 0x00002b3af8d9ae13 in PyObject_Call () from /usr/lib64/libpython2.5.so.1.0
> #14 0x00002b3af8da1ecd in PyClass_IsSubclass () from /usr/lib64/libpython2.5.so.1.0
> #15 0x00002b3af8d9ae13 in PyObject_Call () from /usr/lib64/libpython2.5.so.1.0
> #16 0x00002b3af8da293b in _PyInstance_Lookup () from /usr/lib64/libpython2.5.so.1.0
> #17 0x00002b3af8d9ae13 in PyObject_Call () from /usr/lib64/libpython2.5.so.1.0
> #18 0x00002b3af8e0b463 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
> #19 0x00002b3af8e0f5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
> #20 0x00002b3af8e0f5f2 in PyEval_EvalCode () from /usr/lib64/libpython2.5.so.1.0
> #21 0x00002b3af8e28022 in Py_CompileString () from /usr/lib64/libpython2.5.so.1.0
> #22 0x00002b3af8e280f6 in PyRun_FileExFlags () from /usr/lib64/libpython2.5.so.1.0
> #23 0x00002b3af8e295b8 in PyRun_SimpleFileExFlags () from /usr/lib64/libpython2.5.so.1.0
> #24 0x00002aaab50667d5 in PythonUI::execScript (script=@0x40803fd0) at gui/py/PythonUI.cpp:42
> #25 0x00002aaab50676e8 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:92
> #26 0x00002aaab494f6d1 in boost::detail::function::void_function_invoker0<void (*)(), void>::invoke (function_ptr=@0x408040a8) at /usr/local/include/boost/function/function_template.hpp:114
> #27 0x00002b3af973754e in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/local/lib64/libboost_thread-gcc41-mt-1_34_1.so.1.34.1
> #28 0x00002b3af9737202 in boost::thread_group::add_thread () from /usr/local/lib64/libboost_thread-gcc41-mt-1_34_1.so.1.34.1
> #29 0x00002b3af90bc09e in start_thread () from /lib64/libpthread.so.0
> #30 0x00002b3afc6684cd in clone () from /lib64/libc.so.6
> #31 0x0000000000000000 in ?? ()
>
> Thread 2 (Thread 1091017024 (LWP 7465)):
> #0  0x00002b3afc639e1f in waitpid () from /lib64/libc.so.6
> #1  0x00002b3afc5e2491 in do_system () from /lib64/libc.so.6
> #2  0x00002b3afc5e2817 in system () from /lib64/libc.so.6
> #3  0x000000000056f82b in sigHandler (sig=6) at core/yade.cpp:58
> #4  <signal handler called>
> #5  0x00002b3afc5d7535 in raise () from /lib64/libc.so.6
> #6  0x00002b3afc5d8990 in abort () from /lib64/libc.so.6
> #7  0x00002b3afc5d0c16 in __assert_fail () from /lib64/libc.so.6
> #8  0x00002aaaae3407fe in DynLibDispatcher<Loki::Typelist<PhysicalParameters, Loki::NullType>, PhysicalParametersEngineUnit, void, Loki::Typelist<boost::shared_ptr<PhysicalParameters> const&, Loki::Typelist<Body*, Loki::NullType> >, true>::locateMultivirtualFunctor1D (this=0xa4d0c0, index=@0x41078dac, base=@0x94cc88) at /home/sega/build/yade/build-trunk/include/yade-trunk/yade/lib-multimethods/DynLibDispatcher.hpp:322
> #9  0x00002aaaae3409fd in DynLibDispatcher<Loki::Typelist<PhysicalParameters, Loki::NullType>, PhysicalParametersEngineUnit, void, Loki::Typelist<boost::shared_ptr<PhysicalParameters> const&, Loki::Typelist<Body*, Loki::NullType> >, true>::operator() (this=0xa4d0c0, base=@0x94cc88, p2=0x94cc60) at /home/sega/build/yade/build-trunk/include/yade-trunk/yade/lib-multimethods/DynLibDispatcher.hpp:537
> #10 0x00002aaaae32d1ee in PhysicalParametersMetaEngine::action (this=0xa4d080, ncb=0x94cc60) at pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine.cpp:27
> #11 0x00000000005105a3 in MetaBody::moveToNextTimeStep (this=0x94cc60) at core/MetaBody.cpp:81
> #12 0x00000000005664b9 in SimulationFlow::singleAction (this=0x80dd60) at core/SimulationFlow.cpp:17
> #13 0x0000000000568344 in ThreadWorker::callSingleAction (this=0x80dd60) at core/ThreadWorker.cpp:71
> #14 0x0000000000567a25 in ThreadRunner::call (this=0xa45770) at core/ThreadRunner.cpp:42
> #15 0x0000000000567a89 in ThreadRunner::run (this=0xa45770) at core/ThreadRunner.cpp:21
> #16 0x0000000000567f9d in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x410790a8, p=0xa45770) at /usr/local/include/boost/bind/mem_fn_template.hpp:49
> #17 0x000000000056801e in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x410790b8, f=@0x410790a8, a=@0x4107900f) at /usr/local/include/boost/bind.hpp:231
> #18 0x0000000000568061 in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x410790a8) at /usr/local/include/boost/bind/bind_template.hpp:20
> #19 0x0000000000568086 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x410790a8) at /usr/local/include/boost/function/function_template.hpp:155
> #20 0x00002b3af973754e in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/local/lib64/libboost_thread-gcc41-mt-1_34_1.so.1.34.1
> #21 0x00002b3af9737202 in boost::thread_group::add_thread () from /usr/local/lib64/libboost_thread-gcc41-mt-1_34_1.so.1.34.1
> #22 0x00002b3af90bc09e in start_thread () from /lib64/libpthread.so.0
> #23 0x00002b3afc6684cd in clone () from /lib64/libc.so.6
> #24 0x0000000000000000 in ?? ()
>
> Thread 1 (Thread 47532414684208 (LWP 7314)):
> #0  0x00002b3afc662302 in __select_nocancel () from /lib64/libc.so.6
> #1  0x00002b3af9ffd24b in QEventLoop::processEvents () from /usr/lib64/libqt-mt.so.3
> #2  0x00002b3afa05b963 in QEventLoop::enterLoop () from /usr/lib64/libqt-mt.so.3
> #3  0x00002b3afa05b812 in QEventLoop::exec () from /usr/lib64/libqt-mt.so.3
> #4  0x00002aaab494eccb in QtGUI::run (this=0x93e110, argc=2, argv=0x7fffb1f66e88) at gui/qt3/QtGUI.cpp:72
> #5  0x000000000056f2f0 in main (argc=2, argv=0x7fffb1f66e88) at core/yade.cpp:255
> #0  0x00002b3afc662302 in __select_nocancel () from /lib64/libc.so.6
> =======================
>   
> ------------------------------------------------------------------------
>
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>   



From dorofeenko at icp.ac.ru  Tue Jun  3 12:03:33 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Tue, 3 Jun 2008 14:03:33 +0400
Subject: [yade-dev] svn1372 crash
Message-ID: <200806031403.34371.dorofeenko@icp.ac.ru>

I clicked on SimulationPlayer's Open-simulation-file button  and get crash:

sega at sega:~/YADE/data> yade-trunk
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
__   __    ____          ____                      _
\ \ / /_ _|  _ \  ___   / ___|___  _ __  ___  ___ | | ___
 \ V / _` | | | |/ _ \ | |   / _ \| '_ \/ __|/ _ \| |/ _ \
  | | (_| | |_| |  __/ | |__| (_) | | | \__ \ (_) | |  __/
  |_|\__,_|____/ \___|  \____\___/|_| |_|___/\___/|_|\___|


In [1]: QtSimulationPlayer
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/sega/.yade-trunk/gdb_crash_batch-pid1358'
GNU gdb 6.5
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "x86_64-suse-linux".
Using host libthread_db library "/lib64/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread 47636875512880 (LWP 1358)]
[New Thread 1082149184 (LWP 1414)]
0x00002b534ebd5e1f in waitpid () from /lib64/libc.so.6
No symbol "info" in current context.

Thread 2 (Thread 1082149184 (LWP 1414)):
#0  0x00002b534ebfe302 in __select_nocancel () from /lib64/libc.so.6
#1  0x00002aaad4bfc4c5 in initreadline () from /usr/lib64/python2.5/lib-dynload/readline.so
#2  0x00002b534b334b4f in PyOS_Readline () from /usr/lib64/libpython2.5.so.1.0
#3  0x00002b534b3a0c74 in _PyBuiltin_Init () from /usr/lib64/libpython2.5.so.1.0
#4  0x00002b534b3aa56a in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
#5  0x00002b534b3ab5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
#6  0x00002b534b3a9cd4 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
#7  0x00002b534b3ab5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
#8  0x00002b534b3a9cd4 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
#9  0x00002b534b3ab5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
#10 0x00002b534b3a9cd4 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
#11 0x00002b534b3ab5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
#12 0x00002b534b353c48 in PyClassMethod_New () from /usr/lib64/libpython2.5.so.1.0
#13 0x00002b534b336e13 in PyObject_Call () from /usr/lib64/libpython2.5.so.1.0
#14 0x00002b534b33decd in PyClass_IsSubclass () from /usr/lib64/libpython2.5.so.1.0
#15 0x00002b534b336e13 in PyObject_Call () from /usr/lib64/libpython2.5.so.1.0
#16 0x00002b534b33e93b in _PyInstance_Lookup () from /usr/lib64/libpython2.5.so.1.0
#17 0x00002b534b336e13 in PyObject_Call () from /usr/lib64/libpython2.5.so.1.0
#18 0x00002b534b3a7463 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
#19 0x00002b534b3ab5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
#20 0x00002b534b3ab5f2 in PyEval_EvalCode () from /usr/lib64/libpython2.5.so.1.0
#21 0x00002b534b3c4022 in Py_CompileString () from /usr/lib64/libpython2.5.so.1.0
#22 0x00002b534b3c40f6 in PyRun_FileExFlags () from /usr/lib64/libpython2.5.so.1.0
#23 0x00002b534b3c55b8 in PyRun_SimpleFileExFlags () from /usr/lib64/libpython2.5.so.1.0
#24 0x00002aaab50667d5 in PythonUI::execScript (script=@0x40803fd0) at gui/py/PythonUI.cpp:42
#25 0x00002aaab50676e8 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:92
#26 0x00002aaab494f771 in boost::detail::function::void_function_invoker0<void (*)(), void>::invoke (function_ptr=@0x408040a8) at /usr/local/include/boost/function/function_template.hpp:114
#27 0x00002b534bcd354e in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/local/lib64/libboost_thread-gcc41-mt-1_34_1.so.1.34.1
#28 0x00002b534bcd3202 in boost::thread_group::add_thread () from /usr/local/lib64/libboost_thread-gcc41-mt-1_34_1.so.1.34.1
#29 0x00002b534b65809e in start_thread () from /lib64/libpthread.so.0
#30 0x00002b534ec044cd in clone () from /lib64/libc.so.6
#31 0x0000000000000000 in ?? ()

Thread 1 (Thread 47636875512880 (LWP 1358)):
#0  0x00002b534ebd5e1f in waitpid () from /lib64/libc.so.6
#1  0x00002b534eb7e491 in do_system () from /lib64/libc.so.6
#2  0x00002b534eb7e817 in system () from /lib64/libc.so.6
#3  0x000000000056f82b in sigHandler (sig=11) at core/yade.cpp:58
#4  <signal handler called>
#5  0x00002aaab49242ea in QObject::parent (this=0x0) at /usr/lib/qt3/include/qobject.h:154
#6  0x00002aaab49244ad in QWidget::parentWidget (this=0x0, sameWindow=false) at /usr/lib/qt3/include/qwidget.h:878
#7  0x00002aaab49882b0 in QtSimulationPlayer::pbInputConfigFileClicked (this=0x2aaad0006110) at gui/qt3/QtSimulationPlayer.cpp:33
#8  0x00002aaab4985e90 in QtGeneratedSimulationPlayer::qt_invoke (this=0x2aaad0006110, _id=58, _o=0x7fff5f9c96d0) at /home/sega/build/yade/build-trunk/gui/qt3/moc_QtGeneratedSimulationPlayer.cc:110
#9  0x00002b534c639adc in QObject::activate_signal () from /usr/lib64/libqt-mt.so.3
#10 0x00002b534c63a7b3 in QObject::activate_signal () from /usr/lib64/libqt-mt.so.3
#11 0x00002b534c66c7b7 in QWidget::event () from /usr/lib64/libqt-mt.so.3
#12 0x00002b534c5e2eb5 in QApplication::internalNotify () from /usr/lib64/libqt-mt.so.3
#13 0x00002b534c5e3df1 in QApplication::notify () from /usr/lib64/libqt-mt.so.3
#14 0x00002b534c58b399 in QETWidget::translateMouseEvent () from /usr/lib64/libqt-mt.so.3
#15 0x00002b534c58a3f3 in QApplication::x11ProcessEvent () from /usr/lib64/libqt-mt.so.3
#16 0x00002b534c59940f in QEventLoop::processEvents () from /usr/lib64/libqt-mt.so.3
#17 0x00002b534c5f7963 in QEventLoop::enterLoop () from /usr/lib64/libqt-mt.so.3
#18 0x00002b534c5f7812 in QEventLoop::exec () from /usr/lib64/libqt-mt.so.3
#19 0x00002aaab494ed6b in QtGUI::run (this=0x8d6b20, argc=1, argv=0x7fff5f9ca8e8) at gui/qt3/QtGUI.cpp:72
#20 0x000000000056f2f0 in main (argc=1, argv=0x7fff5f9ca8e8) at core/yade.cpp:255
#0  0x00002b534ebd5e1f in waitpid () from /lib64/libc.so.6
Segmentation fault

-- 
Best regards, Sergei D.


From bruno.chareyre at hmg.inpg.fr  Tue Jun  3 15:47:04 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Tue, 03 Jun 2008 15:47:04 +0200
Subject: [yade-dev] svn1372 crash
In-Reply-To: <200806031403.34371.dorofeenko@icp.ac.ru>
References: <200806031403.34371.dorofeenko@icp.ac.ru>
Message-ID: <48454B58.1060600@hmg.inpg.fr>

Hello

I've not updated Yade for few days or weeks and I'm a bit lost right now...
It looks like the QtGui has change a lot in my current (not latest) 
version, not bad, but I have problems to enlarge windows to a convenient 
size. Also, I can't turn the timestep to "automatic" for some reason.
I will update and see if its better, but as I see many people have 
problems, does somebody know which is the last stable version? I need to 
test it on our brand new server.

Bruno



sega a ?crit :
> I clicked on SimulationPlayer's Open-simulation-file button  and get crash:
>
> sega at sega:~/YADE/data> yade-trunk
> Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
> Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
> WARNING: cannot open file used for capillary law, in TriaxalTestWater
> __   __    ____          ____                      _
> \ \ / /_ _|  _ \  ___   / ___|___  _ __  ___  ___ | | ___
>  \ V / _` | | | |/ _ \ | |   / _ \| '_ \/ __|/ _ \| |/ _ \
>   | | (_| | |_| |  __/ | |__| (_) | | | \__ \ (_) | |  __/
>   |_|\__,_|____/ \___|  \____\___/|_| |_|___/\___/|_|\___|
>
>
> In [1]: QtSimulationPlayer
> SIGSEGV/SIGABRT handler called; gdb batch file is `/home/sega/.yade-trunk/gdb_crash_batch-pid1358'
> GNU gdb 6.5
> Copyright (C) 2006 Free Software Foundation, Inc.
> GDB is free software, covered by the GNU General Public License, and you are
> welcome to change it and/or distribute copies of it under certain conditions.
> Type "show copying" to see the conditions.
> There is absolutely no warranty for GDB.  Type "show warranty" for details.
> This GDB was configured as "x86_64-suse-linux".
> Using host libthread_db library "/lib64/libthread_db.so.1".
> [Thread debugging using libthread_db enabled]
> [New Thread 47636875512880 (LWP 1358)]
> [New Thread 1082149184 (LWP 1414)]
> 0x00002b534ebd5e1f in waitpid () from /lib64/libc.so.6
> No symbol "info" in current context.
>
> Thread 2 (Thread 1082149184 (LWP 1414)):
> #0  0x00002b534ebfe302 in __select_nocancel () from /lib64/libc.so.6
> #1  0x00002aaad4bfc4c5 in initreadline () from /usr/lib64/python2.5/lib-dynload/readline.so
> #2  0x00002b534b334b4f in PyOS_Readline () from /usr/lib64/libpython2.5.so.1.0
> #3  0x00002b534b3a0c74 in _PyBuiltin_Init () from /usr/lib64/libpython2.5.so.1.0
> #4  0x00002b534b3aa56a in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
> #5  0x00002b534b3ab5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
> #6  0x00002b534b3a9cd4 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
> #7  0x00002b534b3ab5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
> #8  0x00002b534b3a9cd4 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
> #9  0x00002b534b3ab5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
> #10 0x00002b534b3a9cd4 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
> #11 0x00002b534b3ab5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
> #12 0x00002b534b353c48 in PyClassMethod_New () from /usr/lib64/libpython2.5.so.1.0
> #13 0x00002b534b336e13 in PyObject_Call () from /usr/lib64/libpython2.5.so.1.0
> #14 0x00002b534b33decd in PyClass_IsSubclass () from /usr/lib64/libpython2.5.so.1.0
> #15 0x00002b534b336e13 in PyObject_Call () from /usr/lib64/libpython2.5.so.1.0
> #16 0x00002b534b33e93b in _PyInstance_Lookup () from /usr/lib64/libpython2.5.so.1.0
> #17 0x00002b534b336e13 in PyObject_Call () from /usr/lib64/libpython2.5.so.1.0
> #18 0x00002b534b3a7463 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
> #19 0x00002b534b3ab5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
> #20 0x00002b534b3ab5f2 in PyEval_EvalCode () from /usr/lib64/libpython2.5.so.1.0
> #21 0x00002b534b3c4022 in Py_CompileString () from /usr/lib64/libpython2.5.so.1.0
> #22 0x00002b534b3c40f6 in PyRun_FileExFlags () from /usr/lib64/libpython2.5.so.1.0
> #23 0x00002b534b3c55b8 in PyRun_SimpleFileExFlags () from /usr/lib64/libpython2.5.so.1.0
> #24 0x00002aaab50667d5 in PythonUI::execScript (script=@0x40803fd0) at gui/py/PythonUI.cpp:42
> #25 0x00002aaab50676e8 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:92
> #26 0x00002aaab494f771 in boost::detail::function::void_function_invoker0<void (*)(), void>::invoke (function_ptr=@0x408040a8) at /usr/local/include/boost/function/function_template.hpp:114
> #27 0x00002b534bcd354e in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/local/lib64/libboost_thread-gcc41-mt-1_34_1.so.1.34.1
> #28 0x00002b534bcd3202 in boost::thread_group::add_thread () from /usr/local/lib64/libboost_thread-gcc41-mt-1_34_1.so.1.34.1
> #29 0x00002b534b65809e in start_thread () from /lib64/libpthread.so.0
> #30 0x00002b534ec044cd in clone () from /lib64/libc.so.6
> #31 0x0000000000000000 in ?? ()
>
> Thread 1 (Thread 47636875512880 (LWP 1358)):
> #0  0x00002b534ebd5e1f in waitpid () from /lib64/libc.so.6
> #1  0x00002b534eb7e491 in do_system () from /lib64/libc.so.6
> #2  0x00002b534eb7e817 in system () from /lib64/libc.so.6
> #3  0x000000000056f82b in sigHandler (sig=11) at core/yade.cpp:58
> #4  <signal handler called>
> #5  0x00002aaab49242ea in QObject::parent (this=0x0) at /usr/lib/qt3/include/qobject.h:154
> #6  0x00002aaab49244ad in QWidget::parentWidget (this=0x0, sameWindow=false) at /usr/lib/qt3/include/qwidget.h:878
> #7  0x00002aaab49882b0 in QtSimulationPlayer::pbInputConfigFileClicked (this=0x2aaad0006110) at gui/qt3/QtSimulationPlayer.cpp:33
> #8  0x00002aaab4985e90 in QtGeneratedSimulationPlayer::qt_invoke (this=0x2aaad0006110, _id=58, _o=0x7fff5f9c96d0) at /home/sega/build/yade/build-trunk/gui/qt3/moc_QtGeneratedSimulationPlayer.cc:110
> #9  0x00002b534c639adc in QObject::activate_signal () from /usr/lib64/libqt-mt.so.3
> #10 0x00002b534c63a7b3 in QObject::activate_signal () from /usr/lib64/libqt-mt.so.3
> #11 0x00002b534c66c7b7 in QWidget::event () from /usr/lib64/libqt-mt.so.3
> #12 0x00002b534c5e2eb5 in QApplication::internalNotify () from /usr/lib64/libqt-mt.so.3
> #13 0x00002b534c5e3df1 in QApplication::notify () from /usr/lib64/libqt-mt.so.3
> #14 0x00002b534c58b399 in QETWidget::translateMouseEvent () from /usr/lib64/libqt-mt.so.3
> #15 0x00002b534c58a3f3 in QApplication::x11ProcessEvent () from /usr/lib64/libqt-mt.so.3
> #16 0x00002b534c59940f in QEventLoop::processEvents () from /usr/lib64/libqt-mt.so.3
> #17 0x00002b534c5f7963 in QEventLoop::enterLoop () from /usr/lib64/libqt-mt.so.3
> #18 0x00002b534c5f7812 in QEventLoop::exec () from /usr/lib64/libqt-mt.so.3
> #19 0x00002aaab494ed6b in QtGUI::run (this=0x8d6b20, argc=1, argv=0x7fff5f9ca8e8) at gui/qt3/QtGUI.cpp:72
> #20 0x000000000056f2f0 in main (argc=1, argv=0x7fff5f9ca8e8) at core/yade.cpp:255
> #0  0x00002b534ebd5e1f in waitpid () from /lib64/libc.so.6
> Segmentation fault
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Tue Jun  3 15:53:42 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Tue, 03 Jun 2008 15:53:42 +0200
Subject: [yade-dev] svn1372 crash
In-Reply-To: <48454B58.1060600@hmg.inpg.fr>
References: <200806031403.34371.dorofeenko@icp.ac.ru>
	<48454B58.1060600@hmg.inpg.fr>
Message-ID: <48454CE6.3000908@hmg.inpg.fr>


This result in a crash :
start Yade -> Player -> Simulation file -> browse

Bruno



Bruno Chareyre a ?crit :
> Hello
>
> I've not updated Yade for few days or weeks and I'm a bit lost right now...
> It looks like the QtGui has change a lot in my current (not latest) 
> version, not bad, but I have problems to enlarge windows to a convenient 
> size. Also, I can't turn the timestep to "automatic" for some reason.
> I will update and see if its better, but as I see many people have 
> problems, does somebody know which is the last stable version? I need to 
> test it on our brand new server.
>
> Bruno
>
>
>
> sega a ?crit :
>   
>> I clicked on SimulationPlayer's Open-simulation-file button  and get crash:
>>
>> sega at sega:~/YADE/data> yade-trunk
>> Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
>> Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
>> WARNING: cannot open file used for capillary law, in TriaxalTestWater
>> __   __    ____          ____                      _
>> \ \ / /_ _|  _ \  ___   / ___|___  _ __  ___  ___ | | ___
>>  \ V / _` | | | |/ _ \ | |   / _ \| '_ \/ __|/ _ \| |/ _ \
>>   | | (_| | |_| |  __/ | |__| (_) | | | \__ \ (_) | |  __/
>>   |_|\__,_|____/ \___|  \____\___/|_| |_|___/\___/|_|\___|
>>
>>
>> In [1]: QtSimulationPlayer
>> SIGSEGV/SIGABRT handler called; gdb batch file is `/home/sega/.yade-trunk/gdb_crash_batch-pid1358'
>> GNU gdb 6.5
>> Copyright (C) 2006 Free Software Foundation, Inc.
>> GDB is free software, covered by the GNU General Public License, and you are
>> welcome to change it and/or distribute copies of it under certain conditions.
>> Type "show copying" to see the conditions.
>> There is absolutely no warranty for GDB.  Type "show warranty" for details.
>> This GDB was configured as "x86_64-suse-linux".
>> Using host libthread_db library "/lib64/libthread_db.so.1".
>> [Thread debugging using libthread_db enabled]
>> [New Thread 47636875512880 (LWP 1358)]
>> [New Thread 1082149184 (LWP 1414)]
>> 0x00002b534ebd5e1f in waitpid () from /lib64/libc.so.6
>> No symbol "info" in current context.
>>
>> Thread 2 (Thread 1082149184 (LWP 1414)):
>> #0  0x00002b534ebfe302 in __select_nocancel () from /lib64/libc.so.6
>> #1  0x00002aaad4bfc4c5 in initreadline () from /usr/lib64/python2.5/lib-dynload/readline.so
>> #2  0x00002b534b334b4f in PyOS_Readline () from /usr/lib64/libpython2.5.so.1.0
>> #3  0x00002b534b3a0c74 in _PyBuiltin_Init () from /usr/lib64/libpython2.5.so.1.0
>> #4  0x00002b534b3aa56a in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
>> #5  0x00002b534b3ab5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
>> #6  0x00002b534b3a9cd4 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
>> #7  0x00002b534b3ab5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
>> #8  0x00002b534b3a9cd4 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
>> #9  0x00002b534b3ab5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
>> #10 0x00002b534b3a9cd4 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
>> #11 0x00002b534b3ab5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
>> #12 0x00002b534b353c48 in PyClassMethod_New () from /usr/lib64/libpython2.5.so.1.0
>> #13 0x00002b534b336e13 in PyObject_Call () from /usr/lib64/libpython2.5.so.1.0
>> #14 0x00002b534b33decd in PyClass_IsSubclass () from /usr/lib64/libpython2.5.so.1.0
>> #15 0x00002b534b336e13 in PyObject_Call () from /usr/lib64/libpython2.5.so.1.0
>> #16 0x00002b534b33e93b in _PyInstance_Lookup () from /usr/lib64/libpython2.5.so.1.0
>> #17 0x00002b534b336e13 in PyObject_Call () from /usr/lib64/libpython2.5.so.1.0
>> #18 0x00002b534b3a7463 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
>> #19 0x00002b534b3ab5ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
>> #20 0x00002b534b3ab5f2 in PyEval_EvalCode () from /usr/lib64/libpython2.5.so.1.0
>> #21 0x00002b534b3c4022 in Py_CompileString () from /usr/lib64/libpython2.5.so.1.0
>> #22 0x00002b534b3c40f6 in PyRun_FileExFlags () from /usr/lib64/libpython2.5.so.1.0
>> #23 0x00002b534b3c55b8 in PyRun_SimpleFileExFlags () from /usr/lib64/libpython2.5.so.1.0
>> #24 0x00002aaab50667d5 in PythonUI::execScript (script=@0x40803fd0) at gui/py/PythonUI.cpp:42
>> #25 0x00002aaab50676e8 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:92
>> #26 0x00002aaab494f771 in boost::detail::function::void_function_invoker0<void (*)(), void>::invoke (function_ptr=@0x408040a8) at /usr/local/include/boost/function/function_template.hpp:114
>> #27 0x00002b534bcd354e in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/local/lib64/libboost_thread-gcc41-mt-1_34_1.so.1.34.1
>> #28 0x00002b534bcd3202 in boost::thread_group::add_thread () from /usr/local/lib64/libboost_thread-gcc41-mt-1_34_1.so.1.34.1
>> #29 0x00002b534b65809e in start_thread () from /lib64/libpthread.so.0
>> #30 0x00002b534ec044cd in clone () from /lib64/libc.so.6
>> #31 0x0000000000000000 in ?? ()
>>
>> Thread 1 (Thread 47636875512880 (LWP 1358)):
>> #0  0x00002b534ebd5e1f in waitpid () from /lib64/libc.so.6
>> #1  0x00002b534eb7e491 in do_system () from /lib64/libc.so.6
>> #2  0x00002b534eb7e817 in system () from /lib64/libc.so.6
>> #3  0x000000000056f82b in sigHandler (sig=11) at core/yade.cpp:58
>> #4  <signal handler called>
>> #5  0x00002aaab49242ea in QObject::parent (this=0x0) at /usr/lib/qt3/include/qobject.h:154
>> #6  0x00002aaab49244ad in QWidget::parentWidget (this=0x0, sameWindow=false) at /usr/lib/qt3/include/qwidget.h:878
>> #7  0x00002aaab49882b0 in QtSimulationPlayer::pbInputConfigFileClicked (this=0x2aaad0006110) at gui/qt3/QtSimulationPlayer.cpp:33
>> #8  0x00002aaab4985e90 in QtGeneratedSimulationPlayer::qt_invoke (this=0x2aaad0006110, _id=58, _o=0x7fff5f9c96d0) at /home/sega/build/yade/build-trunk/gui/qt3/moc_QtGeneratedSimulationPlayer.cc:110
>> #9  0x00002b534c639adc in QObject::activate_signal () from /usr/lib64/libqt-mt.so.3
>> #10 0x00002b534c63a7b3 in QObject::activate_signal () from /usr/lib64/libqt-mt.so.3
>> #11 0x00002b534c66c7b7 in QWidget::event () from /usr/lib64/libqt-mt.so.3
>> #12 0x00002b534c5e2eb5 in QApplication::internalNotify () from /usr/lib64/libqt-mt.so.3
>> #13 0x00002b534c5e3df1 in QApplication::notify () from /usr/lib64/libqt-mt.so.3
>> #14 0x00002b534c58b399 in QETWidget::translateMouseEvent () from /usr/lib64/libqt-mt.so.3
>> #15 0x00002b534c58a3f3 in QApplication::x11ProcessEvent () from /usr/lib64/libqt-mt.so.3
>> #16 0x00002b534c59940f in QEventLoop::processEvents () from /usr/lib64/libqt-mt.so.3
>> #17 0x00002b534c5f7963 in QEventLoop::enterLoop () from /usr/lib64/libqt-mt.so.3
>> #18 0x00002b534c5f7812 in QEventLoop::exec () from /usr/lib64/libqt-mt.so.3
>> #19 0x00002aaab494ed6b in QtGUI::run (this=0x8d6b20, argc=1, argv=0x7fff5f9ca8e8) at gui/qt3/QtGUI.cpp:72
>> #20 0x000000000056f2f0 in main (argc=1, argv=0x7fff5f9ca8e8) at core/yade.cpp:255
>> #0  0x00002b534ebd5e1f in waitpid () from /lib64/libc.so.6
>> Segmentation fault
>>
>>   
>>     
>
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From janek_listy at wp.pl  Wed Jun  4 00:18:03 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Wed, 4 Jun 2008 00:18:03 +0200
Subject: [yade-dev] svn1372 crash
In-Reply-To: <48454CE6.3000908@hmg.inpg.fr>
References: <200806031403.34371.dorofeenko@icp.ac.ru>
	<48454B58.1060600@hmg.inpg.fr> <48454CE6.3000908@hmg.inpg.fr>
Message-ID: <20080604001803.0e93ad05@absurd>

Bruno Chareyre said:     (by the date of Tue, 03 Jun 2008 15:53:42 +0200)

Hi,

It's good to hear that this 16+16+8+8 core cluster is up and running!

 
> This result in a crash :
> start Yade -> Player -> Simulation file -> browse

As I just got a third daughter - she is 12 days old now (and
everything's fine), I also got a bit away from yade for a week or
two.

Apparently Vaclav went crazy about changes in the core without a
month-long discussion about his plans on the mailing list ;-P

So now it's his job to fix this mess. 

Vaclav, I think that the simplest option for you is to restore
old Qt3GUI, and give another name to your brand-new experimental
always-crashing PythonQt3GUI. (the names are up to you)

PS: I'm back in Grenoble on June 16th (two weeks)
-- 
Janek Kozicki                                                         |


From janek_listy at wp.pl  Wed Jun  4 02:00:30 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Wed, 4 Jun 2008 02:00:30 +0200
Subject: [yade-dev] svn1372 crash
In-Reply-To: <20080604001803.0e93ad05@absurd>
References: <200806031403.34371.dorofeenko@icp.ac.ru>
	<48454B58.1060600@hmg.inpg.fr> <48454CE6.3000908@hmg.inpg.fr>
	<20080604001803.0e93ad05@absurd>
Message-ID: <20080604020030.30e0e65a@absurd>

Janek Kozicki said:     (by the date of Wed, 4 Jun 2008 00:18:03 +0200)

> ... without a month-long discussion about plans on the mailing list ;-P

if you take this too serious:  that was being sarcastic.

-- 
Janek Kozicki                                                         |


From eudoxos at arcig.cz  Wed Jun  4 08:02:55 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 04 Jun 2008 08:02:55 +0200
Subject: [yade-dev] svn1372 crash
In-Reply-To: <200806031403.34371.dorofeenko@icp.ac.ru>
References: <200806031403.34371.dorofeenko@icp.ac.ru>
Message-ID: <4846300F.9060402@arcig.cz>


> I clicked on SimulationPlayer's Open-simulation-file button  and get crash:
>   
Fixed in last commit.


From eudoxos at arcig.cz  Wed Jun  4 08:27:01 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 04 Jun 2008 08:27:01 +0200
Subject: [yade-dev] svn1372 crash
In-Reply-To: <48454B58.1060600@hmg.inpg.fr>
References: <200806031403.34371.dorofeenko@icp.ac.ru>
	<48454B58.1060600@hmg.inpg.fr>
Message-ID: <484635B5.1090307@arcig.cz>

Bruno Chareyre napsal(a):
> Hello
>
> I've not updated Yade for few days or weeks and I'm a bit lost right now...
> It looks like the QtGui has change a lot in my current (not latest) 
> version, not bad, but I have problems to enlarge windows to a convenient 
> size.
More precisely?
>  Also, I can't turn the timestep to "automatic" for some reason.
>   
Fixed in last commit, sorry.

Vaclav


From eudoxos at arcig.cz  Wed Jun  4 08:35:07 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 04 Jun 2008 08:35:07 +0200
Subject: [yade-dev] svn1372 crash
In-Reply-To: <20080604001803.0e93ad05@absurd>
References: <200806031403.34371.dorofeenko@icp.ac.ru>	<48454B58.1060600@hmg.inpg.fr>
	<48454CE6.3000908@hmg.inpg.fr> <20080604001803.0e93ad05@absurd>
Message-ID: <4846379B.9030407@arcig.cz>


> Apparently Vaclav went crazy about changes in the core without a
> month-long discussion about his plans on the mailing list ;-P
>
> So now it's his job to fix this mess. 
>
> Vaclav, I think that the simplest option for you is to restore
> old Qt3GUI, and give another name to your brand-new experimental
> always-crashing PythonQt3GUI. (the names are up to you)
>   
It is not always-crashing, I think. I know there are glitches, but there
are actually 3 things that happen, but are conceptually separate.

1. decoupling simulation from the controller, that is, retain the
controller functionality while allowing asynchronous changes of
simulation parameters - from within the simulation, from console.

2. making the qt3 gui more friendly (I think, at least - for example
taking less space on the screen) and the code cleaner. Why have dynamic
menus, if we really have just a few fixed set of things that you do? And
so on. I know qt3 gui is deprecated etc, but so is yade serialization,
so are old class names etc. And we still use them and will use them for
some time.

3. Running python console together with qt3; it doesn't affect QtGUI
except for about 5 lines. This will not, obviously, happen if you
compile without EMBED_PYTHON. Perhaps I should add an option? (so that
the console is disabled by default and people don't blame python for
crashes I caused by the two points above ;-) )

I think the the ui is quite stabilized now (buzz me if not) and I am
sorry for the difficult transition.

Vaclav


From bruno.chareyre at hmg.inpg.fr  Wed Jun  4 11:37:38 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Wed, 04 Jun 2008 11:37:38 +0200
Subject: [yade-dev] svn1372 crash
In-Reply-To: <4846379B.9030407@arcig.cz>
References: <200806031403.34371.dorofeenko@icp.ac.ru>	<48454B58.1060600@hmg.inpg.fr>	<48454CE6.3000908@hmg.inpg.fr>
	<20080604001803.0e93ad05@absurd> <4846379B.9030407@arcig.cz>
Message-ID: <48466262.2080805@hmg.inpg.fr>


> 3. Running python console together with qt3;
This is a usefull improvement...

>  it doesn't affect QtGUI
> except for about 5 lines. This will not, obviously, happen if you
> compile without EMBED_PYTHON. Perhaps I should add an option? (so that
> the console is disabled by default and people don't blame python for
> crashes I caused by the two points above ;-) )
>
>   
... but disabling new features by default can reduce the number of your 
ennemies indeed. ;-)
> I think the the ui is quite stabilized now (buzz me if not) and I am
> sorry for the difficult transition.
>
>   
Don't worry.

Bruno

-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From janek_listy at wp.pl  Thu Jun  5 21:15:51 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Thu, 5 Jun 2008 21:15:51 +0200
Subject: [yade-dev] svn1372 crash
In-Reply-To: <4846379B.9030407@arcig.cz>
References: <200806031403.34371.dorofeenko@icp.ac.ru>
	<48454B58.1060600@hmg.inpg.fr> <48454CE6.3000908@hmg.inpg.fr>
	<20080604001803.0e93ad05@absurd> <4846379B.9030407@arcig.cz>
Message-ID: <20080605211551.046134f6@absurd>

V?clav S(milauer said:     (by the date of Wed, 04 Jun 2008 08:35:07 +0200)


> I think the the ui is quite stabilized now (buzz me if not) and I am

- The "Refresh [ms]" option doesn't work. 
- The "sync. display" option behaves incorrectly (try it)
- enlarging simulation controller doesn't enlarge it's insides which
  is unfriendly. (still need to scroll inside the window, to checkbox
  the options)

I think that this qt3-python you have done UI is a very nice piece of
work, however it is not ready for release. Also people who will
upgrade to new version will receive some kind of "User Shock". This
is why I think that old one and new one should coexist.

Besides, what's the purpose on removing old but still _working_ (and
tested) interfaces?

When we get qt4 UI we will remove the qt3 ones only when keeping them
up to date will become troublesome, but before that we will mark it
deprecated. This is called smooth-transition. You know that :)

> sorry for the difficult transition.

so I say - don't make it to be a transition. Make it an improvement
by adding a new python - qt interface.


In qt4 there is a nice feature which allows moving MDI windows
inside/outside of a main window. By this way the user can decide if
he wants all windows inside the main one, or if he wants them
outside, a quite convenient thing I'd say.

-- 
Janek Kozicki                                                         |


From dorofeenko at icp.ac.ru  Fri Jun  6 10:57:57 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Fri, 6 Jun 2008 12:57:57 +0400
Subject: [yade-dev] svn1376 crash
In-Reply-To: <20080605211551.046134f6@absurd>
References: <200806031403.34371.dorofeenko@icp.ac.ru>
	<4846379B.9030407@arcig.cz> <20080605211551.046134f6@absurd>
Message-ID: <200806061257.58316.dorofeenko@icp.ac.ru>

sega at sega:~/YADE/data> yade-trunk STLImporterTest.py
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
Running script STLImporterTest.py
__   __    ____          ____                      _
\ \ / /_ _|  _ \  ___   / ___|___  _ __  ___  ___ | | ___
 \ V / _` | | | |/ _ \ | |   / _ \| '_ \/ __|/ _ \| |/ _ \
  | | (_| | |_| |  __/ | |__| (_) | | | \__ \ (_) | |  __/
  |_|\__,_|____/ \___|  \____\___/|_| |_|___/\___/|_|\___|


In [1]: Omega::instance().getSimulationFileName()=
In [1]: SIGSEGV/SIGABRT handler called; gdb batch file is `/home/sega/.yade-trunk/gdb_crash_batch-pid20763'
GNU gdb 6.5
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "x86_64-suse-linux".
Using host libthread_db library "/lib64/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread 47835561507888 (LWP 20763)]
[New Thread 1091017024 (LWP 20930)]
[New Thread 1082149184 (LWP 20809)]
0x00002b81915b9302 in __select_nocancel () from /lib64/libc.so.6
No symbol "info" in current context.

Thread 3 (Thread 1082149184 (LWP 20809)):
#0  0x00002b81915b9302 in __select_nocancel () from /lib64/libc.so.6
#1  0x00002aaad0b124c5 in initreadline () from /usr/lib64/python2.5/lib-dynload/readline.so
#2  0x00002b818dcefb4f in PyOS_Readline () from /usr/lib64/libpython2.5.so.1.0
#3  0x00002b818dd5bc74 in _PyBuiltin_Init () from /usr/lib64/libpython2.5.so.1.0
#4  0x00002b818dd6556a in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
#5  0x00002b818dd665ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
#6  0x00002b818dd64cd4 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
#7  0x00002b818dd665ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
#8  0x00002b818dd64cd4 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
#9  0x00002b818dd665ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
#10 0x00002b818dd64cd4 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
#11 0x00002b818dd665ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
#12 0x00002b818dd0ec48 in PyClassMethod_New () from /usr/lib64/libpython2.5.so.1.0
#13 0x00002b818dcf1e13 in PyObject_Call () from /usr/lib64/libpython2.5.so.1.0
#14 0x00002b818dcf8ecd in PyClass_IsSubclass () from /usr/lib64/libpython2.5.so.1.0
#15 0x00002b818dcf1e13 in PyObject_Call () from /usr/lib64/libpython2.5.so.1.0
#16 0x00002b818dcf993b in _PyInstance_Lookup () from /usr/lib64/libpython2.5.so.1.0
#17 0x00002b818dcf1e13 in PyObject_Call () from /usr/lib64/libpython2.5.so.1.0
#18 0x00002b818dd62463 in PyEval_EvalFrameEx () from /usr/lib64/libpython2.5.so.1.0
#19 0x00002b818dd665ac in PyEval_EvalCodeEx () from /usr/lib64/libpython2.5.so.1.0
#20 0x00002b818dd665f2 in PyEval_EvalCode () from /usr/lib64/libpython2.5.so.1.0
#21 0x00002b818dd7f022 in Py_CompileString () from /usr/lib64/libpython2.5.so.1.0
#22 0x00002b818dd7f0f6 in PyRun_FileExFlags () from /usr/lib64/libpython2.5.so.1.0
#23 0x00002b818dd805b8 in PyRun_SimpleFileExFlags () from /usr/lib64/libpython2.5.so.1.0
#24 0x00002aaab50667d5 in PythonUI::execScript (script=@0x40803fd0) at gui/py/PythonUI.cpp:42
#25 0x00002aaab50676e8 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:92
#26 0x00002aaab494f841 in boost::detail::function::void_function_invoker0<void (*)(), void>::invoke (function_ptr=@0x408040a8) at /usr/local/inc
lude/boost/function/function_template.hpp:114
#27 0x00002b818e68e54e in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/local/lib64/libboost_thread-gcc
41-mt-1_34_1.so.1.34.1
#28 0x00002b818e68e202 in boost::thread_group::add_thread () from /usr/local/lib64/libboost_thread-gcc41-mt-1_34_1.so.1.34.1
#29 0x00002b818e01309e in start_thread () from /lib64/libpthread.so.0
#30 0x00002b81915bf4cd in clone () from /lib64/libc.so.6
#31 0x0000000000000000 in ?? ()

Thread 2 (Thread 1091017024 (LWP 20930)):
#0  0x00002b8191590e1f in waitpid () from /lib64/libc.so.6
#1  0x00002b8191539491 in do_system () from /lib64/libc.so.6
#2  0x00002b8191539817 in system () from /lib64/libc.so.6
#3  0x000000000056f82b in sigHandler (sig=11) at core/yade.cpp:58
#4  <signal handler called>
#5  0x00002b819030cdce in Wm3::Vector3<double>::Dot (this=0x0, rkV=@0x41078a00) at /home/sega/build/yade/build-trunk/include/yade-trunk/yade/lib
-miniWm3/Wm3Vector3.inl:293
#6  0x00002aaac419f3f9 in InteractingFacet2InteractingSphere4SpheresContactGeometry::go (this=0xa49210, cm1=@0x41078c80, cm2=@0x41078c90, se31=@           0xb4d1e0, se32=@0xbc2650, c=@0x41078d80) at pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp:49
#7  0x00002aaac419f182 in InteractingFacet2InteractingSphere4SpheresContactGeometry::goReverse (this=0xa49210, cm1=@0x41078c90, cm2=@0x41078c80,            se31=@0xbc2650, se32=@0xb4d1e0, c=@0x41078d80) at pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp:87
#8  0x00002aaaadc2745f in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<InteractingGeometry, Loki::NullType> >, Interactio           nGeometryEngineUnit, bool, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<InteractingGeometry> c           onst&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Se3<double> const&, Loki::Typelist<boost::shared_ptr<Interaction> const&, Loki::NullTyp           e> > > > >, false>::InvocationTraits<false, InteractingGeometry, InteractingGeometry, Se3<double> const&, Se3<double> const&, boost::shared_ptr<           Interaction> const&, Loki::EmptyType, Loki::EmptyType, Loki::EmptyType, Loki::EmptyType, Loki::EmptyType, Loki::EmptyType, Loki::EmptyType, Loki           ::EmptyType, Loki::EmptyType, Loki::EmptyType>::doDispatch (ex=@0xa472e0, base1=@0x41078c90, base2=@0x41078c80, p3=@0xbc2650, p4=@0xb4d1e0, p5=@           0x41078d80) at /home/sega/build/yade/build-trunk/include/yade-trunk/yade/lib-multimethods/DynLibDispatcher.hpp:678
#9  0x00002aaaadc2a8c6 in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<InteractingGeometry, Loki::NullType> >, Interactio           nGeometryEngineUnit, bool, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<InteractingGeometry> c           onst&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Se3<double> const&, Loki::Typelist<boost::shared_ptr<Interaction> const&, Loki::NullTyp           e> > > > >, false>::operator() (this=0xa49280, base1=@0xbace48, base2=@0xb4bc48, p3=@0xbc2650, p4=@0xb4d1e0, p5=@0x41078d80) at /home/sega/build           /yade/build-trunk/include/yade-trunk/yade/lib-multimethods/DynLibDispatcher.hpp:879
#10 0x00002aaaadc1f64e in InteractionGeometryMetaEngine::action (this=0xa49240, ncb=0x94caf0) at pkg/common/Engine/MetaEngine/InteractionGeometr           yMetaEngine.cpp:50
#11 0x00000000005105a3 in MetaBody::moveToNextTimeStep (this=0x94caf0) at core/MetaBody.cpp:81
#12 0x00000000005664b9 in SimulationFlow::singleAction (this=0x80dd60) at core/SimulationFlow.cpp:17
#13 0x0000000000568344 in ThreadWorker::callSingleAction (this=0x80dd60) at core/ThreadWorker.cpp:71
#14 0x0000000000567a25 in ThreadRunner::call (this=0xa4d9b0) at core/ThreadRunner.cpp:42
#15 0x0000000000567a89 in ThreadRunner::run (this=0xa4d9b0) at core/ThreadRunner.cpp:21
#16 0x0000000000567f9d in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x410790a8, p=0xa4d9b0) at /usr/local/include/boost/bind/mem_fn           _template.hpp:49
#17 0x000000000056801e in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::lis           t0> (this=0x410790b8, f=@0x410790a8, a=@0x4107900f) at /usr/local/include/boost/bind.hpp:231
#18 0x0000000000568061 in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >:           :operator() (this=0x410790a8) at /usr/local/include/boost/bind/bind_template.hpp:20
#19 0x0000000000568086 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boo           st::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x410790a8) at /usr/local/include/boost/function/function_           template.hpp:155
#20 0x00002b818e68e54e in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/local/lib64/libboost_thread-gcc           41-mt-1_34_1.so.1.34.1
#21 0x00002b818e68e202 in boost::thread_group::add_thread () from /usr/local/lib64/libboost_thread-gcc41-mt-1_34_1.so.1.34.1
#22 0x00002b818e01309e in start_thread () from /lib64/libpthread.so.0
#23 0x00002b81915bf4cd in clone () from /lib64/libc.so.6
#24 0x0000000000000000 in ?? ()

Thread 1 (Thread 47835561507888 (LWP 20763)):
#0  0x00002b81915b9302 in __select_nocancel () from /lib64/libc.so.6
#1  0x00002b818ef5424b in QEventLoop::processEvents () from /usr/lib64/libqt-mt.so.3
#2  0x00002b818efb2963 in QEventLoop::enterLoop () from /usr/lib64/libqt-mt.so.3
#3  0x00002b818efb2812 in QEventLoop::exec () from /usr/lib64/libqt-mt.so.3
#4  0x00002aaab494ee3b in QtGUI::run (this=0x8d6b20, argc=2, argv=0x7fff1d010708) at gui/qt3/QtGUI.cpp:72
#5  0x000000000056f2f0 in main (argc=2, argv=0x7fff1d010708) at core/yade.cpp:255
#0  0x00002b81915b9302 in __select_nocancel () from /lib64/libc.so.6
In [1]: Segmentation Fault

ps. Previously it worked...
-- 
Best regards, Sergei D.


From dorofeenko at icp.ac.ru  Fri Jun  6 11:03:47 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Fri, 6 Jun 2008 13:03:47 +0400
Subject: [yade-dev] svn1376 bug
In-Reply-To: <200806061257.58316.dorofeenko@icp.ac.ru>
References: <200806031403.34371.dorofeenko@icp.ac.ru>
	<20080605211551.046134f6@absurd>
	<200806061257.58316.dorofeenko@icp.ac.ru>
Message-ID: <200806061303.47372.dorofeenko@icp.ac.ru>

sega at sega:~/YADE/data> yade-trunk simple-scene.py
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
Running script simple-scene.py
__   __    ____          ____                      _
\ \ / /_ _|  _ \  ___   / ___|___  _ __  ___  ___ | | ___
 \ V / _` | | | |/ _ \ | |   / _ \| '_ \/ __|/ _ \| |/ _ \
  | | (_| | |_| |  __/ | |__| (_) | | | \__ \ (_) | |  __/
  |_|\__,_|____/ \___|  \____\___/|_| |_|___/\___/|_|\___|

In [1]: o.load('/tmp/a.xml')
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)

/home/sega/YADE/data/<ipython console> in <module>()

RuntimeError: Bad Attribute value (bad lexical_cast), Tag: "rootBody", Attribute: "isDynamic", Line: 2

In [2]:  
-- 
Best regards, Sergei D.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: a.xml
Type: text/xml
Size: 6017 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080606/66af43a5/attachment.xml>

From eudoxos at arcig.cz  Fri Jun  6 13:40:29 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Fri, 06 Jun 2008 13:40:29 +0200
Subject: [yade-dev] svn1376 crash
In-Reply-To: <200806061257.58316.dorofeenko@icp.ac.ru>
References: <200806031403.34371.dorofeenko@icp.ac.ru>	<4846379B.9030407@arcig.cz>
	<20080605211551.046134f6@absurd>
	<200806061257.58316.dorofeenko@icp.ac.ru>
Message-ID: <4849222D.6080509@arcig.cz>

As I read the backtrace, it crashes doing dot product of vectors in
InteractingFacet2InteractingSphere4SpheresContactGeometry::go.

> Thread 2 (Thread 1091017024 (LWP 20930)):
> #0  0x00002b8191590e1f in waitpid () from /lib64/libc.so.6
> #1  0x00002b8191539491 in do_system () from /lib64/libc.so.6
> #2  0x00002b8191539817 in system () from /lib64/libc.so.6
> #3  0x000000000056f82b in sigHandler (sig=11) at core/yade.cpp:58
> #4  <signal handler called>
>   
here:
> #5  0x00002b819030cdce in Wm3::Vector3<double>::Dot (this=0x0, rkV=@0x41078a00) at /home/sega/build/yade/build-trunk/include/yade-trunk/yade/lib
> -miniWm3/Wm3Vector3.inl:293
> #6  0x00002aaac419f3f9 in InteractingFacet2InteractingSphere4SpheresContactGeometry::go (this=0xa49210, cm1=@0x41078c80, cm2=@0x41078c90, se31=@           0xb4d1e0, se32=@0xbc2650, c=@0x41078d80) at pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp:49
> #7  0x00002aaac419f182 in InteractingFacet2InteractingSphere4SpheresContactGeometry::goReverse (this=0xa49210, cm1=@0x41078c90, cm2=@0x41078c80,            se31=@0xbc2650, se32=@0xb4d1e0, c=@0x41078d80) at pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp:87
> #8  0x00002aaaadc2745f in DynLibDispatcher<Loki::Typelist<InteractingGeometry, 



From eudoxos at arcig.cz  Fri Jun  6 13:47:21 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Fri, 06 Jun 2008 13:47:21 +0200
Subject: [yade-dev] svn1376 bug
In-Reply-To: <200806061303.47372.dorofeenko@icp.ac.ru>
References: <200806031403.34371.dorofeenko@icp.ac.ru>	<20080605211551.046134f6@absurd>	<200806061257.58316.dorofeenko@icp.ac.ru>
	<200806061303.47372.dorofeenko@icp.ac.ru>
Message-ID: <484923C9.4020508@arcig.cz>


> RuntimeError: Bad Attribute value (bad lexical_cast), Tag: "rootBody", Attribute: "isDynamic", Line: 2
>   
"192" is not a good value for bool, there is probably some garbage in
memory? It is _maybe_ fixed in 1377, recompiling now and will see. V.

PS. Do we mind using https://bugs.launchpad.net/yade/ instead of abusing
the mailing list?
PPS. https://launchpad.net/~yade-team/+archive has hardy packages of
svn1371.



From eudoxos at arcig.cz  Sun Jun  8 00:09:55 2008
From: eudoxos at arcig.cz (eudoxos at arcig.cz)
Date: Sun,  8 Jun 2008 00:09:55 +0200 (CEST)
Subject: [yade-dev] Automated crash report for
	/tmp/yade-10867/bin/yade-svn1381:	SDECLinkedSpheres, ScrewGen,
	TetraTestGen, ThreePointBending
Message-ID: <20080607220955.1916D980D1@delta>

################################################################################
SDECLinkedSpheres: simulation CRASH
################################################################################
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
yade-svn1381: /usr/include/boost/shared_ptr.hpp:253: T* boost::shared_ptr<T>::operator->() const [with T = SpheresContactGeometry]: Assertion `px != 0' failed.
Running script /tmp/yade-test-17050.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1381/gdb_crash_batch-pid17634'
GNU gdb 6.6-debian
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Using host libthread_db library "/lib/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread 47446830396096 (LWP 17634)]
[New Thread 1082132800 (LWP 17659)]
0x00000030010961d1 in nanosleep () from /lib/libc.so.6
No symbol "info" in current context.

Thread 2 (Thread 1082132800 (LWP 17659)):
#0  0x0000003001095b2f in waitpid () from /lib/libc.so.6
#1  0x000000300103c763 in ?? () from /lib/libc.so.6
#2  0x000000300103cad7 in system () from /lib/libc.so.6
#3  0x0000000000570937 in sigHandler (sig=6) at core/yade.cpp:58
#4  <signal handler called>
#5  0x0000003001030cab in raise () from /lib/libc.so.6
#6  0x0000003001032660 in abort () from /lib/libc.so.6
#7  0x000000300102a436 in __assert_fail () from /lib/libc.so.6
#8  0x00002b2719dbdb5b in boost::shared_ptr<SpheresContactGeometry>::operator-> (this=0x407ffca0) at /usr/include/boost/shared_ptr.hpp:253
#9  0x00002b2719febdd0 in InteractingSphere2InteractingSphere4SpheresContactGeometry::go (this=0xa549e0, cm1=@0xa59ec8, cm2=@0xa59ae8, se31=@0xa5a720, se32=@0xa5ac10, c=@0x407ffdd0) at pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp:69
#10 0x00002b27176d7039 in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<InteractingGeometry, Loki::NullType> >, InteractionGeometryEngineUnit, bool, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Se3<double> const&, Loki::Typelist<boost::shared_ptr<Interaction> const&, Loki::NullType> > > > >, false>::operator() (this=0xa543a8, base1=@0xa59ec8, base2=@0xa59ae8, p3=@0xa5a720, p4=@0xa5ac10, p5=@0x407ffdd0) at /tmp/yade-10867/build-svn1381/include/yade-svn1381/yade/lib-multimethods/DynLibDispatcher.hpp:882
#11 0x00002b27176ca08b in InteractionGeometryMetaEngine::action (this=0xa54360, ncb=0xa519c0) at pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.cpp:31
#12 0x0000000000516cff in MetaBody::moveToNextTimeStep (this=0xa519c0) at core/MetaBody.cpp:83
#13 0x0000000000567785 in SimulationFlow::singleAction (this=0x807600) at core/SimulationFlow.cpp:17
#14 0x0000000000569550 in ThreadWorker::callSingleAction (this=0x807600) at core/ThreadWorker.cpp:71
#15 0x0000000000568c7d in ThreadRunner::call (this=0xa4cb60) at core/ThreadRunner.cpp:42
#16 0x0000000000568ce1 in ThreadRunner::run (this=0xa4cb60) at core/ThreadRunner.cpp:21
#17 0x00000000005690ed in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0xa387f0, p=0xa4cb60) at /usr/include/boost/bind/mem_fn_template.hpp:45
#18 0x000000000056916e in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0xa38800, f=@0xa387f0, a=@0x4080004f) at /usr/include/boost/bind.hpp:230
#19 0x00000000005691b1 in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0xa387f0) at /usr/include/boost/bind/bind_template.hpp:20
#20 0x00000000005691d6 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr={obj_ptr = 0xa387f0, const_obj_ptr = 0xa387f0, func_ptr = 0xa387f0, data = "?"}) at /usr/include/boost/function/function_template.hpp:136
#21 0x00002b27102b88cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#22 0x00002b27102b82ef in ?? () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#23 0x00000030024062a5 in start_thread () from /lib/libpthread.so.0
#24 0x00000030010cf61d in clone () from /lib/libc.so.6
#25 0x0000000000000000 in ?? ()

Thread 1 (Thread 47446830396096 (LWP 17634)):
#0  0x00000030010961d1 in nanosleep () from /lib/libc.so.6
#1  0x00000030010c9134 in usleep () from /lib/libc.so.6
#2  0x00002b2736399194 in pyOmega::wait (this=0xa387e0) at gui/py/yadeControl.cpp:394
#3  0x00002b27362d4393 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0x8f0998, tc=@0x7fff9aee1f00) at /usr/include/boost/python/detail/invoke.hpp:94
#4  0x00002b273632f618 in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0x8f0998, args_=0x2b271398a990) at /usr/include/boost/python/detail/caller.hpp:199
#5  0x00002b273632f671 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0x8f0990, args=0x2b271398a990, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#6  0x00002b271184a89d in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#7  0x00002b271184b825 in boost::detail::function::void_function_obj_invoker0<boost::python::objects::(anonymous namespace)::bind_return, void>::invoke () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#8  0x00002b27102b88cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#9  0x00002b27118508f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#10 0x00002b271184adb7 in boost::python::handle_exception<boost::python::objects::(anonymous namespace)::bind_return> () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#11 0x00002b2711847c9e in ?? () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#12 0x00002b270fc28033 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#13 0x00002b270fca3919 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#14 0x00002b270fca96c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#15 0x00002b270fca9702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#16 0x00002b270fccc561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#17 0x00002b270fca08a4 in ?? () from /usr/lib/libpython2.5.so.1.0
#18 0x00002b270fca88d5 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#19 0x00002b270fca96c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#20 0x00002b270fca9702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#21 0x00002b270fccc561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#22 0x00002b270fccc7e8 in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#23 0x00002b271d6ecc1b in PythonUI::execScript (script=@0x7fff9aee3010) at gui/py/PythonUI.cpp:42
#24 0x00002b271d6edae2 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:92
#25 0x00002b271d6ee2e2 in PythonUI::run (this=0x9ccf80, argc=3, argv=0x7fff9aee3bd0) at gui/py/PythonUI.cpp:121
#26 0x00000000005703d5 in main (argc=3, argv=0x7fff9aee3bd0) at core/yade.cpp:255
#0  0x00000030010961d1 in nanosleep () from /lib/libc.so.6

################################################################################
ScrewGen: generator CRASH
################################################################################
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
yade-svn1381: /tmp/yade-10867/build-svn1381/include/yade-svn1381/yade/lib-multimethods/DynLibDispatcher.hpp:447: bool DynLibDispatcher<BaseClass, Executor, ResultType, TList, autoSymmetry>::locateMultivirtualFunctor2D(int&, int&, boost::shared_ptr<typename Loki::TL::TypeAtNonStrict<typename Loki::TL::Append<Loki::NullType, T>::Result, 0u, Loki::NullType>::Result>&, boost::shared_ptr<typename Loki::TL::TypeAtNonStrict<typename Loki::TL::Append<Loki::NullType, T>::Result, 1u, Loki::NullType>::Result>&) [with BaseClass = Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, Executor = BoundingVolumeEngineUnit, ResultType = void, TList = Loki::Typelist<const boost::shared_ptr<InteractingGeometry>&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<const Se3r&, Loki::Typelist<const Body*, Loki::NullType> > > >, bool autoSymmetry = true]: Assertion `index1 >= 0 && (unsigned int)( index1 ) < callBacks.size() && index2 >= 0 && (unsigned
  int)( index2 ) < callBacks[index1].size()' failed.
Running script /tmp/yade-test-17050.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1381/gdb_crash_batch-pid17892'
GNU gdb 6.6-debian
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Using host libthread_db library "/lib/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread 47680640824000 (LWP 17892)]
0x0000003001095af5 in waitpid () from /lib/libc.so.6
No symbol "info" in current context.

Thread 1 (Thread 47680640824000 (LWP 17892)):
#0  0x0000003001095af5 in waitpid () from /lib/libc.so.6
#1  0x000000300103c763 in ?? () from /lib/libc.so.6
#2  0x0000000000570937 in sigHandler (sig=6) at core/yade.cpp:58
#3  <signal handler called>
#4  0x0000003001030cab in raise () from /lib/libc.so.6
#5  0x0000003001032660 in abort () from /lib/libc.so.6
#6  0x000000300102a436 in __assert_fail () from /lib/libc.so.6
#7  0x00002b5d8837fb73 in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, BoundingVolumeEngineUnit, void, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Body const*, Loki::NullType> > > >, true>::locateMultivirtualFunctor2D (this=0xa4cbc8, index1=@0x7fff2abe0f4c, index2=@0x7fff2abe0f48, base1=@0xa565e8, base2=@0xa565f8) at /tmp/yade-10867/build-svn1381/include/yade-svn1381/yade/lib-multimethods/DynLibDispatcher.hpp:446
#8  0x00002b5d8837feed in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, BoundingVolumeEngineUnit, void, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Body const*, Loki::NullType> > > >, true>::operator() (this=0xa4cbc8, base1=@0xa565e8, base2=@0xa565f8, p3=@0xa56640, p4=0xa565a0) at /tmp/yade-10867/build-svn1381/include/yade-svn1381/yade/lib-multimethods/DynLibDispatcher.hpp:856
#9  0x00002b5d883732b5 in BoundingVolumeMetaEngine::action (this=0xa4cb80, ncb=0xa4c840) at pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine.cpp:27
#10 0x0000000000516e3d in MetaBody::runInitializers (this=0xa4c840) at core/MetaBody.cpp:45
#11 0x0000000000516efc in MetaBody::postProcessAttributes (this=0xa4c840, deserializing=false) at core/MetaBody.cpp:51
#12 0x00002b5d821c9154 in Serializable::unregisterSerializableAttributes (this=0xa4c840, deserializing=false) at lib/serialization/Serializable.cpp:29
#13 0x00002b5d83ca38a5 in XMLFormatManager::serializeSerializable (stream=@0x7fff2abe12e0, ac=@0xaa9460, depth=1) at lib/serialization-xml/XMLFormatManager.cpp:168
#14 0x00002b5d83ca2258 in XMLFormatManager::serializeSmartPointer (stream=@0x7fff2abe12e0, ac=@0xaa93d0, depth=1) at lib/serialization-xml/XMLFormatManager.cpp:284
#15 0x0000000000507320 in IOFormatManager::saveToFile<boost::shared_ptr<MetaBody> > (libName=@0xa4b900, fileName=@0xa4b8f8, name=@0x7fff2abe17f0, t=@0xa4b8e8) at /tmp/yade-10867/build-svn1381/include/yade-svn1381/yade/lib-serialization/IOFormatManager.tpp:59
#16 0x00000000004f2f5b in FileGenerator::generateAndSave (this=0xa4b880) at core/FileGenerator.cpp:89
#17 0x00002b5da669360e in pyFileGenerator::generate (this=0xa4ba20, outFile=@0x7fff2abe1b50) at gui/py/yadeControl.cpp:258
#18 0x00002b5da667681f in boost::python::detail::invoke<boost::python::to_python_value<bool const&>, bool (pyFileGenerator::*)(std::string), boost::python::arg_from_python<pyFileGenerator&>, boost::python::arg_from_python<std::string> > (rc=@0x7fff2abe1bee, f=@0xa467b8, tc=@0x7fff2abe1bd0, ac0=@0x7fff2abe1bf0) at /usr/include/boost/python/detail/invoke.hpp:88
#19 0x00002b5da6676982 in boost::python::detail::caller_arity<2u>::impl<bool (pyFileGenerator::*)(std::string), boost::python::default_call_policies, boost::mpl::vector3<bool, pyFileGenerator&, std::string> >::operator() (this=0xa467b8, args_=0x2b5d83c82cf8) at /usr/include/boost/python/detail/caller.hpp:199
#20 0x00002b5da6676a2d in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<bool (pyFileGenerator::*)(std::string), boost::python::default_call_policies, boost::mpl::vector3<bool, pyFileGenerator&, std::string> > >::operator() (this=0xa467b0, args=0x2b5d83c82cf8, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#21 0x00002b5d81b4a89d in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#22 0x00002b5d81b4b825 in boost::detail::function::void_function_obj_invoker0<boost::python::objects::(anonymous namespace)::bind_return, void>::invoke () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#23 0x00002b5d805b88cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#24 0x00002b5d81b508f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#25 0x00002b5d81b4adb7 in boost::python::handle_exception<boost::python::objects::(anonymous namespace)::bind_return> () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#26 0x00002b5d81b47c9e in ?? () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#27 0x00002b5d7ff28033 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#28 0x00002b5d7ffa3919 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#29 0x00002b5d7ffa96c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#30 0x00002b5d7ffa9702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#31 0x00002b5d7ffcc561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#32 0x00002b5d7ffa08a4 in ?? () from /usr/lib/libpython2.5.so.1.0
#33 0x00002b5d7ffa88d5 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#34 0x00002b5d7ffa96c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#35 0x00002b5d7ffa9702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#36 0x00002b5d7ffcc561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#37 0x00002b5d7ffcc7e8 in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#38 0x00002b5d8d9ecc1b in PythonUI::execScript (script=@0x7fff2abe2d10) at gui/py/PythonUI.cpp:42
#39 0x00002b5d8d9edae2 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:92
#40 0x00002b5d8d9ee2e2 in PythonUI::run (this=0x9ccf80, argc=3, argv=0x7fff2abe38d0) at gui/py/PythonUI.cpp:121
#41 0x00000000005703d5 in main (argc=3, argv=0x7fff2abe38d0) at core/yade.cpp:255
#0  0x0000003001095af5 in waitpid () from /lib/libc.so.6

################################################################################
TetraTestGen: generator CRASH
################################################################################
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
43520.3
194711
191169
4417.66
-46343.2
11996.2
yade-svn1381: /tmp/yade-10867/build-svn1381/include/yade-svn1381/yade/lib-multimethods/DynLibDispatcher.hpp:447: bool DynLibDispatcher<BaseClass, Executor, ResultType, TList, autoSymmetry>::locateMultivirtualFunctor2D(int&, int&, boost::shared_ptr<typename Loki::TL::TypeAtNonStrict<typename Loki::TL::Append<Loki::NullType, T>::Result, 0u, Loki::NullType>::Result>&, boost::shared_ptr<typename Loki::TL::TypeAtNonStrict<typename Loki::TL::Append<Loki::NullType, T>::Result, 1u, Loki::NullType>::Result>&) [with BaseClass = Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, Executor = BoundingVolumeEngineUnit, ResultType = void, TList = Loki::Typelist<const boost::shared_ptr<InteractingGeometry>&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<const Se3r&, Loki::Typelist<const Body*, Loki::NullType> > > >, bool autoSymmetry = true]: Assertion `index1 >= 0 && (unsigned int)( index1 ) < callBacks.size() && index2 >= 0 && (unsigned
  int)( index2 ) < callBacks[index1].size()' failed.
Running script /tmp/yade-test-17050.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1381/gdb_crash_batch-pid18102'
GNU gdb 6.6-debian
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Using host libthread_db library "/lib/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread 47594342134464 (LWP 18102)]
0x0000003001095af5 in waitpid () from /lib/libc.so.6
No symbol "info" in current context.

Thread 1 (Thread 47594342134464 (LWP 18102)):
#0  0x0000003001095af5 in waitpid () from /lib/libc.so.6
#1  0x000000300103c763 in ?? () from /lib/libc.so.6
#2  0x0000000000570937 in sigHandler (sig=6) at core/yade.cpp:58
#3  <signal handler called>
#4  0x0000003001030cab in raise () from /lib/libc.so.6
#5  0x0000003001032660 in abort () from /lib/libc.so.6
#6  0x000000300102a436 in __assert_fail () from /lib/libc.so.6
#7  0x00002b49706a7b73 in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, BoundingVolumeEngineUnit, void, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Body const*, Loki::NullType> > > >, true>::locateMultivirtualFunctor2D (this=0xa4bf28, index1=@0x7fff428b8c1c, index2=@0x7fff428b8c18, base1=@0xa51988, base2=@0xa51998) at /tmp/yade-10867/build-svn1381/include/yade-svn1381/yade/lib-multimethods/DynLibDispatcher.hpp:446
#8  0x00002b49706a7eed in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, BoundingVolumeEngineUnit, void, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Body const*, Loki::NullType> > > >, true>::operator() (this=0xa4bf28, base1=@0xa51988, base2=@0xa51998, p3=@0xa51b40, p4=0xa51940) at /tmp/yade-10867/build-svn1381/include/yade-svn1381/yade/lib-multimethods/DynLibDispatcher.hpp:856
#9  0x00002b497069b2b5 in BoundingVolumeMetaEngine::action (this=0xa4bee0, ncb=0xa4bbc0) at pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine.cpp:27
#10 0x0000000000516e3d in MetaBody::runInitializers (this=0xa4bbc0) at core/MetaBody.cpp:45
#11 0x0000000000516efc in MetaBody::postProcessAttributes (this=0xa4bbc0, deserializing=false) at core/MetaBody.cpp:51
#12 0x00002b496a4f1154 in Serializable::unregisterSerializableAttributes (this=0xa4bbc0, deserializing=false) at lib/serialization/Serializable.cpp:29
#13 0x00002b496bfcb8a5 in XMLFormatManager::serializeSerializable (stream=@0x7fff428b8fb0, ac=@0xa55850, depth=1) at lib/serialization-xml/XMLFormatManager.cpp:168
#14 0x00002b496bfca258 in XMLFormatManager::serializeSmartPointer (stream=@0x7fff428b8fb0, ac=@0xa557c0, depth=1) at lib/serialization-xml/XMLFormatManager.cpp:284
#15 0x0000000000507320 in IOFormatManager::saveToFile<boost::shared_ptr<MetaBody> > (libName=@0xa4b900, fileName=@0xa4b8f8, name=@0x7fff428b94c0, t=@0xa4b8e8) at /tmp/yade-10867/build-svn1381/include/yade-svn1381/yade/lib-serialization/IOFormatManager.tpp:59
#16 0x00000000004f2f5b in FileGenerator::generateAndSave (this=0xa4b880) at core/FileGenerator.cpp:89
#17 0x00002b498e9bb60e in pyFileGenerator::generate (this=0xa4ba20, outFile=@0x7fff428b9820) at gui/py/yadeControl.cpp:258
#18 0x00002b498e99e81f in boost::python::detail::invoke<boost::python::to_python_value<bool const&>, bool (pyFileGenerator::*)(std::string), boost::python::arg_from_python<pyFileGenerator&>, boost::python::arg_from_python<std::string> > (rc=@0x7fff428b98be, f=@0xa467b8, tc=@0x7fff428b98a0, ac0=@0x7fff428b98c0) at /usr/include/boost/python/detail/invoke.hpp:88
#19 0x00002b498e99e982 in boost::python::detail::caller_arity<2u>::impl<bool (pyFileGenerator::*)(std::string), boost::python::default_call_policies, boost::mpl::vector3<bool, pyFileGenerator&, std::string> >::operator() (this=0xa467b8, args_=0x2b496bfaacf8) at /usr/include/boost/python/detail/caller.hpp:199
#20 0x00002b498e99ea2d in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<bool (pyFileGenerator::*)(std::string), boost::python::default_call_policies, boost::mpl::vector3<bool, pyFileGenerator&, std::string> > >::operator() (this=0xa467b0, args=0x2b496bfaacf8, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#21 0x00002b4969e7289d in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#22 0x00002b4969e73825 in boost::detail::function::void_function_obj_invoker0<boost::python::objects::(anonymous namespace)::bind_return, void>::invoke () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#23 0x00002b49688e08cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#24 0x00002b4969e788f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#25 0x00002b4969e72db7 in boost::python::handle_exception<boost::python::objects::(anonymous namespace)::bind_return> () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#26 0x00002b4969e6fc9e in ?? () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#27 0x00002b4968250033 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#28 0x00002b49682cb919 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#29 0x00002b49682d16c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#30 0x00002b49682d1702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#31 0x00002b49682f4561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#32 0x00002b49682c88a4 in ?? () from /usr/lib/libpython2.5.so.1.0
#33 0x00002b49682d08d5 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#34 0x00002b49682d16c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#35 0x00002b49682d1702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#36 0x00002b49682f4561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#37 0x00002b49682f47e8 in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#38 0x00002b4975d14c1b in PythonUI::execScript (script=@0x7fff428ba9e0) at gui/py/PythonUI.cpp:42
#39 0x00002b4975d15ae2 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:92
#40 0x00002b4975d162e2 in PythonUI::run (this=0x9ccf80, argc=3, argv=0x7fff428bb5a0) at gui/py/PythonUI.cpp:121
#41 0x00000000005703d5 in main (argc=3, argv=0x7fff428bb5a0) at core/yade.cpp:255
#0  0x0000003001095af5 in waitpid () from /lib/libc.so.6

################################################################################
ThreePointBending: simulation CRASH
################################################################################
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1381/gdb_crash_batch-pid18318'
GNU gdb 6.6-debian
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Using host libthread_db library "/lib/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread 47454706610880 (LWP 18318)]
[New Thread 1082132800 (LWP 18325)]
0x00000030010961d1 in nanosleep () from /lib/libc.so.6
No symbol "info" in current context.

Thread 2 (Thread 1082132800 (LWP 18325)):
#0  0x0000003001095b2f in waitpid () from /lib/libc.so.6
#1  0x000000300103c763 in ?? () from /lib/libc.so.6
#2  0x000000300103cad7 in system () from /lib/libc.so.6
#3  0x0000000000570937 in sigHandler (sig=11) at core/yade.cpp:58
#4  <signal handler called>
#5  0x0000000000573706 in BodyRedirectionVector::operator[] (this=0xa580a0, id=0) at core/DefaultContainerImplementations/BodyRedirectionVector.cpp:205
#6  0x00002b28facdc301 in TranslationEngine::applyCondition (this=0xa55690, ncb=0xa519c0) at pkg/common/Engine/DeusExMachina/TranslationEngine.cpp:38
#7  0x00000000004ec5e9 in DeusExMachina::action (this=0xa55690, b=0xa519c0) at core/DeusExMachina.cpp:20
#8  0x0000000000516cff in MetaBody::moveToNextTimeStep (this=0xa519c0) at core/MetaBody.cpp:83
#9  0x0000000000567785 in SimulationFlow::singleAction (this=0x807600) at core/SimulationFlow.cpp:17
#10 0x0000000000569550 in ThreadWorker::callSingleAction (this=0x807600) at core/ThreadWorker.cpp:71
#11 0x0000000000568c7d in ThreadRunner::call (this=0xa4cb60) at core/ThreadRunner.cpp:42
#12 0x0000000000568ce1 in ThreadRunner::run (this=0xa4cb60) at core/ThreadRunner.cpp:21
#13 0x00000000005690ed in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0xa387f0, p=0xa4cb60) at /usr/include/boost/bind/mem_fn_template.hpp:45
#14 0x000000000056916e in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0xa38800, f=@0xa387f0, a=@0x4080004f) at /usr/include/boost/bind.hpp:230
#15 0x00000000005691b1 in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0xa387f0) at /usr/include/boost/bind/bind_template.hpp:20
#16 0x00000000005691d6 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr={obj_ptr = 0xa387f0, const_obj_ptr = 0xa387f0, func_ptr = 0xa387f0, data = "?"}) at /usr/include/boost/function/function_template.hpp:136
#17 0x00002b28e5a108cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#18 0x00002b28e5a102ef in ?? () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#19 0x00000030024062a5 in start_thread () from /lib/libpthread.so.0
#20 0x00000030010cf61d in clone () from /lib/libc.so.6
#21 0x0000000000000000 in ?? ()

Thread 1 (Thread 47454706610880 (LWP 18318)):
#0  0x00000030010961d1 in nanosleep () from /lib/libc.so.6
#1  0x00000030010c9134 in usleep () from /lib/libc.so.6
#2  0x00002b290baf1194 in pyOmega::wait (this=0xa387e0) at gui/py/yadeControl.cpp:394
#3  0x00002b290ba2c393 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0x8f0998, tc=@0x7fffc578b7a0) at /usr/include/boost/python/detail/invoke.hpp:94
#4  0x00002b290ba87618 in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0x8f0998, args_=0x2b28e90e2990) at /usr/include/boost/python/detail/caller.hpp:199
#5  0x00002b290ba87671 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0x8f0990, args=0x2b28e90e2990, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#6  0x00002b28e6fa289d in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#7  0x00002b28e6fa3825 in boost::detail::function::void_function_obj_invoker0<boost::python::objects::(anonymous namespace)::bind_return, void>::invoke () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#8  0x00002b28e5a108cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#9  0x00002b28e6fa88f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#10 0x00002b28e6fa2db7 in boost::python::handle_exception<boost::python::objects::(anonymous namespace)::bind_return> () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#11 0x00002b28e6f9fc9e in ?? () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#12 0x00002b28e5380033 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#13 0x00002b28e53fb919 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#14 0x00002b28e54016c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#15 0x00002b28e5401702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#16 0x00002b28e5424561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#17 0x00002b28e53f88a4 in ?? () from /usr/lib/libpython2.5.so.1.0
#18 0x00002b28e54008d5 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#19 0x00002b28e54016c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#20 0x00002b28e5401702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#21 0x00002b28e5424561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#22 0x00002b28e54247e8 in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#23 0x00002b28f2e44c1b in PythonUI::execScript (script=@0x7fffc578c8b0) at gui/py/PythonUI.cpp:42
#24 0x00002b28f2e45ae2 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:92
#25 0x00002b28f2e462e2 in PythonUI::run (this=0x9ccf80, argc=3, argv=0x7fffc578d470) at gui/py/PythonUI.cpp:121
#26 0x00000000005703d5 in main (argc=3, argv=0x7fffc578d470) at core/yade.cpp:255
#0  0x00000030010961d1 in nanosleep () from /lib/libc.so.6


From dorofeenko at icp.ac.ru  Mon Jun  9 09:25:05 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Mon, 9 Jun 2008 11:25:05 +0400
Subject: [yade-dev] MomentumLaw
Message-ID: <200806091125.05461.dorofeenko@icp.ac.ru>

Hi!
Is NewtonsMomentumLaw correctly for non-spherical bodies?
As I understand, inertia tensor raised in the principal axes, but the
momentum raised in the global axes... So

rb->angularAcceleration=diagDiv(am->momentum,rb->inertia);

is not correct, as me seems...

-- 
Best regards, Sergei D.


From bruno.chareyre at hmg.inpg.fr  Mon Jun  9 18:24:29 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Mon, 09 Jun 2008 18:24:29 +0200
Subject: [yade-dev] MomentumLaw
In-Reply-To: <200806091125.05461.dorofeenko@icp.ac.ru>
References: <200806091125.05461.dorofeenko@icp.ac.ru>
Message-ID: <484D593D.3020606@hmg.inpg.fr>

I've kept the same question in mind for a while... still not sure, but 
you may be right. Tell me more when you are sure of that. :)
I remember there are complex procedures to tackle this problem in some 
other codes, I don't see why we could avoid that in Yade...

Bruno


sega a ?crit :
> Hi!
> Is NewtonsMomentumLaw correctly for non-spherical bodies?
> As I understand, inertia tensor raised in the principal axes, but the
> momentum raised in the global axes... So
> 
> rb->angularAcceleration=diagDiv(am->momentum,rb->inertia);
> 
> is not correct, as me seems...
> 




From eudoxos at arcig.cz  Mon Jun  9 13:52:58 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Mon, 09 Jun 2008 13:52:58 +0200
Subject: [yade-dev] MomentumLaw
In-Reply-To: <200806091125.05461.dorofeenko@icp.ac.ru>
References: <200806091125.05461.dorofeenko@icp.ac.ru>
Message-ID: <484D199A.1010507@arcig.cz>

sega napsal(a):
> Hi!
> Is NewtonsMomentumLaw correctly for non-spherical bodies?
> As I understand, inertia tensor raised in the principal axes, but the
> momentum raised in the global axes... So
>
> rb->angularAcceleration=diagDiv(am->momentum,rb->inertia);
>
> is not correct, as me seems...
>   
It seems indeed invalid; inertia tensor is in body-local (=principal)
axes and the PhysicalActionApplier doesn't do any transformation before
the physical action (which is in global coordinates) is applied. (I am
wondering whether this might be the reason that the exact tetrahedra
implementation I attempted never worked right?).





From eudoxos at arcig.cz  Tue Jun 10 11:21:45 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Tue, 10 Jun 2008 11:21:45 +0200
Subject: [yade-dev] svn1372 crash
In-Reply-To: <20080605211551.046134f6@absurd>
References: <200806031403.34371.dorofeenko@icp.ac.ru>	<48454B58.1060600@hmg.inpg.fr>
	<48454CE6.3000908@hmg.inpg.fr>	<20080604001803.0e93ad05@absurd>
	<4846379B.9030407@arcig.cz> <20080605211551.046134f6@absurd>
Message-ID: <484E47A9.5060309@arcig.cz>


> - The "Refresh [ms]" option doesn't work. 
> - The "sync. display" option behaves incorrectly (try it)
> - enlarging simulation controller doesn't enlarge it's insides which
>   is unfriendly. (still need to scroll inside the window, to checkbox
>   the options)
>   
Thanks for your reports. I fixed all that in r1382 (last commit).

> Besides, what's the purpose on removing old but still _working_ (and
> tested) interfaces?
>   
I know the gui was not as stable as the old one, but trunk is not
release and unless people use it, bugs will never be reported and fixed.

Regards, Vaclav


From bruno.chareyre at hmg.inpg.fr  Wed Jun 11 12:56:15 2008
From: bruno.chareyre at hmg.inpg.fr (chareyre)
Date: Wed, 11 Jun 2008 12:56:15 +0200
Subject: [yade-dev] Intergator and clumps
Message-ID: <484FAF4F.90101@hmg.inpg.fr>


This is mainly for Va?lav.

I have two worries with the current code for clumps in NewtonsDampedLaw.

1/ Forces are damped based on the motion of each body. As a consequence, 
different contact forces on the same clump will be damped independently. 
Its a bit like damping separately each individual force applied on a 
standalone body. The very bad effect of this is that a body at static 
equilibrium can be moved out of equilibrium by damping effect (i.e. the 
exact opposite of what damping is supposed to do...).
The correct way to damp is to damp the resultant force/moment on a clump 
based on the motion of the clump.

2/ From what I see in the code, if a clump has bodies "i" and "j", I 
fear the integration loop could make something like (depending on the 
ordering of bodies):
 
on body i : clump->acceleration += i->force/clump->mass
on clump : clump->velocity += clump->acceleration*dt
on body j : clump->acceleration += j->force/clump->mass

so that forces on clump member j are ignored in the motion of the clump...

Is there something to prevent that? Are clumps always at the end of the 
loop?


Bruno
 




From eudoxos at arcig.cz  Wed Jun 11 21:36:04 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 11 Jun 2008 21:36:04 +0200
Subject: [yade-dev] Intergator and clumps
In-Reply-To: <484FAF4F.90101@hmg.inpg.fr>
References: <484FAF4F.90101@hmg.inpg.fr>
Message-ID: <48502924.9020904@arcig.cz>


> 1/ Forces are damped based on the motion of each body. As a consequence, 
> different contact forces on the same clump will be damped independently. 
> Its a bit like damping separately each individual force applied on a 
> standalone body. The very bad effect of this is that a body at static 
> equilibrium can be moved out of equilibrium by damping effect (i.e. the 
> exact opposite of what damping is supposed to do...).
> The correct way to damp is to damp the resultant force/moment on a clump 
> based on the motion of the clump.
>   
I wasn't sure what the correct way was, but please fell free to adjust
that. If you do, however, make sure that the same is done in the
original engines (CundallNonViscous etc) so that the behavior is consistent.
> 2/ From what I see in the code, if a clump has bodies "i" and "j", I 
> fear the integration loop could make something like (depending on the 
> ordering of bodies):
>  
> on body i : clump->acceleration += i->force/clump->mass
> on clump : clump->velocity += clump->acceleration*dt
> on body j : clump->acceleration += j->force/clump->mass
>
> so that forces on clump member j are ignored in the motion of the clump...
>
> Is there something to prevent that? Are clumps always at the end of the 
> loop?
>   
Currently, the ordering of IDs of clump and its members is undefined.
There are 2 ways out of this, it seems to me:

1. Add an extra loop that would apply forces on clump members to clump
itself, before calculating clump acceleration. Perhaps a flag on
NewtonsDampedLaw so that the loop would be run only if clumps were
actually in use. That could be either set by the user (like you have to
set distant flag for the collider to make it work) or by the engine
itself: at each iteration, it would remember whether some bodies were
actually clumps - if so, the flag would be turned on and you would get
the extra loop run at next iteration; you would miss just the first
iteration, which is negligible. If the clump loop would run , at some
point, without doing any work, it would switch that flag off automatically.

2. Prescribe such ordering of clumps and its members so that the problem
is prevented. It is not very user-friendly, but could be enforced by
assertions/exceptions when the clump is created. But having bodies
behave depending on their ID seems weird (non-intuitive).

PS. I wonder if there is anyone using clumps actually (I don't need them
now); there can be problem with shear forces, since clump members have
zero velocities, even if they move (they are moved by a special engine);
since shear displacement is frequently calculated from angularVelocity,
it will give zero. It could be fixed (angularVelocity of each member
would be calculated from clump's angular velocity) but it has not been
done yet.

Vaclav



From bruno.chareyre at hmg.inpg.fr  Thu Jun 12 10:23:43 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Thu, 12 Jun 2008 10:23:43 +0200
Subject: [yade-dev] Intergator and clumps
In-Reply-To: <48502924.9020904@arcig.cz>
References: <484FAF4F.90101@hmg.inpg.fr> <48502924.9020904@arcig.cz>
Message-ID: <4850DD0F.1050508@hmg.inpg.fr>


Ok, thank you for details.
I wonder if we can't move clumps at the end of MB->bodies without 
changing ids...

For clump members velocity it should be easy to define in the 
displacement engine.

Bruno


Va'clav S a e'crit :
>> 1/ Forces are damped based on the motion of each body. As a consequence, 
>> different contact forces on the same clump will be damped independently. 
>> Its a bit like damping separately each individual force applied on a 
>> standalone body. The very bad effect of this is that a body at static 
>> equilibrium can be moved out of equilibrium by damping effect (i.e. the 
>> exact opposite of what damping is supposed to do...).
>> The correct way to damp is to damp the resultant force/moment on a clump 
>> based on the motion of the clump.
>>   
>>     
> I wasn't sure what the correct way was, but please fell free to adjust
> that. If you do, however, make sure that the same is done in the
> original engines (CundallNonViscous etc) so that the behavior is consistent.
>   
>> 2/ From what I see in the code, if a clump has bodies "i" and "j", I 
>> fear the integration loop could make something like (depending on the 
>> ordering of bodies):
>>  
>> on body i : clump->acceleration += i->force/clump->mass
>> on clump : clump->velocity += clump->acceleration*dt
>> on body j : clump->acceleration += j->force/clump->mass
>>
>> so that forces on clump member j are ignored in the motion of the clump...
>>
>> Is there something to prevent that? Are clumps always at the end of the 
>> loop?
>>   
>>     
> Currently, the ordering of IDs of clump and its members is undefined.
> There are 2 ways out of this, it seems to me:
>
> 1. Add an extra loop that would apply forces on clump members to clump
> itself, before calculating clump acceleration. Perhaps a flag on
> NewtonsDampedLaw so that the loop would be run only if clumps were
> actually in use. That could be either set by the user (like you have to
> set distant flag for the collider to make it work) or by the engine
> itself: at each iteration, it would remember whether some bodies were
> actually clumps - if so, the flag would be turned on and you would get
> the extra loop run at next iteration; you would miss just the first
> iteration, which is negligible. If the clump loop would run , at some
> point, without doing any work, it would switch that flag off automatically.
>
> 2. Prescribe such ordering of clumps and its members so that the problem
> is prevented. It is not very user-friendly, but could be enforced by
> assertions/exceptions when the clump is created. But having bodies
> behave depending on their ID seems weird (non-intuitive).
>
> PS. I wonder if there is anyone using clumps actually (I don't need them
> now); there can be problem with shear forces, since clump members have
> zero velocities, even if they move (they are moved by a special engine);
> since shear displacement is frequently calculated from angularVelocity,
> it will give zero. It could be fixed (angularVelocity of each member
> would be calculated from clump's angular velocity) but it has not been
> done yet.
>
> Vaclav
>
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
Te'l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Thu Jun 12 14:38:51 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Thu, 12 Jun 2008 14:38:51 +0200
Subject: [yade-dev] cool! & postprocessor
Message-ID: <485118DB.9070001@arcig.cz>

This is about the first time I have some good results with my model, the
plotting interface and python:
http://beta.arcig.cz/~eudoxos/yade/uncalibrated-compression-damage.png

Sergei, you were asking about a post-processor a few weeks/months ago,
did you find anything useful? Otherwise, I will (soon?) add clipping
planes to the GL renderer, but something more intuitive than what  we
have now: like two parallel planes stable in space, the ability to
manipulate them and so on.

Regards, Vaclav





From dorofeenko at icp.ac.ru  Fri Jun 13 13:06:47 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Fri, 13 Jun 2008 15:06:47 +0400
Subject: [yade-dev] cool! & postprocessor
In-Reply-To: <485118DB.9070001@arcig.cz>
References: <485118DB.9070001@arcig.cz>
Message-ID: <200806131506.53436.dorofeenko@icp.ac.ru>

> Sergei, you were asking about a post-processor a few weeks/months ago,
> did you find anything useful? 
Not yet.

> Otherwise, I will (soon?) add clipping 
> planes to the GL renderer, but something more intuitive than what  we
> have now: like two parallel planes stable in space, the ability to
> manipulate them and so on.

Yes, this is a very useful feature.
And it would be very great if SimulationPlayer also has this feature.
Let invite a few more, I think, useful features, to realize that, I think, would not be difficult:
1. For SimulationPlayer: backward and jump to a certain frame number; 
management display of bodies as in SimulationCntroller; toggle orthogonal/perspective view.
2. Look along the axis X, along the axis Y  and along the axis Z 
(propose keys num1, num3, num7  as in Blender).

-- 
Best regards, Sergei D.


From eudoxos at arcig.cz  Fri Jun 13 14:38:03 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Fri, 13 Jun 2008 14:38:03 +0200
Subject: [yade-dev] cool! & postprocessor
In-Reply-To: <200806131506.53436.dorofeenko@icp.ac.ru>
References: <485118DB.9070001@arcig.cz>
	<200806131506.53436.dorofeenko@icp.ac.ru>
Message-ID: <48526A2B.5080208@arcig.cz>


> 1. For SimulationPlayer: backward and jump to a certain frame number; 
> management display of bodies as in SimulationCntroller; toggle orthogonal/perspective view.
>   
I don't like simulation player that much since it can only display
bodies (and their colors), not interactions with parameters etc. For
that reason you will never be able to display everything you get in
SimulationController. Read the player code, it just reads se3 from ASCII
file (and RGB from another file), nothing more, there is no simulation
being done really.

What I count on rather is off-screen rendering with QGLViewer, which
should be possible, but I haven't tried it yet: you can have Camera
without associated GLView; the we would be able to periodically save
.png during simulation and make video from that (and make it faster and
so on).

> 2. Look along the axis X, along the axis Y  and along the axis Z 
> (propose keys num1, num3, num7  as in Blender).
>   
If you find in QGLViewer docs how to do that, makeing the bindings is
easy. Look in GLViewer:66, in void GLViewer::keyPressEvent(QKeyEvent *e).




From dorofeenko at icp.ac.ru  Fri Jun 13 15:50:14 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Fri, 13 Jun 2008 17:50:14 +0400
Subject: [yade-dev] cool! & postprocessor
In-Reply-To: <48526A2B.5080208@arcig.cz>
References: <485118DB.9070001@arcig.cz>
	<200806131506.53436.dorofeenko@icp.ac.ru>
	<48526A2B.5080208@arcig.cz>
Message-ID: <200806131750.15078.dorofeenko@icp.ac.ru>

> 
> > 1. For SimulationPlayer: backward and jump to a certain frame number; 
> > management display of bodies as in SimulationCntroller; toggle orthogonal/perspective view.
> >   
> I don't like simulation player that much since it can only display
> bodies (and their colors), not interactions with parameters etc. For
> that reason you will never be able to display everything you get in
> SimulationController. Read the player code, it just reads se3 from ASCII
> file (and RGB from another file), nothing more, there is no simulation
> being done really.
> 
> What I count on rather is off-screen rendering with QGLViewer, which
> should be possible, but I haven't tried it yet: you can have Camera
> without associated GLView; the we would be able to periodically save
> .png during simulation and make video from that (and make it faster and
> so on).
> 

Will be difficult to add functionality of the player to the controller?
As me seems, for a large modeling will be more convenient to save the modelling results 
(positions, orientations, maybe forces...) and process them later 
than planned simulation and visualization at the same time...

-- 
Best regards, Sergei D.


From bruno.chareyre at hmg.inpg.fr  Fri Jun 13 16:45:02 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Fri, 13 Jun 2008 16:45:02 +0200
Subject: [yade-dev] cool! & postprocessor
In-Reply-To: <200806131750.15078.dorofeenko@icp.ac.ru>
References: <485118DB.9070001@arcig.cz>	<200806131506.53436.dorofeenko@icp.ac.ru>	<48526A2B.5080208@arcig.cz>
	<200806131750.15078.dorofeenko@icp.ac.ru>
Message-ID: <485287EE.1050000@hmg.inpg.fr>


>>
>> What I count on rather is off-screen rendering with QGLViewer, which
>> should be possible, but I haven't tried it yet: you can have Camera
>> without associated GLView; the we would be able to periodically save
>> .png during simulation and make video from that (and make it faster and
>> so on).
>>
>>     
>
> Will be difficult to add functionality of the player to the controller?
> As me seems, for a large modeling will be more convenient to save the modelling results 
> (positions, orientations, maybe forces...) and process them later 
> than planned simulation and visualization at the same time...
>
>   
The problem is somebody else will want to draw velocity, stiffness, 
volume of Voronoi cells, local deformation, or anything else I don't 
even suspect. So, saving all possible modelling results in periodic 
snapshots is impossible.
Off-screen rendering sounds more realistic to me, only problem is you 
will have to set camera position before the simulation.

Bruno






-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From dorofeenko at icp.ac.ru  Fri Jun 13 19:04:47 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Fri, 13 Jun 2008 21:04:47 +0400
Subject: [yade-dev] cool! & postprocessor
In-Reply-To: <485287EE.1050000@hmg.inpg.fr>
References: <485118DB.9070001@arcig.cz>
	<200806131750.15078.dorofeenko@icp.ac.ru>
	<485287EE.1050000@hmg.inpg.fr>
Message-ID: <200806132104.47922.dorofeenko@icp.ac.ru>

   
> The problem is somebody else will want to draw velocity, stiffness, 
> volume of Voronoi cells, local deformation, or anything else I don't 
> even suspect. So, saving all possible modelling results in periodic 
> snapshots is impossible.
> Off-screen rendering sounds more realistic to me, only problem is you 
> will have to set camera position before the simulation.

I think that really when planning the simulation to select parameters that 
will be needed in the future for postprocessing. It is clear that in the 
future if I want to work only with the Voronoi cells, I need only to save 
these values and nothing more. And in the future I always be able to 
visualize this Voronoi cells and see it from a new angle (clipping plane, 
color scheme, etc...). (By the way, not necessarily to save velocity. It can 
be obtained from two consecutive positions snapshots.). 
In doing so, off-screen rendering sounds fine and in this case: you can 
configure a new look and also start to render the scene in background.
If I will have to set camera only before the simulation, I will have to set 
_all_ cameras (all foreshortening, clipping planes, color shemes).To me, this 
is not so easy... In my opinion, it is better to separate the simulation and 
visualization. How do you think?

-- 
Best regards, Sergei D.


From bruno.chareyre at hmg.inpg.fr  Mon Jun 16 12:35:39 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Mon, 16 Jun 2008 12:35:39 +0200
Subject: [yade-dev] cool! & postprocessor
In-Reply-To: <200806132104.47922.dorofeenko@icp.ac.ru>
References: <485118DB.9070001@arcig.cz>	<200806131750.15078.dorofeenko@icp.ac.ru>	<485287EE.1050000@hmg.inpg.fr>
	<200806132104.47922.dorofeenko@icp.ac.ru>
Message-ID: <485641FB.4040107@hmg.inpg.fr>

sega a ?crit :
>    
>   
>> The problem is somebody else will want to draw velocity, stiffness, 
>> volume of Voronoi cells, local deformation, or anything else I don't 
>> even suspect. So, saving all possible modelling results in periodic 
>> snapshots is impossible.
>> Off-screen rendering sounds more realistic to me, only problem is you 
>> will have to set camera position before the simulation.
>>     
>
> I think that really when planning the simulation to select parameters that 
> will be needed in the future for postprocessing. It is clear that in the 
> future if I want to work only with the Voronoi cells, I need only to save 
> these values and nothing more. And in the future I always be able to 
> visualize this Voronoi cells and see it from a new angle (clipping plane, 
> color scheme, etc...). (By the way, not necessarily to save velocity. It can 
> be obtained from two consecutive positions snapshots.). 
> In doing so, off-screen rendering sounds fine and in this case: you can 
> configure a new look and also start to render the scene in background.
> If I will have to set camera only before the simulation, I will have to set 
> _all_ cameras (all foreshortening, clipping planes, color shemes).To me, this 
> is not so easy... In my opinion, it is better to separate the simulation and 
> visualization. How do you think?
>
>   
I agree that separating simulation and visualisation would be better 
(besides it needs more file management before actually getting the 
animation), but the problem is (I think) it needs more coding.

Offscreen rendering needs no new method. Anything drawable in Yade can 
be seen on snapshots, directly converted from graphic card output to 
image file (for setting camera and other QGL parameters, I guess we can 
use files like the preferences.xml we have in ~/.yade).

If we go for separating simulation/rendering, we need 2 more methods for 
each type of drawable : writing GL object to file + loading GL object 
from file, and we also need the code and interface for tuning which 
types of objects we want to save in snapshots.
Sounds more difficult, but of course it has the advantage of being a lot 
more versatile.

Actually, both approaches can co-exist in Yade. So, if you feel like 
coding the saving/loading of velocity field in text snapshots, it will 
be usefull. And if later we have offscreen rendering, it will be a quick 
solution for all those objects that are not included in text snapshots.

Bruno

-- 
 
_______________
Chareyre Bruno
Maitre de conference

Institut National Polytechnique de Grenoble
Laboratoire 3S (Soils Solids Structures) - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Mon Jun 16 15:11:11 2008
From: eudoxos at arcig.cz (=?windows-1252?Q?V=E1clav_=8Amilauer?=)
Date: Mon, 16 Jun 2008 15:11:11 +0200
Subject: [yade-dev] [Fwd: Re: [Berlios-contact] sheep:/usr/bin/svnserver is
 not eXectubale for	users]
Message-ID: <4856666F.4090808@arcig.cz>


-------------- next part --------------
An embedded message was scrubbed...
From: Lutz Henckel <lutz.henckel at fokus.fraunhofer.de>
Subject: Re: [Berlios-contact] sheep:/usr/bin/svnserver is not eXectubale for	users
Date: Mon, 16 Jun 2008 15:06:45 +0200
Size: 4002
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080616/6b37852d/attachment.eml>

From jerier at geo.hmg.inpg.fr  Mon Jun 16 19:27:02 2008
From: jerier at geo.hmg.inpg.fr (jerier at geo.hmg.inpg.fr)
Date: Mon, 16 Jun 2008 13:27:02 -0400
Subject: [yade-dev] a training period
Message-ID: <380-22008611617272920@M2W006.mail2web.com>


Hello,

 In my laboratory, soon i will receive one student for a two-month training
period. He works in computers.  
I don?t know the priority on the YADE development, but if anyone can give
me an interesting proposition (a subject) for him. In order to the student
realizes a work in his competence.
   
Information about him: He wants to specialize the next year on the
optimization algorithms. He has already realised different projects in C++.

Thank you, i wait your proposition.

JF


--------------------------------------------------------------------
mail2web.com ? Enhanced email for the mobile individual based on Microsoft?
Exchange - http://link.mail2web.com/Personal/EnhancedEmail




From eudoxos at arcig.cz  Tue Jun 17 18:20:42 2008
From: eudoxos at arcig.cz (=?UTF-8?B?VsOhY2xhdiDFoG1pbGF1ZXI=?=)
Date: Tue, 17 Jun 2008 18:20:42 +0200
Subject: [yade-dev] a training period
In-Reply-To: <380-22008611617272920@M2W006.mail2web.com>
References: <380-22008611617272920@M2W006.mail2web.com>
Message-ID: <4857E45A.4080007@arcig.cz>

Jeff,

we discussed it with Bruno on IRC. We were both waiting for the other to
make reply ;-). There was multiple things to consider:

1. Parallel computation using openMP (non-intrusive shared memory) could
be tried and benchmarked. Further optimizations may include analyzing
bottlenecks of execution and eliminating those. Very nice for someone
who is into optimization, numerics and wants to learn. Difficulty:
medium (I think).

2. Serialization (and attribute access) in yade. Seems very difficult,
since we need to balance speed, ease of use and non-intrusiveness.
Difficulty: high.

3. Python, which uses serialization at this moment, which is not
efficient; further, bindings should be automatized. I would be able to
supervise this. Difficulty: high.

If you need more details, contact me or Bruno, privately or on-list.

Regards, Vaclav

> JHello,
>
>  In my laboratory, soon i will receive one student for a two-month training
> period. He works in computers.  
> I don?t know the priority on the YADE development, but if anyone can give
> me an interesting proposition (a subject) for him. In order to the student
> realizes a work in his competence.
>    
> Information about him: He wants to specialize the next year on the
> optimization algorithms. He has already realised different projects in C++.
>
> Thank you, i wait your proposition.
>
> JF
>
>
> --------------------------------------------------------------------
> mail2web.com ? Enhanced email for the mobile individual based on Microsoft?
> Exchange - http://link.mail2web.com/Personal/EnhancedEmail
>
>
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   



From eudoxos at arcig.cz  Tue Jun 17 18:50:01 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Tue, 17 Jun 2008 18:50:01 +0200
Subject: [yade-dev] g++-4.3 speedups
Message-ID: <4857EB39.9010103@arcig.cz>

Hi, I forgot to add to the mail about 80% speedup with g++-4.3 and
vectorization: if you are on recent ubuntu (hutsy/hardy/intrepid), you
can get gcc snapshots (can be installed and used in parallel, no worry)
packages here: https://launchpad.net/~ubuntu-toolchain/+archive.
Regards, Vaclav


From jerier at geo.hmg.inpg.fr  Tue Jun 17 19:09:59 2008
From: jerier at geo.hmg.inpg.fr (jerier at geo.hmg.inpg.fr)
Date: Tue, 17 Jun 2008 13:09:59 -0400
Subject: [yade-dev] a training period
Message-ID: <380-22008621717959986@M2W027.mail2web.com>



Hi Vaclav,

 Thanks you for these interesting topics. Bruno summarized me your
discussion, and we have chosen the subjects concerning: the multhreading
with openMP and the Python optimization on YADE. Normally, if i find a
second available computer in this period, i will receive another student.
So, in the two circumstances, i'll need you and bruno to start the topic
about Python or multhreading.

Thanks again, Keep in touch 

JF


Original Message:
-----------------
From: V??clav ? milauer eudoxos at arcig.cz
Date: Tue, 17 Jun 2008 18:20:42 +0200
To: jerier at geo.hmg.inpg.fr, yade-dev at lists.berlios.de
Subject: Re: [yade-dev] a training period


Jeff,

we discussed it with Bruno on IRC. We were both waiting for the other to
make reply ;-). There was multiple things to consider:

1. Parallel computation using openMP (non-intrusive shared memory) could
be tried and benchmarked. Further optimizations may include analyzing
bottlenecks of execution and eliminating those. Very nice for someone
who is into optimization, numerics and wants to learn. Difficulty:
medium (I think).

2. Serialization (and attribute access) in yade. Seems very difficult,
since we need to balance speed, ease of use and non-intrusiveness.
Difficulty: high.

3. Python, which uses serialization at this moment, which is not
efficient; further, bindings should be automatized. I would be able to
supervise this. Difficulty: high.

If you need more details, contact me or Bruno, privately or on-list.

Regards, Vaclav

> JHello,
>
>  In my laboratory, soon i will receive one student for a two-month
training
> period. He works in computers.  
> I don???t know the priority on the YADE development, but if anyone can
give
> me an interesting proposition (a subject) for him. In order to the student
> realizes a work in his competence.
>    
> Information about him: He wants to specialize the next year on the
> optimization algorithms. He has already realised different projects in
C++.
>
> Thank you, i wait your proposition.
>
> JF
>
>
> --------------------------------------------------------------------
> mail2web.com ??? Enhanced email for the mobile individual based on
Microsoft??
> Exchange - http://link.mail2web.com/Personal/EnhancedEmail
>
>
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


--------------------------------------------------------------------
mail2web.com - Microsoft? Exchange solutions from a leading provider -
http://link.mail2web.com/Business/Exchange




From eudoxos at arcig.cz  Wed Jun 18 17:59:58 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 18 Jun 2008 17:59:58 +0200
Subject: [yade-dev] [Yade-commits] r1394 - in trunk: examples
	pkg/common	pkg/common/Engine/DeusExMachina
In-Reply-To: <200806181329.m5IDTZTg028519@sheep.berlios.de>
References: <200806181329.m5IDTZTg028519@sheep.berlios.de>
Message-ID: <485930FE.9040205@arcig.cz>


> +void ResetPositionEngine::registerAttributes(){
> +	DeusExMachina::registerAttributes(); // for subscribedBodies
> +	REGISTER_ATTRIBUTE(interval);
>   
Have a look at pkg/common/Engine/StandAloneEngine/PeriodicEngines.hpp.
If you inherit your ResetPositionEngine from PeriodicEngine, you can
control the interval by simulation time, world time or iteration number
(and you get all that for free). I did that because I was fed up with
always writing code checking and interval that elapsed - see
BrefcomDamageColorizer for an example. Regards, Vaclav


From eudoxos at arcig.cz  Wed Jun 18 19:50:14 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 18 Jun 2008 19:50:14 +0200
Subject: [yade-dev] [Yade-commits] r1397 - in branches/przewdnik: core
	gui/qt3	pkg/common/Engine/StandAloneEngine/Visualisation
In-Reply-To: <200806181714.m5IHEZ6G008005@sheep.berlios.de>
References: <200806181714.m5IHEZ6G008005@sheep.berlios.de>
Message-ID: <48594AD6.4060703@arcig.cz>

You're using awfully outdated branch. There was big cleanup (by me;-) )
in the qt3 interface, bear that at least in mind. Otherwise merging will
be difficult afterwards. Regards, Vaclav
> Modified: branches/przewdnik/gui/qt3/SimulationController.cpp
> ===================================================================
> --- branches/przewdnik/gui/qt3/SimulationController.cpp	2008-06-18 15:47:25 UTC (rev 1396)
> +++ branches/przewdnik/gui/qt3/SimulationController.cpp	2008-06-18 17:14:33 UTC (rev 1397)
> @@ -32,6 +32,9 @@
>  	sync=false;
>  	refreshTime = 20;
>  	parentWorkspace = parent;
> +	
> +	queue = InterprocessQueue<BodyContainer>();
> +	queue.init("vis_queue");
>  
>  	scrollViewFrame = new QFrame();	
>  	
> @@ -437,6 +440,9 @@
>  void SimulationController::timerEvent( QTimerEvent* )
>  {
>  	updater->oneLoop();
> +	BodyContainer bc;
> +	queue.pop(bc);
> +	Omega::instance().setVisualisationBody(bc);
>  	redrawAll();
>  	if(sync)
>  		Omega::instance().spawnSingleSimulationLoop();
>
>   



From eudoxos at arcig.cz  Sun Jun 22 00:08:23 2008
From: eudoxos at arcig.cz (eudoxos at arcig.cz)
Date: Sun, 22 Jun 2008 00:08:23 +0200 (CEST)
Subject: [yade-dev] Automated crash report for
	/tmp/yade-5427/bin/yade-svn1397:	SDECLinkedSpheres, ScrewGen,
	TetraTestGen, ThreePointBending
Message-ID: <20080621220823.9B42B180013@delta>

################################################################################
SDECLinkedSpheres: simulation CRASH
################################################################################
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
yade-svn1397: /usr/include/boost/shared_ptr.hpp:253: T* boost::shared_ptr<T>::operator->() const [with T = SpheresContactGeometry]: Assertion `px != 0' failed.
Running script /tmp/yade-test-8125.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1397/gdb_crash_batch-pid8173'
GNU gdb 6.6-debian
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Using host libthread_db library "/lib/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread 47694327030464 (LWP 8173)]
[New Thread 1082132800 (LWP 8174)]
0x00000030010961d1 in nanosleep () from /lib/libc.so.6
No symbol "info" in current context.

Thread 2 (Thread 1082132800 (LWP 8174)):
#0  0x0000003001095b2f in waitpid () from /lib/libc.so.6
#1  0x000000300103c763 in ?? () from /lib/libc.so.6
#2  0x000000300103cad7 in system () from /lib/libc.so.6
#3  0x000000000057228a in sigHandler (sig=6) at core/yade.cpp:58
#4  <signal handler called>
#5  0x0000003001030cab in raise () from /lib/libc.so.6
#6  0x0000003001032660 in abort () from /lib/libc.so.6
#7  0x000000300102a436 in __assert_fail () from /lib/libc.so.6
#8  0x00002b60bcdc0eb3 in boost::shared_ptr<SpheresContactGeometry>::operator-> (this=0x407ffca0) at /usr/include/boost/shared_ptr.hpp:253
#9  0x00002b60bcfeed60 in InteractingSphere2InteractingSphere4SpheresContactGeometry::go (this=0xa679b0, cm1=@0xa6e7b8, cm2=@0xa6f168, se31=@0xa6eb10, se32=@0xa6f230, c=@0x407ffdd0) at pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp:69
#10 0x00002b60ba705851 in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<InteractingGeometry, Loki::NullType> >, InteractionGeometryEngineUnit, bool, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Se3<double> const&, Loki::Typelist<boost::shared_ptr<Interaction> const&, Loki::NullType> > > > >, false>::operator() (this=0xa681f8, base1=@0xa6e7b8, base2=@0xa6f168, p3=@0xa6eb10, p4=@0xa6f230, p5=@0x407ffdd0) at /tmp/yade-5427/build-svn1397/include/yade-svn1397/yade/lib-multimethods/DynLibDispatcher.hpp:882
#11 0x00002b60ba6fa035 in InteractionGeometryMetaEngine::action (this=0xa681b0, ncb=0xa656c0) at pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.cpp:31
#12 0x0000000000517b24 in MetaBody::moveToNextTimeStep (this=0xa656c0) at core/MetaBody.cpp:101
#13 0x00000000005693f8 in SimulationFlow::singleAction (this=0x809620) at core/SimulationFlow.cpp:17
#14 0x000000000056b003 in ThreadWorker::callSingleAction (this=0x809620) at core/ThreadWorker.cpp:71
#15 0x000000000056a81c in ThreadRunner::call (this=0xa60710) at core/ThreadRunner.cpp:42
#16 0x000000000056a87a in ThreadRunner::run (this=0xa60710) at core/ThreadRunner.cpp:21
#17 0x000000000056abe2 in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x9a7fc0, p=0xa60710) at /usr/include/boost/bind/mem_fn_template.hpp:45
#18 0x000000000056ac4f in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x9a7fd0, f=@0x9a7fc0, a=@0x4080004f) at /usr/include/boost/bind.hpp:230
#19 0x000000000056ac8c in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x9a7fc0) at /usr/include/boost/bind/bind_template.hpp:20
#20 0x000000000056acab in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr={obj_ptr = 0x9a7fc0, const_obj_ptr = 0x9a7fc0, func_ptr = 0x9a7fc0, data = "?"}) at /usr/include/boost/function/function_template.hpp:136
#21 0x00002b60b01ec8cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#22 0x00002b60b01ec2ef in ?? () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#23 0x00000030024062a5 in start_thread () from /lib/libpthread.so.0
#24 0x00000030010cf61d in clone () from /lib/libc.so.6
#25 0x0000000000000000 in ?? ()

Thread 1 (Thread 47694327030464 (LWP 8173)):
#0  0x00000030010961d1 in nanosleep () from /lib/libc.so.6
#1  0x00000030010c9134 in usleep () from /lib/libc.so.6
#2  0x00002b60d9704992 in pyOmega::wait (this=0xa5aca0) at gui/py/yadeControl.cpp:430
#3  0x00002b60d9640731 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0xa413b8, tc=@0x7ffffafadef0) at /usr/include/boost/python/detail/invoke.hpp:94
#4  0x00002b60d969aebe in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0xa413b8, args_=0x2b60b69dd890) at /usr/include/boost/python/detail/caller.hpp:199
#5  0x00002b60d969af11 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0xa413b0, args=0x2b60b69dd890, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#6  0x00002b60b177e89d in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#7  0x00002b60b177f825 in boost::detail::function::void_function_obj_invoker0<boost::python::objects::(anonymous namespace)::bind_return, void>::invoke () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#8  0x00002b60b01ec8cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#9  0x00002b60b17848f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#10 0x00002b60b177edb7 in boost::python::handle_exception<boost::python::objects::(anonymous namespace)::bind_return> () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#11 0x00002b60b177bc9e in ?? () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#12 0x00002b60afb5c033 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#13 0x00002b60afbd7919 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#14 0x00002b60afbdd6c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#15 0x00002b60afbdd702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#16 0x00002b60afc00561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#17 0x00002b60afbd48a4 in ?? () from /usr/lib/libpython2.5.so.1.0
#18 0x00002b60afbdc8d5 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#19 0x00002b60afbdd6c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#20 0x00002b60afbdd702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#21 0x00002b60afc00561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#22 0x00002b60afc007e8 in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#23 0x00002b60c06cabe3 in PythonUI::execScript (script=@0x7ffffafaf030) at gui/py/PythonUI.cpp:44
#24 0x00002b60c06cbbba in PythonUI::pythonSession () at gui/py/PythonUI.cpp:95
#25 0x00002b60c06cc849 in PythonUI::run (this=0x988710, argc=3, argv=0x7ffffafafca0) at gui/py/PythonUI.cpp:127
#26 0x0000000000571d2e in main (argc=3, argv=0x7ffffafafca0) at core/yade.cpp:255
#0  0x00000030010961d1 in nanosleep () from /lib/libc.so.6

################################################################################
ScrewGen: generator CRASH
################################################################################
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
yade-svn1397: /tmp/yade-5427/build-svn1397/include/yade-svn1397/yade/lib-multimethods/DynLibDispatcher.hpp:447: bool DynLibDispatcher<BaseClass, Executor, ResultType, TList, autoSymmetry>::locateMultivirtualFunctor2D(int&, int&, boost::shared_ptr<typename Loki::TL::TypeAtNonStrict<typename Loki::TL::Append<Loki::NullType, T>::Result, 0u, Loki::NullType>::Result>&, boost::shared_ptr<typename Loki::TL::TypeAtNonStrict<typename Loki::TL::Append<Loki::NullType, T>::Result, 1u, Loki::NullType>::Result>&) [with BaseClass = Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, Executor = BoundingVolumeEngineUnit, ResultType = void, TList = Loki::Typelist<const boost::shared_ptr<InteractingGeometry>&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<const Se3r&, Loki::Typelist<const Body*, Loki::NullType> > > >, bool autoSymmetry = true]: Assertion `index1 >= 0 && (unsigned int)( index1 ) < callBacks.size() && index2 >= 0 && (unsigned 
 int)( index2 ) < callBacks[index1].size()' failed.
Running script /tmp/yade-test-8125.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1397/gdb_crash_batch-pid8193'
GNU gdb 6.6-debian
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Using host libthread_db library "/lib/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread 46939080032960 (LWP 8193)]
0x0000003001095af5 in waitpid () from /lib/libc.so.6
No symbol "info" in current context.

Thread 1 (Thread 46939080032960 (LWP 8193)):
#0  0x0000003001095af5 in waitpid () from /lib/libc.so.6
#1  0x000000300103c763 in ?? () from /lib/libc.so.6
#2  0x000000000057228a in sigHandler (sig=6) at core/yade.cpp:58
#3  <signal handler called>
#4  0x0000003001030cab in raise () from /lib/libc.so.6
#5  0x0000003001032660 in abort () from /lib/libc.so.6
#6  0x000000300102a436 in __assert_fail () from /lib/libc.so.6
#7  0x00002ab0e2cfc3ad in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, BoundingVolumeEngineUnit, void, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Body const*, Loki::NullType> > > >, true>::locateMultivirtualFunctor2D (this=0xa60788, index1=@0x7fffd33585ec, index2=@0x7fffd33585e8, base1=@0xa6a1c8, base2=@0xa6a1d8) at /tmp/yade-5427/build-svn1397/include/yade-svn1397/yade/lib-multimethods/DynLibDispatcher.hpp:446
#8  0x00002ab0e2cfc721 in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, BoundingVolumeEngineUnit, void, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Body const*, Loki::NullType> > > >, true>::operator() (this=0xa60788, base1=@0xa6a1c8, base2=@0xa6a1d8, p3=@0xa6a220, p4=0xa6a180) at /tmp/yade-5427/build-svn1397/include/yade-svn1397/yade/lib-multimethods/DynLibDispatcher.hpp:856
#9  0x00002ab0e2cf126f in BoundingVolumeMetaEngine::action (this=0xa60740, ncb=0xa60410) at pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine.cpp:27
#10 0x0000000000517c5c in MetaBody::runInitializers (this=0xa60410) at core/MetaBody.cpp:62
#11 0x0000000000517d17 in MetaBody::postProcessAttributes (this=0xa60410, deserializing=false) at core/MetaBody.cpp:68
#12 0x00002ab0d9a4f960 in Serializable::unregisterSerializableAttributes (this=0xa60410, deserializing=false) at lib/serialization/Serializable.cpp:29
#13 0x00002ab0de64c7e9 in XMLFormatManager::serializeSerializable (stream=@0x7fffd3358980, ac=@0xabd040, depth=1) at lib/serialization-xml/XMLFormatManager.cpp:168
#14 0x00002ab0de64b1d2 in XMLFormatManager::serializeSmartPointer (stream=@0x7fffd3358980, ac=@0xabcfb0, depth=1) at lib/serialization-xml/XMLFormatManager.cpp:284
#15 0x0000000000508811 in IOFormatManager::saveToFile<boost::shared_ptr<MetaBody> > (libName=@0xa438b0, fileName=@0xa438a8, name=@0x7fffd3358e90, t=@0xa43898) at /tmp/yade-5427/build-svn1397/include/yade-svn1397/yade/lib-serialization/IOFormatManager.tpp:59
#16 0x00000000004f5646 in FileGenerator::generateAndSave (this=0xa43830) at core/FileGenerator.cpp:89
#17 0x00002ab101354044 in pyFileGenerator::generate (this=0xa5ac90, outFile=@0x7fffd33591f0) at gui/py/yadeControl.cpp:293
#18 0x00002ab101336fa7 in boost::python::detail::invoke<boost::python::to_python_value<bool const&>, bool (pyFileGenerator::*)(std::string), boost::python::arg_from_python<pyFileGenerator&>, boost::python::arg_from_python<std::string> > (rc=@0x7fffd335928e, f=@0xa5a338, tc=@0x7fffd3359270, ac0=@0x7fffd3359290) at /usr/include/boost/python/detail/invoke.hpp:88
#19 0x00002ab101337104 in boost::python::detail::caller_arity<2u>::impl<bool (pyFileGenerator::*)(std::string), boost::python::default_call_policies, boost::mpl::vector3<bool, pyFileGenerator&, std::string> >::operator() (this=0xa5a338, args_=0x2ab0de5ac440) at /usr/include/boost/python/detail/caller.hpp:199
#20 0x00002ab1013371a9 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<bool (pyFileGenerator::*)(std::string), boost::python::default_call_policies, boost::mpl::vector3<bool, pyFileGenerator&, std::string> > >::operator() (this=0xa5a330, args=0x2ab0de5ac440, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#21 0x00002ab0d93d489d in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#22 0x00002ab0d93d5825 in boost::detail::function::void_function_obj_invoker0<boost::python::objects::(anonymous namespace)::bind_return, void>::invoke () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#23 0x00002ab0d7e428cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#24 0x00002ab0d93da8f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#25 0x00002ab0d93d4db7 in boost::python::handle_exception<boost::python::objects::(anonymous namespace)::bind_return> () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#26 0x00002ab0d93d1c9e in ?? () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#27 0x00002ab0d77b2033 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#28 0x00002ab0d782d919 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#29 0x00002ab0d78336c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#30 0x00002ab0d7833702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#31 0x00002ab0d7856561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#32 0x00002ab0d782a8a4 in ?? () from /usr/lib/libpython2.5.so.1.0
#33 0x00002ab0d78328d5 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#34 0x00002ab0d78336c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#35 0x00002ab0d7833702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#36 0x00002ab0d7856561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#37 0x00002ab0d78567e8 in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#38 0x00002ab0e8320be3 in PythonUI::execScript (script=@0x7fffd335a3e0) at gui/py/PythonUI.cpp:44
#39 0x00002ab0e8321bba in PythonUI::pythonSession () at gui/py/PythonUI.cpp:95
#40 0x00002ab0e8322849 in PythonUI::run (this=0x988710, argc=3, argv=0x7fffd335b050) at gui/py/PythonUI.cpp:127
#41 0x0000000000571d2e in main (argc=3, argv=0x7fffd335b050) at core/yade.cpp:255
#0  0x0000003001095af5 in waitpid () from /lib/libc.so.6

################################################################################
TetraTestGen: generator CRASH
################################################################################
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
43520.3
194711
191169
4417.66
-46343.2
11996.2
yade-svn1397: /tmp/yade-5427/build-svn1397/include/yade-svn1397/yade/lib-multimethods/DynLibDispatcher.hpp:447: bool DynLibDispatcher<BaseClass, Executor, ResultType, TList, autoSymmetry>::locateMultivirtualFunctor2D(int&, int&, boost::shared_ptr<typename Loki::TL::TypeAtNonStrict<typename Loki::TL::Append<Loki::NullType, T>::Result, 0u, Loki::NullType>::Result>&, boost::shared_ptr<typename Loki::TL::TypeAtNonStrict<typename Loki::TL::Append<Loki::NullType, T>::Result, 1u, Loki::NullType>::Result>&) [with BaseClass = Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, Executor = BoundingVolumeEngineUnit, ResultType = void, TList = Loki::Typelist<const boost::shared_ptr<InteractingGeometry>&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<const Se3r&, Loki::Typelist<const Body*, Loki::NullType> > > >, bool autoSymmetry = true]: Assertion `index1 >= 0 && (unsigned int)( index1 ) < callBacks.size() && index2 >= 0 && (unsigned 
 int)( index2 ) < callBacks[index1].size()' failed.
Running script /tmp/yade-test-8125.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1397/gdb_crash_batch-pid8212'
GNU gdb 6.6-debian
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Using host libthread_db library "/lib/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread 47269753463488 (LWP 8212)]
0x0000003001095af5 in waitpid () from /lib/libc.so.6
No symbol "info" in current context.

Thread 1 (Thread 47269753463488 (LWP 8212)):
#0  0x0000003001095af5 in waitpid () from /lib/libc.so.6
#1  0x000000300103c763 in ?? () from /lib/libc.so.6
#2  0x000000000057228a in sigHandler (sig=6) at core/yade.cpp:58
#3  <signal handler called>
#4  0x0000003001030cab in raise () from /lib/libc.so.6
#5  0x0000003001032660 in abort () from /lib/libc.so.6
#6  0x000000300102a436 in __assert_fail () from /lib/libc.so.6
#7  0x00002afde07be3ad in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, BoundingVolumeEngineUnit, void, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Body const*, Loki::NullType> > > >, true>::locateMultivirtualFunctor2D (this=0xa5fae8, index1=@0x7fffd5896b1c, index2=@0x7fffd5896b18, base1=@0xa655c8, base2=@0xa655d8) at /tmp/yade-5427/build-svn1397/include/yade-svn1397/yade/lib-multimethods/DynLibDispatcher.hpp:446
#8  0x00002afde07be721 in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<BoundingVolume, Loki::NullType> >, BoundingVolumeEngineUnit, void, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<BoundingVolume>&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Body const*, Loki::NullType> > > >, true>::operator() (this=0xa5fae8, base1=@0xa655c8, base2=@0xa655d8, p3=@0xa65780, p4=0xa65580) at /tmp/yade-5427/build-svn1397/include/yade-svn1397/yade/lib-multimethods/DynLibDispatcher.hpp:856
#9  0x00002afde07b326f in BoundingVolumeMetaEngine::action (this=0xa5faa0, ncb=0xa5f770) at pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine.cpp:27
#10 0x0000000000517c5c in MetaBody::runInitializers (this=0xa5f770) at core/MetaBody.cpp:62
#11 0x0000000000517d17 in MetaBody::postProcessAttributes (this=0xa5f770, deserializing=false) at core/MetaBody.cpp:68
#12 0x00002afdd7511960 in Serializable::unregisterSerializableAttributes (this=0xa5f770, deserializing=false) at lib/serialization/Serializable.cpp:29
#13 0x00002afddc10e7e9 in XMLFormatManager::serializeSerializable (stream=@0x7fffd5896eb0, ac=@0xa6a920, depth=1) at lib/serialization-xml/XMLFormatManager.cpp:168
#14 0x00002afddc10d1d2 in XMLFormatManager::serializeSmartPointer (stream=@0x7fffd5896eb0, ac=@0xa69460, depth=1) at lib/serialization-xml/XMLFormatManager.cpp:284
#15 0x0000000000508811 in IOFormatManager::saveToFile<boost::shared_ptr<MetaBody> > (libName=@0xa438b0, fileName=@0xa438a8, name=@0x7fffd58973c0, t=@0xa43898) at /tmp/yade-5427/build-svn1397/include/yade-svn1397/yade/lib-serialization/IOFormatManager.tpp:59
#16 0x00000000004f5646 in FileGenerator::generateAndSave (this=0xa43830) at core/FileGenerator.cpp:89
#17 0x00002afdfee16044 in pyFileGenerator::generate (this=0xa5ac90, outFile=@0x7fffd5897720) at gui/py/yadeControl.cpp:293
#18 0x00002afdfedf8fa7 in boost::python::detail::invoke<boost::python::to_python_value<bool const&>, bool (pyFileGenerator::*)(std::string), boost::python::arg_from_python<pyFileGenerator&>, boost::python::arg_from_python<std::string> > (rc=@0x7fffd58977be, f=@0xa5a338, tc=@0x7fffd58977a0, ac0=@0x7fffd58977c0) at /usr/include/boost/python/detail/invoke.hpp:88
#19 0x00002afdfedf9104 in boost::python::detail::caller_arity<2u>::impl<bool (pyFileGenerator::*)(std::string), boost::python::default_call_policies, boost::mpl::vector3<bool, pyFileGenerator&, std::string> >::operator() (this=0xa5a338, args_=0x2afddc0e5e18) at /usr/include/boost/python/detail/caller.hpp:199
#20 0x00002afdfedf91a9 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<bool (pyFileGenerator::*)(std::string), boost::python::default_call_policies, boost::mpl::vector3<bool, pyFileGenerator&, std::string> > >::operator() (this=0xa5a330, args=0x2afddc0e5e18, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#21 0x00002afdd6e9689d in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#22 0x00002afdd6e97825 in boost::detail::function::void_function_obj_invoker0<boost::python::objects::(anonymous namespace)::bind_return, void>::invoke () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#23 0x00002afdd59048cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#24 0x00002afdd6e9c8f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#25 0x00002afdd6e96db7 in boost::python::handle_exception<boost::python::objects::(anonymous namespace)::bind_return> () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#26 0x00002afdd6e93c9e in ?? () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#27 0x00002afdd5274033 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#28 0x00002afdd52ef919 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#29 0x00002afdd52f56c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#30 0x00002afdd52f5702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#31 0x00002afdd5318561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#32 0x00002afdd52ec8a4 in ?? () from /usr/lib/libpython2.5.so.1.0
#33 0x00002afdd52f48d5 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#34 0x00002afdd52f56c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#35 0x00002afdd52f5702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#36 0x00002afdd5318561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#37 0x00002afdd53187e8 in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#38 0x00002afde5de2be3 in PythonUI::execScript (script=@0x7fffd5898910) at gui/py/PythonUI.cpp:44
#39 0x00002afde5de3bba in PythonUI::pythonSession () at gui/py/PythonUI.cpp:95
#40 0x00002afde5de4849 in PythonUI::run (this=0x988710, argc=3, argv=0x7fffd5899580) at gui/py/PythonUI.cpp:127
#41 0x0000000000571d2e in main (argc=3, argv=0x7fffd5899580) at core/yade.cpp:255
#0  0x0000003001095af5 in waitpid () from /lib/libc.so.6

################################################################################
ThreePointBending: simulation CRASH
################################################################################
Constructing ClassFactory  (if multiple times - check '-rdynamic' flag!).
Constructing SerializableSingleton  (if multiple times - check '-rdynamic' flag!).
WARNING: cannot open file used for capillary law, in TriaxalTestWater
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1397/gdb_crash_batch-pid8224'
GNU gdb 6.6-debian
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Using host libthread_db library "/lib/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread 47049161614016 (LWP 8224)]
[New Thread 1082132800 (LWP 8225)]
0x00000030010961d1 in nanosleep () from /lib/libc.so.6
No symbol "info" in current context.

Thread 2 (Thread 1082132800 (LWP 8225)):
#0  0x0000003001095b2f in waitpid () from /lib/libc.so.6
#1  0x000000300103c763 in ?? () from /lib/libc.so.6
#2  0x000000300103cad7 in system () from /lib/libc.so.6
#3  0x000000000057228a in sigHandler (sig=11) at core/yade.cpp:58
#4  <signal handler called>
#5  0x0000000000574f4d in BodyRedirectionVector::operator[] (this=0xa6bb30, id=0) at core/DefaultContainerImplementations/BodyRedirectionVector.cpp:205
#6  0x00002aca91c1e297 in TranslationEngine::applyCondition (this=0xa67b20, ncb=0xa656c0) at pkg/common/Engine/DeusExMachina/TranslationEngine.cpp:38
#7  0x00000000004eefe8 in DeusExMachina::action (this=0xa67b20, b=0xa656c0) at core/DeusExMachina.cpp:20
#8  0x0000000000517b24 in MetaBody::moveToNextTimeStep (this=0xa656c0) at core/MetaBody.cpp:101
#9  0x00000000005693f8 in SimulationFlow::singleAction (this=0x809620) at core/SimulationFlow.cpp:17
#10 0x000000000056b003 in ThreadWorker::callSingleAction (this=0x809620) at core/ThreadWorker.cpp:71
#11 0x000000000056a81c in ThreadRunner::call (this=0xa60710) at core/ThreadRunner.cpp:42
#12 0x000000000056a87a in ThreadRunner::run (this=0xa60710) at core/ThreadRunner.cpp:21
#13 0x000000000056abe2 in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x9a7fc0, p=0xa60710) at /usr/include/boost/bind/mem_fn_template.hpp:45
#14 0x000000000056ac4f in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x9a7fd0, f=@0x9a7fc0, a=@0x4080004f) at /usr/include/boost/bind.hpp:230
#15 0x000000000056ac8c in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x9a7fc0) at /usr/include/boost/bind/bind_template.hpp:20
#16 0x000000000056acab in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr={obj_ptr = 0x9a7fc0, const_obj_ptr = 0x9a7fc0, func_ptr = 0x9a7fc0, data = "?"}) at /usr/include/boost/function/function_template.hpp:136
#17 0x00002aca7943c8cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#18 0x00002aca7943c2ef in ?? () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#19 0x00000030024062a5 in start_thread () from /lib/libpthread.so.0
#20 0x00000030010cf61d in clone () from /lib/libc.so.6
#21 0x0000000000000000 in ?? ()

Thread 1 (Thread 47049161614016 (LWP 8224)):
#0  0x00000030010961d1 in nanosleep () from /lib/libc.so.6
#1  0x00000030010c9134 in usleep () from /lib/libc.so.6
#2  0x00002acaa2954992 in pyOmega::wait (this=0xa5aca0) at gui/py/yadeControl.cpp:430
#3  0x00002acaa2890731 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0xa413b8, tc=@0x7fff31d5fca0) at /usr/include/boost/python/detail/invoke.hpp:94
#4  0x00002acaa28eaebe in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0xa413b8, args_=0x2aca7fc2d890) at /usr/include/boost/python/detail/caller.hpp:199
#5  0x00002acaa28eaf11 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0xa413b0, args=0x2aca7fc2d890, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#6  0x00002aca7a9ce89d in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#7  0x00002aca7a9cf825 in boost::detail::function::void_function_obj_invoker0<boost::python::objects::(anonymous namespace)::bind_return, void>::invoke () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#8  0x00002aca7943c8cf in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
#9  0x00002aca7a9d48f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#10 0x00002aca7a9cedb7 in boost::python::handle_exception<boost::python::objects::(anonymous namespace)::bind_return> () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#11 0x00002aca7a9cbc9e in ?? () from /usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
#12 0x00002aca78dac033 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#13 0x00002aca78e27919 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#14 0x00002aca78e2d6c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#15 0x00002aca78e2d702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#16 0x00002aca78e50561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#17 0x00002aca78e248a4 in ?? () from /usr/lib/libpython2.5.so.1.0
#18 0x00002aca78e2c8d5 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#19 0x00002aca78e2d6c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#20 0x00002aca78e2d702 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#21 0x00002aca78e50561 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#22 0x00002aca78e507e8 in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#23 0x00002aca8991abe3 in PythonUI::execScript (script=@0x7fff31d60de0) at gui/py/PythonUI.cpp:44
#24 0x00002aca8991bbba in PythonUI::pythonSession () at gui/py/PythonUI.cpp:95
#25 0x00002aca8991c849 in PythonUI::run (this=0x988710, argc=3, argv=0x7fff31d61a50) at gui/py/PythonUI.cpp:127
#26 0x0000000000571d2e in main (argc=3, argv=0x7fff31d61a50) at core/yade.cpp:255
#0  0x00000030010961d1 in nanosleep () from /lib/libc.so.6


From eudoxos at arcig.cz  Sun Jun 22 22:54:23 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Sun, 22 Jun 2008 22:54:23 +0200
Subject: [yade-dev] facets, edges, vertices (questions to sega)
Message-ID: <485EBBFF.3020407@arcig.cz>

Hi,

I was looking at the classes you added recently, which I find
(potentially, for me at this moment) _VERY_ useful. I have a few
questions as I am not sure I understand exactly how those classes are
supposed to work.

1. Factets have normals - what is their meaning? Is it the normal from
the edge towards the center of mass of the facet?

2. What happens if vertices of facet are not in-plane?

3. Why should I want to have not only facets, but also edges and
vertices? Does it avoid some singularities at facet boundary?

4. What subclass of PhysicalParameters for facet is needed so that
spheres can bump into facets etc (I can look into the code here)?

4. Could you give some rudiementary working example of say 1 sphere
falling into cone from 4 facets (or something like that)? I tried
running your model but didn't succeed (will investigate shortly).
(Preferably you could do the whole thing in python; I added methods for
raw attribute access to make vector<Vector3r> Facet::vertices (and
similar) accessible in a way, but didn't figure out the normals. They
are calculated in postProcessAttributes, is that why in your example,
you save the simulation and load it again? (I could add wrapper for
postProcess to python in that case) This is what I wanted to add to utils:

 from yade.wrapper import *
 def facet(center,vertices,relative=False):
    if relative: relCenter=[0,0,0]
    else: relCenter=center
    vStr='['
    for v in vertices: vStr+=" {%g %g %g}
"%(v[0]-relCenter[0],v[1]-relCenter[1],v[2]-relCenter[2])
    vStr+=']'
    b=Body()
    b.shape=GeometricalModel("Facet",{'wire':True,'visible':True})
    b.shape.setRaw('vertices',vStr)
    b.mold=InteractingGeometry("InteractingFacet")
    b.mold.setRaw('vertices',vStr)
   
b.phys=PhysicalParameters("PhysicalParameters",{'se3':[center[0],center[1],center[2],1,0,0,0]})
    b.bound=BoundingVolume('AABB',{'diffuseColor':[0,1,0]})
    b['isDynamic']=False
    return b

Best regards, Vaclav



From sj2001 at yandex.ru  Mon Jun 23 19:28:44 2008
From: sj2001 at yandex.ru (sega)
Date: Mon, 23 Jun 2008 21:28:44 +0400
Subject: [yade-dev] facets, edges, vertices (questions to sega)
In-Reply-To: <485EBBFF.3020407@arcig.cz>
References: <485EBBFF.3020407@arcig.cz>
Message-ID: <200806232128.46246.sj2001@yandex.ru>

Hi,

> 1. Factets have normals - what is their meaning? Is it the normal from
> the edge towards the center of mass of the facet?

> 2. What happens if vertices of facet are not in-plane?

InteractingFacet:normal is the normal to a plane in which the facet lies 
(see n_f on fig. distance-to-facet.pdf attached to this mail)

InteractingFacet:edgeNormals is the perpendiculars to the edges. They lies in 
the facet's plane and directed in the facet (see again distance-to-facet.pdf)

on distance-to-facet.pdf: 
x'_0 is Facet se3.position (it is the facet origin);
x'_1 is Facet::vertices[0] (it from x'_0, e.q. from origin); 
x'_2 is Facet::vertices[1] (it from x'_0 also, not from x'_1); 
etc...

n_f = x'_2 UnitCross x'_1

E.q.
edge e_0 = x'_1 - x'_0 = x'_1
edge e_1 = x'_2 - x'_1
edge e_2 = x'_3 - x'_2
etc...

d = n_f Dot ( x - x'_0 ), 
x is the sphere center.

d is distance from x to facet if the projection of x to a facet plane lies in 
facet perimetre.



> 3. Why should I want to have not only facets, but also edges and
> vertices? Does it avoid some singularities at facet boundary?

Edge is the intersection of two faces.
Since the facets are distinct objects, and they are not connected to any 
combinatorial structure (such as, for example, triangulation), the scope of 
interaction with an edge will be the scope of interaction with two faces 
simultaneously. To exclude such a dual interaction imposed edges as separate 
body. (Similarly for vertices as the intersection of two or more edges).

> 4. What subclass of PhysicalParameters for facet is needed so that
> spheres can bump into facets etc (I can look into the code here)?

Any.... For geometry need only se3. See examples/STLImporterTest.py...
(Although I am not sure that I understood correctly this question).

>
> 4. Could you give some rudiementary working example of say 1 sphere
> falling into cone from 4 facets (or something like that)?

Try the other day.

> I tried running your model but didn't succeed (will investigate shortly).
What happened?

> (Preferably you could do the whole thing in python; I added methods for
> raw attribute access to make vector<Vector3r> Facet::vertices (and
> similar) accessible in a way, but didn't figure out the normals. 

> They > are calculated in postProcessAttributes, is that why in your example,
> you save the simulation and load it again? 

Yes.

==
Best regards, Sergei D.




-------------- next part --------------
A non-text attachment was scrubbed...
Name: distance-to-facet.pdf
Type: application/pdf
Size: 4324 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080623/0e338d9b/attachment.pdf>

From eudoxos at arcig.cz  Wed Jun 25 20:44:49 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Wed, 25 Jun 2008 20:44:49 +0200
Subject: [yade-dev] facets, edges, vertices (questions to sega)
In-Reply-To: <200806232128.46246.sj2001@yandex.ru>
References: <485EBBFF.3020407@arcig.cz> <200806232128.46246.sj2001@yandex.ru>
Message-ID: <48629221.7040409@arcig.cz>

Hi, thanks for your responses. One thing that I find baffling...

I create a facet that reads like this in the .xml file:

   <physicalParameters _className_="BodyMacroParameters"  se3="{0 0 0 1
0 0 0}" mass="0" velocity="{0 0 0}" inertia="{0 0 0}"
angularVelocity="{0 0 0}" young="70000" poisson="0.2"
frictionAngle="0.5236" />
   <geometricalModel _className_="Facet"  diffuseColor="{1 1 1}"
wire="1" visible="1" shadowCaster="0" vertices="[{1 0 0} {0 1 0} {-1 0
0} {0 -1 0}]" />
   <interactingGeometry _className_="InteractingFacet"  diffuseColor="{1
1 1}" vertices="[{1 0 0} {0 1 0} {-1 0 0} {0 -1 0}]" />

The intent was to have unit square slab in the xy plane; its
se3.position is in the origin. However, in the rendering, I get facet
with 5 edges!

I am attaching the code and screenshot of the rendering.

> Edge is the intersection of two faces.
> Since the facets are distinct objects, and they are not connected to any 
> combinatorial structure (such as, for example, triangulation), the scope of 
> interaction with an edge will be the scope of interaction with two faces 
> simultaneously. To exclude such a dual interaction imposed edges as separate 
> body. (Similarly for vertices as the intersection of two or more edges).
>   
I find edges useful only if there is falling onto a convex object
between two facets, such that in the direction of both facets, there
will be no projection of the sphere on the respective facet; the sphere
would fall through then, right?
>> I tried running your model but didn't succeed (will investigate shortly).
>>     
> What happened?
>   
That was a bug with initializers I fixed now (r1401)
>> They > are calculated in postProcessAttributes, is that why in your example,
>> you save the simulation and load it again? 
>>     
>
> Yes.
>   
Added that to the python wrappers - see in the attached script.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: facets_.py
Type: text/x-python
Size: 2126 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080625/5bfcfccc/attachment.py>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: facets.png
Type: image/png
Size: 13417 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080625/5bfcfccc/attachment.png>

From dorofeenko at icp.ac.ru  Thu Jun 26 09:45:03 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Thu, 26 Jun 2008 11:45:03 +0400
Subject: [yade-dev] facets, edges, vertices (questions to sega)
In-Reply-To: <48629221.7040409@arcig.cz>
References: <485EBBFF.3020407@arcig.cz> <200806232128.46246.sj2001@yandex.ru>
	<48629221.7040409@arcig.cz>
Message-ID: <200806261145.03504.dorofeenko@icp.ac.ru>

>    <interactingGeometry _className_="InteractingFacet"  diffuseColor="{1
> 1 1}" vertices="[{1 0 0} {0 1 0} {-1 0 0} {0 -1 0}]" />
> 
> The intent was to have unit square slab in the xy plane; its
> se3.position is in the origin. However, in the rendering, I get facet
> with 5 edges!
> 

se3.position is the vertex too. it is the facet origin {0,0,0}.
set vertices="[{2 0 0} {2 2 0} {0 2 0}]" and se3.position = {-1 -1 0}

> I find edges useful only if there is falling onto a convex object
> between two facets, such that in the direction of both facets, there
> will be no projection of the sphere on the respective facet; the sphere
> would fall through then, right?

Yes.

-- 
Best regards, Sergei D.


From eudoxos at arcig.cz  Thu Jun 26 13:53:34 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Thu, 26 Jun 2008 13:53:34 +0200
Subject: [yade-dev] run faster by +16% (and enlarge your p*n*s size ;
	-) ) with r1402
Message-ID: <4863833E.3000908@arcig.cz>

I just commited ParallelEngine class that uses openmp to run engines in
parallel. I have 16% speedup on simple-scene.py vs.
simple-scene-parallel.py (dual-core machine, but the second core is 100%
used). I think the impact will be bigger on larger simulations. If you
get mysterious crashes while useing ParallelEngine, run with
OMP_NUM_THREADS=1 to make sure. Do not use it unless you are sure the
engines you run in parallel do not touch the same data.

I will soon start to parallelize inner loops of engines where it makes
sense - like gravity engine, InteractingGeometryMetaEngine,
InteractionPhysicsMetaEngine. None of the changes will be intrusive,
though, and compiling without openmp enabled (or /setting
OMP_NUM_THREADS=1 in the shell) /will keep the old behavior.

For engines that loop over physical actions, that will be more
complicated, since openmp needs const-time random access to
integer-indexed elements; we will see.

Please let me know if you get some speedups. Ah, not to forget: use
gcc>=4.2 to compile.

Vaclav


From bruno.chareyre at hmg.inpg.fr  Thu Jun 26 14:18:36 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Thu, 26 Jun 2008 14:18:36 +0200
Subject: [yade-dev] run faster by +16% (and enlarge your p*n*s size ;
 -) ) with r1402
In-Reply-To: <4863833E.3000908@arcig.cz>
References: <4863833E.3000908@arcig.cz>
Message-ID: <4863891C.6050100@hmg.inpg.fr>

Do you know that, appart from the IMAG student working on Python, we 
have also one working on paralellization of Yade during summertime?
If I understand correctly, you run different engines in parallel, but 
engines themselves are not parallelized. Correct?

Bruno



V?clav ?milauer a ?crit :
> I just commited ParallelEngine class that uses openmp to run engines in
> parallel. I have 16% speedup on simple-scene.py vs.
> simple-scene-parallel.py (dual-core machine, but the second core is 100%
> used). I think the impact will be bigger on larger simulations. If you
> get mysterious crashes while useing ParallelEngine, run with
> OMP_NUM_THREADS=1 to make sure. Do not use it unless you are sure the
> engines you run in parallel do not touch the same data.
>
> I will soon start to parallelize inner loops of engines where it makes
> sense - like gravity engine, InteractingGeometryMetaEngine,
> InteractionPhysicsMetaEngine. None of the changes will be intrusive,
> though, and compiling without openmp enabled (or /setting
> OMP_NUM_THREADS=1 in the shell) /will keep the old behavior.
>
> For engines that loop over physical actions, that will be more
> complicated, since openmp needs const-time random access to
> integer-indexed elements; we will see.
>
> Please let me know if you get some speedups. Ah, not to forget: use
> gcc>=4.2 to compile.
>
> Vaclav
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Grenoble INP
Laboratoire 3SR - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Thu Jun 26 14:27:54 2008
From: eudoxos at arcig.cz (=?windows-1252?Q?V=E1clav_=8Amilauer?=)
Date: Thu, 26 Jun 2008 14:27:54 +0200
Subject: [yade-dev] run faster by +16% (and enlarge your p*n*s size ;
 -) ) with r1402
In-Reply-To: <4863891C.6050100@hmg.inpg.fr>
References: <4863833E.3000908@arcig.cz> <4863891C.6050100@hmg.inpg.fr>
Message-ID: <48638B4A.9010300@arcig.cz>


> Do you know that, appart from the IMAG student working on Python, we 
> have also one working on paralellization of Yade during summertime?
> If I understand correctly, you run different engines in parallel, but 
> engines themselves are not parallelized. Correct?
>   
Yes, I know (this was just a trivial try to see if it works). Yes,
engines themselves loop sequentially over bodies/interactions. From what
I saw, however, running the loops in parallel is not necessarily a speed
gain.

Vaclav



From bruno.chareyre at hmg.inpg.fr  Thu Jun 26 14:30:53 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Thu, 26 Jun 2008 14:30:53 +0200
Subject: [yade-dev] run faster by +16% (and enlarge your p*n*s size ;
 -) ) with r1402
In-Reply-To: <4863891C.6050100@hmg.inpg.fr>
References: <4863833E.3000908@arcig.cz> <4863891C.6050100@hmg.inpg.fr>
Message-ID: <48638BFD.2090907@hmg.inpg.fr>

This is really interesting.
It sounds like we could nest paralellizations, with parallelized engines 
runing in parallel.

>> however, running the loops in parallel is not necessarily a speed
>> gain.

How comes?!

Bruno


Bruno Chareyre a ?crit :
> Do you know that, appart from the IMAG student working on Python, we 
> have also one working on paralellization of Yade during summertime?
> If I understand correctly, you run different engines in parallel, but 
> engines themselves are not parallelized. Correct?
>
> Bruno
>
>
>
> V?clav ?milauer a ?crit :
>   
>> I just commited ParallelEngine class that uses openmp to run engines in
>> parallel. I have 16% speedup on simple-scene.py vs.
>> simple-scene-parallel.py (dual-core machine, but the second core is 100%
>> used). I think the impact will be bigger on larger simulations. If you
>> get mysterious crashes while useing ParallelEngine, run with
>> OMP_NUM_THREADS=1 to make sure. Do not use it unless you are sure the
>> engines you run in parallel do not touch the same data.
>>
>> I will soon start to parallelize inner loops of engines where it makes
>> sense - like gravity engine, InteractingGeometryMetaEngine,
>> InteractionPhysicsMetaEngine. None of the changes will be intrusive,
>> though, and compiling without openmp enabled (or /setting
>> OMP_NUM_THREADS=1 in the shell) /will keep the old behavior.
>>
>> For engines that loop over physical actions, that will be more
>> complicated, since openmp needs const-time random access to
>> integer-indexed elements; we will see.
>>
>> Please let me know if you get some speedups. Ah, not to forget: use
>> gcc>=4.2 to compile.
>>
>> Vaclav
>> _______________________________________________
>> yade-dev mailing list
>> yade-dev at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/yade-dev
>>
>>   
>>     
>
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Grenoble INP
Laboratoire 3SR - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Thu Jun 26 15:05:48 2008
From: eudoxos at arcig.cz (=?windows-1252?Q?V=E1clav_=8Amilauer?=)
Date: Thu, 26 Jun 2008 15:05:48 +0200
Subject: [yade-dev] run faster by +16% (and enlarge your p*n*s size ;
 -) ) with r1402
In-Reply-To: <48638BFD.2090907@hmg.inpg.fr>
References: <4863833E.3000908@arcig.cz> <4863891C.6050100@hmg.inpg.fr>
	<48638BFD.2090907@hmg.inpg.fr>
Message-ID: <4863942C.5010406@arcig.cz>


> This is really interesting.
> It sounds like we could nest paralellizations, with parallelized engines 
> runing in parallel
>>> however, running the loops in parallel is not necessarily a speed
>>> gain.
>>>       
>
> How comes?!
>   
There is some overhead when starting parallel block, so I think that for
simple-scene parallelization this may actually hurt (I get 1.75e4
iters/sec witm OMP_THREAD_NUM=1 and 1.5e4 with 2). But for large
simulations, where you have around 10 iter/sec or less, even nested
parallelization may offer some benefit. To enable it with openMP, you
just define OMP_NESTED (http://docs.sun.com/source/819-0501/2_nested.html).

The interaction container, however, will need to have a 1D index - for
example creating a vector<interactionId,shared_ptr<Interaction> > that
would be refreshed at every iteration, after the collider creates
interactions. But we would have to make sure that only the collider
adds/deletes interactions. Currently, we have to loop over iterations
with the iterator (no random access).

ParallelEngine was just what I cooked up this morning, since I thought
it was a low-hanging fruit; but I think the summer student will have to
run bunch of benchmarks to determine where it is worth to parallelize
and where not (and for what number of bodies and interactions etc).

Regards, Vaclav


From janek_listy at wp.pl  Thu Jun 26 16:24:35 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Thu, 26 Jun 2008 16:24:35 +0200
Subject: [yade-dev] run faster by +16% with r1402
In-Reply-To: <4863942C.5010406@arcig.cz>
References: <4863833E.3000908@arcig.cz> <4863891C.6050100@hmg.inpg.fr>
	<48638BFD.2090907@hmg.inpg.fr> <4863942C.5010406@arcig.cz>
Message-ID: <20080626162435.68430035@szpak>

V?clav ?milauer said:     (by the date of Thu, 26 Jun 2008 15:05:48 +0200)

> ParallelEngine was just what I cooked up this morning, since I thought
> it was a low-hanging fruit; but I think the summer student will have to
> run bunch of benchmarks to determine where it is worth to parallelize
> and where not (and for what number of bodies and interactions etc).

I'm supervising his job. And I'm already experienced with
boost::thread, which yade uses in some places. So it may be a sad
news for you, but the in-engine parallelization will be done using
boost::threads. We will see how it will affect the problem caused by not
being able to random access the containers.

It will be a bit more coding though, as splitting into parallel
blocks will have to be coded explicitly using boost::threads, whereas
OpenMP does the split implicitly using compilers #pragmas.

The student's first assignment is to write a "hello world"
parallelization example in following way:

- a container with forces {float force;} // write only
- a container with interactions {float force, int id1, int id2;} // RO

- he has to do a parallel loop over all interactions and add force
  to each id1 and id2. Doing it in parallel will involve some mutexes
  to block the access to particular force[id1] so that another thread
  will not attempt to modify it.

That's a simple job for him, just to start the work. Later he will
incorporate that into yade. He is just a 2nd year CS student, and he has
only 2 months to do it. We will see how far it will go.

-- 
Janek Kozicki                                                         |


From eudoxos at arcig.cz  Thu Jun 26 18:32:38 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Thu, 26 Jun 2008 18:32:38 +0200
Subject: [yade-dev] run faster by +16% with r1402
In-Reply-To: <20080626162435.68430035@szpak>
References: <4863833E.3000908@arcig.cz>
	<4863891C.6050100@hmg.inpg.fr>	<48638BFD.2090907@hmg.inpg.fr>
	<4863942C.5010406@arcig.cz> <20080626162435.68430035@szpak>
Message-ID: <4863C4A6.4000302@arcig.cz>


> I'm supervising his job. And I'm already experienced with
> boost::thread, which yade uses in some places. So it may be a sad
> news for you, but the in-engine parallelization will be done using
> boost::threads. We will see how it will affect the problem caused by not
> being able to random access the containers.
>   
OpenMP keeps pool of threads instead of creating new threads every time
it enters parallel section. I assume boost::threads is going to do just
that. I didn't measure that, but creating thread requires context switch
(AFAIK - interaction with the kernel) and I think that will be quite
expensive.

No, it is not sad news at all - if boost::threads will be faster, I will
be only happy to use it. The openMP and ParallelEngine took me about 3
hours, so it is no big deal. But, heck, I need that _now_, that is why I
did it.
> - he has to do a parallel loop over all interactions and add force
>   to each id1 and id2. Doing it in parallel will involve some mutexes
>   to block the access to particular force[id1] so that another thread
>   will not attempt to modify it.
>   
The lock-free containers would be nice thing to have, for sure - if that
is what you mean.

Vaclav.


From arturcz at hell.pl  Sun Jun 29 22:49:40 2008
From: arturcz at hell.pl (Artur R. Czechowski)
Date: Sun, 29 Jun 2008 22:49:40 +0200
Subject: [yade-dev] QGLViewer linked with Qt4
Message-ID: <20080629204940.GO3799@szczaw.snafu.pl>

Hello Yade Team,

I am glad to inform you that I prepared libqglviewer package linked with Qt4.
It is currently waiting for uploading by official Debian Developer, then
next it need to be accepted by Debian ftp-masters[1]. I think it could take
sth about 2 weeks until the package will be officialy in Debian. But if you
are impatient and want to check the package NOW you can fetch it from
http://mentors.debian.net/debian/pool/main/l/libqglviewer
Please note that only source package is available - you need to compile
the package on your own.

Regardless of time you decide to check yade with new package it's highly
appreciated to send me comments about new libqglviewer release.

Best regards
	Artur Czechowski, maintainer of libqglviewer in Debian

[1] Debian procedure used for all packages introducing new binaries, don't
    bother about it unless you want to be involved in Debian maintaing too :)
-- 
(ac) ,<                                             
    _?_____     We all live in a yellow submarine...  
   <_______>                                             
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080629/6537b3d2/attachment.pgp>

From dorofeenko at icp.ac.ru  Mon Jun 30 17:04:02 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Mon, 30 Jun 2008 19:04:02 +0400
Subject: [yade-dev] [Yade-commits] r1404 - in trunk: extra gui/py
	gui/qt3 pkg/common/Engine/MetaEngine
	pkg/common/Engine/StandAloneEngine
	pkg/common/RenderingEngine/GLDrawGeometricalModel
	pkg/dem/Engine/StandAloneEngine
In-Reply-To: <200806290733.m5T7XPPp009606@sheep.berlios.de>
References: <200806290733.m5T7XPPp009606@sheep.berlios.de>
Message-ID: <200806301904.02742.dorofeenko@icp.ac.ru>

Hi!

1. SimulationPlayer does't update the view when playing (displayed only the first frame).
2. Is the flag -fpermissive necessary now? (without it I can't run python gui...)

-- 
Best regards, Sergei D.


From dorofeenko at icp.ac.ru  Mon Jun 30 19:02:43 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Mon, 30 Jun 2008 21:02:43 +0400
Subject: [yade-dev] [Yade-commits] r1404 - in trunk: extra gui/py
	gui/qt3 pkg/common/Engine/MetaEngine
	pkg/common/Engine/StandAloneEngine
	pkg/common/RenderingEngine/GLDrawGeometricalModel
	pkg/dem/Engine/StandAloneEngine
In-Reply-To: <200806301904.02742.dorofeenko@icp.ac.ru>
References: <200806290733.m5T7XPPp009606@sheep.berlios.de>
	<200806301904.02742.dorofeenko@icp.ac.ru>
Message-ID: <200806302102.43590.dorofeenko@icp.ac.ru>


> 1. SimulationPlayer does't update the view when playing (displayed only the first frame).

The reason: given the relative path to the position's directory and working directory is not parent of it...

-- 
Best regards, Sergei D.


From eudoxos at arcig.cz  Mon Jun 30 22:36:10 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Mon, 30 Jun 2008 22:36:10 +0200
Subject: [yade-dev] [Yade-commits] r1404 - in trunk: extra gui/py	gui/qt3
 pkg/common/Engine/MetaEngine	pkg/common/Engine/StandAloneEngine	pkg/common/RenderingEngine/GLDrawGeometricalModel
 pkg/dem/Engine/StandAloneEngine
In-Reply-To: <200806302102.43590.dorofeenko@icp.ac.ru>
References: <200806290733.m5T7XPPp009606@sheep.berlios.de>	<200806301904.02742.dorofeenko@icp.ac.ru>
	<200806302102.43590.dorofeenko@icp.ac.ru>
Message-ID: <486943BA.7050502@arcig.cz>

sega napsal(a):
>> 1. SimulationPlayer does't update the view when playing (displayed only the first frame).
>>     
>
> The reason: given the relative path to the position's directory and working directory is not parent of it...
>   
Oh, I know. Paths are read form the simulation and there is no way to
input them by hand. I thought no one will use it until I fix that -
SORRY (wait a few days).

As workaround, run yade in the directory where you ran the simulation or
use pabsolute paths.

2. -fpermissive is needed for g++-4.3, but I am not aware of it being
needed for python specifically. Can you give your compiler's vversion
and what does exactly means "without it I can't run python gui..."?

Regards, Vaclav


From eudoxos at arcig.cz  Tue Jul  1 07:38:14 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 01 Jul 2008 07:38:14 +0200
Subject: [yade-dev] [Yade-commits] r1404 - in trunk: extra gui/py	gui/qt3
 pkg/common/Engine/MetaEngine	pkg/common/Engine/StandAloneEngine	pkg/common/RenderingEngine/GLDrawGeometricalModel
 pkg/dem/Engine/StandAloneEngine
In-Reply-To: <200806301904.02742.dorofeenko@icp.ac.ru>
References: <200806290733.m5T7XPPp009606@sheep.berlios.de>
	<200806301904.02742.dorofeenko@icp.ac.ru>
Message-ID: <4869C2C6.70309@arcig.cz>


> 1. SimulationPlayer does't update the view when playing (displayed only the first frame).
>   
Do you still have this? It was fixed for me in r1406 - I removed the
QtSimulationPlayer::rootBody and use Omega::instace().getRootBody()
consistently.

V.


From dorofeenko at icp.ac.ru  Tue Jul  1 10:23:47 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Tue, 1 Jul 2008 12:23:47 +0400
Subject: [yade-dev]
 =?utf-8?q?=5BYade-commits=5D_r1404_-_in_trunk=3A_extra?=
 =?utf-8?q?_gui/py=09gui/qt3_pkg/common/Engine/MetaEngine=09pkg/common/Eng?=
 =?utf-8?q?ine/StandAloneEngine=09pkg/common/RenderingEngine/GLDrawGeometr?=
 =?utf-8?q?icalModel_pkg/dem/Engine/StandAloneEngine?=
In-Reply-To: <486943BA.7050502@arcig.cz>
References: <200806290733.m5T7XPPp009606@sheep.berlios.de>
	<200806302102.43590.dorofeenko@icp.ac.ru>
	<486943BA.7050502@arcig.cz>
Message-ID: <200807011223.48087.dorofeenko@icp.ac.ru>


> >> 1. SimulationPlayer does't update the view when playing (displayed only the first frame).
> >>     
> >
> > The reason: given the relative path to the position's directory and working directory is not parent of it...
> >   

Fix in svn1409.


> 
> 2. -fpermissive is needed for g++-4.3, but I am not aware of it being
> needed for python specifically. Can you give your compiler's vversion
> and what does exactly means "without it I can't run python gui..."?
> 

g++ 4.3.1 

sega at linux:~/work/yade/trunk/scripts> yade-trunk-nopermissive simple-scene.py
...
ERROR gui/qt3/QtGUI.cpp:57 run: Unprocessed non-option argument: `simple-scene.py'

compiling with -fpermissive:

>sega at linux:~/work/yade/trunk> scons profile=opt
>scons: Reading SConscript files ...
>@@@ Using profile opt (scons.profile-opt) @@@
>Yade version is `trunk', installed files will be suffixed with `-trunk-opt'.
>All intermediary files will be in `/home/sega/build/yade/build-trunk-opt'.
>Checking whether c++ compiler "g++" works...(cached) yes
>Checking for pthread_exit(NULL) in C library pthread... (cached) yes
>Checking for glutGetModifiers() in C library glut... (cached) yes
>Checking for boost::posix_time::time_duration::time_duration() in C++ library boost_date_time-mt... (cached) yes
>Checking for boost::thread::thread() in C++ library boost_thread-mt... (cached) yes
>Checking for boost::filesystem::path() in C++ library boost_filesystem-mt... (cached) yes
>Checking for boost::iostreams::file_sink("") in C++ library boost_iostreams-mt... (cached) yes
>Checking for C++ header file boost/foreach.hpp... (cached) yes
>Checking for qt-mt in /usr/lib/qt3... (cached) yes
>Checking for Python development files... (cached) yes
>Checking for boost::python::scope() in C++ library boost_python-mt... (cached) yes
>scons: done reading SConscript files.
>scons: Building targets ...

without -fpemissive get no boost_python:

>sega at linux:~/work/yade/trunk> scons profile=nopermissive
>scons: Reading SConscript files ...
>@@@ Using profile nopermissive (scons.profile-nopermissive) @@@
>Yade version is `trunk', installed files will be suffixed with `-trunk-nopermissive'.
>All intermediary files will be in `/home/sega/build/yade/build-trunk-nopermissive'.
>Checking whether c++ compiler "g++" works...yes
>Checking for pthread_exit(NULL) in C library pthread... yes
>Checking for glutGetModifiers() in C library glut... yes
>Checking for boost::posix_time::time_duration::time_duration() in C++ library boost_date_time-mt... yes
>Checking for boost::thread::thread() in C++ library boost_thread-mt... yes
>Checking for boost::filesystem::path() in C++ library boost_filesystem-mt... yes
>Checking for boost::iostreams::file_sink("") in C++ library boost_iostreams-mt... yes
>Checking for C++ header file boost/foreach.hpp... yes
>Checking for qt-mt in /usr/lib/qt3... yes
>Checking for Python development files... yes
>Checking for boost::python::scope() in C++ library boost_python-mt... no
>Checking for boost::python::scope() in C++ library boost_python... no
>scons: done reading SConscript files.
>scons: Building targets ...

Another errors:

1. Viewer size does not change with SimulationPlayer window size.
2. The Primary View of Simulation Controller does not show at first start (seems, scene size is not correct).

-- 
Best regards, Sergei D.


From dorofeenko at icp.ac.ru  Tue Jul  1 15:59:22 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Tue, 1 Jul 2008 17:59:22 +0400
Subject: [yade-dev] run faster by +16% with r1402
In-Reply-To: <4863C4A6.4000302@arcig.cz>
References: <4863833E.3000908@arcig.cz> <20080626162435.68430035@szpak>
	<4863C4A6.4000302@arcig.cz>
Message-ID: <200807011759.22775.dorofeenko@icp.ac.ru>

Hi!
I can not understand how to use a parallel engine. 
I have the following results:

export OMP_NUM_THREADS=2; yade-trunk-opt simple-scene-parallel.py
36114.1206212 iterations/sec

export OMP_NUM_THREADS=1; yade-trunk-opt simple-scene-parallel.py
112233.445567 iterations/sec


yade-trunk-opt simple-scene.py
105485.232068 iterations/sec


-- 
Best regards, Sergei D.


From eudoxos at arcig.cz  Tue Jul  1 20:27:46 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 01 Jul 2008 20:27:46 +0200
Subject: [yade-dev] run faster by +16% with r1402
In-Reply-To: <200807011759.22775.dorofeenko@icp.ac.ru>
References: <4863833E.3000908@arcig.cz>
	<20080626162435.68430035@szpak>	<4863C4A6.4000302@arcig.cz>
	<200807011759.22775.dorofeenko@icp.ac.ru>
Message-ID: <486A7722.8030304@arcig.cz>





> export OMP_NUM_THREADS=2; yade-trunk-opt simple-scene-parallel.py
> 36114.1206212 iterations/sec
>
> export OMP_NUM_THREADS=1; yade-trunk-opt simple-scene-parallel.py
> 112233.445567 iterations/sec
>
> yade-trunk-opt simple-scene.py
> 105485.232068 iterations/sec
>
>
>   
What is your hardware? I get to 5e4 iters/sec on my laptop, probably to
double on 2 x dualcore opterons (didn't try). (Sadly, Playstation 3 has
max. 256MB of memory, otherwise it would be killer thing to run
computations on - with 7 cores for massively vectorized floating point...)

openMP defaults to number of threads = number of cores (IIRC).... Second
and third cases being roughly equal would mean you run on 1 core
machine? No idea.

There is some overhead of starting the parallel section, which in the
case of simple-scene probably ouweights the gains of it. I suspect
however that it might be worth it for larger simulation, where we are at
few iterations / sec.

Vaclav


From eudoxos at arcig.cz  Tue Jul  1 20:32:56 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 01 Jul 2008 20:32:56 +0200
Subject: [yade-dev] [Yade-commits] r1404 - in trunk: extra gui/py
 gui/qt3 pkg/common/Engine/MetaEngine pkg/common/Engine/StandAloneEngine
 pkg/common/RenderingEngine/GLDrawGeometricalModel
 pkg/dem/Engine/StandAloneEngine
In-Reply-To: <200807011223.48087.dorofeenko@icp.ac.ru>
References: <200806290733.m5T7XPPp009606@sheep.berlios.de>	<200806302102.43590.dorofeenko@icp.ac.ru>	<486943BA.7050502@arcig.cz>
	<200807011223.48087.dorofeenko@icp.ac.ru>
Message-ID: <486A7858.6070202@arcig.cz>


> Fix in svn1409.
>   
Thanks.
> sega at linux:~/work/yade/trunk/scripts> yade-trunk-nopermissive simple-scene.py
> ...
> ERROR gui/qt3/QtGUI.cpp:57 run: Unprocessed non-option argument: `simple-scene.py'
>   
If you don't have boost::python, scons will (silently) build without
python enabled, hende QtGUI will not be able to process this argument.
Boost::python uses some code that doesn't compile with the stricter g++
4.3, unless you use -fpermissive; that is, I think, why already the
check for boost::python will fail.
> Checking for boost::python::scope() in C++ library boost_python-mt... no
> Checking for boost::python::scope() in C++ library boost_python... no
>   
You can look in config.log, you will see that the compiler chokes on
some boost::python header.
> 1. Viewer size does not change with SimulationPlayer window size.
>   
The viewer is fixed-size (that is how it was designed and I didn't chage
it yet).
> 2. The Primary View of Simulation Controller does not show at first start (seems, scene size is not correct).
>   
This was also fixed in r1409 (did you svn update?), at least for me (the
secene was realoding spuriously and rootBody didn't have the AABB). Use
the C (AABB center or average scene center) or Alt-C (median scene
center) to get the scene right if there is a problem.

V.


From dorofeenko at icp.ac.ru  Wed Jul  2 13:46:32 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Wed, 2 Jul 2008 15:46:32 +0400
Subject: [yade-dev] run faster by +16% with r1402
In-Reply-To: <486A7722.8030304@arcig.cz>
References: <4863833E.3000908@arcig.cz>
	<200807011759.22775.dorofeenko@icp.ac.ru>
	<486A7722.8030304@arcig.cz>
Message-ID: <200807021546.33344.dorofeenko@icp.ac.ru>

> > export OMP_NUM_THREADS=2; yade-trunk-opt simple-scene-parallel.py
> > 36114.1206212 iterations/sec
> >
> > export OMP_NUM_THREADS=1; yade-trunk-opt simple-scene-parallel.py
> > 112233.445567 iterations/sec
> >
> > yade-trunk-opt simple-scene.py
> > 105485.232068 iterations/sec

This all for Athlon 64 X2 4200+,
compiled by g++ 4.3.1 with profile=opt CXXFLAGS = ['-fpermissive', '-march=athlon64']

-- 
Best regards, Sergei D.


From dorofeenko at icp.ac.ru  Wed Jul  2 15:37:59 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Wed, 2 Jul 2008 17:37:59 +0400
Subject: [yade-dev] [Yade-commits] r1404 - in trunk: extra gui/py
	gui/qt3 pkg/common/Engine/MetaEngine
	pkg/common/Engine/StandAloneEngine
	pkg/common/RenderingEngine/GLDrawGeometricalModel
	pkg/dem/Engine/StandAloneEngine
In-Reply-To: <486A7858.6070202@arcig.cz>
References: <200806290733.m5T7XPPp009606@sheep.berlios.de>
	<200807011223.48087.dorofeenko@icp.ac.ru>
	<486A7858.6070202@arcig.cz>
Message-ID: <200807021737.59227.dorofeenko@icp.ac.ru>

> > 1. Viewer size does not change with SimulationPlayer window size.
> >   
> The viewer is fixed-size (that is how it was designed and I didn't chage
> it yet).

Hm.. In svn1401 the viewer size changed along with the size of the player window...

> > 2. The Primary View of Simulation Controller does not show at first start (seems, scene size is not correct).
> >   
> This was also fixed in r1409 (did you svn update?), at least for me (the
> secene was realoding spuriously and rootBody didn't have the AABB). Use
> the C (AABB center or average scene center) or Alt-C (median scene
> center) to get the scene right if there is a problem.

No, the C or Alt-C does not help... 
The image appears after doing one timestep and close/reopen controller.


-- 
Best regards, Sergei D.


From eudoxos at arcig.cz  Wed Jul  2 19:22:42 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 02 Jul 2008 19:22:42 +0200
Subject: [yade-dev] [Yade-commits] r1404 - in trunk: extra gui/py	gui/qt3
 pkg/common/Engine/MetaEngine	pkg/common/Engine/StandAloneEngine	pkg/common/RenderingEngine/GLDrawGeometricalModel
 pkg/dem/Engine/StandAloneEngine
In-Reply-To: <200807021737.59227.dorofeenko@icp.ac.ru>
References: <200806290733.m5T7XPPp009606@sheep.berlios.de>	<200807011223.48087.dorofeenko@icp.ac.ru>	<486A7858.6070202@arcig.cz>
	<200807021737.59227.dorofeenko@icp.ac.ru>
Message-ID: <486BB962.7010706@arcig.cz>


>> This was also fixed in r1409 (did you svn update?), at least for me (the
>> secene was realoding spuriously and rootBody didn't have the AABB). Use
>> the C (AABB center or average scene center) or Alt-C (median scene
>> center) to get the scene right if there is a problem.
>>     
>
> No, the C or Alt-C does not help... 
> The image appears after doing one timestep and close/reopen controller.
>   
I tries this with simple-scene and it is OK. Can you attach your scene?
Or enable debug logs for GLViewer in logging.conf, centerScene() should
tell us what is going on.

Thanks, Vaclav


From nicessgg at gmail.com  Thu Jul  3 20:54:55 2008
From: nicessgg at gmail.com (kan)
Date: Thu, 3 Jul 2008 13:54:55 -0500
Subject: [yade-dev] yade-dev Digest, Vol 20, Issue 2
In-Reply-To: <mailman.42.1214992884.1795.yade-dev@lists.berlios.de>
References: <mailman.42.1214992884.1795.yade-dev@lists.berlios.de>
Message-ID: <45213f870807031154t16c1b8e3s28e2e01fc3cbd246@mail.gmail.com>

To sega and Vaclav,

The speed as you stated is good as far as I know.
Could you please let me know what is your hardware. and how many particles
have you used?

Thanks.
Kan

>
> yade-trunk-opt simple-scene.py
> 105485.232068 iterations/sec
>
>
>
What is your hardware? I get to 5e4 iters/sec on my laptop, probably to
double on 2 x dualcore opterons (didn't try). (Sadly, Playstation 3 has

On Wed, Jul 2, 2008 at 5:01 AM, <yade-dev-request at lists.berlios.de> wrote:

> Send yade-dev mailing list submissions to
>        yade-dev at lists.berlios.de
>
> To subscribe or unsubscribe via the World Wide Web, visit
>        https://lists.berlios.de/mailman/listinfo/yade-dev
> or, via email, send a message with subject or body 'help' to
>        yade-dev-request at lists.berlios.de
>
> You can reach the person managing the list at
>        yade-dev-owner at lists.berlios.de
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of yade-dev digest..."
>
>
> Today's Topics:
>
>   1. Re: run faster by +16% with r1402 (sega)
>   2. Re: run faster by +16% with r1402 (milauer <eudoxos at arcig.cz>)
>   3. Re: [Yade-commits] r1404 - in trunk: extra gui/py gui/qt3
>      pkg/common/Engine/MetaEngine pkg/common/Engine/StandAloneEngine
>      pkg/common/RenderingEngine/GLDrawGeometricalModel
>      pkg/dem/Engine/StandAloneEngine (milauer <eudoxos at arcig.cz>)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Tue, 1 Jul 2008 17:59:22 +0400
> From: sega <dorofeenko at icp.ac.ru>
> Subject: Re: [yade-dev] run faster by +16% with r1402
> To: Yade Development Group <yade-dev at lists.berlios.de>
> Message-ID: <200807011759.22775.dorofeenko at icp.ac.ru>
> Content-Type: text/plain;  charset="iso-8859-1"
>
> Hi!
> I can not understand how to use a parallel engine.
> I have the following results:
>
> export OMP_NUM_THREADS=2; yade-trunk-opt simple-scene-parallel.py
> 36114.1206212 iterations/sec
>
> export OMP_NUM_THREADS=1; yade-trunk-opt simple-scene-parallel.py
> 112233.445567 iterations/sec
>
>
> yade-trunk-opt simple-scene.py
> 105485.232068 iterations/sec
>
>
> --
> Best regards, Sergei D.
>
>
> ------------------------------
>
> Message: 2
> Date: Tue, 01 Jul 2008 20:27:46 +0200
> From: V?clav S(milauer <eudoxos at arcig.cz>
> Subject: Re: [yade-dev] run faster by +16% with r1402
> To: Yade Development Group <yade-dev at lists.berlios.de>
> Message-ID: <486A7722.8030304 at arcig.cz>
> Content-Type: text/plain; charset=ISO-8859-1
>
>
>
>
>
> > export OMP_NUM_THREADS=2; yade-trunk-opt simple-scene-parallel.py
> > 36114.1206212 iterations/sec
> >
> > export OMP_NUM_THREADS=1; yade-trunk-opt simple-scene-parallel.py
> > 112233.445567 iterations/sec
> >
> > yade-trunk-opt simple-scene.py
> > 105485.232068 iterations/sec
> >
> >
> >
> What is your hardware? I get to 5e4 iters/sec on my laptop, probably to
> double on 2 x dualcore opterons (didn't try). (Sadly, Playstation 3 has
> max. 256MB of memory, otherwise it would be killer thing to run
> computations on - with 7 cores for massively vectorized floating point...)
>
> openMP defaults to number of threads = number of cores (IIRC).... Second
> and third cases being roughly equal would mean you run on 1 core
> machine? No idea.
>
> There is some overhead of starting the parallel section, which in the
> case of simple-scene probably ouweights the gains of it. I suspect
> however that it might be worth it for larger simulation, where we are at
> few iterations / sec.
>
> Vaclav
>
>
> ------------------------------
>
> Message: 3
> Date: Tue, 01 Jul 2008 20:32:56 +0200
> From: V?clav S(milauer <eudoxos at arcig.cz>
> Subject: Re: [yade-dev] [Yade-commits] r1404 - in trunk: extra gui/py
>        gui/qt3 pkg/common/Engine/MetaEngine
>        pkg/common/Engine/StandAloneEngine
>        pkg/common/RenderingEngine/GLDrawGeometricalModel
>        pkg/dem/Engine/StandAloneEngine
> To: Yade Development Group <yade-dev at lists.berlios.de>
> Message-ID: <486A7858.6070202 at arcig.cz>
> Content-Type: text/plain; charset=ISO-8859-1
>
>
> > Fix in svn1409.
> >
> Thanks.
> > sega at linux:~/work/yade/trunk/scripts> yade-trunk-nopermissive
> simple-scene.py
> > ...
> > ERROR gui/qt3/QtGUI.cpp:57 run: Unprocessed non-option argument:
> `simple-scene.py'
> >
> If you don't have boost::python, scons will (silently) build without
> python enabled, hende QtGUI will not be able to process this argument.
> Boost::python uses some code that doesn't compile with the stricter g++
> 4.3, unless you use -fpermissive; that is, I think, why already the
> check for boost::python will fail.
> > Checking for boost::python::scope() in C++ library boost_python-mt... no
> > Checking for boost::python::scope() in C++ library boost_python... no
> >
> You can look in config.log, you will see that the compiler chokes on
> some boost::python header.
> > 1. Viewer size does not change with SimulationPlayer window size.
> >
> The viewer is fixed-size (that is how it was designed and I didn't chage
> it yet).
> > 2. The Primary View of Simulation Controller does not show at first start
> (seems, scene size is not correct).
> >
> This was also fixed in r1409 (did you svn update?), at least for me (the
> secene was realoding spuriously and rootBody didn't have the AABB). Use
> the C (AABB center or average scene center) or Alt-C (median scene
> center) to get the scene right if there is a problem.
>
> V.
>
>
> ------------------------------
>
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>
> End of yade-dev Digest, Vol 20, Issue 2
> ***************************************
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080703/f1f7c6ed/attachment.html>

From eudoxos at arcig.cz  Fri Jul  4 04:06:05 2008
From: eudoxos at arcig.cz (=?UTF-8?B?VsOhY2xhdiDFoG1pbGF1ZXI=?=)
Date: Fri, 04 Jul 2008 04:06:05 +0200
Subject: [yade-dev] yade-dev Digest, Vol 20, Issue 2
In-Reply-To: <45213f870807031154t16c1b8e3s28e2e01fc3cbd246@mail.gmail.com>
References: <mailman.42.1214992884.1795.yade-dev@lists.berlios.de>
	<45213f870807031154t16c1b8e3s28e2e01fc3cbd246@mail.gmail.com>
Message-ID: <486D858D.3090909@arcig.cz>


> The speed as you stated is good as far as I know.
> Could you please let me know what is your hardware. and how many
> particles have you used?
(please don't reply to digests...)

Mine is (/proc/cpuinfo) dualcore "Intel(R) Core(TM)2 Duo CPU L7300  @
1.40GHz", with 64bit system and compiling with -march=core2 and g++-4.3.
The other machine is 2 x "Dual-Core AMD Opteron(tm) Processor 8218" (4
cores total), same system.

scripts/simple-scene.py is what creates the scene, there are only 2
bodies. The same is the SimpleScene generator.

Regards, Vaclav


From eudoxos at arcig.cz  Fri Jul  4 04:59:50 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Fri, 04 Jul 2008 04:59:50 +0200
Subject: [yade-dev] [Yade-commits] r1404 - in trunk: extra gui/py	gui/qt3
 pkg/common/Engine/MetaEngine	pkg/common/Engine/StandAloneEngine	pkg/common/RenderingEngine/GLDrawGeometricalModel
 pkg/dem/Engine/StandAloneEngine
In-Reply-To: <200807021737.59227.dorofeenko@icp.ac.ru>
References: <200806290733.m5T7XPPp009606@sheep.berlios.de>	<200807011223.48087.dorofeenko@icp.ac.ru>	<486A7858.6070202@arcig.cz>
	<200807021737.59227.dorofeenko@icp.ac.ru>
Message-ID: <486D9226.60008@arcig.cz>


>> This was also fixed in r1409 (did you svn update?), at least for me (the
>> secene was realoding spuriously and rootBody didn't have the AABB). Use
>> the C (AABB center or average scene center) or Alt-C (median scene
>> center) to get the scene right if there is a problem.
>>     
>
> No, the C or Alt-C does not help... 
> The image appears after doing one timestep and close/reopen controller.
>
>   
This should be definitely fixed in r1413 (I hope),
BoundingVolume::{min,max} were not initialized and might have contained
garbage. I had added initialization to AABB before, but those are not
used in this case.

Vaclav


From dorofeenko at icp.ac.ru  Fri Jul  4 16:11:51 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Fri, 4 Jul 2008 18:11:51 +0400
Subject: [yade-dev]
 =?windows-1251?q?=5BYade-commits=5D_r1404_-_in_trunk?=
 =?windows-1251?q?=3A_extra_gui/py=09gui/qt3_pkg/common/Engine/MetaEngine?=
 =?windows-1251?q?=09pkg/common/Engine/StandAloneEngine=09pkg/common/Rende?=
 =?windows-1251?q?ringEngine/GLDrawGeometricalModel_pkg/dem/Engine/StandAl?=
 =?windows-1251?q?oneEngine?=
In-Reply-To: <486D9226.60008@arcig.cz>
References: <200806290733.m5T7XPPp009606@sheep.berlios.de>
	<200807021737.59227.dorofeenko@icp.ac.ru> <486D9226.60008@arcig.cz>
Message-ID: <200807041811.52103.dorofeenko@icp.ac.ru>

> >
> > No, the C or Alt-C does not help... 
> > The image appears after doing one timestep and close/reopen controller.
> >   
> This should be definitely fixed in r1413 (I hope),
> BoundingVolume::{min,max} were not initialized and might have contained
> garbage. I had added initialization to AABB before, but those are not
> used in this case.

Yes, now it works correctly. Thanks.


-- 
Best regards, Sergei D.


From eudoxos at arcig.cz  Thu Jul 10 21:26:40 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Thu, 10 Jul 2008 21:26:40 +0200
Subject: [yade-dev] [Yade-commits] r1419
In-Reply-To: <200807101735.m6AHZBcT009418@sheep.berlios.de>
References: <200807101735.m6AHZBcT009418@sheep.berlios.de>
Message-ID: <48766270.1080007@arcig.cz>

Sega, I unfortunately had commit conflict with you and hope that my
commits didn't break your things, please verify that. Player is now able
to use simulation saved in sqlite and I had to merge your changes by hand.

I have a few remarks:

1. First and foremost, you HAVE TO document new classes you create, so
that other people can use them (filtering engines look very useful,
btw). (it was the same with facets, which are great, please bear this in
mind)

2. Does it seem right to put filtering engines into MetBody::engines as
they are used only for scene rendering. Perhaps adding filter to
OpenGLRenderingEngine would make more sense? Clipping planes and such
could be moved to those pre-rendering engines. In such way, those
engines would not be run if you don't need the rendering - like if you
run without GL or if drawing is slower than simulation; they would be
run only right before drawing. It is just a suggestion, I haven;t
thought that through.

> Added: trunk/core/FiltrEngine.cpp
>   
3. I moved it to common, which seems like more appropriate space
(comment in the commit log). (FilterEngine? Filtr looks like a typo...)
> Modified: trunk/core/Omega.cpp
> +void Omega::setCurrentIteration(long int i) { currentIteration=i; }
>   
I moved iteration to MetaBody and adjusted this.

> +	Omega::instance().setCurrentIteration(atoi(fileName.substr(fileName.rfind('_')+1).c_str()));
>   
4. Added the same for sqlite here.

5. Would you mind running compilation before you commit? You were
missing one logger and had FiltrationalEngine.hpp instead of
FiltrEngine.hpp in the player and other errors.

6. Can you please decrease vertical size of the player window and put
filtration button elsewhere (decrease the message area, get rid of
baseName boxes etc) or something? It doesn't fit on the screen with
1024x768!

Best, Vaclav


From dorofeenko at icp.ac.ru  Fri Jul 11 09:05:52 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Fri, 11 Jul 2008 11:05:52 +0400
Subject: [yade-dev] [Yade-commits] r1419
In-Reply-To: <48766270.1080007@arcig.cz>
References: <200807101735.m6AHZBcT009418@sheep.berlios.de>
	<48766270.1080007@arcig.cz>
Message-ID: <200807111105.56419.dorofeenko@icp.ac.ru>

Sorry for errors. I will fix them in the next svn...

> 1. First and foremost, you HAVE TO document new classes you create, so
> that other people can use them (filtering engines look very useful,
> btw). (it was the same with facets, which are great, please bear this in
> mind)
I agree. The documentation should be created more accurately as YADE is _very_ badly documented (though it does not prevent it to use to me :), but strongly prevented to master...). In the future I will document more accurately (unfortunately, now I have no time for this purpose at all).

> 
> 2. Does it seem right to put filtering engines into MetBody::engines as
> they are used only for scene rendering. 
and for data probing  may be...

> Perhaps adding filter to 
> OpenGLRenderingEngine would make more sense? 
Perhaps... But I don't know what is OpenGLRenderingEngine and how it work.
(and I haven't time to know it without documentation ). 

> Clipping planes and such 
> could be moved to those pre-rendering engines. 
Yes, I think about it too.

> In such way, those 
> engines would not be run if you don't need the rendering - like if you
> run without GL or if drawing is slower than simulation; they would be
> run only right before drawing. 
And now it is. Those engines would be run if they is activated from GUI.

> 
> > Added: trunk/core/FiltrEngine.cpp
> >   
> 3. I moved it to common, which seems like more appropriate space
> (comment in the commit log). (FilterEngine? Filtr looks like a typo...)
Ok. I will fix it.
Question: how it is possible to make a legend, for example, with velocity colour scale?

> 
> 5. Would you mind running compilation before you commit? You were
> missing one logger 
Hm.. I haven't errors with it.... 

> and had FiltrationalEngine.hpp instead of 
> FiltrEngine.hpp in the player and other errors.
Sorry.

> 6. Can you please decrease vertical size of the player window and put
> filtration button elsewhere (decrease the message area, get rid of
> baseName boxes etc) or something? It doesn't fit on the screen with
> 1024x768!
I have not understood a problem. At me the sizes of a window change. 
The sizes of its boxes also change...


-- 
Best regards, Sergei D.


From eudoxos at arcig.cz  Sat Jul 12 22:17:31 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Sat, 12 Jul 2008 22:17:31 +0200
Subject: [yade-dev] gcc 4.3 issue: cast from Engine* to FilterEngine* (???)
Message-ID: <4879115B.8030207@arcig.cz>

Sega, I had to #if0 #endif (again, sorry) your code in
GLSimulationPlayerViewer

    FOREACH(shared_ptr<Engine> e, Omega::instance().getRootBody()->engines){
        if(dynamic_cast<FilterEngine*>(e.get())) {
            filters.push_back(e);
            simPlayer->pushMessage("Find filter: "+e->getClassName());
        }
    }

since I am not able to compile it. I desperately tried everything and
see not reason why it should be broken, but the compiler just says:
invalid conversion from Engine* to FilterEngine* requested. Do you have
any idea on that? Or can you try with g++ 4.3?

For another thing, I overwrote your changes in the player .ui file,
since I couldn't see what the diff was all about (xml) but after visual
checks I thought there were no big changes, contrary to what I did and
didn't want to lose.

Regards, Vaclav


From bruno.chareyre at hmg.inpg.fr  Wed Jul 16 17:01:13 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Wed, 16 Jul 2008 17:01:13 +0200
Subject: [yade-dev] scons vs. openMP
Message-ID: <487E0D39.5050508@hmg.inpg.fr>

Sorry if this has been discussed already, but I think a check on OpenMP 
is needed in scons build process.
I had a compilation error because OpenMP was not installed, but scons 
didn't tell that this prerequisite was missing.

Bruno

-- 
 
_______________
Chareyre Bruno
Maitre de conference

Grenoble INP
Laboratoire 3SR - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Wed Jul 16 17:04:28 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Wed, 16 Jul 2008 17:04:28 +0200
Subject: [yade-dev] scons vs. openMP
In-Reply-To: <487E0D39.5050508@hmg.inpg.fr>
References: <487E0D39.5050508@hmg.inpg.fr>
Message-ID: <487E0DFC.60409@hmg.inpg.fr>

Ah... even after installing openMP, I have this :

distcc g++ -o /home/bruno/YADE/build-trunk-opt/core/Body.o -c -O2 
-fopenmp -O3 -ffast-math -pg -pipe -Wall -DLOG4CXX -DEMBED_PYTHON 
-DMINIWM3 -DSUFFIX=\"-trunk-opt\" -DPREFIX=\"/home/bruno/YADE\" 
-DYADE_CAST=static_cast -DYADE_PTR_CAST=static_pointer_cast -DNDEBUG 
-I/home/bruno/YADE/build-trunk-opt/include/yade-trunk 
-Iinclude/yade-trunk 
-I/home/bruno/YADE/build-trunk-opt/include/yade-trunk/yade/lib-miniWm3 
-Iinclude/yade-trunk/yade/lib-miniWm3 -I/usr/share/qt3/include 
-I/usr/share/qt3/include -I/usr/include/python2.5 core/Body.cpp
cc1plus: error: unrecognized command line option "-fopenmp"
distcc g++ -o /home/bruno/YADE/build-trunk-opt/core/BodyContainer.o -c 
-O2 -fopenmp -O3 -ffast-math -pg -pipe -Wall -DLOG4CXX -DEMBED_PYTHON 
-DMINIWM3 -DSUFFIX=\"-trunk-opt\" -DPREFIX=\"/home/bruno/YADE\" 
-DYADE_CAST=static_cast -DYADE_PTR_CAST=static_pointer_cast -DNDEBUG 
-I/home/bruno/YADE/build-trunk-opt/include/yade-trunk 
-Iinclude/yade-trunk 
-I/home/bruno/YADE/build-trunk-opt/include/yade-trunk/yade/lib-miniWm3 
-Iinclude/yade-trunk/yade/lib-miniWm3 -I/usr/share/qt3/include 
-I/usr/share/qt3/include -I/usr/include/python2.5 core/BodyContainer.cpp
cc1plus: error: unrecognized command line option "-fopenmp"

Bruno


Bruno Chareyre a ?crit :
> Sorry if this has been discussed already, but I think a check on OpenMP 
> is needed in scons build process.
> I had a compilation error because OpenMP was not installed, but scons 
> didn't tell that this prerequisite was missing.
>
> Bruno
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Grenoble INP
Laboratoire 3SR - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Wed Jul 16 17:54:17 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Wed, 16 Jul 2008 17:54:17 +0200
Subject: [yade-dev] scons vs. openMP
In-Reply-To: <487E0DFC.60409@hmg.inpg.fr>
References: <487E0D39.5050508@hmg.inpg.fr> <487E0DFC.60409@hmg.inpg.fr>
Message-ID: <487E19A9.1010407@hmg.inpg.fr>

Next compilation error due to parallel stuff (with "scons openmp=0") :


 g++ -o 
/home/bruno/YADE/build-trunk-opt/pkg/common/Engine/ParallelEngine.os -c 
-O2 -O3 -ffast-math -pg -pipe -Wall -fPIC -DLOG4CXX -DEMBED_PYTHON 
-DMINIWM3 -DSUFFIX=\"-trunk-opt\" -DPREFIX=\"/home/bruno/YADE\" 
-DYADE_CAST=static_cast -DYADE_PTR_CAST=static_pointer_cast -DNDEBUG 
-I/home/bruno/YADE/build-trunk-opt/include/yade-trunk 
-Iinclude/yade-trunk 
-I/home/bruno/YADE/build-trunk-opt/include/yade-trunk/yade/lib-miniWm3 
-Iinclude/yade-trunk/yade/lib-miniWm3 -I/usr/share/qt3/include 
-I/usr/share/qt3/include -I/usr/include/python2.5 
pkg/common/Engine/ParallelEngine.cpp
pkg/common/Engine/ParallelEngine.cpp:2:16: error: omp.h: No such file or 
directory
pkg/common/Engine/ParallelEngine.cpp:18: warning: ignoring #pragma omp 
parallel
distcc[9882] ERROR: compile pkg/common/Engine/ParallelEngine.cpp on 
localhost failed
scons: *** 
[/home/bruno/YADE/build-trunk-opt/pkg/common/Engine/ParallelEngine.os] 
Error 1
scons: building terminated because of errors.


Bruno Chareyre a ?crit :
> Ah... even after installing openMP, I have this :
>
> distcc g++ -o /home/bruno/YADE/build-trunk-opt/core/Body.o -c -O2 
> -fopenmp -O3 -ffast-math -pg -pipe -Wall -DLOG4CXX -DEMBED_PYTHON 
> -DMINIWM3 -DSUFFIX=\"-trunk-opt\" -DPREFIX=\"/home/bruno/YADE\" 
> -DYADE_CAST=static_cast -DYADE_PTR_CAST=static_pointer_cast -DNDEBUG 
> -I/home/bruno/YADE/build-trunk-opt/include/yade-trunk 
> -Iinclude/yade-trunk 
> -I/home/bruno/YADE/build-trunk-opt/include/yade-trunk/yade/lib-miniWm3 
> -Iinclude/yade-trunk/yade/lib-miniWm3 -I/usr/share/qt3/include 
> -I/usr/share/qt3/include -I/usr/include/python2.5 core/Body.cpp
> cc1plus: error: unrecognized command line option "-fopenmp"
> distcc g++ -o /home/bruno/YADE/build-trunk-opt/core/BodyContainer.o -c 
> -O2 -fopenmp -O3 -ffast-math -pg -pipe -Wall -DLOG4CXX -DEMBED_PYTHON 
> -DMINIWM3 -DSUFFIX=\"-trunk-opt\" -DPREFIX=\"/home/bruno/YADE\" 
> -DYADE_CAST=static_cast -DYADE_PTR_CAST=static_pointer_cast -DNDEBUG 
> -I/home/bruno/YADE/build-trunk-opt/include/yade-trunk 
> -Iinclude/yade-trunk 
> -I/home/bruno/YADE/build-trunk-opt/include/yade-trunk/yade/lib-miniWm3 
> -Iinclude/yade-trunk/yade/lib-miniWm3 -I/usr/share/qt3/include 
> -I/usr/share/qt3/include -I/usr/include/python2.5 core/BodyContainer.cpp
> cc1plus: error: unrecognized command line option "-fopenmp"
>
> Bruno
>
>
> Bruno Chareyre a ?crit :
>   
>> Sorry if this has been discussed already, but I think a check on OpenMP 
>> is needed in scons build process.
>> I had a compilation error because OpenMP was not installed, but scons 
>> didn't tell that this prerequisite was missing.
>>
>> Bruno
>>
>>   
>>     
>
>   

>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Grenoble INP
Laboratoire 3SR - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Wed Jul 16 18:05:46 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Wed, 16 Jul 2008 18:05:46 +0200
Subject: [yade-dev] scons vs. openMP
In-Reply-To: <487E19A9.1010407@hmg.inpg.fr>
References: <487E0D39.5050508@hmg.inpg.fr> <487E0DFC.60409@hmg.inpg.fr>
	<487E19A9.1010407@hmg.inpg.fr>
Message-ID: <487E1C5A.4020303@hmg.inpg.fr>

Previous error fixed locally by disabling the compilation of 
ParallelEngine in scons file.

Next error :
 
pkg/dem/Engine/StandAloneEngine/SQLiteRecorder.cpp: In member function 
'virtual void SQLiteRecorder::action(MetaBody*)':
pkg/dem/Engine/StandAloneEngine/SQLiteRecorder.cpp:70: error: 'join' is 
not a member of 'boost::algorithm'

I guess I need boost 1.34?


Bruno
 
Bruno Chareyre a ?crit :
> Next compilation error due to parallel stuff (with "scons openmp=0") :
>
>
>  g++ -o 
> /home/bruno/YADE/build-trunk-opt/pkg/common/Engine/ParallelEngine.os -c 
> -O2 -O3 -ffast-math -pg -pipe -Wall -fPIC -DLOG4CXX -DEMBED_PYTHON 
> -DMINIWM3 -DSUFFIX=\"-trunk-opt\" -DPREFIX=\"/home/bruno/YADE\" 
> -DYADE_CAST=static_cast -DYADE_PTR_CAST=static_pointer_cast -DNDEBUG 
> -I/home/bruno/YADE/build-trunk-opt/include/yade-trunk 
> -Iinclude/yade-trunk 
> -I/home/bruno/YADE/build-trunk-opt/include/yade-trunk/yade/lib-miniWm3 
> -Iinclude/yade-trunk/yade/lib-miniWm3 -I/usr/share/qt3/include 
> -I/usr/share/qt3/include -I/usr/include/python2.5 
> pkg/common/Engine/ParallelEngine.cpp
> pkg/common/Engine/ParallelEngine.cpp:2:16: error: omp.h: No such file or 
> directory
> pkg/common/Engine/ParallelEngine.cpp:18: warning: ignoring #pragma omp 
> parallel
> distcc[9882] ERROR: compile pkg/common/Engine/ParallelEngine.cpp on 
> localhost failed
> scons: *** 
> [/home/bruno/YADE/build-trunk-opt/pkg/common/Engine/ParallelEngine.os] 
> Error 1
> scons: building terminated because of errors.
>
>
> Bruno Chareyre a ?crit :
>   
>> Ah... even after installing openMP, I have this :
>>
>> distcc g++ -o /home/bruno/YADE/build-trunk-opt/core/Body.o -c -O2 
>> -fopenmp -O3 -ffast-math -pg -pipe -Wall -DLOG4CXX -DEMBED_PYTHON 
>> -DMINIWM3 -DSUFFIX=\"-trunk-opt\" -DPREFIX=\"/home/bruno/YADE\" 
>> -DYADE_CAST=static_cast -DYADE_PTR_CAST=static_pointer_cast -DNDEBUG 
>> -I/home/bruno/YADE/build-trunk-opt/include/yade-trunk 
>> -Iinclude/yade-trunk 
>> -I/home/bruno/YADE/build-trunk-opt/include/yade-trunk/yade/lib-miniWm3 
>> -Iinclude/yade-trunk/yade/lib-miniWm3 -I/usr/share/qt3/include 
>> -I/usr/share/qt3/include -I/usr/include/python2.5 core/Body.cpp
>> cc1plus: error: unrecognized command line option "-fopenmp"
>> distcc g++ -o /home/bruno/YADE/build-trunk-opt/core/BodyContainer.o -c 
>> -O2 -fopenmp -O3 -ffast-math -pg -pipe -Wall -DLOG4CXX -DEMBED_PYTHON 
>> -DMINIWM3 -DSUFFIX=\"-trunk-opt\" -DPREFIX=\"/home/bruno/YADE\" 
>> -DYADE_CAST=static_cast -DYADE_PTR_CAST=static_pointer_cast -DNDEBUG 
>> -I/home/bruno/YADE/build-trunk-opt/include/yade-trunk 
>> -Iinclude/yade-trunk 
>> -I/home/bruno/YADE/build-trunk-opt/include/yade-trunk/yade/lib-miniWm3 
>> -Iinclude/yade-trunk/yade/lib-miniWm3 -I/usr/share/qt3/include 
>> -I/usr/share/qt3/include -I/usr/include/python2.5 core/BodyContainer.cpp
>> cc1plus: error: unrecognized command line option "-fopenmp"
>>
>> Bruno
>>
>>
>> Bruno Chareyre a ?crit :
>>   
>>     
>>> Sorry if this has been discussed already, but I think a check on OpenMP 
>>> is needed in scons build process.
>>> I had a compilation error because OpenMP was not installed, but scons 
>>> didn't tell that this prerequisite was missing.
>>>
>>> Bruno
>>>
>>>   
>>>     
>>>       
>>   
>>     
>
>   
>>   
>>     
>
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Grenoble INP
Laboratoire 3SR - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Wed Jul 16 22:07:04 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 16 Jul 2008 22:07:04 +0200
Subject: [yade-dev] scons vs. openMP
In-Reply-To: <487E1C5A.4020303@hmg.inpg.fr>
References: <487E0D39.5050508@hmg.inpg.fr>
	<487E0DFC.60409@hmg.inpg.fr>	<487E19A9.1010407@hmg.inpg.fr>
	<487E1C5A.4020303@hmg.inpg.fr>
Message-ID: <487E54E8.7020807@arcig.cz>


>  
> pkg/dem/Engine/StandAloneEngine/SQLiteRecorder.cpp: In member function 
> 'virtual void SQLiteRecorder::action(MetaBody*)':
> pkg/dem/Engine/StandAloneEngine/SQLiteRecorder.cpp:70: error: 'join' is 
> not a member of 'boost::algorithm'
>
> I guess I need boost 1.34?
>   
Yes, probably.



From eudoxos at arcig.cz  Wed Jul 16 22:06:40 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 16 Jul 2008 22:06:40 +0200
Subject: [yade-dev] scons vs. openMP
In-Reply-To: <487E19A9.1010407@hmg.inpg.fr>
References: <487E0D39.5050508@hmg.inpg.fr> <487E0DFC.60409@hmg.inpg.fr>
	<487E19A9.1010407@hmg.inpg.fr>
Message-ID: <487E54D0.9000903@arcig.cz>


> pkg/common/Engine/ParallelEngine.cpp:2:16: error: omp.h: No such file or 
> directory
>   
You can comment out that #include, it is useless (I will do so in the
next commit).


From eudoxos at arcig.cz  Wed Jul 16 22:07:29 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 16 Jul 2008 22:07:29 +0200
Subject: [yade-dev] scons vs. openMP
In-Reply-To: <487E0DFC.60409@hmg.inpg.fr>
References: <487E0D39.5050508@hmg.inpg.fr> <487E0DFC.60409@hmg.inpg.fr>
Message-ID: <487E5501.3090405@arcig.cz>


> cc1plus: error: unrecognized command line option "-fopenmp"
>   
You need g++>=4.3 for that.


From eudoxos at arcig.cz  Fri Jul 18 18:18:52 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Fri, 18 Jul 2008 18:18:52 +0200
Subject: [yade-dev] removing old cutting plane
Message-ID: <4880C26C.4090308@arcig.cz>

Bruno,

is it OK with you if I remove the cutting plane based on
qglviewer::Camera::setCuttingDistance? The reason is that there is a
more powerful implementation now and GLViewer needs some cleanups (as
always).

Vaclav


From bruno.chareyre at hmg.inpg.fr  Wed Jul 23 17:00:32 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Wed, 23 Jul 2008 17:00:32 +0200
Subject: [yade-dev] working dir vs. IPython!!
Message-ID: <48874790.5020903@hmg.inpg.fr>

Hello

It looks like the default working dir for Yade is now ~/.ipython/ 
(scene.xml's are saved in that directory!!).
I looked in python config files but I couldn't find the place where this 
path is defined.

Thank you for help.

Bruno


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Grenoble INP
Laboratoire 3SR - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Wed Jul 23 17:08:43 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Wed, 23 Jul 2008 17:08:43 +0200
Subject: [yade-dev] working dir vs. IPython!!
In-Reply-To: <48874790.5020903@hmg.inpg.fr>
References: <48874790.5020903@hmg.inpg.fr>
Message-ID: <4887497B.8050304@hmg.inpg.fr>

And now, for some reason, the working dir is Yade/bin again...
This bug is closed!

Bruno


Bruno Chareyre a ?crit :
> Hello
>
> It looks like the default working dir for Yade is now ~/.ipython/ 
> (scene.xml's are saved in that directory!!).
> I looked in python config files but I couldn't find the place where this 
> path is defined.
>
> Thank you for help.
>
> Bruno
>
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Grenoble INP
Laboratoire 3SR - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Thu Jul 24 14:14:49 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Thu, 24 Jul 2008 14:14:49 +0200
Subject: [yade-dev] something is broken in contact detection (probably) +
	QtGUI timestep
Message-ID: <48887239.10902@hmg.inpg.fr>

Hello

I upgraded yade from r1386 to last revision, and I see a bug has been 
introduced (sorry, I can't read all commits and I don't know when it 
could have been introduced). To see the bug : generate a default 
TriaxialTest and run,  walls will go through the sample without moving 
spheres. From saved xml, I see that no interactions are detected (listed 
interactions all have isReal=false).
The same procedure gives a good result with r1386.

Who played with contact law or collider recently, or could point to a 
recent change linked with that?

Another boring thing is that the timestep computation will always switch 
off alone with the QtGUI, so that I need to click "auto" all the time 
when I start-stop-load simulations. Is it possible to revert to old 
behaviour?

Thank you.

Bruno

-- 
 
_______________
Chareyre Bruno
Maitre de conference

Grenoble INP
Laboratoire 3SR - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Thu Jul 24 16:24:07 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Thu, 24 Jul 2008 16:24:07 +0200
Subject: [yade-dev] something is broken in contact detection (probably)
 +	QtGUI timestep
In-Reply-To: <48887239.10902@hmg.inpg.fr>
References: <48887239.10902@hmg.inpg.fr>
Message-ID: <48889087.5010006@arcig.cz>


> I upgraded yade from r1386 to last revision, and I see a bug has been 
> introduced (sorry, I can't read all commits and I don't know when it 
> could have been introduced). To see the bug : generate a default 
> TriaxialTest and run,  walls will go through the sample without moving 
> spheres. From saved xml, I see that no interactions are detected (listed 
> interactions all have isReal=false).
> The same procedure gives a good result with r1386.
>   
Ah, that's been a long time. I am investigating that now, though I am
not aware of any change that could have introduced that.
> Another boring thing is that the timestep computation will always switch 
> off alone with the QtGUI, so that I need to click "auto" all the time 
> when I start-stop-load simulations. Is it possible to revert to old 
> behaviour?
>   
The point was that if you save the simulation to XML, you should get the
exact same state when you reload and run, including timestepper
settings. If you activate timestepper in the preprocessor, it will be
turned on when you load the xml.

Vaclav


From eudoxos at arcig.cz  Fri Jul 25 10:56:34 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Fri, 25 Jul 2008 10:56:34 +0200
Subject: [yade-dev] release?
Message-ID: <48899542.4030409@arcig.cz>

Hi everybody,

any objections against releasing the current trunk as 0.12? It seems
we're quite stable now, and there has been significant inprovements over
0.11.1 - Sega's facets and vertices with stl import, much improved
python interface, qt gui underwent significant changes, player is almost
completely remade, gl viewer has many enhancements, qglviewer is
integrated into our tree - that is only what I know of. Secondly, Ubuntu
8.04 was released and we should reflect that - see problem reports on
mailing lists. Thirdly, we would be able to update documentation on the
wiki by removing all the stuff that is not valid anymore.

Our notorious crashers are (as per scripts/default-test.py)
SDECLinkedSpheres and ThreePointBending, but I have no time (neither
intereset) to fix those.

For the release, I propose to _not_ build (by default) the fem,
realtime-rigidbody and mass-spring packages, since AFAIK no one uses
that and the code is effectively unmaintained.

Best regards, V?clav

PS. Big topic -- at least for me and Bruno -- for post-0.12 would be
removing persistentInteractions and adapting constitutive laws for that.
Besides the regular work, of course.



From eudoxos at arcig.cz  Fri Jul 25 13:09:30 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Fri, 25 Jul 2008 13:09:30 +0200
Subject: [yade-dev] release?
In-Reply-To: <48899542.4030409@arcig.cz>
References: <48899542.4030409@arcig.cz>
Message-ID: <4889B46A.1070001@arcig.cz>

Replying to myself, there is tarball for 0.12 at
http://beta.arcig.cz/~eudoxos/yade/yade-0.12.tar.bz2. Please check it
out, there are things to improve (like docs, include changelog etc), but
if that is OK with you, otherwise it will be declared officially
released. I don't know how to upload to download.berlios.de, but we can
put that file elsewhere.

I will try produce source .debs and also I will let launchpad build 0.12
binary packages (I already tried that for 1371 and it worked very well:
https://launchpad.net/~yade-team/+archive).

V?clav
> Hi everybody,
>
> any objections against releasing the current trunk as 0.12? It seems
> we're quite stable now, and there has been significant inprovements over
> 0.11.1 - Sega's facets and vertices with stl import, much improved
> python interface, qt gui underwent significant changes, player is almost
> completely remade, gl viewer has many enhancements, qglviewer is
> integrated into our tree - that is only what I know of. Secondly, Ubuntu
> 8.04 was released and we should reflect that - see problem reports on
> mailing lists. Thirdly, we would be able to update documentation on the
> wiki by removing all the stuff that is not valid anymore.
>
> Our notorious crashers are (as per scripts/default-test.py)
> SDECLinkedSpheres and ThreePointBending, but I have no time (neither
> intereset) to fix those.
>
> For the release, I propose to _not_ build (by default) the fem,
> realtime-rigidbody and mass-spring packages, since AFAIK no one uses
> that and the code is effectively unmaintained.
>
> Best regards, V?clav
>
> PS. Big topic -- at least for me and Bruno -- for post-0.12 would be
> removing persistentInteractions and adapting constitutive laws for that.
> Besides the regular work, of course.
>
> _______________________________________________
> yade-dev mailing list
> yade-dev at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/yade-dev
>
>   



From eudoxos at arcig.cz  Sun Jul 27 13:33:52 2008
From: eudoxos at arcig.cz (Vaclav Smilauer)
Date: Sun, 27 Jul 2008 13:33:52 +0200 (CEST)
Subject: [yade-dev] [robot] running failed
Message-ID: <20080727113352.696C5980AD@delta>



From eudoxos at arcig.cz  Sun Jul 27 14:02:21 2008
From: eudoxos at arcig.cz (Vaclav Smilauer)
Date: Sun, 27 Jul 2008 14:02:21 +0200 (CEST)
Subject: [yade-dev] [robot] startup failed
Message-ID: <20080727120221.2FE43980AD@delta>



From eudoxos at arcig.cz  Sun Jul 27 14:16:27 2008
From: eudoxos at arcig.cz (eudoxos at arcig.cz)
Date: Sun, 27 Jul 2008 14:16:27 +0200 (CEST)
Subject: [yade-dev] Automated crash report for
	/tmp/yade-3212/bin/yade-svn1453:	SDECLinkedSpheres,
	ThreePointBending
Message-ID: <20080727121627.8CF98980AC@delta>

################################################################################
SDECLinkedSpheres: simulation CRASH
################################################################################
yade-svn1453: /usr/include/boost/shared_ptr.hpp:315: T* boost::shared_ptr<T>::operator->() const [with T = SpheresContactGeometry]: Assertion `px != 0' failed.
Running script /tmp/yade-test-6133.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1453/gdb_crash_batch-pid6193'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0x7fa7ed901730 (LWP 6193)]
[New Thread 0x41d3a950 (LWP 6194)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 0000000000000120
0x00007fa7ed1a7e81 in nanosleep () from /lib/libpthread.so.0
No symbol "info" in current context.

Thread 2 (Thread 0x41d3a950 (LWP 6194)):
#0  0x00007fa7e959b4df in waitpid () from /lib/libc.so.6
#1  0x00007fa7e953c461 in ?? () from /lib/libc.so.6
#2  0x00007fa7e953c7e7 in system () from /lib/libc.so.6
#3  0x000000000058b65d in sigHandler (sig=6) at core/yade.cpp:58
#4  <signal handler called>
#5  0x00007fa7e9530095 in raise () from /lib/libc.so.6
#6  0x00007fa7e9531af0 in abort () from /lib/libc.so.6
#7  0x00007fa7e95292df in __assert_fail () from /lib/libc.so.6
#8  0x00007fa7dd5b3c43 in boost::shared_ptr<SpheresContactGeometry>::operator-> (this=0x41d39bc0) at /usr/include/boost/shared_ptr.hpp:315
#9  0x00007fa7dd5a7628 in InteractingSphere2InteractingSphere4SpheresContactGeometry::go (this=0xa9df40, cm1=@0xaa4be8, cm2=@0xaa2e08, se31=@0xaa56d0, se32=@0xaa5860, c=@0x41d39d00) at pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp:69
#10 0x00007fa7dffe1b5d in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<InteractingGeometry, Loki::NullType> >, InteractionGeometryEngineUnit, bool, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Se3<double> const&, Loki::Typelist<boost::shared_ptr<Interaction> const&, Loki::NullType> > > > >, false>::operator() (this=0xa9dbf8, base1=@0xaa4be8, base2=@0xaa2e08, p3=@0xaa56d0, p4=@0xaa5860, p5=@0x41d39d00) at /tmp/yade-3212/build-svn1453/include/yade-svn1453/yade/lib-multimethods/DynLibDispatcher.hpp:882
#11 0x00007fa7dffd5e34 in InteractionGeometryMetaEngine::action (this=0xa9dbb0, ncb=0xa9ac10) at pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.cpp:31
#12 0x000000000052c12b in MetaBody::moveToNextTimeStep (this=0xa9ac10) at core/MetaBody.cpp:95
#13 0x00000000005827cb in SimulationFlow::singleAction (this=0x833c90) at core/SimulationFlow.cpp:18
#14 0x000000000058471f in ThreadWorker::callSingleAction (this=0x833c90) at core/ThreadWorker.cpp:71
#15 0x0000000000583f12 in ThreadRunner::call (this=0xa636c0) at core/ThreadRunner.cpp:44
#16 0x0000000000583f78 in ThreadRunner::run (this=0xa636c0) at core/ThreadRunner.cpp:23
#17 0x00000000005843f0 in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x41d3a0c8, p=0xa636c0) at /usr/include/boost/bind/mem_fn_template.hpp:49
#18 0x000000000058445d in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x41d3a0d8, f=@0x41d3a0c8, a=@0x41d3a02f) at /usr/include/boost/bind.hpp:231
#19 0x000000000058449a in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x41d3a0c8) at /usr/include/boost/bind/bind_template.hpp:20
#20 0x00000000005844b9 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x41d3a0c8) at /usr/include/boost/function/function_template.hpp:155
#21 0x00007fa7ecb41537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#22 0x00007fa7ecb411a2 in ?? () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#23 0x00007fa7ed1a03f7 in start_thread () from /lib/libpthread.so.0
#24 0x00007fa7e95d5b2d in clone () from /lib/libc.so.6
#25 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7fa7ed901730 (LWP 6193)):
#0  0x00007fa7ed1a7e81 in nanosleep () from /lib/libpthread.so.0
#1  0x00007fa7bef39e95 in pyOmega::wait (this=0xa95c20) at gui/py/yadeControl.cpp:396
#2  0x00007fa7bee370d9 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0x25e4968, tc=@0x7ffff5941c90) at /usr/include/boost/python/detail/invoke.hpp:94
#3  0x00007fa7beed8672 in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0x25e4968, args_=0x7fa7ed83ded0) at /usr/include/boost/python/detail/caller.hpp:199
#4  0x00007fa7beed86c5 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0x25e4960, args=0x7fa7ed83ded0, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#5  0x00007fa7eaebeabe in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#6  0x00007fa7eaebede8 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#7  0x00007fa7ecb41537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#8  0x00007fa7eaec69f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#9  0x00007fa7eaebc127 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#10 0x00007fa7ed3edf53 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007fa7ed46b9f0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#12 0x00007fa7ed46f8c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#13 0x00007fa7ed46f9e2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#14 0x00007fa7ed492b51 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#15 0x00007fa7ed467716 in ?? () from /usr/lib/libpython2.5.so.1.0
#16 0x00007fa7ed46e780 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0x00007fa7ed46f8c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0x00007fa7ed46f9e2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#19 0x00007fa7ed492b51 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#20 0x00007fa7ed492deb in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#21 0x00007fa7d9cbba56 in PythonUI::execScript (script={static npos = 18446744073709551615, _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7ffff5942cd0 "hT?"}}) at gui/py/PythonUI.cpp:44
#22 0x00007fa7d9cbcd59 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:95
#23 0x00007fa7d9cbdd17 in PythonUI::run (this=0x834730, argc=3, argv=0x7ffff59439e0) at gui/py/PythonUI.cpp:127
#24 0x000000000058afeb in main (argc=3, argv=0x7ffff59439e0) at core/yade.cpp:248
#0  0x00007fa7ed1a7e81 in nanosleep () from /lib/libpthread.so.0

################################################################################
ThreePointBending: simulation CRASH
################################################################################
Running script /tmp/yade-test-6133.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1453/gdb_crash_batch-pid6238'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0x7f999247a730 (LWP 6238)]
[New Thread 0x40e6d950 (LWP 6239)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 0000000000000120
0x00007f9991d20e81 in nanosleep () from /lib/libpthread.so.0
No symbol "info" in current context.

Thread 2 (Thread 0x40e6d950 (LWP 6239)):
#0  0x00007f998e1144df in waitpid () from /lib/libc.so.6
#1  0x00007f998e0b5461 in ?? () from /lib/libc.so.6
#2  0x00007f998e0b57e7 in system () from /lib/libc.so.6
#3  0x000000000058b65d in sigHandler (sig=11) at core/yade.cpp:58
#4  <signal handler called>
#5  0x000000000058ef2d in BodyRedirectionVector::operator[] (this=0xaa0a40, id=0) at core/DefaultContainerImplementations/BodyRedirectionVector.cpp:205
#6  0x00007f9974f9efc3 in TranslationEngine::applyCondition (this=0xaa0af0, ncb=0xa9ac10) at pkg/common/Engine/DeusExMachina/TranslationEngine.cpp:38
#7  0x0000000000500628 in DeusExMachina::action (this=0xaa0af0, b=0xa9ac10) at core/DeusExMachina.cpp:21
#8  0x000000000052c12b in MetaBody::moveToNextTimeStep (this=0xa9ac10) at core/MetaBody.cpp:95
#9  0x00000000005827cb in SimulationFlow::singleAction (this=0x833c90) at core/SimulationFlow.cpp:18
#10 0x000000000058471f in ThreadWorker::callSingleAction (this=0x833c90) at core/ThreadWorker.cpp:71
#11 0x0000000000583f12 in ThreadRunner::call (this=0xa636c0) at core/ThreadRunner.cpp:44
#12 0x0000000000583f78 in ThreadRunner::run (this=0xa636c0) at core/ThreadRunner.cpp:23
#13 0x00000000005843f0 in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x40e6d0c8, p=0xa636c0) at /usr/include/boost/bind/mem_fn_template.hpp:49
#14 0x000000000058445d in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x40e6d0d8, f=@0x40e6d0c8, a=@0x40e6d02f) at /usr/include/boost/bind.hpp:231
#15 0x000000000058449a in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x40e6d0c8) at /usr/include/boost/bind/bind_template.hpp:20
#16 0x00000000005844b9 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x40e6d0c8) at /usr/include/boost/function/function_template.hpp:155
#17 0x00007f99916ba537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#18 0x00007f99916ba1a2 in ?? () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#19 0x00007f9991d193f7 in start_thread () from /lib/libpthread.so.0
#20 0x00007f998e14eb2d in clone () from /lib/libc.so.6
#21 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7f999247a730 (LWP 6238)):
#0  0x00007f9991d20e81 in nanosleep () from /lib/libpthread.so.0
#1  0x00007f9963ab2e95 in pyOmega::wait (this=0xa95c20) at gui/py/yadeControl.cpp:396
#2  0x00007f99639b00d9 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0x25e4968, tc=@0x7fff9a4b8800) at /usr/include/boost/python/detail/invoke.hpp:94
#3  0x00007f9963a51672 in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0x25e4968, args_=0x7f99923b6ed0) at /usr/include/boost/python/detail/caller.hpp:199
#4  0x00007f9963a516c5 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0x25e4960, args=0x7f99923b6ed0, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#5  0x00007f998fa37abe in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#6  0x00007f998fa37de8 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#7  0x00007f99916ba537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#8  0x00007f998fa3f9f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#9  0x00007f998fa35127 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#10 0x00007f9991f66f53 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007f9991fe49f0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#12 0x00007f9991fe88c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#13 0x00007f9991fe89e2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#14 0x00007f999200bb51 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#15 0x00007f9991fe0716 in ?? () from /usr/lib/libpython2.5.so.1.0
#16 0x00007f9991fe7780 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0x00007f9991fe88c6 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0x00007f9991fe89e2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#19 0x00007f999200bb51 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#20 0x00007f999200bdeb in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#21 0x00007f997e834a56 in PythonUI::execScript (script={static npos = 18446744073709551615, _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7fff9a4b9840 "hT?"}}) at gui/py/PythonUI.cpp:44
#22 0x00007f997e835d59 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:95
#23 0x00007f997e836d17 in PythonUI::run (this=0x834730, argc=3, argv=0x7fff9a4ba550) at gui/py/PythonUI.cpp:127
#24 0x000000000058afeb in main (argc=3, argv=0x7fff9a4ba550) at core/yade.cpp:248
#0  0x00007f9991d20e81 in nanosleep () from /lib/libpthread.so.0


From bruno.chareyre at hmg.inpg.fr  Thu Jul 31 15:27:56 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Thu, 31 Jul 2008 15:27:56 +0200
Subject: [yade-dev] [Yade-commits] r1455 - in trunk: core extra gui/py
 gui/qt3	lib/miniWm3
 pkg/common/Engine/DeusExMachina	pkg/common/Engine/StandAloneEngine
In-Reply-To: <200807300644.m6U6iWeo000533@sheep.berlios.de>
References: <200807300644.m6U6iWeo000533@sheep.berlios.de>
Message-ID: <4891BDDC.2010506@hmg.inpg.fr>


> 1. DECREASED Mathr::ZERO_TOLERANCE to 1e-20 so that we don't get identity quaternions for small rotation in ToAxisAngle (!!)
>   
What is that?!
Rotations are rounded to identity if they "look" small enough? Strange...
Does this change affect (in the good senses) other rotations computed in 
Yade?

Bruno


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Grenoble INP
Laboratoire 3SR - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From eudoxos at arcig.cz  Thu Jul 31 21:42:06 2008
From: eudoxos at arcig.cz (=?UTF-8?B?VsOhY2xhdiDFoG1pbGF1ZXI=?=)
Date: Thu, 31 Jul 2008 21:42:06 +0200
Subject: [yade-dev] [Yade-commits] r1455 - in trunk: core extra gui/py
 gui/qt3	lib/miniWm3
 pkg/common/Engine/DeusExMachina	pkg/common/Engine/StandAloneEngine
In-Reply-To: <4891BDDC.2010506@hmg.inpg.fr>
References: <200807300644.m6U6iWeo000533@sheep.berlios.de>
	<4891BDDC.2010506@hmg.inpg.fr>
Message-ID: <4892158E.4040608@arcig.cz>


>> 1. DECREASED Mathr::ZERO_TOLERANCE to 1e-20 so that we don't get identity quaternions for small rotation in ToAxisAngle (!!)  
>>     
> What is that?!
> Rotations are rounded to identity if they "look" small enough? Strange...
> Does this change affect (in the good senses) other rotations computed in 
> Yade?
>   
I skimmed through the Wm3 code before and it seems that it is only in
ToAxisAngle that this was used: if the quaternion norm was <
ZERO_TOLERANCE, it was taken as identity. That was, for example, that
for a unit axis (0,0,1) the angle must have been greater than 1e-5 (now
we can go as far as 1e-8). I found it because I was assigning a rotation
in python (where Se3 is serialized as
(x,y,z,axis_x,axis_y,axis_z,angle)) but when I printed that rotation, it
was zero.

That check is necessary, since the calculation in ToAxisAngle divides by
the norm, which is (I think) zero for identity quaternion, which must be
therefore handled specially.

Regards, Vaclav




From eudoxos at arcig.cz  Sun Aug  3 00:11:51 2008
From: eudoxos at arcig.cz (eudoxos at arcig.cz)
Date: Sun,  3 Aug 2008 00:11:51 +0200 (CEST)
Subject: [yade-dev] Automated crash report for
	/tmp/yade-18233/bin/yade-svn1455:	SDECLinkedSpheres,
	ThreePointBending
Message-ID: <20080802221151.DECCD188011@delta>

################################################################################
SDECLinkedSpheres: simulation CRASH
################################################################################
yade-svn1455: /usr/include/boost/shared_ptr.hpp:315: T* boost::shared_ptr<T>::operator->() const [with T = SpheresContactGeometry]: Assertion `px != 0' failed.
Running script /tmp/yade-test-21151.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1455/gdb_crash_batch-pid21210'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0x7fd7fee5b730 (LWP 21210)]
[New Thread 0x41370950 (LWP 21211)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 0000000000000120
0x00007fd7fe700e81 in nanosleep () from /lib/libpthread.so.0
No symbol "info" in current context.

Thread 2 (Thread 0x41370950 (LWP 21211)):
#0  0x00007fd7faaf44df in waitpid () from /lib/libc.so.6
#1  0x00007fd7faa95461 in ?? () from /lib/libc.so.6
#2  0x00007fd7faa957e7 in system () from /lib/libc.so.6
#3  0x000000000058b66d in sigHandler (sig=6) at core/yade.cpp:58
#4  <signal handler called>
#5  0x00007fd7faa89095 in raise () from /lib/libc.so.6
#6  0x00007fd7faa8aaf0 in abort () from /lib/libc.so.6
#7  0x00007fd7faa822df in __assert_fail () from /lib/libc.so.6
#8  0x00007fd7eeb0bc53 in boost::shared_ptr<SpheresContactGeometry>::operator-> (this=0x4136fbc0) at /usr/include/boost/shared_ptr.hpp:315
#9  0x00007fd7eeaff638 in InteractingSphere2InteractingSphere4SpheresContactGeometry::go (this=0xa9aba0, cm1=@0xaa04b8, cm2=@0xaa1238, se31=@0xaa2af0, se32=@0xaa2790, c=@0x4136fd00) at pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp:69
#10 0x00007fd7f1539b5d in DynLibDispatcher<Loki::Typelist<InteractingGeometry, Loki::Typelist<InteractingGeometry, Loki::NullType> >, InteractionGeometryEngineUnit, bool, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<boost::shared_ptr<InteractingGeometry> const&, Loki::Typelist<Se3<double> const&, Loki::Typelist<Se3<double> const&, Loki::Typelist<boost::shared_ptr<Interaction> const&, Loki::NullType> > > > >, false>::operator() (this=0xa9a9a8, base1=@0xaa04b8, base2=@0xaa1238, p3=@0xaa2af0, p4=@0xaa2790, p5=@0x4136fd00) at /tmp/yade-18233/build-svn1455/include/yade-svn1455/yade/lib-multimethods/DynLibDispatcher.hpp:882
#11 0x00007fd7f152de34 in InteractionGeometryMetaEngine::action (this=0xa9a960, ncb=0xa98100) at pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.cpp:31
#12 0x000000000052c13b in MetaBody::moveToNextTimeStep (this=0xa98100) at core/MetaBody.cpp:95
#13 0x00000000005827db in SimulationFlow::singleAction (this=0x833c10) at core/SimulationFlow.cpp:18
#14 0x000000000058472f in ThreadWorker::callSingleAction (this=0x833c10) at core/ThreadWorker.cpp:71
#15 0x0000000000583f22 in ThreadRunner::call (this=0xa60bc0) at core/ThreadRunner.cpp:44
#16 0x0000000000583f88 in ThreadRunner::run (this=0xa60bc0) at core/ThreadRunner.cpp:23
#17 0x0000000000584400 in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x413700c8, p=0xa60bc0) at /usr/include/boost/bind/mem_fn_template.hpp:49
#18 0x000000000058446d in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x413700d8, f=@0x413700c8, a=@0x4137002f) at /usr/include/boost/bind.hpp:231
#19 0x00000000005844aa in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x413700c8) at /usr/include/boost/bind/bind_template.hpp:20
#20 0x00000000005844c9 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x413700c8) at /usr/include/boost/function/function_template.hpp:155
#21 0x00007fd7fe09a537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#22 0x00007fd7fe09a1a2 in ?? () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#23 0x00007fd7fe6f93f7 in start_thread () from /lib/libpthread.so.0
#24 0x00007fd7fab2eb2d in clone () from /lib/libc.so.6
#25 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7fd7fee5b730 (LWP 21210)):
#0  0x00007fd7fe700e81 in nanosleep () from /lib/libpthread.so.0
#1  0x00007fd7d048c8b7 in pyOmega::wait (this=0xa93110) at gui/py/yadeControl.cpp:397
#2  0x00007fd7d038986b in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0xa6d0c8, tc=@0x7fff06e99e20) at /usr/include/boost/python/detail/invoke.hpp:94
#3  0x00007fd7d042b19c in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0xa6d0c8, args_=0x7fd7fed9bd50) at /usr/include/boost/python/detail/caller.hpp:199
#4  0x00007fd7d042b1ef in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0xa6d0c0, args=0x7fd7fed9bd50, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#5  0x00007fd7fc417abe in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#6  0x00007fd7fc417de8 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#7  0x00007fd7fe09a537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#8  0x00007fd7fc41f9f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#9  0x00007fd7fc415127 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#10 0x00007fd7fe946f23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007fd7fe9c4bb0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#12 0x00007fd7fe9c8a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#13 0x00007fd7fe9c8ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#14 0x00007fd7fe9ebda1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#15 0x00007fd7fe9c08d6 in ?? () from /usr/lib/libpython2.5.so.1.0
#16 0x00007fd7fe9c7940 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0x00007fd7fe9c8a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0x00007fd7fe9c8ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#19 0x00007fd7fe9ebda1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#20 0x00007fd7fe9ec03b in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#21 0x00007fd7eb213a56 in PythonUI::execScript (script={static npos = 18446744073709551615, _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7fff06e9ae60 "?)?"}}) at gui/py/PythonUI.cpp:44
#22 0x00007fd7eb214d59 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:95
#23 0x00007fd7eb215d17 in PythonUI::run (this=0x8346b0, argc=3, argv=0x7fff06e9bb70) at gui/py/PythonUI.cpp:127
#24 0x000000000058affb in main (argc=3, argv=0x7fff06e9bb70) at core/yade.cpp:248
#0  0x00007fd7fe700e81 in nanosleep () from /lib/libpthread.so.0

################################################################################
ThreePointBending: simulation CRASH
################################################################################
Running script /tmp/yade-test-21151.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1455/gdb_crash_batch-pid21255'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0x7f91d9a2f730 (LWP 21255)]
[New Thread 0x40897950 (LWP 21259)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 0000000000000120
0x00007f91d92d4e81 in nanosleep () from /lib/libpthread.so.0
No symbol "info" in current context.

Thread 2 (Thread 0x40897950 (LWP 21259)):
#0  0x00007f91d56c84df in waitpid () from /lib/libc.so.6
#1  0x00007f91d5669461 in ?? () from /lib/libc.so.6
#2  0x00007f91d56697e7 in system () from /lib/libc.so.6
#3  0x000000000058b66d in sigHandler (sig=11) at core/yade.cpp:58
#4  <signal handler called>
#5  0x000000000058ef3d in BodyRedirectionVector::operator[] (this=0xa9e490, id=0) at core/DefaultContainerImplementations/BodyRedirectionVector.cpp:205
#6  0x00007f91bc54dfd3 in TranslationEngine::applyCondition (this=0xa9b0c0, ncb=0xa98100) at pkg/common/Engine/DeusExMachina/TranslationEngine.cpp:38
#7  0x0000000000500638 in DeusExMachina::action (this=0xa9b0c0, b=0xa98100) at core/DeusExMachina.cpp:21
#8  0x000000000052c13b in MetaBody::moveToNextTimeStep (this=0xa98100) at core/MetaBody.cpp:95
#9  0x00000000005827db in SimulationFlow::singleAction (this=0x833c10) at core/SimulationFlow.cpp:18
#10 0x000000000058472f in ThreadWorker::callSingleAction (this=0x833c10) at core/ThreadWorker.cpp:71
#11 0x0000000000583f22 in ThreadRunner::call (this=0xa60bc0) at core/ThreadRunner.cpp:44
#12 0x0000000000583f88 in ThreadRunner::run (this=0xa60bc0) at core/ThreadRunner.cpp:23
#13 0x0000000000584400 in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x408970c8, p=0xa60bc0) at /usr/include/boost/bind/mem_fn_template.hpp:49
#14 0x000000000058446d in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x408970d8, f=@0x408970c8, a=@0x4089702f) at /usr/include/boost/bind.hpp:231
#15 0x00000000005844aa in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x408970c8) at /usr/include/boost/bind/bind_template.hpp:20
#16 0x00000000005844c9 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x408970c8) at /usr/include/boost/function/function_template.hpp:155
#17 0x00007f91d8c6e537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#18 0x00007f91d8c6e1a2 in ?? () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#19 0x00007f91d92cd3f7 in start_thread () from /lib/libpthread.so.0
#20 0x00007f91d5702b2d in clone () from /lib/libc.so.6
#21 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7f91d9a2f730 (LWP 21255)):
#0  0x00007f91d92d4e81 in nanosleep () from /lib/libpthread.so.0
#1  0x00007f91ab0608b7 in pyOmega::wait (this=0xa93110) at gui/py/yadeControl.cpp:397
#2  0x00007f91aaf5d86b in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0xa6d0c8, tc=@0x7fffe1a6fa00) at /usr/include/boost/python/detail/invoke.hpp:94
#3  0x00007f91aafff19c in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0xa6d0c8, args_=0x7f91d996fd50) at /usr/include/boost/python/detail/caller.hpp:199
#4  0x00007f91aafff1ef in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0xa6d0c0, args=0x7f91d996fd50, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#5  0x00007f91d6febabe in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#6  0x00007f91d6febde8 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#7  0x00007f91d8c6e537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#8  0x00007f91d6ff39f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#9  0x00007f91d6fe9127 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#10 0x00007f91d951af23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007f91d9598bb0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#12 0x00007f91d959ca86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#13 0x00007f91d959cba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#14 0x00007f91d95bfda1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#15 0x00007f91d95948d6 in ?? () from /usr/lib/libpython2.5.so.1.0
#16 0x00007f91d959b940 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0x00007f91d959ca86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0x00007f91d959cba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#19 0x00007f91d95bfda1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#20 0x00007f91d95c003b in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#21 0x00007f91c5de7a56 in PythonUI::execScript (script={static npos = 18446744073709551615, _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7fffe1a70a40 "?)?"}}) at gui/py/PythonUI.cpp:44
#22 0x00007f91c5de8d59 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:95
#23 0x00007f91c5de9d17 in PythonUI::run (this=0x8346b0, argc=3, argv=0x7fffe1a71750) at gui/py/PythonUI.cpp:127
#24 0x000000000058affb in main (argc=3, argv=0x7fffe1a71750) at core/yade.cpp:248
#0  0x00007f91d92d4e81 in nanosleep () from /lib/libpthread.so.0


From eudoxos at arcig.cz  Thu Aug  7 14:36:28 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Thu, 07 Aug 2008 14:36:28 +0200
Subject: [yade-dev] DistantSpheresContactGeometry
Message-ID: <489AEC4C.1040608@arcig.cz>

Bruno,

I looked at the diff between InteractingSphere2IS4SCG and
IS2IS4DistantSCG and to me it seems they are functionally equal, except
that the latter is written in a nicer way. Did I miss something? If one
of the is redundant, I will be happy to remove it.

Regards, Vaclav


From eudoxos at arcig.cz  Thu Aug  7 15:13:48 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Thu, 07 Aug 2008 15:13:48 +0200
Subject: [yade-dev] InteractionGeometryMetaEngine, isReal, isNew etc.
Message-ID: <489AF50C.6090906@arcig.cz>

If I mark an interaction isReal=false in the constitutive law, it will
not be deleted by the collider, since the InteractionGeometryMetaEngine
will reset that flag to the return value of the appropriate EngineUnit.

I would suggest that if(!I->isNew && !I->isReal), then don't change the
isReal flag in the MetaEngine. The current situation is that this has to
be tested in the EngineUnit and false returned if you _really_ want the
interaction to be deleted.

What do you think?

Vaclav


From janek_listy at wp.pl  Thu Aug  7 20:28:09 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Thu, 7 Aug 2008 20:28:09 +0200
Subject: [yade-dev] InteractionGeometryMetaEngine, isReal, isNew etc.
In-Reply-To: <489AF50C.6090906@arcig.cz>
References: <489AF50C.6090906@arcig.cz>
Message-ID: <20080807202809.20af6bea@absurd>

V?clav ?milauer said:     (by the date of Thu, 07 Aug 2008 15:13:48 +0200)

> I would suggest that if(!I->isNew && !I->isReal), then don't change the

this is exactly what I proposed to Bruno, when we were discussing
about those flags, one afternoon.

He found a reason for not doing that, and I forgot what was his reason.

-- 
Janek Kozicki                                                         |


From dorofeenko at icp.ac.ru  Fri Aug  8 17:17:21 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Fri, 8 Aug 2008 19:17:21 +0400
Subject: [yade-dev] non-interactive player error
In-Reply-To: <489AF50C.6090906@arcig.cz>
References: <489AF50C.6090906@arcig.cz>
Message-ID: <200808081917.21976.dorofeenko@icp.ac.ru>

Hi!
I have error with non-interactive player.
I run file player.py with

>from yade import qt
>qt.runPlayerSession('simulation.xml.gz','/tmp/__g','/tmp/qglviewerState.xml',4)
>quit()

and get following error:

>...
>INFO  gui/qt3/QtSimulationPlayer.cpp:76 pushMessage: Using directory output and basename positions.
>INFO  gui/qt3/QtSimulationPlayer.cpp:76 pushMessage: Found 6000 states to process.
>X Error: BadAccess (attempt to access private resource denied) 10
 > Major opcode:  128
 > Minor opcode:  5
 > Resource id:  0x2400156
>yade-trunk: Fatal IO error: client killed
>SIGSEGV/SIGABRT handler called; gdb batch file is `/home/sega/.yade-trunk/gdb_crash_batch-pid3515'
>sega at linux:/tmp> GNU gdb 6.8
>Copyright (C) 2008 Free Software Foundation, Inc.
>License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
>This is free software: you are free to change and redistribute it.
>There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
>and "show warranty" for details.
>This GDB was configured as "x86_64-suse-linux".
>/home/sega/.yade-trunk/gdb_crash_batch-pid3515:1: Error in sourced command file:
>ptrace: No such process.
>sega at linux:/tmp> quit


-- 
Best regards, Sergei D.


From eudoxos at arcig.cz  Sat Aug  9 06:25:30 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Sat, 09 Aug 2008 06:25:30 +0200
Subject: [yade-dev] non-interactive player error
In-Reply-To: <200808081917.21976.dorofeenko@icp.ac.ru>
References: <489AF50C.6090906@arcig.cz>
	<200808081917.21976.dorofeenko@icp.ac.ru>
Message-ID: <489D1C3A.7060200@arcig.cz>


>> X Error: BadAccess (attempt to access private resource denied) 10
>>     
>  > Major opcode:  128
>  > Minor opcode:  5
>   
I had this sometimes when running in xvfb (only on my laptop, not on a
server hardware). Could you please

1. run "/xdpyinfo -queryExt | grep 128" to find what extension causes
the error.
2. try running on a different machine, with different GPU?

Regards, Vaclav
/


From eudoxos at arcig.cz  Sun Aug 17 00:11:56 2008
From: eudoxos at arcig.cz (eudoxos at arcig.cz)
Date: Sun, 17 Aug 2008 00:11:56 +0200 (CEST)
Subject: [yade-dev] Automated crash report for
	/tmp/yade-28765/bin/yade-svn1471:	CohesiveTriaxialTest,
	DirectShearCis, FEMBeam, SnowCreepTest, TetrahedronsTest,
	ThreePointBending, TriaxialTest, TriaxialTestWater
Message-ID: <20080816221156.C719C188011@delta>

################################################################################
CohesiveTriaxialTest: simulation CRASH
################################################################################
513 [139810927355696] WARN yade  - core/yade.cpp:243 main: No $TERM, using QtGUI instead of PythonUI
513 [139810927355696] WARN yade  - core/yade.cpp:244 main: No $DISPLAY, using PythonUI instead of QtUI
Running script /tmp/yade-test-31492.py
pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:61 Interaction physics of type CohesiveFrictionalContactInteraction (36CohesiveFrictionalContactInteraction)
yade-svn1471: pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:62: void GlobalStiffnessCounter::traverseInteractions(MetaBody*, const boost::shared_ptr<InteractionContainer>&): Assertion `phys' failed.
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1471/gdb_crash_batch-pid31506'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0x7f2844a92730 (LWP 31506)]
[New Thread 0x42421950 (LWP 31508)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 0000000000000120
0x00007f2844337e81 in nanosleep () from /lib/libpthread.so.0
No symbol "info" in current context.

Thread 2 (Thread 0x42421950 (LWP 31508)):
#0  0x00007f284072b4df in waitpid () from /lib/libc.so.6
#1  0x00007f28406cc461 in ?? () from /lib/libc.so.6
#2  0x00007f28406cc7e7 in system () from /lib/libc.so.6
#3  0x000000000058a4ed in sigHandler (sig=6) at core/yade.cpp:58
#4  <signal handler called>
#5  0x00007f28406c0095 in raise () from /lib/libc.so.6
#6  0x00007f28406c1af0 in abort () from /lib/libc.so.6
#7  0x00007f28406b92df in __assert_fail () from /lib/libc.so.6
#8  0x00007f2831b16937 in GlobalStiffnessCounter::traverseInteractions (this=0xa9fc80, ncb=0xa97550, interactions=@0xa97610) at pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:62
#9  0x00007f2831b16ee0 in GlobalStiffnessCounter::action (this=0xa9fc80, ncb=0xa97550) at pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:99
#10 0x000000000052b3c3 in MetaBody::moveToNextTimeStep (this=0xa97550) at core/MetaBody.cpp:95
#11 0x0000000000581477 in SimulationFlow::singleAction (this=0x832c10) at core/SimulationFlow.cpp:18
#12 0x00000000005833cb in ThreadWorker::callSingleAction (this=0x832c10) at core/ThreadWorker.cpp:71
#13 0x0000000000582bbe in ThreadRunner::call (this=0xa97710) at core/ThreadRunner.cpp:44
#14 0x0000000000582c24 in ThreadRunner::run (this=0xa97710) at core/ThreadRunner.cpp:23
#15 0x000000000058309c in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x424210c8, p=0xa97710) at /usr/include/boost/bind/mem_fn_template.hpp:49
#16 0x0000000000583109 in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x424210d8, f=@0x424210c8, a=@0x4242102f) at /usr/include/boost/bind.hpp:231
#17 0x0000000000583146 in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x424210c8) at /usr/include/boost/bind/bind_template.hpp:20
#18 0x0000000000583165 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x424210c8) at /usr/include/boost/function/function_template.hpp:155
#19 0x00007f2843cd1537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#20 0x00007f2843cd11a2 in ?? () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#21 0x00007f28443303f7 in start_thread () from /lib/libpthread.so.0
#22 0x00007f2840765b2d in clone () from /lib/libc.so.6
#23 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7f2844a92730 (LWP 31506)):
#0  0x00007f2844337e81 in nanosleep () from /lib/libpthread.so.0
#1  0x00007f281609e17b in pyOmega::wait (this=0xa923c0) at gui/py/yadeControl.cpp:397
#2  0x00007f2815f9aca3 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0xa25e88, tc=@0x7fff4cad0a50) at /usr/include/boost/python/detail/invoke.hpp:94
#3  0x00007f281603c6ca in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0xa25e88, args_=0x7f28449d2d50) at /usr/include/boost/python/detail/caller.hpp:199
#4  0x00007f281603c71d in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0xa25e80, args=0x7f28449d2d50, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#5  0x00007f284204eabe in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#6  0x00007f284204ede8 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#7  0x00007f2843cd1537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#8  0x00007f28420569f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#9  0x00007f284204c127 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#10 0x00007f284457df23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007f28445fbbb0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#12 0x00007f28445ffa86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#13 0x00007f28445ffba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#14 0x00007f2844622da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#15 0x00007f28445f78d6 in ?? () from /usr/lib/libpython2.5.so.1.0
#16 0x00007f28445fe940 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0x00007f28445ffa86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0x00007f28445ffba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#19 0x00007f2844622da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#20 0x00007f284462303b in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#21 0x00007f283104afe6 in PythonUI::execScript (script={static npos = 18446744073709551615, _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7fff4cad1a90 "?\034?"}}) at gui/py/PythonUI.cpp:44
#22 0x00007f283104c30b in PythonUI::pythonSession () at gui/py/PythonUI.cpp:96
#23 0x00007f283104d2c9 in PythonUI::run (this=0x8336b0, argc=3, argv=0x7fff4cad27b0) at gui/py/PythonUI.cpp:128
#24 0x0000000000589e4e in main (argc=3, argv=0x7fff4cad27b0) at core/yade.cpp:249
#0  0x00007f2844337e81 in nanosleep () from /lib/libpthread.so.0

################################################################################
DirectShearCis: simulation CRASH
################################################################################
519 [140630458971952] WARN yade  - core/yade.cpp:243 main: No $TERM, using QtGUI instead of PythonUI
519 [140630458971952] WARN yade  - core/yade.cpp:244 main: No $DISPLAY, using PythonUI instead of QtUI
Running script /tmp/yade-test-31492.py
pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:61 Interaction physics of type CohesiveFrictionalContactInteraction (36CohesiveFrictionalContactInteraction)
yade-svn1471: pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:62: void GlobalStiffnessCounter::traverseInteractions(MetaBody*, const boost::shared_ptr<InteractionContainer>&): Assertion `phys' failed.
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1471/gdb_crash_batch-pid31514'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0x7fe7148d3730 (LWP 31514)]
[New Thread 0x42731950 (LWP 31519)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 0000000000000120
0x00007fe714178e81 in nanosleep () from /lib/libpthread.so.0
No symbol "info" in current context.

Thread 2 (Thread 0x42731950 (LWP 31519)):
#0  0x00007fe71056c4df in waitpid () from /lib/libc.so.6
#1  0x00007fe71050d461 in ?? () from /lib/libc.so.6
#2  0x00007fe71050d7e7 in system () from /lib/libc.so.6
#3  0x000000000058a4ed in sigHandler (sig=6) at core/yade.cpp:58
#4  <signal handler called>
#5  0x00007fe710501095 in raise () from /lib/libc.so.6
#6  0x00007fe710502af0 in abort () from /lib/libc.so.6
#7  0x00007fe7104fa2df in __assert_fail () from /lib/libc.so.6
#8  0x00007fe701957937 in GlobalStiffnessCounter::traverseInteractions (this=0xa9fc80, ncb=0xa97550, interactions=@0xa97610) at pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:62
#9  0x00007fe701957ee0 in GlobalStiffnessCounter::action (this=0xa9fc80, ncb=0xa97550) at pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:99
#10 0x000000000052b3c3 in MetaBody::moveToNextTimeStep (this=0xa97550) at core/MetaBody.cpp:95
#11 0x0000000000581477 in SimulationFlow::singleAction (this=0x832c10) at core/SimulationFlow.cpp:18
#12 0x00000000005833cb in ThreadWorker::callSingleAction (this=0x832c10) at core/ThreadWorker.cpp:71
#13 0x0000000000582bbe in ThreadRunner::call (this=0xa97710) at core/ThreadRunner.cpp:44
#14 0x0000000000582c24 in ThreadRunner::run (this=0xa97710) at core/ThreadRunner.cpp:23
#15 0x000000000058309c in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x427310c8, p=0xa97710) at /usr/include/boost/bind/mem_fn_template.hpp:49
#16 0x0000000000583109 in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x427310d8, f=@0x427310c8, a=@0x4273102f) at /usr/include/boost/bind.hpp:231
#17 0x0000000000583146 in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x427310c8) at /usr/include/boost/bind/bind_template.hpp:20
#18 0x0000000000583165 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x427310c8) at /usr/include/boost/function/function_template.hpp:155
#19 0x00007fe713b12537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#20 0x00007fe713b121a2 in ?? () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#21 0x00007fe7141713f7 in start_thread () from /lib/libpthread.so.0
#22 0x00007fe7105a6b2d in clone () from /lib/libc.so.6
#23 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7fe7148d3730 (LWP 31514)):
#0  0x00007fe714178e81 in nanosleep () from /lib/libpthread.so.0
#1  0x00007fe6e5edf17b in pyOmega::wait (this=0xa923c0) at gui/py/yadeControl.cpp:397
#2  0x00007fe6e5ddbca3 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0xa25e88, tc=@0x7fff1c911890) at /usr/include/boost/python/detail/invoke.hpp:94
#3  0x00007fe6e5e7d6ca in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0xa25e88, args_=0x7fe714813d50) at /usr/include/boost/python/detail/caller.hpp:199
#4  0x00007fe6e5e7d71d in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0xa25e80, args=0x7fe714813d50, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#5  0x00007fe711e8fabe in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#6  0x00007fe711e8fde8 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#7  0x00007fe713b12537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#8  0x00007fe711e979f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#9  0x00007fe711e8d127 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#10 0x00007fe7143bef23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007fe71443cbb0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#12 0x00007fe714440a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#13 0x00007fe714440ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#14 0x00007fe714463da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#15 0x00007fe7144388d6 in ?? () from /usr/lib/libpython2.5.so.1.0
#16 0x00007fe71443f940 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0x00007fe714440a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0x00007fe714440ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#19 0x00007fe714463da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#20 0x00007fe71446403b in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#21 0x00007fe700e8bfe6 in PythonUI::execScript (script={static npos = 18446744073709551615, _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7fff1c9128d0 "?\034?"}}) at gui/py/PythonUI.cpp:44
#22 0x00007fe700e8d30b in PythonUI::pythonSession () at gui/py/PythonUI.cpp:96
#23 0x00007fe700e8e2c9 in PythonUI::run (this=0x8336b0, argc=3, argv=0x7fff1c9135f0) at gui/py/PythonUI.cpp:128
#24 0x0000000000589e4e in main (argc=3, argv=0x7fff1c9135f0) at core/yade.cpp:249
#0  0x00007fe714178e81 in nanosleep () from /lib/libpthread.so.0

################################################################################
FEMBeam: simulation CRASH
################################################################################
516 [139890548041520] WARN yade  - core/yade.cpp:243 main: No $TERM, using QtGUI instead of PythonUI
516 [139890548041520] WARN yade  - core/yade.cpp:244 main: No $DISPLAY, using PythonUI instead of QtUI
Running script /tmp/yade-test-31492.py
pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:61 Interaction physics of type CohesiveFrictionalContactInteraction (36CohesiveFrictionalContactInteraction)
yade-svn1471: pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:62: void GlobalStiffnessCounter::traverseInteractions(MetaBody*, const boost::shared_ptr<InteractionContainer>&): Assertion `phys' failed.
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1471/gdb_crash_batch-pid31525'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0x7f3ace6c6730 (LWP 31525)]
[New Thread 0x40f2e950 (LWP 31527)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 0000000000000120
0x00007f3acdf6be81 in nanosleep () from /lib/libpthread.so.0
No symbol "info" in current context.

Thread 2 (Thread 0x40f2e950 (LWP 31527)):
#0  0x00007f3aca35f4df in waitpid () from /lib/libc.so.6
#1  0x00007f3aca300461 in ?? () from /lib/libc.so.6
#2  0x00007f3aca3007e7 in system () from /lib/libc.so.6
#3  0x000000000058a4ed in sigHandler (sig=6) at core/yade.cpp:58
#4  <signal handler called>
#5  0x00007f3aca2f4095 in raise () from /lib/libc.so.6
#6  0x00007f3aca2f5af0 in abort () from /lib/libc.so.6
#7  0x00007f3aca2ed2df in __assert_fail () from /lib/libc.so.6
#8  0x00007f3abb74a937 in GlobalStiffnessCounter::traverseInteractions (this=0xa9fc80, ncb=0xa97550, interactions=@0xa97610) at pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:62
#9  0x00007f3abb74aee0 in GlobalStiffnessCounter::action (this=0xa9fc80, ncb=0xa97550) at pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:99
#10 0x000000000052b3c3 in MetaBody::moveToNextTimeStep (this=0xa97550) at core/MetaBody.cpp:95
#11 0x0000000000581477 in SimulationFlow::singleAction (this=0x832c10) at core/SimulationFlow.cpp:18
#12 0x00000000005833cb in ThreadWorker::callSingleAction (this=0x832c10) at core/ThreadWorker.cpp:71
#13 0x0000000000582bbe in ThreadRunner::call (this=0xa97710) at core/ThreadRunner.cpp:44
#14 0x0000000000582c24 in ThreadRunner::run (this=0xa97710) at core/ThreadRunner.cpp:23
#15 0x000000000058309c in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x40f2e0c8, p=0xa97710) at /usr/include/boost/bind/mem_fn_template.hpp:49
#16 0x0000000000583109 in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x40f2e0d8, f=@0x40f2e0c8, a=@0x40f2e02f) at /usr/include/boost/bind.hpp:231
#17 0x0000000000583146 in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x40f2e0c8) at /usr/include/boost/bind/bind_template.hpp:20
#18 0x0000000000583165 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x40f2e0c8) at /usr/include/boost/function/function_template.hpp:155
#19 0x00007f3acd905537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#20 0x00007f3acd9051a2 in ?? () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#21 0x00007f3acdf643f7 in start_thread () from /lib/libpthread.so.0
#22 0x00007f3aca399b2d in clone () from /lib/libc.so.6
#23 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7f3ace6c6730 (LWP 31525)):
#0  0x00007f3acdf6be81 in nanosleep () from /lib/libpthread.so.0
#1  0x00007f3a9fcd217b in pyOmega::wait (this=0xa923c0) at gui/py/yadeControl.cpp:397
#2  0x00007f3a9fbceca3 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0xa25e88, tc=@0x7fffd6704680) at /usr/include/boost/python/detail/invoke.hpp:94
#3  0x00007f3a9fc706ca in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0xa25e88, args_=0x7f3ace606d50) at /usr/include/boost/python/detail/caller.hpp:199
#4  0x00007f3a9fc7071d in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0xa25e80, args=0x7f3ace606d50, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#5  0x00007f3acbc82abe in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#6  0x00007f3acbc82de8 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#7  0x00007f3acd905537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#8  0x00007f3acbc8a9f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#9  0x00007f3acbc80127 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#10 0x00007f3ace1b1f23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007f3ace22fbb0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#12 0x00007f3ace233a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#13 0x00007f3ace233ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#14 0x00007f3ace256da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#15 0x00007f3ace22b8d6 in ?? () from /usr/lib/libpython2.5.so.1.0
#16 0x00007f3ace232940 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0x00007f3ace233a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0x00007f3ace233ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#19 0x00007f3ace256da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#20 0x00007f3ace25703b in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#21 0x00007f3abac7efe6 in PythonUI::execScript (script={static npos = 18446744073709551615, _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7fffd67056c0 "?\034?"}}) at gui/py/PythonUI.cpp:44
#22 0x00007f3abac8030b in PythonUI::pythonSession () at gui/py/PythonUI.cpp:96
#23 0x00007f3abac812c9 in PythonUI::run (this=0x8336b0, argc=3, argv=0x7fffd67063e0) at gui/py/PythonUI.cpp:128
#24 0x0000000000589e4e in main (argc=3, argv=0x7fffd67063e0) at core/yade.cpp:249
#0  0x00007f3acdf6be81 in nanosleep () from /lib/libpthread.so.0

################################################################################
SnowCreepTest: simulation CRASH
################################################################################
515 [139816870491952] WARN yade  - core/yade.cpp:243 main: No $TERM, using QtGUI instead of PythonUI
515 [139816870491952] WARN yade  - core/yade.cpp:244 main: No $DISPLAY, using PythonUI instead of QtUI
Running script /tmp/yade-test-31492.py
pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:61 Interaction physics of type CohesiveFrictionalContactInteraction (36CohesiveFrictionalContactInteraction)
yade-svn1471: pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:62: void GlobalStiffnessCounter::traverseInteractions(MetaBody*, const boost::shared_ptr<InteractionContainer>&): Assertion `phys' failed.
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1471/gdb_crash_batch-pid31577'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0x7f29a6e63730 (LWP 31577)]
[New Thread 0x4135e950 (LWP 31579)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 0000000000000120
0x00007f29a6708e81 in nanosleep () from /lib/libpthread.so.0
No symbol "info" in current context.

Thread 2 (Thread 0x4135e950 (LWP 31579)):
#0  0x00007f29a2afc4df in waitpid () from /lib/libc.so.6
#1  0x00007f29a2a9d461 in ?? () from /lib/libc.so.6
#2  0x00007f29a2a9d7e7 in system () from /lib/libc.so.6
#3  0x000000000058a4ed in sigHandler (sig=6) at core/yade.cpp:58
#4  <signal handler called>
#5  0x00007f29a2a91095 in raise () from /lib/libc.so.6
#6  0x00007f29a2a92af0 in abort () from /lib/libc.so.6
#7  0x00007f29a2a8a2df in __assert_fail () from /lib/libc.so.6
#8  0x00007f2993ee7937 in GlobalStiffnessCounter::traverseInteractions (this=0xa9fca0, ncb=0xa97550, interactions=@0xa97610) at pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:62
#9  0x00007f2993ee7ee0 in GlobalStiffnessCounter::action (this=0xa9fca0, ncb=0xa97550) at pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:99
#10 0x000000000052b3c3 in MetaBody::moveToNextTimeStep (this=0xa97550) at core/MetaBody.cpp:95
#11 0x0000000000581477 in SimulationFlow::singleAction (this=0x832c10) at core/SimulationFlow.cpp:18
#12 0x00000000005833cb in ThreadWorker::callSingleAction (this=0x832c10) at core/ThreadWorker.cpp:71
#13 0x0000000000582bbe in ThreadRunner::call (this=0xaa0ed0) at core/ThreadRunner.cpp:44
#14 0x0000000000582c24 in ThreadRunner::run (this=0xaa0ed0) at core/ThreadRunner.cpp:23
#15 0x000000000058309c in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x4135e0c8, p=0xaa0ed0) at /usr/include/boost/bind/mem_fn_template.hpp:49
#16 0x0000000000583109 in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x4135e0d8, f=@0x4135e0c8, a=@0x4135e02f) at /usr/include/boost/bind.hpp:231
#17 0x0000000000583146 in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x4135e0c8) at /usr/include/boost/bind/bind_template.hpp:20
#18 0x0000000000583165 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x4135e0c8) at /usr/include/boost/function/function_template.hpp:155
#19 0x00007f29a60a2537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#20 0x00007f29a60a21a2 in ?? () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#21 0x00007f29a67013f7 in start_thread () from /lib/libpthread.so.0
#22 0x00007f29a2b36b2d in clone () from /lib/libc.so.6
#23 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7f29a6e63730 (LWP 31577)):
#0  0x00007f29a6708e81 in nanosleep () from /lib/libpthread.so.0
#1  0x00007f297846f17b in pyOmega::wait (this=0xa923c0) at gui/py/yadeControl.cpp:397
#2  0x00007f297836bca3 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0xa25e88, tc=@0x7fffaeea1e20) at /usr/include/boost/python/detail/invoke.hpp:94
#3  0x00007f297840d6ca in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0xa25e88, args_=0x7f29a6da3d50) at /usr/include/boost/python/detail/caller.hpp:199
#4  0x00007f297840d71d in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0xa25e80, args=0x7f29a6da3d50, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#5  0x00007f29a441fabe in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#6  0x00007f29a441fde8 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#7  0x00007f29a60a2537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#8  0x00007f29a44279f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#9  0x00007f29a441d127 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#10 0x00007f29a694ef23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007f29a69ccbb0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#12 0x00007f29a69d0a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#13 0x00007f29a69d0ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#14 0x00007f29a69f3da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#15 0x00007f29a69c88d6 in ?? () from /usr/lib/libpython2.5.so.1.0
#16 0x00007f29a69cf940 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0x00007f29a69d0a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0x00007f29a69d0ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#19 0x00007f29a69f3da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#20 0x00007f29a69f403b in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#21 0x00007f299341bfe6 in PythonUI::execScript (script={static npos = 18446744073709551615, _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7fffaeea2e60 "?\034?"}}) at gui/py/PythonUI.cpp:44
#22 0x00007f299341d30b in PythonUI::pythonSession () at gui/py/PythonUI.cpp:96
#23 0x00007f299341e2c9 in PythonUI::run (this=0x8336b0, argc=3, argv=0x7fffaeea3b80) at gui/py/PythonUI.cpp:128
#24 0x0000000000589e4e in main (argc=3, argv=0x7fffaeea3b80) at core/yade.cpp:249
#0  0x00007f29a6708e81 in nanosleep () from /lib/libpthread.so.0

################################################################################
TetrahedronsTest: simulation CRASH
################################################################################
510 [140410084329264] WARN yade  - core/yade.cpp:243 main: No $TERM, using QtGUI instead of PythonUI
510 [140410084329264] WARN yade  - core/yade.cpp:244 main: No $DISPLAY, using PythonUI instead of QtUI
Running script /tmp/yade-test-31492.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1471/gdb_crash_batch-pid31593'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0x7fb3c5330730 (LWP 31593)]
[New Thread 0x409c4950 (LWP 31594)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 0000000000000120
0x00007fb3c4bd5e81 in nanosleep () from /lib/libpthread.so.0
No symbol "info" in current context.

Thread 2 (Thread 0x409c4950 (LWP 31594)):
#0  0x00007fb3c0fc94df in waitpid () from /lib/libc.so.6
#1  0x00007fb3c0f6a461 in ?? () from /lib/libc.so.6
#2  0x00007fb3c0f6a7e7 in system () from /lib/libc.so.6
#3  0x000000000058a4ed in sigHandler (sig=11) at core/yade.cpp:58
#4  <signal handler called>
#5  0x00007fb3a10fab19 in MyTetrahedronLaw::action (this=0xa9b4d0, ncb=0xa97550) at pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.cpp:71
#6  0x000000000052b3c3 in MetaBody::moveToNextTimeStep (this=0xa97550) at core/MetaBody.cpp:95
#7  0x0000000000581477 in SimulationFlow::singleAction (this=0x832c10) at core/SimulationFlow.cpp:18
#8  0x00000000005833cb in ThreadWorker::callSingleAction (this=0x832c10) at core/ThreadWorker.cpp:71
#9  0x0000000000582bbe in ThreadRunner::call (this=0xa5c680) at core/ThreadRunner.cpp:44
#10 0x0000000000582c24 in ThreadRunner::run (this=0xa5c680) at core/ThreadRunner.cpp:23
#11 0x000000000058309c in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x409c40c8, p=0xa5c680) at /usr/include/boost/bind/mem_fn_template.hpp:49
#12 0x0000000000583109 in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x409c40d8, f=@0x409c40c8, a=@0x409c402f) at /usr/include/boost/bind.hpp:231
#13 0x0000000000583146 in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x409c40c8) at /usr/include/boost/bind/bind_template.hpp:20
#14 0x0000000000583165 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x409c40c8) at /usr/include/boost/function/function_template.hpp:155
#15 0x00007fb3c456f537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#16 0x00007fb3c456f1a2 in ?? () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#17 0x00007fb3c4bce3f7 in start_thread () from /lib/libpthread.so.0
#18 0x00007fb3c1003b2d in clone () from /lib/libc.so.6
#19 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7fb3c5330730 (LWP 31593)):
#0  0x00007fb3c4bd5e81 in nanosleep () from /lib/libpthread.so.0
#1  0x00007fb39693c17b in pyOmega::wait (this=0xa923c0) at gui/py/yadeControl.cpp:397
#2  0x00007fb396838ca3 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0xa25e88, tc=@0x7fffcd3702f0) at /usr/include/boost/python/detail/invoke.hpp:94
#3  0x00007fb3968da6ca in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0xa25e88, args_=0x7fb3c5270d50) at /usr/include/boost/python/detail/caller.hpp:199
#4  0x00007fb3968da71d in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0xa25e80, args=0x7fb3c5270d50, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#5  0x00007fb3c28ecabe in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#6  0x00007fb3c28ecde8 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#7  0x00007fb3c456f537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#8  0x00007fb3c28f49f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#9  0x00007fb3c28ea127 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#10 0x00007fb3c4e1bf23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007fb3c4e99bb0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#12 0x00007fb3c4e9da86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#13 0x00007fb3c4e9dba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#14 0x00007fb3c4ec0da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#15 0x00007fb3c4e958d6 in ?? () from /usr/lib/libpython2.5.so.1.0
#16 0x00007fb3c4e9c940 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0x00007fb3c4e9da86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0x00007fb3c4e9dba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#19 0x00007fb3c4ec0da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#20 0x00007fb3c4ec103b in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#21 0x00007fb3b18e8fe6 in PythonUI::execScript (script={static npos = 18446744073709551615, _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7fffcd371330 "?\034?"}}) at gui/py/PythonUI.cpp:44
#22 0x00007fb3b18ea30b in PythonUI::pythonSession () at gui/py/PythonUI.cpp:96
#23 0x00007fb3b18eb2c9 in PythonUI::run (this=0x8336b0, argc=3, argv=0x7fffcd372050) at gui/py/PythonUI.cpp:128
#24 0x0000000000589e4e in main (argc=3, argv=0x7fffcd372050) at core/yade.cpp:249
#0  0x00007fb3c4bd5e81 in nanosleep () from /lib/libpthread.so.0

################################################################################
ThreePointBending: simulation CRASH
################################################################################
510 [140663827679024] WARN yade  - core/yade.cpp:243 main: No $TERM, using QtGUI instead of PythonUI
510 [140663827679024] WARN yade  - core/yade.cpp:244 main: No $DISPLAY, using PythonUI instead of QtUI
Running script /tmp/yade-test-31492.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1471/gdb_crash_batch-pid31600'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0x7feed97b4730 (LWP 31600)]
[New Thread 0x420b1950 (LWP 31601)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 0000000000000120
0x00007feed9059e81 in nanosleep () from /lib/libpthread.so.0
No symbol "info" in current context.

Thread 2 (Thread 0x420b1950 (LWP 31601)):
#0  0x00007feed544d4df in waitpid () from /lib/libc.so.6
#1  0x00007feed53ee461 in ?? () from /lib/libc.so.6
#2  0x00007feed53ee7e7 in system () from /lib/libc.so.6
#3  0x000000000058a4ed in sigHandler (sig=11) at core/yade.cpp:58
#4  <signal handler called>
#5  0x00007feeb557eb19 in MyTetrahedronLaw::action (this=0xa9b4d0, ncb=0xa97550) at pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.cpp:71
#6  0x000000000052b3c3 in MetaBody::moveToNextTimeStep (this=0xa97550) at core/MetaBody.cpp:95
#7  0x0000000000581477 in SimulationFlow::singleAction (this=0x832c10) at core/SimulationFlow.cpp:18
#8  0x00000000005833cb in ThreadWorker::callSingleAction (this=0x832c10) at core/ThreadWorker.cpp:71
#9  0x0000000000582bbe in ThreadRunner::call (this=0xa5c680) at core/ThreadRunner.cpp:44
#10 0x0000000000582c24 in ThreadRunner::run (this=0xa5c680) at core/ThreadRunner.cpp:23
#11 0x000000000058309c in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x420b10c8, p=0xa5c680) at /usr/include/boost/bind/mem_fn_template.hpp:49
#12 0x0000000000583109 in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x420b10d8, f=@0x420b10c8, a=@0x420b102f) at /usr/include/boost/bind.hpp:231
#13 0x0000000000583146 in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x420b10c8) at /usr/include/boost/bind/bind_template.hpp:20
#14 0x0000000000583165 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x420b10c8) at /usr/include/boost/function/function_template.hpp:155
#15 0x00007feed89f3537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#16 0x00007feed89f31a2 in ?? () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#17 0x00007feed90523f7 in start_thread () from /lib/libpthread.so.0
#18 0x00007feed5487b2d in clone () from /lib/libc.so.6
#19 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7feed97b4730 (LWP 31600)):
#0  0x00007feed9059e81 in nanosleep () from /lib/libpthread.so.0
#1  0x00007feeaadc017b in pyOmega::wait (this=0xa923c0) at gui/py/yadeControl.cpp:397
#2  0x00007feeaacbcca3 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0xa25e88, tc=@0x7fffe17f4770) at /usr/include/boost/python/detail/invoke.hpp:94
#3  0x00007feeaad5e6ca in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0xa25e88, args_=0x7feed96f4d50) at /usr/include/boost/python/detail/caller.hpp:199
#4  0x00007feeaad5e71d in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0xa25e80, args=0x7feed96f4d50, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#5  0x00007feed6d70abe in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#6  0x00007feed6d70de8 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#7  0x00007feed89f3537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#8  0x00007feed6d789f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#9  0x00007feed6d6e127 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#10 0x00007feed929ff23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007feed931dbb0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#12 0x00007feed9321a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#13 0x00007feed9321ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#14 0x00007feed9344da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#15 0x00007feed93198d6 in ?? () from /usr/lib/libpython2.5.so.1.0
#16 0x00007feed9320940 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0x00007feed9321a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0x00007feed9321ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#19 0x00007feed9344da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#20 0x00007feed934503b in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#21 0x00007feec5d6cfe6 in PythonUI::execScript (script={static npos = 18446744073709551615, _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7fffe17f57b0 "?\034?"}}) at gui/py/PythonUI.cpp:44
#22 0x00007feec5d6e30b in PythonUI::pythonSession () at gui/py/PythonUI.cpp:96
#23 0x00007feec5d6f2c9 in PythonUI::run (this=0x8336b0, argc=3, argv=0x7fffe17f64d0) at gui/py/PythonUI.cpp:128
#24 0x0000000000589e4e in main (argc=3, argv=0x7fffe17f64d0) at core/yade.cpp:249
#0  0x00007feed9059e81 in nanosleep () from /lib/libpthread.so.0

################################################################################
TriaxialTest: simulation CRASH
################################################################################
514 [139775564011312] WARN yade  - core/yade.cpp:243 main: No $TERM, using QtGUI instead of PythonUI
514 [139775564011312] WARN yade  - core/yade.cpp:244 main: No $DISPLAY, using PythonUI instead of QtUI
Running script /tmp/yade-test-31492.py
pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:61 Interaction physics of type ElasticContactInteraction (25ElasticContactInteraction)
yade-svn1471: pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:62: void GlobalStiffnessCounter::traverseInteractions(MetaBody*, const boost::shared_ptr<InteractionContainer>&): Assertion `phys' failed.
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1471/gdb_crash_batch-pid31607'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0x7f2008d75730 (LWP 31607)]
[New Thread 0x413e6950 (LWP 31608)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 0000000000000120
0x00007f200861ae81 in nanosleep () from /lib/libpthread.so.0
No symbol "info" in current context.

Thread 2 (Thread 0x413e6950 (LWP 31608)):
#0  0x00007f2004a0e4df in waitpid () from /lib/libc.so.6
#1  0x00007f20049af461 in ?? () from /lib/libc.so.6
#2  0x00007f20049af7e7 in system () from /lib/libc.so.6
#3  0x000000000058a4ed in sigHandler (sig=6) at core/yade.cpp:58
#4  <signal handler called>
#5  0x00007f20049a3095 in raise () from /lib/libc.so.6
#6  0x00007f20049a4af0 in abort () from /lib/libc.so.6
#7  0x00007f200499c2df in __assert_fail () from /lib/libc.so.6
#8  0x00007f1ff5df9937 in GlobalStiffnessCounter::traverseInteractions (this=0xa99910, ncb=0xa97550, interactions=@0xa97610) at pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:62
#9  0x00007f1ff5df9ee0 in GlobalStiffnessCounter::action (this=0xa99910, ncb=0xa97550) at pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:99
#10 0x000000000052b3c3 in MetaBody::moveToNextTimeStep (this=0xa97550) at core/MetaBody.cpp:95
#11 0x0000000000581477 in SimulationFlow::singleAction (this=0x832c10) at core/SimulationFlow.cpp:18
#12 0x00000000005833cb in ThreadWorker::callSingleAction (this=0x832c10) at core/ThreadWorker.cpp:71
#13 0x0000000000582bbe in ThreadRunner::call (this=0xa97710) at core/ThreadRunner.cpp:44
#14 0x0000000000582c24 in ThreadRunner::run (this=0xa97710) at core/ThreadRunner.cpp:23
#15 0x000000000058309c in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x413e60c8, p=0xa97710) at /usr/include/boost/bind/mem_fn_template.hpp:49
#16 0x0000000000583109 in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x413e60d8, f=@0x413e60c8, a=@0x413e602f) at /usr/include/boost/bind.hpp:231
#17 0x0000000000583146 in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x413e60c8) at /usr/include/boost/bind/bind_template.hpp:20
#18 0x0000000000583165 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x413e60c8) at /usr/include/boost/function/function_template.hpp:155
#19 0x00007f2007fb4537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#20 0x00007f2007fb41a2 in ?? () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#21 0x00007f20086133f7 in start_thread () from /lib/libpthread.so.0
#22 0x00007f2004a48b2d in clone () from /lib/libc.so.6
#23 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7f2008d75730 (LWP 31607)):
#0  0x00007f200861ae81 in nanosleep () from /lib/libpthread.so.0
#1  0x00007f1fda38117b in pyOmega::wait (this=0xa923c0) at gui/py/yadeControl.cpp:397
#2  0x00007f1fda27dca3 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0xa25e88, tc=@0x7fff10db3d30) at /usr/include/boost/python/detail/invoke.hpp:94
#3  0x00007f1fda31f6ca in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0xa25e88, args_=0x7f2008cb5d50) at /usr/include/boost/python/detail/caller.hpp:199
#4  0x00007f1fda31f71d in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0xa25e80, args=0x7f2008cb5d50, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#5  0x00007f2006331abe in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#6  0x00007f2006331de8 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#7  0x00007f2007fb4537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#8  0x00007f20063399f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#9  0x00007f200632f127 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#10 0x00007f2008860f23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007f20088debb0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#12 0x00007f20088e2a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#13 0x00007f20088e2ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#14 0x00007f2008905da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#15 0x00007f20088da8d6 in ?? () from /usr/lib/libpython2.5.so.1.0
#16 0x00007f20088e1940 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0x00007f20088e2a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0x00007f20088e2ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#19 0x00007f2008905da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#20 0x00007f200890603b in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#21 0x00007f1ff532dfe6 in PythonUI::execScript (script={static npos = 18446744073709551615, _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7fff10db4d70 "?\034?"}}) at gui/py/PythonUI.cpp:44
#22 0x00007f1ff532f30b in PythonUI::pythonSession () at gui/py/PythonUI.cpp:96
#23 0x00007f1ff53302c9 in PythonUI::run (this=0x8336b0, argc=3, argv=0x7fff10db5a90) at gui/py/PythonUI.cpp:128
#24 0x0000000000589e4e in main (argc=3, argv=0x7fff10db5a90) at core/yade.cpp:249
#0  0x00007f200861ae81 in nanosleep () from /lib/libpthread.so.0

################################################################################
TriaxialTestWater: simulation CRASH
################################################################################
517 [140727610144560] WARN yade  - core/yade.cpp:243 main: No $TERM, using QtGUI instead of PythonUI
517 [140727610144560] WARN yade  - core/yade.cpp:244 main: No $DISPLAY, using PythonUI instead of QtUI
Running script /tmp/yade-test-31492.py
pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:61 Interaction physics of type CapillaryParameters (19CapillaryParameters)
yade-svn1471: pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:62: void GlobalStiffnessCounter::traverseInteractions(MetaBody*, const boost::shared_ptr<InteractionContainer>&): Assertion `phys' failed.
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1471/gdb_crash_batch-pid31614'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0x7ffdb3367730 (LWP 31614)]
[New Thread 0x42722950 (LWP 31615)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 0000000000000120
0x00007ffdb2c0ce81 in nanosleep () from /lib/libpthread.so.0
No symbol "info" in current context.

Thread 2 (Thread 0x42722950 (LWP 31615)):
#0  0x00007ffdaf0004df in waitpid () from /lib/libc.so.6
#1  0x00007ffdaefa1461 in ?? () from /lib/libc.so.6
#2  0x00007ffdaefa17e7 in system () from /lib/libc.so.6
#3  0x000000000058a4ed in sigHandler (sig=6) at core/yade.cpp:58
#4  <signal handler called>
#5  0x00007ffdaef95095 in raise () from /lib/libc.so.6
#6  0x00007ffdaef96af0 in abort () from /lib/libc.so.6
#7  0x00007ffdaef8e2df in __assert_fail () from /lib/libc.so.6
#8  0x00007ffda03eb937 in GlobalStiffnessCounter::traverseInteractions (this=0xa9bd30, ncb=0xa97550, interactions=@0xa97610) at pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:62
#9  0x00007ffda03ebee0 in GlobalStiffnessCounter::action (this=0xa9bd30, ncb=0xa97550) at pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp:99
#10 0x000000000052b3c3 in MetaBody::moveToNextTimeStep (this=0xa97550) at core/MetaBody.cpp:95
#11 0x0000000000581477 in SimulationFlow::singleAction (this=0x832c10) at core/SimulationFlow.cpp:18
#12 0x00000000005833cb in ThreadWorker::callSingleAction (this=0x832c10) at core/ThreadWorker.cpp:71
#13 0x0000000000582bbe in ThreadRunner::call (this=0xa97710) at core/ThreadRunner.cpp:44
#14 0x0000000000582c24 in ThreadRunner::run (this=0xa97710) at core/ThreadRunner.cpp:23
#15 0x000000000058309c in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x427220c8, p=0xa97710) at /usr/include/boost/bind/mem_fn_template.hpp:49
#16 0x0000000000583109 in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x427220d8, f=@0x427220c8, a=@0x4272202f) at /usr/include/boost/bind.hpp:231
#17 0x0000000000583146 in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x427220c8) at /usr/include/boost/bind/bind_template.hpp:20
#18 0x0000000000583165 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x427220c8) at /usr/include/boost/function/function_template.hpp:155
#19 0x00007ffdb25a6537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#20 0x00007ffdb25a61a2 in ?? () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#21 0x00007ffdb2c053f7 in start_thread () from /lib/libpthread.so.0
#22 0x00007ffdaf03ab2d in clone () from /lib/libc.so.6
#23 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7ffdb3367730 (LWP 31614)):
#0  0x00007ffdb2c0ce81 in nanosleep () from /lib/libpthread.so.0
#1  0x00007ffd8497317b in pyOmega::wait (this=0xa923c0) at gui/py/yadeControl.cpp:397
#2  0x00007ffd8486fca3 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0xa25e88, tc=@0x7fffbb3a7320) at /usr/include/boost/python/detail/invoke.hpp:94
#3  0x00007ffd849116ca in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0xa25e88, args_=0x7ffdb32a7d50) at /usr/include/boost/python/detail/caller.hpp:199
#4  0x00007ffd8491171d in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0xa25e80, args=0x7ffdb32a7d50, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#5  0x00007ffdb0923abe in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#6  0x00007ffdb0923de8 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#7  0x00007ffdb25a6537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#8  0x00007ffdb092b9f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#9  0x00007ffdb0921127 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#10 0x00007ffdb2e52f23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007ffdb2ed0bb0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#12 0x00007ffdb2ed4a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#13 0x00007ffdb2ed4ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#14 0x00007ffdb2ef7da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#15 0x00007ffdb2ecc8d6 in ?? () from /usr/lib/libpython2.5.so.1.0
#16 0x00007ffdb2ed3940 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0x00007ffdb2ed4a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0x00007ffdb2ed4ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#19 0x00007ffdb2ef7da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#20 0x00007ffdb2ef803b in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#21 0x00007ffd9f91ffe6 in PythonUI::execScript (script={static npos = 18446744073709551615, _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7fffbb3a8360 "?\034?"}}) at gui/py/PythonUI.cpp:44
#22 0x00007ffd9f92130b in PythonUI::pythonSession () at gui/py/PythonUI.cpp:96
#23 0x00007ffd9f9222c9 in PythonUI::run (this=0x8336b0, argc=3, argv=0x7fffbb3a9080) at gui/py/PythonUI.cpp:128
#24 0x0000000000589e4e in main (argc=3, argv=0x7fffbb3a9080) at core/yade.cpp:249
#0  0x00007ffdb2c0ce81 in nanosleep () from /lib/libpthread.so.0


From dorofeenko at icp.ac.ru  Tue Aug 19 07:22:27 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Tue, 19 Aug 2008 09:22:27 +0400
Subject: [yade-dev] test
In-Reply-To: <489D1C3A.7060200@arcig.cz>
References: <489AF50C.6090906@arcig.cz>
	<200808081917.21976.dorofeenko@icp.ac.ru>
	<489D1C3A.7060200@arcig.cz>
Message-ID: <200808190922.27316.dorofeenko@icp.ac.ru>

test


From janek_listy at wp.pl  Thu Aug 21 15:25:58 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Thu, 21 Aug 2008 15:25:58 +0200
Subject: [yade-dev] [Yade-dev] Migration testing.
Message-ID: <20080821152558.0e67feee@absurd>

please disregard this message

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Thu Aug 21 15:53:55 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Thu, 21 Aug 2008 15:53:55 +0200
Subject: [deprecated list] [Yade-dev] Mailing list migration
Message-ID: <20080821155355.19843e78@absurd>

MAILING LIST MIGRATION

Hello,

There were many problems with yade mailing lists on berlios.de.
The fact that they were completely broken for almost two
weeks, recently, made use to solve this problem ultimately:
We are switching to launchpad.


Please see instructions for migration to launchpad:

  http://yade.wikia.com/wiki/Launchpad_Migration


We want to make this migration as swift as possible:

* all mailing list archives will be imported to launchpad

* both mailing lists stay SYNCHRONIZED forever

* this (deprecated) mailing list yade-dev at lists.berlios.de will become RECEIVE-ONLY

* every user that will subscribe to launchpad will be unsubscribed
  from yade-users (to avoid receiving each post twice, from both
  mailing lists)

Therefore:

  - if you only want to receive posts (without sending), you don't do anything

  - if you want to be able to send new messages, you need to subscribe:

    https://launchpad.net/~yade-dev/+join


Janek Kozicki, YADE team

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Thu Aug 21 16:11:33 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Thu, 21 Aug 2008 16:11:33 +0200
Subject: [deprecated list] [Yade-dev]   Mailing list migration
In-Reply-To: <20080821155355.19843e78@absurd>
References: <20080821155355.19843e78@absurd>
Message-ID: <20080821161133.01e85521@absurd>

Whew,

I'm sorry for double postings - people who have already subscribed to
launchpad: Vaclav, Sega and Bruno. You will not receive doubles
anymore, I have usubscribed you from berlios (and I hope that it all
will work).


We will test this migration method for a few days/weeks on yade-dev, then we
will do this on yade-users.

I have configured mailing lists in this way:

 - added alternate email address yade-dev at lists.berlios.de to my
   personal profile on launchpad

 - now I'm receiving all emails from launchpad through
   yade-dev at lists.berlios.de and so everyone subscribed to berlios is
   receiving them.

 - I have disabled posting to yade-dev at lists.berlios.de, you will get
   a REJECTION message instead, with information about how to subscribe
   to launchpad.

So now it is possible to send emails only through
yade-dev at lists.launchpad.net and they end up on both mailing lists.


I hope that this will not lead to total mess, but will make the migration
easier for everyone.....

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Thu Aug 21 16:30:25 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Thu, 21 Aug 2008 16:30:25 +0200
Subject: [deprecated list] [Yade-dev] Mailing list migration - importing
	archives.
In-Reply-To: <20080821161133.01e85521@absurd>
References: <20080821155355.19843e78@absurd> <20080821161133.01e85521@absurd>
Message-ID: <20080821163025.590703f2@absurd>

Vaclav, 

Could you ask for uploading

  http://prdownload.berlios.de/yade/yade-dev_from-beginning-to-21-Aug-2008.mbox.bz2

to launchpad?

I have lost (again) the place on launchpad where we can request
uploading archives.

thanks.
-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Thu Aug 21 17:02:59 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Thu, 21 Aug 2008 17:02:59 +0200
Subject: [deprecated list] [Yade-dev] don't forget about adding your SVN
	commit emails to	launchpad.
Message-ID: <20080821170259.56399dd6@absurd>

This is another reminder:

The SVN commit logs are sent to launchpad also, but will not be
accepted unless you will add your email address from berlios as your
profile. If they won't be accepted - people will not receive your
commit messages.

Please follow steps ==SVN committers== in:

  http://yade.wikia.com/wiki/Launchpad_Migration#SVN_committers

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Thu Aug 21 17:35:59 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Thu, 21 Aug 2008 17:35:59 +0200
Subject: [deprecated list] [Yade-dev] Mailing list migration - importing
	archives.
In-Reply-To: <20080821163025.590703f2@absurd>
References: <20080821155355.19843e78@absurd> <20080821161133.01e85521@absurd>
	<20080821163025.590703f2@absurd>
Message-ID: <20080821173559.311bc685@absurd>

Janek Kozicki said:     (by the date of Thu, 21 Aug 2008 16:30:25 +0200)

> Could you ask for uploading
>   http://prdownload.berlios.de/yade/yade-dev_from-beginning-to-21-Aug-2008.mbox.bz2

ok, I did it:

https://answers.launchpad.net/launchpad/+question/42791
https://answers.launchpad.net/launchpad/+question/42790

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Fri Aug 22 07:21:12 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Fri, 22 Aug 2008 07:21:12 +0200
Subject: [deprecated list] [Yade-dev] this->parentWidget()->parentWidget()
Message-ID: <20080822072112.1b84f4a6@absurd>

I guess that 0.12.1 will followup quickly...

Th new qt3 UI crashed when trying to save filegenerator, save
simulation from controller, etc. There were a few places like that in
code. For all changes see my last commit: it is fixed.

But curiously I noticed that this was already fixed in three places.
Vaclav, you have made the new GUI. Why you didn't fix it everywhere?
Simple grepping for "parentWidget" is enough to find all occurrences
of this bug.

If you see an error - you should fix it everywhere, that you know it
occurs, without waiting for bugreports.

I'm afraid now that there are now more things like that in yade. Bugs
that you knew exist, but just ignored them. :/

Please improve your work style, or we are doomed.
-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Fri Aug 22 10:18:51 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Fri, 22 Aug 2008 10:18:51 +0200
Subject: [deprecated list] [Yade-dev] ML migration cd... (Was:
	this->parentWidget()..)
In-Reply-To: <48AE6E80.3050907@arcig.cz>
References: <20080822072112.1b84f4a6@absurd>
	<48AE6E80.3050907@arcig.cz>
Message-ID: <20080822101851.445f7977@absurd>

V?clav S(milauer said:     (by the date of Fri, 22 Aug 2008 09:45:04 +0200)

> 
> > But curiously I noticed that this was already fixed in three places.
> > Vaclav, you have made the new GUI. Why you didn't fix it everywhere?
> > Simple grepping for "parentWidget" is enough to find all occurrences
> > of this bug.
> >   
> Eh, IIRC this is exactly what I said, how could I have overlooked those?
> Sorry.

OK.

BTW: you have sent a reply to me, instead of the mailing list.

I hope that it will get fixed:

  https://answers.launchpad.net/launchpad/+question/42849


I hope that this launchpad migration won't be a huge flop...

We also need to change the size limit of messages, eg. to 200kb (like
it was before)

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From cosurgi at mail.berlios.de  Sat Aug 23 01:01:34 2008
From: cosurgi at mail.berlios.de (cosurgi at BerliOS)
Date: Sat, 23 Aug 2008 01:01:34 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1493 - in trunk:
	core	pkg/lattice/Engine/StandAloneEngine pkg/lattice/PreProcessor
Message-ID: <200808222301.m7MN1Yng028968@sheep.berlios.de>

Author: cosurgi
Date: 2008-08-23 01:01:31 +0200 (Sat, 23 Aug 2008)
New Revision: 1493

Modified:
   trunk/core/yade.cpp
   trunk/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.cpp
   trunk/pkg/lattice/Engine/StandAloneEngine/StrainRecorder.cpp
   trunk/pkg/lattice/PreProcessor/LatticeExample.cpp
   trunk/pkg/lattice/PreProcessor/LatticeExample.hpp
Log:
yade.cpp: more detailed info about compilation flags.
LatticeExample: added material parameters bond zone between steel fibres and cement matrix



Modified: trunk/core/yade.cpp
===================================================================
--- trunk/core/yade.cpp	2008-08-21 22:21:27 UTC (rev 1492)
+++ trunk/core/yade.cpp	2008-08-22 23:01:31 UTC (rev 1493)
@@ -111,8 +111,11 @@
 	flags=flags+"   PREFIX=" PREFIX  "\n";
 	flags=flags+"   SUFFIX=" SUFFIX "\n";
 	#ifdef YADE_DEBUG
-		flags+="   DEBUG";
+		flags+="   YADE_DEBUG (debug information)\n";
 	#endif
+	#ifdef NDEBUG
+		flags+="   NDEBUG (heavy optimizations, static_casts everywhere, asserts() are no-ops)\n";
+	#endif
 	cerr << 
 "\n" << Omega::instance().yadeVersionName << "\n\
 \n\
@@ -177,7 +180,7 @@
 		}
 	#endif
 
-	Omega::instance().yadeVersionName = "Yet Another Dynamic Engine 0.11.x, beta, SVN snapshot.";
+	Omega::instance().yadeVersionName = "Yet Another Dynamic Engine 0.12.x, beta, SVN snapshot.";
 	Omega::instance().preferences    = shared_ptr<Preferences>(new Preferences);
 	Omega::instance().yadeConfigPath = configPath; 
 	filesystem::path yadeConfigPath  = filesystem::path(Omega::instance().yadeConfigPath, filesystem::native);

Modified: trunk/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.cpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.cpp	2008-08-21 22:21:27 UTC (rev 1492)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.cpp	2008-08-22 23:01:31 UTC (rev 1493)
@@ -288,7 +288,7 @@
 		{ // 'E_min' 'E_max' criterion
 			if( deleteBeam(lattice , beam, body) ) // calculates strain
 			{
-				//std::cerr << "one beam deleted\n";
+				std::cerr << "one beam deleted\n";
 				futureDeletes.push_back(body->getId());
 				continue;
 			}

Modified: trunk/pkg/lattice/Engine/StandAloneEngine/StrainRecorder.cpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/StrainRecorder.cpp	2008-08-21 22:21:27 UTC (rev 1492)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/StrainRecorder.cpp	2008-08-22 23:01:31 UTC (rev 1493)
@@ -29,7 +29,8 @@
 	//	outputFile += "_"+boost::lexical_cast<std::string>(Omega::instance().getTimeStep());
 	//	std::cerr << "using dt for StrainRecorder output file: " << outputFile << "\n";
 
-		ofile.open(outputFile.c_str());
+		//ofile.open(outputFile.c_str());
+		ofile.open(outputFile.c_str(), std::ios::app);
 
 	}
 }

Modified: trunk/pkg/lattice/PreProcessor/LatticeExample.cpp
===================================================================
--- trunk/pkg/lattice/PreProcessor/LatticeExample.cpp	2008-08-21 22:21:27 UTC (rev 1492)
+++ trunk/pkg/lattice/PreProcessor/LatticeExample.cpp	2008-08-22 23:01:31 UTC (rev 1493)
@@ -198,6 +198,12 @@
 	fibre_allows		 = 0.5;
 	fibre_irregularity_noUnit= 5;
 	fibre_balancing_iterations= 300;
+        // MaterialParameters of fibre bond
+        fibre_bond_longStiffness_noUnit= 0.7;         // k_l fibre bond
+        fibre_bond_bendStiffness_noUnit= 0.28;        // k_b fibre bond
+        fibre_bond_torsStiffness_noUnit= 0.28;        // k_t fibre bond
+        fibre_bond_critCompressStrain  = 100.0;       // E.c fibre bond
+        fibre_bond_critTensileStrain   = 50.0;        // E.l fibre bond
 		
 	nodeRec_A_min=Vector3r(0,0,0);
 	nodeRec_A_max=Vector3r(0,0,0);
@@ -431,6 +437,12 @@
 	REGISTER_ATTRIBUTE(fibre_allows);
 	REGISTER_ATTRIBUTE(fibre_irregularity_noUnit);
 	REGISTER_ATTRIBUTE(fibre_balancing_iterations);
+        // MaterialParameters of fibre bond
+        REGISTER_ATTRIBUTE(fibre_bond_longStiffness_noUnit);  // k_l fibre bond
+        REGISTER_ATTRIBUTE(fibre_bond_bendStiffness_noUnit);  // k_b fibre bond
+        REGISTER_ATTRIBUTE(fibre_bond_torsStiffness_noUnit);  // k_t fibre bond
+        REGISTER_ATTRIBUTE(fibre_bond_critCompressStrain);    // E.c fibre bond
+        REGISTER_ATTRIBUTE(fibre_bond_critTensileStrain);     // E.l fibre bond
 }
 
 bool LatticeExample::generate()
@@ -1788,11 +1800,11 @@
 			}
 			if(fibreNodes==1) // bond
 			{
-                                beam->longitudalStiffness       = bond_longStiffness_noUnit;
-                                beam->bendingStiffness          = bond_bendStiffness_noUnit;
-                                beam->torsionalStiffness	= bond_torsStiffness_noUnit;
-                                beam->criticalTensileStrain     = bond_critTensileStrain;
-                                beam->criticalCompressiveStrain = bond_critCompressStrain;
+                                beam->longitudalStiffness       = fibre_bond_longStiffness_noUnit;
+                                beam->bendingStiffness          = fibre_bond_bendStiffness_noUnit;
+                                beam->torsionalStiffness	= fibre_bond_torsStiffness_noUnit;
+                                beam->criticalTensileStrain     = fibre_bond_critTensileStrain;
+                                beam->criticalCompressiveStrain = fibre_bond_critCompressStrain;
 			}
                 }
         }

Modified: trunk/pkg/lattice/PreProcessor/LatticeExample.hpp
===================================================================
--- trunk/pkg/lattice/PreProcessor/LatticeExample.hpp	2008-08-21 22:21:27 UTC (rev 1492)
+++ trunk/pkg/lattice/PreProcessor/LatticeExample.hpp	2008-08-22 23:01:31 UTC (rev 1493)
@@ -84,6 +84,12 @@
 				,fibre_allows
 				,fibre_irregularity_noUnit
 				,fibre_balancing_iterations
+                        // MaterialParameters of fibre bond
+                                ,fibre_bond_longStiffness_noUnit      // k_l fibre bond
+                                ,fibre_bond_bendStiffness_noUnit      // k_b fibre bond
+                                ,fibre_bond_torsStiffness_noUnit      // k_t fibre bond
+                                ,fibre_bond_critCompressStrain        // E.c fibre bond
+                                ,fibre_bond_critTensileStrain         // E.l fibre bond
 				
 				,fibres_total
 				,matrix_total


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Sun Aug 24 00:10:05 2008
From: eudoxos at arcig.cz (eudoxos at arcig.cz)
Date: Sun, 24 Aug 2008 00:10:05 +0200 (CEST)
Subject: [deprecated list] [Yade-dev] Automated crash report
	for	/tmp/yade-22562/bin/yade-svn1493:	DirectShearCis, FEMBeam,
	HydraulicTest, SDECImpactTest, STLImporterTest, TetrahedronsTest
Message-ID: <20080823221005.50D2F9808C@delta>

################################################################################
DirectShearCis: generator CRASH
################################################################################
657 [140410724845360] WARN yade  - core/yade.cpp:245 main: No $TERM, using QtGUI instead of PythonUI
657 [140410724845360] WARN yade  - core/yade.cpp:246 main: No $DISPLAY, using PythonUI instead of QtUI
Running script /tmp/yade-test-25300.py
Cannot find input file
Traceback (most recent call last):
  File "/tmp/yade-22562/lib/yade-svn1493/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-25300.py", line 3, in <module>
    Preprocessor('DirectShearCis').generate('/tmp/yade-test-25300.xml')
RuntimeError: Generator reported error: Cannot find input file

################################################################################
FEMBeam: generator CRASH
################################################################################
568 [140602898900784] WARN yade  - core/yade.cpp:245 main: No $TERM, using QtGUI instead of PythonUI
568 [140602898900784] WARN yade  - core/yade.cpp:246 main: No $DISPLAY, using PythonUI instead of QtUI
Running script /tmp/yade-test-25300.py
/tmp/yade-22562/build-svn1493/include/yade-svn1493/yade/core/MetaEngine1D.hpp:57 WARNING! dynamic cast of engine unit FEMTetrahedronStiffness failed, will use static_cast. Go figure why.
/tmp/yade-22562/build-svn1493/include/yade-svn1493/yade/core/MetaEngine2D.hpp:61 WARNING! dynamic cast of engine unit FEMSet2Tetrahedrons failed, will use static_cast. Go figure why.
Traceback (most recent call last):
  File "/tmp/yade-22562/lib/yade-svn1493/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-25300.py", line 3, in <module>
    Preprocessor('FEMBeam').generate('/tmp/yade-test-25300.xml')
RuntimeError: Generator reported error: Cannot find input file, you can copy it from examples/ directory

################################################################################
HydraulicTest: generator CRASH
################################################################################
520 [140549554247472] WARN yade  - core/yade.cpp:245 main: No $TERM, using QtGUI instead of PythonUI
520 [140549554247472] WARN yade  - core/yade.cpp:246 main: No $DISPLAY, using PythonUI instead of QtUI
Traceback (most recent call last):
  File "/tmp/yade-22562/lib/yade-svn1493/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-25300.py", line 3, in <module>
    Preprocessor('HydraulicTest').generate('/tmp/yade-test-25300.xml')
RuntimeError: Generator reported error: Error: cannot load the file that should contain spheres
Running script /tmp/yade-test-25300.py

################################################################################
SDECImpactTest: generator CRASH
################################################################################
591 [139708094170928] WARN yade  - core/yade.cpp:245 main: No $TERM, using QtGUI instead of PythonUI
591 [139708094170928] WARN yade  - core/yade.cpp:246 main: No $DISPLAY, using PythonUI instead of QtUI
Traceback (most recent call last):
  File "/tmp/yade-22562/lib/yade-svn1493/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-25300.py", line 3, in <module>
    Preprocessor('SDECImpactTest').generate('/tmp/yade-test-25300.xml')
RuntimeError: Generator reported error: Cannot find input file, you can copy it from examples/ directory
Running script /tmp/yade-test-25300.py

################################################################################
STLImporterTest: generator CRASH
################################################################################
551 [140582187099952] WARN yade  - core/yade.cpp:245 main: No $TERM, using QtGUI instead of PythonUI
552 [140582187099952] WARN yade  - core/yade.cpp:246 main: No $DISPLAY, using PythonUI instead of QtUI
Running script /tmp/yade-test-25300.py
Import walls geometry from file: hourglass.stl
ERROR: Bad file: hourglass.stl
Traceback (most recent call last):
  File "/tmp/yade-22562/lib/yade-svn1493/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-25300.py", line 3, in <module>
    Preprocessor('STLImporterTest').generate('/tmp/yade-test-25300.xml')
RuntimeError: Generator reported error: Input file not found, you can copy it from examples/ directory or make one using blender 3D modelling

################################################################################
TetrahedronsTest: simulation CRASH
################################################################################
574 [140024259794736] WARN yade  - core/yade.cpp:245 main: No $TERM, using QtGUI instead of PythonUI
574 [140024259794736] WARN yade  - core/yade.cpp:246 main: No $DISPLAY, using PythonUI instead of QtUI
Running script /tmp/yade-test-25300.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1493/gdb_crash_batch-pid25367'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0x7f59f043d730 (LWP 25367)]
[New Thread 0x408e1950 (LWP 25368)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 0000000000000120
0x00007f59efce2e81 in nanosleep () from /lib/libpthread.so.0
No symbol "info" in current context.

Thread 2 (Thread 0x408e1950 (LWP 25368)):
#0  0x00007f59ec0d64df in waitpid () from /lib/libc.so.6
#1  0x00007f59ec077461 in ?? () from /lib/libc.so.6
#2  0x00007f59ec0777e7 in system () from /lib/libc.so.6
#3  0x000000000058a4ed in sigHandler (sig=11) at core/yade.cpp:58
#4  <signal handler called>
#5  0x00007f59cc202b19 in MyTetrahedronLaw::action (this=0xa9dc80, ncb=0x8b6780) at pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.cpp:71
#6  0x000000000052b3c3 in MetaBody::moveToNextTimeStep (this=0x8b6780) at core/MetaBody.cpp:95
#7  0x0000000000581477 in SimulationFlow::singleAction (this=0x832c10) at core/SimulationFlow.cpp:18
#8  0x00000000005833cb in ThreadWorker::callSingleAction (this=0x832c10) at core/ThreadWorker.cpp:71
#9  0x0000000000582bbe in ThreadRunner::call (this=0xa957d0) at core/ThreadRunner.cpp:44
#10 0x0000000000582c24 in ThreadRunner::run (this=0xa957d0) at core/ThreadRunner.cpp:23
#11 0x000000000058309c in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x408e10c8, p=0xa957d0) at /usr/include/boost/bind/mem_fn_template.hpp:49
#12 0x0000000000583109 in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x408e10d8, f=@0x408e10c8, a=@0x408e102f) at /usr/include/boost/bind.hpp:231
#13 0x0000000000583146 in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x408e10c8) at /usr/include/boost/bind/bind_template.hpp:20
#14 0x0000000000583165 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x408e10c8) at /usr/include/boost/function/function_template.hpp:155
#15 0x00007f59ef67c537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#16 0x00007f59ef67c1a2 in ?? () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#17 0x00007f59efcdb3f7 in start_thread () from /lib/libpthread.so.0
#18 0x00007f59ec110b2d in clone () from /lib/libc.so.6
#19 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7f59f043d730 (LWP 25367)):
#0  0x00007f59efce2e81 in nanosleep () from /lib/libpthread.so.0
#1  0x00007f59c1a3f60f in pyOmega::wait (this=0xa94b60) at gui/py/yadeControl.cpp:393
#2  0x00007f59c193bd79 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0xa6c268, tc=@0x7ffff847b3e0) at /usr/include/boost/python/detail/invoke.hpp:94
#3  0x00007f59c19dd7a0 in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0xa6c268, args_=0x7f59f037dd50) at /usr/include/boost/python/detail/caller.hpp:199
#4  0x00007f59c19dd7f3 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0xa6c260, args=0x7f59f037dd50, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#5  0x00007f59ed9f9abe in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#6  0x00007f59ed9f9de8 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#7  0x00007f59ef67c537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#8  0x00007f59eda019f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#9  0x00007f59ed9f7127 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#10 0x00007f59eff28f23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007f59effa6bb0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#12 0x00007f59effaaa86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#13 0x00007f59effaaba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#14 0x00007f59effcdda1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#15 0x00007f59effa28d6 in ?? () from /usr/lib/libpython2.5.so.1.0
#16 0x00007f59effa9940 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0x00007f59effaaa86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0x00007f59effaaba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#19 0x00007f59effcdda1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#20 0x00007f59effce03b in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#21 0x00007f59dc9f0fe6 in PythonUI::execScript (script={static npos = 18446744073709551615, _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7ffff847c420 "?!?"}}) at gui/py/PythonUI.cpp:44
#22 0x00007f59dc9f230b in PythonUI::pythonSession () at gui/py/PythonUI.cpp:96
#23 0x00007f59dc9f32c9 in PythonUI::run (this=0x8336b0, argc=4, argv=0x7ffff847d140) at gui/py/PythonUI.cpp:128
#24 0x0000000000589e4e in main (argc=4, argv=0x7ffff847d140) at core/yade.cpp:251
#0  0x00007f59efce2e81 in nanosleep () from /lib/libpthread.so.0

-------------- next part --------------
_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at mail.berlios.de  Mon Aug 25 09:58:05 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Mon, 25 Aug 2008 09:58:05 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1494 - in trunk: extra
	extra/clump gui gui/py
Message-ID: <200808250758.m7P7w5Hx000610@sheep.berlios.de>

Author: eudoxos
Date: 2008-08-25 09:58:04 +0200 (Mon, 25 Aug 2008)
New Revision: 1494

Added:
   trunk/gui/py/_utils.cpp
Modified:
   trunk/extra/SimpleScene.cpp
   trunk/extra/clump/Shop.cpp
   trunk/extra/clump/Shop.hpp
   trunk/gui/SConscript
   trunk/gui/py/PythonUI_rc.py
   trunk/gui/py/eudoxos.py
   trunk/gui/py/ipython.py
   trunk/gui/py/utils.py
Log:
1. Reimplement some loop-intensive functions from yade.utils in c++ for better performance (as yade._utils, imported into yade.utils automatically - transparent to the user)
2. Add poisson's ratio and Young's modulus estimation in yade.eudoxos based on linear regressions of position?\226?\134?\146displacement mapping along different axes
3. Rename Shop::ElasticWaveTimestepEstimate to Shop::PWaveTimeStep, wrapped in yade.utils



Modified: trunk/extra/SimpleScene.cpp
===================================================================
--- trunk/extra/SimpleScene.cpp	2008-08-22 23:01:31 UTC (rev 1493)
+++ trunk/extra/SimpleScene.cpp	2008-08-25 07:58:04 UTC (rev 1494)
@@ -156,7 +156,7 @@
 	rootBody->bodies->insert(sphere);
 	
 	//@
-	rootBody->dt=.2*Shop::ElasticWaveTimestepEstimate(rootBody);
+	rootBody->dt=.2*Shop::PWaveTimeStep(rootBody);
 
 	//@
 	return true;

Modified: trunk/extra/clump/Shop.cpp
===================================================================
--- trunk/extra/clump/Shop.cpp	2008-08-22 23:01:31 UTC (rev 1493)
+++ trunk/extra/clump/Shop.cpp	2008-08-25 07:58:04 UTC (rev 1494)
@@ -1071,7 +1071,7 @@
 	{0.370512,0.415453,0.055970,0.010546},
 	{-1.,-1.,-1.,-1. } /* sentinel: non-positive radius */
 };
-
+#if 0
 Real Shop::ElasticWaveTimestepEstimate(shared_ptr<MetaBody> rootBody){
 	Real minDt=std::numeric_limits<Real>::infinity();
 	FOREACH(const shared_ptr<Body>& b, *rootBody->bodies){
@@ -1084,6 +1084,7 @@
 	}
 	return minDt;
 }
+#endif
 
 void Shop::GLDrawLine(Vector3r from, Vector3r to, Vector3r color){
 	glEnable(GL_LIGHTING); glColor3v(color);
@@ -1109,9 +1110,10 @@
 	glPopMatrix();
 
 }
-#if 0
-Real Shop::PWaveTimeStep(MetaBody* rb){
-	dt=std::numeric_limits<Real>::infinity();
+Real Shop::PWaveTimeStep(shared_ptr<MetaBody> _rb){
+	shared_ptr<MetaBody> rb=_rb;
+	if(!rb)rb=Omega::instance().getRootBody();
+	Real dt=std::numeric_limits<Real>::infinity();
 	FOREACH(const shared_ptr<Body>& b, *rb->bodies){
 		if(!b->physicalParameters || !b->geometricalModel) continue;
 		shared_ptr<ElasticBodyParameters> ebp=dynamic_pointer_cast<ElasticBodyParameters>(b->physicalParameters);
@@ -1122,4 +1124,3 @@
 	}
 	return dt;
 }
-#endif

Modified: trunk/extra/clump/Shop.hpp
===================================================================
--- trunk/extra/clump/Shop.hpp	2008-08-22 23:01:31 UTC (rev 1493)
+++ trunk/extra/clump/Shop.hpp	2008-08-25 07:58:04 UTC (rev 1494)
@@ -79,9 +79,6 @@
 		//! Save spheres in the current simulation into a text file
 		static void saveSpheresToFile(string fileName);
 
-		//! Estimate timestep based on P-wave propagation speed
-		static Real ElasticWaveTimestepEstimate(shared_ptr<MetaBody>);
-
 		static void GLDrawLine(Vector3r from, Vector3r to, Vector3r color=Vector3r(1,1,1));
 		static void GLDrawArrow(Vector3r from, Vector3r to, Vector3r color=Vector3r(1,1,1));
 		static void GLDrawText(std::string text, Vector3r pos, Vector3r color=Vector3r(1,1,1));
@@ -101,8 +98,7 @@
 			static Vector3r& globalStiffness(body_id_t, MetaBody* mb=NULL);
 			static Vector3r& globalRStiffness(body_id_t, MetaBody* mb=NULL);
 		};
-		#if 0
-			Real PWaveTimeStep(MetaBody* rb);
-		#endif
 
+		//! Estimate timestep based on P-wave propagation speed
+		static Real PWaveTimeStep(shared_ptr<MetaBody> rb=shared_ptr<MetaBody>());
 };

Modified: trunk/gui/SConscript
===================================================================
--- trunk/gui/SConscript	2008-08-22 23:01:31 UTC (rev 1493)
+++ trunk/gui/SConscript	2008-08-25 07:58:04 UTC (rev 1494)
@@ -52,7 +52,7 @@
 	# python modules are one level deeper so that you can say: from yade.wrapper import *
 	env.Install('$PREFIX/lib/yade$SUFFIX/gui/yade',[
 		env.SharedLibrary('wrapper',['py/yadeControl.cpp'],SHLIBPREFIX='',
-			LIBS=env['LIBS']+['yade-base','libboost_python','XMLFormatManager','yade-factory','yade-serialization','Shop',
+			LIBS=env['LIBS']+['libboost_python','XMLFormatManager','yade-factory','yade-serialization','Shop',
 				'BoundingVolumeMetaEngine',
 				'GeometricalModelMetaEngine',
 				'InteractingGeometryMetaEngine',
@@ -63,6 +63,8 @@
 				'ParallelEngine'
 			],
 			),
+		env.SharedLibrary('_utils',['py/_utils.cpp'],SHLIBPREFIX='',
+			LIBS=env['LIBS']+['Shop','libboost_python']),
 		env.SharedLibrary('log',['py/log.cpp'],SHLIBPREFIX=''),
 		env.File('__init__.py','py'),
 		env.File('utils.py','py'),

Modified: trunk/gui/py/PythonUI_rc.py
===================================================================
--- trunk/gui/py/PythonUI_rc.py	2008-08-22 23:01:31 UTC (rev 1493)
+++ trunk/gui/py/PythonUI_rc.py	2008-08-25 07:58:04 UTC (rev 1494)
@@ -62,5 +62,3 @@
 		import yade.qt
 		yade.qt.close()
 	except ImportError: pass
-
-

Added: trunk/gui/py/_utils.cpp
===================================================================
--- trunk/gui/py/_utils.cpp	2008-08-22 23:01:31 UTC (rev 1493)
+++ trunk/gui/py/_utils.cpp	2008-08-25 07:58:04 UTC (rev 1494)
@@ -0,0 +1,63 @@
+#include<yade/extra/Shop.hpp>
+#include<boost/python.hpp>
+#include<yade/core/MetaBody.hpp>
+#include<yade/core/Omega.hpp>
+#include<yade/pkg-common/Sphere.hpp>
+using namespace boost::python;
+
+python::tuple vec2tuple(const Vector3r& v){return boost::python::make_tuple(v[0],v[1],v[2]);};
+
+/* \todo implement groupMask */
+python::tuple aabbExtrema(){
+	Real inf=std::numeric_limits<Real>::infinity();
+	Vector3r minimum(inf,inf,inf),maximum(-inf,-inf,-inf);
+	FOREACH(const shared_ptr<Body>& b, *Omega::instance().getRootBody()->bodies){
+		shared_ptr<Sphere> s=dynamic_pointer_cast<Sphere>(b->geometricalModel); if(!s) continue;
+		Vector3r rrr(s->radius,s->radius,s->radius);
+		minimum=componentMinVector(minimum,b->physicalParameters->se3.position-rrr);
+		maximum=componentMaxVector(maximum,b->physicalParameters->se3.position+rrr);
+	}
+	return python::make_tuple(vec2tuple(minimum),vec2tuple(maximum));
+}
+
+python::tuple negPosExtremeIds(int axis, Real distFactor=1.1){
+	python::tuple extrema=aabbExtrema();
+	Real minCoord=extract<double>(extrema[0][axis])(),maxCoord=extract<double>(extrema[1][axis])();
+	python::list minIds,maxIds;
+	FOREACH(const shared_ptr<Body>& b, *Omega::instance().getRootBody()->bodies){
+		shared_ptr<Sphere> s=dynamic_pointer_cast<Sphere>(b->geometricalModel); if(!s) continue;
+		if(b->physicalParameters->se3.position[axis]-s->radius*distFactor<=minCoord) minIds.append(b->getId());
+		if(b->physicalParameters->se3.position[axis]+s->radius*distFactor>=maxCoord) maxIds.append(b->getId());
+	}
+	return python::make_tuple(minIds,maxIds);
+}
+BOOST_PYTHON_FUNCTION_OVERLOADS(negPosExtremeIds_overloads,negPosExtremeIds,1,2);
+
+python::tuple coordsAndDisplacements(int axis){
+	python::list retCoord,retDispl;
+	FOREACH(const shared_ptr<Body>&b, *Omega::instance().getRootBody()->bodies){
+		retCoord.append(b->physicalParameters->se3.position[axis]);
+		retDispl.append(b->physicalParameters->se3.position[axis]-b->physicalParameters->refSe3.position[axis]);
+	}
+	return python::make_tuple(retCoord,retDispl);
+}
+
+void setRefSe3(){
+	FOREACH(const shared_ptr<Body>& b, *Omega::instance().getRootBody()->bodies){
+		b->physicalParameters->refSe3.position=b->physicalParameters->se3.position;
+		b->physicalParameters->refSe3.orientation=b->physicalParameters->se3.orientation;
+	}
+}
+
+
+Real PWaveTimeStep(){return Shop::PWaveTimeStep();};
+
+BOOST_PYTHON_MODULE(_utils){
+	def("PWaveTimeStep",PWaveTimeStep);
+	def("aabbExtrema",aabbExtrema);
+	def("negPosExtremeIds",negPosExtremeIds,negPosExtremeIds_overloads(args("axis","distFactor")));
+	def("coordsAndDisplacements",coordsAndDisplacements);
+	def("setRefSe3",setRefSe3);
+}
+
+

Modified: trunk/gui/py/eudoxos.py
===================================================================
--- trunk/gui/py/eudoxos.py	2008-08-22 23:01:31 UTC (rev 1493)
+++ trunk/gui/py/eudoxos.py	2008-08-25 07:58:04 UTC (rev 1494)
@@ -4,7 +4,39 @@
 # I doubt there functions will be useful for anyone besides me.
 #
 
+def estimatePoissonYoung(principalAxis,stress=0,plot=False):
+	"""Estimate Poisson's ration given the "principal" axis of straining.
+	For every base direction, homogenized strain is computed
+	(slope in linear regression on discrete function particle coordinate ?
+	? particle displacement	in the same direction as returned by
+	utils.coordsAndDisplacements) and, (if axis '0' is the strained 
+	axis) the poisson's ratio is given as -?(??+??)/??.
 
+	Young's modulus is computed as ?/??; if stress ? is not given (default 0),
+	the result is 0.
+	"""
+	dd=[] # storage for linear regression parameters
+	import pylab,numpy,stats
+	from yade import utils
+	for axis in [0,1,2]:
+		w,dw=utils.coordsAndDisplacements(axis)
+		l,ll=stats.linregress(w,dw)[0:2] # use only tangent and section
+		dd.append((l,ll,min(w),max(w)))
+		if plot: pylab.plot(w,dw,'.',label='xyz'[axis])
+	if plot:
+		for axis in [0,1,2]:
+			dist=dd[axis][-1]-dd[axis][-2]
+			c=numpy.linspace(dd[axis][-2]-.2*dist,dd[axis][-1]+.2*dist)
+			d=[dd[axis][0]*cc+dd[axis][1] for cc in c]
+			pylab.plot(c,d,label='interp '+'xyz'[axis])
+		pylab.legend()
+		pylab.show()
+	otherAxes=(principalAxis+1)%3,(principalAxis+2)%3
+	avgTransHomogenizedStrain=.5*(dd[otherAxes[0]][0]+dd[otherAxes[1]][0])
+	principalHomogenizedStrain=dd[principalAxis][0]
+	return -avgTransHomogenizedStrain/principalHomogenizedStrain,stress/principalHomogenizedStrain
+
+
 def oofemTextExport():
 	"""Export simulation data in text format 
 	

Modified: trunk/gui/py/ipython.py
===================================================================
--- trunk/gui/py/ipython.py	2008-08-22 23:01:31 UTC (rev 1493)
+++ trunk/gui/py/ipython.py	2008-08-25 07:58:04 UTC (rev 1494)
@@ -16,4 +16,4 @@
 import IPython.ipapi
 ip=IPython.ipapi.get()
 ip.set_hook('complete_command',yade_completers,re_key='.*\\b[a-zA-Z0-9_]+\[["\'][^"\'\]]*$')
-
+ip.options.profile='yade'

Modified: trunk/gui/py/utils.py
===================================================================
--- trunk/gui/py/utils.py	2008-08-22 23:01:31 UTC (rev 1493)
+++ trunk/gui/py/utils.py	2008-08-25 07:58:04 UTC (rev 1494)
@@ -4,6 +4,8 @@
 #
 # 2008 ? V?clav ?milauer <eudoxos at arcig.cz>
 
+#from yade._utils import *
+
 import math,random
 from yade.wrapper import *
 try: # use psyco if available
@@ -11,6 +13,10 @@
 	psyco.full()
 except ImportError: pass
 
+# c++ implementations for performance reasons
+from yade._utils import *
+
+
 def sphere(center,radius,density=1,young=30e9,poisson=.3,frictionAngle=0.5236,dynamic=True,wire=False,color=[1,1,1],physParamsClass='BodyMacroParameters'):
 	"""Create default sphere, with given parameters. Physical properties such as mass and inertia are calculated automatically."""
 	s=Body()
@@ -18,7 +24,7 @@
 	s.mold=InteractingGeometry('InteractingSphere',{'radius':radius,'diffuseColor':color})
 	V=(4./3)*math.pi*radius**3
 	inert=(2./5.)*V*density*radius**2
-	s.phys=PhysicalParameters(physParamsClass,{'se3':[center[0],center[1],center[2],1,0,0,0],'mass':V*density,'inertia':[inert,inert,inert],'young':young,'poisson':poisson,'frictionAngle':frictionAngle})
+	s.phys=PhysicalParameters(physParamsClass,{'se3':[center[0],center[1],center[2],1,0,0,0],'refSe3':[center[0],center[1],center[2],1,0,0,0],'mass':V*density,'inertia':[inert,inert,inert],'young':young,'poisson':poisson,'frictionAngle':frictionAngle})
 	s.bound=BoundingVolume('AABB',{'diffuseColor':[0,1,0]})
 	s['isDynamic']=dynamic
 	return s
@@ -29,29 +35,11 @@
 	b.shape=GeometricalModel('Box',{'extents':extents,'diffuseColor':color,'wire':wire,'visible':True})
 	b.mold=InteractingGeometry('InteractingBox',{'extents':extents,'diffuseColor':color})
 	mass=8*extents[0]*extents[1]*extents[2]*density
-	b.phys=PhysicalParameters(physParamsClass,{'se3':[center[0],center[1],center[2],orientation[0],orientation[1],orientation[2],orientation[3]],'mass':mass,'inertia':[mass*4*(extents[1]**2+extents[2]**2),mass*4*(extents[0]**2+extents[2]**2),mass*4*(extents[0]**2+extents[1]**2)],'young':young,'poisson':poisson,'frictionAngle':frictionAngle})
+	b.phys=PhysicalParameters(physParamsClass,{'se3':[center[0],center[1],center[2],orientation[0],orientation[1],orientation[2],orientation[3]],'refSe3':[center[0],center[1],center[2],orientation[0],orientation[1],orientation[2],orientation[3]],'mass':mass,'inertia':[mass*4*(extents[1]**2+extents[2]**2),mass*4*(extents[0]**2+extents[2]**2),mass*4*(extents[0]**2+extents[1]**2)],'young':young,'poisson':poisson,'frictionAngle':frictionAngle})
 	b.bound=BoundingVolume('AABB',{'diffuseColor':[0,1,0]})
 	b['isDynamic']=dynamic
 	return b
 
-def negPosExtremes(axis,distFactor=1.1):
-	"""Get 2 lists (negative and positive extremes) of sphere ids that are close to the boundary
-	in the direction of requested axis (0=x,1=y,2=z).
-
-	distFactor enlarges radius of the sphere, it can be considered 'extremal' even if it doesn't touch the extreme.
-	"""
-	inf=float('inf')
-	extremes=[inf,-inf]
-	ret=[[],[]]
-	o=Omega()
-	for b in o.bodies:
-		extremes[1]=max(extremes[1],+b.shape['radius']+b.phys['se3'][axis])
-		extremes[0]=min(extremes[0],-b.shape['radius']+b.phys['se3'][axis])
-	for b in o.bodies:
-		if b.phys['se3'][axis]-b.shape['radius']*distFactor<=extremes[0]: ret[0].append(b.id)
-		if b.phys['se3'][axis]+b.shape['radius']*distFactor>=extremes[1]: ret[1].append(b.id)
-	return ret
-
 def aabbWalls(extrema=None,thickness=None,oversizeFactor=1.5,**kw):
 	"""return 6 walls that will wrap existing packing;
 	extrema are extremal points of the AABB of the packing (will be calculated if not specified)
@@ -74,23 +62,13 @@
 			walls[-1].shape['visible']=True
 	return walls
 
-def aabbExtrema(consider=lambda body:True):
-	"""return min and max points of an aabb around spherical packing (non-spheres are ignored)"""
-	inf=float('inf')
-	minimum,maximum=[inf,inf,inf],[-inf,-inf,-inf]
-	o=Omega()
-	for b in o.bodies:
-		if consider(b) and b.shape.name=='Sphere':
-			minimum=[min(minimum[i],b.phys['se3'][i]-b.shape['radius']) for i in range(3)]
-			maximum=[max(maximum[i],b.phys['se3'][i]+b.shape['radius']) for i in range(3)]
-	return minimum,maximum
 
-def perpendicularArea(axis,consider=lambda body: True):
+def perpendicularArea(axis):
 	"""return area perpendicular to given axis (0=x,1=y,2=z) generated by bodies
 	for which the function consider returns True (defaults to returning True always)
 	and which is of the type "Sphere"
 	"""
-	ext=aabbExtrema(consider)
+	ext=aabbExtrema()
 	other=((axis+1)%3,(axis+2)%3)
 	return (ext[1][other[0]]-ext[0][other[0]])*(ext[1][other[1]]-ext[0][other[1]])
 
@@ -107,19 +85,6 @@
 		if onShapes and (b['isDynamic'] or not onlyDynamic): b.shape['diffuseColor']=color
 		if onMolds  and (b['isDynamic'] or not onlyDynamic): b.mold['diffuseColor']=color
 
-def PWaveTimeStep():
-	"""Estimate timestep by the elastic wave propagation speed (p-wave).
-	
-	Multiply the value returned by some safety factor < 1, since shear waves are not taken into account here."""
-	o=Omega()
-	dt=float('inf')
-	for b in o.bodies:
-		if not (b.phys and b.shape): continue
-		if not (b.phys.has_key('young') and b.shape.has_key('radius')): continue
-		density=b.phys['mass']/((4./3.)*math.pi*b.shape['radius']**3)
-		thisDt=b.shape['radius']/math.sqrt(b.phys['young']/density)
-		dt=min(dt,thisDt)
-	return dt
 
 def spheresFromFile(filename,scale=1.,wenjieFormat=False,**kw):
 	"""Load sphere coordinates from file, create spheres, insert them to the simulation.
@@ -150,3 +115,48 @@
 		out.write('%g\t%g\t%g\t%g\n'%(b.phys['se3'][0],b.phys['se3'][1],b.phys['se3'][2],b.shape['radius']))
 	out.close()
 
+def negPosExtremes(**kw): raise DeprecationWarning("negPosExtremes is deprecated, use negPosExtremalIds instead.")
+
+# reimplemented in _utils in c++ (results verified to be identical)
+if 0:
+	def negPosExtremes(axis,distFactor=1.1):
+		"""Get 2 lists (negative and positive extremes) of sphere ids that are close to the boundary
+		in the direction of requested axis (0=x,1=y,2=z).
+
+		distFactor enlarges radius of the sphere, it can be considered 'extremal' even if it doesn't touch the extreme.
+		"""
+		inf=float('inf')
+		extremes=[inf,-inf]
+		ret=[[],[]]
+		o=Omega()
+		for b in o.bodies:
+			extremes[1]=max(extremes[1],+b.shape['radius']+b.phys['se3'][axis])
+			extremes[0]=min(extremes[0],-b.shape['radius']+b.phys['se3'][axis])
+		for b in o.bodies:
+			if b.phys['se3'][axis]-b.shape['radius']*distFactor<=extremes[0]: ret[0].append(b.id)
+			if b.phys['se3'][axis]+b.shape['radius']*distFactor>=extremes[1]: ret[1].append(b.id)
+		return ret
+	def aabbExtrema(consider=lambda body:True):
+		"""return min and max points of an aabb around spherical packing (non-spheres are ignored)"""
+		inf=float('inf')
+		minimum,maximum=[inf,inf,inf],[-inf,-inf,-inf]
+		o=Omega()
+		for b in o.bodies:
+			if consider(b) and b.shape.name=='Sphere':
+				minimum=[min(minimum[i],b.phys['se3'][i]-b.shape['radius']) for i in range(3)]
+				maximum=[max(maximum[i],b.phys['se3'][i]+b.shape['radius']) for i in range(3)]
+		return minimum,maximum
+	def PWaveTimeStep():
+		"""Estimate timestep by the elastic wave propagation speed (p-wave).
+		
+		Multiply the value returned by some safety factor < 1, since shear waves are not taken into account here."""
+		o=Omega()
+		dt=float('inf')
+		for b in o.bodies:
+			if not (b.phys and b.shape): continue
+			if not (b.phys.has_key('young') and b.shape.has_key('radius')): continue
+			density=b.phys['mass']/((4./3.)*math.pi*b.shape['radius']**3)
+			thisDt=b.shape['radius']/math.sqrt(b.phys['young']/density)
+			dt=min(dt,thisDt)
+		return dt
+


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at mail.berlios.de  Thu Aug 28 10:58:34 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Thu, 28 Aug 2008 10:58:34 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1495 - trunk/gui/py
Message-ID: <200808280858.m7S8wYFN026255@sheep.berlios.de>

Author: eudoxos
Date: 2008-08-28 10:58:33 +0200 (Thu, 28 Aug 2008)
New Revision: 1495

Modified:
   trunk/gui/py/yadeControl.cpp
Log:
1. Add python interface for blocking DOFs:
		b.phys.blockedDOFs=['z','rx','ry']
	It is friendlier than b.phys['blockedDOFs']=1<<2|1<<3|1<<4.
	The property is read-write.



Modified: trunk/gui/py/yadeControl.cpp
===================================================================
--- trunk/gui/py/yadeControl.cpp	2008-08-25 07:58:04 UTC (rev 1494)
+++ trunk/gui/py/yadeControl.cpp	2008-08-28 08:58:33 UTC (rev 1495)
@@ -131,7 +131,27 @@
 BASIC_PY_PROXY(pyInteractionPhysics,InteractionPhysics);
 
 BASIC_PY_PROXY(pyGeometricalModel,GeometricalModel);
-BASIC_PY_PROXY(pyPhysicalParameters,PhysicalParameters);
+BASIC_PY_PROXY_HEAD(pyPhysicalParameters,PhysicalParameters)
+	python::list blockedDOFs_get(){
+		python::list ret;
+		#define _SET_DOF(DOF_ANY,str) if((proxee->blockedDOFs & PhysicalParameters::DOF_ANY)!=0) ret.append(str);
+		_SET_DOF(DOF_X,"x"); _SET_DOF(DOF_Y,"y"); _SET_DOF(DOF_Z,"z"); _SET_DOF(DOF_RX,"rx"); _SET_DOF(DOF_RY,"ry"); _SET_DOF(DOF_RZ,"rz");
+		#undef _SET_DOF
+		return ret;
+	}
+	void blockedDOFs_set(python::list l){
+		proxee->blockedDOFs=PhysicalParameters::DOF_NONE;
+		int len=python::len(l);
+		for(int i=0; i<len; i++){
+			string s=python::extract<string>(l[i])();
+			#define _GET_DOF(DOF_ANY,str) if(s==str) { proxee->blockedDOFs|=PhysicalParameters::DOF_ANY; continue; }
+			_GET_DOF(DOF_X,"x"); _GET_DOF(DOF_Y,"y"); _GET_DOF(DOF_Z,"z"); _GET_DOF(DOF_RX,"rx"); _GET_DOF(DOF_RY,"ry"); _GET_DOF(DOF_RZ,"rz");
+			#undef _GET_DOF
+			throw std::invalid_argument("Invalid  DOF specification `"+s+"', must be ?{x,y,z,rx,ry,rz}.");
+		}
+	}
+BASIC_PY_PROXY_TAIL;
+
 BASIC_PY_PROXY(pyBoundingVolume,BoundingVolume);
 BASIC_PY_PROXY(pyInteractingGeometry,InteractingGeometry);
 
@@ -547,7 +567,8 @@
 
 	BASIC_PY_PROXY_WRAPPER(pyGeometricalModel,"GeometricalModel");
 	BASIC_PY_PROXY_WRAPPER(pyInteractingGeometry,"InteractingGeometry");
-	BASIC_PY_PROXY_WRAPPER(pyPhysicalParameters,"PhysicalParameters");
+	BASIC_PY_PROXY_WRAPPER(pyPhysicalParameters,"PhysicalParameters")	
+		.add_property("blockedDOFs",&pyPhysicalParameters::blockedDOFs_get,&pyPhysicalParameters::blockedDOFs_set);
 	BASIC_PY_PROXY_WRAPPER(pyBoundingVolume,"BoundingVolume");
 	BASIC_PY_PROXY_WRAPPER(pyInteractionGeometry,"InteractionGeometry");
 	BASIC_PY_PROXY_WRAPPER(pyInteractionPhysics,"InteractionPhysics");


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From cosurgi at mail.berlios.de  Thu Aug 28 23:01:20 2008
From: cosurgi at mail.berlios.de (cosurgi at BerliOS)
Date: Thu, 28 Aug 2008 23:01:20 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1496 - trunk
Message-ID: <200808282101.m7SL1Khc014772@sheep.berlios.de>

Author: cosurgi
Date: 2008-08-28 23:01:20 +0200 (Thu, 28 Aug 2008)
New Revision: 1496

Modified:
   trunk/SConstruct
Log:
update to use latest scons 1.0.0



Modified: trunk/SConstruct
===================================================================
--- trunk/SConstruct	2008-08-28 08:58:33 UTC (rev 1495)
+++ trunk/SConstruct	2008-08-28 21:01:20 UTC (rev 1496)
@@ -43,7 +43,7 @@
 ##########################################################################################
 #print sconsVersion
 if sconsVersion<9803.0 and not os.environ.has_key('NO_SCONS_GET_RECENT'):
-	tgzParams=("http://kent.dl.sourceforge.net/sourceforge/scons/scons-local-0.98.3.tar.gz","/scons-local-0.98.3")
+	tgzParams=("http://heanet.dl.sourceforge.net/sourceforge/scons/scons-local-1.0.0.tar.gz","/scons-local-1.0.0")
 	newPrefix="./scons-local";
 	newUrl,newDir=tgzParams[0],newPrefix+"/"+tgzParams[1]
 	if not os.path.exists(newDir):


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Fri Aug 29 22:54:03 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Fri, 29 Aug 2008 22:54:03 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1497 - trunk/gui/py
Message-ID: <200808292054.m7TKs3mv022695@sheep.berlios.de>

Author: eudoxos
Date: 2008-08-29 22:54:03 +0200 (Fri, 29 Aug 2008)
New Revision: 1497

Modified:
   trunk/gui/py/_utils.cpp
   trunk/gui/py/eudoxos.py
Log:
1. Add code for computing histogram of interaction directions in given plane in _utils.
2. This is code is used by yade.eudoxos.plotDirections() to create the actual (nice) figure.



Modified: trunk/gui/py/_utils.cpp
===================================================================
--- trunk/gui/py/_utils.cpp	2008-08-28 21:01:20 UTC (rev 1496)
+++ trunk/gui/py/_utils.cpp	2008-08-29 20:54:03 UTC (rev 1497)
@@ -3,6 +3,8 @@
 #include<yade/core/MetaBody.hpp>
 #include<yade/core/Omega.hpp>
 #include<yade/pkg-common/Sphere.hpp>
+#include<yade/pkg-dem/SpheresContactGeometry.hpp>
+#include<cmath>
 using namespace boost::python;
 
 python::tuple vec2tuple(const Vector3r& v){return boost::python::make_tuple(v[0],v[1],v[2]);};
@@ -49,15 +51,41 @@
 	}
 }
 
-
 Real PWaveTimeStep(){return Shop::PWaveTimeStep();};
 
+
+/* return histogram ([bin1Min,bin2Min,?],[value1,value2,?]) from projections of interactions
+ * to the plane perpendicular to axis?[0,1,2]; the number of bins can be specified and they cover
+ * the range (0,?), since interactions are bidirecional, hence periodically the same on (?,2?).
+ *
+ * only contacts using SpheresContactGeometry are considered.
+ */
+python::tuple interactionAnglesHistogram(int axis, size_t bins=20){
+	if(axis<0||axis>2) throw invalid_argument("Axis must be from {0,1,2}=x,y,z.");
+	Real binStep=Mathr::PI/bins; int axis2=(axis+1)%3, axis3=(axis+2)%3;
+	vector<Real> cummProj(bins,0.);
+	FOREACH(const shared_ptr<Interaction>& i, *Omega::instance().getRootBody()->transientInteractions){
+		shared_ptr<SpheresContactGeometry> scg=dynamic_pointer_cast<SpheresContactGeometry>(i->interactionGeometry);
+		if(!scg) continue;
+		Vector3r n(scg->normal); n[axis]=0.; Real nLen=n.Length();
+		Real theta=acos(n[axis2]/nLen)*(n[axis3]>0?1:-1); if(theta<0) theta+=Mathr::PI;
+		int binNo=theta/binStep;
+		cummProj[binNo]+=nLen;
+	}
+	python::list val,binMid;
+	for(size_t i=0; i<(size_t)bins; i++){ val.append(cummProj[i]); binMid.append(i*binStep);}
+	return python::make_tuple(binMid,val);
+}
+BOOST_PYTHON_FUNCTION_OVERLOADS(interactionAnglesHistogram_overloads,interactionAnglesHistogram,1,2);
+
+
 BOOST_PYTHON_MODULE(_utils){
 	def("PWaveTimeStep",PWaveTimeStep);
 	def("aabbExtrema",aabbExtrema);
 	def("negPosExtremeIds",negPosExtremeIds,negPosExtremeIds_overloads(args("axis","distFactor")));
 	def("coordsAndDisplacements",coordsAndDisplacements);
 	def("setRefSe3",setRefSe3);
+	def("interactionAnglesHistogram",interactionAnglesHistogram,interactionAnglesHistogram_overloads(args("axis","bins")));
 }
 
 

Modified: trunk/gui/py/eudoxos.py
===================================================================
--- trunk/gui/py/eudoxos.py	2008-08-28 21:01:20 UTC (rev 1496)
+++ trunk/gui/py/eudoxos.py	2008-08-29 20:54:03 UTC (rev 1497)
@@ -4,6 +4,18 @@
 # I doubt there functions will be useful for anyone besides me.
 #
 
+
+def plotDirections(bins=20):
+	"Plot 3 histograms for distribution of interaction directions, in yz,xz and xy planes."
+	import pylab
+	from yade import utils
+	for axis in [0,1,2]:
+		d=utils.interactionAnglesHistogram(axis,bins)
+		fc=[0,0,0]; fc[axis]=1.
+		pylab.subplot(220+axis+1,polar=True);
+		bar(d[0],d[1],width=math.pi/(1.2*bins),fc=fc,alpha=.7,label=['yz','xz','xy'][axis])
+	pylab.show()
+
 def estimatePoissonYoung(principalAxis,stress=0,plot=False):
 	"""Estimate Poisson's ration given the "principal" axis of straining.
 	For every base direction, homogenized strain is computed


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at mail.berlios.de  Fri Aug 29 23:23:57 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Fri, 29 Aug 2008 23:23:57 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1498 - trunk/gui/py
Message-ID: <200808292123.m7TLNvov025692@sheep.berlios.de>

Author: eudoxos
Date: 2008-08-29 23:23:56 +0200 (Fri, 29 Aug 2008)
New Revision: 1498

Modified:
   trunk/gui/py/_utils.cpp
   trunk/gui/py/eudoxos.py
Log:
1. Skip (almost) exactly zero projections, implement masking of bodies.

 Preprocessor("TriaxialTest").load()
 o=Omega(); o.run(50,True);
 from yade import eudoxos
 eudoxos.plotDirections(mask=2); # mask==2 on all bodies including walls ?\226?\134?\146 highly anisotropic



Modified: trunk/gui/py/_utils.cpp
===================================================================
--- trunk/gui/py/_utils.cpp	2008-08-29 20:54:03 UTC (rev 1497)
+++ trunk/gui/py/_utils.cpp	2008-08-29 21:23:56 UTC (rev 1498)
@@ -58,16 +58,23 @@
  * to the plane perpendicular to axis?[0,1,2]; the number of bins can be specified and they cover
  * the range (0,?), since interactions are bidirecional, hence periodically the same on (?,2?).
  *
- * only contacts using SpheresContactGeometry are considered.
+ * Only contacts using SpheresContactGeometry are considered.
+ * Both bodies must be in the mask (except if mask is 0, when all bodies are considered)
+ * If the projection is shorter than minProjLen, it is skipped.
+ *
+ * @todo implement groupMask
  */
-python::tuple interactionAnglesHistogram(int axis, size_t bins=20){
+python::tuple interactionAnglesHistogram(int axis, int mask=0, size_t bins=20, Real minProjLen=1e-6){
 	if(axis<0||axis>2) throw invalid_argument("Axis must be from {0,1,2}=x,y,z.");
 	Real binStep=Mathr::PI/bins; int axis2=(axis+1)%3, axis3=(axis+2)%3;
 	vector<Real> cummProj(bins,0.);
-	FOREACH(const shared_ptr<Interaction>& i, *Omega::instance().getRootBody()->transientInteractions){
-		shared_ptr<SpheresContactGeometry> scg=dynamic_pointer_cast<SpheresContactGeometry>(i->interactionGeometry);
-		if(!scg) continue;
+	shared_ptr<MetaBody> rb=Omega::instance().getRootBody();
+	FOREACH(const shared_ptr<Interaction>& i, *rb->transientInteractions){
+		if(!i->isReal) continue;
+		if(!(mask==0 || (mask>0 && (Body::byId(i->getId1(),rb)->getGroupMask() & mask) && (Body::byId(i->getId2(),rb)->getGroupMask() & mask)))) continue;
+		shared_ptr<SpheresContactGeometry> scg=dynamic_pointer_cast<SpheresContactGeometry>(i->interactionGeometry); if(!scg) continue;
 		Vector3r n(scg->normal); n[axis]=0.; Real nLen=n.Length();
+		if(nLen<minProjLen) continue; // this interaction is (almost) exactly parallel to our axis; skip that one
 		Real theta=acos(n[axis2]/nLen)*(n[axis3]>0?1:-1); if(theta<0) theta+=Mathr::PI;
 		int binNo=theta/binStep;
 		cummProj[binNo]+=nLen;
@@ -76,7 +83,7 @@
 	for(size_t i=0; i<(size_t)bins; i++){ val.append(cummProj[i]); binMid.append(i*binStep);}
 	return python::make_tuple(binMid,val);
 }
-BOOST_PYTHON_FUNCTION_OVERLOADS(interactionAnglesHistogram_overloads,interactionAnglesHistogram,1,2);
+BOOST_PYTHON_FUNCTION_OVERLOADS(interactionAnglesHistogram_overloads,interactionAnglesHistogram,1,3);
 
 
 BOOST_PYTHON_MODULE(_utils){
@@ -85,7 +92,7 @@
 	def("negPosExtremeIds",negPosExtremeIds,negPosExtremeIds_overloads(args("axis","distFactor")));
 	def("coordsAndDisplacements",coordsAndDisplacements);
 	def("setRefSe3",setRefSe3);
-	def("interactionAnglesHistogram",interactionAnglesHistogram,interactionAnglesHistogram_overloads(args("axis","bins")));
+	def("interactionAnglesHistogram",interactionAnglesHistogram,interactionAnglesHistogram_overloads(args("axis","mask","bins")));
 }
 
 

Modified: trunk/gui/py/eudoxos.py
===================================================================
--- trunk/gui/py/eudoxos.py	2008-08-29 20:54:03 UTC (rev 1497)
+++ trunk/gui/py/eudoxos.py	2008-08-29 21:23:56 UTC (rev 1498)
@@ -5,12 +5,12 @@
 #
 
 
-def plotDirections(bins=20):
+def plotDirections(mask=0,bins=20):
 	"Plot 3 histograms for distribution of interaction directions, in yz,xz and xy planes."
 	import pylab
 	from yade import utils
 	for axis in [0,1,2]:
-		d=utils.interactionAnglesHistogram(axis,bins)
+		d=utils.interactionAnglesHistogram(axis,mask=mask,bins=bins)
 		fc=[0,0,0]; fc[axis]=1.
 		pylab.subplot(220+axis+1,polar=True);
 		bar(d[0],d[1],width=math.pi/(1.2*bins),fc=fc,alpha=.7,label=['yz','xz','xy'][axis])


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at arcig.cz  Sun Aug 31 00:09:57 2008
From: eudoxos at arcig.cz (eudoxos at arcig.cz)
Date: Sun, 31 Aug 2008 00:09:57 +0200 (CEST)
Subject: [deprecated list] [Yade-dev] Automated crash report
	for	/tmp/yade-17138/bin/yade-svn1498:	DirectShearCis, FEMBeam,
	HydraulicTest, SDECImpactTest, STLImporterTest, TetrahedronsTest
Message-ID: <20080830220957.44C7D9808C@delta>

################################################################################
DirectShearCis: generator CRASH
################################################################################
509 [140390761010992] WARN yade  - core/yade.cpp:245 main: No $TERM, using QtGUI instead of PythonUI
510 [140390761010992] WARN yade  - core/yade.cpp:246 main: No $DISPLAY, using PythonUI instead of QtUI
Running script /tmp/yade-test-19871.py
Cannot find input file
Traceback (most recent call last):
  File "/tmp/yade-17138/lib/yade-svn1498/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-19871.py", line 3, in <module>
    Preprocessor('DirectShearCis').generate('/tmp/yade-test-19871.xml')
RuntimeError: Generator reported error: Cannot find input file

################################################################################
FEMBeam: generator CRASH
################################################################################
509 [140236094052144] WARN yade  - core/yade.cpp:245 main: No $TERM, using QtGUI instead of PythonUI
509 [140236094052144] WARN yade  - core/yade.cpp:246 main: No $DISPLAY, using PythonUI instead of QtUI
Running script /tmp/yade-test-19871.py
/tmp/yade-17138/build-svn1498/include/yade-svn1498/yade/core/MetaEngine1D.hpp:57 WARNING! dynamic cast of engine unit FEMTetrahedronStiffness failed, will use static_cast. Go figure why.
/tmp/yade-17138/build-svn1498/include/yade-svn1498/yade/core/MetaEngine2D.hpp:61 WARNING! dynamic cast of engine unit FEMSet2Tetrahedrons failed, will use static_cast. Go figure why.
Traceback (most recent call last):
  File "/tmp/yade-17138/lib/yade-svn1498/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-19871.py", line 3, in <module>
    Preprocessor('FEMBeam').generate('/tmp/yade-test-19871.xml')
RuntimeError: Generator reported error: Cannot find input file, you can copy it from examples/ directory

################################################################################
HydraulicTest: generator CRASH
################################################################################
504 [140319312504624] WARN yade  - core/yade.cpp:245 main: No $TERM, using QtGUI instead of PythonUI
504 [140319312504624] WARN yade  - core/yade.cpp:246 main: No $DISPLAY, using PythonUI instead of QtUI
Traceback (most recent call last):
  File "/tmp/yade-17138/lib/yade-svn1498/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-19871.py", line 3, in <module>
    Preprocessor('HydraulicTest').generate('/tmp/yade-test-19871.xml')
RuntimeError: Generator reported error: Error: cannot load the file that should contain spheres
Running script /tmp/yade-test-19871.py

################################################################################
SDECImpactTest: generator CRASH
################################################################################
505 [139642318346032] WARN yade  - core/yade.cpp:245 main: No $TERM, using QtGUI instead of PythonUI
505 [139642318346032] WARN yade  - core/yade.cpp:246 main: No $DISPLAY, using PythonUI instead of QtUI
Traceback (most recent call last):
  File "/tmp/yade-17138/lib/yade-svn1498/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-19871.py", line 3, in <module>
    Preprocessor('SDECImpactTest').generate('/tmp/yade-test-19871.xml')
RuntimeError: Generator reported error: Cannot find input file, you can copy it from examples/ directory
Running script /tmp/yade-test-19871.py

################################################################################
STLImporterTest: generator CRASH
################################################################################
2754 [140118484703024] WARN yade  - core/yade.cpp:245 main: No $TERM, using QtGUI instead of PythonUI
2754 [140118484703024] WARN yade  - core/yade.cpp:246 main: No $DISPLAY, using PythonUI instead of QtUI
Running script /tmp/yade-test-19871.py
Import walls geometry from file: hourglass.stl
ERROR: Bad file: hourglass.stl
Traceback (most recent call last):
  File "/tmp/yade-17138/lib/yade-svn1498/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-19871.py", line 3, in <module>
    Preprocessor('STLImporterTest').generate('/tmp/yade-test-19871.xml')
RuntimeError: Generator reported error: Input file not found, you can copy it from examples/ directory or make one using blender 3D modelling

################################################################################
TetrahedronsTest: simulation CRASH
################################################################################
502 [140127949612848] WARN yade  - core/yade.cpp:245 main: No $TERM, using QtGUI instead of PythonUI
502 [140127949612848] WARN yade  - core/yade.cpp:246 main: No $DISPLAY, using PythonUI instead of QtUI
Running script /tmp/yade-test-19871.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1498/gdb_crash_batch-pid19938'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0x7f7214a8e730 (LWP 19938)]
[New Thread 0x41e0c950 (LWP 19939)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 0000000000000120
0x00007f7214333e81 in nanosleep () from /lib/libpthread.so.0
No symbol "info" in current context.

Thread 2 (Thread 0x41e0c950 (LWP 19939)):
#0  0x00007f72107274df in waitpid () from /lib/libc.so.6
#1  0x00007f72106c8461 in ?? () from /lib/libc.so.6
#2  0x00007f72106c87e7 in system () from /lib/libc.so.6
#3  0x000000000058a4ed in sigHandler (sig=11) at core/yade.cpp:58
#4  <signal handler called>
#5  0x00007f71f05eab19 in MyTetrahedronLaw::action (this=0xa9d8b0, ncb=0x8b6780) at pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.cpp:71
#6  0x000000000052b3c3 in MetaBody::moveToNextTimeStep (this=0x8b6780) at core/MetaBody.cpp:95
#7  0x0000000000581477 in SimulationFlow::singleAction (this=0x832c10) at core/SimulationFlow.cpp:18
#8  0x00000000005833cb in ThreadWorker::callSingleAction (this=0x832c10) at core/ThreadWorker.cpp:71
#9  0x0000000000582bbe in ThreadRunner::call (this=0xa95400) at core/ThreadRunner.cpp:44
#10 0x0000000000582c24 in ThreadRunner::run (this=0xa95400) at core/ThreadRunner.cpp:23
#11 0x000000000058309c in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x41e0c0c8, p=0xa95400) at /usr/include/boost/bind/mem_fn_template.hpp:49
#12 0x0000000000583109 in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x41e0c0d8, f=@0x41e0c0c8, a=@0x41e0c02f) at /usr/include/boost/bind.hpp:231
#13 0x0000000000583146 in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x41e0c0c8) at /usr/include/boost/bind/bind_template.hpp:20
#14 0x0000000000583165 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x41e0c0c8) at /usr/include/boost/function/function_template.hpp:155
#15 0x00007f7213ccd537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#16 0x00007f7213ccd1a2 in ?? () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#17 0x00007f721432c3f7 in start_thread () from /lib/libpthread.so.0
#18 0x00007f7210761b2d in clone () from /lib/libc.so.6
#19 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7f7214a8e730 (LWP 19938)):
#0  0x00007f7214333e81 in nanosleep () from /lib/libpthread.so.0
#1  0x00007f71e6091d3b in pyOmega::wait (this=0xa94790) at gui/py/yadeControl.cpp:413
#2  0x00007f71e5f8d2bd in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0x850648, tc=@0x7fff1cacca30) at /usr/include/boost/python/detail/invoke.hpp:94
#3  0x00007f71e602eef6 in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0x850648, args_=0x7f72149ced50) at /usr/include/boost/python/detail/caller.hpp:199
#4  0x00007f71e602ef49 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0x850640, args=0x7f72149ced50, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#5  0x00007f721204aabe in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#6  0x00007f721204ade8 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#7  0x00007f7213ccd537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#8  0x00007f72120529f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#9  0x00007f7212048127 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#10 0x00007f7214579f23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007f72145f7bb0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#12 0x00007f72145fba86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#13 0x00007f72145fbba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#14 0x00007f721461eda1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#15 0x00007f72145f38d6 in ?? () from /usr/lib/libpython2.5.so.1.0
#16 0x00007f72145fa940 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0x00007f72145fba86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0x00007f72145fbba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#19 0x00007f721461eda1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#20 0x00007f721461f03b in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#21 0x00007f7201041fe6 in PythonUI::execScript (script={static npos = 18446744073709551615, _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7fff1cacda70 "X\033?"}}) at gui/py/PythonUI.cpp:44
#22 0x00007f720104330b in PythonUI::pythonSession () at gui/py/PythonUI.cpp:96
#23 0x00007f72010442c9 in PythonUI::run (this=0x8336b0, argc=4, argv=0x7fff1cace790) at gui/py/PythonUI.cpp:128
#24 0x0000000000589e4e in main (argc=4, argv=0x7fff1cace790) at core/yade.cpp:251
#0  0x00007f7214333e81 in nanosleep () from /lib/libpthread.so.0

-------------- next part --------------
_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From cosurgi at mail.berlios.de  Tue Sep  2 05:23:07 2008
From: cosurgi at mail.berlios.de (cosurgi at BerliOS)
Date: Tue, 2 Sep 2008 05:23:07 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1499 - trunk/gui/qt3
Message-ID: <200809020323.m823N7Yq005336@sheep.berlios.de>

Author: cosurgi
Date: 2008-09-02 05:23:06 +0200 (Tue, 02 Sep 2008)
New Revision: 1499

Modified:
   trunk/gui/qt3/SimulationController.cpp
   trunk/gui/qt3/SimulationController.hpp
Log:
don't refresh display when there's nothing to refresh


Modified: trunk/gui/qt3/SimulationController.cpp
===================================================================
--- trunk/gui/qt3/SimulationController.cpp	2008-08-29 21:23:56 UTC (rev 1498)
+++ trunk/gui/qt3/SimulationController.cpp	2008-09-02 03:23:06 UTC (rev 1499)
@@ -84,7 +84,11 @@
 }
 
 /* restart timer with SimulationController::refreshTime */
-void SimulationController::restartTimer(){ killTimer(updateTimerId); updateTimerId=startTimer(refreshTime); }
+void SimulationController::restartTimer()
+{ 
+	killTimer(updateTimerId); 
+	updateTimerId=startTimer(refreshTime); 
+}
 
 
 void SimulationController::pbApplyClicked()
@@ -225,12 +229,24 @@
 	else Omega::instance().startSimulationLoop();
 }
 
-void SimulationController::cbSyncToggled(bool b){	sync=b; if(sync && refreshTime<20) refreshTime=20; pbStopClicked(); pbStartClicked(); }
-void SimulationController::timerEvent( QTimerEvent* ){
+void SimulationController::cbSyncToggled(bool b)
+{	
+	sync=b; 
+	if(sync && refreshTime<20) 
+		refreshTime=20; 
+	pbStopClicked(); 
+	pbStartClicked(); 
+}
+
+void SimulationController::timerEvent( QTimerEvent* )
+{
 	doUpdate(); /* update the controller, like iteration number etc */
-	/* update GLViews */
-	YadeQtMainWindow::self->redrawAll(true);
-	if(sync && syncRunning){ Omega::instance().spawnSingleSimulationLoop(); }
+	if(hasSimulation && (Omega::instance().isRunning() || syncRunning))
+	{
+		/* update GLViews */
+		YadeQtMainWindow::self->redrawAll(true);
+		if(sync && syncRunning){ Omega::instance().spawnSingleSimulationLoop(); }
+	}
 }
 
 void SimulationController::pbResetClicked()
@@ -386,8 +402,8 @@
 	//cerr<<"dt="<<dt<<",exp10="<<exp10<<",10^exp10="<<pow((float)10,exp10)<<endl;
 
 	/* enable/disable controls here, dynamically */
-	bool hasSimulation=(Omega::instance().getRootBody() ? Omega::instance().getRootBody()->bodies->size()>0 : false ),
-		isRunning=Omega::instance().isRunning() || syncRunning,
+	hasSimulation=(Omega::instance().getRootBody() ? Omega::instance().getRootBody()->bodies->size()>0 : false );
+	bool	isRunning=Omega::instance().isRunning() || syncRunning,
 		hasTimeStepper=Omega::instance().containTimeStepper(),
 		usesTimeStepper=Omega::instance().timeStepperActive(),
 		hasFileName=(Omega::instance().getSimulationFileName()!="");

Modified: trunk/gui/qt3/SimulationController.hpp
===================================================================
--- trunk/gui/qt3/SimulationController.hpp	2008-08-29 21:23:56 UTC (rev 1498)
+++ trunk/gui/qt3/SimulationController.hpp	2008-09-02 03:23:06 UTC (rev 1499)
@@ -33,6 +33,7 @@
 		int updateTimerId;
 		bool sync;
 		bool syncRunning;
+		bool hasSimulation;
 
 		const int iterPerSec_TTL_ms;
 		long  iterPerSec_LastIter;


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From cosurgi at mail.berlios.de  Tue Sep  2 05:51:26 2008
From: cosurgi at mail.berlios.de (cosurgi at BerliOS)
Date: Tue, 2 Sep 2008 05:51:26 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1500 - trunk/core
Message-ID: <200809020351.m823pQli007096@sheep.berlios.de>

Author: cosurgi
Date: 2008-09-02 05:51:24 +0200 (Tue, 02 Sep 2008)
New Revision: 1500

Modified:
   trunk/core/NullGUI.cpp
Log:
support for generating multiple file with single NullGUI call


Modified: trunk/core/NullGUI.cpp
===================================================================
--- trunk/core/NullGUI.cpp	2008-09-02 03:23:06 UTC (rev 1499)
+++ trunk/core/NullGUI.cpp	2008-09-02 03:51:24 UTC (rev 1500)
@@ -50,6 +50,7 @@
 \n\
     input:\n\
 	-f name		- specify filename to load, or filegenerator configuration file\n\
+			  (if a filegenerator then it must be the)\n\
 \n\
     output:\n\
 	-s number	- if specified, a snapshot is saved every 'number'\n\
@@ -80,6 +81,9 @@
 {
 
 	int ch;
+	std::vector<std::string> inputFiles;
+	for(int i=argc-1 ; std::string(argv[i])[0]!='-' && i>1 ; --i )
+		inputFiles.insert(inputFiles.begin(),argv[i]);
 	while( ( ch = getopt(argc,argv,"Hf:s:S:v:pm:t:g:bQ:F:") ) != -1)
 		switch(ch)
 		{
@@ -108,7 +112,14 @@
 		return loop();
 	} 
 	else // FileGenerator
-		return gen();
+	{
+		for(int i=0; i<inputFiles.size() ; ++i)
+		{
+			std::cerr << "filegenerator: \"" << inputFiles[i] << "\"";
+			file=inputFiles[i];
+			gen();
+		}
+	}
 
 	assert(false); // never reach this place
 }
@@ -168,7 +179,7 @@
 			//		+ "__dt_" + lexical_cast<string>(Omega::instance().getTimeStep())
 			//		+ "__it_" + lexical_cast<string>(Omega::instance().getCurrentIteration()) 
 					+ "_" + lexical_cast<string>(Omega::instance().getCurrentIteration()) 
-					+ (binary?".yade":".xml");
+					+ (binary?".xml.gz":".xml");
 				cerr << "saving snapshot: " << fileName << "   ...";
 				Omega::instance().saveSimulation(fileName);
 				cerr << " done.\n";
@@ -188,9 +199,10 @@
 int NullGUI::gen()
 {
 	if(snapshotName.empty())
-		std::cerr << "please specufy output file name with -S\n", exit(0);
+		std::cerr << "please specufy output file name with -S\n"
+		"(if output file is specified inside generator config, then specify \"none\")\n", exit(0);
 	if(file.empty())
-		std::cerr << "please specufy config file name with -f\n", exit(0);
+		std::cerr << "please specify config file name with -f\n", exit(0);
 	boost::shared_ptr<Factorable> tmpf;
 	try
 	{
@@ -212,11 +224,14 @@
 	{
 		std::cerr << file << " cannot be loaded: " << e.what() << "\n", exit(0);
 	}
+	if(snapshotName=="none")
+		std::cerr << "filegenerator output name set to \"none\" - using default output name.\n";
+	else
+		f->setFileName(snapshotName + (binary?".xml.gz":".xml"));
 	std::cerr	<< "calling FileGenerator: " << filegen 
 			<< ",\nwith config file: " << file 
-			<< ",\nto generate file: " << snapshotName << (binary?".yade":".xml") << "\n\n";
-	f->setFileName(snapshotName + (binary?".yade":".xml"));
-	f->setSerializationLibrary((binary?"BINFormatManager":"XMLFormatManager"));
+			<< ",\nto generate file: " << f->getFileName() << "\n\n";
+	f->setSerializationLibrary("XMLFormatManager");
 	std::cerr << "\n" << f->generateAndSave() << "\n";
 	return 0;
 };


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Tue Sep  2 14:36:32 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Tue, 2 Sep 2008 14:36:32 +0200
Subject: [deprecated list] [Yade-dev] changes needing review.
Message-ID: <20080902143632.1715717f@szpak>

Vaclav, can you please verify that those channges that I made are correct?


1. yade.cpp: (I wanted more versatile compile info)

void printHelp()
{
	string flags("");
	flags=flags+"   PREFIX=" PREFIX  "\n";
	flags=flags+"   SUFFIX=" SUFFIX "\n";
	#ifdef YADE_DEBUG
		flags+="   YADE_DEBUG (debug information)\n";
	#endif
	#ifdef NDEBUG
		flags+="   NDEBUG (heavy optimizations, static_casts everywhere, asserts() are no-ops)\n";
	#endif
///........


2. SimulationController.cpp: (my simulation is soo big, that redraw
takes a lot of time, but default refresh rate is 40ms, and so when
simulation is just loaded from file it takes ages to change the
refresh rate because it is constantly redrawing, while the simulation
is not running. So I wanted to disable redraw, when simulation is not
running).

void SimulationController::timerEvent( QTimerEvent* )
{
	doUpdate(); /* update the controller, like iteration number etc */
	if(hasSimulation && (Omega::instance().isRunning() || syncRunning))
	{
		/* update GLViews */
		YadeQtMainWindow::self->redrawAll(true);
		if(sync && syncRunning){ Omega::instance().spawnSingleSimulationLoop(); }
	}
}

thanks
-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From cosurgi at mail.berlios.de  Tue Sep  2 17:52:42 2008
From: cosurgi at mail.berlios.de (cosurgi at BerliOS)
Date: Tue, 2 Sep 2008 17:52:42 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1501 - in trunk: core gui
	gui/qt3
Message-ID: <200809021552.m82Fqgvj021384@sheep.berlios.de>

Author: cosurgi
Date: 2008-09-02 17:52:37 +0200 (Tue, 02 Sep 2008)
New Revision: 1501

Modified:
   trunk/core/NullGUI.cpp
   trunk/gui/SConscript
   trunk/gui/qt3/GLViewer.cpp
   trunk/gui/qt3/GLViewer.hpp
   trunk/gui/qt3/QtGeneratedSimulationController.ui
   trunk/gui/qt3/SimulationController.cpp
   trunk/gui/qt3/SimulationController.hpp
   trunk/gui/qt3/YadeQtMainWindow.cpp
   trunk/gui/qt3/YadeQtMainWindow.hpp
Log:
add to SimulationController buttons for looking in different directions. The default view direction is now down along the direction of gravity.



Modified: trunk/core/NullGUI.cpp
===================================================================
--- trunk/core/NullGUI.cpp	2008-09-02 03:51:24 UTC (rev 1500)
+++ trunk/core/NullGUI.cpp	2008-09-02 15:52:37 UTC (rev 1501)
@@ -50,7 +50,8 @@
 \n\
     input:\n\
 	-f name		- specify filename to load, or filegenerator configuration file\n\
-			  (if a filegenerator then it must be the)\n\
+			  (if a filegenerator then it must be a last parameter\n\
+			  and multiple filegenerators are allowed)\n\
 \n\
     output:\n\
 	-s number	- if specified, a snapshot is saved every 'number'\n\

Modified: trunk/gui/SConscript
===================================================================
--- trunk/gui/SConscript	2008-09-02 03:51:24 UTC (rev 1500)
+++ trunk/gui/SConscript	2008-09-02 15:52:37 UTC (rev 1501)
@@ -29,6 +29,7 @@
 				'yade-serialization',
 				'XMLFormatManager',
 				'yade-serialization-qt',
+				'GravityEngines',
 				'OpenGLRenderingEngine',
 				'PositionOrientationRecorder',
 				'sqlite3x',

Modified: trunk/gui/qt3/GLViewer.cpp
===================================================================
--- trunk/gui/qt3/GLViewer.cpp	2008-09-02 03:51:24 UTC (rev 1500)
+++ trunk/gui/qt3/GLViewer.cpp	2008-09-02 15:52:37 UTC (rev 1501)
@@ -169,6 +169,8 @@
 
 void GLViewer::keyPressEvent(QKeyEvent *e)
 {
+	last_user_event = boost::posix_time::second_clock::local_time();
+
 	if(false){}
 	/* special keys: Escape and Space */
 	else if(e->key()==Qt::Key_Escape){ resetManipulation(); displayMessage("Manipulating scene."); }
@@ -496,12 +498,24 @@
 	YadeQtMainWindow::self->closeView(this);
 }
 
+void GLViewer::mouseMoveEvent(QMouseEvent *e){
+	last_user_event = boost::posix_time::second_clock::local_time();
+	QGLViewer::mouseMoveEvent(e);
+}
+
+void GLViewer::mousePressEvent(QMouseEvent *e){
+	last_user_event = boost::posix_time::second_clock::local_time();
+	QGLViewer::mousePressEvent(e);
+}
+
 /* Handle double-click event; if clipping plane is manipulated, align it with the global coordinate system.
  * Otherwise pass the event to QGLViewer to handle it normally.
  *
  * mostly copied over from ManipulatedFrame::mouseDoubleClickEvent
  */
 void GLViewer::mouseDoubleClickEvent(QMouseEvent *event){
+	last_user_event = boost::posix_time::second_clock::local_time();
+
 	if(manipulatedClipPlane<0) { /* LOG_DEBUG("Double click not on clipping plane"); */ QGLViewer::mouseDoubleClickEvent(event); return; }
 #if QT_VERSION >= 0x040000
 	if (event->modifiers() == Qt::NoModifier)
@@ -516,6 +530,8 @@
 }
 
 void GLViewer::wheelEvent(QWheelEvent* event){
+	last_user_event = boost::posix_time::second_clock::local_time();
+
 	if(manipulatedClipPlane<0){ QGLViewer::wheelEvent(event); return; }
 	assert(manipulatedClipPlane<renderer->clipPlaneNum);
 	float distStep=1e-3*sceneRadius();
@@ -554,3 +570,5 @@
 	}
 }
 
+boost::posix_time::ptime GLViewer::getLastUserEvent(){return last_user_event;};
+

Modified: trunk/gui/qt3/GLViewer.hpp
===================================================================
--- trunk/gui/qt3/GLViewer.hpp	2008-09-02 03:51:24 UTC (rev 1500)
+++ trunk/gui/qt3/GLViewer.hpp	2008-09-02 15:52:37 UTC (rev 1501)
@@ -6,6 +6,7 @@
 #include<yade/pkg-common/OpenGLRenderingEngine.hpp>
 #include<yade/lib-QGLViewer/qglviewer.h>
 #include<yade/lib-QGLViewer/constraint.h>
+#include <boost/date_time/posix_time/posix_time.hpp>
 #include<set>
 
 /*! Class handling user interaction with the openGL rendering of simulation.
@@ -47,6 +48,7 @@
 		set<int> boundClipPlanes;
 		shared_ptr<qglviewer::LocalConstraint> xyPlaneConstraint;
 		string strBoundGroup(){string ret;FOREACH(int i, boundClipPlanes) ret+=" "+lexical_cast<string>(i+1);return ret;}
+		boost::posix_time::ptime last_user_event;
 
      public :
 
@@ -82,7 +84,9 @@
 		void initFromDOMElement(const QDomElement& element);
 		int viewId;
 
+		boost::posix_time::ptime getLastUserEvent();
 
+
 		DECLARE_LOGGER;
 	protected :
 		virtual void keyPressEvent(QKeyEvent *e);
@@ -92,4 +96,6 @@
 		virtual void endSelection(const QPoint &point);
 		virtual void mouseDoubleClickEvent(QMouseEvent *e);
 		virtual void wheelEvent(QWheelEvent* e);
+		virtual void mouseMoveEvent(QMouseEvent *e);
+		virtual void mousePressEvent(QMouseEvent *e);
 };

Modified: trunk/gui/qt3/QtGeneratedSimulationController.ui
===================================================================
--- trunk/gui/qt3/QtGeneratedSimulationController.ui	2008-09-02 03:51:24 UTC (rev 1500)
+++ trunk/gui/qt3/QtGeneratedSimulationController.ui	2008-09-02 15:52:37 UTC (rev 1501)
@@ -8,8 +8,8 @@
         <rect>
             <x>0</x>
             <y>0</y>
-            <width>261</width>
-            <height>470</height>
+            <width>269</width>
+            <height>519</height>
         </rect>
     </property>
     <property name="sizePolicy">
@@ -38,90 +38,98 @@
         </property>
         <widget class="QLayoutWidget" row="0" column="0">
             <property name="name">
-                <cstring>layout11</cstring>
+                <cstring>layout9</cstring>
             </property>
+            <vbox>
+                <property name="name">
+                    <cstring>unnamed</cstring>
+                </property>
+                <property name="spacing">
+                    <number>0</number>
+                </property>
+                <widget class="QLabel">
+                    <property name="name">
+                        <cstring>labelRealTime</cstring>
+                    </property>
+                    <property name="sizePolicy">
+                        <sizepolicy>
+                            <hsizetype>5</hsizetype>
+                            <vsizetype>0</vsizetype>
+                            <horstretch>0</horstretch>
+                            <verstretch>0</verstretch>
+                        </sizepolicy>
+                    </property>
+                    <property name="text">
+                        <string>real 0:00:00.000</string>
+                    </property>
+                </widget>
+                <widget class="QLabel">
+                    <property name="name">
+                        <cstring>labelSimulTime</cstring>
+                    </property>
+                    <property name="sizePolicy">
+                        <sizepolicy>
+                            <hsizetype>5</hsizetype>
+                            <vsizetype>0</vsizetype>
+                            <horstretch>0</horstretch>
+                            <verstretch>0</verstretch>
+                        </sizepolicy>
+                    </property>
+                    <property name="text">
+                        <string>virt 00:000.000m000u000n</string>
+                    </property>
+                </widget>
+                <widget class="QLabel">
+                    <property name="name">
+                        <cstring>labelIter</cstring>
+                    </property>
+                    <property name="sizePolicy">
+                        <sizepolicy>
+                            <hsizetype>5</hsizetype>
+                            <vsizetype>0</vsizetype>
+                            <horstretch>0</horstretch>
+                            <verstretch>0</verstretch>
+                        </sizepolicy>
+                    </property>
+                    <property name="text">
+                        <string>iter #0, 0/s</string>
+                    </property>
+                </widget>
+                <widget class="QLabel">
+                    <property name="name">
+                        <cstring>labelStep</cstring>
+                    </property>
+                    <property name="sizePolicy">
+                        <sizepolicy>
+                            <hsizetype>5</hsizetype>
+                            <vsizetype>0</vsizetype>
+                            <horstretch>0</horstretch>
+                            <verstretch>0</verstretch>
+                        </sizepolicy>
+                    </property>
+                    <property name="text">
+                        <string>step 4e-3</string>
+                    </property>
+                </widget>
+            </vbox>
+        </widget>
+        <widget class="QLayoutWidget" row="1" column="0">
+            <property name="name">
+                <cstring>layout12</cstring>
+            </property>
             <grid>
                 <property name="name">
                     <cstring>unnamed</cstring>
                 </property>
-                <widget class="QLayoutWidget" row="0" column="0">
+                <widget class="QPushButton" row="1" column="1">
                     <property name="name">
-                        <cstring>layout9</cstring>
+                        <cstring>pbReference</cstring>
                     </property>
-                    <vbox>
-                        <property name="name">
-                            <cstring>unnamed</cstring>
-                        </property>
-                        <property name="spacing">
-                            <number>0</number>
-                        </property>
-                        <widget class="QLabel">
-                            <property name="name">
-                                <cstring>labelRealTime</cstring>
-                            </property>
-                            <property name="sizePolicy">
-                                <sizepolicy>
-                                    <hsizetype>5</hsizetype>
-                                    <vsizetype>0</vsizetype>
-                                    <horstretch>0</horstretch>
-                                    <verstretch>0</verstretch>
-                                </sizepolicy>
-                            </property>
-                            <property name="text">
-                                <string>real 0:00:00.000</string>
-                            </property>
-                        </widget>
-                        <widget class="QLabel">
-                            <property name="name">
-                                <cstring>labelSimulTime</cstring>
-                            </property>
-                            <property name="sizePolicy">
-                                <sizepolicy>
-                                    <hsizetype>5</hsizetype>
-                                    <vsizetype>0</vsizetype>
-                                    <horstretch>0</horstretch>
-                                    <verstretch>0</verstretch>
-                                </sizepolicy>
-                            </property>
-                            <property name="text">
-                                <string>virt 00:000.000m000u000n</string>
-                            </property>
-                        </widget>
-                        <widget class="QLabel">
-                            <property name="name">
-                                <cstring>labelIter</cstring>
-                            </property>
-                            <property name="sizePolicy">
-                                <sizepolicy>
-                                    <hsizetype>5</hsizetype>
-                                    <vsizetype>0</vsizetype>
-                                    <horstretch>0</horstretch>
-                                    <verstretch>0</verstretch>
-                                </sizepolicy>
-                            </property>
-                            <property name="text">
-                                <string>iter #0, 0/s</string>
-                            </property>
-                        </widget>
-                        <widget class="QLabel">
-                            <property name="name">
-                                <cstring>labelStep</cstring>
-                            </property>
-                            <property name="sizePolicy">
-                                <sizepolicy>
-                                    <hsizetype>5</hsizetype>
-                                    <vsizetype>0</vsizetype>
-                                    <horstretch>0</horstretch>
-                                    <verstretch>0</verstretch>
-                                </sizepolicy>
-                            </property>
-                            <property name="text">
-                                <string>step 4e-3</string>
-                            </property>
-                        </widget>
-                    </vbox>
+                    <property name="text">
+                        <string>Reference</string>
+                    </property>
                 </widget>
-                <widget class="QTabWidget" row="1" column="0">
+                <widget class="QTabWidget" row="0" column="0" rowspan="1" colspan="3">
                     <property name="name">
                         <cstring>tabWidget</cstring>
                     </property>
@@ -626,59 +634,125 @@
                         </grid>
                     </widget>
                 </widget>
-                <widget class="QLayoutWidget" row="2" column="0">
+                <widget class="QPushButton" row="2" column="0">
                     <property name="name">
-                        <cstring>layout8</cstring>
+                        <cstring>pbXYZ</cstring>
                     </property>
-                    <grid>
-                        <property name="name">
-                            <cstring>unnamed</cstring>
-                        </property>
-                        <widget class="QPushButton" row="0" column="1">
-                            <property name="name">
-                                <cstring>pbReference</cstring>
-                            </property>
-                            <property name="text">
-                                <string>Reference</string>
-                            </property>
-                        </widget>
-                        <widget class="QPushButton" row="0" column="2">
-                            <property name="name">
-                                <cstring>pbCenterScene_2</cstring>
-                            </property>
-                            <property name="sizePolicy">
-                                <sizepolicy>
-                                    <hsizetype>7</hsizetype>
-                                    <vsizetype>0</vsizetype>
-                                    <horstretch>0</horstretch>
-                                    <verstretch>0</verstretch>
-                                </sizepolicy>
-                            </property>
-                            <property name="text">
-                                <string>Center</string>
-                            </property>
-                        </widget>
-                        <widget class="QPushButton" row="0" column="0">
-                            <property name="name">
-                                <cstring>pbNewView_2</cstring>
-                            </property>
-                            <property name="enabled">
-                                <bool>true</bool>
-                            </property>
-                            <property name="sizePolicy">
-                                <sizepolicy>
-                                    <hsizetype>7</hsizetype>
-                                    <vsizetype>0</vsizetype>
-                                    <horstretch>0</horstretch>
-                                    <verstretch>0</verstretch>
-                                </sizepolicy>
-                            </property>
-                            <property name="text">
-                                <string>New 3D</string>
-                            </property>
-                        </widget>
-                    </grid>
+                    <property name="enabled">
+                        <bool>true</bool>
+                    </property>
+                    <property name="sizePolicy">
+                        <sizepolicy>
+                            <hsizetype>3</hsizetype>
+                            <vsizetype>0</vsizetype>
+                            <horstretch>0</horstretch>
+                            <verstretch>0</verstretch>
+                        </sizepolicy>
+                    </property>
+                    <property name="minimumSize">
+                        <size>
+                            <width>0</width>
+                            <height>25</height>
+                        </size>
+                    </property>
+                    <property name="text">
+                        <string></string>
+                    </property>
+                    <property name="pixmap">
+                        <pixmap>image5</pixmap>
+                    </property>
                 </widget>
+                <widget class="QPushButton" row="2" column="2">
+                    <property name="name">
+                        <cstring>pbZXY</cstring>
+                    </property>
+                    <property name="enabled">
+                        <bool>true</bool>
+                    </property>
+                    <property name="sizePolicy">
+                        <sizepolicy>
+                            <hsizetype>3</hsizetype>
+                            <vsizetype>0</vsizetype>
+                            <horstretch>0</horstretch>
+                            <verstretch>0</verstretch>
+                        </sizepolicy>
+                    </property>
+                    <property name="minimumSize">
+                        <size>
+                            <width>0</width>
+                            <height>25</height>
+                        </size>
+                    </property>
+                    <property name="text">
+                        <string></string>
+                    </property>
+                    <property name="pixmap">
+                        <pixmap>image6</pixmap>
+                    </property>
+                </widget>
+                <widget class="QPushButton" row="2" column="1">
+                    <property name="name">
+                        <cstring>pbYZX</cstring>
+                    </property>
+                    <property name="enabled">
+                        <bool>true</bool>
+                    </property>
+                    <property name="sizePolicy">
+                        <sizepolicy>
+                            <hsizetype>3</hsizetype>
+                            <vsizetype>0</vsizetype>
+                            <horstretch>0</horstretch>
+                            <verstretch>0</verstretch>
+                        </sizepolicy>
+                    </property>
+                    <property name="minimumSize">
+                        <size>
+                            <width>0</width>
+                            <height>25</height>
+                        </size>
+                    </property>
+                    <property name="text">
+                        <string></string>
+                    </property>
+                    <property name="pixmap">
+                        <pixmap>image7</pixmap>
+                    </property>
+                </widget>
+                <widget class="QPushButton" row="1" column="2">
+                    <property name="name">
+                        <cstring>pbCenterScene_2</cstring>
+                    </property>
+                    <property name="sizePolicy">
+                        <sizepolicy>
+                            <hsizetype>7</hsizetype>
+                            <vsizetype>0</vsizetype>
+                            <horstretch>0</horstretch>
+                            <verstretch>0</verstretch>
+                        </sizepolicy>
+                    </property>
+                    <property name="text">
+                        <string>Center</string>
+                    </property>
+                </widget>
+                <widget class="QPushButton" row="1" column="0">
+                    <property name="name">
+                        <cstring>pbNewView_2</cstring>
+                    </property>
+                    <property name="enabled">
+                        <bool>true</bool>
+                    </property>
+                    <property name="sizePolicy">
+                        <sizepolicy>
+                            <hsizetype>7</hsizetype>
+                            <vsizetype>0</vsizetype>
+                            <horstretch>0</horstretch>
+                            <verstretch>0</verstretch>
+                        </sizepolicy>
+                    </property>
+                    <property name="text">
+                        <string>New 3D</string>
+                    </property>
+                </widget>
             </grid>
         </widget>
     </grid>
@@ -699,6 +773,15 @@
     <image name="image4">
         <data format="PNG" length="160">89504e470d0a1a0a0000000d4948445200000015000000150806000000a917a5960000006749444154388dadccd10d80300c03d1947118a1fbcb23b00e2c4013dbc9fd9ef4168098eecae6def73b8eba70893a3085aa308d2ab084b2b08c32b08556b08d66700b3dc16d1478d628fa07b6d01368a31968a11528a30c28a12c48a30a48a12a58a20e1811f101d3512a7c38fee1ac0000000049454e44ae426082</data>
     </image>
+    <image name="image5">
+        <data format="PNG" length="409">89504e470d0a1a0a0000000d49484452000000280000002808060000008cfeb86d00000160494441545885edd8cf2a05511cc0f1cf95c80bb0916c9462c1d2c20b7801b6ec59515e025bb628af203b6b65cfe6a2946c08c502d762ce2dae3b7f34cc8c9a6ffdea77a6697edf39bf9973eaf095135ca211e22a5cab0c4b686106b3215f2c53a8d1311ec03576d187790ce3b960af44364592b7d828d9a52b63a2d6b6425e49da82a5d353b6401a9517fcd7d4df60163a17ea36ad0cf71442e567b0f282dddad7ede728adcd959fc124ea65260bb5605e6ac1bcd48279a905f3d2de637fb26b94b22f67152c7cfbeb6c712b26fe924334d11fa219ae7d13eb644874c27096725f1a692f398157ac622de4136982bd38c63dc67f4930a923dbb80bb113f790cf6ce10d73198ae589368378c0a3a87389820b61bc9ee145b290650647f01262344970124f3848289647308e3ddc84d84f2a7c8e53d139e16f09a63185772c6325e4d37185d3be95bf103cc285e8c0b42fe44771826914be50f79659bca6083e00acfe78c833f5cc8f0000000049454e44ae426082</data>
+    </image>
+    <image name="image6">
+        <data format="PNG" length="435">89504e470d0a1a0a0000000d49484452000000280000002808060000008cfeb86d0000017a494441545885edd83f6a1b411480f19f8250e20b5827100494c22e5df8023e415aa74f2a1b7289fca98c5ddbe02b1877ae0de99d4689c1100c714292328952684416696777c55a9a35ec07034fc3e3e99b3768060df39c6184c7618cc25c6318e237f6b01fe26152a31c0ef12d8ca3c42eb9ace3077ea29f52a41b997f825e88d756e4b210c7f812c64962973936f0172ff12ac49b498d6638c727932dee85f83ca1cfc3659c5a001ea51628a313991f57c859098def60e305f3b62fefc7916c9b1bdfc122da63a60aad605d5ac1bab482756905eb32bd6317b93592dccb5505577efde56df1253e9b74aa83eb30b72cc691319734e545f8bc85ed10efe6e42d2a50853e6e705524b8863bbcc701befaffba504730da9d401717f88ea74582f0d66425b77853f26575469677f8839dd82ab30c324506057955a8d2c1e761fe75519158e1b2bc4504f378865f382d2b122b5c9657978ff820f28a963da8670fe0f14c4e2caf2eb14577aa24552db634b20f988df893d472dffc03abb374caa8555fb90000000049454e44ae426082</data>
+    </image>
+    <image name="image7">
+        <data format="PNG" length="434">89504e470d0a1a0a0000000d49484452000000280000002808060000008cfeb86d00000179494441545885edd8b14a1c4118c0f1df8928be8076218d2068114b0b5fc027486b7a5345c84b68ac24d60a798560672df800369a4040021ad11416ea59ec1c6c74766f8e3d7737b07ff860f8e6dbbbffceccceb0dbf3927e2407bd82fcab3219c9e545e67082bff5e88cc6248e708d85865da27cc103d69a1689f15eb6163f372d126349b6e6be352d52c4a9ecc198695a84f8d6d1aa6de6bfa668246b65a269816114adab7e424d2db47e045b2f98bacd3436cdad1fc132ba6d26854eb02a9d60553ac1aa748255199cb1a39c1a8d9ccba982b51f7fb129fe8e334c87380bb9d7e2183f6433d3c3cf90fb87fcc82ce21e9fb019da8b91ba54fa43aefb10fa57b01adaeb6582f0157f42ec95d48d22988f3c33b8c20e767129f24efefca259dce056f685abeccfaac4806dfcc26f6c15dd659e37b80bf1b6a42e85612308f3b9bef914c17d5c843818a3604a5d61e7807778c4063e86f67205c15492050f718ea910e721f7bc6edc240b0efb915ac97fa36ec54b52c7b879020c2e72e95070cdb80000000049454e44ae426082</data>
+    </image>
 </images>
 <connections>
     <connection>
@@ -797,6 +880,24 @@
         <receiver>QtGeneratedSimulationController</receiver>
         <slot>pbReferenceClicked()</slot>
     </connection>
+    <connection>
+        <sender>pbXYZ</sender>
+        <signal>clicked()</signal>
+        <receiver>QtGeneratedSimulationController</receiver>
+        <slot>pbXYZ_clicked()</slot>
+    </connection>
+    <connection>
+        <sender>pbYZX</sender>
+        <signal>clicked()</signal>
+        <receiver>QtGeneratedSimulationController</receiver>
+        <slot>pbYZX_clicked()</slot>
+    </connection>
+    <connection>
+        <sender>pbZXY</sender>
+        <signal>clicked()</signal>
+        <receiver>QtGeneratedSimulationController</receiver>
+        <slot>pbZXY_clicked()</slot>
+    </connection>
 </connections>
 <includes>
     <include location="local" impldecl="in implementation">QtGeneratedSimulationController.ui.h</include>
@@ -827,6 +928,9 @@
     <slot>closeGLViewEvent( int )</slot>
     <slot>pbReference_clicked()</slot>
     <slot>pbReferenceClicked()</slot>
+    <slot>pbXYZ_clicked()</slot>
+    <slot>pbYZX_clicked()</slot>
+    <slot>pbZXY_clicked()</slot>
 </slots>
 <layoutdefaults spacing="6" margin="11"/>
 </UI>

Modified: trunk/gui/qt3/SimulationController.cpp
===================================================================
--- trunk/gui/qt3/SimulationController.cpp	2008-09-02 03:51:24 UTC (rev 1500)
+++ trunk/gui/qt3/SimulationController.cpp	2008-09-02 15:52:37 UTC (rev 1501)
@@ -94,9 +94,25 @@
 void SimulationController::pbApplyClicked()
 {
 	guiGen.deserialize(YadeQtMainWindow::self->renderer);
+	YadeQtMainWindow::self->redrawAll(true);
 }
+		
+void SimulationController::pbXYZ_clicked()
+{
+	YadeQtMainWindow::self->adjustCameraInCurrentView(qglviewer::Vec(0,1,0),qglviewer::Vec(0,0,-1));
+};
 
+void SimulationController::pbYZX_clicked()
+{
+	YadeQtMainWindow::self->adjustCameraInCurrentView(qglviewer::Vec(0,0,1),qglviewer::Vec(-1,0,0));
+};
 
+void SimulationController::pbZXY_clicked()
+{
+	YadeQtMainWindow::self->adjustCameraInCurrentView(qglviewer::Vec(1,0,0),qglviewer::Vec(0,-1,0));
+};
+
+
 void SimulationController::pbLoadClicked()
 {
 	pbStopClicked();

Modified: trunk/gui/qt3/SimulationController.hpp
===================================================================
--- trunk/gui/qt3/SimulationController.hpp	2008-09-02 03:51:24 UTC (rev 1500)
+++ trunk/gui/qt3/SimulationController.hpp	2008-09-02 15:52:37 UTC (rev 1501)
@@ -72,6 +72,9 @@
 		virtual void sbRefreshValueChanged(int);
 		virtual void cbSyncToggled(bool);
 		virtual void pbStart2Clicked();
+		virtual void pbXYZ_clicked();
+		virtual void pbYZX_clicked();
+		virtual void pbZXY_clicked();
 
 
 

Modified: trunk/gui/qt3/YadeQtMainWindow.cpp
===================================================================
--- trunk/gui/qt3/YadeQtMainWindow.cpp	2008-09-02 03:51:24 UTC (rev 1500)
+++ trunk/gui/qt3/YadeQtMainWindow.cpp	2008-09-02 15:52:37 UTC (rev 1501)
@@ -23,7 +23,9 @@
 #include <qpixmap.h>
 #include <boost/filesystem/operations.hpp>
 #include <boost/filesystem/convenience.hpp>
+#include <boost/date_time/posix_time/posix_time.hpp>
 
+#include <yade/pkg-common/GravityEngines.hpp>
 
 
 using namespace std;
@@ -96,7 +98,7 @@
 	}
 }
 
-void YadeQtMainWindow::loadSimulation(string file){createController();	controller->loadSimulationFromFileName(file);}
+void YadeQtMainWindow::loadSimulation(string file){createController();	controller->loadSimulationFromFileName(file); lookDown(glViews[0]);}
 void YadeQtMainWindow::centerViews(){FOREACH(const shared_ptr<GLViewer>& glv,glViews){ if(glv) glv->centerScene(); }}
 
 
@@ -150,12 +152,44 @@
 	glv->setCamera(new YadeCamera);
 	glv->camera()->frame()->setWheelSensitivity(-1.0f);
 	glv->camera()->setUpVector(qglviewer::Vec(0,0,1));
-	glv->camera()->setViewDirection(qglviewer::Vec(-1,0,0));
-	glv->centerScene();
+	glv->camera()->setViewDirection(qglviewer::Vec(-1,-1,-1));
+	lookDown(glv);
 	glViews.push_back(glv);
 	//connect( glv, SIGNAL(closeSignal(int)), this, SLOT( closeGLViewEvent(int) ) );
 }
 
+void YadeQtMainWindow::lookDown(shared_ptr<GLViewer> glv)
+{
+	bool hasSimulation=(Omega::instance().getRootBody() ? Omega::instance().getRootBody()->bodies->size()>0 : false );
+	if(hasSimulation)
+	{	
+		Vector3r g(0,0,1);
+		FOREACH(const shared_ptr<Engine>& e,Omega::instance().getRootBody()->engines){
+			if(e && e->getClassName()=="GravityEngine")  
+				g = -1.0*(dynamic_cast<GravityEngine*>(e.get()))->gravity;
+		}
+		glv->camera()->setUpVector(qglviewer::Vec(g[0],g[1],g[2]));
+	} else {
+		glv->camera()->setUpVector(qglviewer::Vec(0,0,1));
+	}
+	glv->camera()->setViewDirection(qglviewer::Vec(-1,-1,-1));
+	glv->centerScene();
+};
+		
+void YadeQtMainWindow::adjustCameraInCurrentView(qglviewer::Vec up,qglviewer::Vec dir)
+{
+	boost::posix_time::ptime last(boost::posix_time::second_clock::local_time()-boost::posix_time::hours(1000));
+	FOREACH(const shared_ptr<GLViewer>& glv,glViews){ if(glv) last=std::max(last,glv->getLastUserEvent()); }
+	FOREACH(const shared_ptr<GLViewer>& glv,glViews){ 
+		if(glv && glv->getLastUserEvent()>=last)
+		{
+			glv->camera()->setUpVector(up);
+			glv->camera()->setViewDirection(dir);
+			glv->centerScene();
+		}
+	}
+};
+
 void YadeQtMainWindow::closeView(GLViewer* glv){
 	for(size_t i=0; i<glViews.size(); i++){
 		if(glViews[i].get()==glv){

Modified: trunk/gui/qt3/YadeQtMainWindow.hpp
===================================================================
--- trunk/gui/qt3/YadeQtMainWindow.hpp	2008-09-02 03:51:24 UTC (rev 1500)
+++ trunk/gui/qt3/YadeQtMainWindow.hpp	2008-09-02 15:52:37 UTC (rev 1501)
@@ -36,8 +36,10 @@
 		void closeView(GLViewer*);
 		void closeView(int);
 		void centerViews();
+		void adjustCameraInCurrentView(qglviewer::Vec up,qglviewer::Vec dir);
 		void loadSimulation(string file);
 		void redrawAll(bool force=false);
+		void lookDown(shared_ptr<GLViewer> glv);
 
 	protected :
 		shared_ptr<QtGUIPreferences> preferences;


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Tue Sep  2 20:31:04 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 02 Sep 2008 20:31:04 +0200
Subject: [deprecated list] [Yade-dev] changes needing review.
In-Reply-To: <20080902143632.1715717f@szpak>
References: <20080902143632.1715717f@szpak>
Message-ID: <48BD8668.3000902@arcig.cz>


> 1. yade.cpp: (I wanted more versatile compile info)
>
> void printHelp()
> {
> 	string flags("");
> 	flags=flags+"   PREFIX=" PREFIX  "\n";
> 	flags=flags+"   SUFFIX=" SUFFIX "\n";
> 	#ifdef YADE_DEBUG
> 		flags+="   YADE_DEBUG (debug information)\n";
> 	#endif
> 	#ifdef NDEBUG
> 		flags+="   NDEBUG (heavy optimizations, static_casts everywhere, asserts() are no-ops)\n";
> 	#endif
> ///........
>   
Seems ok to me.
> void SimulationController::timerEvent( QTimerEvent* )
> {
> 	doUpdate(); /* update the controller, like iteration number etc */
> 	if(hasSimulation && (Omega::instance().isRunning() || syncRunning))
> 	{
> 		/* update GLViews */
> 		YadeQtMainWindow::self->redrawAll(true);
> 		if(sync && syncRunning){ Omega::instance().spawnSingleSimulationLoop(); }
> 	}
> }
>   
Seems ok as well, but better try.

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Tue Sep  2 23:33:37 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 02 Sep 2008 23:33:37 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1501 - in trunk: core gui
	gui/qt3
In-Reply-To: <200809021552.m82Fqgvj021384@sheep.berlios.de>
References: <200809021552.m82Fqgvj021384@sheep.berlios.de>
Message-ID: <48BDB131.3080206@arcig.cz>

I get unresolved symbols here:

FATAL core/Omega.cpp:195 scanPlugins: Undefined symbol
`QtGeneratedSimulationController::pbXYZ_clicked()'
(/usr/local/lib/yade-trunk/gui/libQtGUI.so: undefined symbol:
_ZN31QtGeneratedSimulationController13pbXYZ_clickedEv).
FATAL core/Omega.cpp:210 scanPlugins: Error loading a plugin (see above;
run with -v to see more), bailing out.



_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Wed Sep  3 00:06:00 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Wed, 3 Sep 2008 00:06:00 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1501 - in trunk: core gui
 gui/qt3
In-Reply-To: <48BDB131.3080206@arcig.cz>
References: <200809021552.m82Fqgvj021384@sheep.berlios.de>
	<48BDB131.3080206@arcig.cz>
Message-ID: <20080903000600.4134395a@szpak>

V?clav S(milauer said:     (by the date of Tue, 02 Sep 2008 23:33:37 +0200)

> I get unresolved symbols here:
> 
> FATAL core/Omega.cpp:195 scanPlugins: Undefined symbol
> `QtGeneratedSimulationController::pbXYZ_clicked()'
> (/usr/local/lib/yade-trunk/gui/libQtGUI.so: undefined symbol:
> _ZN31QtGeneratedSimulationController13pbXYZ_clickedEv).
> FATAL core/Omega.cpp:210 scanPlugins: Error loading a plugin (see above;
> run with -v to see more), bailing out.

hmm... I did full recompile here, but still I cannot reproduce your error.

Of course it also worked with incremental compiling during when I was
working on it.

This is quite strange because both symbols are in the same QtGUI library
(as you can say by looking as gui/SConscript file)

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From cosurgi at mail.berlios.de  Wed Sep  3 03:36:11 2008
From: cosurgi at mail.berlios.de (cosurgi at BerliOS)
Date: Wed, 3 Sep 2008 03:36:11 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1502 - in
	trunk/pkg/lattice:	Engine/StandAloneEngine PreProcessor
Message-ID: <200809030136.m831aB59006742@sheep.berlios.de>

Author: cosurgi
Date: 2008-09-03 03:36:10 +0200 (Wed, 03 Sep 2008)
New Revision: 1502

Modified:
   trunk/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.cpp
   trunk/pkg/lattice/PreProcessor/LatticeExample.cpp
Log:
improved generation of steel fibres in lattice


Modified: trunk/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.cpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.cpp	2008-09-02 15:52:37 UTC (rev 1501)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.cpp	2008-09-03 01:36:10 UTC (rev 1502)
@@ -288,7 +288,7 @@
 		{ // 'E_min' 'E_max' criterion
 			if( deleteBeam(lattice , beam, body) ) // calculates strain
 			{
-				std::cerr << "one beam deleted\n";
+//				std::cerr << "one beam deleted\n";
 				futureDeletes.push_back(body->getId());
 				continue;
 			}

Modified: trunk/pkg/lattice/PreProcessor/LatticeExample.cpp
===================================================================
--- trunk/pkg/lattice/PreProcessor/LatticeExample.cpp	2008-09-02 15:52:37 UTC (rev 1501)
+++ trunk/pkg/lattice/PreProcessor/LatticeExample.cpp	2008-09-03 01:36:10 UTC (rev 1502)
@@ -825,8 +825,8 @@
 	     + "Number of beams: " + lexical_cast<string>(bc.size()) + "\n"
 	     + "Fibres total: " + lexical_cast<string>(fibres_total) + "\n"
 	     + "Matrix beams total: " + lexical_cast<string>(matrix_total) + "\n"
-	     + "Fibres/matrix %: " + lexical_cast<string>(100.0*fibres_total/matrix_total) + "\n"
-	     + "Fibres/all beams %: " + lexical_cast<string>(100.0*fibres_total/beam_total) + "\n"
+//	     + "Fibres/matrix %: " + lexical_cast<string>(100.0*fibres_total/matrix_total) + "\n"
+	     + "Fibres/all other beams %: " + lexical_cast<string>(100.0*fibres_total/(beam_total-fibres_total)) + "\n"
 	     + "\nNOTE: sometimes it can look better when 'drawWireFrame' is enabled in Display tab.";
 
         cerr << "finished.. saving\n" << message << "\n";
@@ -1681,6 +1681,27 @@
 							dir.Normalize();
 						}
 						d += dir * 1/(r*r);
+
+						// strong repulsion when they are intersecting (2D only)
+						if(px==0 && py==0 && AGGREGATES_Z==0 && r<beams_per_fibre*cellsizeUnit_in_meters)
+						{//stupid brute-force method
+							bool overlaps=false;
+							Vector3r start_i(fibres[i].first);
+							Vector3r delta_i(fibres[i].second);
+
+							Vector3r start_j(fibres[j].first);
+							Vector3r delta_j(fibres[j].second);
+
+							for(int I=0 ; I<beams_per_fibre ; ++I)
+								for(int J=0 ; J<beams_per_fibre ; ++J)
+								{
+									float dist = ((start_i+delta_i*I) - (start_j+delta_j*J)).Length();
+									if(dist < cellsizeUnit_in_meters*10.0)
+										overlaps=true;
+								}
+							if(overlaps)
+								d += (dir * 1/(r*r))*10;
+						}
 					}
 			}
 			// repulsion from walls.
@@ -1722,15 +1743,17 @@
 		setProgress(1.0*frame/(1.0*fibre_balancing_iterations));
 	}
 
+/*
 	for(unsigned int i = 0 ; i < fibres.size() ; ++i )
 		fibres[i].first+=Vector3r(random1()-0.5, random1()-0.5, ((AGGREGATES_Z==0)?(0):(random1()-0.5)) )*fibre_irregularity_noUnit*cellsizeUnit_in_meters;
+*/
 }
 
 
 int LatticeExample::isFibre(Vector3r a,Vector3r b)
 {
-	int A=0;
-	int B=0;
+	int A=-1;
+	int B=-1;
 	for(int i = 0 ; i < fibre_count ; ++i)
         {
 		Vector3r pos = fibres[i].first;
@@ -1741,11 +1764,15 @@
 				pos[0] + 1.0*j*del[0],
 				pos[1] + 1.0*j*del[1],
 				pos[2] + 1.0*j*del[2] );
-			if(p == a) A=1;
-			if(p == b) B=1;
+			if(p == a) A=i;
+			if(p == b) B=i;
 		}
 	}
-	return A + B;
+	if(A+B==-2)
+		return 0;
+	if(A==B)
+		return 2;
+	return 1;
 }
 
 bool LatticeExample::fibreAllows(Vector3r a)
@@ -1753,8 +1780,8 @@
 	for(int i = 0 ; i < fibre_count ; ++i)
         {
 		Vector3r pos = fibres[i].first;
-		Vector3r del = fibres[i].second;
-		for(int j = 0 ; j < beams_per_fibre ; ++j)
+		Vector3r del = fibres[i].second / 3.0;
+		for(int j = 0 ; j < beams_per_fibre * 3 ; ++j)
 		{
 			Vector3r p(
 				pos[0] + 1.0*j*del[0],


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From cosurgi at mail.berlios.de  Wed Sep  3 04:02:17 2008
From: cosurgi at mail.berlios.de (cosurgi at BerliOS)
Date: Wed, 3 Sep 2008 04:02:17 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1503 - trunk/core
Message-ID: <200809030202.m8322H5Z008305@sheep.berlios.de>

Author: cosurgi
Date: 2008-09-03 04:02:15 +0200 (Wed, 03 Sep 2008)
New Revision: 1503

Modified:
   trunk/core/NullGUI.cpp
Log:
fixed snaphotNames in NullGUI for .xml.gz 


Modified: trunk/core/NullGUI.cpp
===================================================================
--- trunk/core/NullGUI.cpp	2008-09-03 01:36:10 UTC (rev 1502)
+++ trunk/core/NullGUI.cpp	2008-09-03 02:02:15 UTC (rev 1503)
@@ -151,7 +151,9 @@
 	cerr << "Using timestep: " << Omega::instance().getTimeStep() << endl;
 
 	filesystem::path p(snapshotName);
-	snapshotName = filesystem::basename(p);
+	if(filesystem::extension(p)==".gz")
+		p = filesystem::basename(p); // get rid of .gz
+	snapshotName = filesystem::basename(p); // get rid of .xml
 	if( snapshotInterval != -1 )
 		cerr 	<< "Saving snapshot every " << snapshotInterval*interval << " iterations, \n"
 			<< "to filename: " << snapshotName << "_[0-9]" << endl;


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Wed Sep  3 11:13:18 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Wed, 03 Sep 2008 11:13:18 +0200
Subject: [deprecated list] [Yade-dev] changes in the qt3 ui
Message-ID: <48BE552E.8060900@arcig.cz>

Janek,

I have unfortunately no time to fix those things, so just comments:

1. setting direction based on gravity direction is IMHO wrong, for 2
reasons; (a) if I want to see a body falling down, I want to see it in
the horizontal direction, not from above. (b) the program treis toe be
smarter than the user; if there is a consensus that z is always up, then
the problem will be much simpler: just look in the direction of x to the
yz plane initially.

2. keys for the 3d view do not work when simulation is not running -
there is some problem with updateGL or something.

Regards, Vaclav


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From sj2001 at yandex.ru  Wed Sep  3 12:19:27 2008
From: sj2001 at yandex.ru (sega)
Date: Wed, 3 Sep 2008 14:19:27 +0400
Subject: [deprecated list] [Yade-dev] vector<Vector3r> from python
Message-ID: <200809031419.27397.sj2001@yandex.ru>

Hi.
Vaclav, I have vector<Vector3r> attribute in a class. How can I create this class from python?
Now I do, for example, as
b.shape=GeometricalModel('Facet',{'vertices':[[1,0,0],[0,0,1],[0,0,-1]],'diffuseColor':color,'wire':wire,'visible':True})
but I get "RuntimeError: Could not extract type double"

-- 
Best regards, Sergei D.

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Wed Sep  3 13:17:48 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 03 Sep 2008 13:17:48 +0200
Subject: [deprecated list] [Yade-dev] vector<Vector3r> from python
In-Reply-To: <200809031419.27397.sj2001@yandex.ru>
References: <200809031419.27397.sj2001@yandex.ru>
Message-ID: <48BE725C.9080003@arcig.cz>


> Hi.
> Vaclav, I have vector<Vector3r> attribute in a class. How can I create this class from python?
> Now I do, for example, as
> b.shape=GeometricalModel('Facet',{'vertices':[[1,0,0],[0,0,1],[0,0,-1]],'diffuseColor':color,'wire':wire,'visible':True})
> but I get "RuntimeError: Could not extract type double"
>   
Hi, unfortunately there is a bug in RTTI or in yade-serialization that I
wasn't able to fix although I tried rather hard. Find attached a file
with workaround: use raw string to pass that attribute (setRaw). My idea
was to create same utility function for edges and vertices as well, but
I didn't have time since then; if you do it, that would be great.
Eventually, I though of importing ASCII file with triangular mesh
(vertex coordinates and vertex number for faces) and building simulation
from that (since I am at odds with blender ;-) ). The advantage also
woulds be that once we dump this yade-serialization, only internals of
these functions will change. Once those functions work corretly, feel
free to add them to utils.py.

HTH, Vaclav

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Wed Sep  3 13:19:37 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 03 Sep 2008 13:19:37 +0200
Subject: [deprecated list] [Yade-dev] vector<Vector3r> from python
In-Reply-To: <48BE725C.9080003@arcig.cz>
References: <200809031419.27397.sj2001@yandex.ru> <48BE725C.9080003@arcig.cz>
Message-ID: <48BE72C9.9070203@arcig.cz>

oh well.... (it is a complete simple simulation you can run)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: facets.py
Type: text/x-python
Size: 3679 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20080903/4a74f881/attachment.py>
-------------- next part --------------
_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From janek_listy at wp.pl  Wed Sep  3 13:34:10 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Wed, 3 Sep 2008 13:34:10 +0200
Subject: [deprecated list] [Yade-dev] ML launchpad more email personalities
In-Reply-To: <200809031419.27397.sj2001@yandex.ru>
References: <200809031419.27397.sj2001@yandex.ru>
Message-ID: <20080903133410.68f7801b@szpak>

Hi Sega, 

there was some problem at launchpad because thise message needed
moderator approval to get through. Maybe you have sent it from
different email address than you subscribed with?

In your launchpad account you can add more email addresses as
belonging to you in here:

https://launchpad.net/~username/+editemails

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Wed Sep  3 13:45:07 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Wed, 3 Sep 2008 13:45:07 +0200
Subject: [deprecated list] [Yade-dev]   changes in the qt3 ui
In-Reply-To: <48BE552E.8060900@arcig.cz>
References: <48BE552E.8060900@arcig.cz>
Message-ID: <20080903134507.7f7bcb5b@szpak>

V?clav ?milauer said:     (by the date of Wed, 03 Sep 2008 11:13:18 +0200)

> Janek,
> 
> I have unfortunately no time to fix those things, so just comments:
> 
> 1. setting direction based on gravity direction is IMHO wrong, for 2
> reasons; (a) if I want to see a body falling down, I want to see it in
> the horizontal direction, not from above. (b) the program treis toe be
> smarter than the user; if there is a consensus that z is always up, then
> the problem will be much simpler: just look in the direction of x to the
> yz plane initially.

(a) so you click button ZXY, it's just one click c'mon :)

(b) unfortunately we have no consensus. You have changed the default
view direction and it turned out to be particularly annoying for me,
because lattice is in XY plane. So I was always looking at it from
side. And I have to patiently rotate the camera with mouse until I
could see my sample. That was driving me nuts :)

But I could not just change the default view direction, because then
you would be driven nuts, that you always have to rotate the view to
see your sample (just like I currently had).

Therefore there is no best default view direction.

I concluded that we need an easy way to switch view directions. One
XYZ button for me, another ZXY button for you, and third button to
stay complete with all possibilities.

And since there is no best default view, I decided to have something
like an "overall view" - which in general is a kind of axisymmetric
look. Then the only choice I was left with was direction of gravity.

Can you see my reasoning now? Can you think of any better solution
for that?


> 2. keys for the 3d view do not work when simulation is not running -
> there is some problem with updateGL or something.

did you svn up? It works for me:

1. generate a simulation (it autoloads)
2. click XYZ/... buttons to change view.

this update which you talk about is performed in YadeQtMainWindow.cpp:188
and it only affects the most recently used view :)


-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Wed Sep  3 17:00:18 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Wed, 03 Sep 2008 17:00:18 +0200
Subject: [deprecated list] [Yade-dev]   changes in the qt3 ui
In-Reply-To: <20080903134507.7f7bcb5b@szpak>
References: <48BE552E.8060900@arcig.cz> <20080903134507.7f7bcb5b@szpak>
Message-ID: <48BEA682.40407@arcig.cz>


> (b) unfortunately we have no consensus. You have changed the default
> view direction and it turned out to be particularly annoying for me,
> because lattice is in XY plane. So I was always looking at it from
> side. And I have to patiently rotate the camera with mouse until I
> could see my sample. That was driving me nuts :)
>
> But I could not just change the default view direction, because then
> you would be driven nuts, that you always have to rotate the view to
> see your sample (just like I currently had).
>
> Therefore there is no best default view direction.
>
> I concluded that we need an easy way to switch view directions. One
> XYZ button for me, another ZXY button for you, and third button to
> stay complete with all possibilities.
>
> And since there is no best default view, I decided to have something
> like an "overall view" - which in general is a kind of axisymmetric
> look. Then the only choice I was left with was direction of gravity.
>
> Can you see my reasoning now? Can you think of any better solution
> for that?
>   
OK, let's keep it as it is. I would prefer keyboard shortcuts for this,
but xyz is already taken for grid. Perhaps xyz for directions and XYZ
for grid would be ok. (Those 3 buttons are quite large and to be
consistent, you would have to put many other view controls there.)
(Orienting by gravity engine is non-obvious and will probably make
people wonder what determines the default orientation - until they read
the code ;-) )
> did you svn up? It works for me:
>
> 1. generate a simulation (it autoloads)
> 2. click XYZ/... buttons to change view.
>   
Curiously, it works now (I meant: without any simulation loaded; but
that works now as well).

Oh, BTW, since you're the openGL specialist, could you review the scale
code in GLViewer? It should display 10^n long line segments in axis
directions (in the upper left corner) to give an idea of the scene
scale. Obviously, it is fully meaningful only with the ISO view, but
with perspective, it should show scale on the zMid plane. It doesn't
work in either case (try zooming in etc.), it is weird.


Regards, Vaclav

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Wed Sep  3 17:34:15 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Wed, 3 Sep 2008 17:34:15 +0200
Subject: [deprecated list] [Yade-dev]     changes in the qt3 ui
In-Reply-To: <48BEA682.40407@arcig.cz>
References: <48BE552E.8060900@arcig.cz> <20080903134507.7f7bcb5b@szpak>
	<48BEA682.40407@arcig.cz>
Message-ID: <20080903173415.185ad721@szpak>

V?clav ?milauer said:     (by the date of Wed, 03 Sep 2008 17:00:18 +0200)

> > Can you see my reasoning now? Can you think of any better solution
> > for that?
> >   
> OK, let's keep it as it is. I would prefer keyboard shortcuts for this,
> but xyz is already taken for grid. Perhaps xyz for directions and XYZ
> for grid would be ok. (Those 3 buttons are quite large and to be
> consistent, you would have to put many other view controls there.)

You can add keyboard shortcuts if you wish :) Now my priorities are
focused on Solmech conference next week. I need to finish my
calculations. (and I have just started them, this is why I added
those buttons - to make it bearable to work with lattice ;)


> (Orienting by gravity engine is non-obvious and will probably make
> people wonder what determines the default orientation - until they read
> the code ;-) )

agreed. I dunno - in 10 years maybe we will have a nice "Preferences"
dialog box and there people could specify the default orientation :)



> > did you svn up? It works for me:
> >
> > 1. generate a simulation (it autoloads)
> > 2. click XYZ/... buttons to change view.
> >   
> Curiously, it works now (I meant: without any simulation loaded; but
> that works now as well).
> 
> Oh, BTW, since you're the openGL specialist, could you review the scale
> code in GLViewer? It should display 10^n long line segments in axis
> directions (in the upper left corner) to give an idea of the scene
> scale. Obviously, it is fully meaningful only with the ISO view, but
> with perspective, it should show scale on the zMid plane. It doesn't
> work in either case (try zooming in etc.), it is weird.

I was thinking about labelling those axes too, with small 'x' for the
red one, etc... If I get to it, I'll also look at that problem with
perspective.

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Wed Sep  3 17:39:56 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Wed, 3 Sep 2008 17:39:56 +0200
Subject: [deprecated list] [Yade-dev] Mailing list migration, continued...
Message-ID: <20080903173956.04e0ca75@szpak>

Hi,

we are still waiting for launchpad team to import history from
berlios:

  https://answers.launchpad.net/launchpad/+question/42790

I'm worried how long it will take, especially if we later proceed
with yade-users (which is much more sensitive to any unexpected
complications).


I wanted to write about another problem though:

So far I was unable to configure berlios mailing list to accept
automatically only posts that come forwarded from launchpad, because
the filter is configured on "From:" header, and this header is not
ovrwritten by launchpad. But I wanted to configure it to not accept
any posts that do NOT come from launchpad (people who did not
resubscribe).

Currently I have to moderate every single email coming to this
mailing list, which keeps me busy and annoyed. Unless someone has
solution for mailman on berlios - I think that we will have to
close that ML on berlios. And messages won't be automatically
forwarded anymore.

I'm stuck.
-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From cosurgi at mail.berlios.de  Fri Sep  5 01:52:40 2008
From: cosurgi at mail.berlios.de (cosurgi at BerliOS)
Date: Fri, 5 Sep 2008 01:52:40 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1504 - in trunk: core gui/qt3
	pkg/dem	pkg/dem/Engine/DeusExMachina pkg/dem/PreProcessor
Message-ID: <200809042352.m84NqeMU015116@sheep.berlios.de>

Author: cosurgi
Date: 2008-09-05 01:52:38 +0200 (Fri, 05 Sep 2008)
New Revision: 1504

Modified:
   trunk/core/NullGUI.cpp
   trunk/gui/qt3/SimulationController.cpp
   trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.cpp
   trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.hpp
   trunk/pkg/dem/PreProcessor/TriaxialTest.cpp
   trunk/pkg/dem/PreProcessor/TriaxialTest.hpp
   trunk/pkg/dem/SConscript
Log:
more configurable MakeItFlat,
TriaxialTest can be now a biaxial test as well.
small fixes in UIs



Modified: trunk/core/NullGUI.cpp
===================================================================
--- trunk/core/NullGUI.cpp	2008-09-03 02:02:15 UTC (rev 1503)
+++ trunk/core/NullGUI.cpp	2008-09-04 23:52:38 UTC (rev 1504)
@@ -114,12 +114,13 @@
 	} 
 	else // FileGenerator
 	{
-		for(int i=0; i<inputFiles.size() ; ++i)
+		for(unsigned int i=0; i<inputFiles.size() ; ++i)
 		{
 			std::cerr << "filegenerator: \"" << inputFiles[i] << "\"";
 			file=inputFiles[i];
 			gen();
 		}
+		return 0;
 	}
 
 	assert(false); // never reach this place

Modified: trunk/gui/qt3/SimulationController.cpp
===================================================================
--- trunk/gui/qt3/SimulationController.cpp	2008-09-03 02:02:15 UTC (rev 1503)
+++ trunk/gui/qt3/SimulationController.cpp	2008-09-04 23:52:38 UTC (rev 1504)
@@ -281,7 +281,7 @@
 		Omega::instance().setSimulationFileName(name);
 		pbResetSimulation->setEnabled(true);
 	}
-
+	YadeQtMainWindow::self->redrawAll(true);
 //	pbCenterSceneClicked();  // FIXME - add autocenter option...
 }
 

Modified: trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.cpp	2008-09-03 02:02:15 UTC (rev 1503)
+++ trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.cpp	2008-09-04 23:52:38 UTC (rev 1504)
@@ -13,6 +13,9 @@
 
 MakeItFlat::MakeItFlat() : actionParameterForce(new Force)
 {
+	direction=1;
+	plane_position=0;
+	reset_force=true;
 }
 
 
@@ -23,14 +26,16 @@
 
 void MakeItFlat::registerAttributes()
 {
-	// REGISTER_ATTRIBUTE(hydraulicForce);
+	REGISTER_ATTRIBUTE(direction);
+	REGISTER_ATTRIBUTE(plane_position);
+	REGISTER_ATTRIBUTE(reset_force);
 }
 
 
 void MakeItFlat::applyCondition(MetaBody* ncb)
 {
 	shared_ptr<BodyContainer>& bodies = ncb->bodies;
-	
+
 	BodyContainer::iterator bi    = bodies->begin();
 	BodyContainer::iterator biEnd = bodies->end();
 	for( ; bi!=biEnd ; ++bi )
@@ -46,14 +51,15 @@
 
 		if(b->geometricalModel->getClassName()=="Sphere")
 		{
-		ParticleParameters* p = dynamic_cast<ParticleParameters*>(b->physicalParameters.get());
-		if (p)
-		{
-			p->se3.position[1]=0;
-			static_cast<Force*>( ncb->physicalActions->find( b->getId() , actionParameterForce->getClassIndex() ).get() )->force[1]=0;// 
+			ParticleParameters* p = dynamic_cast<ParticleParameters*>(b->physicalParameters.get());
+			if (p)
+			{
+				p->se3.position[direction]=plane_position;
+				if(reset_force)
+					static_cast<Force*>( ncb->physicalActions->find( b->getId() , actionParameterForce->getClassIndex() ).get() )->force[direction]=0;// 
+			}
 		}
-		}
-        }
+	}
 }
 
 YADE_PLUGIN();

Modified: trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.hpp	2008-09-03 02:02:15 UTC (rev 1503)
+++ trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.hpp	2008-09-04 23:52:38 UTC (rev 1504)
@@ -23,6 +23,10 @@
 		virtual ~MakeItFlat();
 	
 		virtual void applyCondition(MetaBody*);
+
+		int direction;
+		Real plane_position;
+		bool reset_force;
 	
 	protected :
 		virtual void registerAttributes();

Modified: trunk/pkg/dem/PreProcessor/TriaxialTest.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/TriaxialTest.cpp	2008-09-03 02:02:15 UTC (rev 1503)
+++ trunk/pkg/dem/PreProcessor/TriaxialTest.cpp	2008-09-04 23:52:38 UTC (rev 1504)
@@ -23,6 +23,7 @@
 #include<yade/pkg-dem/GlobalStiffnessCounter.hpp>
 #include<yade/pkg-dem/GlobalStiffnessTimeStepper.hpp>
 #include<yade/pkg-dem/PositionOrientationRecorder.hpp>
+#include<yade/pkg-dem/MakeItFlat.hpp>
 
 #include<yade/pkg-dem/AveragePositionRecorder.hpp>
 #include<yade/pkg-dem/ForceRecorder.hpp>
@@ -155,6 +156,8 @@
 	sigmaLateralConfinement=sigmaIsoCompaction;
 
 	wallOversizeFactor=1.3;
+
+	biaxial2dTest=false;
 	
 //	wall_top_id =0;
 // 	wall_bottom_id =0;
@@ -182,6 +185,7 @@
 	//REGISTER_ATTRIBUTE(nlayers);
 	//REGISTER_ATTRIBUTE(boxWalls);
 	REGISTER_ATTRIBUTE(internalCompaction);
+	REGISTER_ATTRIBUTE(biaxial2dTest);
 	REGISTER_ATTRIBUTE(maxMultiplier);
 	REGISTER_ATTRIBUTE(finalMaxMultiplier);
 
@@ -251,6 +255,12 @@
 //	unsigned int startId=boost::numeric::bounds<unsigned int>::highest(), endId=0; // record forces from group 2
 	message="";
 	
+	if(biaxial2dTest && (8.0*(upperCorner[2]-lowerCorner[2]))>(upperCorner[0]-lowerCorner[0]))
+	{
+		message="Biaxial test can be generated only if Z size is more than 8 times smaller than X size";
+		return false;
+	}
+	
 	rootBody = shared_ptr<MetaBody>(new MetaBody);
 	createActors(rootBody);
 	positionRootBody(rootBody);
@@ -593,12 +603,16 @@
 	//cerr << "fin de section triaxialcompressionEngine = shared_ptr<TriaxialCompressionEngine> (new TriaxialCompressionEngine);" << std::endl;
 	
 // recording global stress
-	triaxialStateRecorder = shared_ptr<TriaxialStateRecorder>(new
-	TriaxialStateRecorder);
+	triaxialStateRecorder = shared_ptr<TriaxialStateRecorder>(new TriaxialStateRecorder);
 	triaxialStateRecorder-> outputFile 		= WallStressRecordFile + Key;
 	triaxialStateRecorder-> interval 		= recordIntervalIter;
 	//triaxialStateRecorderer-> thickness 		= thickness;
-	
+
+	shared_ptr<MakeItFlat> makeItFlat(new MakeItFlat);
+	makeItFlat->direction=2;
+	makeItFlat->plane_position = (lowerCorner[2]+upperCorner[2])*0.5;
+	makeItFlat->reset_force = false;	
+
 	#if 0	
 	// moving walls to regulate the stress applied
 	//cerr << "triaxialstressController = shared_ptr<TriaxialStressController> (new TriaxialStressController);" << std::endl;
@@ -632,6 +646,8 @@
 	//rootBody->engines.push_back(gravityCondition);
 	
 	rootBody->engines.push_back(shared_ptr<Engine> (new NewtonsDampedLaw));
+
+	if(biaxial2dTest) rootBody->engines.push_back(makeItFlat);
 	
 	//if(!rotationBlocked)
 	//	rootBody->engines.push_back(orientationIntegrator);

Modified: trunk/pkg/dem/PreProcessor/TriaxialTest.hpp
===================================================================
--- trunk/pkg/dem/PreProcessor/TriaxialTest.hpp	2008-09-03 02:02:15 UTC (rev 1503)
+++ trunk/pkg/dem/PreProcessor/TriaxialTest.hpp	2008-09-04 23:52:38 UTC (rev 1504)
@@ -95,7 +95,8 @@
 				,boxWalls
 				//! flag for choosing between moving boundaries or increasing particles sizes during the compaction stage.
 				,internalCompaction
-				,saveAnimationSnapshots;
+				,saveAnimationSnapshots
+				,biaxial2dTest;
 
 		int		 recordIntervalIter
 				,timeStepUpdateInterval

Modified: trunk/pkg/dem/SConscript
===================================================================
--- trunk/pkg/dem/SConscript	2008-09-03 02:02:15 UTC (rev 1503)
+++ trunk/pkg/dem/SConscript	2008-09-04 23:52:38 UTC (rev 1504)
@@ -637,6 +637,7 @@
 			'SimpleElasticRelationships',
 			'ElasticCriterionTimeStepper',
 			'PhysicalActionVectorVector',
+			'MakeItFlat',
 			'InteractionVecSet',
 			'InteractionHashMap',
 			'BodyRedirectionVector',


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Fri Sep  5 06:49:23 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Fri, 05 Sep 2008 06:49:23 +0200
Subject: [deprecated list] [Yade-dev] MakeItFlat
In-Reply-To: <200809042352.m84NqeMU015116@sheep.berlios.de>
References: <200809042352.m84NqeMU015116@sheep.berlios.de>
Message-ID: <48C0BA53.8090504@arcig.cz>

Cosurgi,

the same effect as with MakeItFlat (ugly name, really` how about
FlattenBodies or something similar?) can be obtained using
PhysicalParameters::blockedDOFs. For example, if you block z on all
bodies, there will be no movement along z. To make "2d" simulation, you
can block z, rx, ry. And so on. (see LeapFrog*Integrator or
NewtonsDampedLaw for the code)

V?clav

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Fri Sep  5 18:32:59 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Fri, 5 Sep 2008 18:32:59 +0200
Subject: [deprecated list] [Yade-dev] IMPORTANT: to receive SVN commits!
Message-ID: <20080905183259.2834804f@szpak>

Hi, sending again because some people have ignored my previous message.

To receive SVN commits from you (and everyone else) as emails,
everyone with SVN access must complete this instruction:


   http://yade.wikia.com/wiki/Launchpad_Migration#SVN_committers


otherwise some commit messages will go to /dev/null !!!
-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Sat Sep  6 17:49:31 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Sat, 06 Sep 2008 17:49:31 +0200
Subject: [deprecated list] [Yade-dev] [Yade-users] Error in YADE
	installation, Ubuntu 8.04 (svn 1498)
In-Reply-To: <38269.61986.qm@web33507.mail.mud.yahoo.com>
References: <38269.61986.qm@web33507.mail.mud.yahoo.com>
Message-ID: <48C2A68B.10701@arcig.cz>


> nurul at ubuntu:~$ sudo dpkg -i yade-svn1498_1_i386.deb
>
> (Reading database ... 131284 files and directories currently installed.)
> Preparing to replace yade-svn1498 1 (using yade-svn1498_1_i386.deb) ...
> Unpacking replacement yade-svn1498 ...
> Setting up yade-svn1498 (1) ...
>
> but still i am not getting YADE(bin).I have also did the following command
>
What do you mean by YADE(bin)?? yade-svn1498 contains file
/usr/bin/yade-svn1498 (or is it /usr/bin/yade-svn1498-opt ?) that you
can run from command-line just by saying yade-svn<tab> <enter>

>
> nurul at ubuntu:~$ sudo dpkg -i yade-svn1498-dbg_1_i386.deb
>
> (Reading database ... 131284 files and directories currently installed.)
> Unpacking yade-svn1498-dbg (from yade-svn1498-dbg_1_i386.deb) ...
> dpkg: error processing yade-svn1498-dbg_1_i386.deb (--install):
>  trying to overwrite
> `/usr/include/yade-svn1498/yade/lib-sqlite3x/sqlite3x_settings_db.hpp',
> which is
>
thanks for pointing this out, it is packaging error obviously.
>


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Sun Sep  7 00:09:59 2008
From: eudoxos at arcig.cz (eudoxos at arcig.cz)
Date: Sun,  7 Sep 2008 00:09:59 +0200 (CEST)
Subject: [deprecated list] [Yade-dev] Automated crash report
	for	/tmp/yade-29029/bin/yade-svn1510:	DirectShearCis, FEMBeam,
	HydraulicTest, SDECImpactTest, STLImporterTest, TetrahedronsTest
Message-ID: <20080906220959.09DA698069@delta>

################################################################################
DirectShearCis: generator CRASH
################################################################################
510 [140369507587888] WARN yade  - core/yade.cpp:245 main: No $TERM, using QtGUI instead of PythonUI
510 [140369507587888] WARN yade  - core/yade.cpp:246 main: No $DISPLAY, using PythonUI instead of QtUI
Running script /tmp/yade-test-31790.py
Cannot find input file
Traceback (most recent call last):
  File "/tmp/yade-29029/lib/yade-svn1510/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-31790.py", line 3, in <module>
    Preprocessor('DirectShearCis').generate('/tmp/yade-test-31790.xml')
RuntimeError: Generator reported error: Cannot find input file

################################################################################
FEMBeam: generator CRASH
################################################################################
518 [139830114400048] WARN yade  - core/yade.cpp:245 main: No $TERM, using QtGUI instead of PythonUI
518 [139830114400048] WARN yade  - core/yade.cpp:246 main: No $DISPLAY, using PythonUI instead of QtUI
Running script /tmp/yade-test-31790.py
/tmp/yade-29029/build-svn1510/include/yade-svn1510/yade/core/MetaEngine1D.hpp:57 WARNING! dynamic cast of engine unit FEMTetrahedronStiffness failed, will use static_cast. Go figure why.
/tmp/yade-29029/build-svn1510/include/yade-svn1510/yade/core/MetaEngine2D.hpp:61 WARNING! dynamic cast of engine unit FEMSet2Tetrahedrons failed, will use static_cast. Go figure why.
Traceback (most recent call last):
  File "/tmp/yade-29029/lib/yade-svn1510/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-31790.py", line 3, in <module>
    Preprocessor('FEMBeam').generate('/tmp/yade-test-31790.xml')
RuntimeError: Generator reported error: Cannot find input file, you can copy it from examples/ directory

################################################################################
HydraulicTest: generator CRASH
################################################################################
506 [140067191838512] WARN yade  - core/yade.cpp:245 main: No $TERM, using QtGUI instead of PythonUI
507 [140067191838512] WARN yade  - core/yade.cpp:246 main: No $DISPLAY, using PythonUI instead of QtUI
Traceback (most recent call last):
  File "/tmp/yade-29029/lib/yade-svn1510/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-31790.py", line 3, in <module>
    Preprocessor('HydraulicTest').generate('/tmp/yade-test-31790.xml')
RuntimeError: Generator reported error: Error: cannot load the file that should contain spheres
Running script /tmp/yade-test-31790.py

################################################################################
SDECImpactTest: generator CRASH
################################################################################
516 [139938497353520] WARN yade  - core/yade.cpp:245 main: No $TERM, using QtGUI instead of PythonUI
516 [139938497353520] WARN yade  - core/yade.cpp:246 main: No $DISPLAY, using PythonUI instead of QtUI
Traceback (most recent call last):
  File "/tmp/yade-29029/lib/yade-svn1510/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-31790.py", line 3, in <module>
    Preprocessor('SDECImpactTest').generate('/tmp/yade-test-31790.xml')
RuntimeError: Generator reported error: Cannot find input file, you can copy it from examples/ directory
Running script /tmp/yade-test-31790.py

################################################################################
STLImporterTest: generator CRASH
################################################################################
508 [139966603568944] WARN yade  - core/yade.cpp:245 main: No $TERM, using QtGUI instead of PythonUI
508 [139966603568944] WARN yade  - core/yade.cpp:246 main: No $DISPLAY, using PythonUI instead of QtUI
Running script /tmp/yade-test-31790.py
Import walls geometry from file: hourglass.stl
ERROR: Bad file: hourglass.stl
Traceback (most recent call last):
  File "/tmp/yade-29029/lib/yade-svn1510/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-31790.py", line 3, in <module>
    Preprocessor('STLImporterTest').generate('/tmp/yade-test-31790.xml')
RuntimeError: Generator reported error: Input file not found, you can copy it from examples/ directory or make one using blender 3D modelling

################################################################################
TetrahedronsTest: simulation CRASH
################################################################################
513 [139817120118576] WARN yade  - core/yade.cpp:245 main: No $TERM, using QtGUI instead of PythonUI
514 [139817120118576] WARN yade  - core/yade.cpp:246 main: No $DISPLAY, using PythonUI instead of QtUI
Running script /tmp/yade-test-31790.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1510/gdb_crash_batch-pid31857'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0x7f29b5c73730 (LWP 31857)]
[New Thread 0x41598950 (LWP 31858)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 0000000000000120
0x00007f29b5518e81 in nanosleep () from /lib/libpthread.so.0
No symbol "info" in current context.

Thread 2 (Thread 0x41598950 (LWP 31858)):
#0  0x00007f29b190c4df in waitpid () from /lib/libc.so.6
#1  0x00007f29b18ad461 in ?? () from /lib/libc.so.6
#2  0x00007f29b18ad7e7 in system () from /lib/libc.so.6
#3  0x000000000058ac41 in sigHandler (sig=11) at core/yade.cpp:58
#4  <signal handler called>
#5  0x00007f2991a3eb19 in MyTetrahedronLaw::action (this=0xa9da70, ncb=0xa9a980) at pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.cpp:71
#6  0x000000000052b4d3 in MetaBody::moveToNextTimeStep (this=0xa9a980) at core/MetaBody.cpp:95
#7  0x0000000000581bcb in SimulationFlow::singleAction (this=0x833c10) at core/SimulationFlow.cpp:18
#8  0x0000000000583b1f in ThreadWorker::callSingleAction (this=0x833c10) at core/ThreadWorker.cpp:71
#9  0x0000000000583312 in ThreadRunner::call (this=0xa9ab40) at core/ThreadRunner.cpp:44
#10 0x0000000000583378 in ThreadRunner::run (this=0xa9ab40) at core/ThreadRunner.cpp:23
#11 0x00000000005837f0 in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x415980c8, p=0xa9ab40) at /usr/include/boost/bind/mem_fn_template.hpp:49
#12 0x000000000058385d in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x415980d8, f=@0x415980c8, a=@0x4159802f) at /usr/include/boost/bind.hpp:231
#13 0x000000000058389a in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x415980c8) at /usr/include/boost/bind/bind_template.hpp:20
#14 0x00000000005838b9 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x415980c8) at /usr/include/boost/function/function_template.hpp:155
#15 0x00007f29b4eb2537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#16 0x00007f29b4eb21a2 in ?? () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#17 0x00007f29b55113f7 in start_thread () from /lib/libpthread.so.0
#18 0x00007f29b1946b2d in clone () from /lib/libc.so.6
#19 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7f29b5c73730 (LWP 31857)):
#0  0x00007f29b5518e81 in nanosleep () from /lib/libpthread.so.0
#1  0x00007f2987263d3b in pyOmega::wait (this=0xa95970) at gui/py/yadeControl.cpp:413
#2  0x00007f298715f2bd in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0x851fc8, tc=@0x7fffbdcb3c20) at /usr/include/boost/python/detail/invoke.hpp:94
#3  0x00007f2987200ef6 in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0x851fc8, args_=0x7f29b5b9dd50) at /usr/include/boost/python/detail/caller.hpp:199
#4  0x00007f2987200f49 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0x851fc0, args=0x7f29b5b9dd50, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#5  0x00007f29b322fabe in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#6  0x00007f29b322fde8 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#7  0x00007f29b4eb2537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#8  0x00007f29b32379f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#9  0x00007f29b322d127 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#10 0x00007f29b575ef23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007f29b57dcbb0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#12 0x00007f29b57e0a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#13 0x00007f29b57e0ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#14 0x00007f29b5803da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#15 0x00007f29b57d88d6 in ?? () from /usr/lib/libpython2.5.so.1.0
#16 0x00007f29b57df940 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0x00007f29b57e0a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0x00007f29b57e0ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#19 0x00007f29b5803da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#20 0x00007f29b580403b in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#21 0x00007f29a2226fe6 in PythonUI::execScript (script={static npos = 18446744073709551615, _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7fffbdcb4c60 "?+?"}}) at gui/py/PythonUI.cpp:44
#22 0x00007f29a222830b in PythonUI::pythonSession () at gui/py/PythonUI.cpp:96
#23 0x00007f29a22292c9 in PythonUI::run (this=0x8346b0, argc=4, argv=0x7fffbdcb5980) at gui/py/PythonUI.cpp:128
#24 0x000000000058a5a2 in main (argc=4, argv=0x7fffbdcb5980) at core/yade.cpp:251
#0  0x00007f29b5518e81 in nanosleep () from /lib/libpthread.so.0

-------------- next part --------------
_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at mail.berlios.de  Sun Sep  7 14:47:02 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Sun, 7 Sep 2008 14:47:02 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1511 - in trunk: core gui/py
Message-ID: <200809071247.m87Cl2tt006579@sheep.berlios.de>

Author: eudoxos
Date: 2008-09-07 14:47:01 +0200 (Sun, 07 Sep 2008)
New Revision: 1511

Modified:
   trunk/core/Body.hpp
   trunk/core/Interaction.hpp
   trunk/core/NullGUI.cpp
   trunk/core/yade.cpp
   trunk/gui/py/_utils.cpp
   trunk/gui/py/eudoxos.py
Log:
1. poisson and young estimator now works on a fractional part of the speciment
2. do not switch ui automatically if selected explcitly
3. body::maskOK to check mask


Modified: trunk/core/Body.hpp
===================================================================
--- trunk/core/Body.hpp	2008-09-05 14:37:29 UTC (rev 1510)
+++ trunk/core/Body.hpp	2008-09-07 12:47:01 UTC (rev 1511)
@@ -61,9 +61,8 @@
 
 		body_id_t getId() const {return id;};
 
-		// FIXME - but we SHOULDN'T use them in InteractionSolver, because it allows
-		//         to have flat simulation. We should make tree simulation and see...
 		int getGroupMask() {return groupMask; };
+		bool maskOk(int mask){return (mask==0 || (groupMask&mask));}
 
 		// only BodyContainer can set the id of a body
 		friend class BodyContainer;

Modified: trunk/core/Interaction.hpp
===================================================================
--- trunk/core/Interaction.hpp	2008-09-05 14:37:29 UTC (rev 1510)
+++ trunk/core/Interaction.hpp	2008-09-07 12:47:01 UTC (rev 1511)
@@ -33,6 +33,13 @@
 		body_id_t getId1() {return id1;};
 		body_id_t getId2() {return id2;};
 
+		#if 0
+			//! Whether both bodies involved in interaction satisfies given mask; provide rootBody for faster lookup
+			bool maskBothOK(int mask, MetaBody* rootBody=NULL){return (mask==0) || (Body::byId(id1,rootBody)->maskOK(mask) && Body::byId(id2,rootBody)->maskOK(mask));}
+			//! Whether at least one body in interaction satisfies given mask; provide rootBody for faster lookup
+			bool maskAnyOK(int mask, MetaBody* rootBody=NULL){return (mask==0) || Body::byId(id1,rootBody)->maskOK(mask) || Body::byId(id2,rootBody)->maskOK(mask);}
+		#endif
+
 	protected :
 		void registerAttributes();
 	REGISTER_CLASS_NAME(Interaction);

Modified: trunk/core/NullGUI.cpp
===================================================================
--- trunk/core/NullGUI.cpp	2008-09-05 14:37:29 UTC (rev 1510)
+++ trunk/core/NullGUI.cpp	2008-09-07 12:47:01 UTC (rev 1511)
@@ -114,7 +114,7 @@
 	} 
 	else // FileGenerator
 	{
-		for(unsigned int i=0; i<inputFiles.size() ; ++i)
+		for(size_t i=0; i<inputFiles.size() ; ++i)
 		{
 			std::cerr << "filegenerator: \"" << inputFiles[i] << "\"";
 			file=inputFiles[i];

Modified: trunk/core/yade.cpp
===================================================================
--- trunk/core/yade.cpp	2008-09-05 14:37:29 UTC (rev 1510)
+++ trunk/core/yade.cpp	2008-09-07 12:47:01 UTC (rev 1511)
@@ -145,12 +145,12 @@
 
 	string configPath=string(getenv("HOME")) + "/.yade" SUFFIX; // this is the default, may be overridden by -c / -C
 	
-	int ch; string gui=""; string simulationFileName=""; bool setup=false; int verbose=0; bool coreOptions=true;
+	int ch; string gui=""; string simulationFileName=""; bool setup=false; int verbose=0; bool coreOptions=true; bool explicitUI=false;
 	while(coreOptions && (ch=getopt(argc,argv,"hnN:wC:cvS:"))!=-1)
 		switch(ch){
 			case 'h': printHelp(); return 1;
-			case 'n': gui="NullGUI"; break;
-			case 'N': gui=optarg; break;
+			case 'n': gui="NullGUI"; explicitUI=true; break;
+			case 'N': gui=optarg; explicitUI=true; break;
 			case 'w': setup=true; break;
 			case 'C': configPath=optarg; break;
 			case 'c': configPath="."; break;
@@ -242,7 +242,7 @@
 	}
 
 	if(gui.size()==0) gui=Omega::instance().preferences->defaultGUILibName;
-	if(gui=="PythonUI" && !getenv("TERM")){ LOG_WARN("No $TERM, using QtGUI instead of PythonUI"); gui="QtGUI"; }
+	if(!explicitUI && gui=="PythonUI" && !getenv("TERM")){ LOG_WARN("No $TERM, using QtGUI instead of PythonUI"); gui="QtGUI"; }
 	if(gui=="QtGUI" && !getenv("DISPLAY")){ LOG_WARN("No $DISPLAY, using PythonUI instead of QtUI"); gui="PythonUI"; }
 		
 	shared_ptr<FrontEnd> frontEnd = dynamic_pointer_cast<FrontEnd>(ClassFactory::instance().createShared(gui));

Modified: trunk/gui/py/_utils.cpp
===================================================================
--- trunk/gui/py/_utils.cpp	2008-09-05 14:37:29 UTC (rev 1510)
+++ trunk/gui/py/_utils.cpp	2008-09-07 12:47:01 UTC (rev 1511)
@@ -7,7 +7,9 @@
 #include<cmath>
 using namespace boost::python;
 
-python::tuple vec2tuple(const Vector3r& v){return boost::python::make_tuple(v[0],v[1],v[2]);};
+python::tuple vec2tuple(const Vector3r& v){return boost::python::make_tuple(v[0],v[1],v[2]);}
+Vector3r tuple2vec(const python::tuple& t){return Vector3r(extract<double>(t[0])(),extract<double>(t[1])(),extract<double>(t[2])());}
+bool isInBB(Vector3r p, Vector3r bbMin, Vector3r bbMax){return p[0]>bbMin[0] && p[0]<bbMax[0] && p[1]>bbMin[1] && p[1]<bbMax[1] && p[2]>bbMin[2] && p[2]<bbMax[2];}
 
 /* \todo implement groupMask */
 python::tuple aabbExtrema(){
@@ -35,14 +37,18 @@
 }
 BOOST_PYTHON_FUNCTION_OVERLOADS(negPosExtremeIds_overloads,negPosExtremeIds,1,2);
 
-python::tuple coordsAndDisplacements(int axis){
+python::tuple coordsAndDisplacements(int axis,python::tuple AABB=python::tuple()){
+	Vector3r bbMin,bbMax; bool useBB=python::len(AABB)>0;
+	if(useBB){bbMin=tuple2vec(extract<python::tuple>(AABB[0])());bbMax=tuple2vec(extract<python::tuple>(AABB[1])());}
 	python::list retCoord,retDispl;
 	FOREACH(const shared_ptr<Body>&b, *Omega::instance().getRootBody()->bodies){
+		if(useBB && !isInBB(b->physicalParameters->se3.position,bbMin,bbMax)) continue;
 		retCoord.append(b->physicalParameters->se3.position[axis]);
 		retDispl.append(b->physicalParameters->se3.position[axis]-b->physicalParameters->refSe3.position[axis]);
 	}
 	return python::make_tuple(retCoord,retDispl);
 }
+BOOST_PYTHON_FUNCTION_OVERLOADS(coordsAndDisplacements_overloads,coordsAndDisplacements,1,2);
 
 void setRefSe3(){
 	FOREACH(const shared_ptr<Body>& b, *Omega::instance().getRootBody()->bodies){
@@ -90,7 +96,7 @@
 	def("PWaveTimeStep",PWaveTimeStep);
 	def("aabbExtrema",aabbExtrema);
 	def("negPosExtremeIds",negPosExtremeIds,negPosExtremeIds_overloads(args("axis","distFactor")));
-	def("coordsAndDisplacements",coordsAndDisplacements);
+	def("coordsAndDisplacements",coordsAndDisplacements,coordsAndDisplacements_overloads(args("AABB")));
 	def("setRefSe3",setRefSe3);
 	def("interactionAnglesHistogram",interactionAnglesHistogram,interactionAnglesHistogram_overloads(args("axis","mask","bins")));
 }

Modified: trunk/gui/py/eudoxos.py
===================================================================
--- trunk/gui/py/eudoxos.py	2008-09-05 14:37:29 UTC (rev 1510)
+++ trunk/gui/py/eudoxos.py	2008-09-07 12:47:01 UTC (rev 1511)
@@ -16,7 +16,7 @@
 		bar(d[0],d[1],width=math.pi/(1.2*bins),fc=fc,alpha=.7,label=['yz','xz','xy'][axis])
 	pylab.show()
 
-def estimatePoissonYoung(principalAxis,stress=0,plot=False):
+def estimatePoissonYoung(principalAxis,stress=0,plot=False,keepRatio=1.):
 	"""Estimate Poisson's ration given the "principal" axis of straining.
 	For every base direction, homogenized strain is computed
 	(slope in linear regression on discrete function particle coordinate ?
@@ -26,12 +26,20 @@
 
 	Young's modulus is computed as ?/??; if stress ? is not given (default 0),
 	the result is 0.
+
+	keepRatio, if < 1., will take only smaller part (centered) or the specimen into account
 	"""
 	dd=[] # storage for linear regression parameters
 	import pylab,numpy,stats
 	from yade import utils
+	if keepRatio<1.:
+		aabb=utils.aabbExtrema(); half=[.5*(aabb[1][i]-aabb[0][i]) for i in [0,1,2]]
+		cut=(tuple([aabb[0][i]+(1.-keepRatio)*half[i] for i in [0,1,2]]),tuple([aabb[1][i]-(1.-keepRatio)*half[i] for i in [0,1,2]]))
 	for axis in [0,1,2]:
-		w,dw=utils.coordsAndDisplacements(axis)
+		if keepRatio<1.:
+			w,dw=utils.coordsAndDisplacements(axis,AABB=cut)
+		else:
+			w,dw=utils.coordsAndDisplacements(axis)
 		l,ll=stats.linregress(w,dw)[0:2] # use only tangent and section
 		dd.append((l,ll,min(w),max(w)))
 		if plot: pylab.plot(w,dw,'.',label='xyz'[axis])
@@ -67,7 +75,7 @@
 
 	ph=o.interactions.nth(0).phys # some params are the same everywhere
 	material.append("%g %g"%(ph['E'],ph['G']))
-	material.append("%g %g %g %g"%(ph['epsCrackOnset'],ph['epsFracture'],ph['expBending'],ph['xiShear']))
+	material.append("%g %g %g %g"%(ph['epsCrackOnset'],ph['epsFracture'],1e50,ph['xiShear']))
 	material.append("%g %g"%(ph['undamagedCohesion'],ph['tanFrictionAngle']))
 
 	# need strainer for getting bodies in positive/negative boundary


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at mail.berlios.de  Mon Sep  8 10:56:42 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Mon, 8 Sep 2008 10:56:42 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1512 - trunk/gui/py
Message-ID: <200809080856.m888ugIV022478@sheep.berlios.de>

Author: eudoxos
Date: 2008-09-08 10:56:42 +0200 (Mon, 08 Sep 2008)
New Revision: 1512

Modified:
   trunk/gui/py/_utils.cpp
   trunk/gui/py/eudoxos.py
Log:
1. eudoxos module cleanups, young estimator arg chages
2. fix harmless compiler warning in _utils.cpp


Modified: trunk/gui/py/_utils.cpp
===================================================================
--- trunk/gui/py/_utils.cpp	2008-09-07 12:47:01 UTC (rev 1511)
+++ trunk/gui/py/_utils.cpp	2008-09-08 08:56:42 UTC (rev 1512)
@@ -38,7 +38,7 @@
 BOOST_PYTHON_FUNCTION_OVERLOADS(negPosExtremeIds_overloads,negPosExtremeIds,1,2);
 
 python::tuple coordsAndDisplacements(int axis,python::tuple AABB=python::tuple()){
-	Vector3r bbMin,bbMax; bool useBB=python::len(AABB)>0;
+	Vector3r bbMin(Vector3r::ZERO), bbMax(Vector3r::ZERO); bool useBB=python::len(AABB)>0;
 	if(useBB){bbMin=tuple2vec(extract<python::tuple>(AABB[0])());bbMax=tuple2vec(extract<python::tuple>(AABB[1])());}
 	python::list retCoord,retDispl;
 	FOREACH(const shared_ptr<Body>&b, *Omega::instance().getRootBody()->bodies){

Modified: trunk/gui/py/eudoxos.py
===================================================================
--- trunk/gui/py/eudoxos.py	2008-09-07 12:47:01 UTC (rev 1511)
+++ trunk/gui/py/eudoxos.py	2008-09-08 08:56:42 UTC (rev 1512)
@@ -16,7 +16,7 @@
 		bar(d[0],d[1],width=math.pi/(1.2*bins),fc=fc,alpha=.7,label=['yz','xz','xy'][axis])
 	pylab.show()
 
-def estimatePoissonYoung(principalAxis,stress=0,plot=False,keepRatio=1.):
+def estimatePoissonYoung(principalAxis,stress=0,plot=False,cutoff=0.):
 	"""Estimate Poisson's ration given the "principal" axis of straining.
 	For every base direction, homogenized strain is computed
 	(slope in linear regression on discrete function particle coordinate ?
@@ -27,16 +27,17 @@
 	Young's modulus is computed as ?/??; if stress ? is not given (default 0),
 	the result is 0.
 
-	keepRatio, if < 1., will take only smaller part (centered) or the specimen into account
+	cutoff, if > 0., will take only smaller part (centered) or the specimen into account
 	"""
 	dd=[] # storage for linear regression parameters
 	import pylab,numpy,stats
 	from yade import utils
-	if keepRatio<1.:
+	if cutoff>0:
 		aabb=utils.aabbExtrema(); half=[.5*(aabb[1][i]-aabb[0][i]) for i in [0,1,2]]
-		cut=(tuple([aabb[0][i]+(1.-keepRatio)*half[i] for i in [0,1,2]]),tuple([aabb[1][i]-(1.-keepRatio)*half[i] for i in [0,1,2]]))
+		cut=(tuple([aabb[0][i]+cutoff*half[i] for i in [0,1,2]]),tuple([aabb[1][i]-cutoff*half[i] for i in [0,1,2]]))
 	for axis in [0,1,2]:
-		if keepRatio<1.:
+		if cutoff>0:
+			#print cutoff,utils.aabbExtrema(),cut
 			w,dw=utils.coordsAndDisplacements(axis,AABB=cut)
 		else:
 			w,dw=utils.coordsAndDisplacements(axis)
@@ -97,11 +98,11 @@
 	return material+["%d %d"%(len(bodies),len(interactions))]+bodies+interactions
 
 
-import numpy
-from pylab import *
-from matplotlib.mlab import *
 
 def eliminateJumps(eps,sigma,numSteep=10,gapWidth=5,movWd=40):
+	from matplotlib.mlab import movavg
+	from numpy import diff,abs
+	import numpy
 	# get histogram of 'derivatives'
 	ds=abs(diff(sigma))
 	n,bins=numpy.histogram(ds)


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at mail.berlios.de  Tue Sep  9 12:07:10 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Tue, 9 Sep 2008 12:07:10 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1513 - in trunk: core extra gui
	gui/py	pkg/common/DataClass/InteractionPhysics	pkg/common/DataClass/PhysicalAction
Message-ID: <200809091007.m89A7A14032494@sheep.berlios.de>

Author: eudoxos
Date: 2008-09-09 12:07:09 +0200 (Tue, 09 Sep 2008)
New Revision: 1513

Modified:
   trunk/core/yade.cpp
   trunk/extra/Brefcom.hpp
   trunk/gui/SConscript
   trunk/gui/py/_utils.cpp
   trunk/gui/py/eudoxos.py
   trunk/gui/py/utils.py
   trunk/pkg/common/DataClass/InteractionPhysics/NormalShearInteractions.hpp
   trunk/pkg/common/DataClass/PhysicalAction/Force.cpp
   trunk/pkg/common/DataClass/PhysicalAction/Force.hpp
   trunk/pkg/common/DataClass/PhysicalAction/Momentum.cpp
   trunk/pkg/common/DataClass/PhysicalAction/Momentum.hpp
Log:
1. add utility function to compute elastic energy within a volume (the dynamic_cast to NormalShearInteraction still fails; what is going on?)
2. add utils.fractionalBox, an AABB reduced to its fraction
3. fix fixmes in Force and Momentum about unused functions about to be deleted
4. plotting interaction direction histogram now works on contrained volume (to study boundary influence on the distribution)


Modified: trunk/core/yade.cpp
===================================================================
--- trunk/core/yade.cpp	2008-09-08 08:56:42 UTC (rev 1512)
+++ trunk/core/yade.cpp	2008-09-09 10:07:09 UTC (rev 1513)
@@ -171,7 +171,7 @@
 		std::string logConf=configPath+"/logging.conf";
 		if(filesystem::exists(logConf)){
 			log4cxx::PropertyConfigurator::configure(logConf);
-			LOG_INFO("Loading  "<<logConf);
+			LOG_INFO("Loading "<<logConf);
 		} else { // otherwise use simple console-directed logging
 			log4cxx::BasicConfigurator::configure();
 			logger->setLevel(log4cxx::Level::WARN);

Modified: trunk/extra/Brefcom.hpp
===================================================================
--- trunk/extra/Brefcom.hpp	2008-09-08 08:56:42 UTC (rev 1512)
+++ trunk/extra/Brefcom.hpp	2008-09-09 10:07:09 UTC (rev 1513)
@@ -95,9 +95,10 @@
 
 		BrefcomContact(): NormalShearInteraction(),E(0), G(0), tanFrictionAngle(0), undamagedCohesion(0), equilibriumDist(0), crossSection(0), xiShear(0), tau(0), expDmgRate(0) { createIndex(); epsT=Vector3r::ZERO; kappaD=0; isCohesive=false; neverDamage=false; omega=0; Fn=0; Fs=Vector3r::ZERO; }
 		//	BrefcomContact(Real _E, Real _G, Real _tanFrictionAngle, Real _undamagedCohesion, Real _equilibriumDist, Real _crossSection, Real _epsCrackOnset, Real _epsFracture, Real _expBending, Real _xiShear, Real _tau=0, Real _expDmgRate=1): InteractionPhysics(), E(_E), G(_G), tanFrictionAngle(_tanFrictionAngle), undamagedCohesion(_undamagedCohesion), equilibriumDist(_equilibriumDist), crossSection(_crossSection), epsCrackOnset(_epsCrackOnset), epsFracture(_epsFracture), expBending(_expBending), xiShear(_xiShear), tau(_tau), expDmgRate(_expDmgRate) { epsT=Vector3r::ZERO; kappaD=0; isCohesive=false; neverDamage=false; omega=0; Fn=0; Fs=Vector3r::ZERO; /*TRVAR5(epsCrackOnset,epsFracture,Kn,crossSection,equilibriumDist); */ }
+		virtual ~BrefcomContact(){}
 
 
-		void registerAttributes(){
+		virtual void registerAttributes(){
 			InteractionPhysics::registerAttributes();
 			REGISTER_ATTRIBUTE(E);
 			REGISTER_ATTRIBUTE(G);

Modified: trunk/gui/SConscript
===================================================================
--- trunk/gui/SConscript	2008-09-08 08:56:42 UTC (rev 1512)
+++ trunk/gui/SConscript	2008-09-09 10:07:09 UTC (rev 1513)
@@ -65,7 +65,7 @@
 			],
 			),
 		env.SharedLibrary('_utils',['py/_utils.cpp'],SHLIBPREFIX='',
-			LIBS=env['LIBS']+['Shop','libboost_python']),
+			LIBS=env['LIBS']+['Shop','libboost_python','Brefcom']),
 		env.SharedLibrary('log',['py/log.cpp'],SHLIBPREFIX=''),
 		env.File('__init__.py','py'),
 		env.File('utils.py','py'),

Modified: trunk/gui/py/_utils.cpp
===================================================================
--- trunk/gui/py/_utils.cpp	2008-09-08 08:56:42 UTC (rev 1512)
+++ trunk/gui/py/_utils.cpp	2008-09-09 10:07:09 UTC (rev 1513)
@@ -4,9 +4,14 @@
 #include<yade/core/Omega.hpp>
 #include<yade/pkg-common/Sphere.hpp>
 #include<yade/pkg-dem/SpheresContactGeometry.hpp>
+#include<yade/extra/Brefcom.hpp>
 #include<cmath>
 using namespace boost::python;
 
+#ifdef LOG4CXX
+	log4cxx::LoggerPtr logger=log4cxx::Logger::getLogger("yade.utils");
+#endif
+
 python::tuple vec2tuple(const Vector3r& v){return boost::python::make_tuple(v[0],v[1],v[2]);}
 Vector3r tuple2vec(const python::tuple& t){return Vector3r(extract<double>(t[0])(),extract<double>(t[1])(),extract<double>(t[2])());}
 bool isInBB(Vector3r p, Vector3r bbMin, Vector3r bbMax){return p[0]>bbMin[0] && p[0]<bbMax[0] && p[1]>bbMin[1] && p[1]<bbMax[1] && p[2]>bbMin[2] && p[2]<bbMax[2];}
@@ -59,7 +64,37 @@
 
 Real PWaveTimeStep(){return Shop::PWaveTimeStep();};
 
+Real elasticEnergyInAABB(python::tuple AABB){
+	Vector3r bbMin=tuple2vec(extract<python::tuple>(AABB[0])()), bbMax=tuple2vec(extract<python::tuple>(AABB[1])());
+	shared_ptr<MetaBody> rb=Omega::instance().getRootBody();
+	Real E=0;
+	FOREACH(const shared_ptr<Interaction>&i, *rb->transientInteractions){
+		if(!i->interactionPhysics) continue;
+		//FIXME: dynamic_pointer_cast instead of static should be used here, but the downcast fails for reasons that are not know :-(
+		shared_ptr<BrefcomContact> bc=static_pointer_cast<BrefcomContact>(i->interactionPhysics); if(!bc) continue;
+		const shared_ptr<Body>& b1=Body::byId(i->getId1(),rb), b2=Body::byId(i->getId2(),rb);
+		bool isIn1=isInBB(b1->physicalParameters->se3.position,bbMin,bbMax), isIn2=isInBB(b2->physicalParameters->se3.position,bbMin,bbMax);
+		if(!isIn1 && !isIn2) continue;
+		LOG_DEBUG("Interaction #"<<i->getId1()<<"--#"<<i->getId2());
+		//cerr<<"Interaction #"<<i->getId1()<<"--#"<<i->getId2()<<endl;
+		Real weight=1.;
+		if((!isIn1 && isIn2) || (isIn1 && !isIn2)){
+			//shared_ptr<Body> bIn=isIn1?b1:b2, bOut=isIn2?b2:b1;
+			Vector3r vIn=(isIn1?b1:b2)->physicalParameters->se3.position, vOut=(isIn2?b1:b2)->physicalParameters->se3.position;
+			#define _WEIGHT_COMPONENT(axis) if(vOut[axis]<bbMin[axis]) weight=min(weight,abs((vOut[axis]-bbMin[axis])/(vOut[axis]-vIn[axis]))); else if(vOut[axis]>bbMax[axis]) weight=min(weight,abs((vOut[axis]-bbMax[axis])/(vOut[axis]-vIn[axis])));
+			_WEIGHT_COMPONENT(0); _WEIGHT_COMPONENT(1); _WEIGHT_COMPONENT(2);
+			assert(weight>=0 && weight<=1);
+			//cerr<<"Interaction crosses AABB boundary, weight is "<<weight<<endl;
+			//LOG_DEBUG("Interaction crosses AABB boundary, weight is "<<weight);
+		} else {assert(isIn1 && isIn2); /* cerr<<"Interaction inside, weight is "<<weight<<endl;*/ /*LOG_DEBUG("Interaction inside, weight is "<<weight);*/}
+		E+=weight*(.5*bc->E*bc->crossSection*pow(bc->epsN,2)+.5*bc->G*bc->crossSection*pow(bc->epsT.Length(),2));
+		//TRVAR5(bc->crossSection,bc->E,bc->G,bc->epsN,bc->epsT.Length());;
+		//cerr<<bc->crossSection<<","<<bc->E<<","<<bc->G<<","<<bc->epsN<<","<<bc->epsT.Length()<<endl;
+	}
+	return E;
+}
 
+
 /* return histogram ([bin1Min,bin2Min,?],[value1,value2,?]) from projections of interactions
  * to the plane perpendicular to axis?[0,1,2]; the number of bins can be specified and they cover
  * the range (0,?), since interactions are bidirecional, hence periodically the same on (?,2?).
@@ -68,16 +103,20 @@
  * Both bodies must be in the mask (except if mask is 0, when all bodies are considered)
  * If the projection is shorter than minProjLen, it is skipped.
  *
- * @todo implement groupMask
+ * If both bodies are _outside_ the aabb (if specified), the interaction is skipped.
+ *
  */
-python::tuple interactionAnglesHistogram(int axis, int mask=0, size_t bins=20, Real minProjLen=1e-6){
+python::tuple interactionAnglesHistogram(int axis, int mask=0, size_t bins=20, python::tuple aabb=python::tuple(), Real minProjLen=1e-6){
 	if(axis<0||axis>2) throw invalid_argument("Axis must be from {0,1,2}=x,y,z.");
+	Vector3r bbMin(Vector3r::ZERO), bbMax(Vector3r::ZERO); bool useBB=python::len(aabb)>0; if(useBB){bbMin=tuple2vec(extract<python::tuple>(aabb[0])());bbMax=tuple2vec(extract<python::tuple>(aabb[1])());}
 	Real binStep=Mathr::PI/bins; int axis2=(axis+1)%3, axis3=(axis+2)%3;
 	vector<Real> cummProj(bins,0.);
 	shared_ptr<MetaBody> rb=Omega::instance().getRootBody();
 	FOREACH(const shared_ptr<Interaction>& i, *rb->transientInteractions){
 		if(!i->isReal) continue;
-		if(!(mask==0 || (mask>0 && (Body::byId(i->getId1(),rb)->getGroupMask() & mask) && (Body::byId(i->getId2(),rb)->getGroupMask() & mask)))) continue;
+		const shared_ptr<Body>& b1=Body::byId(i->getId1(),rb), b2=Body::byId(i->getId2(),rb);
+		if(!b1->maskOk(mask) || !b2->maskOk(mask)) continue;
+		if(useBB && !isInBB(b1->physicalParameters->se3.position,bbMin,bbMax) && !isInBB(b2->physicalParameters->se3.position,bbMin,bbMax)) continue;
 		shared_ptr<SpheresContactGeometry> scg=dynamic_pointer_cast<SpheresContactGeometry>(i->interactionGeometry); if(!scg) continue;
 		Vector3r n(scg->normal); n[axis]=0.; Real nLen=n.Length();
 		if(nLen<minProjLen) continue; // this interaction is (almost) exactly parallel to our axis; skip that one
@@ -89,7 +128,7 @@
 	for(size_t i=0; i<(size_t)bins; i++){ val.append(cummProj[i]); binMid.append(i*binStep);}
 	return python::make_tuple(binMid,val);
 }
-BOOST_PYTHON_FUNCTION_OVERLOADS(interactionAnglesHistogram_overloads,interactionAnglesHistogram,1,3);
+BOOST_PYTHON_FUNCTION_OVERLOADS(interactionAnglesHistogram_overloads,interactionAnglesHistogram,1,4);
 
 
 BOOST_PYTHON_MODULE(_utils){
@@ -98,7 +137,8 @@
 	def("negPosExtremeIds",negPosExtremeIds,negPosExtremeIds_overloads(args("axis","distFactor")));
 	def("coordsAndDisplacements",coordsAndDisplacements,coordsAndDisplacements_overloads(args("AABB")));
 	def("setRefSe3",setRefSe3);
-	def("interactionAnglesHistogram",interactionAnglesHistogram,interactionAnglesHistogram_overloads(args("axis","mask","bins")));
+	def("interactionAnglesHistogram",interactionAnglesHistogram,interactionAnglesHistogram_overloads(args("axis","mask","bins","aabb")));
+	def("elasticEnergy",elasticEnergyInAABB);
 }
 
 

Modified: trunk/gui/py/eudoxos.py
===================================================================
--- trunk/gui/py/eudoxos.py	2008-09-08 08:56:42 UTC (rev 1512)
+++ trunk/gui/py/eudoxos.py	2008-09-09 10:07:09 UTC (rev 1513)
@@ -5,15 +5,15 @@
 #
 
 
-def plotDirections(mask=0,bins=20):
+def plotDirections(mask=0,bins=20,aabb=()):
 	"Plot 3 histograms for distribution of interaction directions, in yz,xz and xy planes."
-	import pylab
+	import pylab,math
 	from yade import utils
 	for axis in [0,1,2]:
-		d=utils.interactionAnglesHistogram(axis,mask=mask,bins=bins)
+		d=utils.interactionAnglesHistogram(axis,mask=mask,bins=bins,aabb=aabb)
 		fc=[0,0,0]; fc[axis]=1.
 		pylab.subplot(220+axis+1,polar=True);
-		bar(d[0],d[1],width=math.pi/(1.2*bins),fc=fc,alpha=.7,label=['yz','xz','xy'][axis])
+		pylab.bar(d[0],d[1],width=math.pi/(1.2*bins),fc=fc,alpha=.7,label=['yz','xz','xy'][axis])
 	pylab.show()
 
 def estimatePoissonYoung(principalAxis,stress=0,plot=False,cutoff=0.):
@@ -32,9 +32,7 @@
 	dd=[] # storage for linear regression parameters
 	import pylab,numpy,stats
 	from yade import utils
-	if cutoff>0:
-		aabb=utils.aabbExtrema(); half=[.5*(aabb[1][i]-aabb[0][i]) for i in [0,1,2]]
-		cut=(tuple([aabb[0][i]+cutoff*half[i] for i in [0,1,2]]),tuple([aabb[1][i]-cutoff*half[i] for i in [0,1,2]]))
+	if cutoff>0: cut=utils.fractionalBox(fraction=1-cutoff)
 	for axis in [0,1,2]:
 		if cutoff>0:
 			#print cutoff,utils.aabbExtrema(),cut

Modified: trunk/gui/py/utils.py
===================================================================
--- trunk/gui/py/utils.py	2008-09-08 08:56:42 UTC (rev 1512)
+++ trunk/gui/py/utils.py	2008-09-09 10:07:09 UTC (rev 1513)
@@ -72,6 +72,14 @@
 	other=((axis+1)%3,(axis+2)%3)
 	return (ext[1][other[0]]-ext[0][other[0]])*(ext[1][other[1]]-ext[0][other[1]])
 
+def fractionalBox(fraction=1.,minMax=None):
+	"""retrurn (min,max) that is the original minMax box (or aabb of the whole simulation if not specified)
+	linearly scaled around its center to the fraction factor"""
+	if not minMax: minMax=aabbExtrema()
+	half=[.5*(minMax[1][i]-minMax[0][i]) for i in [0,1,2]]
+	return (tuple([minMax[0][i]+(1-fraction)*half[i] for i in [0,1,2]]),tuple([minMax[1][i]-(1-fraction)*half[i] for i in [0,1,2]]))
+
+
 def randomizeColors(onShapes=True,onMolds=False,onlyDynamic=False):
 	"""Assign random colors to shape's (GeometricalModel) and/or mold's (InteractingGeometry) diffuseColor.
 	

Modified: trunk/pkg/common/DataClass/InteractionPhysics/NormalShearInteractions.hpp
===================================================================
--- trunk/pkg/common/DataClass/InteractionPhysics/NormalShearInteractions.hpp	2008-09-08 08:56:42 UTC (rev 1512)
+++ trunk/pkg/common/DataClass/InteractionPhysics/NormalShearInteractions.hpp	2008-09-09 10:07:09 UTC (rev 1513)
@@ -28,7 +28,7 @@
 	public:
 		//! shear stiffness
 		Real ks;
-		NormalShearInteraction(){createIndex(); }
+		NormalShearInteraction(){ createIndex(); }
 		virtual ~NormalShearInteraction(){};
 	protected:
 		virtual void registerAttributes(){	

Modified: trunk/pkg/common/DataClass/PhysicalAction/Force.cpp
===================================================================
--- trunk/pkg/common/DataClass/PhysicalAction/Force.cpp	2008-09-08 08:56:42 UTC (rev 1512)
+++ trunk/pkg/common/DataClass/PhysicalAction/Force.cpp	2008-09-09 10:07:09 UTC (rev 1513)
@@ -10,41 +10,12 @@
 
 #include "Force.hpp"
 
+Force::Force() : PhysicalAction(){ createIndex(); }
 
-Force::Force() : PhysicalAction()
-{
-	createIndex();
-}
+Force::~Force(){}
 
-Force::~Force()
-{
-}
+void Force::reset(){	force = Vector3r::ZERO; }
 
+shared_ptr<PhysicalAction> Force::clone(){ return shared_ptr<Force>(new Force(*this));}
 
-/* FIXME - not used
-void Force::add(const shared_ptr<PhysicalAction>& a)
-{
-	Force * f = static_cast<Force*>(a.get());
-	force += f->force;
-}
-
-
-void Force::sub(const shared_ptr<PhysicalAction>& a)
-{
-	Force * f = static_cast<Force*>(a.get());
-	force -= f->force;
-}
-*/
-
-void Force::reset()
-{
-	force = Vector3r::ZERO;
-}
-
-
-shared_ptr<PhysicalAction> Force::clone()
-{
-	return shared_ptr<Force>(new Force(*this));
-}
-
 YADE_PLUGIN();

Modified: trunk/pkg/common/DataClass/PhysicalAction/Force.hpp
===================================================================
--- trunk/pkg/common/DataClass/PhysicalAction/Force.hpp	2008-09-08 08:56:42 UTC (rev 1512)
+++ trunk/pkg/common/DataClass/PhysicalAction/Force.hpp	2008-09-09 10:07:09 UTC (rev 1513)
@@ -21,20 +21,14 @@
 		Force();
 		virtual ~Force();
 
-/// Methods
-//		virtual void add(const shared_ptr<PhysicalAction>& a); // FIXME - not used
-//		virtual void sub(const shared_ptr<PhysicalAction>& a); // FIXME - not used
-
 		virtual void reset();
 		virtual shared_ptr<PhysicalAction> clone();
 		
-/// Serialization
 	REGISTER_CLASS_NAME(Force);
 	REGISTER_BASE_CLASS_NAME(PhysicalAction);
+	virtual void registerAttributes(){REGISTER_ATTRIBUTE(force);}
 
-/// Indexable
 	REGISTER_CLASS_INDEX(Force,PhysicalAction);
-	
 };
 
 REGISTER_SERIALIZABLE(Force,false);

Modified: trunk/pkg/common/DataClass/PhysicalAction/Momentum.cpp
===================================================================
--- trunk/pkg/common/DataClass/PhysicalAction/Momentum.cpp	2008-09-08 08:56:42 UTC (rev 1512)
+++ trunk/pkg/common/DataClass/PhysicalAction/Momentum.cpp	2008-09-09 10:07:09 UTC (rev 1513)
@@ -10,40 +10,12 @@
 
 #include "Momentum.hpp"
 
+Momentum::Momentum() : PhysicalAction(){createIndex();}
 
-Momentum::Momentum() : PhysicalAction()
-{
-	createIndex();
-}
+Momentum::~Momentum(){}
 
-Momentum::~Momentum()
-{
-}
+void Momentum::reset(){	momentum = Vector3r::ZERO; }
 
-/* FIXME - not used
-void Momentum::add(const shared_ptr<PhysicalAction>& a)
-{
-	Momentum * m = static_cast<Momentum*>(a.get());
-	momentum += m->momentum;
-}
+shared_ptr<PhysicalAction> Momentum::clone(){return shared_ptr<Momentum>(new Momentum(*this));}
 
-
-void Momentum::sub(const shared_ptr<PhysicalAction>& a)
-{
-	Momentum * m = static_cast<Momentum*>(a.get());
-	momentum -= m->momentum;
-}
-*/
-
-void Momentum::reset()
-{
-	momentum = Vector3r::ZERO;
-}
-
-
-shared_ptr<PhysicalAction> Momentum::clone()
-{
-	return shared_ptr<Momentum>(new Momentum(*this));
-}
-
 YADE_PLUGIN();

Modified: trunk/pkg/common/DataClass/PhysicalAction/Momentum.hpp
===================================================================
--- trunk/pkg/common/DataClass/PhysicalAction/Momentum.hpp	2008-09-08 08:56:42 UTC (rev 1512)
+++ trunk/pkg/common/DataClass/PhysicalAction/Momentum.hpp	2008-09-09 10:07:09 UTC (rev 1513)
@@ -22,20 +22,15 @@
 		Momentum();
 		virtual ~Momentum();
 
-//		virtual void add(const shared_ptr<PhysicalAction>& a); // FIXME - not used
-//		virtual void sub(const shared_ptr<PhysicalAction>& a); // FIXME - not used
-
 		virtual void reset();
 		virtual shared_ptr<PhysicalAction> clone();
 	
-/// Serialization
 	REGISTER_CLASS_NAME(Momentum);
 	REGISTER_BASE_CLASS_NAME(PhysicalAction);
+	virtual void registerAttributes(){REGISTER_ATTRIBUTE(momentum);}
 	
-/// Indexable
 	REGISTER_CLASS_INDEX(Momentum,PhysicalAction);
 };
-
 REGISTER_SERIALIZABLE(Momentum,false);
 
 #endif // MOMENTUM_HPP


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From sj2001 at yandex.ru  Sat Sep 13 20:08:35 2008
From: sj2001 at yandex.ru (sega)
Date: Sat, 13 Sep 2008 22:08:35 +0400
Subject: [deprecated list] [Yade-dev] new algorithm for facets
Message-ID: <200809132208.35739.sj2001@yandex.ru>

Hi,
I realized a new algorithm for facets. It simpler and faster then current one (it uses only the class Facet, without distinct classes Edge and Vertex), but it less exact (at least theoretically), and is not compatible with the current version (only triangular facets, facets se3 is at the inscribed circle centre). 	
It less exact because contact with facet includes edges and vertices. But because the facets not linked, at each edge will double contacts (on the number of edge facets). The same for the vertices. 
However, simulation of the rod penetration into a bed of sphere particles did not reveal fundamental differences in the total force on the rod with exact (current) and proposed algorithms (see ps for details). 
So I think the accuracy of current algorithm is clearly redundant, and I propose to replace it with new one, rather than provide two algorithms. This would avoid confusion.
That do all think about this? 
Vaclav, what is your opinion (you seems use the facets)?

ps. simulation details:
Rectangular rod is translated at  0.075 m/s into a bed of  sphere particles. The mesh cell density on the rod is varied to analyse the  effects of a fine mesh and  course mesh on the calculated  forces. Total force on rod averaged around three simulations. I uploaded the relevant figs on wiki:
http://images4.wikia.nocookie.net/yade/images//6/68/Rod-coarse.jpeg
http://images1.wikia.nocookie.net/yade/images//6/69/Rod-fine.jpeg
http://images3.wikia.nocookie.net/yade/images//0/00/Rod-total-force.png

pps. proposed algorithm inspired by Kremmer, M. & Favier, J. F. A method for representing boundaries in discrete element modelling~--- part I: Geometry and contact detection Int. J. Numerical Methods in Eng., 2001, 51, 1407-1421
-- 
Best regards, Sergei D.

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Sun Sep 14 00:10:20 2008
From: eudoxos at arcig.cz (eudoxos at arcig.cz)
Date: Sun, 14 Sep 2008 00:10:20 +0200 (CEST)
Subject: [deprecated list] [Yade-dev] Automated crash report
	for	/tmp/yade-3315/bin/yade-svn1513:	DirectShearCis, FEMBeam,
	HydraulicTest, SDECImpactTest, STLImporterTest, TetrahedronsTest
Message-ID: <20080913221020.93652188015@delta>

################################################################################
DirectShearCis: generator CRASH
################################################################################
Running script /tmp/yade-test-6909.py
Cannot find input file
Traceback (most recent call last):
  File "/tmp/yade-3315/lib/yade-svn1513/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-6909.py", line 3, in <module>
    Preprocessor('DirectShearCis').generate('/tmp/yade-test-6909.xml')
RuntimeError: Generator reported error: Cannot find input file

################################################################################
FEMBeam: generator CRASH
################################################################################
Running script /tmp/yade-test-6909.py
/tmp/yade-3315/build-svn1513/include/yade-svn1513/yade/core/MetaEngine1D.hpp:57 WARNING! dynamic cast of engine unit FEMTetrahedronStiffness failed, will use static_cast. Go figure why.
/tmp/yade-3315/build-svn1513/include/yade-svn1513/yade/core/MetaEngine2D.hpp:61 WARNING! dynamic cast of engine unit FEMSet2Tetrahedrons failed, will use static_cast. Go figure why.
Traceback (most recent call last):
  File "/tmp/yade-3315/lib/yade-svn1513/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-6909.py", line 3, in <module>
    Preprocessor('FEMBeam').generate('/tmp/yade-test-6909.xml')
RuntimeError: Generator reported error: Cannot find input file, you can copy it from examples/ directory

################################################################################
HydraulicTest: generator CRASH
################################################################################
Traceback (most recent call last):
  File "/tmp/yade-3315/lib/yade-svn1513/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-6909.py", line 3, in <module>
    Preprocessor('HydraulicTest').generate('/tmp/yade-test-6909.xml')
RuntimeError: Generator reported error: Error: cannot load the file that should contain spheres
Running script /tmp/yade-test-6909.py

################################################################################
SDECImpactTest: generator CRASH
################################################################################
Traceback (most recent call last):
  File "/tmp/yade-3315/lib/yade-svn1513/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-6909.py", line 3, in <module>
    Preprocessor('SDECImpactTest').generate('/tmp/yade-test-6909.xml')
RuntimeError: Generator reported error: Cannot find input file, you can copy it from examples/ directory
Running script /tmp/yade-test-6909.py

################################################################################
STLImporterTest: generator CRASH
################################################################################
Running script /tmp/yade-test-6909.py
Import walls geometry from file: hourglass.stl
ERROR: Bad file: hourglass.stl
Traceback (most recent call last):
  File "/tmp/yade-3315/lib/yade-svn1513/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-6909.py", line 3, in <module>
    Preprocessor('STLImporterTest').generate('/tmp/yade-test-6909.xml')
RuntimeError: Generator reported error: Input file not found, you can copy it from examples/ directory or make one using blender 3D modelling

################################################################################
TetrahedronsTest: simulation CRASH
################################################################################
Running script /tmp/yade-test-6909.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1513/gdb_crash_batch-pid7024'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0x7f1ba4aad730 (LWP 7024)]
[New Thread 0x420d3950 (LWP 7025)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 0000000000000120
0x00007f1ba4352e81 in nanosleep () from /lib/libpthread.so.0
No symbol "info" in current context.

Thread 2 (Thread 0x420d3950 (LWP 7025)):
#0  0x00007f1ba07464df in waitpid () from /lib/libc.so.6
#1  0x00007f1ba06e7461 in ?? () from /lib/libc.so.6
#2  0x00007f1ba06e77e7 in system () from /lib/libc.so.6
#3  0x000000000058ac5b in sigHandler (sig=11) at core/yade.cpp:58
#4  <signal handler called>
#5  0x00007f1b805cfc09 in MyTetrahedronLaw::action (this=0xa9d680, ncb=0xa9a600) at pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.cpp:71
#6  0x000000000052b4c3 in MetaBody::moveToNextTimeStep (this=0xa9a600) at core/MetaBody.cpp:95
#7  0x0000000000581bbf in SimulationFlow::singleAction (this=0x833c10) at core/SimulationFlow.cpp:18
#8  0x0000000000583b13 in ThreadWorker::callSingleAction (this=0x833c10) at core/ThreadWorker.cpp:71
#9  0x0000000000583306 in ThreadRunner::call (this=0xa9a7c0) at core/ThreadRunner.cpp:44
#10 0x000000000058336c in ThreadRunner::run (this=0xa9a7c0) at core/ThreadRunner.cpp:23
#11 0x00000000005837e4 in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x420d30c8, p=0xa9a7c0) at /usr/include/boost/bind/mem_fn_template.hpp:49
#12 0x0000000000583851 in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x420d30d8, f=@0x420d30c8, a=@0x420d302f) at /usr/include/boost/bind.hpp:231
#13 0x000000000058388e in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x420d30c8) at /usr/include/boost/bind/bind_template.hpp:20
#14 0x00000000005838ad in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x420d30c8) at /usr/include/boost/function/function_template.hpp:155
#15 0x00007f1ba3cec537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#16 0x00007f1ba3cec1a2 in ?? () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#17 0x00007f1ba434b3f7 in start_thread () from /lib/libpthread.so.0
#18 0x00007f1ba0780b2d in clone () from /lib/libc.so.6
#19 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7f1ba4aad730 (LWP 7024)):
#0  0x00007f1ba4352e81 in nanosleep () from /lib/libpthread.so.0
#1  0x00007f1b76077d3b in pyOmega::wait (this=0xa95610) at gui/py/yadeControl.cpp:413
#2  0x00007f1b75f732bd in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0x9ed768, tc=@0x7fffacaeba60) at /usr/include/boost/python/detail/invoke.hpp:94
#3  0x00007f1b76014ef6 in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0x9ed768, args_=0x7f1ba49d7d50) at /usr/include/boost/python/detail/caller.hpp:199
#4  0x00007f1b76014f49 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0x9ed760, args=0x7f1ba49d7d50, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#5  0x00007f1ba2069abe in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#6  0x00007f1ba2069de8 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#7  0x00007f1ba3cec537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#8  0x00007f1ba20719f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#9  0x00007f1ba2067127 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#10 0x00007f1ba4598f23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007f1ba4616bb0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#12 0x00007f1ba461aa86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#13 0x00007f1ba461aba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#14 0x00007f1ba463dda1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#15 0x00007f1ba46128d6 in ?? () from /usr/lib/libpython2.5.so.1.0
#16 0x00007f1ba4619940 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0x00007f1ba461aa86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0x00007f1ba461aba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#19 0x00007f1ba463dda1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#20 0x00007f1ba463e03b in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#21 0x00007f1b91038fd6 in PythonUI::execScript (script={static npos = 18446744073709551615, _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7fffacaecaa0 "?*?"}}) at gui/py/PythonUI.cpp:44
#22 0x00007f1b9103a2fb in PythonUI::pythonSession () at gui/py/PythonUI.cpp:96
#23 0x00007f1b9103b2b9 in PythonUI::run (this=0x8346b0, argc=4, argv=0x7fffacaed7c0) at gui/py/PythonUI.cpp:128
#24 0x000000000058a5bc in main (argc=4, argv=0x7fffacaed7c0) at core/yade.cpp:251
#0  0x00007f1ba4352e81 in nanosleep () from /lib/libpthread.so.0

-------------- next part --------------
_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at arcig.cz  Mon Sep 15 20:41:49 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Mon, 15 Sep 2008 20:41:49 +0200
Subject: [deprecated list] [Yade-dev] normalized null quaternion has length
	0...
Message-ID: <48CEAC6D.4060801@arcig.cz>

Hi, I just hit a "feature" (?) that if you take uninitialized quaternion
(which has all components 0) and call Normalize() on it, you don't get
identity rotation as you might expect, but again a zero quaternion, with
zero length... It took me a few hours to spot that, I put it here for
record.

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Wed Sep 17 17:51:17 2008
From: eudoxos at arcig.cz (=?windows-1252?Q?V=E1clav_=8Amilauer?=)
Date: Wed, 17 Sep 2008 17:51:17 +0200
Subject: [deprecated list] [Yade-dev] normalized null quaternion has
	length 0...
In-Reply-To: <48CF7027.7020701@hmg.inpg.fr>
References: <48CEAC6D.4060801@arcig.cz> <48CF7027.7020701@hmg.inpg.fr>
Message-ID: <48D12775.1090709@arcig.cz>

Bruno Chareyre napsal(a):
> Thank you. I don't feel really good now... Do you think some
> uninitialised quaternions could be used somewhere? Why did you hit
> this feature?
Eh, I found a few moments (hours) later that I actually had code like:

Quaternionr q1,q2;
q1-s31orientation*qq1.Conjugate(); q2=se32orientation*qq2.Conjugate();

You see? I overlooked the difference between - and = in "assignement" of q1.

So now I think it is OK...

Vaclav

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Wed Sep 17 23:48:18 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Wed, 17 Sep 2008 23:48:18 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1516 - in
	trunk:	pkg/dem/DataClass/InteractionGeometry
	pkg/dem/Engine/EngineUnit	pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry
	scripts
Message-ID: <200809172148.m8HLmIaE007036@sheep.berlios.de>

Author: eudoxos
Date: 2008-09-17 23:48:17 +0200 (Wed, 17 Sep 2008)
New Revision: 1516

Modified:
   trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.cpp
   trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp
   trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp
   trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp
   trunk/scripts/exact-rot.py
Log:
1. The exactRot code is reasonably verified now to be functional, including rolling correction (SpheresContactGeometry::relocateContactPoints) and will used in brefcom soon. 
2. Updated the "testing" script scripts/exact-rot.py, as a showcase as well.


Modified: trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.cpp
===================================================================
--- trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.cpp	2008-09-15 20:27:49 UTC (rev 1515)
+++ trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.cpp	2008-09-17 21:48:17 UTC (rev 1516)
@@ -5,28 +5,31 @@
 #include "SpheresContactGeometry.hpp"
 YADE_PLUGIN("SpheresContactGeometry");
 
-/* Set contact points on both spheres such that their projection is the one given.
+/* Set contact points on both spheres such that their projection is the one given
+ * (should be on the plane passing through origin and oriented with normal; not checked!)
  */
 void SpheresContactGeometry::setTgPlanePts(Vector3r p1new, Vector3r p2new){
 	cp1rel=ori1.Conjugate()*rollPlanePtToSphere(p1new,d1,normal);
-	cp2rel=ori2.Conjugate()*rollPlanePtToSphere(-p2new,d2,-normal);
+	cp2rel=ori2.Conjugate()*rollPlanePtToSphere(p2new,d2,-normal);
 }
 
 
-/* Move contact point on both spheres in such way that their relative position is the same;
+/* Move contact point on both spheres in such way that their relative position (displacementT) is the same;
  * this should be done regularly to ensure that the angle doesn't go over ?, since then quaternion would
  * flip axis and the point would project on other side of the tangent plane piece.
  */
-void SpheresContactGeometry::relocateContactPoint(){
+void SpheresContactGeometry::relocateContactPoints(){
 	Vector3r p1=contPtInTgPlane1(), p2=contPtInTgPlane2();
 	Vector3r midPt=.5*(p1+p2);
-	/* the factor 1.2 is arbitrary; it should be smaller than pi/2 and bigger than some reasonably small value to avoid frequent relocation */
-	if(midPt.Length()<1.2*min(d1,d2)) return;
-	setTgPlanePts(p1-midPt,p2-midPt);
+	if((p1.SquaredLength()>4*d1 || p2.SquaredLength()>4*d2) && midPt.SquaredLength()>.5*min(d1,d2)){
+		//cerr<<"RELOCATION with displacementT="<<displacementT(); // should be the same before and after relocation
+		setTgPlanePts(p1-midPt,p2-midPt);
+		//cerr<<" ? "<<displacementT()<<endl;
+	}
 }
 
 /*! Perform slip of the projected contact points so that their distance becomes equal (or remains smaller) than the given one.
- *
+ * TODO: not yet tested
  */
 void SpheresContactGeometry::slipToDistIfNeeded(Real dist){
 	Vector3r p1=contPtInTgPlane1(), p2=contPtInTgPlane2();
@@ -49,8 +52,8 @@
  * @returns The projected point coordinates (with origin at the contact point).
  */
 Vector3r SpheresContactGeometry::unrollSpherePtToPlane(const Quaternionr& fromXtoPtOri, const Real& radius, const Vector3r& planeNormal){
-	Quaternionr fromNormalToPt; fromNormalToPt.Align(planeNormal,fromXtoPtOri*Vector3r::UNIT_X);
-	Vector3r axis; Real angle; fromNormalToPt.ToAxisAngle(axis,angle);
+	Quaternionr normal2pt; normal2pt.Align(planeNormal,fromXtoPtOri*Vector3r::UNIT_X);
+	Vector3r axis; Real angle; normal2pt.ToAxisAngle(axis,angle);
 	return (angle*radius) /* length */ *(axis.Cross(planeNormal)) /* direction: both are unit vectors */;
 }
 
@@ -68,7 +71,9 @@
 Quaternionr SpheresContactGeometry::rollPlanePtToSphere(const Vector3r& planePt, const Real& radius, const Vector3r& planeNormal){
 		Vector3r axis=planeNormal.Cross(planePt); axis.Normalize();
 		Real angle=planePt.Length()/radius;
-		return Quaternionr(axis,angle);
+		Quaternionr normal2pt(axis,angle);
+		Quaternionr ret; ret.Align(Vector3r::UNIT_X,normal2pt*planeNormal);
+		return ret;
 }
 
 

Modified: trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp
===================================================================
--- trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp	2008-09-15 20:27:49 UTC (rev 1515)
+++ trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp	2008-09-17 21:48:17 UTC (rev 1516)
@@ -20,7 +20,9 @@
  * (a) plastic slip, when we want to limit their maximum distance (in the projected plane)
  * (b) rolling, where those points must be relocated to not flip over the ? angle from the current contact point
  *
+ * TODO: add torsion code, that will (if a flag is on) compute torsion angle on the contact axis.
  *
+ *
  */
 class SpheresContactGeometry: public InteractionGeometry{
 	public :
@@ -39,28 +41,29 @@
 		 * 		taken instead)
 		 */
 		Quaternionr cp1rel, cp2rel;
-		// interaction "radii" and total length; this is _really_ contant throughout the interaction life
+		// interaction "radii" and total length; this is _really_ constant throughout the interaction life
 		// d1 is really distance from the sphere1 center to the contact plane, it may not correspond to the sphere radius!
 		// therefore, d1+d2=d0 (distance at which the contact was created)
 		Real d1, d2, d0;
 
-		// auxiliary functions: "this" not needed
+		// auxiliary functions; the quaternion magic is all in here
 		static Vector3r unrollSpherePtToPlane(const Quaternionr& fromXtoPtOri, const Real& radius, const Vector3r& normal);
 		static Quaternionr rollPlanePtToSphere(const Vector3r& planePt, const Real& radius, const Vector3r& normal);
+
 		void setTgPlanePts(Vector3r p1new, Vector3r p2new);
 
 		Vector3r contPtInTgPlane1(){return unrollSpherePtToPlane(ori1*cp1rel,d1,normal);}
 		Vector3r contPtInTgPlane2(){return unrollSpherePtToPlane(ori2*cp2rel,d2,-normal);}
 		Vector3r contPt(){return contactPoint; /*pos1+(d1/d0)*(pos2-pos1)*/}
 
-		Vector3r epsT(){return (1/d0)*(contPtInTgPlane2()-contPtInTgPlane1());}
-		Real epsN(){return (pos2-pos1).Length()/d0;}
+		Real displacementN(){return (pos2-pos1).Length()-d0;}
+		Real epsN(){return displacementN()*(1./d0);}
+		Vector3r displacementT(bool relocate=true){ return contPtInTgPlane2()-contPtInTgPlane1();}
+		Vector3r epsT(){return displacementT()*(1./d0);}
 	
 		void slipToDistIfNeeded(Real slip);
-		void relocateContactPoint();
+		void relocateContactPoints();
 
-
-
 		SpheresContactGeometry():InteractionGeometry(),contactPoint(Vector3r::ZERO),radius1(0),radius2(0),exactRot(false){createIndex();}
 		virtual ~SpheresContactGeometry(){};
 	protected :

Modified: trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp
===================================================================
--- trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp	2008-09-15 20:27:49 UTC (rev 1515)
+++ trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp	2008-09-17 21:48:17 UTC (rev 1516)
@@ -13,6 +13,7 @@
 #include<yade/pkg-common/InteractingSphere.hpp>
 
 #include<yade/lib-base/yadeWm3Extra.hpp>
+#include<yade/core/Omega.hpp>
 
 
 InteractingSphere2InteractingSphere4SpheresContactGeometry::InteractingSphere2InteractingSphere4SpheresContactGeometry()
@@ -36,17 +37,13 @@
 	InteractingSphere* s2 = static_cast<InteractingSphere*>(cm2.get());
 
 	Vector3r normal = se32.position-se31.position;
-	Real penetrationDepth = pow(interactionDetectionFactor*(s1->radius+s2->radius), 2) - normal.SquaredLength();// Compute a wrong value just to check sign - faster than computing distances
+	Real penetrationDepth = pow(interactionDetectionFactor*(s1->radius+s2->radius),2) - normal.SquaredLength();// Compute a wrong value just to check sign - faster than computing distances
 	//Real penetrationDepth = s1->radius+s2->radius-normal.Normalize();
 	if (penetrationDepth>0 || c->isReal){
 		shared_ptr<SpheresContactGeometry> scm;
-		if (c->interactionGeometry){
-			// WARNING! 
-			// FIXME - this must be dynamic cast until the contaners are rewritten to support multiple interactions types
-			//         the problem is that scm can be either SDECLinkGeometry or SpheresContactGeometry and the only way CURRENTLY
-			//         to check this is by dynamic cast. This has to be fixed.
-			scm = YADE_PTR_CAST<SpheresContactGeometry>(c->interactionGeometry);
-		} else scm = shared_ptr<SpheresContactGeometry>(new SpheresContactGeometry());
+		if (c->interactionGeometry) scm = YADE_PTR_CAST<SpheresContactGeometry>(c->interactionGeometry);
+		else scm = shared_ptr<SpheresContactGeometry>(new SpheresContactGeometry());
+
 		penetrationDepth = s1->radius+s2->radius-normal.Normalize();
 		scm->contactPoint = se31.position+(s1->radius-0.5*penetrationDepth)*normal;//0.5*(pt1+pt2);
 		scm->normal = normal;
@@ -58,9 +55,7 @@
 			scm->exactRot=true;
 			scm->pos1=se31.position; scm->pos2=se32.position;
 			scm->ori1=se31.orientation; scm->ori2=se32.orientation;
-			//scm->ori1.Normalize(); scm->ori2.Normalize();
 			if(c->isNew){
-				//cerr<<"+++ Assigning constants to SpheresContactGeometry"<<endl;
 				// contact constants
 				scm->d0=(se32.position-se31.position).Length();
 				scm->d1=s1->radius-penetrationDepth; scm->d2=s2->radius-penetrationDepth;
@@ -68,12 +63,9 @@
 				scm->cp1rel.Align(Vector3r::UNIT_X,se31.orientation.Conjugate()*normal);
 				scm->cp2rel.Align(Vector3r::UNIT_X,se32.orientation.Conjugate()*(-normal));
 				scm->cp1rel.Normalize(); scm->cp2rel.Normalize();
-				cerr<<"+++ Relative orientations: "<<scm->cp1rel<<" | "<<scm->cp2rel<<endl;
-				//cerr<<"+++ "<<se31.orientation.Conjugate()<<" | "<<se31.orientation.Conjugate()*normal<<"|"<<scm->cp1rel<<endl;
-				//cerr<<"@@@ cp1rel="<<scm->cp1rel[0]<<";"<<scm->cp1rel[1]<<";"<<scm->cp1rel[2]<<";"<<scm->cp1rel[3]<<endl;
-				//cerr<<"@@@ ori1="<<scm->ori1[0]<<";"<<scm->ori1[1]<<";"<<scm->ori1[2]<<";"<<scm->ori1[3]<<endl;
-				//cerr<<"+++ (normalized)?"<<scm->cp1rel<<" || product with "<<se31.orientation<<" is "<<scm->cp1rel*se31.orientation<<endl;
 			}
+			// FIXME: temporary, testing only!
+			if((Omega::instance().getCurrentIteration()%500)==0) scm->relocateContactPoints();
 		}
 		return true;
 	} else return false;

Modified: trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp
===================================================================
--- trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp	2008-09-15 20:27:49 UTC (rev 1515)
+++ trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp	2008-09-17 21:48:17 UTC (rev 1516)
@@ -75,9 +75,9 @@
 	}
 
 	if(sc->exactRot){
-		//GLUtils::GLDrawLine(sc->pos1,sc->pos2,Vector3r(1,1,1));
+		GLUtils::GLDrawLine(sc->pos1,sc->pos2,Vector3r(.5,.5,.5));
 		// sphere center to point on the sphere
-		GLUtils::GLDrawText("[1]",sc->pos1,Vector3r(1,1,1)); GLUtils::GLDrawText("[2]",sc->pos2,Vector3r(1,1,1));
+		//GLUtils::GLDrawText("[1]",sc->pos1,Vector3r(1,1,1)); GLUtils::GLDrawText("[2]",sc->pos2,Vector3r(1,1,1));
 		GLUtils::GLDrawLine(sc->pos1,sc->pos1+(sc->ori1*sc->cp1rel*Vector3r::UNIT_X),Vector3r(0,.5,1));
 		GLUtils::GLDrawLine(sc->pos2,sc->pos2+(sc->ori2*sc->cp2rel*Vector3r::UNIT_X),Vector3r(0,1,.5));
 		//cerr<<"=== cp1rel="<<sc->cp1rel[0]<<";"<<sc->cp1rel[1]<<";"<<sc->cp1rel[2]<<";"<<sc->cp1rel[3]<<endl;
@@ -89,8 +89,7 @@
 		GLUtils::GLDrawLine(sc->contPt(),sc->contPt()+ptTg1,Vector3r(0,.5,1));
 		GLUtils::GLDrawLine(sc->contPt(),sc->contPt()+ptTg2,Vector3r(0,1,.5));
 		// projected shear
-		GLUtils::GLDrawLine(sc->contPt()+ptTg1,sc->contPt()+ptTg2,Vector3r(.7,.7,.7));
-		// TODO: crosshair to show contact plane (?)
+		GLUtils::GLDrawLine(sc->contPt()+ptTg1,sc->contPt()+ptTg2,Vector3r(1,1,1));
 	}
 
 

Modified: trunk/scripts/exact-rot.py
===================================================================
--- trunk/scripts/exact-rot.py	2008-09-15 20:27:49 UTC (rev 1515)
+++ trunk/scripts/exact-rot.py	2008-09-17 21:48:17 UTC (rev 1516)
@@ -22,7 +22,7 @@
 	StandAloneEngine('ElasticContactLaw'),
 	DeusExMachina('GravityEngine',{'gravity':[0,0,-9.81]}),
 	DeusExMachina('RotationEngine',{'subscribedBodies':[1],'rotationAxis':[1,0,0],'angularVelocity':.01}),
-	DeusExMachina('RotationEngine',{'subscribedBodies':[0],'rotationAxis':[sqrt(2)/2.,sqrt(2)/2.,0],'angularVelocity':.02}),
+	DeusExMachina('RotationEngine',{'subscribedBodies':[0],'rotationAxis':[1,1,1],'angularVelocity':-.02}),
 	MetaEngine('PhysicalActionDamper',[
 		EngineUnit('CundallNonViscousForceDamping',{'damping':0.2}),
 		EngineUnit('CundallNonViscousMomentumDamping',{'damping':0.2})
@@ -36,11 +36,11 @@
 ]
 from yade import utils
 o.bodies.append(utils.sphere([0,0,0],1,dynamic=False,color=[1,0,0],young=30e9,poisson=.3,density=2400,wire=True))
-o.bodies.append(utils.sphere([0,0,2],1,color=[0,1,0],young=30e9,poisson=.3,density=2400,wire=True))
+o.bodies.append(utils.sphere([0,sqrt(2),sqrt(2)],1,color=[0,1,0],young=30e9,poisson=.3,density=2400,wire=True))
 o.miscParams=[Generic('GLDrawSphere',{'glutUse':True})]
 
-o.dt=.2*utils.PWaveTimeStep()
-o.save('/tmp/a.xml.bz2');
+o.dt=.8*utils.PWaveTimeStep()
+#o.save('/tmp/a.xml.bz2');
 #o.run(100000); o.wait(); print o.iter/o.realtime,'iterations/sec'
 from yade import qt
 renderer=qt.Renderer()


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at arcig.cz  Thu Sep 18 11:06:02 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Thu, 18 Sep 2008 11:06:02 +0200
Subject: [deprecated list] [Yade-dev] new algorithm for facets
In-Reply-To: <200809132208.35739.sj2001@yandex.ru>
References: <200809132208.35739.sj2001@yandex.ru>
Message-ID: <48D219FA.6000803@arcig.cz>


> Hi,
> I realized a new algorithm for facets. It simpler and faster then current one (it uses only the class Facet, without distinct classes Edge and Vertex), but it less exact (at least theoretically), and is not compatible with the current version (only triangular facets, facets se3 is at the inscribed circle centre). 	
> It less exact because contact with facet includes edges and vertices. But because the facets not linked, at each edge will double contacts (on the number of edge facets). The same for the vertices. 
> However, simulation of the rod penetration into a bed of sphere particles did not reveal fundamental differences in the total force on the rod with exact (current) and proposed algorithms (see ps for details). 
> So I think the accuracy of current algorithm is clearly redundant, and I propose to replace it with new one, rather than provide two algorithms. This would avoid confusion.
> That do all think about this? 
> Vaclav, what is your opinion (you seems use the facets)?
>   
Hi, I think that is a great idea. For the tests you run, there will be
not much difference since there is relatively few edges, but there can
be big influence of the doubled reaction on e.g. triangulated surface
with a lot of triangles to model the geometry details. I would suggest
adding some possiblit (flag?) to turn on/off reactions on each
particular edge and vertes - this way, there could an algorithm that
would enable only one of the coinciding edges etc. Does that make sense?

Nice work :-)

Vaclav
> ps. simulation details:
> Rectangular rod is translated at  0.075 m/s into a bed of  sphere particles. The mesh cell density on the rod is varied to analyse the  effects of a fine mesh and  course mesh on the calculated  forces. Total force on rod averaged around three simulations. I uploaded the relevant figs on wiki:
> http://images4.wikia.nocookie.net/yade/images//6/68/Rod-coarse.jpeg
> http://images1.wikia.nocookie.net/yade/images//6/69/Rod-fine.jpeg
> http://images3.wikia.nocookie.net/yade/images//0/00/Rod-total-force.png
>
> pps. proposed algorithm inspired by Kremmer, M. & Favier, J. F. A method for representing boundaries in discrete element modelling~--- part I: Geometry and contact detection Int. J. Numerical Methods in Eng., 2001, 51, 1407-1421
>   


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Thu Sep 18 11:50:21 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Thu, 18 Sep 2008 11:50:21 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1517 - in trunk: extra
	extra/clump lib/opengl	pkg/dem/DataClass/InteractionGeometry
	pkg/dem/Engine/EngineUnit	pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry
Message-ID: <200809180950.m8I9oLlq025319@sheep.berlios.de>

Author: eudoxos
Date: 2008-09-18 11:50:19 +0200 (Thu, 18 Sep 2008)
New Revision: 1517

Modified:
   trunk/extra/Brefcom.cpp
   trunk/extra/clump/Shop.cpp
   trunk/extra/clump/Shop.hpp
   trunk/lib/opengl/GLUtils.hpp
   trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.cpp
   trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp
   trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp
   trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.hpp
   trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp
Log:
1. Remove GL things from Shop, moved to lib/opengl/GLUtils.hpp
2. Cleanup of SpheresContactGeometry code, rename exactRot to hasShear



Modified: trunk/extra/Brefcom.cpp
===================================================================
--- trunk/extra/Brefcom.cpp	2008-09-17 21:48:17 UTC (rev 1516)
+++ trunk/extra/Brefcom.cpp	2008-09-18 09:50:19 UTC (rev 1517)
@@ -4,6 +4,7 @@
 #include<yade/pkg-dem/BodyMacroParameters.hpp>
 #include<yade/pkg-common/Sphere.hpp>
 #include<yade/lib-QGLViewer/qglviewer.h>
+#include<yade/lib-opengl/GLUtils.hpp>
 
 
 YADE_PLUGIN("BrefcomMakeContact","BrefcomContact","BrefcomLaw","GLDrawBrefcomContact","BrefcomDamageColorizer", "BrefcomPhysParams", "BrefcomGlobalCharacteristics" /* ,"BrefcomStiffnessComputer"*/ );
@@ -314,9 +315,9 @@
 		min(1.,max(0.,BC->epsTrans/BC->epsCrackOnset)),
 		min(1.,max(0.,abs(BC->epsTrans)/BC->epsCrackOnset-1)));
 
-	if(contactLine) Shop::GLDrawLine(b1->physicalParameters->dispSe3.position,b2->physicalParameters->dispSe3.position,lineColor);
-	if(dmgLabel){ Shop::GLDrawNum(BC->omega,0.5*(b1->physicalParameters->dispSe3.position+b2->physicalParameters->dispSe3.position),lineColor); }
-	else if(epsNLabel){ Shop::GLDrawNum(BC->epsN,0.5*(b1->physicalParameters->dispSe3.position+b2->physicalParameters->dispSe3.position),lineColor); }
+	if(contactLine) GLUtils::GLDrawLine(b1->physicalParameters->dispSe3.position,b2->physicalParameters->dispSe3.position,lineColor);
+	if(dmgLabel){ GLUtils::GLDrawNum(BC->omega,0.5*(b1->physicalParameters->dispSe3.position+b2->physicalParameters->dispSe3.position),lineColor); }
+	else if(epsNLabel){ GLUtils::GLDrawNum(BC->epsN,0.5*(b1->physicalParameters->dispSe3.position+b2->physicalParameters->dispSe3.position),lineColor); }
 
 	const Vector3r& cp=static_pointer_cast<SpheresContactGeometry>(i->interactionGeometry)->contactPoint;
 	if(epsT){
@@ -325,16 +326,16 @@
 		Real scale=.5*BC->equilibriumDist;
 		Vector3r dirShear=BC->epsT; dirShear.Normalize();
 		if(epsTAxes){
-			Shop::GLDrawLine(cp-Vector3r(scale,0,0),cp+Vector3r(scale,0,0));
-			Shop::GLDrawLine(cp-Vector3r(0,scale,0),cp+Vector3r(0,scale,0));
-			Shop::GLDrawLine(cp-Vector3r(0,0,scale),cp+Vector3r(0,0,scale));
+			GLUtils::GLDrawLine(cp-Vector3r(scale,0,0),cp+Vector3r(scale,0,0));
+			GLUtils::GLDrawLine(cp-Vector3r(0,scale,0),cp+Vector3r(0,scale,0));
+			GLUtils::GLDrawLine(cp-Vector3r(0,0,scale),cp+Vector3r(0,0,scale));
 		}
-		Shop::GLDrawArrow(cp,cp+dirShear*relShear*scale,Vector3r(1.,0.,0.));
-		Shop::GLDrawLine(cp+dirShear*relShear*scale,cp+dirShear*scale,Vector3r(.3,.3,.3));
+		GLUtils::GLDrawArrow(cp,cp+dirShear*relShear*scale,Vector3r(1.,0.,0.));
+		GLUtils::GLDrawLine(cp+dirShear*relShear*scale,cp+dirShear*scale,Vector3r(.3,.3,.3));
 
-		/* normal strain */ Shop::GLDrawArrow(cp,cp+BC->prevNormal*(BC->epsN/maxShear),Vector3r(0.,1.,0.));
+		/* normal strain */ GLUtils::GLDrawArrow(cp,cp+BC->prevNormal*(BC->epsN/maxShear),Vector3r(0.,1.,0.));
 	}
-	//if(normal) Shop::GLDrawArrow(cp,cp+BC->prevNormal*.5*BC->equilibriumDist,Vector3r(0.,1.,0.));
+	//if(normal) GLUtils::GLDrawArrow(cp,cp+BC->prevNormal*.5*BC->equilibriumDist,Vector3r(0.,1.,0.));
 }
 
 /********************** BrefcomDamageColorizer ****************************/

Modified: trunk/extra/clump/Shop.cpp
===================================================================
--- trunk/extra/clump/Shop.cpp	2008-09-17 21:48:17 UTC (rev 1516)
+++ trunk/extra/clump/Shop.cpp	2008-09-18 09:50:19 UTC (rev 1517)
@@ -1071,56 +1071,3 @@
 	{0.370512,0.415453,0.055970,0.010546},
 	{-1.,-1.,-1.,-1. } /* sentinel: non-positive radius */
 };
-#if 0
-Real Shop::ElasticWaveTimestepEstimate(shared_ptr<MetaBody> rootBody){
-	Real minDt=std::numeric_limits<Real>::infinity();
-	FOREACH(const shared_ptr<Body>& b, *rootBody->bodies){
-		shared_ptr<Sphere> sphere=dynamic_pointer_cast<Sphere>(b->geometricalModel);
-		shared_ptr<ElasticBodyParameters> elast=dynamic_pointer_cast<ElasticBodyParameters>(b->physicalParameters);
-		if(!sphere || !elast) continue;
-		Real density=elast->mass/((4./3.)*pow(Mathr::PI*sphere->radius,3));
-		Real thisDt=2*sphere->radius/sqrt(elast->young/density);
-		minDt=std::min(minDt,thisDt);
-	}
-	return minDt;
-}
-#endif
-
-void Shop::GLDrawLine(Vector3r from, Vector3r to, Vector3r color){
-	glEnable(GL_LIGHTING); glColor3v(color);
-	glBegin(GL_LINES); glVertex3v(from); glVertex3v(to); glEnd();
-}
-
-void Shop::GLDrawArrow(Vector3r from, Vector3r to, Vector3r color){
-	glEnable(GL_LIGHTING); glColor3v(color); qglviewer::Vec a(from[0],from[1],from[2]),b(to[0],to[1],to[2]); QGLViewer::drawArrow(a,b);	
-}
-
-void Shop::GLDrawNum(Real n, Vector3r pos, Vector3r color, unsigned precision){
-	ostringstream oss; oss<<setprecision(precision)<< /* "w="<< */ (double)n;
-	Shop::GLDrawText(oss.str(),pos,color);
-}
-
-void Shop::GLDrawText(std::string txt, Vector3r pos, Vector3r color){
-	glPushMatrix();
-	glTranslatev(pos);
-	glColor3(color[0],color[1],color[2]);
-	glRasterPos2i(0,0);
-	for(unsigned int i=0;i<txt.length();i++)
-		glutBitmapCharacter(GLUT_BITMAP_HELVETICA_12, txt[i]);
-	glPopMatrix();
-
-}
-Real Shop::PWaveTimeStep(shared_ptr<MetaBody> _rb){
-	shared_ptr<MetaBody> rb=_rb;
-	if(!rb)rb=Omega::instance().getRootBody();
-	Real dt=std::numeric_limits<Real>::infinity();
-	FOREACH(const shared_ptr<Body>& b, *rb->bodies){
-		if(!b->physicalParameters || !b->geometricalModel) continue;
-		shared_ptr<ElasticBodyParameters> ebp=dynamic_pointer_cast<ElasticBodyParameters>(b->physicalParameters);
-		shared_ptr<Sphere> s=dynamic_pointer_cast<Sphere>(b->geometricalModel);
-		if(!ebp || !s) continue;
-		Real density=ebp->mass/((4/3.)*Mathr::PI*pow(s->radius,3));
-		dt=min(dt,s->radius/sqrt(ebp->young/density));
-	}
-	return dt;
-}

Modified: trunk/extra/clump/Shop.hpp
===================================================================
--- trunk/extra/clump/Shop.hpp	2008-09-17 21:48:17 UTC (rev 1516)
+++ trunk/extra/clump/Shop.hpp	2008-09-18 09:50:19 UTC (rev 1517)
@@ -79,11 +79,6 @@
 		//! Save spheres in the current simulation into a text file
 		static void saveSpheresToFile(string fileName);
 
-		static void GLDrawLine(Vector3r from, Vector3r to, Vector3r color=Vector3r(1,1,1));
-		static void GLDrawArrow(Vector3r from, Vector3r to, Vector3r color=Vector3r(1,1,1));
-		static void GLDrawText(std::string text, Vector3r pos, Vector3r color=Vector3r(1,1,1));
-		static void GLDrawNum(Real n, Vector3r pos, Vector3r color=Vector3r(1,1,1), unsigned precision=3);
-
 		/*! Cache for class indices for physical actions (body external variables, Bex)
 		 *
 		 * It is necessary to populate the cache by calling initCache(); then supported

Modified: trunk/lib/opengl/GLUtils.hpp
===================================================================
--- trunk/lib/opengl/GLUtils.hpp	2008-09-17 21:48:17 UTC (rev 1516)
+++ trunk/lib/opengl/GLUtils.hpp	2008-09-18 09:50:19 UTC (rev 1517)
@@ -12,20 +12,20 @@
 
 struct GLUtils{
 
-	static void GLDrawArrow(Vector3r from, Vector3r to, Vector3r color){
+	static void GLDrawArrow(const Vector3r& from, const Vector3r& to, const Vector3r& color=Vector3r(1,1,1)){
 		glEnable(GL_LIGHTING); glColor3v(color); qglviewer::Vec a(from[0],from[1],from[2]),b(to[0],to[1],to[2]); QGLViewer::drawArrow(a,b);	
 	}
-	static void GLDrawLine(Vector3r from, Vector3r to, Vector3r color){
+	static void GLDrawLine(const Vector3r& from, const Vector3r& to, const Vector3r& color=Vector3r(1,1,1)){
 		glEnable(GL_LIGHTING); glColor3v(color);
 		glBegin(GL_LINES); glVertex3v(from); glVertex3v(to); glEnd();
 	}
 
-	static void GLDrawNum(Real n, Vector3r pos, Vector3r color, unsigned precision){
+	static void GLDrawNum(const Real& n, const Vector3r& pos, const Vector3r& color=Vector3r(1,1,1), unsigned precision=3){
 		std::ostringstream oss; oss<<std::setprecision(precision)<< /* "w="<< */ (double)n;
 		GLUtils::GLDrawText(oss.str(),pos,color);
 	}
 
-	static void GLDrawText(std::string txt, Vector3r pos, Vector3r color){
+	static void GLDrawText(const std::string& txt, const Vector3r& pos, const Vector3r& color=Vector3r(1,1,1)){
 		glPushMatrix();
 		glTranslatev(pos);
 		glColor3(color[0],color[1],color[2]);

Modified: trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.cpp
===================================================================
--- trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.cpp	2008-09-17 21:48:17 UTC (rev 1516)
+++ trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.cpp	2008-09-18 09:50:19 UTC (rev 1517)
@@ -9,6 +9,7 @@
  * (should be on the plane passing through origin and oriented with normal; not checked!)
  */
 void SpheresContactGeometry::setTgPlanePts(Vector3r p1new, Vector3r p2new){
+	assert(hasShear);
 	cp1rel=ori1.Conjugate()*rollPlanePtToSphere(p1new,d1,normal);
 	cp2rel=ori2.Conjugate()*rollPlanePtToSphere(p2new,d2,-normal);
 }
@@ -19,6 +20,7 @@
  * flip axis and the point would project on other side of the tangent plane piece.
  */
 void SpheresContactGeometry::relocateContactPoints(){
+	assert(hasShear);
 	Vector3r p1=contPtInTgPlane1(), p2=contPtInTgPlane2();
 	Vector3r midPt=.5*(p1+p2);
 	if((p1.SquaredLength()>4*d1 || p2.SquaredLength()>4*d2) && midPt.SquaredLength()>.5*min(d1,d2)){
@@ -29,15 +31,17 @@
 }
 
 /*! Perform slip of the projected contact points so that their distance becomes equal (or remains smaller) than the given one.
- * TODO: not yet tested
+ * The slipped distance is returned.
  */
-void SpheresContactGeometry::slipToDistIfNeeded(Real dist){
+Real SpheresContactGeometry::slipToDisplacementTMax(Real displacementTMax){
+	assert(hasShear);
+	assert(displacementTMax>Mathr::ZERO_TOLERANCE);
 	Vector3r p1=contPtInTgPlane1(), p2=contPtInTgPlane2();
 	Real currDist=(p2-p1).Length();
-	if(currDist<dist) return; // close enough, no slip needed
-	assert(dist>Mathr::ZERO_TOLERANCE);
-	Vector3r diff=.5*(currDist/dist-1)*(p2-p1);
+	if(currDist<displacementTMax) return 0; // close enough, no slip needed
+	Vector3r diff=.5*(currDist/displacementTMax-1)*(p2-p1);
 	setTgPlanePts(p1+diff,p2-diff);
+	return 2*diff.Length();
 }
 
 /*! Project point from sphere surface to tangent plane,

Modified: trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp
===================================================================
--- trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp	2008-09-17 21:48:17 UTC (rev 1516)
+++ trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp	2008-09-18 09:50:19 UTC (rev 1517)
@@ -30,7 +30,7 @@
 			contactPoint;
 		Real radius1,radius2,penetrationDepth;
 
-		bool exactRot; // whether the exact rotation code is being used -- following fields are needed for that
+		bool hasShear; // whether the exact rotation code is being used -- following fields are needed for that
 		//! positions and orientations of both spheres -- must be updated at every iteration
 		Vector3r pos1, pos2; Quaternionr ori1, ori2;
 		/*! Orientation of the contact point relative to each sphere-local coordinates.
@@ -61,18 +61,21 @@
 		Vector3r displacementT(bool relocate=true){ return contPtInTgPlane2()-contPtInTgPlane1();}
 		Vector3r epsT(){return displacementT()*(1./d0);}
 	
-		void slipToDistIfNeeded(Real slip);
+		Real slipToDisplacementTMax(Real displacementTMax);
+		//! slip to epsTMax if current epsT is greater; return the relative slip magnitude
+		Real slipToEpsTMax(Real epsTMax){return (1/d0)*slipToDisplacementTMax(epsTMax*d0);}
+
 		void relocateContactPoints();
 
-		SpheresContactGeometry():InteractionGeometry(),contactPoint(Vector3r::ZERO),radius1(0),radius2(0),exactRot(false){createIndex();}
+		SpheresContactGeometry():InteractionGeometry(),contactPoint(Vector3r::ZERO),radius1(0),radius2(0),hasShear(false){createIndex();}
 		virtual ~SpheresContactGeometry(){};
 	protected :
 		virtual void registerAttributes(){
 			REGISTER_ATTRIBUTE(radius1);
 			REGISTER_ATTRIBUTE(radius2);
 			REGISTER_ATTRIBUTE(contactPoint); // to allow access from python
-			// exactRot
-			REGISTER_ATTRIBUTE(exactRot);
+			// hasShear
+			REGISTER_ATTRIBUTE(hasShear);
 			REGISTER_ATTRIBUTE(pos1);
 			REGISTER_ATTRIBUTE(pos2);
 			REGISTER_ATTRIBUTE(ori1);

Modified: trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp
===================================================================
--- trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp	2008-09-17 21:48:17 UTC (rev 1516)
+++ trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp	2008-09-18 09:50:19 UTC (rev 1517)
@@ -24,7 +24,7 @@
 void InteractingSphere2InteractingSphere4SpheresContactGeometry::registerAttributes()
 {	
 	REGISTER_ATTRIBUTE(interactionDetectionFactor);
-	REGISTER_ATTRIBUTE(exactRot);
+	REGISTER_ATTRIBUTE(hasShear);
 }
 
 bool InteractingSphere2InteractingSphere4SpheresContactGeometry::go(	const shared_ptr<InteractingGeometry>& cm1,
@@ -51,8 +51,8 @@
 		scm->radius1 = s1->radius;
 		scm->radius2 = s2->radius;
 		if (!c->interactionGeometry) c->interactionGeometry = scm;
-		if(exactRot){
-			scm->exactRot=true;
+		if(hasShear){
+			scm->hasShear=true;
 			scm->pos1=se31.position; scm->pos2=se32.position;
 			scm->ori1=se31.orientation; scm->ori2=se32.orientation;
 			if(c->isNew){
@@ -64,8 +64,13 @@
 				scm->cp2rel.Align(Vector3r::UNIT_X,se32.orientation.Conjugate()*(-normal));
 				scm->cp1rel.Normalize(); scm->cp2rel.Normalize();
 			}
-			// FIXME: temporary, testing only!
-			if((Omega::instance().getCurrentIteration()%500)==0) scm->relocateContactPoints();
+			// testing only
+			#if 0
+			if((Omega::instance().getCurrentIteration()%10000)==0) scm->relocateContactPoints();
+			if((Omega::instance().getCurrentIteration()%10000)==0) {
+				Real slip=scm->slipToEpsNMax(1.); if(slip>0) cerr<<"SLIP by ??_N "<<slip<<" ? ?_N="<<scm->epsN()<<endl;
+			}
+			#endif
 		}
 		return true;
 	} else return false;

Modified: trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.hpp
===================================================================
--- trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.hpp	2008-09-17 21:48:17 UTC (rev 1516)
+++ trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.hpp	2008-09-18 09:50:19 UTC (rev 1517)
@@ -26,8 +26,8 @@
 		 * @note This parameter is functionally coupled with InteractinSphere2AABB::aabbEnlargeFactor,
 		 * which will create larger bounding boxes and should be of the same value. */
 		double interactionDetectionFactor;
-		/*! Whether we create SpheresContactGeometry with data necessary for exact rotation computation */
-		bool exactRot;
+		/*! Whether we create SpheresContactGeometry with data necessary for (exact) shear computation */
+		bool hasShear;
 
 	REGISTER_CLASS_NAME(InteractingSphere2InteractingSphere4SpheresContactGeometry);
 	REGISTER_BASE_CLASS_NAME(InteractionGeometryEngineUnit);

Modified: trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp
===================================================================
--- trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp	2008-09-17 21:48:17 UTC (rev 1516)
+++ trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp	2008-09-18 09:50:19 UTC (rev 1517)
@@ -74,7 +74,7 @@
 		#endif
 	}
 
-	if(sc->exactRot){
+	if(sc->hasShear){
 		GLUtils::GLDrawLine(sc->pos1,sc->pos2,Vector3r(.5,.5,.5));
 		// sphere center to point on the sphere
 		//GLUtils::GLDrawText("[1]",sc->pos1,Vector3r(1,1,1)); GLUtils::GLDrawText("[2]",sc->pos2,Vector3r(1,1,1));


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at arcig.cz  Thu Sep 18 18:56:27 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Thu, 18 Sep 2008 18:56:27 +0200
Subject: [deprecated list] [Yade-dev] reason of failing dynamic_casts
Message-ID: <48D2883B.6070801@arcig.cz>

Janek,

I finally found why dynamic_cast was failing on NormalShearInteraction
(remember? We had to put static_cast in GlobalStiffnessCounter just
before the .12 release). Well, the point is that every class that can be
cast to must have at least one virtual method defined in the .cpp file
(hence in the shared object); I assume that otherwise typeinfo is not
put at all into the plugin during linking or something like that, and
casting fails at runtime. If you have some idea on the real cause of
this, let me know.

I discovered this with SpheresContactGeometry that I changed. The
solution was to put at least the empty virtual descructor to the .cpp files.

I reverted the static_cast in GlobalStiffnessCounter and it works fine.

Regards, Vaclav



_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Fri Sep 19 12:48:17 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Fri, 19 Sep 2008 12:48:17 +0200
Subject: [deprecated list] [Yade-dev] significat timestep improvement with
	non-incremental	shear computation
Message-ID: <48D38371.3030804@arcig.cz>

Bruno,

I compared today results of old brefcom that used incremental
computation of epsN (roughly the same as in ElasticContactLaw) with new
version that does that based on original contact point position (see in
SpheresContactGeometry docs). Before, I was using timestep
.2*PWaveTimeStep, now I got to 1*PWaveTimeStep with only small change in
the strain-stress diagram (the simulation didn't explode). Time per
iteration is a bit larger (by about 5-10%) due to more complicated
calculations involved. Let me know if you would like to try, adapting
ElasticContactLaw would be quite easy.

Vaclav

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Fri Sep 19 15:26:28 2008
From: eudoxos at arcig.cz (Vaclav Smilauer)
Date: Fri, 19 Sep 2008 15:26:28 +0200
Subject: [deprecated list] [Yade-dev] significat timestep improvement
 with non-incremental shear computation
In-Reply-To: <48D393B1.5040400@hmg.inpg.fr>
References: <48D38371.3030804@arcig.cz> <48D393B1.5040400@hmg.inpg.fr>
Message-ID: <48D3A884.7010407@arcig.cz>



Bruno Chareyre napsal(a):
> V?clav ?milauer a ?crit :
>> Bruno,
>>
>> I compared today results of old brefcom that used incremental
>> computation of epsN (roughly the same as in ElasticContactLaw)
> I guess you meant epsS? Because in ElasticContactLaw, Un is not computed 
> incrementally, only Us is.
>>  with new
>> version that does that based on original contact point position (see in
>> SpheresContactGeometry docs). Before, I was using timestep
>> .2*PWaveTimeStep, now I got to 1*PWaveTimeStep with only small change in
>> the strain-stress diagram (the simulation didn't explode). Time per
>> iteration is a bit larger (by about 5-10%) due to more complicated
>> calculations involved. Let me know if you would like to try, adapting
>> ElasticContactLaw would be quite easy.
>>
>>   
> Unfortunately, it is completely impossible to do that in 
> ElasticContactLaw without changing fundamentaly the physics behind.
> 
> Simple example in 1D :
> 1st scenario : relative displacement us : resultant force fs = 
> -fn*tan(phi) (provided the friction threshold was reached)
> 2nd scenario : relative displacement 2*us, then another displacement -us 
> : resultant force fs = fn*tan(phi) (sign changed)
> 
> You have the same start/end points in both cases but the forces are of 
> opposite sign, because the force depends on the history of the motion. 
> You will loose history if you don't use an incremental form.
> What you suggest is possible only in a purely elastic problem.

My algorithm tracks the original contact point, but it will be displaced 
if there is plastic slip (Coulomb friction); therefore it ends up with 
the same result as you suggested, provided that the -1*us displacement 
leads to slipping. (I use something similar in brefcom as well; and it 
works)

> Another thing is i'm a bit surprised you could change the timestep while 
> keeping the same stress-strain graph, since this graph is defining - 
> alone - the critical timestep in your problem. Eigenfrequencies are 
> physical quantities that don't depend on the implementation details, 
> just stiffness and mass.

With incremental code, there are 2 factors worsening the accuracy: (1) 
the algorithm itself is approximate, (2) errors accumulate. In the 
non-incremental code, the algorithm is geometrically exact and errors 
don't accumulate.

Therefore I think it is possible that the simulation is more stable with 
the new code.

Vaclav


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From sj2001 at yandex.ru  Fri Sep 19 19:33:06 2008
From: sj2001 at yandex.ru (sega)
Date: Fri, 19 Sep 2008 21:33:06 +0400
Subject: [deprecated list] [Yade-dev] new algorithm for facets
In-Reply-To: <48D219FA.6000803@arcig.cz>
References: <200809132208.35739.sj2001@yandex.ru> <48D219FA.6000803@arcig.cz>
Message-ID: <200809192133.06549.sj2001@yandex.ru>

> Hi, I think that is a great idea. For the tests you run, there will be
> not much difference since there is relatively few edges, but there can
> be big influence of the doubled reaction on e.g. triangulated surface
> with a lot of triangles to model the geometry details. 

In my opinion, these geometry details must be very tiny. 
In most cases, the practical effect of the doubled reaction will negligibly small.
But I run additional test with tiny mesh then the size of facets considerably less sphere's size 
and got the same result. I have updated figs on wiki:
http://images3.wikia.nocookie.net/yade/images//0/00/Rod-total-force.png
http://images2.wikia.nocookie.net/yade/images//e/e6/Rod-tiny.jpg
> > http://images4.wikia.nocookie.net/yade/images//6/68/Rod-coarse.jpeg
> > http://images1.wikia.nocookie.net/yade/images//6/69/Rod-fine.jpeg

> I would suggest
>adding some possiblit (flag?) to turn on/off reactions on each
>particular edge and vertes - this way, there could an algorithm that
>would enable only one of the coinciding edges etc. Does that make sense?

I think about it. This will be a half solution. See fig: 
            O O 
             |  /|
       ====*-------
where === is a one facet, ---- is a other facet, * is a edge, O is a particle, | is a contact.
If contact with edge will be enabled only with === facet, then this contact will be enabled 
_and_ with contact with --- facet, but in this case, contact with the edge will be mistake.

-- 
Best regards, Sergei D.

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Sat Sep 20 09:20:09 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Sat, 20 Sep 2008 09:20:09 +0200
Subject: [deprecated list] [Yade-dev] new algorithm for facets
In-Reply-To: <200809192133.06549.sj2001@yandex.ru>
References: <200809132208.35739.sj2001@yandex.ru> <48D219FA.6000803@arcig.cz>
	<200809192133.06549.sj2001@yandex.ru>
Message-ID: <48D4A429.4060905@arcig.cz>


> In my opinion, these geometry details must be very tiny. 
> In most cases, the practical effect of the doubled reaction will negligibly small.
> But I run additional test with tiny mesh then the size of facets considerably less sphere's size 
> and got the same result. I have updated figs on wiki:
> http://images3.wikia.nocookie.net/yade/images//0/00/Rod-total-force.png
> http://images2.wikia.nocookie.net/yade/images//e/e6/Rod-tiny.jpg
>   
That seems very nice. Could you commit the code? The best would be, of
course, if you put this example with refined mesh somewhere into
scripts/ (including STL files, if that is what you use) or examples/. I
am looking forward to experimenting with it.

Regards, Vaclav
>
>> I would suggest
>> adding some possiblit (flag?) to turn on/off reactions on each
>> particular edge and vertes - this way, there could an algorithm that
>> would enable only one of the coinciding edges etc. Does that make sense?
>>     
>
> I think about it. This will be a half solution. See fig: 
>             O O 
>              |  /|
>        ====*-------
> where === is a one facet, ---- is a other facet, * is a edge, O is a particle, | is a contact.
> If contact with edge will be enabled only with === facet, then this contact will be enabled 
> _and_ with contact with --- facet, but in this case, contact with the edge will be mistake.
>
>   


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From sega at mail.berlios.de  Sat Sep 20 10:48:40 2008
From: sega at mail.berlios.de (sega at BerliOS)
Date: Sat, 20 Sep 2008 10:48:40 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1519 - in trunk:
	examples	examples/rod_penetration pkg/common
	pkg/common/Engine/DeusExMachina	pkg/common/Engine/StandAloneEngine
Message-ID: <200809200848.m8K8meLj019666@sheep.berlios.de>

Author: sega
Date: 2008-09-20 10:47:19 +0200 (Sat, 20 Sep 2008)
New Revision: 1519

Added:
   trunk/examples/rod_penetration/
   trunk/examples/rod_penetration/model.py
   trunk/examples/rod_penetration/rod-coarse.stl
   trunk/examples/rod_penetration/rod-fine.stl
   trunk/examples/rod_penetration/rod-tiny.stl
   trunk/pkg/common/Engine/StandAloneEngine/ResetPositionEngine.cpp
   trunk/pkg/common/Engine/StandAloneEngine/ResetPositionEngine.hpp
Removed:
   trunk/pkg/common/Engine/DeusExMachina/ResetPositionEngine.cpp
   trunk/pkg/common/Engine/DeusExMachina/ResetPositionEngine.hpp
Modified:
   trunk/pkg/common/SConscript
Log:
1. ResetPositionEngine is now inherited from PeriodicEngine.
2. Add examples/rod_penetration model and geometry.


Added: trunk/examples/rod_penetration/model.py
===================================================================
--- trunk/examples/rod_penetration/model.py	2008-09-18 11:16:48 UTC (rev 1518)
+++ trunk/examples/rod_penetration/model.py	2008-09-20 08:47:19 UTC (rev 1519)
@@ -0,0 +1,92 @@
+#!/usr/local/bin/yade-trunk -x
+# -*- encoding=utf-8 -*-
+
+from yade import utils
+import random
+
+## PhysicalParameters 
+Young = 15e6
+Poisson = 0.2
+
+## Variant of mesh
+mesh = 'coarse'
+#mesh = 'fine'
+#mesh = 'tiny'
+
+## Omega
+o=Omega() 
+
+## Import geometry 
+rod = utils.import_stl_geometry('rod-'+mesh+'.stl',wire=True,young=Young,poisson=Poisson)
+shrinkFactor=0.005
+
+# Spheres
+sphereRadius = 0.01
+nbSpheres = (32,11,32) 
+print "Creating %d spheres..."%(nbSpheres[0]*nbSpheres[1]*nbSpheres[2]),
+for i in xrange(nbSpheres[0]):
+    for j in xrange(nbSpheres[1]):
+		for k in xrange(nbSpheres[2]):
+			x = (i*2 - nbSpheres[0])*sphereRadius*1.1+sphereRadius*random.uniform(-0.1,0.1)
+			y = -j*sphereRadius*2.2-0.01
+			z = (k*2 - nbSpheres[2])*sphereRadius*1.1+sphereRadius*random.uniform(-0.1,0.1)
+			r = random.uniform(sphereRadius,sphereRadius*0.9)
+			dynamic = True
+			color=[0.51,0.52,0.4]
+			if (i==0 or i==nbSpheres[0]-1 or j==nbSpheres[1]-1 or k==0 or k==nbSpheres[2]-1): 
+				dynamic = False
+				color=[0.21,0.22,0.1]
+			o.bodies.append(utils.sphere([x,y,z],r,young=Young,poisson=Poisson,density=2400,color=color,dynamic=dynamic))
+print "done\n"
+
+## Estimate time step
+#o.dt=utils.PWaveTimeStep()
+o.dt=0.0001
+
+## Initializers 
+o.initializers=[
+	StandAloneEngine('PhysicalActionContainerInitializer'),
+	MetaEngine('BoundingVolumeMetaEngine',[
+		EngineUnit('InteractingSphere2AABB'),
+		EngineUnit('InteractingFacet2AABB'),
+		EngineUnit('MetaInteractingGeometry2AABB')])
+	]
+
+## Engines 
+o.engines=[
+	StandAloneEngine('PhysicalActionContainerReseter'),
+	MetaEngine('BoundingVolumeMetaEngine',[
+		EngineUnit('InteractingSphere2AABB'),
+		EngineUnit('InteractingFacet2AABB'),
+		EngineUnit('MetaInteractingGeometry2AABB')
+	]),
+	StandAloneEngine('PersistentSAPCollider'),
+	MetaEngine('InteractionGeometryMetaEngine',[
+		EngineUnit('InteractingSphere2InteractingSphere4SpheresContactGeometry'),
+		EngineUnit('InteractingFacet2InteractingSphere4SpheresContactGeometry',{'shrinkFactor':shrinkFactor})
+	]),
+	MetaEngine('InteractionPhysicsMetaEngine',[EngineUnit('MacroMicroElasticRelationships')]),
+	StandAloneEngine('ElasticContactLaw'),
+	DeusExMachina('GravityEngine',{'gravity':[0,-9.81,0]}),
+	DeusExMachina('NewtonsDampedLaw',{'damping':0.3}),
+	## Apply kinematics to rod
+	DeusExMachina('TranslationEngine',{'subscribedBodies':range(rod),'translationAxis':[0,-1,0],'velocity':0.075}),
+	## Save force on rod
+	StandAloneEngine('ForceRecorder',{'startId':0,'endId':rod-1,'outputFile':'force-'+mesh+'.dat','interval':50}),	
+	## Save positions
+	StandAloneEngine('SQLiteRecorder',{'recorders':['se3'],'dbFile':'positions-'+mesh+'.sqlite','iterPeriod':100})
+
+]
+
+o.save('/tmp/scene.xml.bz2');
+
+import sys,time
+
+print "Start simulation: " + mesh
+nbIter=10000
+for t in xrange(2):
+	start=time.time();o.run(nbIter);o.wait();finish=time.time() 
+	speed=nbIter/(finish-start); print '%g iter/sec\n'%speed
+print "FINISH"
+quit()
+

Added: trunk/examples/rod_penetration/rod-coarse.stl
===================================================================
(Binary files differ)


Property changes on: trunk/examples/rod_penetration/rod-coarse.stl
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/examples/rod_penetration/rod-fine.stl
===================================================================
(Binary files differ)


Property changes on: trunk/examples/rod_penetration/rod-fine.stl
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/examples/rod_penetration/rod-tiny.stl
===================================================================
(Binary files differ)


Property changes on: trunk/examples/rod_penetration/rod-tiny.stl
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Deleted: trunk/pkg/common/Engine/DeusExMachina/ResetPositionEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/ResetPositionEngine.cpp	2008-09-18 11:16:48 UTC (rev 1518)
+++ trunk/pkg/common/Engine/DeusExMachina/ResetPositionEngine.cpp	2008-09-20 08:47:19 UTC (rev 1519)
@@ -1,108 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2008 by Sergei Dorofeenko				 *
-*  sega at users.berlios.de                                                 *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include"ResetPositionEngine.hpp"
-#include<yade/core/MetaBody.hpp>
-#include<yade/pkg-common/ParticleParameters.hpp>
-#include<boost/foreach.hpp>
-
-CREATE_LOGGER(ResetPositionEngine);
-
-ResetPositionEngine::ResetPositionEngine(){
-		Y_min=-1;
-		interval=0;
-		ini_pos.clear();
-		initial_positions.clear();
-		subscrBodies.clear();
-		fileName="";
-		first=true;
-		onlyDynamic=false;
-}
-
-void ResetPositionEngine::postProcessAttributes(bool deserializing){}
-
-void ResetPositionEngine::registerAttributes(){
-	DeusExMachina::registerAttributes(); // for subscribedBodies
-	REGISTER_ATTRIBUTE(interval);
-	REGISTER_ATTRIBUTE(onlyDynamic);
-	REGISTER_ATTRIBUTE(Y_min);
-	REGISTER_ATTRIBUTE(initial_positions);
-	REGISTER_ATTRIBUTE(fileName);
-}
-
-
-void ResetPositionEngine::applyCondition(MetaBody * ncb)
-{
-	if (first) { initialize(ncb); return; }
-
-	shared_ptr<BodyContainer>& bodies = ncb->bodies;
-	for(int i=0,e=subscrBodies.size(); i<e; ++i)
-	{
-			ParticleParameters* pp = YADE_CAST<ParticleParameters*>((*bodies)[subscrBodies[i]]->physicalParameters.get());
-			if (pp->se3.position[1]<Y_min)
-			{
-					pp->se3.position = ini_pos[i];
-					pp->velocity = Vector3r(0,0,0);
-			}
-	}
-}
-
-void ResetPositionEngine::initialize(MetaBody * ncb)
-{
-	first=false;
-	if (onlyDynamic)
-	{
-		FOREACH(shared_ptr<Body> b, *ncb->bodies) { if(b->isDynamic) subscrBodies.push_back(b->getId()); }
-	}
-	else
-		subscrBodies.assign(subscribedBodies.begin(),subscribedBodies.end());
-
-	if (fileName=="")
-	{ 
-		if (initial_positions.size()==0) 	
-		{ // initialize positions from bodies se3
-			LOG_INFO("Initialize positions from bodies se3");
-			initial_positions.resize(subscrBodies.size());
-			shared_ptr<BodyContainer>& bodies = ncb->bodies;
-			for(int i=0,e=subscrBodies.size(); i<e; ++i)
-				initial_positions[i]=(*bodies)[subscrBodies[i]]->physicalParameters->se3.position;
-		}
-		ini_pos.assign(initial_positions.begin(),initial_positions.end());
-		return;
-	}
-	
-	std::ifstream is(fileName.c_str());
-	if (is) 
-	{// reading positions from file 
-		LOG_INFO("Reading positions from file: " << fileName);
-		ini_pos.resize(subscrBodies.size());
-		for(int i=0,e=subscrBodies.size(); i<e && !is.eof(); ++i)
-			is >> ini_pos[i][0] >> ini_pos[i][1] >> ini_pos[i][2];
-		return;
-	}
-	
-	// initialize positions form bodies se3 if need and export to file
-	if (initial_positions.size()==0)
-	{
-		LOG_INFO("Initialize positions from bodies se3");
-		ini_pos.resize(subscrBodies.size());
-		shared_ptr<BodyContainer>& bodies = ncb->bodies;
-		for(int i=0,e=subscrBodies.size(); i<e; ++i)
-			ini_pos[i]=(*bodies)[subscrBodies[i]]->physicalParameters->se3.position;
-	}
-	else ini_pos.swap(initial_positions);
-	std::ofstream os(fileName.c_str());
-	if (!os) {
-		LOG_ERROR("Can't open file to export positions: "<<fileName<<"!");
-		return;
-	}
-	LOG_INFO("Export positions to file: "<<fileName);
-	for(int i=0,e=subscrBodies.size(); i<e; ++i)
-		os << ini_pos[i][0]<< '\t' << ini_pos[i][1]<< '\t' << ini_pos[i][2]<< std::endl;
-}
-YADE_PLUGIN();

Deleted: trunk/pkg/common/Engine/DeusExMachina/ResetPositionEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/ResetPositionEngine.hpp	2008-09-18 11:16:48 UTC (rev 1518)
+++ trunk/pkg/common/Engine/DeusExMachina/ResetPositionEngine.hpp	2008-09-20 08:47:19 UTC (rev 1519)
@@ -1,53 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2008 by Sergei Dorofeenko				 *
-*  sega at users.berlios.de                                                 *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef RESETPOSITONENGINE_HPP
-#define RESETPOSITONENGINE_HPP
-
-#include<yade/core/DeusExMachina.hpp>
-#include <Wm3Vector3.h>
-#include<yade/lib-base/yadeWm3.hpp>
-
-/*! \brief Reset the spatial position of all subscribed bodies to the desired value. 
- *
- *
- * */
-class ResetPositionEngine : public DeusExMachina {
-	public:
-		void applyCondition(MetaBody*);
-		bool isActivated()
-				{return ((Omega::instance().getCurrentIteration() % interval == 0));}
-		ResetPositionEngine();
-
-		int interval;
-		Real Y_min;
-		/// \brief import/export desired positions from file.
-		/// If fileName is set and initial_positions are not set, then positions are read from file.
-		/// If fileName is not set and initial_positions are set, then positions are read bodies se3
-		std::string fileName; 
-		std::vector<Vector3r> initial_positions; // for serialization
-		/// if true ResetPositionEngine is active for all isDynamic bodies 
-		bool onlyDynamic;
-		
-		DECLARE_LOGGER;
-	protected:
-		virtual void postProcessAttributes(bool);
-		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(ResetPositionEngine);
-	REGISTER_BASE_CLASS_NAME(DeusExMachina);
-	private:
-		std::vector<Vector3r> ini_pos;
-		std::vector<long int> subscrBodies;
-		bool first;
-		void initialize(MetaBody * ncb);
-};
-
-REGISTER_SERIALIZABLE(ResetPositionEngine,false);
-
-#endif //  RESETPOSITONENGINE_HPP
-

Copied: trunk/pkg/common/Engine/StandAloneEngine/ResetPositionEngine.cpp (from rev 1518, trunk/pkg/common/Engine/DeusExMachina/ResetPositionEngine.cpp)
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/ResetPositionEngine.cpp	2008-09-18 11:16:48 UTC (rev 1518)
+++ trunk/pkg/common/Engine/StandAloneEngine/ResetPositionEngine.cpp	2008-09-20 08:47:19 UTC (rev 1519)
@@ -0,0 +1,98 @@
+/*************************************************************************
+*  Copyright (C) 2008 by Sergei Dorofeenko				 *
+*  sega at users.berlios.de                                                 *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#include"ResetPositionEngine.hpp"
+#include<yade/core/MetaBody.hpp>
+#include<yade/pkg-common/ParticleParameters.hpp>
+#include<boost/foreach.hpp>
+
+CREATE_LOGGER(ResetPositionEngine);
+
+ResetPositionEngine::ResetPositionEngine(){
+		Y_min=-1;
+		ini_pos.clear();
+		initial_positions.clear();
+		subscribedBodies.clear();
+		fileName="";
+		first=true;
+}
+
+void ResetPositionEngine::postProcessAttributes(bool deserializing){}
+
+void ResetPositionEngine::registerAttributes(){
+	PeriodicEngine::registerAttributes(); // for subscribedBodies
+	REGISTER_ATTRIBUTE(Y_min);
+	REGISTER_ATTRIBUTE(subscribedBodies);
+	REGISTER_ATTRIBUTE(initial_positions);
+	REGISTER_ATTRIBUTE(fileName);
+}
+
+
+void ResetPositionEngine::action(MetaBody * ncb)
+{
+	if (first) { initialize(ncb); return; }
+
+	shared_ptr<BodyContainer>& bodies = ncb->bodies;
+	for(int i=0,e=subscribedBodies.size(); i<e; ++i)
+	{
+			ParticleParameters* pp = YADE_CAST<ParticleParameters*>((*bodies)[subscribedBodies[i]]->physicalParameters.get());
+			if (pp->se3.position[1]<Y_min)
+			{
+					pp->se3.position = ini_pos[i];
+					pp->velocity = Vector3r(0,0,0);
+			}
+	}
+}
+
+void ResetPositionEngine::initialize(MetaBody * ncb)
+{
+	first=false;
+	if (fileName=="")
+	{ 
+		if (initial_positions.size()==0) 	
+		{ // initialize positions from bodies se3
+			LOG_INFO("Initialize positions from bodies se3");
+			initial_positions.resize(subscribedBodies.size());
+			shared_ptr<BodyContainer>& bodies = ncb->bodies;
+			for(int i=0,e=subscribedBodies.size(); i<e; ++i)
+				initial_positions[i]=(*bodies)[subscribedBodies[i]]->physicalParameters->se3.position;
+		}
+		ini_pos.assign(initial_positions.begin(),initial_positions.end());
+		return;
+	}
+	
+	std::ifstream is(fileName.c_str());
+	if (is) 
+	{// reading positions from file 
+		LOG_INFO("Reading positions from file: " << fileName);
+		ini_pos.resize(subscribedBodies.size());
+		for(int i=0,e=subscribedBodies.size(); i<e && !is.eof(); ++i)
+			is >> ini_pos[i][0] >> ini_pos[i][1] >> ini_pos[i][2];
+		return;
+	}
+	
+	// initialize positions form bodies se3 if need and export to file
+	if (initial_positions.size()==0)
+	{
+		LOG_INFO("Initialize positions from bodies se3");
+		ini_pos.resize(subscribedBodies.size());
+		shared_ptr<BodyContainer>& bodies = ncb->bodies;
+		for(int i=0,e=subscribedBodies.size(); i<e; ++i)
+			ini_pos[i]=(*bodies)[subscribedBodies[i]]->physicalParameters->se3.position;
+	}
+	else ini_pos.swap(initial_positions);
+	std::ofstream os(fileName.c_str());
+	if (!os) {
+		LOG_ERROR("Can't open file to export positions: "<<fileName<<"!");
+		return;
+	}
+	LOG_INFO("Export positions to file: "<<fileName);
+	for(int i=0,e=subscribedBodies.size(); i<e; ++i)
+		os << ini_pos[i][0]<< '\t' << ini_pos[i][1]<< '\t' << ini_pos[i][2]<< std::endl;
+}
+YADE_PLUGIN();


Property changes on: trunk/pkg/common/Engine/StandAloneEngine/ResetPositionEngine.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/pkg/common/Engine/StandAloneEngine/ResetPositionEngine.hpp (from rev 1518, trunk/pkg/common/Engine/DeusExMachina/ResetPositionEngine.hpp)
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/ResetPositionEngine.hpp	2008-09-18 11:16:48 UTC (rev 1518)
+++ trunk/pkg/common/Engine/StandAloneEngine/ResetPositionEngine.hpp	2008-09-20 08:47:19 UTC (rev 1519)
@@ -0,0 +1,49 @@
+/*************************************************************************
+*  Copyright (C) 2008 by Sergei Dorofeenko				 *
+*  sega at users.berlios.de                                                 *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#ifndef RESETPOSITONENGINE_HPP
+#define RESETPOSITONENGINE_HPP
+
+#include<yade/pkg-common/PeriodicEngines.hpp>
+#include <Wm3Vector3.h>
+#include<yade/lib-base/yadeWm3.hpp>
+
+/*! \brief Reset the spatial position of all subscribed bodies to the desired value. 
+ *
+ *
+ * */
+class ResetPositionEngine : public PeriodicEngine {
+	public:
+		void action(MetaBody*);
+		bool isActivated() {if (first) return true; else return PeriodicEngine::isActivated();}
+		ResetPositionEngine();
+
+		Real Y_min;
+		/// \brief import/export desired positions from file.
+		/// If fileName is set and initial_positions are not set, then positions are read from file.
+		/// If fileName is not set and initial_positions are set, then positions are read bodies se3
+		std::string fileName; 
+		std::vector< int >   subscribedBodies;
+		std::vector<Vector3r> initial_positions; // for serialization
+		
+		DECLARE_LOGGER;
+	protected:
+		virtual void postProcessAttributes(bool);
+		virtual void registerAttributes();
+	REGISTER_CLASS_NAME(ResetPositionEngine);
+	REGISTER_BASE_CLASS_NAME(PeriodicEngine);
+	private:
+		std::vector<Vector3r> ini_pos;
+		bool first;
+		void initialize(MetaBody * ncb);
+};
+
+REGISTER_SERIALIZABLE(ResetPositionEngine,false);
+
+#endif //  RESETPOSITONENGINE_HPP
+


Property changes on: trunk/pkg/common/Engine/StandAloneEngine/ResetPositionEngine.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Modified: trunk/pkg/common/SConscript
===================================================================
--- trunk/pkg/common/SConscript	2008-09-18 11:16:48 UTC (rev 1518)
+++ trunk/pkg/common/SConscript	2008-09-20 08:47:19 UTC (rev 1519)
@@ -63,7 +63,7 @@
 	env.SharedLibrary('DisplacementEngine',['Engine/DeusExMachina/DisplacementEngine.cpp']),
 	env.SharedLibrary('FixedPositionEngine',['Engine/DeusExMachina/FixedPositionEngine.cpp']),
 	env.SharedLibrary('FixedOrientationEngine',['Engine/DeusExMachina/FixedOrientationEngine.cpp']),
-	env.SharedLibrary('ResetPositionEngine',['Engine/DeusExMachina/ResetPositionEngine.cpp'],
+	env.SharedLibrary('ResetPositionEngine',['Engine/StandAloneEngine/ResetPositionEngine.cpp'],
 		LIBS=env['LIBS']+['ParticleParameters']),
 	env.SharedLibrary('FilterEngine',['Engine/FilterEngine/FilterEngine.cpp']),
 	env.SharedLibrary('ColorizedLayerFilter',['Engine/FilterEngine/ColorizedLayerFilter.cpp'],


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From sj2001 at yandex.ru  Sat Sep 20 10:49:54 2008
From: sj2001 at yandex.ru (sega)
Date: Sat, 20 Sep 2008 12:49:54 +0400
Subject: [deprecated list] [Yade-dev] new algorithm for facets
In-Reply-To: <48D4A429.4060905@arcig.cz>
References: <200809132208.35739.sj2001@yandex.ru>
	<200809192133.06549.sj2001@yandex.ru> <48D4A429.4060905@arcig.cz>
Message-ID: <200809201249.55167.sj2001@yandex.ru>

> That seems very nice. Could you commit the code? The best would be, of
> course, if you put this example with refined mesh somewhere into
> scripts/ (including STL files, if that is what you use) or examples/. I
> am looking forward to experimenting with it.

I have commited the code in r1518 and put examples in r1519.

-- 
Best regards, Sergei D.

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From cosurgi at mail.berlios.de  Sat Sep 20 22:11:28 2008
From: cosurgi at mail.berlios.de (cosurgi at BerliOS)
Date: Sat, 20 Sep 2008 22:11:28 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1520 - in trunk:
	core	pkg/dem/Engine/StandAloneEngine
Message-ID: <200809202011.m8KKBS5K000590@sheep.berlios.de>

Author: cosurgi
Date: 2008-09-20 22:11:27 +0200 (Sat, 20 Sep 2008)
New Revision: 1520

Modified:
   trunk/core/yade.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/SQLiteRecorder.cpp
Log:
make it compile with boost 1.35 (I wonder what 1.36 will bring)


Modified: trunk/core/yade.cpp
===================================================================
--- trunk/core/yade.cpp	2008-09-20 08:47:19 UTC (rev 1519)
+++ trunk/core/yade.cpp	2008-09-20 20:11:27 UTC (rev 1520)
@@ -57,7 +57,7 @@
 		if(sig==SIGABRT || sig==SIGSEGV){
 			signal(SIGSEGV,SIG_DFL); signal(SIGABRT,SIG_DFL); // prevent loops - default handlers
 			cerr<<"SIGSEGV/SIGABRT handler called; gdb batch file is `"<<Omega::instance().gdbCrashBatch<<"'"<<endl;
-			system((string("gdb -x ")+Omega::instance().gdbCrashBatch).c_str());
+			std::system((string("gdb -x ")+Omega::instance().gdbCrashBatch).c_str());
 			unlink(Omega::instance().gdbCrashBatch.c_str()); // delete the crash batch file
 			raise(sig); // reemit signal after exiting gdb
 		}

Modified: trunk/pkg/dem/Engine/StandAloneEngine/SQLiteRecorder.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/SQLiteRecorder.cpp	2008-09-20 08:47:19 UTC (rev 1519)
+++ trunk/pkg/dem/Engine/StandAloneEngine/SQLiteRecorder.cpp	2008-09-20 20:11:27 UTC (rev 1520)
@@ -3,6 +3,7 @@
 #include<boost/algorithm/string.hpp>
 #include<boost/filesystem/operations.hpp>
 #include<boost/filesystem/convenience.hpp>
+#include<boost/algorithm/string/join.hpp>
 #include<yade/core/MetaBody.hpp>
 using namespace boost;
 CREATE_LOGGER(SQLiteRecorder);


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Mon Sep 22 15:31:05 2008
From: eudoxos at arcig.cz (=?windows-1252?Q?V=E1clav_=8Amilauer?=)
Date: Mon, 22 Sep 2008 15:31:05 +0200
Subject: [deprecated list] [Yade-dev] significat timestep improvement
 with non-incremental shear computation
In-Reply-To: <48D78B86.5080702@hmg.inpg.fr>
References: <48D38371.3030804@arcig.cz> <48D393B1.5040400@hmg.inpg.fr>
	<48D3A884.7010407@arcig.cz> <48D78B86.5080702@hmg.inpg.fr>
Message-ID: <48D79E19.8060900@arcig.cz>


> You are storing 1 "initial" orientation for each grain in the
> interaction, then update it when plastic motion occures, right?
> Is it commited already?
Yes, it is commited and there is some documentation in
SpheresContactGeometry. The plastic slip must be requested explicitly by
the user (the contact law) with SpheresContactGeometry::slipToEpsTMax
(or slipToDisplacementTMax) where you specify maximum shear (T as
tangent) strain (or displacement).

>From time to time, you should also call
SpheresContactGeometry::relocateContactPoints, if spheres roll one on
another.

I will send you some images once I make them (I would have to make them
for the thesis anyway...)

See scripts/exact-rot.py, it can be visualized quite intuitively.

Vaclav

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Mon Sep 22 16:24:00 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Mon, 22 Sep 2008 16:24:00 +0200
Subject: [deprecated list] [Yade-dev] please reply to mailing list (was:
 significat timestep improvement....)
In-Reply-To: <48D79E19.8060900@arcig.cz>
References: <48D38371.3030804@arcig.cz> <48D393B1.5040400@hmg.inpg.fr>
	<48D3A884.7010407@arcig.cz> <48D78B86.5080702@hmg.inpg.fr>
	<48D79E19.8060900@arcig.cz>
Message-ID: <20080922162400.433ffc35@szpak>

V?clav ?milauer said:     (by the date of Mon, 22 Sep 2008 15:31:05 +0200)

> I will send you some images once I make them (I would have to make them
> for the thesis anyway...)

guys, I observe here a one-sided conversation. Bruno, can you please
send replies to yade-dev at lists.launchpad.net, not to private Vaclav's
email address?

I asked launchpad admins to override Reply-To header, but they
refused. So now everyone must be careful to not reply in private, but
to always use yade-dev at lists.launchpad.net.
Personally I click "Reply All" button, then remove the private
address from list of "all" addresses.

BTW, they just acknowledged to import yade-dev history to launchpad:

  https://answers.launchpad.net/launchpad/+question/42790

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Mon Sep 22 17:14:45 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Mon, 22 Sep 2008 17:14:45 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1522 - trunk/gui/py
Message-ID: <200809221514.m8MFEjEX003366@sheep.berlios.de>

Author: eudoxos
Date: 2008-09-22 17:14:44 +0200 (Mon, 22 Sep 2008)
New Revision: 1522

Modified:
   trunk/gui/py/_utils.cpp
   trunk/gui/py/eudoxos.py
   trunk/gui/py/utils.py
Log:
1. Move interaction direction distribution pie histograms to utils
2. Add plotting histogram of number of contacts to plotDirections()

  utils.plotDirections(utils.aabbExtrema()) # to do it on the whole specimen



Modified: trunk/gui/py/_utils.cpp
===================================================================
--- trunk/gui/py/_utils.cpp	2008-09-21 11:47:46 UTC (rev 1521)
+++ trunk/gui/py/_utils.cpp	2008-09-22 15:14:44 UTC (rev 1522)
@@ -131,6 +131,29 @@
 }
 BOOST_PYTHON_FUNCTION_OVERLOADS(interactionAnglesHistogram_overloads,interactionAnglesHistogram,1,4);
 
+python::tuple bodyNumInteractionsHistogram(python::tuple aabb=python::tuple()){
+	Vector3r bbMin(Vector3r::ZERO), bbMax(Vector3r::ZERO); bool useBB=python::len(aabb)>0; if(useBB){bbMin=tuple2vec(extract<python::tuple>(aabb[0])());bbMax=tuple2vec(extract<python::tuple>(aabb[1])());}
+	const shared_ptr<MetaBody>& rb=Omega::instance().getRootBody();
+	vector<int> bodyNumInta; bodyNumInta.resize(rb->bodies->size(),-1 /* uninitialized */);
+	int maxInta=0;
+	FOREACH(const shared_ptr<Interaction>& i, *rb->transientInteractions){
+		if(!i->isReal) continue;
+		const body_id_t id1=i->getId1(), id2=i->getId2(); const shared_ptr<Body>& b1=Body::byId(id1,rb), b2=Body::byId(id2,rb);
+		if(useBB && isInBB(b1->physicalParameters->se3.position,bbMin,bbMax)) bodyNumInta[id1]=bodyNumInta[id1]>0?bodyNumInta[id1]+1:1;
+		if(useBB && isInBB(b2->physicalParameters->se3.position,bbMin,bbMax)) bodyNumInta[id2]=bodyNumInta[id2]>0?bodyNumInta[id2]+1:1;
+		maxInta=max(max(maxInta,bodyNumInta[b1->getId()]),bodyNumInta[b2->getId()]);
+	}
+	vector<int> bins; bins.resize(maxInta+1);
+	for(size_t id=0; id<bodyNumInta.size(); id++){ if(bodyNumInta[id]>=0) bins[bodyNumInta[id]]+=1; }
+	python::list count,num;
+	for(size_t n=1; n<bins.size(); n++){
+		if(bins[n]==0) continue;
+		num.append(n); count.append(bins[n]);
+	}
+	return python::make_tuple(num,count);
+}
+BOOST_PYTHON_FUNCTION_OVERLOADS(bodyNumInteractionsHistogram_overloads,bodyNumInteractionsHistogram,0,1);
+
 python::tuple inscribedCircleCenter(python::list v0, python::list v1, python::list v2)
 {
 	return vec2tuple(Shop::inscribedCircleCenter(Vector3r(python::extract<double>(v0[0]),python::extract<double>(v0[1]),python::extract<double>(v0[2])), Vector3r(python::extract<double>(v1[0]),python::extract<double>(v1[1]),python::extract<double>(v1[2])), Vector3r(python::extract<double>(v2[0]),python::extract<double>(v2[1]),python::extract<double>(v2[2]))));
@@ -144,6 +167,7 @@
 	def("coordsAndDisplacements",coordsAndDisplacements,coordsAndDisplacements_overloads(args("AABB")));
 	def("setRefSe3",setRefSe3);
 	def("interactionAnglesHistogram",interactionAnglesHistogram,interactionAnglesHistogram_overloads(args("axis","mask","bins","aabb")));
+	def("bodyNumInteractionsHistogram",bodyNumInteractionsHistogram,bodyNumInteractionsHistogram_overloads(args("aabb")));
 	def("elasticEnergy",elasticEnergyInAABB);
 	def("inscribedCircleCenter",inscribedCircleCenter);
 }

Modified: trunk/gui/py/eudoxos.py
===================================================================
--- trunk/gui/py/eudoxos.py	2008-09-21 11:47:46 UTC (rev 1521)
+++ trunk/gui/py/eudoxos.py	2008-09-22 15:14:44 UTC (rev 1522)
@@ -12,18 +12,6 @@
 	dim=utils.aabbDim(cutoff)
 	return utils.elasticEnergy(utils.aabbExtrema(cutoff))/(.5*strain*dim[0]*dim[1]*dim[2])
 
-def plotDirections(mask=0,bins=20,aabb=()):
-	"Plot 3 histograms for distribution of interaction directions, in yz,xz and xy planes."
-	import pylab,math
-	from yade import utils
-	for axis in [0,1,2]:
-		d=utils.interactionAnglesHistogram(axis,mask=mask,bins=bins,aabb=aabb)
-		fc=[0,0,0]; fc[axis]=1.
-		pylab.subplot(220+axis+1,polar=True);
-		# 1.2 makes small gaps between values (but the column is decentered)
-		pylab.bar(d[0],d[1],width=math.pi/(1.2*bins),fc=fc,alpha=.7,label=['yz','xz','xy'][axis])
-	pylab.show()
-
 def estimatePoissonYoung(principalAxis,stress=0,plot=False,cutoff=0.):
 	"""Estimate Poisson's ration given the "principal" axis of straining.
 	For every base direction, homogenized strain is computed

Modified: trunk/gui/py/utils.py
===================================================================
--- trunk/gui/py/utils.py	2008-09-21 11:47:46 UTC (rev 1521)
+++ trunk/gui/py/utils.py	2008-09-22 15:14:44 UTC (rev 1522)
@@ -144,6 +144,43 @@
 		out.write('%g\t%g\t%g\t%g\n'%(b.phys['se3'][0],b.phys['se3'][1],b.phys['se3'][2],b.shape['radius']))
 	out.close()
 
+def avgNumInteractions(cutoff=0.):
+	nums,counts=bodyNumInteractionsHistogram(aabbExtrema(cutoff))
+	return sum([nums[i]*counts[i] for i in range(len(nums))])/(1.*sum(counts))
+
+def plotNumInteractionsHistogram(cutoff=0.):
+	nums,counts=bodyNumInteractionsHistogram(aabbExtrema(cutoff))
+	import pylab
+	pylab.bar(nums,counts)
+	pylab.title('Number of interactions histogram, average %g (cutoff=%g)'%(avgNumInteractions(cutoff),cutoff))
+	pylab.xlabel('Number of interactions')
+	pylab.ylabel('Body count')
+	pylab.show()
+
+def plotDirections(aabb=(),mask=0,bins=20,numHist=True):
+	"""Plot 3 histograms for distribution of interaction directions, in yz,xz and xy planes and
+	(optional but default) histogram of number of interactions per body."""
+	import pylab,math
+	from yade import utils
+	for axis in [0,1,2]:
+		d=utils.interactionAnglesHistogram(axis,mask=mask,bins=bins,aabb=aabb)
+		fc=[0,0,0]; fc[axis]=1.
+		subp=pylab.subplot(220+axis+1,polar=True);
+		# 1.1 makes small gaps between values (but the column is a bit decentered)
+		pylab.bar(d[0],d[1],width=math.pi/(1.1*bins),fc=fc,alpha=.7,label=['yz','xz','xy'][axis])
+		#pylab.title(['yz','xz','xy'][axis]+' plane')
+		pylab.text(.5,.25,['yz','xz','xy'][axis],horizontalalignment='center',verticalalignment='center',transform=subp.transAxes,fontsize='xx-large')
+	if numHist:
+		pylab.subplot(224,polar=False)
+		nums,counts=utils.bodyNumInteractionsHistogram(aabb if len(aabb)>0 else utils.aabbExtrema())
+		avg=sum([nums[i]*counts[i] for i in range(len(nums))])/(1.*sum(counts))
+		pylab.bar(nums,counts,fc=[1,1,0],alpha=.7,align='center')
+		pylab.xlabel('Interactions per body (avg. %g)'%avg)
+		pylab.axvline(x=avg,linewidth=3,color='r')
+		pylab.ylabel('Body count')
+	pylab.show()
+
+
 def import_stl_geometry(file, begin=0, young=30e9,poisson=.3,frictionAngle=0.5236,wire=True):
 		## Import walls geometry from STL file
 		imp = STLImporter()
@@ -161,48 +198,3 @@
 			o.bodies[i].mold.postProcessAttributes()
 		return imp.number_of_facets
 
-def negPosExtremes(**kw): raise DeprecationWarning("negPosExtremes is deprecated, use negPosExtremalIds instead.")
-
-# reimplemented in _utils in c++ (results verified to be identical)
-if 0:
-	def negPosExtremes(axis,distFactor=1.1):
-		"""Get 2 lists (negative and positive extremes) of sphere ids that are close to the boundary
-		in the direction of requested axis (0=x,1=y,2=z).
-
-		distFactor enlarges radius of the sphere, it can be considered 'extremal' even if it doesn't touch the extreme.
-		"""
-		inf=float('inf')
-		extremes=[inf,-inf]
-		ret=[[],[]]
-		o=Omega()
-		for b in o.bodies:
-			extremes[1]=max(extremes[1],+b.shape['radius']+b.phys['se3'][axis])
-			extremes[0]=min(extremes[0],-b.shape['radius']+b.phys['se3'][axis])
-		for b in o.bodies:
-			if b.phys['se3'][axis]-b.shape['radius']*distFactor<=extremes[0]: ret[0].append(b.id)
-			if b.phys['se3'][axis]+b.shape['radius']*distFactor>=extremes[1]: ret[1].append(b.id)
-		return ret
-	def aabbExtrema(consider=lambda body:True):
-		"""return min and max points of an aabb around spherical packing (non-spheres are ignored)"""
-		inf=float('inf')
-		minimum,maximum=[inf,inf,inf],[-inf,-inf,-inf]
-		o=Omega()
-		for b in o.bodies:
-			if consider(b) and b.shape.name=='Sphere':
-				minimum=[min(minimum[i],b.phys['se3'][i]-b.shape['radius']) for i in range(3)]
-				maximum=[max(maximum[i],b.phys['se3'][i]+b.shape['radius']) for i in range(3)]
-		return minimum,maximum
-	def PWaveTimeStep():
-		"""Estimate timestep by the elastic wave propagation speed (p-wave).
-		
-		Multiply the value returned by some safety factor < 1, since shear waves are not taken into account here."""
-		o=Omega()
-		dt=float('inf')
-		for b in o.bodies:
-			if not (b.phys and b.shape): continue
-			if not (b.phys.has_key('young') and b.shape.has_key('radius')): continue
-			density=b.phys['mass']/((4./3.)*math.pi*b.shape['radius']**3)
-			thisDt=b.shape['radius']/math.sqrt(b.phys['young']/density)
-			dt=min(dt,thisDt)
-		return dt
-


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From sj2001 at yandex.ru  Tue Sep 23 07:27:20 2008
From: sj2001 at yandex.ru (sega)
Date: Tue, 23 Sep 2008 09:27:20 +0400
Subject: [deprecated list] [Yade-dev] [yade-dev] run faster by +16% with
	r1402
In-Reply-To: <200807021546.33344.dorofeenko@icp.ac.ru>
References: <4863833E.3000908@arcig.cz> <486A7722.8030304@arcig.cz>
	<200807021546.33344.dorofeenko@icp.ac.ru>
Message-ID: <200809230927.20694.sj2001@yandex.ru>

Hi, All.

I had run a simulation of 90000 spheres and got 
about 0.44 iter/sec with ParallelEngine (used as in scripts/simple-scene-parallel.py),
and about 0.35 iter/sec without ParallelEngine
on a notebook with Intel(R) Core(TM)2 Duo CPU T8100 @ 2.10GHz and 2GB RAM.
So, parallelization is effective, but I need more speed!! And I want to use openmp for in-engine cycles 
(for GravityEngine, BoundingBoxMetaEngine, ect.) and to run yade on a cluster. 
This topic had been discussed here earlier. 
Tell me please, how much work has been done in that direction and how much successes in it?
Is there a 'reefs' or 'nota benes'? 
I see commented line /pragma omp paraller for/ in BoundignVolumeMetaEngine.cpp. Why it is commented?
Janek,  you  use yade on cluster, seems. Tell me please, you use trunk version or modified it specially for cluster?

-- 
Best regards, Sergei D.

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From sj2001 at yandex.ru  Tue Sep 23 07:22:46 2008
From: sj2001 at yandex.ru (sega)
Date: Tue, 23 Sep 2008 09:22:46 +0400
Subject: [deprecated list] [yade-dev] run faster by +16% with r1402
In-Reply-To: <200807021546.33344.dorofeenko@icp.ac.ru>
References: <4863833E.3000908@arcig.cz> <486A7722.8030304@arcig.cz>
	<200807021546.33344.dorofeenko@icp.ac.ru>
Message-ID: <200809230922.46933.sj2001@yandex.ru>

Hi, All.

I had run a simulation of 90000 spheres and got 
about 0.44 iter/sec with ParallelEngine (used as in scripts/simple-scene-parallel.py),
and about 0.35 iter/sec without ParallelEngine
on a notebook with Intel(R) Core(TM)2 Duo CPU T8100 @ 2.10GHz and 2GB RAM.
So, parallelization is effective, but I need more speed!! And I want to use openmp for in-engine cycles 
(for GravityEngine, BoundingBoxMetaEngine, ect.) and to run yade on a cluster. 
This topic had been discussed here earlier. 
Tell me please, how much work has been done in that direction and how much successes in it?
Is there a 'reefs' or 'nota benes'? 
I see commented line /pragma omp paraller for/ in BoundignVolumeMetaEngine.cpp. Why it is commented?
Janek,  you  use yade on cluster, seems. Tell me please, you use trunk version or modified it specially for cluster?

-- 
Best regards, Sergei D.


From eudoxos at arcig.cz  Tue Sep 23 09:19:26 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 23 Sep 2008 09:19:26 +0200
Subject: [deprecated list] [Yade-dev] [yade-dev] run faster by +16% with
	r1402
In-Reply-To: <200809230927.20694.sj2001@yandex.ru>
References: <4863833E.3000908@arcig.cz>
	<486A7722.8030304@arcig.cz>	<200807021546.33344.dorofeenko@icp.ac.ru>
	<200809230927.20694.sj2001@yandex.ru>
Message-ID: <48D8987E.9090000@arcig.cz>

sega napsal(a):
> Hi, All.
>
> I had run a simulation of 90000 spheres and got 
> about 0.44 iter/sec with ParallelEngine (used as in scripts/simple-scene-parallel.py),
> and about 0.35 iter/sec without ParallelEngine
> on a notebook with Intel(R) Core(TM)2 Duo CPU T8100 @ 2.10GHz and 2GB RAM.
>   
Cool!! I thought that it would be an improvement with large simulations,
but couldn't prove that. Can you - please - collect speeds etc that you
get underway? Those are things that could be very useful; you can put
your findings on the wiki, create a page for parallel computation.
> So, parallelization is effective, but I need more speed!! And I want to use openmp for in-engine cycles 
> (for GravityEngine, BoundingBoxMetaEngine, ect.) and to run yade on a cluster. 
> This topic had been discussed here earlier. 
> Tell me please, how much work has been done in that direction and how much successes in it?
> Is there a 'reefs' or 'nota benes'? 
>   
* Don't use parallelization for small simulations, they will be slower.

* Openmp needs random-access elements. Therefore, currently there is no
way to parallelize loops over interactions, only over bodies; that's a pity.
> I see commented line /pragma omp paraller for/ in BoundignVolumeMetaEngine.cpp. Why it is commented?
>   
It turned out that for smaller simulations, the overhead of creating
parallel section is bigger that the time it saved on the computation.
Therefore, I commented that out, since it would penalize typical users
(including me). I would be very interested to hear about your findings.

It would be interesting to compare speed of running yade with
OMP_NUM_THREADS=1 and all those engines (gravity etc) marked as /pragma
omp parallel for/ and without that. They would run in single thread in
every case, but if the overhead of openmp would be negligible, that
could be added by default and the number of threads set by a
command-line switch at runtime (omp_set_num_threads).
> Janek,  you  use yade on cluster, seems. Tell me please, you use trunk version or modified it specially for cluster?
>   
AFAIK they use cluster to run multiple simulations at once.

Best, Vaclav


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Tue Sep 23 09:51:55 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Tue, 23 Sep 2008 09:51:55 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1523 - trunk/gui/py
Message-ID: <200809230751.m8N7ptP3022191@sheep.berlios.de>

Author: eudoxos
Date: 2008-09-23 09:51:55 +0200 (Tue, 23 Sep 2008)
New Revision: 1523

Modified:
   trunk/gui/py/utils.py
   trunk/gui/py/yadeControl.cpp
Log:
1. Omega().bodies.append can take list of bodies now (instead of just one body), returning list of added id's
2. utils.facet can take both tuples and lists for vertex coordinates



Modified: trunk/gui/py/utils.py
===================================================================
--- trunk/gui/py/utils.py	2008-09-22 15:14:44 UTC (rev 1522)
+++ trunk/gui/py/utils.py	2008-09-23 07:51:55 UTC (rev 1523)
@@ -45,7 +45,7 @@
 	b=Body()
 	b.shape=GeometricalModel('Facet',{'diffuseColor':color,'wire':wire,'visible':True})
 	b.mold=InteractingGeometry('InteractingFacet',{'diffuseColor':color})
-	center=inscribedCircleCenter(vertices[0],vertices[1],vertices[2])
+	center=inscribedCircleCenter(list(vertices[0]),list(vertices[1]),list(vertices[2]))
 	vertices=map(lambda a,b:map(lambda x,y:x-y,a,b),vertices,[center,center,center]) 
 	vStr='['+' '.join(['{%g %g %g}'%(v[0],v[1],v[2]) for v in vertices])+']'
 	b.shape.setRaw('vertices',vStr)

Modified: trunk/gui/py/yadeControl.cpp
===================================================================
--- trunk/gui/py/yadeControl.cpp	2008-09-22 15:14:44 UTC (rev 1522)
+++ trunk/gui/py/yadeControl.cpp	2008-09-23 07:51:55 UTC (rev 1523)
@@ -283,6 +283,7 @@
 		else return pyBody(proxee->operator[](id));
 	}
 	body_id_t insert(pyBody b){return proxee->insert(b.proxee);}
+	python::list insertList(python::list bb){python::list ret; for(int i=0; i<len(bb); i++){ret.append(insert(python::extract<pyBody>(bb[i])()));} return ret;}
 	long length(){return proxee->size();}
 	void clear(){proxee->clear();}
 };
@@ -543,6 +544,7 @@
 		.def("__getitem__",&pyBodyContainer::pyGetitem)
 		.def("__len__",&pyBodyContainer::length)
 		.def("append",&pyBodyContainer::insert)
+		.def("append",&pyBodyContainer::insertList)
 		.def("clear", &pyBodyContainer::clear);
 	boost::python::class_<pyInteractionContainer>("InteractionContainer",python::init<pyInteractionContainer&>())
 		.def("__iter__",&pyInteractionContainer::pyIter)


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Tue Sep 23 11:36:21 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 23 Sep 2008 11:36:21 +0200
Subject: [deprecated list] [Yade-dev] new algorithm for facets
In-Reply-To: <200809201249.55167.sj2001@yandex.ru>
References: <200809132208.35739.sj2001@yandex.ru>	<200809192133.06549.sj2001@yandex.ru>
	<48D4A429.4060905@arcig.cz> <200809201249.55167.sj2001@yandex.ru>
Message-ID: <48D8B895.50109@arcig.cz>

Hi, are facets supposed to interact (with spheres) from both sides?
Thanks, Vaclav


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From sj2001 at yandex.ru  Tue Sep 23 11:57:39 2008
From: sj2001 at yandex.ru (sega)
Date: Tue, 23 Sep 2008 13:57:39 +0400
Subject: [deprecated list] [Yade-dev] new algorithm for facets
In-Reply-To: <48D8B895.50109@arcig.cz>
References: <200809132208.35739.sj2001@yandex.ru>
	<200809201249.55167.sj2001@yandex.ru> <48D8B895.50109@arcig.cz>
Message-ID: <200809231357.39923.sj2001@yandex.ru>


> Hi, are facets supposed to interact (with spheres) from both sides?
Yes... at least, it should be so. Is there some problems?




-- 
Best regards, Sergei D.

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Tue Sep 23 13:45:27 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 23 Sep 2008 13:45:27 +0200
Subject: [deprecated list] [Yade-dev] new algorithm for facets
In-Reply-To: <200809231357.39923.sj2001@yandex.ru>
References: <200809132208.35739.sj2001@yandex.ru>	<200809201249.55167.sj2001@yandex.ru>
	<48D8B895.50109@arcig.cz> <200809231357.39923.sj2001@yandex.ru>
Message-ID: <48D8D6D7.8030306@arcig.cz>


> Yes... at least, it should be so. Is there some problems?
>   
No, it was my fault after all - the gravity was such big (1e9) that
spheres were passing through. Now it is just fine. Thanks for the facet
code. Vaclav

I have a warning about no return value in yadeControl:498 unsigned int
py_import(pyBodyContainer bc, unsigned int begin=0) {
import(bc.proxee,begin); }. I wasn't sure how to get the right number to
return. Can you fix that?



_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From sega at mail.berlios.de  Tue Sep 23 15:44:55 2008
From: sega at mail.berlios.de (sega at BerliOS)
Date: Tue, 23 Sep 2008 15:44:55 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1524 - in trunk: gui/py
	pkg/dem/Engine/EngineUnit	scripts
Message-ID: <200809231344.m8NDitiI015648@sheep.berlios.de>

Author: sega
Date: 2008-09-23 15:44:55 +0200 (Tue, 23 Sep 2008)
New Revision: 1524

Modified:
   trunk/gui/py/yadeControl.cpp
   trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp
   trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.hpp
   trunk/scripts/exact-rot-facet.py
Log:
small fixes

Modified: trunk/gui/py/yadeControl.cpp
===================================================================
--- trunk/gui/py/yadeControl.cpp	2008-09-23 07:51:55 UTC (rev 1523)
+++ trunk/gui/py/yadeControl.cpp	2008-09-23 13:44:55 UTC (rev 1524)
@@ -495,7 +495,7 @@
 
 class pySTLImporter : public STLImporter {
     public:
-	unsigned int py_import(pyBodyContainer bc, unsigned int begin=0) { import(bc.proxee,begin); }
+	void py_import(pyBodyContainer bc, unsigned int begin=0) { import(bc.proxee,begin); }
 };
 
 BOOST_PYTHON_MEMBER_FUNCTION_OVERLOADS(STLImporter_import_overloads,py_import,1,2);

Modified: trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp
===================================================================
--- trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp	2008-09-23 07:51:55 UTC (rev 1523)
+++ trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp	2008-09-23 13:44:55 UTC (rev 1524)
@@ -64,6 +64,15 @@
 	Real sh = sphereRadius*shrinkFactor;
 	Real icr = facet->icr-sh;
 
+	if (icr<0)
+	{
+		LOG_INFO("WARNING: a radius of a facet's inscribed circle less than zero! So, shrinkFactor is too large and would be reduced to zero.");
+		shrinkFactor=0;
+		icr = facet->icr;
+		sh = 0;
+	}
+
+
 	if (bm<icr) // contact with facet's surface
 	{
 		penetrationDepth = sphereRadius - L;

Modified: trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.hpp
===================================================================
--- trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.hpp	2008-09-23 07:51:55 UTC (rev 1523)
+++ trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.hpp	2008-09-23 13:44:55 UTC (rev 1524)
@@ -35,7 +35,14 @@
 
 	DEFINE_FUNCTOR_ORDER_2D(InteractingFacet,InteractingSphere);
 
-	Real shrinkFactor;
+	// The radius of the inscribed circle of the facet is decreases by the
+	// value of the sphere's radius multipled by shrinkFactor. So, at
+	// definition of a contact point on the surface made of facets, the given
+	// surface is not continuous and is similar to a surface covered with a
+	// tile, with a gap between the separate tiles equal to the sphere's radius
+	// multiplied by 2*shrinkFactor. By default shrinkFactor=0.
+	Real shrinkFactor; 
+
 	bool hasShear;
 	
 	protected :

Modified: trunk/scripts/exact-rot-facet.py
===================================================================
--- trunk/scripts/exact-rot-facet.py	2008-09-23 07:51:55 UTC (rev 1523)
+++ trunk/scripts/exact-rot-facet.py	2008-09-23 13:44:55 UTC (rev 1524)
@@ -20,7 +20,7 @@
 	StandAloneEngine('PersistentSAPCollider'),
 	MetaEngine('InteractionGeometryMetaEngine',[
 		EngineUnit('InteractingSphere2InteractingSphere4SpheresContactGeometry',{'hasShear':True,'interactionDetectionFactor':1.4}),
-		EngineUnit('InteractingFacet2InteractingSphere4SpheresContactGeometry',{'hasShear':True,'shrinkFactor':1.}),
+		EngineUnit('InteractingFacet2InteractingSphere4SpheresContactGeometry',{'hasShear':True,'shrinkFactor':0.}),
 	]),
 	MetaEngine('InteractionPhysicsMetaEngine',[EngineUnit('SimpleElasticRelationships')]),
 	StandAloneEngine('ElasticContactLaw'),


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From sj2001 at yandex.ru  Tue Sep 23 15:49:44 2008
From: sj2001 at yandex.ru (sega)
Date: Tue, 23 Sep 2008 17:49:44 +0400
Subject: [deprecated list] [Yade-dev] new algorithm for facets
In-Reply-To: <48D8D6D7.8030306@arcig.cz>
References: <200809132208.35739.sj2001@yandex.ru>
	<200809231357.39923.sj2001@yandex.ru> <48D8D6D7.8030306@arcig.cz>
Message-ID: <200809231749.44966.sj2001@yandex.ru>


> I have a warning about no return value in yadeControl:498 unsigned int
> py_import(pyBodyContainer bc, unsigned int begin=0) {
> import(bc.proxee,begin); }. I wasn't sure how to get the right number to
> return. Can you fix that?

Fixed. This function should not return values...

About shrinkFactor from IF2IS4SCG:
The radius of the inscribed circle of the facet is decreases by the
value of the sphere's radius multipled by shrinkFactor. So, at
definition of a contact point on the surface made of facets, the 
surface is not continuous and is similar to a surface covered with a
tile, with a gap between the separate tiles equal to the sphere's radius
multiplied by 2*shrinkFactor. By default shrinkFactor=0.

I added this docs to IF2IS4SCG.

-- 
Best regards, Sergei D.

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Wed Sep 24 10:42:06 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Wed, 24 Sep 2008 10:42:06 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1525 - in trunk: core extra
	extra/clump
	gui/py	pkg/common/DataClass/InteractionPhysics	pkg/common/Engine/DeusExMachina
	pkg/dem/DataClass/InteractionPhysics	pkg/dem/Engine/EngineUnit
Message-ID: <200809240842.m8O8g6Wd029544@sheep.berlios.de>

Author: eudoxos
Date: 2008-09-24 10:42:04 +0200 (Wed, 24 Sep 2008)
New Revision: 1525

Modified:
   trunk/core/yade.cpp
   trunk/extra/Brefcom.cpp
   trunk/extra/Brefcom.hpp
   trunk/extra/clump/Shop.cpp
   trunk/extra/clump/Shop.hpp
   trunk/gui/py/PythonUI_rc.py
   trunk/gui/py/_utils.cpp
   trunk/pkg/common/DataClass/InteractionPhysics/NormalShearInteractions.hpp
   trunk/pkg/common/Engine/DeusExMachina/GravityEngines.hpp
   trunk/pkg/dem/DataClass/InteractionPhysics/ElasticContactInteraction.hpp
   trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp
   trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.hpp
Log:
1. Add NormalInteraction::normalForce and NormalShearInteraction::normalForce (moved up the hierarchy from ElasticContactInteraction) so that unbalancedForce can be calculated on any subclassed interaction type.
2. Adapt Brefcom for this.
3. Add Shop::unbalancedForce and utils.unbalancedForce
4. Add workaround for saving ipython history as suggested by http://lists.ipython.scipy.org/pipermail/ipython-user/2008-September/005839.html
5. Fix AxialGravityEngine to register parent class attributes.



Modified: trunk/core/yade.cpp
===================================================================
--- trunk/core/yade.cpp	2008-09-23 13:44:55 UTC (rev 1524)
+++ trunk/core/yade.cpp	2008-09-24 08:42:04 UTC (rev 1525)
@@ -253,8 +253,14 @@
 	int ok = frontEnd->run(argc,argv);
 
 	#ifdef EMBED_PYTHON
+		/* pyFinalize crashes with boost:python<=1.35
+		 * http://www.boost.org/libs/python/todo.html#pyfinalize-safety has explanation 
+		 * once this is fixed, you should remove workaround that saves history from ipython session in gui/py/PythonUI_rc.py:63
+		 *   import IPython.ipapi
+		 *   IPython.ipapi.get().IP.atexit_operations()
+		 */
 		// LOG_DEBUG("Finalizing Python...");
-		// Py_Finalize(); // FIXME: http://www.boost.org/libs/python/todo.html#pyfinalize-safety says this is unsafe with boost::python
+		// Py_Finalize();
 	#endif
 	#ifdef YADE_DEBUG
 		signal(SIGABRT,SIG_DFL); signal(SIGHUP,SIG_DFL); // default handlers

Modified: trunk/extra/Brefcom.cpp
===================================================================
--- trunk/extra/Brefcom.cpp	2008-09-23 13:44:55 UTC (rev 1524)
+++ trunk/extra/Brefcom.cpp	2008-09-24 08:42:04 UTC (rev 1525)
@@ -173,8 +173,8 @@
 		// store Fn (and Fs?), for use with GlobalStiffnessCounter?
 		NNAN(sigmaN); NNANV(sigmaT);
 		NNAN(crossSection);
-		Fn=sigmaN*crossSection;
-		Fs=sigmaT*crossSection;
+		Fn=sigmaN*crossSection; BC->normalForce=Fn*contGeom->normal;
+		Fs=sigmaT*crossSection; BC->shearForce=Fs;
 		applyForce(crossSection*(contGeom->normal*sigmaN + sigmaT),I->getId1(),I->getId2()); /* this is the force applied on the _first_ body; inverted applied to the second */
 	}
 }

Modified: trunk/extra/Brefcom.hpp
===================================================================
--- trunk/extra/Brefcom.hpp	2008-09-23 13:44:55 UTC (rev 1524)
+++ trunk/extra/Brefcom.hpp	2008-09-24 08:42:04 UTC (rev 1525)
@@ -83,6 +83,7 @@
 		bool neverDamage;
 
 		/*! auxiliary variable for visualization, recalculated in BrefcomLaw at every iteration */
+		// FIXME: Fn and Fs are stored as Vector3r normalForce, shearForce in NormalShearInteraction 
 		Real omega, Fn, sigmaN, epsN; Vector3r epsT, sigmaT, Fs;
 
 		BrefcomContact(): NormalShearInteraction(),E(0), G(0), tanFrictionAngle(0), undamagedCohesion(0), crossSection(0), xiShear(0), tau(0), expDmgRate(0) { createIndex(); epsT=Vector3r::ZERO; kappaD=0; isCohesive=false; neverDamage=false; omega=0; Fn=0; Fs=Vector3r::ZERO; }

Modified: trunk/extra/clump/Shop.cpp
===================================================================
--- trunk/extra/clump/Shop.cpp	2008-09-23 13:44:55 UTC (rev 1524)
+++ trunk/extra/clump/Shop.cpp	2008-09-24 08:42:04 UTC (rev 1525)
@@ -105,6 +105,31 @@
 #undef __BEX_ACCESS
 
 
+
+Real Shop::unbalancedForce(bool useMaxForce, MetaBody* _rb){
+	MetaBody* rb=_rb ? _rb : Omega::instance().getRootBody().get();
+
+	// get maximum force on a body and sum of all forces (for averaging)
+	Real sumF=0,maxF=0,currF;
+	FOREACH(const shared_ptr<Body>& b, *rb->bodies){
+		if(!b->isDynamic) continue;
+		currF=Shop::Bex::force(b->id,rb).Length(); maxF=max(currF,maxF); sumF+=currF;
+	}
+	Real meanF=sumF/rb->bodies->size(); 
+	// get max force on contacts
+	Real maxContactF=0;
+	FOREACH(const shared_ptr<Interaction>& I, *rb->transientInteractions){
+		if(!I->isReal) continue;
+		shared_ptr<NormalShearInteraction> nsi=YADE_PTR_CAST<NormalShearInteraction>(I->interactionPhysics); assert(nsi);
+		maxContactF=max(maxContactF,(nsi->normalForce+nsi->shearForce).Length());
+	}
+	return (useMaxForce?maxF:meanF)/maxContactF;
+}
+
+
+
+
+
 template <typename valType> valType Shop::getDefault(const string& key) {
 	ensureInit();
 	try{return boost::any_cast<valType>(defaults[key]);}

Modified: trunk/extra/clump/Shop.hpp
===================================================================
--- trunk/extra/clump/Shop.hpp	2008-09-23 13:44:55 UTC (rev 1524)
+++ trunk/extra/clump/Shop.hpp	2008-09-24 08:42:04 UTC (rev 1525)
@@ -99,4 +99,7 @@
 
 		//! Calculate inscribed circle center of trianlge
 		static Vector3r inscribedCircleCenter(const Vector3r& v0, const Vector3r& v1, const Vector3r& v2);
+
+		//! Get unbalanced force of the whole simulation
+		static Real unbalancedForce(bool useMaxForce=false, MetaBody* _rb=NULL);
 };

Modified: trunk/gui/py/PythonUI_rc.py
===================================================================
--- trunk/gui/py/PythonUI_rc.py	2008-09-23 13:44:55 UTC (rev 1524)
+++ trunk/gui/py/PythonUI_rc.py	2008-09-24 08:42:04 UTC (rev 1525)
@@ -58,6 +58,10 @@
 	,rc_override={'execfile':[runtime.prefix+'/lib/yade'+runtime.suffix+'/gui/yade/ipython.py']})
 
 	ipshell()
+	# save history -- a workaround for atexit handlers not being run (why?)
+	# http://lists.ipython.scipy.org/pipermail/ipython-user/2008-September/005839.html
+	import IPython.ipapi
+	IPython.ipapi.get().IP.atexit_operations()
 	try:
 		import yade.qt
 		yade.qt.close()

Modified: trunk/gui/py/_utils.cpp
===================================================================
--- trunk/gui/py/_utils.cpp	2008-09-23 13:44:55 UTC (rev 1524)
+++ trunk/gui/py/_utils.cpp	2008-09-24 08:42:04 UTC (rev 1525)
@@ -159,6 +159,7 @@
 	return vec2tuple(Shop::inscribedCircleCenter(Vector3r(python::extract<double>(v0[0]),python::extract<double>(v0[1]),python::extract<double>(v0[2])), Vector3r(python::extract<double>(v1[0]),python::extract<double>(v1[1]),python::extract<double>(v1[2])), Vector3r(python::extract<double>(v2[0]),python::extract<double>(v2[1]),python::extract<double>(v2[2]))));
 }
 
+BOOST_PYTHON_FUNCTION_OVERLOADS(unbalancedForce_overloads,Shop::unbalancedForce,0,1);
 
 BOOST_PYTHON_MODULE(_utils){
 	def("PWaveTimeStep",PWaveTimeStep);
@@ -170,6 +171,7 @@
 	def("bodyNumInteractionsHistogram",bodyNumInteractionsHistogram,bodyNumInteractionsHistogram_overloads(args("aabb")));
 	def("elasticEnergy",elasticEnergyInAABB);
 	def("inscribedCircleCenter",inscribedCircleCenter);
+	def("unbalancedForce",&Shop::unbalancedForce,unbalancedForce_overloads(args("useMaxForce")));
 }
 
 

Modified: trunk/pkg/common/DataClass/InteractionPhysics/NormalShearInteractions.hpp
===================================================================
--- trunk/pkg/common/DataClass/InteractionPhysics/NormalShearInteractions.hpp	2008-09-23 13:44:55 UTC (rev 1524)
+++ trunk/pkg/common/DataClass/InteractionPhysics/NormalShearInteractions.hpp	2008-09-24 08:42:04 UTC (rev 1525)
@@ -9,11 +9,14 @@
 	public:
 		//! normal stiffness
 		Real kn;
+		//! normal force
+		Vector3r normalForce;
 		NormalInteraction(){createIndex(); }
 		virtual ~NormalInteraction();
 	protected:
 		virtual void registerAttributes(){
 			REGISTER_ATTRIBUTE(kn);
+			REGISTER_ATTRIBUTE(normalForce);
 		}
 	REGISTER_CLASS_NAME(NormalInteraction);
 	REGISTER_BASE_CLASS_NAME(InteractionPhysics);
@@ -28,12 +31,15 @@
 	public:
 		//! shear stiffness
 		Real ks;
+		//! shear force
+		Vector3r shearForce;
 		NormalShearInteraction(){ createIndex(); }
 		virtual ~NormalShearInteraction();
 	protected:
 		virtual void registerAttributes(){	
 			NormalInteraction::registerAttributes();
 			REGISTER_ATTRIBUTE(ks);
+			REGISTER_ATTRIBUTE(shearForce);
 		}
 	REGISTER_CLASS_NAME(NormalShearInteraction);
 	REGISTER_BASE_CLASS_NAME(NormalInteraction);

Modified: trunk/pkg/common/Engine/DeusExMachina/GravityEngines.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/GravityEngines.hpp	2008-09-23 13:44:55 UTC (rev 1524)
+++ trunk/pkg/common/Engine/DeusExMachina/GravityEngines.hpp	2008-09-24 08:42:04 UTC (rev 1525)
@@ -43,7 +43,7 @@
 		virtual ~CentralGravityEngine(){};
 		virtual void applyCondition(MetaBody*);
 	protected:
-		virtual void registerAttributes(){REGISTER_ATTRIBUTE(centralBody); REGISTER_ATTRIBUTE(accel); REGISTER_ATTRIBUTE(reciprocal); }
+		virtual void registerAttributes(){DeusExMachina::registerAttributes(); REGISTER_ATTRIBUTE(centralBody); REGISTER_ATTRIBUTE(accel); REGISTER_ATTRIBUTE(reciprocal); }
 		NEEDS_BEX("Force");
 		REGISTER_CLASS_NAME(CentralGravityEngine);
 		REGISTER_BASE_CLASS_NAME(DeusExMachina);
@@ -68,7 +68,7 @@
 		virtual ~AxialGravityEngine(){};
 		virtual void applyCondition(MetaBody*);
 	protected:
-		virtual void registerAttributes(){REGISTER_ATTRIBUTE(axisPoint); REGISTER_ATTRIBUTE(axisDirection); REGISTER_ATTRIBUTE(acceleration); }
+		virtual void registerAttributes(){DeusExMachina::registerAttributes(); REGISTER_ATTRIBUTE(axisPoint); REGISTER_ATTRIBUTE(axisDirection); REGISTER_ATTRIBUTE(acceleration); }
 		NEEDS_BEX("Force");
 		REGISTER_CLASS_NAME(AxialGravityEngine);
 		REGISTER_BASE_CLASS_NAME(DeusExMachina);

Modified: trunk/pkg/dem/DataClass/InteractionPhysics/ElasticContactInteraction.hpp
===================================================================
--- trunk/pkg/dem/DataClass/InteractionPhysics/ElasticContactInteraction.hpp	2008-09-23 13:44:55 UTC (rev 1524)
+++ trunk/pkg/dem/DataClass/InteractionPhysics/ElasticContactInteraction.hpp	2008-09-24 08:42:04 UTC (rev 1525)
@@ -14,9 +14,7 @@
 				,frictionAngle 			// angle of friction, according to Coulumb criterion
 				,tangensOfFrictionAngle;
 	
-		Vector3r	prevNormal			// unit normal of the contact plane.
-				,normalForce			// normal force applied on a DE
-				,shearForce;			// shear force applied on a DE
+		Vector3r	prevNormal;			// unit normal of the contact plane.
 
 		ElasticContactInteraction(){createIndex();};
 		virtual ~ElasticContactInteraction(){};
@@ -24,7 +22,6 @@
 		virtual void registerAttributes(){
 			NormalShearInteraction::registerAttributes();
 			REGISTER_ATTRIBUTE(prevNormal);
-			REGISTER_ATTRIBUTE(shearForce);
 			REGISTER_ATTRIBUTE(initialKn);
 			REGISTER_ATTRIBUTE(initialKs);
 			REGISTER_ATTRIBUTE(tangensOfFrictionAngle);

Modified: trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp
===================================================================
--- trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp	2008-09-23 13:44:55 UTC (rev 1524)
+++ trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp	2008-09-24 08:42:04 UTC (rev 1525)
@@ -13,6 +13,7 @@
 
 #include<yade/lib-base/yadeWm3Extra.hpp>
 
+CREATE_LOGGER(InteractingFacet2InteractingSphere4SpheresContactGeometry);
 
 InteractingFacet2InteractingSphere4SpheresContactGeometry::InteractingFacet2InteractingSphere4SpheresContactGeometry() 
 {

Modified: trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.hpp
===================================================================
--- trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.hpp	2008-09-23 13:44:55 UTC (rev 1524)
+++ trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.hpp	2008-09-24 08:42:04 UTC (rev 1525)
@@ -31,6 +31,8 @@
 	REGISTER_CLASS_NAME(InteractingFacet2InteractingSphere4SpheresContactGeometry);
 	REGISTER_BASE_CLASS_NAME(InteractionGeometryEngineUnit);
 
+	DECLARE_LOGGER;
+
 	FUNCTOR2D(InteractingFacet,InteractingSphere);
 
 	DEFINE_FUNCTOR_ORDER_2D(InteractingFacet,InteractingSphere);


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Wed Sep 24 10:44:01 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Wed, 24 Sep 2008 10:44:01 +0200
Subject: [deprecated list] [Yade-dev] Shop::unbalancedForce
Message-ID: <48D9FDD1.7070508@arcig.cz>

Bruno, could you please verify - at least by reading the code - that
Shop::unablancedForce I added in last commit is correct? I tried that on
gravity-compressed spheres and it was (almost steadily) dropping to
about 1e-6*gravity acceleration (maybe less, didn't wait). Regards, Vaclav

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From bruno.chareyre at hmg.inpg.fr  Wed Sep 24 11:12:12 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Wed, 24 Sep 2008 11:12:12 +0200
Subject: [deprecated list] [Yade-dev] Shop::unbalancedForce
In-Reply-To: <48D9FDD1.7070508@arcig.cz>
References: <48D9FDD1.7070508@arcig.cz>
Message-ID: <48DA046C.6030404@hmg.inpg.fr>

It looks correct. Usage is restricted to NormalShearInteractions (I 
guess yes), or can we cast different Interaction types to this?

It made me think the we should keep an updated list of macros used in 
Yade (YADE_PTR_CAST, FOREACH, REGISTER, etc), since they are either Yade 
macros, boost macros or any-other-lib macros, it can be a bit complex to 
read for newcomers.

Bruno



V?clav ?milauer a ?crit :
> Bruno, could you please verify - at least by reading the code - that
> Shop::unablancedForce I added in last commit is correct? I tried that on
> gravity-compressed spheres and it was (almost steadily) dropping to
> about 1e-6*gravity acceleration (maybe less, didn't wait). Regards, Vaclav
>
> _______________________________________________
> Mailing list: https://launchpad.net/~yade-dev
> Post to     : yade-dev at lists.launchpad.net
> Unsubscribe : https://launchpad.net/~yade-dev
> More help   : https://help.launchpad.net/ListHelp
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Grenoble INP
Laboratoire 3SR - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From bruno.chareyre at hmg.inpg.fr  Wed Sep 24 11:17:49 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Wed, 24 Sep 2008 11:17:49 +0200
Subject: [deprecated list] [Yade-dev] new algorithm for facets
In-Reply-To: <200809231749.44966.sj2001@yandex.ru>
References: <200809132208.35739.sj2001@yandex.ru>	<200809231357.39923.sj2001@yandex.ru>
	<48D8D6D7.8030306@arcig.cz> <200809231749.44966.sj2001@yandex.ru>
Message-ID: <48DA05BD.1020408@hmg.inpg.fr>

Hello

Does this means that edges can have a radius too, like a cylinder 
between the two nodes?

Bruno

> About shrinkFactor from IF2IS4SCG:
> The radius of the inscribed circle of the facet is decreases by the
> value of the sphere's radius multipled by shrinkFactor. So, at
> definition of a contact point on the surface made of facets, the 
> surface is not continuous and is similar to a surface covered with a
> tile, with a gap between the separate tiles equal to the sphere's radius
> multiplied by 2*shrinkFactor. By default shrinkFactor=0.
>
> I added this docs to IF2IS4SCG.
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Grenoble INP
Laboratoire 3SR - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Wed Sep 24 11:23:17 2008
From: eudoxos at arcig.cz (=?windows-1252?Q?V=E1clav_=8Amilauer?=)
Date: Wed, 24 Sep 2008 11:23:17 +0200
Subject: [deprecated list] [Yade-dev] Shop::unbalancedForce
In-Reply-To: <48DA046C.6030404@hmg.inpg.fr>
References: <48D9FDD1.7070508@arcig.cz> <48DA046C.6030404@hmg.inpg.fr>
Message-ID: <48DA0705.2070607@arcig.cz>


> It looks correct. Usage is restricted to NormalShearInteractions (I
> guess yes), or can we cast different Interaction types to this?
Well, ElasticContactInteraction (for instance) derives from
NormalShearInteraction (which in turn derives from NormalInteraction).
Eventually _all_ interactions that create normal and shear forces should
derive from NormalShearInteraction and there will be no need for casts.

Those parent classes store kn and ks as well, therefore the current
GlobalStiffnessCounter will work for many different types of
interactions, provided they have defined kn and ks.

I don't know what other (besides ElasticContactInteraction and
BrefcomContact) interactions we have but it might be useful to add those
to this class hierarchy as well, progressively.

I also hope that such generic interactions will reduce code duplication
(for instance, there is unbalancedForce computation in Triaxial, but now
it can use this function).

> It made me think the we should keep an updated list of macros used in
> Yade (YADE_PTR_CAST, FOREACH, REGISTER, etc), since they are either
> Yade macros, boost macros or any-other-lib macros, it can be a bit
> complex to read for newcomers.
If you create a wiki page, I will edit the macros I know something about.

Oh, any reason why global stiffness timestepper is 2 engines (GSCounter
and GSTimeStepper)? You could have just 1 engine that would compute
stiffnesses (store them not in physicalActions, but in a vector<Real> or
such) and then compute the timestep. (The code would also be easier to
understand -- in 1 place)


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From bruno.chareyre at hmg.inpg.fr  Wed Sep 24 11:54:02 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Wed, 24 Sep 2008 11:54:02 +0200
Subject: [deprecated list] [Yade-dev] Shop::unbalancedForce
In-Reply-To: <48DA0705.2070607@arcig.cz>
References: <48D9FDD1.7070508@arcig.cz> <48DA046C.6030404@hmg.inpg.fr>
	<48DA0705.2070607@arcig.cz>
Message-ID: <48DA0E3A.6050505@hmg.inpg.fr>

V?clav ?milauer a ?crit :
>> It looks correct. Usage is restricted to NormalShearInteractions (I
>> guess yes), or can we cast different Interaction types to this?
>>     
> Well, ElasticContactInteraction (for instance) derives from
> NormalShearInteraction (which in turn derives from NormalInteraction).
> Eventually _all_ interactions that create normal and shear forces should
> derive from NormalShearInteraction and there will be no need for casts.
>
> Those parent classes store kn and ks as well, therefore the current
> GlobalStiffnessCounter will work for many different types of
> interactions, provided they have defined kn and ks.
>
> I don't know what other (besides ElasticContactInteraction and
> BrefcomContact) interactions we have but it might be useful to add those
> to this class hierarchy as well, progressively.
>
> I also hope that such generic interactions will reduce code duplication
> (for instance, there is unbalancedForce computation in Triaxial, but now
> it can use this function).
>
>   
Very good. I get it you modified the class hierarchy, or NormalShearI 
has been here for a while and I didn't notice?

>> It made me think the we should keep an updated list of macros used in
>> Yade (YADE_PTR_CAST, FOREACH, REGISTER, etc), since they are either
>> Yade macros, boost macros or any-other-lib macros, it can be a bit
>> complex to read for newcomers.
>>     
> If you create a wiki page, I will edit the macros I know something about.
>
> Oh, any reason why global stiffness timestepper is 2 engines (GSCounter
> and GSTimeStepper)? You could have just 1 engine that would compute
> stiffnesses (store them not in physicalActions, but in a vector<Real> or
> such) and then compute the timestep. (The code would also be easier to
> understand -- in 1 place)
>   
Agreed. Two main reasons for current situation :
1. I tried to comply with Yade design - in a stupid way maybe.
2. Global stiffness is (probably more "could" or "should", in fact...) 
also used to control the stress on walls. So the stiffness data is a bit 
more general than just timestep computing.

One more reason to merge : if somebody makes the mistake of setting 
different intervals in counter and timestepper, it could result in a 
strange behaviour, perhaps uninitialized values, etc.

Bruno




> _______________________________________________
> Mailing list: https://launchpad.net/~yade-dev
> Post to     : yade-dev at lists.launchpad.net
> Unsubscribe : https://launchpad.net/~yade-dev
> More help   : https://help.launchpad.net/ListHelp
>
>
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Grenoble INP
Laboratoire 3SR - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________



From bruno.chareyre at hmg.inpg.fr  Wed Sep 24 12:01:19 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Wed, 24 Sep 2008 12:01:19 +0200
Subject: [deprecated list] [Yade-dev] Shop::unbalancedForce
In-Reply-To: <48DA0705.2070607@arcig.cz>
References: <48D9FDD1.7070508@arcig.cz> <48DA046C.6030404@hmg.inpg.fr>
	<48DA0705.2070607@arcig.cz>
Message-ID: <48DA0FEF.1070106@hmg.inpg.fr>

V?clav ?milauer a ?crit :
>> It looks correct. Usage is restricted to NormalShearInteractions (I
>> guess yes), or can we cast different Interaction types to this?
> Well, ElasticContactInteraction (for instance) derives from
> NormalShearInteraction (which in turn derives from NormalInteraction).
> Eventually _all_ interactions that create normal and shear forces should
> derive from NormalShearInteraction and there will be no need for casts.
>
> Those parent classes store kn and ks as well, therefore the current
> GlobalStiffnessCounter will work for many different types of
> interactions, provided they have defined kn and ks.
>
> I don't know what other (besides ElasticContactInteraction and
> BrefcomContact) interactions we have but it might be useful to add those
> to this class hierarchy as well, progressively.
>
> I also hope that such generic interactions will reduce code duplication
> (for instance, there is unbalancedForce computation in Triaxial, but now
> it can use this function).
>
Very good. I get it you modified the class hierarchy, or NormalShearI 
has been here for a while and I didn't notice?

>> It made me think the we should keep an updated list of macros used in
>> Yade (YADE_PTR_CAST, FOREACH, REGISTER, etc), since they are either
>> Yade macros, boost macros or any-other-lib macros, it can be a bit
>> complex to read for newcomers.
> If you create a wiki page, I will edit the macros I know something about.
>
> Oh, any reason why global stiffness timestepper is 2 engines (GSCounter
> and GSTimeStepper)? You could have just 1 engine that would compute
> stiffnesses (store them not in physicalActions, but in a vector<Real> or
> such) and then compute the timestep. (The code would also be easier to
> understand -- in 1 place)
Agreed. Two main reasons for current situation :
1. I tried to comply with Yade design - in a stupid way maybe.
2. Global stiffness is (probably more "could" or "should", in fact...) 
also used to control the stress on walls. So the stiffness data is a bit 
more general than just timestep computing.

One more reason to merge : if somebody makes the mistake of setting 
different intervals in counter and timestepper, it could result in a 
strange behaviour, perhaps uninitialized values, etc.

Bruno



-- 
 
_______________
Chareyre Bruno
Maitre de conference

Grenoble INP
Laboratoire 3SR - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Wed Sep 24 12:17:30 2008
From: eudoxos at arcig.cz (=?UTF-8?Q?V=C3=A1clav_=C5=A0milauer?=)
Date: Wed, 24 Sep 2008 12:17:30 +0200
Subject: [deprecated list] [Yade-dev] Shop::unbalancedForce
In-Reply-To: <48DA0FEF.1070106@hmg.inpg.fr>
References: <48D9FDD1.7070508@arcig.cz> <48DA046C.6030404@hmg.inpg.fr>
	<48DA0705.2070607@arcig.cz>  <48DA0FEF.1070106@hmg.inpg.fr>
Message-ID: <1222251450.26970.3.camel@falx>


> > I also hope that such generic interactions will reduce code duplication
> > (for instance, there is unbalancedForce computation in Triaxial, but now
> > it can use this function).
> >
> Very good. I get it you modified the class hierarchy, or NormalShearI 
> has been here for a while and I didn't notice?

No, that is quite a recent addition, mainly because of SDECLinkPhysics
vs. other very similar classes; I also hope it will accelerate getting
rid of persistentInteractions and consolidate some other code.

> Agreed. Two main reasons for current situation :
> 1. I tried to comply with Yade design - in a stupid way maybe.
> 2. Global stiffness is (probably more "could" or "should", in fact...) 
> also used to control the stress on walls. So the stiffness data is a bit 
> more general than just timestep computing.
> 
> One more reason to merge : if somebody makes the mistake of setting 
> different intervals in counter and timestepper, it could result in a 
> strange behaviour, perhaps uninitialized values, etc.

Go ahead with that, I think that will be much friendlier, indeed.

Vaclav



_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From sj2001 at yandex.ru  Thu Sep 25 08:41:09 2008
From: sj2001 at yandex.ru (sega)
Date: Thu, 25 Sep 2008 10:41:09 +0400
Subject: [deprecated list] [Yade-dev] new algorithm for facets
In-Reply-To: <48DA05BD.1020408@hmg.inpg.fr>
References: <200809132208.35739.sj2001@yandex.ru>
	<200809231749.44966.sj2001@yandex.ru>
	<48DA05BD.1020408@hmg.inpg.fr>
Message-ID: <200809251041.10043.sj2001@yandex.ru>

> Does this means that edges can have a radius too, like a cylinder 
> between the two nodes?

No.
on fig below O is a sphere, --- is a facet's surface, * is a edge
if shrinkFactor=0 we have doubled contact on a edge like this:
   O
    ||
----*----

if shrinkFactor>0 we have a gap between facets and two contacts like this:
     O
     /\
----*  *----
when a gap size is 2*R*shrinkFactor.

ps.  I think this can be even removed, but let until...

-- 
Best regards, Sergei D.

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From jduriez at mail.berlios.de  Thu Sep 25 19:19:58 2008
From: jduriez at mail.berlios.de (jduriez at BerliOS)
Date: Thu, 25 Sep 2008 19:19:58 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1527 - trunk/pkg/dem
Message-ID: <200809251719.m8PHJwAI032027@sheep.berlios.de>

Author: jduriez
Date: 2008-09-25 19:19:57 +0200 (Thu, 25 Sep 2008)
New Revision: 1527

Modified:
   trunk/pkg/dem/SConscript
Log:
- Add of the paragraph for the CL1Relationships, which was forgotten, in the corresponding SConscript


Modified: trunk/pkg/dem/SConscript
===================================================================
--- trunk/pkg/dem/SConscript	2008-09-25 15:50:16 UTC (rev 1526)
+++ trunk/pkg/dem/SConscript	2008-09-25 17:19:57 UTC (rev 1527)
@@ -162,6 +162,17 @@
 			'ParticleParameters',
 			'InteractionPhysicsMetaEngine']),
 
+	env.SharedLibrary('CL1Relationships',
+		['Engine/EngineUnit/CL1Relationships.cpp'],
+		LIBS=env['LIBS']+['SDECLinkPhysics',
+			'SDECLinkGeometry',
+			'CL1Interaction',
+			'SpheresContactGeometry',
+			'CohesiveFrictionalBodyParameters',
+			'RigidBodyParameters',
+			'ParticleParameters',
+			'InteractionPhysicsMetaEngine']),
+
 	env.SharedLibrary('ElasticContactLaw',
 		['Engine/StandAloneEngine/ElasticContactLaw.cpp'],
 		LIBS=env['LIBS']+['SDECLinkPhysics',


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Thu Sep 25 20:23:57 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Thu, 25 Sep 2008 20:23:57 +0200
Subject: [deprecated list] [Yade-dev]   [svn] r1527 - trunk/pkg/dem
In-Reply-To: <200809251719.m8PHJwAI032027@sheep.berlios.de>
References: <200809251719.m8PHJwAI032027@sheep.berlios.de>
Message-ID: <20080925202357.3d0d5371@szpak>

jduriez at BerliOS said:     (by the date of Thu, 25 Sep 2008 19:19:58 +0200)

> - Add of the paragraph for the CL1Relationships, which was forgotten, in the corresponding SConscript

Did you remember to 'svn add' the CL1Relationships.cpp .hpp and commit it?

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From jduriez at mail.berlios.de  Fri Sep 26 10:02:13 2008
From: jduriez at mail.berlios.de (jduriez at BerliOS)
Date: Fri, 26 Sep 2008 10:02:13 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1528 - trunk/pkg/dem
Message-ID: <200809260802.m8Q82DfS028074@sheep.berlios.de>

Author: jduriez
Date: 2008-09-26 10:02:12 +0200 (Fri, 26 Sep 2008)
New Revision: 1528

Modified:
   trunk/pkg/dem/SConscript
Log:
A (last ?) error concerning last revision in the paragraph CL1Relationships : "CL1Interaction" does not exist, that's ContactLaw1Interaction



Modified: trunk/pkg/dem/SConscript
===================================================================
--- trunk/pkg/dem/SConscript	2008-09-25 17:19:57 UTC (rev 1527)
+++ trunk/pkg/dem/SConscript	2008-09-26 08:02:12 UTC (rev 1528)
@@ -166,7 +166,7 @@
 		['Engine/EngineUnit/CL1Relationships.cpp'],
 		LIBS=env['LIBS']+['SDECLinkPhysics',
 			'SDECLinkGeometry',
-			'CL1Interaction',
+			'ContactLaw1Interaction',
 			'SpheresContactGeometry',
 			'CohesiveFrictionalBodyParameters',
 			'RigidBodyParameters',


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Fri Sep 26 11:42:14 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Fri, 26 Sep 2008 11:42:14 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1529 - in
	trunk:	core/DefaultContainerImplementations gui/py
	pkg/common/Container
Message-ID: <200809260942.m8Q9gEuD004542@sheep.berlios.de>

Author: eudoxos
Date: 2008-09-26 11:42:13 +0200 (Fri, 26 Sep 2008)
New Revision: 1529

Modified:
   trunk/core/DefaultContainerImplementations/BodyRedirectionVector.cpp
   trunk/gui/py/yadeControl.cpp
   trunk/pkg/common/Container/BodyAssocVector.cpp
Log:
1. Avoid compiler warning in optimized builds from pyOmega
2. Body containers now allocate the lowest possible ID for each added body. The old behavior was to allocate the first free ID greater than the ID of the body, if it was already set. Please let me know if this is critical for someone. We can do things like:

	# remove all bodies except spheres (changes IDs)
	o.bodies.replace([b for o.bodies if b.shape.name=='Sphere'])




Modified: trunk/core/DefaultContainerImplementations/BodyRedirectionVector.cpp
===================================================================
--- trunk/core/DefaultContainerImplementations/BodyRedirectionVector.cpp	2008-09-26 08:02:12 UTC (rev 1528)
+++ trunk/core/DefaultContainerImplementations/BodyRedirectionVector.cpp	2008-09-26 09:42:13 UTC (rev 1529)
@@ -89,8 +89,8 @@
 
 	if( used )
 	{
-		unsigned int newPosition = position;
-		// finds the first free key, which is bigger than id.
+		// finds the first free key (was: which is bigger than id... why bigger??)
+		unsigned int newPosition = 0; // was: newPosition=position;
 		bool newUsed = true;
 		while( newUsed )
 		{

Modified: trunk/gui/py/yadeControl.cpp
===================================================================
--- trunk/gui/py/yadeControl.cpp	2008-09-26 08:02:12 UTC (rev 1528)
+++ trunk/gui/py/yadeControl.cpp	2008-09-26 09:42:13 UTC (rev 1529)
@@ -284,6 +284,7 @@
 	}
 	body_id_t insert(pyBody b){return proxee->insert(b.proxee);}
 	python::list insertList(python::list bb){python::list ret; for(int i=0; i<len(bb); i++){ret.append(insert(python::extract<pyBody>(bb[i])()));} return ret;}
+	python::list replace(python::list bb){proxee->clear(); return insertList(bb);}
 	long length(){return proxee->size();}
 	void clear(){proxee->clear();}
 };
@@ -407,8 +408,7 @@
 	void run(long int numIter=-1,bool doWait=false){
 		if(numIter>0) OMEGA.getRootBody()->stopAtIteration=OMEGA.getCurrentIteration()+numIter;
 		OMEGA.startSimulationLoop();
-		long toGo=OMEGA.getRootBody()->stopAtIteration-OMEGA.getCurrentIteration();
-		LOG_DEBUG("RUN"<<(toGo>0?string(" ("+lexical_cast<string>(toGo)+" to go)"):string(""))<<"!");
+		LOG_DEBUG("RUN"<<((OMEGA.getRootBody()->stopAtIteration-OMEGA.getCurrentIteration())>0?string(" ("+lexical_cast<string>(OMEGA.getRootBody()->stopAtIteration-OMEGA.getCurrentIteration())+" to go)"):string(""))<<"!");
 		if(doWait) wait();
 	}
 	void pause(){Py_BEGIN_ALLOW_THREADS; OMEGA.stopSimulationLoop(); Py_END_ALLOW_THREADS; LOG_DEBUG("PAUSE!");}
@@ -545,7 +545,8 @@
 		.def("__len__",&pyBodyContainer::length)
 		.def("append",&pyBodyContainer::insert)
 		.def("append",&pyBodyContainer::insertList)
-		.def("clear", &pyBodyContainer::clear);
+		.def("clear", &pyBodyContainer::clear)
+		.def("replace",&pyBodyContainer::replace);
 	boost::python::class_<pyInteractionContainer>("InteractionContainer",python::init<pyInteractionContainer&>())
 		.def("__iter__",&pyInteractionContainer::pyIter)
 		.def("__getitem__",&pyInteractionContainer::pyGetitem)

Modified: trunk/pkg/common/Container/BodyAssocVector.cpp
===================================================================
--- trunk/pkg/common/Container/BodyAssocVector.cpp	2008-09-26 08:02:12 UTC (rev 1528)
+++ trunk/pkg/common/Container/BodyAssocVector.cpp	2008-09-26 09:42:13 UTC (rev 1529)
@@ -86,8 +86,8 @@
 	tmpBii = bodies.find(position);
 	if( tmpBii != bodies.end() )
 	{
-		unsigned int newPosition = position;
-		// finds the first free key, which is bigger than id.
+		// finds the first free key, which is bigger than 0 (was: newPoistion=position, i.e. greater than id... why?)
+		unsigned int newPosition = 0;
 		while( bodies.find(newPosition) != bodies.end() )
 			++newPosition;
 		//cerr << "WARNING: body id=\"" << position << "\" is already used. Using first free id=\"" << newPosition << "\", beware - if you are loading a file, this will break interactions for this body!\n";


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Fri Sep 26 11:51:49 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Fri, 26 Sep 2008 11:51:49 +0200
Subject: [deprecated list] [Yade-dev] ContactLaw1
In-Reply-To: <200809260802.m8Q82DfS028074@sheep.berlios.de>
References: <200809260802.m8Q82DfS028074@sheep.berlios.de>
Message-ID: <48DCB0B5.3090808@arcig.cz>

Jerome,

I am sorry, but how about some more meaningful name instead of
"ContactLaw1"?

Second, for the roll angle and so on: I would be glad if those things
could move to SpheresContactGeometry, like I did it with shear, so that
constitutive laws don't repeat the same code over and over (the same for
twisting). If you can elaborate what angle do you need for your law and
how tom compute it from geometry, I will try to implement that within
the contact geom.

Regards, Vaclav


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From duriez at geo.hmg.inpg.fr  Fri Sep 26 09:38:46 2008
From: duriez at geo.hmg.inpg.fr (Jerome Duriez)
Date: Fri, 26 Sep 2008 09:38:46 +0200
Subject: [deprecated list] [Yade-dev]   [svn] r1527 - trunk/pkg/dem
In-Reply-To: <20080925202357.3d0d5371@szpak>
References: <200809251719.m8PHJwAI032027@sheep.berlios.de>
	<20080925202357.3d0d5371@szpak>
Message-ID: <48DC9186.4010405@geo.hmg.inpg.fr>


Janek Kozicki a ?crit :
> jduriez at BerliOS said:     (by the date of Thu, 25 Sep 2008 19:19:58 +0200)
>
>   
>> - Add of the paragraph for the CL1Relationships, which was forgotten, in the corresponding SConscript
>>     
>
> Did you remember to 'svn add' the CL1Relationships.cpp .hpp and commit it?
>
>   
Yes. In fact this r1527 was a second commit after a r1526 one with all 
files added (these CL1Relationsships plus others) but with this 
paragraph forgotten. I was automatically answered that the mail was big 
and so waits for a moderator approval. Didn't you hear about it ? (I 
guessed it was you the moderator...)

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From duriez at geo.hmg.inpg.fr  Fri Sep 26 12:28:41 2008
From: duriez at geo.hmg.inpg.fr (Jerome Duriez)
Date: Fri, 26 Sep 2008 12:28:41 +0200
Subject: [deprecated list] [Yade-dev] ContactLaw1
In-Reply-To: <48DCB0B5.3090808@arcig.cz>
References: <200809260802.m8Q82DfS028074@sheep.berlios.de>
	<48DCB0B5.3090808@arcig.cz>
Message-ID: <48DCB959.6040209@geo.hmg.inpg.fr>


V?clav S a ?crit :
> Jerome,
>
> I am sorry, but how about some more meaningful name instead of
> "ContactLaw1"?
>
>   
I am even more sorry than you but I have sincerely not much idea. As I 
wrote it in the files this law is in fact quite similar to the 
CohesiveFrictionnalContactLaw. The differences are :
- there is nothing more linked with "brokenBodies"
- no creep (I just noticed that I could have suppressed the comments, sorry)
- no more adhesion or cohesion
- the main new point is the inelastic behaviour in compression, with the 
"coeff_dech" variable
And as in CohesiveFrictionalContactLaw there is computation of moment 
for example.
Because I personnly didn't understand, thanks to the name, that for 
example in CohesiveFrictionalContactLaw you can simulate moment transfer 
or creep (that's the same for all contact laws and I would even say that 
for all the yade source files ;-) ) I didn't indeed search for an other 
name... Maybe "InelasticCompressionAndMomentTransferContactLaw" ?? But I 
thought you don't like long names... So again very sorry : I don't want 
to offense anyone but sincerely I don't see which name I could give... 
If the suggestion above satisfies you, or if you have better ideas, feel 
free to rename it, I don't mind (it honours you to look after meaningful 
names !)
NB : Moreover I don't know how to rename svn tracked files...
> Second, for the roll angle and so on: I would be glad if those things
> could move to SpheresContactGeometry, like I did it with shear, so that
> constitutive laws don't repeat the same code over and over (the same for
> twisting).
> If you can elaborate what angle do you need for your law and
> how tom compute it from geometry, I will try to implement that within
> the contact geom.
>
> Regards, Vaclav
>
>
>   
I understand it very well. I didn't notice you made attempts in this 
field, sorry. All that concerns moment transfer was purely and simply 
copied-pasted from CohesiveFrictionalContactLaw (with only the add a of 
plastic threshold). So I believe that this is Janek who wrote the lines 
I copied, so I think that he would answer you much better than me... 
This work has not yet been done also in CohesiveFrictionalContactLaw 
isn't it ?

Tell me if you have other remarks, I'll try to answer as better as I 
can... (that was the case in this mail even if I could not answer you 
precisely !)

Jerome

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Fri Sep 26 13:54:54 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Fri, 26 Sep 2008 13:54:54 +0200
Subject: [deprecated list] [Yade-dev] r1529 - in
 trunk:	core/DefaultContainerImplementations gui/py pkg/common/Container
In-Reply-To: <200809260942.m8Q9gEuD004542@sheep.berlios.de>
References: <200809260942.m8Q9gEuD004542@sheep.berlios.de>
Message-ID: <20080926135454.08978131@szpak>

eudoxos at BerliOS said:     (by the date of Fri, 26 Sep 2008 11:42:14 +0200)

> 1. Avoid compiler warning in optimized builds from pyOmega
> 2. Body containers now allocate the lowest possible ID for each added body. The old behavior was to allocate the first free ID greater than the ID of the body, if it was already set. Please let me know if this is critical for someone. We can do things like:
> 
> 	# remove all bodies except spheres (changes IDs)
> 	o.bodies.replace([b for o.bodies if b.shape.name=='Sphere'])

... And SAP collider is not crashing? :) Good that you have made that
automatic crash test.


-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Fri Sep 26 14:12:11 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Fri, 26 Sep 2008 14:12:11 +0200
Subject: [deprecated list] [Yade-dev]   ContactLaw1
In-Reply-To: <48DCB959.6040209@geo.hmg.inpg.fr>
References: <200809260802.m8Q82DfS028074@sheep.berlios.de>
	<48DCB0B5.3090808@arcig.cz> <48DCB959.6040209@geo.hmg.inpg.fr>
Message-ID: <20080926141211.18247d5f@szpak>

Jerome Duriez said:     (by the date of Fri, 26 Sep 2008 12:28:41 +0200)

Hi Jerome,

In CohesiveFrictionalContactLaw you can disable moment transefer
law, and snow creep. It is all controlled by bool variables. When
they are disabled - calculation is exactly as fast as when their code
is deleted.

So it is better if you simply modify CohesiveFrictionalContactLaw by
adding:

- a new bool veriable to control if 'inelastic behaviour in
  compression' is used. 

- Then put your inelastic code in there inside block:

  if(inelastic behaviour in compression) // pick any name you want for this bool :)
  {
    //.... your law here !
  }


We are trying to remove unnecessary/duplicated laws. There is one reason for it:

- if in the future I will find a serious bug in CohesiveFrictionalContactLaw
  I'll fix it. But I will not fix this bug in your file (which is just
  a copy of mine!).

- and now my file is good, and your file has a bug which was not fixed!

This already happened few times, when I was working with Bruno. And
we had to fix the same calculation bug in several files (with law) - it
is hard to remember about all those laws! The less the better: we are
less likely to forgot that other file has the same bug.



When you finish doing this you can run two simulations - one with
your law, and another with CohesiveFrictionalContactLaw + inelastic
behaviour. And compare:

  - speed
  - if results are the same

If you make no mistake - you will get exactly the same results in the same speed!


You can disable adhesion and cohesion by setting zero
cohesive/adhesive strength for them.


> NB : Moreover I don't know how to rename svn tracked files...

that's 'svn mv old_name new_name' command.


-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Fri Sep 26 14:14:18 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Fri, 26 Sep 2008 14:14:18 +0200
Subject: [deprecated list] [Yade-dev] r1527 - trunk/pkg/dem
In-Reply-To: <48DC9186.4010405@geo.hmg.inpg.fr>
References: <200809251719.m8PHJwAI032027@sheep.berlios.de>
	<20080925202357.3d0d5371@szpak> <48DC9186.4010405@geo.hmg.inpg.fr>
Message-ID: <20080926141418.10c984e7@szpak>

Jerome Duriez said:     (by the date of Fri, 26 Sep 2008 09:38:46 +0200)

> Yes. In fact this r1527 was a second commit after a r1526 one with all 
> files added (these CL1Relationsships plus others) but with this 
> paragraph forgotten. I was automatically answered that the mail was big 
> and so waits for a moderator approval. Didn't you hear about it ? (I 
> guessed it was you the moderator...)

OK. Lauchpad does not let through messages bigger than 20kb. We are
waiting for admins to respond on this problem.

Do you have this commit email somewhere? If yes - could you send it
on private email of Vaclav and me?

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Fri Sep 26 20:31:59 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Fri, 26 Sep 2008 20:31:59 +0200
Subject: [deprecated list] [Yade-dev] scons -h not working with profiles.
Message-ID: <20080926203159.4d837cec@szpak>

Hi,

I wanted to check the compilation options, quickly, with 'scons -h'.

And so I had to wait about 3 minutes.... and didn't see the options:


janek at szpak:~/40-Yade/Code/HEAD/trunk$ scons -h
scons: Reading SConscript files ...
@@@ Using profile fast (scons.profile-fast) @@@
@@@ Using profile slow (scons.profile-slow) @@@
Yade version is `0.12', installed files will be suffixed with `-0.12-fast'.
All intermediary files will be in `/home/janek/20-Programowanie/10-cpp/50-Yade/Code/HEAD/build-0.12-fast'.
Yade version is `0.12', installed files will be suffixed with `-0.12-slow'.
All intermediary files will be in `/home/janek/20-Programowanie/10-cpp/50-Yade/Code/HEAD/build-0.12-slow'.
scons: `install' is up to date.
scons: `/home/janek/40-Yade/Bin/HEAD-fast' is up to date.
scons: `install' is up to date.
scons: `/home/janek/40-Yade/Bin/HEAD-slow' is up to date.
janek at szpak:~/40-Yade/Code/HEAD/trunk$ 


Obviously it's because of profiles. So I do this:

$ scons profile=slow -h

and it works.

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Sat Sep 27 11:30:05 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Sat, 27 Sep 2008 11:30:05 +0200
Subject: [deprecated list] [Yade-dev] r1529 - in
 trunk:	core/DefaultContainerImplementations gui/py pkg/common/Container
In-Reply-To: <20080926135454.08978131@szpak>
References: <200809260942.m8Q9gEuD004542@sheep.berlios.de>
	<20080926135454.08978131@szpak>
Message-ID: <48DDFD1D.3040005@arcig.cz>


>> 	# remove all bodies except spheres (changes IDs)
>> 	o.bodies.replace([b for o.bodies if b.shape.name=='Sphere'])
>>     
>
> ... And SAP collider is not crashing? :) Good that you have made that
> automatic crash test.
>   
I was replacing all engines at the same time, so I don't know about the
collider. But it was easier than saving all sphere params to some
separate file and loading them afterwards.



_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Sat Sep 27 12:31:56 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Sat, 27 Sep 2008 12:31:56 +0200
Subject: [deprecated list] [Yade-dev]   ContactLaw1
In-Reply-To: <20080926141211.18247d5f@szpak>
References: <200809260802.m8Q82DfS028074@sheep.berlios.de>	<48DCB0B5.3090808@arcig.cz>
	<48DCB959.6040209@geo.hmg.inpg.fr> <20080926141211.18247d5f@szpak>
Message-ID: <48DE0B9C.1050009@arcig.cz>


> So it is better if you simply modify CohesiveFrictionalContactLaw by
> adding:
>
> - a new bool veriable to control if 'inelastic behaviour in
>   compression' is used. 
>
> - Then put your inelastic code in there inside block:
>
>   if(inelastic behaviour in compression) // pick any name you want for this bool :)
>   {
>     //.... your law here !
>   }
>   
I disagree with this approach. The code that computes mutual rotation
etc. is geometry problem and should be coded once in
SpheresContactGeometry and not in cohesive frictional law. How about
someone needing a completely different law (my own Brefcom comes in
mind), not just a bool flag in existing one?

Constitutive law (normally) is a function that converts from strains to
streses (or displacements to forces) and I think it should do _just_ that.
> This already happened few times, when I was working with Bruno. And
> we had to fix the same calculation bug in several files (with law) - it
> is hard to remember about all those laws! The less the better: we are
> less likely to forgot that other file has the same bug.
>   
If the constitutive law is simple as

// loop over interactions etc
Fn=contactGeom->strainN()*crossSection*E;
Ft=contactGeom->strainT()*crossSection*G;
// apply forces here

the code for computing strain being elsewhere, then that code is still
in one place (and can be fixed at one place) and the constitutive law is
not a mess of flags.

V.

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Sat Sep 27 13:37:34 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Sat, 27 Sep 2008 13:37:34 +0200
Subject: [deprecated list] [Yade-dev] ContactLaw1
In-Reply-To: <48DE0B9C.1050009@arcig.cz>
References: <200809260802.m8Q82DfS028074@sheep.berlios.de>
	<48DCB0B5.3090808@arcig.cz> <48DCB959.6040209@geo.hmg.inpg.fr>
	<20080926141211.18247d5f@szpak> <48DE0B9C.1050009@arcig.cz>
Message-ID: <20080927133734.6cb5f3a9@szpak>

V?clav S(milauer said:     (by the date of Sat, 27 Sep 2008 12:31:56 +0200)

> Constitutive law (normally) is a function that converts from strains to
> streses (or displacements to forces) and I think it should do _just_ that.
> > This already happened few times, when I was working with Bruno. And
> > we had to fix the same calculation bug in several files (with law) - it
> > is hard to remember about all those laws! The less the better: we are
> > less likely to forgot that other file has the same bug.
> >   
> If the constitutive law is simple as
> 
> // loop over interactions etc
> Fn=contactGeom->strainN()*crossSection*E;
> Ft=contactGeom->strainT()*crossSection*G;
> // apply forces here
> 
> the code for computing strain being elsewhere, then that code is still
> in one place (and can be fixed at one place) and the constitutive law is
> not a mess of flags.

Yes, this solution is much better. Care to split the laws into such
parts? This would make all those laws a lot simpler.

I was telling him the solution which is currently being used. bool
flags (and an evergrowing law file) is a little better than 200 lines of
code (with possible bugs) duplicated in several places.

But of course splitting the laws into several independent files
is *A LOT* better.



> >   if(inelastic behaviour in compression) // pick any name you want for this bool :)
> >   {
> >     //.... your law here !
> >   }
> >   
> I disagree with this approach. The code that computes mutual rotation
> etc. is geometry problem and should be coded once in
> SpheresContactGeometry and not in cohesive frictional law.

och. I didn't tknow that he is doing something that belongs to SpheresContactGeometry (I didn't look at this code, to be honest, sorry).

If you say that his "extra" changes from my law should be done in SpheresContactGeometry - then move them there of course :)


> How about
> someone needing a completely different law (my own Brefcom comes in
> mind), not just a bool flag in existing one?

then of course it must be a new law :) Lattice is another example :>

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Sun Sep 28 00:10:11 2008
From: eudoxos at arcig.cz (eudoxos at arcig.cz)
Date: Sun, 28 Sep 2008 00:10:11 +0200 (CEST)
Subject: [deprecated list] [Yade-dev] Automated crash report
	for	/tmp/yade-29163/bin/yade-svn1529:	DirectShearCis, FEMBeam,
	HydraulicTest, SDECImpactTest, STLImporterTest, SimpleShear
Message-ID: <20080927221011.9682C98065@delta>

################################################################################
DirectShearCis: generator CRASH
################################################################################
Running script /tmp/yade-test-2628.py
Cannot find input file
Traceback (most recent call last):
  File "/tmp/yade-29163/lib/yade-svn1529/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-2628.py", line 3, in <module>
    Preprocessor('DirectShearCis').generate('/tmp/yade-test-2628.xml')
RuntimeError: Generator reported error: Cannot find input file

################################################################################
FEMBeam: generator CRASH
################################################################################
Running script /tmp/yade-test-2628.py
/tmp/yade-29163/build-svn1529/include/yade-svn1529/yade/core/MetaEngine1D.hpp:57 WARNING! dynamic cast of engine unit FEMTetrahedronStiffness failed, will use static_cast. Go figure why.
/tmp/yade-29163/build-svn1529/include/yade-svn1529/yade/core/MetaEngine2D.hpp:61 WARNING! dynamic cast of engine unit FEMSet2Tetrahedrons failed, will use static_cast. Go figure why.
Traceback (most recent call last):
  File "/tmp/yade-29163/lib/yade-svn1529/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-2628.py", line 3, in <module>
    Preprocessor('FEMBeam').generate('/tmp/yade-test-2628.xml')
RuntimeError: Generator reported error: Cannot find input file, you can copy it from examples/ directory

################################################################################
HydraulicTest: generator CRASH
################################################################################
Traceback (most recent call last):
  File "/tmp/yade-29163/lib/yade-svn1529/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-2628.py", line 3, in <module>
    Preprocessor('HydraulicTest').generate('/tmp/yade-test-2628.xml')
RuntimeError: Generator reported error: Error: cannot load the file that should contain spheres
Running script /tmp/yade-test-2628.py

################################################################################
SDECImpactTest: generator CRASH
################################################################################
Traceback (most recent call last):
  File "/tmp/yade-29163/lib/yade-svn1529/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-2628.py", line 3, in <module>
    Preprocessor('SDECImpactTest').generate('/tmp/yade-test-2628.xml')
RuntimeError: Generator reported error: Cannot find input file, you can copy it from examples/ directory
Running script /tmp/yade-test-2628.py

################################################################################
STLImporterTest: generator CRASH
################################################################################
Running script /tmp/yade-test-2628.py
Import walls geometry from file: hourglass.stl
556 [140511975831344] ERROR yade.STLImporter  - lib/import/STLImporter.cpp:27 open: Can't open file: hourglass.stl
ERROR: Bad file: hourglass.stl
Traceback (most recent call last):
  File "/tmp/yade-29163/lib/yade-svn1529/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-2628.py", line 3, in <module>
    Preprocessor('STLImporterTest').generate('/tmp/yade-test-2628.xml')
RuntimeError: Generator reported error: Input file not found, you can copy it from examples/ directory or make one using blender 3D modelling

################################################################################
SimpleShear: generator CRASH
################################################################################
Running script /tmp/yade-test-2628.py
Cannot find input file
Traceback (most recent call last):
  File "/tmp/yade-29163/lib/yade-svn1529/gui/PythonUI_rc.py", line 32, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-2628.py", line 3, in <module>
    Preprocessor('SimpleShear').generate('/tmp/yade-test-2628.xml')
RuntimeError: Generator reported error: Cannot find input file

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Sun Sep 28 13:20:54 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Sun, 28 Sep 2008 13:20:54 +0200
Subject: [deprecated list] [Yade-dev] Xserver hard freeze on intel GPU
Message-ID: <48DF6896.40003@arcig.cz>

Could someone with relatively recent code run a script like this (save
as e.g. /tmp/a.py, then run "yade-trunk /tmp/a.py")? (It is not enough
to type that into the python console, that doesn't freeze here.)

 from yade import qt
 qt.View()
 v0=qt.View(); v0.grid=(True,True,True); v0.axes=True; v0.lookAt=(1,1,1)
 print "All OK"

I am getting hard X server freeze when running that and I suppose it is
a video driver issue. I am on an integrated intel chip, if you have
nvidia or ati card, I will be glad to hear from you.

Thanks, Vaclav

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Sun Sep 28 14:37:32 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Sun, 28 Sep 2008 14:37:32 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1530 - in trunk: core gui
	gui/py gui/qt3 scripts
Message-ID: <200809281237.m8SCbWDE004931@sheep.berlios.de>

Author: eudoxos
Date: 2008-09-28 14:37:30 +0200 (Sun, 28 Sep 2008)
New Revision: 1530

Added:
   trunk/scripts/simple-scene-video.py
Modified:
   trunk/core/Omega.cpp
   trunk/core/Omega.hpp
   trunk/gui/SConscript
   trunk/gui/py/utils.py
   trunk/gui/qt3/GLSimulationPlayerViewer.cpp
   trunk/gui/qt3/GLSimulationPlayerViewer.hpp
   trunk/gui/qt3/GLViewer.cpp
   trunk/gui/qt3/GLViewer.hpp
   trunk/gui/qt3/QtGUI-python.cpp
   trunk/gui/qt3/YadeQtMainWindow.hpp
   trunk/gui/qt3/qt.py
   trunk/scripts/simple-scene-player.py
Log:
1. 3d view now has by default a OSD with iteration number, simulation time and virtual time. This can be toggled (all combinations) by pressing 'D' (which used to mean toggling d+ynamic flag...?) and set also from python with GLView.timeMask='rvi' (Real,Virtual,Iteration) and so on.
2. Simulation player displays real time and wall clock loaded from db (insted of bogus values of system clock when the player is being run)
3. new periodic SnapshotEngine that takes snapshots of any GL view to numbered PNG files.
4. new function qt.makeSimulationVideo that makes video _while running the simulation_.
5. qt.createVideo renamed to qt.makePlayerVideo
6. Added Omega method to query computation duration.
7. An example of using qt.makeSimulationVideo is in new file scripts/simple-scene-video.py



Modified: trunk/core/Omega.cpp
===================================================================
--- trunk/core/Omega.cpp	2008-09-26 09:42:13 UTC (rev 1529)
+++ trunk/core/Omega.cpp	2008-09-28 12:37:30 UTC (rev 1530)
@@ -56,6 +56,7 @@
 ptime Omega::getMsStartingSimulationTime(){return msStartingSimulationTime;}
 time_duration Omega::getSimulationPauseDuration(){return simulationPauseDuration;}
 Real Omega::getComputationTime(){ return (microsec_clock::local_time()-msStartingSimulationTime-simulationPauseDuration).total_milliseconds()/1e3; }
+time_duration Omega::getComputationDuration(){return microsec_clock::local_time()-msStartingSimulationTime-simulationPauseDuration;}
 
 
 void Omega::reset(){

Modified: trunk/core/Omega.hpp
===================================================================
--- trunk/core/Omega.hpp	2008-09-26 09:42:13 UTC (rev 1529)
+++ trunk/core/Omega.hpp	2008-09-28 12:37:30 UTC (rev 1530)
@@ -148,6 +148,7 @@
 		
 		Real		getSimulationTime();
 		Real 		getComputationTime();
+		time_duration getComputationDuration();
 		void		incrementSimulationTime();
 		
 		void init();

Modified: trunk/gui/SConscript
===================================================================
--- trunk/gui/SConscript	2008-09-26 09:42:13 UTC (rev 1529)
+++ trunk/gui/SConscript	2008-09-28 12:37:30 UTC (rev 1530)
@@ -24,7 +24,7 @@
 				'qt3/QtGeneratedSimulationPlayer.ui',
 				'qt3/QtSimulationPlayer.cpp',
 				],
-			LIBS=env['LIBS']+['yade-base',
+			LIBS=env['LIBS']+linkPythonUI+[
 				'yade-opengl',
 				'yade-serialization',
 				'XMLFormatManager',
@@ -34,8 +34,10 @@
 				'PositionOrientationRecorder',
 				'sqlite3x',
 				'FilterEngine',
-				'$QGLVIEWER_LIB']+linkPythonUI,
-			CPPPATH=env['CPPPATH']+['qt3']),
+				'$QGLVIEWER_LIB'],
+			CPPPATH=env['CPPPATH']+['qt3']
+		),
+		env.SharedLibrary('SnapshotEngine',['qt3/SnapshotEngine.cpp'],LIBS=env['LIBS']+['QtGUI'],CPPPATH=env['CPPPATH']+['qt3']),
 	])
 
 if 'EMBED_PYTHON' in env['CPPDEFINES']:

Modified: trunk/gui/py/utils.py
===================================================================
--- trunk/gui/py/utils.py	2008-09-26 09:42:13 UTC (rev 1529)
+++ trunk/gui/py/utils.py	2008-09-28 12:37:30 UTC (rev 1530)
@@ -198,3 +198,21 @@
 			o.bodies[i].mold.postProcessAttributes()
 		return imp.number_of_facets
 
+def encodeVideoFromFrames(wildcard,out,renameNotOverwrite=True,fps=24):
+	import pygst,sys,gobject,os
+	pygst.require("0.10")
+	import gst
+	if renameNotOverwrite and os.path.exists(out):
+		i=0;
+		while(os.path.exists(out+"~%d"%i)): i+=1
+		os.rename(out,out+"~%d"%i); print "Output file `%s' already existed, old file renamed to `%s'"%(out,out+"~%d"%i)
+	print "Encoding video from %s to %s"%(wildcard,out)
+	pipeline=gst.parse_launch('multifilesrc location="%s" index=0 caps="image/png,framerate=\(fraction\)%d/1" ! pngdec ! ffmpegcolorspace ! theoraenc sharpness=2 quality=32 ! oggmux ! filesink location="%s"'%(wildcard,fps,out))
+	bus=pipeline.get_bus()
+	bus.add_signal_watch()
+	mainloop=gobject.MainLoop();
+	bus.connect("message::eos",lambda bus,msg: mainloop.quit())
+	pipeline.set_state(gst.STATE_PLAYING)
+	mainloop.run()
+	pipeline.set_state(gst.STATE_NULL); pipeline.get_state()
+

Modified: trunk/gui/qt3/GLSimulationPlayerViewer.cpp
===================================================================
--- trunk/gui/qt3/GLSimulationPlayerViewer.cpp	2008-09-26 09:42:13 UTC (rev 1529)
+++ trunk/gui/qt3/GLSimulationPlayerViewer.cpp	2008-09-28 12:37:30 UTC (rev 1530)
@@ -18,6 +18,7 @@
 #include<boost/iostreams/filter/bzip2.hpp>
 #include<boost/iostreams/device/file.hpp>
 #include<boost/algorithm/string.hpp>
+#include<boost/date_time/posix_time/posix_time.hpp>
 
 #include<yade/lib-opengl/OpenGLWrapper.hpp>
 #include<yade/pkg-common/FilterEngine.hpp>
@@ -257,11 +258,23 @@
 			if(col_rgb_b>=0) b->geometricalModel->diffuseColor[2]=reader.getdouble(col_rgb_b);
 		}
 		Omega::instance().setCurrentIteration(con->executeint("select iter from 'records' where bodyTable='"+tableName+"';"));
+		Omega::instance().getRootBody()->simulationTime=con->executedouble("select virtTime from 'records' where bodyTable='"+tableName+"';");
+		realTime=con->executedouble("select realTime from 'records' where bodyTable='"+tableName+"';");
+		wallClock=con->executedouble("select wallClock from 'records' where bodyTable='"+tableName+"';");
 	}
 	FOREACH(const shared_ptr<FilterEngine>& e, filters) { if(e->isActivated()) e->action(Omega::instance().getRootBody().get()); }
 	return true;
 }
 
+string GLSimulationPlayerViewer::getRealTimeString(){
+	ostringstream oss;
+	posix_time::time_duration rt(0,0,(long)realTime,0);
+	oss<<posix_time::to_simple_string(rt)<<"."<<(long)(realTime*10)%10;
+	posix_time::ptime when=posix_time::from_time_t(wallClock);
+	oss<<" ("<<posix_time::to_simple_string(when)<<")";
+	return oss.str();
+}
+
 void GLSimulationPlayerViewer::bodyWire(bool wire)
 {
 //	FOREACH(shared_ptr<Body> b, *Omega::instance().getRootBody()->bodies)

Modified: trunk/gui/qt3/GLSimulationPlayerViewer.hpp
===================================================================
--- trunk/gui/qt3/GLSimulationPlayerViewer.hpp	2008-09-26 09:42:13 UTC (rev 1529)
+++ trunk/gui/qt3/GLSimulationPlayerViewer.hpp	2008-09-28 12:37:30 UTC (rev 1530)
@@ -28,6 +28,9 @@
 		void tryFillingOutputPattern();	
 		bool useSQLite;
 		shared_ptr<sqlite3x::sqlite3_connection> con;
+		//!  read from db, used in getRealTimeString() called in GLViewer::postDraw
+		Real wallClock, realTime;
+		virtual string getRealTimeString();
 	public:
 		list<string> snapshots;
 		QtSimulationPlayer* simPlayer;

Modified: trunk/gui/qt3/GLViewer.cpp
===================================================================
--- trunk/gui/qt3/GLViewer.cpp	2008-09-26 09:42:13 UTC (rev 1529)
+++ trunk/gui/qt3/GLViewer.cpp	2008-09-28 12:37:30 UTC (rev 1530)
@@ -27,6 +27,7 @@
 	renderer=_renderer;
 	drawGridXYZ[0]=drawGridXYZ[1]=drawGridXYZ[2]=false;
 	drawScale=true;
+	timeDispMask=TIME_REAL|TIME_VIRT|TIME_ITER;
 	viewId = id;
 	cut_plane = 0;
 	cut_plane_delta = -2;
@@ -48,7 +49,7 @@
 
 	setKeyDescription(Qt::Key_C,"Set scene center to the selected body (if any)");
 	setKeyDescription(Qt::Key_C & Qt::ALT,"Set scene center to median body position");
-	setKeyDescription(Qt::Key_D,"Toggle Body::isDynamic on selection");
+	setKeyDescription(Qt::Key_D,"Toggle time display mask");
 	setKeyDescription(Qt::Key_G,"Toggle grid");
 	setKeyDescription(Qt::Key_X,"Toggle YZ grid (or: align manipulated clip plane normal with +X)");
 	setKeyDescription(Qt::Key_Y,"Toggle XZ grid (or: align manipulated clip plane normal with +Y)");
@@ -206,7 +207,8 @@
 	/* letters alphabetically */
 	else if(e->key()==Qt::Key_C && selectedName() >= 0 && (*(Omega::instance().getRootBody()->bodies)).exists(selectedName())) setSceneCenter(manipulatedFrame()->position());
 	else if(e->key()==Qt::Key_C && (e->state() & AltButton)){ displayMessage("Median centering"); centerMedianQuartile(); }
-	else if(e->key()==Qt::Key_D) wasDynamic=true;
+	//else if(e->key()==Qt::Key_D) wasDynamic=true;
+	else if(e->key()==Qt::Key_D) {timeDispMask+=1; if(timeDispMask>(TIME_REAL|TIME_VIRT|TIME_ITER))timeDispMask=0; }
 	else if(e->key()==Qt::Key_G) {bool anyDrawn=drawGridXYZ[0]||drawGridXYZ[1]||drawGridXYZ[2]; for(int i=0; i<3; i++)drawGridXYZ[i]=!anyDrawn; }
 	else if (e->key()==Qt::Key_M && selectedName() >= 0){
 		if(!(isMoving=!isMoving)){displayMessage("Moving done."); mouseMovesCamera();}
@@ -490,9 +492,52 @@
 		glPopMatrix();
 	}
 
+	#define _W3 setw(3)<<setfill('0')
+	#define _W2 setw(2)<<setfill('0')
+	if(timeDispMask!=0){
+		const int lineHt=12;
+		unsigned x=10,y=height()-20;
+		glColor3v(Vector3r(1,1,1));
+		if(timeDispMask & GLViewer::TIME_VIRT){
+			ostringstream oss;
+			Real t=Omega::instance().getSimulationTime();
+			unsigned min=((unsigned)t/60),sec=(((unsigned)t)%60),msec=((unsigned)(1e3*t))%1000,usec=((unsigned long)(1e6*t))%1000,nsec=((unsigned long)(1e9*t))%1000;
+			if(min>0) oss<<_W2<<min<<":"<<_W2<<sec<<"."<<_W3<<msec<<"m"<<_W3<<usec<<"u"<<_W3<<nsec<<"n";
+			else if (sec>0) oss<<_W2<<sec<<"."<<_W3<<msec<<"m"<<_W3<<usec<<"u"<<_W3<<nsec<<"n";
+			else if (msec>0) oss<<_W3<<msec<<"m"<<_W3<<usec<<"u"<<_W3<<nsec<<"n";
+			else if (usec>0) oss<<_W3<<usec<<"u"<<_W3<<nsec<<"n";
+			else oss<<_W3<<nsec<<"ns";
+			QGLViewer::drawText(x,y,oss.str());
+			y-=lineHt;
+		}
+		glColor3v(Vector3r(0,.5,.5));
+		if(timeDispMask & GLViewer::TIME_REAL){
+			QGLViewer::drawText(x,y,getRealTimeString() /* virtual, since player gets that from db */);
+			y-=lineHt;
+		}
+		if(timeDispMask & GLViewer::TIME_ITER){
+			ostringstream oss;
+			oss<<"#"<<Omega::instance().getCurrentIteration()<<"\n";
+			QGLViewer::drawText(x,y,oss.str());
+			y-=lineHt;
+		}
+	}
 	QGLViewer::postDraw();
 }
 
+string GLViewer::getRealTimeString(){
+	ostringstream oss;
+	time_duration t=Omega::instance().getComputationDuration();
+	unsigned d=t.hours()/24,h=t.hours()%24,m=t.minutes(),s=t.seconds();
+	oss<<"wall ";
+	if(d>0) oss<<d<<"days "<<_W2<<h<<":"<<_W2<<m<<":"<<_W2<<s;
+	else if(h>0) oss<<_W2<<h<<":"<<_W2<<m<<":"<<_W2<<s;
+	else oss<<_W2<<m<<":"<<_W2<<s;
+	return oss.str();
+}
+#undef _W2
+#undef _W3
+
 void GLViewer::closeEvent(QCloseEvent *e){
 	//emit closeSignal(viewId);
 	YadeQtMainWindow::self->closeView(this);
@@ -549,8 +594,10 @@
 	QDomElement de=document.createElement("gridXYZ");
 	string val; if(drawGridXYZ[0])val+="x"; if(drawGridXYZ[1])val+="y"; if(drawGridXYZ[2])val+="z";
 	de.setAttribute("normals",val);
+	QDomElement de2=document.createElement("timeDisplay"); de2.setAttribute("mask",timeDispMask);
 	QDomElement res=QGLViewer::domElement(name,document);
 	res.appendChild(de);
+	res.appendChild(de2);
 	return res;
 }
 
@@ -559,13 +606,12 @@
 	QGLViewer::initFromDOMElement(element);
 	QDomElement child=element.firstChild().toElement();
 	while (!child.isNull()){
-		if (child.tagName()=="gridXYZ"){
-			if (child.hasAttribute("normals")){
-				string val=child.attribute("normals").lower();
-				drawGridXYZ[0]=false; drawGridXYZ[1]=false; drawGridXYZ[2]=false;
-				if(val.find("x")!=string::npos)drawGridXYZ[0]=true; if(val.find("y")!=string::npos)drawGridXYZ[1]=true; if(val.find("z")!=string::npos)drawGridXYZ[2]=true;
-			}
+		if (child.tagName()=="gridXYZ" && child.hasAttribute("normals")){
+			string val=child.attribute("normals").lower();
+			drawGridXYZ[0]=false; drawGridXYZ[1]=false; drawGridXYZ[2]=false;
+			if(val.find("x")!=string::npos)drawGridXYZ[0]=true; if(val.find("y")!=string::npos)drawGridXYZ[1]=true; if(val.find("z")!=string::npos)drawGridXYZ[2]=true;
 		}
+		if(child.tagName()=="timeDisplay" && child.hasAttribute("mask")) timeDispMask=atoi(child.attribute("mask").ascii());
 		child = child.nextSibling().toElement();
 	}
 }

Modified: trunk/gui/qt3/GLViewer.hpp
===================================================================
--- trunk/gui/qt3/GLViewer.hpp	2008-09-26 09:42:13 UTC (rev 1529)
+++ trunk/gui/qt3/GLViewer.hpp	2008-09-28 12:37:30 UTC (rev 1530)
@@ -55,6 +55,8 @@
 		void centerMedianQuartile();
 		bool 			drawGridXYZ[3];
 		bool 			drawScale;
+		int timeDispMask;
+		enum{TIME_REAL=1,TIME_VIRT=2,TIME_ITER=4};
 
 		GLViewer (int id, shared_ptr<OpenGLRenderingEngine> _renderer, QWidget * parent=0, QGLWidget * shareWidget=0);
 		virtual ~GLViewer (){};
@@ -91,6 +93,8 @@
 	protected :
 		virtual void keyPressEvent(QKeyEvent *e);
 		virtual void postDraw();
+		// overridden in the player that doesn't get time from system clock but from the db
+		virtual string getRealTimeString();
 		virtual void closeEvent(QCloseEvent *e);
 		virtual void postSelection(const QPoint& point);
 		virtual void endSelection(const QPoint &point);

Modified: trunk/gui/qt3/QtGUI-python.cpp
===================================================================
--- trunk/gui/qt3/QtGUI-python.cpp	2008-09-26 09:42:13 UTC (rev 1529)
+++ trunk/gui/qt3/QtGUI-python.cpp	2008-09-28 12:37:30 UTC (rev 1530)
@@ -138,6 +138,8 @@
 		string pyStr(){return string("<GLViewer for view #")+lexical_cast<string>(ensuredMainWindow()->viewNo(glv))+">";}
 		void saveDisplayParameters(size_t n){glv->saveDisplayParameters(n);}
 		void useDisplayParameters(size_t n){glv->useDisplayParameters(n);}
+		string get_timeDisp(){const int& m(glv->timeDispMask); string ret; if(m&GLViewer::TIME_REAL) ret+='r'; if(m&GLViewer::TIME_VIRT) ret+="v"; if(m&GLViewer::TIME_ITER) ret+="i"; return ret;}
+		void set_timeDisp(string s){int& m(glv->timeDispMask); m=0; FOREACH(char c, s){switch(c){case 'r': m|=GLViewer::TIME_REAL; break; case 'v': m|=GLViewer::TIME_VIRT; break; case 'i': m|=GLViewer::TIME_ITER; break; default: throw invalid_argument(string("Invalid flag for timeDisp: `")+c+"'");}}}
 };
 BOOST_PYTHON_MEMBER_FUNCTION_OVERLOADS(pyGLViewer_center_overloads,center,0,1);
 
@@ -178,6 +180,7 @@
 		.add_property("sceneRadius",&pyGLViewer::get_sceneRadius,&pyGLViewer::set_sceneRadius)
 		.add_property("ortho",&pyGLViewer::get_orthographic,&pyGLViewer::set_orthographic)
 		.add_property("screenSize",&pyGLViewer::get_screenSize,&pyGLViewer::set_screenSize)
+		.add_property("timeDisp",&pyGLViewer::get_timeDisp,&pyGLViewer::set_timeDisp)
 		.def("fitAABB",&pyGLViewer::fitAABB)
 		.def("fitSphere",&pyGLViewer::fitSphere)
 		.def("showEntireScene",&pyGLViewer::showEntireScene)

Modified: trunk/gui/qt3/YadeQtMainWindow.hpp
===================================================================
--- trunk/gui/qt3/YadeQtMainWindow.hpp	2008-09-26 09:42:13 UTC (rev 1529)
+++ trunk/gui/qt3/YadeQtMainWindow.hpp	2008-09-28 12:37:30 UTC (rev 1530)
@@ -12,10 +12,10 @@
 #include<qpushbutton.h>
 #include<yade/lib-base/Logging.hpp>
 #include"YadeQtGeneratedMainWindow.h"
-#include"SimulationController.hpp"
-#include"QtFileGenerator.hpp"
-#include"QtSimulationPlayer.hpp"
-#include"QtGUIPreferences.hpp"
+#include<yade/gui-qt3/SimulationController.hpp>
+#include<yade/gui-qt3/QtFileGenerator.hpp>
+#include<yade/gui-qt3/QtSimulationPlayer.hpp>
+#include<yade/gui-qt3/QtGUIPreferences.hpp>
 
 class YadeQtMainWindow : public YadeQtGeneratedMainWindow
 {

Modified: trunk/gui/qt3/qt.py
===================================================================
--- trunk/gui/qt3/qt.py	2008-09-26 09:42:13 UTC (rev 1529)
+++ trunk/gui/qt3/qt.py	2008-09-28 12:37:30 UTC (rev 1530)
@@ -1,8 +1,42 @@
+# import module parts in c++ 
 from _qt import *
+
 if not isActive():
 	raise ImportError("The Qt gui is not being used (run with -N QtGUI).")
 
-def createVideo(playerDb,out,viewerState=None,dispParamsNo=-1,stride=1,fps=24,postLoadHook=None):
+
+
+def makeSimulationVideo(output,realPeriod=1,virtPeriod=0,iterPeriod=0,viewNo=0,fps=24):
+	"""Create video by running simulation. SnapshotEngine is added (and removed once done), temporary
+	files are deleted. The video is theora-encoded in the ogg container. Periodicity is controlled
+	in the same way as for PeriodicEngine (SnapshotEngine is a PeriodicEngine and realPeriod, virtPeriod 
+	and iterPeriod are passed to the new SnapshotEngine).
+
+	viewNo is 0-based GL view number. 0 is the primary view and will be created if it doesn't exist.
+	It is an error if viewNo>0 and the view doesn't exist.
+
+	The simulation will run until it stops by itself. Either set Omega().stopAtIteration or have an engine
+	that will call Omega().pause() at some point.
+
+	See makePlayerVideo for more documentation.
+	"""
+	import os
+	from yade import utils,wrapper
+	o=wrapper.Omega()
+	# create primary view if none
+	if len(views())==0: View()
+	# remove existing SnaphotEngines
+	se=wrapper.StandAloneEngine('SnapshotEngine',{'iterPeriod':iterPeriod,'realPeriod':realPeriod,'virtPeriod':virtPeriod,'fileBase':os.tmpnam(),'ignoreErrors':False,'viewNo':viewNo})
+	origEngines=o.engines; o.engines=[e for e in o.engines if e.name!='SnapshotEngine']+[se]
+	o.run(); o.wait();
+	wildcard=se['fileBase']+'%04d.png'
+	print "Number of frames:",len(se['savedSnapshots'])
+	utils.encodeVideoFromFrames(wildcard,output,renameNotOverwrite=True,fps=fps)
+	for f in se['savedSnapshots']: os.remove(f)
+	o.engines=origEngines
+
+
+def makePlayerVideo(playerDb,out,viewerState=None,dispParamsNo=-1,stride=1,fps=24,postLoadHook=None):
 	"""Create video by replaying a simulation. Snapshots are taken to temporary files,
 	encoded to a .ogg stream (theora codec); temps are deleted at the end.
 
@@ -16,10 +50,8 @@
 
 	Necessary packages: python-gst0.10 gstreamer0.10-plugins-good python-gobject
 	"""
-	import pygst,sys,gobject,os
-	pygst.require("0.10")
-	import gst
-	from yade import qt
+	import sys,os
+	from yade import qt,utils
 	# postLoadHook and viewerState have "" instead of None in the c++ interface
 	wildcard,snaps=qt.runPlayerSession(
 		playerDb,
@@ -28,19 +60,7 @@
 		dispParamsNo=dispParamsNo,
 		stride=stride,
 		postLoadHook=(postLoadHook if postLoadHook else ''))
-	if(os.path.exists(out)):
-		i=0;
-		while(os.path.exists(out+"~%d"%i)): i+=1
-		os.rename(out,out+"~%d"%i); print "Output file `%s' already existed, old file renamed to `%s'"%(out,out+"~%d"%i)
-	print "Encoding video from %s (%d files total) to %s"%(wildcard,len(snaps),out)
-	pipeline=gst.parse_launch('multifilesrc location="%s" index=0 caps="image/png,framerate=\(fraction\)%d/1" ! pngdec ! ffmpegcolorspace ! theoraenc sharpness=2 quality=32 ! oggmux ! filesink location="%s"'%(wildcard,fps,out))
-	bus=pipeline.get_bus()
-	bus.add_signal_watch()
-	mainloop=gobject.MainLoop();
-	bus.connect("message::eos",lambda bus,msg: mainloop.quit())
-	pipeline.set_state(gst.STATE_PLAYING)
-	mainloop.run()
-	pipeline.set_state(gst.STATE_NULL); pipeline.get_state()
+	utils.encodeVideoFromFrames(wildcard,out,renameNotOverwrite=True,fps=fps)
 	print "Cleaning snapshot files."
 	for f in snaps: os.remove(f)
 

Modified: trunk/scripts/simple-scene-player.py
===================================================================
--- trunk/scripts/simple-scene-player.py	2008-09-26 09:42:13 UTC (rev 1529)
+++ trunk/scripts/simple-scene-player.py	2008-09-28 12:37:30 UTC (rev 1530)
@@ -21,18 +21,9 @@
 	MetaEngine('InteractionPhysicsMetaEngine',[EngineUnit('SimpleElasticRelationships')]),
 	StandAloneEngine('ElasticContactLaw'),
 	DeusExMachina('GravityEngine',{'gravity':[0,0,-9.81]}),
-	MetaEngine('PhysicalActionDamper',[
-		EngineUnit('CundallNonViscousForceDamping',{'damping':0.2}),
-		EngineUnit('CundallNonViscousMomentumDamping',{'damping':0.2})
-	]),
-	MetaEngine('PhysicalActionApplier',[
-		EngineUnit('NewtonsForceLaw'),
-		EngineUnit('NewtonsMomentumLaw'),
-	]),
-	MetaEngine('PhysicalParametersMetaEngine',[EngineUnit('LeapFrogPositionIntegrator')]),
-	MetaEngine('PhysicalParametersMetaEngine',[EngineUnit('LeapFrogOrientationIntegrator')]),
+	DeusExMachina('NewtonsDampedLaw',{'damping':0.2})
 	###
-	### NOTE?these extra engines.
+	### NOTE?this extra engine.
 	###
 	StandAloneEngine('SQLiteRecorder',{'recorders':['se3','rgb'],'dbFile':'/tmp/player.sqlite','iterPeriod':50})
 ]
@@ -47,8 +38,8 @@
 def setWire():
 	o=Omega()
 	for b in o.bodies: b.shape['wire']=True
-# you must have saved the viewer state by using Alt-S in the view...
+# you could have saved the viewer state by using Alt-S in the view...
 from yade import qt
-qt.createVideo('/tmp/player.sqlite','/tmp/player.ogg','/tmp/qglviewerState.xml',stride=10,fps=12,postLoadHook='setWire()')
+qt.makePlayerVideo('/tmp/player.sqlite','/tmp/player.ogg','/tmp/qglviewerState.xml',stride=10,fps=12,postLoadHook='setWire()')
 
 quit()

Added: trunk/scripts/simple-scene-video.py
===================================================================
--- trunk/scripts/simple-scene-video.py	2008-09-26 09:42:13 UTC (rev 1529)
+++ trunk/scripts/simple-scene-video.py	2008-09-28 12:37:30 UTC (rev 1530)
@@ -0,0 +1,39 @@
+#!/usr/local/bin/yade-trunk -x
+# -*- encoding=utf-8 -*-
+
+o=Omega()
+o.initializers=[
+	StandAloneEngine('PhysicalActionContainerInitializer'),
+	MetaEngine('BoundingVolumeMetaEngine',[EngineUnit('InteractingSphere2AABB'),EngineUnit('InteractingBox2AABB'),EngineUnit('MetaInteractingGeometry2AABB')])
+	]
+o.engines=[
+	StandAloneEngine('PhysicalActionContainerReseter'),
+	MetaEngine('BoundingVolumeMetaEngine',[
+		EngineUnit('InteractingSphere2AABB'),
+		EngineUnit('InteractingBox2AABB'),
+		EngineUnit('MetaInteractingGeometry2AABB')
+	]),
+	StandAloneEngine('PersistentSAPCollider'),
+	MetaEngine('InteractionGeometryMetaEngine',[
+		EngineUnit('InteractingSphere2InteractingSphere4SpheresContactGeometry'),
+		EngineUnit('InteractingBox2InteractingSphere4SpheresContactGeometry')
+	]),
+	MetaEngine('InteractionPhysicsMetaEngine',[EngineUnit('SimpleElasticRelationships')]),
+	StandAloneEngine('ElasticContactLaw'),
+	DeusExMachina('GravityEngine',{'gravity':[0,0,-9.81]}),
+	DeusExMachina('NewtonsDampedLaw',{'damping':0.2})
+]
+from yade import utils
+o.bodies.append(utils.box(center=[0,0,0],extents=[.5,.5,.5],dynamic=False,color=[1,0,0],young=30e9,poisson=.3,density=2400))
+o.bodies.append(utils.sphere([0,0,2],1,color=[0,1,0],young=30e9,poisson=.3,density=2400))
+o.dt=.4*utils.PWaveTimeStep()
+
+
+from yade import qt
+o.stopAtIter=15000
+qt.makeSimulationVideo('/tmp/aa.ogg',iterPeriod=100,fps=12)
+
+
+
+
+


Property changes on: trunk/scripts/simple-scene-video.py
___________________________________________________________________
Name: svn:executable
   + *


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From sj2001 at yandex.ru  Sun Sep 28 19:38:40 2008
From: sj2001 at yandex.ru (sega)
Date: Sun, 28 Sep 2008 21:38:40 +0400
Subject: [deprecated list] [Yade-dev] Xserver hard freeze on intel GPU
In-Reply-To: <48DF6896.40003@arcig.cz>
References: <48DF6896.40003@arcig.cz>
Message-ID: <200809282138.40472.sj2001@yandex.ru>

> Could someone with relatively recent code run a script like this (save
> as e.g. /tmp/a.py, then run "yade-trunk /tmp/a.py")? (It is not enough
> to type that into the python console, that doesn't freeze here.)
> from yade import qt
> ?qt.View()
> ?v0=qt.View(); v0.grid=(True,True,True); v0.axes=True; v0.lookAt=(1,1,1)
> ?print "All OK"

On NVidiaQuadro NVS 140M with  rev1523 I am not getting X server freeze but this:

sega at linux:~/YADE/data> yade-trunk-opt /tmp/a.py
Running script /tmp/a.py
QGLContext::makeCurrent(): Failed.
X Error: BadAccess (attempt to access private resource denied) 10
  Major opcode:  143
  Minor opcode:  5
  Resource id:  0x3000053
yade-trunk-opt: Fatal IO error: client killed


-- 
Best regards, Sergei D.

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Sun Sep 28 20:36:50 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Sun, 28 Sep 2008 20:36:50 +0200
Subject: [deprecated list] [Yade-dev] Xserver hard freeze on intel GPU
In-Reply-To: <200809282138.40472.sj2001@yandex.ru>
References: <48DF6896.40003@arcig.cz>
	<200809282138.40472.sj2001@yandex.ru>
Message-ID: <20080928203650.2f6a675a@szpak>

sega said:     (by the date of Sun, 28 Sep 2008 21:38:40 +0400)

> sega at linux:~/YADE/data> yade-trunk-opt /tmp/a.py
> Running script /tmp/a.py
> QGLContext::makeCurrent(): Failed.
> X Error: BadAccess (attempt to access private resource denied) 10
>   Major opcode:  143
>   Minor opcode:  5
>   Resource id:  0x3000053
> yade-trunk-opt: Fatal IO error: client killed


I get similar message, but with different opcode (whatever it means):

QGLContext::makeCurrent(): Failed.
QGLContext::makeCurrent(): Failed.
X Error: BadAccess (attempt to access private resource denied) 10
  Major opcode:  144
  Minor opcode:  5
  Resource id:  0x760003b
yade-0.12-fast: Fatal IO error: client killed

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Mon Sep 29 01:04:01 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Mon, 29 Sep 2008 01:04:01 +0200
Subject: [deprecated list] [Yade-dev] HEAD compilation error.
Message-ID: <20080929010401.577b01ba@szpak>

Somebody please fix that:

scons: *** Source `gui/qt3/SnapshotEngine.cpp' not found, needed by
target `/home/janek/20-Programowanie/10-cpp/50-Yade/Code/HEAD/build-0.12-slow/gui/qt3/SnapshotEngine.os'.
Stop.


-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Mon Sep 29 08:37:42 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Mon, 29 Sep 2008 08:37:42 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1531 - in
	trunk:	core/DefaultContainerImplementations gui/py
	gui/qt3	pkg/common/Container
	pkg/dem/Engine/EngineUnit	pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry
Message-ID: <200809290637.m8T6bgta007057@sheep.berlios.de>

Author: eudoxos
Date: 2008-09-29 08:37:41 +0200 (Mon, 29 Sep 2008)
New Revision: 1531

Added:
   trunk/gui/qt3/SnapshotEngine.cpp
   trunk/gui/qt3/SnapshotEngine.hpp
Modified:
   trunk/core/DefaultContainerImplementations/BodyRedirectionVector.cpp
   trunk/gui/py/yadeControl.cpp
   trunk/gui/qt3/GLViewer.cpp
   trunk/gui/qt3/qt.py
   trunk/pkg/common/Container/BodyAssocVector.cpp
   trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp
   trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp
Log:
1. Add forgotten SnapshotEngine
2. BodyRedirectionVector always really find the lowest unused ID (the same for BodyAssocVector)
3. add Omega().interactions.clear() in python
4. Move the "Less than 500 bodies, moving possible" to LOG_INFO instead of on-screen since it disturbs videos taken during simulation...



Modified: trunk/core/DefaultContainerImplementations/BodyRedirectionVector.cpp
===================================================================
--- trunk/core/DefaultContainerImplementations/BodyRedirectionVector.cpp	2008-09-28 12:37:30 UTC (rev 1530)
+++ trunk/core/DefaultContainerImplementations/BodyRedirectionVector.cpp	2008-09-29 06:37:41 UTC (rev 1531)
@@ -73,7 +73,8 @@
 // FIXME - make sure that this is correct
 unsigned int BodyRedirectionVector::insert(shared_ptr<Body>& b)
 {
-	unsigned int position = b->getId();
+	//unsigned int position = b->getId();
+	unsigned position=0;
 
 //	std::vector< shared_ptr<Body> >::iterator tmpVii    = bodies.begin();
 //	std::vector< shared_ptr<Body> >::iterator tmpViiEnd = bodies.end();

Modified: trunk/gui/py/yadeControl.cpp
===================================================================
--- trunk/gui/py/yadeControl.cpp	2008-09-28 12:37:30 UTC (rev 1530)
+++ trunk/gui/py/yadeControl.cpp	2008-09-29 06:37:41 UTC (rev 1531)
@@ -289,6 +289,7 @@
 	void clear(){proxee->clear();}
 };
 
+
 class pyTags{
 	public:
 		pyTags(const shared_ptr<MetaBody> _mb): mb(_mb){}
@@ -345,6 +346,7 @@
 			long i=0; FOREACH(const shared_ptr<Interaction>& I, *proxee){ if(!I->isReal) continue; if(i++==n) return pyInteraction(I); }
 			throw invalid_argument(string("Interaction number out of range (")+lexical_cast<string>(n)+">="+lexical_cast<string>(i)+").");
 		}
+		void clear(){proxee->clear();}
 };
 
 
@@ -550,7 +552,8 @@
 	boost::python::class_<pyInteractionContainer>("InteractionContainer",python::init<pyInteractionContainer&>())
 		.def("__iter__",&pyInteractionContainer::pyIter)
 		.def("__getitem__",&pyInteractionContainer::pyGetitem)
-		.def("nth",&pyInteractionContainer::pyNth);
+		.def("nth",&pyInteractionContainer::pyNth)
+		.def("clear",&pyInteractionContainer::clear);
 	boost::python::class_<pyInteractionIterator>("InteractionIterator",python::init<pyInteractionIterator&>())
 		.def("__iter__",&pyInteractionIterator::pyIter)
 		.def("next",&pyInteractionIterator::pyNext);

Modified: trunk/gui/qt3/GLViewer.cpp
===================================================================
--- trunk/gui/qt3/GLViewer.cpp	2008-09-28 12:37:30 UTC (rev 1530)
+++ trunk/gui/qt3/GLViewer.cpp	2008-09-29 06:37:41 UTC (rev 1531)
@@ -312,8 +312,8 @@
 	MetaBody* rb=Omega::instance().getRootBody().get();
 	if (!rb) return;
 
-	if(rb->bodies->size() < 500) displayMessage("Less than 500 bodies, moving possible. Select with shift, press 'm' to move. Use / * - + for cutting plane.", 6000);
-	else displayMessage("More than 500 bodies. Moving not possible. Use / * - + for cutting plane.", 6000);
+	if(rb->bodies->size()<500){LOG_INFO("Less than 500 bodies, moving possible. Select with shift, press 'm' to move.");}
+	else{LOG_INFO("More than 500 bodies. Moving not possible.");}
 	Vector3r min,max;	
 	if(rb->boundingVolume){
 		min=rb->boundingVolume->min; max=rb->boundingVolume->max;

Added: trunk/gui/qt3/SnapshotEngine.cpp
===================================================================
--- trunk/gui/qt3/SnapshotEngine.cpp	2008-09-28 12:37:30 UTC (rev 1530)
+++ trunk/gui/qt3/SnapshotEngine.cpp	2008-09-29 06:37:41 UTC (rev 1531)
@@ -0,0 +1,17 @@
+#include"SnapshotEngine.hpp"
+#include<sstream>
+#include<iomanip>
+CREATE_LOGGER(SnapshotEngine);
+void SnapshotEngine::action(MetaBody* rb){
+	shared_ptr<GLViewer> glv;
+	if(!YadeQtMainWindow::self || ((size_t)viewNo>=YadeQtMainWindow::self->glViews.size()) || !(glv=YadeQtMainWindow::self->glViews[viewNo])){
+		if(!ignoreErrors) throw invalid_argument("View #"+lexical_cast<string>(viewNo)+" (SnapshotEngine::viewNo) doesn't exist.");
+		return;
+	}
+	ostringstream fss; fss<<fileBase<<setw(4)<<setfill('0')<<counter++<<".png";
+	LOG_DEBUG("GL view #"<<viewNo<<" ? "<<fss.str())
+	glv->setSnapshotFormat("PNG");
+	glv->saveSnapshot(QString(fss.str()),/*overwrite*/ true);
+	savedSnapshots.push_back(fss.str());
+}
+

Added: trunk/gui/qt3/SnapshotEngine.hpp
===================================================================
--- trunk/gui/qt3/SnapshotEngine.hpp	2008-09-28 12:37:30 UTC (rev 1530)
+++ trunk/gui/qt3/SnapshotEngine.hpp	2008-09-29 06:37:41 UTC (rev 1531)
@@ -0,0 +1,38 @@
+#pragma once
+#include<yade/core/StandAloneEngine.hpp>
+#include<yade/gui-qt3/GLViewer.hpp>
+#include<yade/gui-qt3/YadeQtMainWindow.hpp>
+#include<yade/pkg-common/PeriodicEngines.hpp>
+/*! Engine for saving snapshots of GLView(s) as .png files.
+ *
+ * Derives from PeriodicEngine, which has detailed information on controlling periodicity.
+ *
+ * The files are named fileBase+counter+".png" (counter is left-padded by 0s, i.e. snap0004.png)
+ */
+class SnapshotEngine: public PeriodicEngine{
+	public:
+		//! Basename for snapshots
+		string fileBase;
+		//! Number appended to fileBase
+		int counter;
+		//! The GLView number that we save (default: 0, i.e. primary view)
+		int viewNo;
+		//! Silently return if selected view doesn't exist (default: true)
+		bool ignoreErrors;
+		//! files that have been created so far
+		vector<string> savedSnapshots;
+	SnapshotEngine():counter(0),viewNo(0),ignoreErrors(true){}
+	virtual void action(MetaBody*);
+	void registerAttributes(){	
+		PeriodicEngine::registerAttributes();
+		REGISTER_ATTRIBUTE(fileBase);
+		REGISTER_ATTRIBUTE(counter);
+		REGISTER_ATTRIBUTE(viewNo);
+		REGISTER_ATTRIBUTE(ignoreErrors);
+		REGISTER_ATTRIBUTE(savedSnapshots);
+	}
+	DECLARE_LOGGER;
+	REGISTER_CLASS_NAME(SnapshotEngine);
+	REGISTER_BASE_CLASS_NAME(PeriodicEngine);
+};
+REGISTER_SERIALIZABLE(SnapshotEngine,false);

Modified: trunk/gui/qt3/qt.py
===================================================================
--- trunk/gui/qt3/qt.py	2008-09-28 12:37:30 UTC (rev 1530)
+++ trunk/gui/qt3/qt.py	2008-09-29 06:37:41 UTC (rev 1531)
@@ -15,7 +15,7 @@
 	viewNo is 0-based GL view number. 0 is the primary view and will be created if it doesn't exist.
 	It is an error if viewNo>0 and the view doesn't exist.
 
-	The simulation will run until it stops by itself. Either set Omega().stopAtIteration or have an engine
+	The simulation will run until it stops by itself. Either set Omega().stopAtIter or have an engine
 	that will call Omega().pause() at some point.
 
 	See makePlayerVideo for more documentation.

Modified: trunk/pkg/common/Container/BodyAssocVector.cpp
===================================================================
--- trunk/pkg/common/Container/BodyAssocVector.cpp	2008-09-28 12:37:30 UTC (rev 1530)
+++ trunk/pkg/common/Container/BodyAssocVector.cpp	2008-09-29 06:37:41 UTC (rev 1531)
@@ -80,7 +80,8 @@
 //	BodyContainer::setId(b,max);
 //	return max;
 
-	unsigned int position = b->getId();
+	//unsigned int position = b->getId();
+	unsigned int position=0;
 
 	Loki::AssocVector<unsigned int , shared_ptr<Body> >::const_iterator tmpBii;
 	tmpBii = bodies.find(position);
@@ -88,8 +89,7 @@
 	{
 		// finds the first free key, which is bigger than 0 (was: newPoistion=position, i.e. greater than id... why?)
 		unsigned int newPosition = 0;
-		while( bodies.find(newPosition) != bodies.end() )
-			++newPosition;
+		while( bodies.find(newPosition) != bodies.end() ) ++newPosition;
 		//cerr << "WARNING: body id=\"" << position << "\" is already used. Using first free id=\"" << newPosition << "\", beware - if you are loading a file, this will break interactions for this body!\n";
 		position = newPosition;
 	}

Modified: trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp
===================================================================
--- trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp	2008-09-28 12:37:30 UTC (rev 1530)
+++ trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp	2008-09-29 06:37:41 UTC (rev 1531)
@@ -122,7 +122,6 @@
 				scm->cp2rel.Align(Vector3r::UNIT_X,se32.orientation.Conjugate()*(-normal));
 				scm->cp1rel.Normalize(); scm->cp2rel.Normalize();
 			}
-			cerr<<"@@ "<<scm->epsT()<<endl;
 		}
 
 		return true;

Modified: trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp
===================================================================
--- trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp	2008-09-28 12:37:30 UTC (rev 1530)
+++ trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp	2008-09-29 06:37:41 UTC (rev 1531)
@@ -80,13 +80,8 @@
 		Vector3r contPt=se31.position+(sc->d1/sc->d0)*(se32.position-se31.position); // must be recalculated to not be unscaled if scaling displacements ...
 		GLUtils::GLDrawLine(pos1,pos2,Vector3r(.5,.5,.5));
 		// sphere center to point on the sphere
-		//GLUtils::GLDrawText("[1]",sc->pos1,Vector3r(1,1,1)); GLUtils::GLDrawText("[2]",sc->pos2,Vector3r(1,1,1));
-		GLUtils::GLDrawLine(pos1,pos1+(sc->ori1*sc->cp1rel*Vector3r::UNIT_X*sc->d1),Vector3r(0,.5,1));
-		GLUtils::GLDrawLine(pos2,pos2+(sc->ori2*sc->cp2rel*Vector3r::UNIT_X*sc->d2),Vector3r(0,1,.5));
-		//cerr<<"=== cp1rel="<<sc->cp1rel[0]<<";"<<sc->cp1rel[1]<<";"<<sc->cp1rel[2]<<";"<<sc->cp1rel[3]<<endl;
-		//cerr<<"=== ori1="<<sc->ori1[0]<<";"<<sc->ori1[1]<<";"<<sc->ori1[2]<<";"<<sc->ori1[3]<<endl;
-		//cerr<<"+++ cp1rel="<<sc->cp1rel<<", ori1="<<sc->ori1<<", cp1rel*ori1="<<sc->cp1rel*sc->ori1<<endl;
-		//<<", *UNIT_X="<<sc->cp1rel*sc->ori1*Vector3r::UNIT_X<<", +pos1="<<sc->pos1+(sc->cp1rel*sc->ori1*Vector3r::UNIT_X)<<endl;
+		//GLUtils::GLDrawLine(pos1,pos1+(sc->ori1*sc->cp1rel*Vector3r::UNIT_X*sc->d1),Vector3r(0,.5,1));
+		//GLUtils::GLDrawLine(pos2,pos2+(sc->ori2*sc->cp2rel*Vector3r::UNIT_X*sc->d2),Vector3r(0,1,.5));
 		// contact point to projected points
 		Vector3r ptTg1=sc->contPtInTgPlane1(), ptTg2=sc->contPtInTgPlane2();
 		GLUtils::GLDrawLine(contPt,contPt+ptTg1,Vector3r(0,.5,1));
@@ -94,7 +89,7 @@
 		// projected shear
 		GLUtils::GLDrawLine(contPt+ptTg1,contPt+ptTg2,Vector3r(1,1,1));
 		// 
-		GLUtils::GLDrawNum(sc->epsN(),contPt,Vector3r(1,1,1));
+		//GLUtils::GLDrawNum(sc->epsN(),contPt,Vector3r(1,1,1));
 	}
 
 


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From duriez at geo.hmg.inpg.fr  Fri Sep 26 14:32:33 2008
From: duriez at geo.hmg.inpg.fr (Jerome Duriez)
Date: Fri, 26 Sep 2008 14:32:33 +0200
Subject: [deprecated list] [Yade-dev] r1527 - trunk/pkg/dem
In-Reply-To: <20080926141418.10c984e7@szpak>
References: <200809251719.m8PHJwAI032027@sheep.berlios.de>	<20080925202357.3d0d5371@szpak>
	<48DC9186.4010405@geo.hmg.inpg.fr> <20080926141418.10c984e7@szpak>
Message-ID: <48DCD661.4040300@geo.hmg.inpg.fr>


Janek Kozicki a ?crit :
> Do you have this commit email somewhere?
>
Unfortunately not...
    I added :
- a preprocessor named "SimpleShear" whose aim was to replace 
"DirectShearCis" (comment in this last one to let notice it)
- Engines adapted to this preprocessor to simulate constant normal 
displacement (or stress or rigidity) shear tests : respectively 
CinemDNCEngine (CinemCNCEngine or CinemKNCEngine). The CinemDNCEngine 
corresponds to former CinemCisEngine
- And all concerning this "ContactLaw1" we're speaking about : the 
ContactLaw1 files themselves, but also files ContactLaw1Interaction and 
files CL1Relationships

Jerome

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From duriez at geo.hmg.inpg.fr  Mon Sep 29 09:44:33 2008
From: duriez at geo.hmg.inpg.fr (Jerome Duriez)
Date: Mon, 29 Sep 2008 09:44:33 +0200
Subject: [deprecated list] [Yade-dev] ContactLaw1
In-Reply-To: <20080927133734.6cb5f3a9@szpak>
References: <200809260802.m8Q82DfS028074@sheep.berlios.de>	<48DCB0B5.3090808@arcig.cz>
	<48DCB959.6040209@geo.hmg.inpg.fr>	<20080926141211.18247d5f@szpak>
	<48DE0B9C.1050009@arcig.cz> <20080927133734.6cb5f3a9@szpak>
Message-ID: <48E08761.9030100@geo.hmg.inpg.fr>

About merging "ContactLaw1" in "CohesiveFrictionalContactLaw", an other 
problem would be :
- My "ContactLaw1" uses relationsships and interactions different from 
the one of "CohesiveFrictionalContactLaw". Especially, in the 
interactions I use I have to store such things as a "unmax" (the maximum 
value of normal interpenetration in the history of the interaction", or 
a "previousun" or "previousFn" to compute correctly the normal value of 
the contact force. So for me, it seems that this would annoy merging 
ContactLaw1 in CohesiveFrictionalContactLaw isn't it ?

Jerome

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Mon Sep 29 13:59:43 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Mon, 29 Sep 2008 13:59:43 +0200
Subject: [deprecated list] [Yade-dev] Color Errors in xterm when compiling!
	EXTRA :)
Message-ID: <20080929135943.0a2778e6@szpak>

sudo aptitude install colorgcc

  scons CXX='colorgcc'

or

  scons CXX='distcc colorgcc'

or

ln -s `which colorgcc` ~/bin/g++ # but make sure that ~/bin is first in $PATH
ls -la ~/bin/g++
ln -s `which colorgcc` ~/bin/gcc
ln -s `which colorgcc` ~/bin/cc


create ~/.colorgccrc from /etc/colorgcc

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Mon Sep 29 19:53:35 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Mon, 29 Sep 2008 19:53:35 +0200
Subject: [deprecated list] [Yade-dev] Color Errors in xterm when
	compiling! EXTRA :)
In-Reply-To: <20080929135943.0a2778e6@szpak>
References: <20080929135943.0a2778e6@szpak>
Message-ID: <48E1161F.5050108@arcig.cz>

Eh, I wasn't sure if this is a bug report that colorgcc doesn't work...
Why don't you put this on the wiki? V.
> sudo aptitude install colorgcc
>
>   scons CXX='colorgcc'
>
> or
>
>   scons CXX='distcc colorgcc'
>
> or
>
> ln -s `which colorgcc` ~/bin/g++ # but make sure that ~/bin is first in $PATH
> ls -la ~/bin/g++
> ln -s `which colorgcc` ~/bin/gcc
> ln -s `which colorgcc` ~/bin/cc
>
>
> create ~/.colorgccrc from /etc/colorgcc
>
>   


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Mon Sep 29 20:53:07 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Mon, 29 Sep 2008 20:53:07 +0200
Subject: [deprecated list] [Yade-dev] Color Errors in xterm when
	compiling! EXTRA :)
In-Reply-To: <48E1161F.5050108@arcig.cz>
References: <20080929135943.0a2778e6@szpak>
	<48E1161F.5050108@arcig.cz>
Message-ID: <20080929205307.2d2b8c90@szpak>

V?clav S(milauer said:     (by the date of Mon, 29 Sep 2008 19:53:35 +0200)

> > sudo aptitude install colorgcc
> Eh, I wasn't sure if this is a bug report that colorgcc doesn't work...
> Why don't you put this on the wiki? V.

lol, I'd never think about this interpretation of my message :)
You can put this on wiki too ;p


-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Tue Sep 30 12:29:53 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Tue, 30 Sep 2008 12:29:53 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1532 - in trunk/pkg/dem:
	Engine/DeusExMachina	Engine/EngineUnit PreProcessor
Message-ID: <200809301029.m8UATreO028485@sheep.berlios.de>

Author: eudoxos
Date: 2008-09-30 12:29:52 +0200 (Tue, 30 Sep 2008)
New Revision: 1532

Modified:
   trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp
   trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.hpp
   trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp
   trunk/pkg/dem/PreProcessor/TriaxialTest.cpp
   trunk/pkg/dem/PreProcessor/TriaxialTest.hpp
Log:
A few fixes in TriaxialTest:
1. radiusStdDev is a registered attribute parameter
2. skip unloading phase if sigmaLateralConfinement==sigmaIsoCompaction
3. new bool autoUnload, that controls automaticity of going from compaction to unloading; autocompressionActivation controls from unloading to loading.
Note: IFacet2IS4SCG is broken, but not yet fixed. 



Modified: trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp	2008-09-29 06:37:41 UTC (rev 1531)
+++ trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp	2008-09-30 10:29:52 UTC (rev 1532)
@@ -38,8 +38,10 @@
 	FinalIterationPhase1 = 0;
 	Iteration = 0;
 	testEquilibriumInterval = 20;
-	//compressionActivated=false;
+
+	autoUnload=true;
 	autoCompressionActivation=true;
+
 	UnbalancedForce = 1;
 	saveSimulation = false;
 	firstRun=true;
@@ -147,12 +149,16 @@
 
 		if ( UnbalancedForce<=StabilityCriterion && abs ( ( meanStress-sigma_iso ) /sigma_iso ) <0.005 )
 		{
-			if ( currentState==STATE_ISO_COMPACTION && autoCompressionActivation )
-			{
-				doStateTransition (ncb, STATE_ISO_UNLOADING ); /*update stress and strain here*/ computeStressStrain ( ncb );
+			// only go to UNLOADING if it is needed (hard float comparison... :-| )
+			if ( currentState==STATE_ISO_COMPACTION && autoUnload && sigmaLateralConfinement!=sigmaIsoCompaction ) {
+				doStateTransition (ncb, STATE_ISO_UNLOADING );
+				computeStressStrain ( ncb ); // update stress and strain
 			}
-			else if ( currentState==STATE_ISO_UNLOADING && autoCompressionActivation )
-			{
+			else if(currentState==STATE_ISO_COMPACTION && autoCompressionActivation){
+				doStateTransition (ncb, STATE_TRIAX_LOADING );
+				computeStressStrain ( ncb ); // update stress and strain
+			}
+			else if ( currentState==STATE_ISO_UNLOADING && autoCompressionActivation ) {
 				doStateTransition (ncb, STATE_TRIAX_LOADING ); computeStressStrain ( ncb );
 			}
 			// huh?! this will never happen, because of the first condition...

Modified: trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.hpp	2008-09-29 06:37:41 UTC (rev 1531)
+++ trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.hpp	2008-09-30 10:29:52 UTC (rev 1532)
@@ -24,20 +24,26 @@
 
 /** \brief Class for controlling optional initial isotropic compaction and subsequent triaxial test with constant lateral stress and constant axial strain rate.
  *
- * The engine is a state machine with the following states (and automatic transitions):
+ * The engine is a state machine with the following states; transitions my be automatic, see below.
  *
  * 1. STATE_ISO_COMPACTION: isotropic compaction (compression) until
  *    the prescribed mean pressue sigmaIsoCompaction is reached and the packing is stable.
  *    The compaction happens either by straining the walls (!internalCompaction)
- *    or by growing size of grains (internalCompaction)
+ *    or by growing size of grains (internalCompaction).
  * 2. STATE_ISO_UNLOADING: isotropic unloading from the previously reached state, until
- *    the mean pressure sigmaLateralConfinement is reached (and stabilizes)
+ *    the mean pressure sigmaLateralConfinement is reached (and stabilizes).
+ *    NOTE: this state will be skipped if sigmaLateralConfinement == sigmaIsoCompaction.
  * 3. STATE_TRIAX_LOADING: confined uniaxial compression:
  *		constant sigmaLateralConfinement is kept at lateral walls (left, right, front, back), while
  * 	top and bottom walls load the packing in their axis (by straining), until the value of epsilonMax
  * 	(deformation along the loading axis) is reached. At this point, the simulation is stopped.
  * 4. STATE_TRIAX_LIMBO: currently unused, since simulation is hard-stopped in the previous state.
  *
+ * Transition from COMPACTION to UNLOADING is done automatically if autoUnload==true;
+ * Transition from (UNLOADING to LOADING) or from (COMPACTION to LOADING: if UNLOADING is skipped) is
+ *   done automatically if autoCompressionActivation=true;
+ * Both autoUnload and autoCompressionActivation are true by default.
+ *
  */
 
 class TriaxialCompressionEngine : public TriaxialStressController
@@ -92,8 +98,11 @@
 		std::string Key;//A code that is appended to file names to help distinguish between different simulations
 		// //! Is uniaxial compression currently activated?
 		// bool compressionActivated;
-		//! Auto-switch between isotropic and uniaxial compression?
+		//! Auto-switch from isotropic compaction or unloading state (if sigmaLateralConfinement<sigmaIsoCompaction)
+		// to uniaxial compression
 		bool autoCompressionActivation;
+		//! Auto-switch from isotropic compaction to unloading
+		bool autoUnload;
 				
 		virtual void applyCondition(MetaBody * ncb);
 		void updateParameters(MetaBody * ncb);

Modified: trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp
===================================================================
--- trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp	2008-09-29 06:37:41 UTC (rev 1531)
+++ trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp	2008-09-30 10:29:52 UTC (rev 1532)
@@ -122,6 +122,7 @@
 				scm->cp2rel.Align(Vector3r::UNIT_X,se32.orientation.Conjugate()*(-normal));
 				scm->cp1rel.Normalize(); scm->cp2rel.Normalize();
 			}
+			cerr<<"[n"<<scm->displacementN()<<" t"<<scm->displacementT()<<"]";
 		}
 
 		return true;

Modified: trunk/pkg/dem/PreProcessor/TriaxialTest.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/TriaxialTest.cpp	2008-09-29 06:37:41 UTC (rev 1531)
+++ trunk/pkg/dem/PreProcessor/TriaxialTest.cpp	2008-09-30 10:29:52 UTC (rev 1532)
@@ -138,6 +138,7 @@
 	maxWallVelocity=10;
 	StabilityCriterion = 0.01;
 	autoCompressionActivation = true;
+	autoUnload = true;
 	maxMultiplier = 1.01;
 	finalMaxMultiplier = 1.001;
 	
@@ -158,6 +159,8 @@
 	wallOversizeFactor=1.3;
 
 	biaxial2dTest=false;
+
+	radiusStdDev=0.3;
 	
 //	wall_top_id =0;
 // 	wall_bottom_id =0;
@@ -188,6 +191,7 @@
 	REGISTER_ATTRIBUTE(biaxial2dTest);
 	REGISTER_ATTRIBUTE(maxMultiplier);
 	REGISTER_ATTRIBUTE(finalMaxMultiplier);
+	REGISTER_ATTRIBUTE(radiusStdDev);
 
 	REGISTER_ATTRIBUTE(sphereYoungModulus);
 	REGISTER_ATTRIBUTE(spherePoissonRatio);
@@ -211,6 +215,7 @@
 	REGISTER_ATTRIBUTE(maxWallVelocity);
 	REGISTER_ATTRIBUTE(StabilityCriterion);
 	REGISTER_ATTRIBUTE(autoCompressionActivation);
+	REGISTER_ATTRIBUTE(autoUnload);
 //	REGISTER_ATTRIBUTE(wall_top);
 //	REGISTER_ATTRIBUTE(wall_bottom);
 //	REGISTER_ATTRIBUTE(wall_1);
@@ -381,7 +386,7 @@
 	
 	vector<BasicSphere> sphere_list;
 	if(importFilename!="") sphere_list=Shop::loadSpheresFromFile(importFilename,lowerCorner,upperCorner);
-	else message+=GenerateCloud(sphere_list, lowerCorner, upperCorner, numberOfGrains, 0.3, 0.75);
+	else message+=GenerateCloud(sphere_list, lowerCorner, upperCorner, numberOfGrains, radiusStdDev, 0.75);
 	
 	vector<BasicSphere>::iterator it = sphere_list.begin();
 	vector<BasicSphere>::iterator it_end = sphere_list.end();
@@ -594,6 +599,7 @@
 	triaxialcompressionEngine->strainRate = strainRate;
 	triaxialcompressionEngine->StabilityCriterion = StabilityCriterion;
 	triaxialcompressionEngine->autoCompressionActivation = autoCompressionActivation;
+	triaxialcompressionEngine->autoUnload = autoUnload;
 	triaxialcompressionEngine->internalCompaction = internalCompaction;
 	triaxialcompressionEngine->maxMultiplier = maxMultiplier;
 	triaxialcompressionEngine->finalMaxMultiplier = finalMaxMultiplier;

Modified: trunk/pkg/dem/PreProcessor/TriaxialTest.hpp
===================================================================
--- trunk/pkg/dem/PreProcessor/TriaxialTest.hpp	2008-09-29 06:37:41 UTC (rev 1531)
+++ trunk/pkg/dem/PreProcessor/TriaxialTest.hpp	2008-09-30 10:29:52 UTC (rev 1532)
@@ -73,7 +73,8 @@
 				StabilityCriterion,
 				maxMultiplier, ///max multiplier of diameters during internal compaction
 				finalMaxMultiplier,
-				wallOversizeFactor; // make walls bigger (/smaller) than necessary by this factor
+				wallOversizeFactor,
+				radiusStdDev; // make walls bigger (/smaller) than necessary by this factor
 
 		bool		 wall_top
 				,wall_bottom
@@ -89,6 +90,8 @@
 				,wall_4_wire
 				//! do we just want to generate a stable packing under isotropic pressure (false) or do we want the triaxial loading to start automatically right after compaction stage (true)?
 				,autoCompressionActivation
+				//! see docs for TriaxialCompressionEngine and TriaxialCompressionEngine::autoUnload
+				,autoUnload
 			
 				,rotationBlocked
 				,spheresRandomColor


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From sega at mail.berlios.de  Tue Sep 30 12:49:25 2008
From: sega at mail.berlios.de (sega at BerliOS)
Date: Tue, 30 Sep 2008 12:49:25 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1533 - in trunk: core
	pkg/common	pkg/common/Container
	pkg/dem/DataClass/InteractionGeometry	pkg/dem/Engine/EngineUnit
Message-ID: <200809301049.m8UAnPiR016795@sheep.berlios.de>

Author: sega
Date: 2008-09-30 12:49:22 +0200 (Tue, 30 Sep 2008)
New Revision: 1533

Added:
   trunk/pkg/common/Container/InteractionVecMap.cpp
   trunk/pkg/common/Container/InteractionVecMap.hpp
Modified:
   trunk/core/InteractionContainer.hpp
   trunk/pkg/common/SConscript
   trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp
   trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp
   trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.hpp
Log:
1. New random-access interaction container InteractionVecMap (rewrited from  InteractionVecSet)
2. Fixes: default initialization some attributes in SCG and IS2IS4SCG



Modified: trunk/core/InteractionContainer.hpp
===================================================================
--- trunk/core/InteractionContainer.hpp	2008-09-30 10:29:52 UTC (rev 1532)
+++ trunk/core/InteractionContainer.hpp	2008-09-30 10:49:22 UTC (rev 1533)
@@ -97,6 +97,9 @@
       virtual InteractionContainer::iterator end()						{throw;};
 		virtual unsigned int size() 								{throw;};
 
+		virtual shared_ptr<Interaction>& operator[] (unsigned int) {throw;};
+		virtual const shared_ptr<Interaction>& operator[] (unsigned int) const {throw;};
+
 	private :
 		vector<shared_ptr<Interaction> > interaction;
 

Added: trunk/pkg/common/Container/InteractionVecMap.cpp
===================================================================
--- trunk/pkg/common/Container/InteractionVecMap.cpp	2008-09-30 10:29:52 UTC (rev 1532)
+++ trunk/pkg/common/Container/InteractionVecMap.cpp	2008-09-30 10:49:22 UTC (rev 1533)
@@ -0,0 +1,198 @@
+// 2008 ? Sergei Dorofeenko <sega at users.berlios.de>
+
+#include "InteractionVecMap.hpp"
+#include <iostream>
+
+
+InteractionVecMapIterator::InteractionVecMapIterator() : InteractionContainerIterator()
+{
+
+}
+
+
+InteractionVecMapIterator::~InteractionVecMapIterator()
+{
+
+}
+
+shared_ptr<Interaction>& InteractionVecMap::operator[](unsigned int id)
+{
+	return interactions[id];
+}
+
+const shared_ptr<Interaction>& InteractionVecMap::operator[](unsigned int id) const
+{
+	return interactions[id];
+}
+
+bool InteractionVecMapIterator::isDifferent(const InteractionContainerIterator& i)
+{
+	const InteractionVecMapIterator& it = static_cast<const InteractionVecMapIterator&>(i);
+	return ( vii != it.vii );
+}
+
+
+void InteractionVecMapIterator::increment()
+{
+	++vii;
+}
+
+
+void InteractionVecMapIterator::affect(const InteractionContainerIterator& i)
+{
+	const InteractionVecMapIterator& tmpi = static_cast<const InteractionVecMapIterator&>(i);
+	vii    = tmpi.vii;
+}
+
+
+shared_ptr<Interaction> InteractionVecMapIterator::getValue()
+{
+	return *vii;
+}
+
+
+shared_ptr<InteractionContainerIterator> InteractionVecMapIterator::createPtr()
+{
+	return shared_ptr<InteractionContainerIterator>(new InteractionVecMapIterator());
+}
+
+
+/*********************************************************************/
+
+InteractionVecMap::InteractionVecMap()
+{
+	currentSize = 0;
+	clear();
+}
+
+
+InteractionVecMap::~InteractionVecMap()
+{
+}
+
+
+bool InteractionVecMap::insert(shared_ptr<Interaction>& i)
+{
+	boost::mutex::scoped_lock lock(drawloopmutex);
+
+	body_id_t id1 = i->getId1();
+	body_id_t id2 = i->getId2();
+
+	if (id1>id2)
+		swap(id1,id2);
+
+	if ( static_cast<unsigned int>(id1) >=vecmap.size())
+		vecmap.resize(id1+1);
+
+	if (vecmap[id1].insert(pair<body_id_t,unsigned int >(id2,currentSize)).second)
+	{
+		if (interactions.size() == currentSize)
+			interactions.resize(currentSize+1);
+
+		interactions[currentSize]=i;
+		currentSize++;
+	
+		return true;
+	}
+	else
+		return false;
+}
+
+
+bool InteractionVecMap::insert(body_id_t id1,body_id_t id2)
+{
+	shared_ptr<Interaction> i(new Interaction(id1,id2) );
+	return insert(i);	
+}
+
+
+void InteractionVecMap::clear()
+{
+	boost::mutex::scoped_lock lock(drawloopmutex);
+
+	vecmap.clear();
+	interactions.clear();
+	currentSize=0;
+}
+
+
+bool InteractionVecMap::erase(body_id_t id1,body_id_t id2)
+{
+	boost::mutex::scoped_lock lock(drawloopmutex);
+
+	if (id1>id2)
+		swap(id1,id2);
+
+	if ( static_cast<unsigned int>(id1) < vecmap.size())
+	{
+		map<body_id_t,unsigned int >::iterator mii;
+		mii = vecmap[id1].find(id2);
+		if ( mii != vecmap[id1].end() )
+		{
+			unsigned int iid = (*mii).second;
+			vecmap[id1].erase(mii);
+			currentSize--;
+			if (iid<currentSize) {
+				interactions[iid]=interactions[currentSize];
+				id1 = interactions[iid]->getId1();
+				id2 = interactions[iid]->getId2();
+				if (id1>id2) swap(id1,id2);
+				vecmap[id1][id2]=iid;
+			}
+			return true;
+		}
+		else
+			return false;
+	}
+
+	return false;
+
+}
+
+
+const shared_ptr<Interaction>& InteractionVecMap::find(body_id_t id1,body_id_t id2)
+{
+	if (id1>id2)
+		swap(id1,id2);
+
+	if (static_cast<unsigned int>(id1)<vecmap.size())
+	{
+		map<body_id_t,unsigned int >::iterator mii;
+		mii = vecmap[id1].find(id2);
+		if (mii!=vecmap[id1].end())
+			return interactions[(*mii).second];
+		else
+		{
+			empty = shared_ptr<Interaction>();
+			return empty;
+		}
+	}
+	else
+	{
+		empty = shared_ptr<Interaction>();
+		return empty;
+	}
+}
+
+
+InteractionContainer::iterator InteractionVecMap::begin()
+{
+	shared_ptr<InteractionVecMapIterator> it(new InteractionVecMapIterator());
+	it->vii    = interactions.begin();
+	return InteractionContainer::iterator(it);
+}
+
+
+InteractionContainer::iterator InteractionVecMap::end()
+{
+	shared_ptr<InteractionVecMapIterator> it(new InteractionVecMapIterator());
+	it->vii		= interactions.begin()+currentSize;
+	return InteractionContainer::iterator(it);
+}
+
+unsigned int InteractionVecMap::size()
+{
+	return currentSize;
+}
+
+// YADE_PLUGIN();

Added: trunk/pkg/common/Container/InteractionVecMap.hpp
===================================================================
--- trunk/pkg/common/Container/InteractionVecMap.hpp	2008-09-30 10:29:52 UTC (rev 1532)
+++ trunk/pkg/common/Container/InteractionVecMap.hpp	2008-09-30 10:49:22 UTC (rev 1533)
@@ -0,0 +1,62 @@
+// 2008 ? Sergei Dorofeenko <sega at users.berlios.de>
+
+#include<yade/core/InteractionContainer.hpp>
+#include<yade/core/Interaction.hpp>
+#include<map>
+#include<vector>
+
+using namespace std;
+
+class InteractionVecMapIterator : public InteractionContainerIterator 
+{
+	public :
+
+		vector<shared_ptr<Interaction>  >::iterator vii;
+		InteractionVecMapIterator();
+		~InteractionVecMapIterator();
+
+		virtual bool isDifferent(const InteractionContainerIterator& i);
+		virtual void affect(const InteractionContainerIterator& i);
+		virtual void increment();
+		virtual shared_ptr<Interaction> getValue();
+		virtual shared_ptr<InteractionContainerIterator> createPtr();
+
+
+};
+
+
+using namespace __gnu_cxx;
+
+class InteractionVecMap : public InteractionContainer
+{
+	private :
+		vector<shared_ptr<Interaction> > interactions;
+		vector<map<body_id_t, unsigned int  > > vecmap;
+		unsigned int currentSize;
+		shared_ptr<Interaction> empty;
+
+	public :
+		InteractionVecMap();
+		virtual ~InteractionVecMap();
+
+		virtual bool insert(body_id_t id1,body_id_t id2);
+		virtual bool insert(shared_ptr<Interaction>& i);
+		virtual void clear();
+		virtual bool erase(body_id_t id1,body_id_t id2);
+		virtual const shared_ptr<Interaction>& find(body_id_t id1,body_id_t id2);
+
+		virtual InteractionContainer::iterator begin();
+     	virtual InteractionContainer::iterator end();
+		
+		virtual shared_ptr<Interaction>& operator[](unsigned int);
+		virtual const shared_ptr<Interaction>& operator[](unsigned int) const;
+
+		virtual unsigned int size();
+
+	REGISTER_CLASS_NAME(InteractionVecMap);
+	REGISTER_BASE_CLASS_NAME(InteractionContainer);
+
+};
+
+REGISTER_SERIALIZABLE(InteractionVecMap,false);
+

Modified: trunk/pkg/common/SConscript
===================================================================
--- trunk/pkg/common/SConscript	2008-09-30 10:29:52 UTC (rev 1532)
+++ trunk/pkg/common/SConscript	2008-09-30 10:49:22 UTC (rev 1533)
@@ -13,6 +13,10 @@
 		['Container/InteractionHashMap.cpp'],
 		LIBS=env['LIBS']+['yade-base']),
 	
+	env.SharedLibrary('InteractionVecMap',
+		['Container/InteractionVecMap.cpp'],
+		LIBS=env['LIBS']+['yade-base']),
+	
 ## moved to core/DefaultContainerImplementations
 #	env.SharedLibrary('BodyRedirectionVector',['Container/BodyRedirectionVector.cpp']),
 #	env.SharedLibrary('InteractionVecSet',['Container/InteractionVecSet.cpp']),

Modified: trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp
===================================================================
--- trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp	2008-09-30 10:29:52 UTC (rev 1532)
+++ trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp	2008-09-30 10:49:22 UTC (rev 1533)
@@ -67,7 +67,7 @@
 
 		void relocateContactPoints();
 
-		SpheresContactGeometry():contactPoint(Vector3r::ZERO),radius1(0),radius2(0),hasShear(false){createIndex();}
+		SpheresContactGeometry():contactPoint(Vector3r::ZERO),radius1(0),radius2(0),hasShear(false),pos1(Vector3r::ZERO),pos2(Vector3r::ZERO){createIndex();}
 		virtual ~SpheresContactGeometry();
 	protected :
 		virtual void registerAttributes(){

Modified: trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp
===================================================================
--- trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp	2008-09-30 10:29:52 UTC (rev 1532)
+++ trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp	2008-09-30 10:49:22 UTC (rev 1533)
@@ -14,6 +14,7 @@
 InteractingSphere2InteractingSphere4SpheresContactGeometry::InteractingSphere2InteractingSphere4SpheresContactGeometry()
 {
 	interactionDetectionFactor = 1;
+	hasShear=false;
 }
 
 void InteractingSphere2InteractingSphere4SpheresContactGeometry::registerAttributes()

Modified: trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.hpp
===================================================================
--- trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.hpp	2008-09-30 10:29:52 UTC (rev 1532)
+++ trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.hpp	2008-09-30 10:49:22 UTC (rev 1533)
@@ -25,7 +25,7 @@
 		 * @note This parameter is functionally coupled with InteractinSphere2AABB::aabbEnlargeFactor,
 		 * which will create larger bounding boxes and should be of the same value. */
 		double interactionDetectionFactor;
-		/*! Whether we create SpheresContactGeometry with data necessary for (exact) shear computation */
+		/*! Whether we create SpheresContactGeometry with data necessary for (exact) shear computation. By default false */
 		bool hasShear;
 
 	REGISTER_CLASS_NAME(InteractingSphere2InteractingSphere4SpheresContactGeometry);


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From sj2001 at yandex.ru  Tue Sep 30 13:08:27 2008
From: sj2001 at yandex.ru (sega)
Date: Tue, 30 Sep 2008 15:08:27 +0400
Subject: [deprecated list] [Yade-dev] random-access container for
	interactions
Message-ID: <200809301508.28061.sj2001@yandex.ru>

Hi,
In r1533 I added new container for interactions (InteractionVecMap) with random access.
Two questions:
1. How to set interaction container from python gui?
2. How to incorporate random access to Interaction*MetaEngines?
and PhysicalActionVectorVector::find break a parallel computations because it resize
physicalActions container.

-- 
Best regards, Sergei D.

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Tue Sep 30 15:14:35 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Tue, 30 Sep 2008 15:14:35 +0200
Subject: [deprecated list] [Yade-dev] Colorful Errors and Warnings in
 xterm when compiling! EXTRA :)
In-Reply-To: <20080929205307.2d2b8c90@szpak>
References: <20080929135943.0a2778e6@szpak> <48E1161F.5050108@arcig.cz>
	<20080929205307.2d2b8c90@szpak>
Message-ID: <20080930151435.4883722b@szpak>

In fact I had to put this in ~/.colorgccrc

 g++: /usr/bin/g++
 gcc: /usr/bin/g++


dunno why. But the colors look great, Bruno was impressed also.
I wonder how long before he installs this too :) Did you know about
colorgcc before?

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Tue Sep 30 15:50:12 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 30 Sep 2008 15:50:12 +0200
Subject: [deprecated list] [Yade-dev] random-access container for
	interactions
In-Reply-To: <200809301508.28061.sj2001@yandex.ru>
References: <200809301508.28061.sj2001@yandex.ru>
Message-ID: <48E22E94.2000302@arcig.cz>

Hi, cool!!! I just wanted to hack InteractionVecSet so that interactions
could be accessed randomly with interger index and you've done it before
I did... :-)



> 1. How to set interaction container from python gui?
>   
No easy way... The default container is constructed in
MetaBody::MetaBody() initializers. You could add some method to pyOmega
to switch container to InteractionVecMap.
> 2. How to incorporate random access to Interaction*MetaEngines?
>   
See the loop over all interactions in
InteractionPhysicsMetaEngine::action? It would have to be changed there.
For openMP, you need integer indexing (with constant time access, of
course), so you would loop like this

# pragma omp parallel for
for(long i=0; i<transientInteractions.size() /* or something like that
*/; i++){
   shared_ptr<Interaction>=transientInteractions.getNth(i);
   ...
}

If you can benchmark that openmp loop with OMP_NUM_THREADS==1 is as fast
as non-openmp for, then it could be there by default.
> and PhysicalActionVectorVector::find break a parallel computations because it resize
> physicalActions container.
>   
? It should resize only when number of bodies changes.

Vaclav


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Tue Sep 30 15:52:45 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 30 Sep 2008 15:52:45 +0200
Subject: [deprecated list] [Yade-dev] Colorful Errors and Warnings in
 xterm when compiling! EXTRA :)
In-Reply-To: <20080930151435.4883722b@szpak>
References: <20080929135943.0a2778e6@szpak>
	<48E1161F.5050108@arcig.cz>	<20080929205307.2d2b8c90@szpak>
	<20080930151435.4883722b@szpak>
Message-ID: <48E22F2D.80407@arcig.cz>


> dunno why. But the colors look great, Bruno was impressed also.
> I wonder how long before he installs this too :) Did you know about
> colorgcc before?
>   
Yes, I knew it, and I think it has one flaw. The good approach is to do
like distcc: you call distcc with the program to run as the first
argument (distcc g++-4.3 etc). Whereas colorgcc becomes link to the
compiler, which is IMHO not very nice, since the version of compiler you
use is determined by ~/.colorgcc.

I personally use vim's built-in quickfix window with :set makeprg=scons,
which parses warnings and errors and gets you to that line with cursor.

Vaclav

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From sj2001 at yandex.ru  Tue Sep 30 20:15:12 2008
From: sj2001 at yandex.ru (sega)
Date: Tue, 30 Sep 2008 22:15:12 +0400
Subject: [deprecated list] [Yade-dev] random-access container for
	interactions
In-Reply-To: <48E22E94.2000302@arcig.cz>
References: <200809301508.28061.sj2001@yandex.ru> <48E22E94.2000302@arcig.cz>
Message-ID: <200809302215.12524.sj2001@yandex.ru>


> > 2. How to incorporate random access to Interaction*MetaEngines?

I mean, whether to ensure compatibility for containers with serial access? Or in the future to require only random-access containers? 

> > and PhysicalActionVectorVector::find break a parallel computations because it resize
> > physicalActions container.
> ? It should resize only when number of bodies changes.

No. For example, try GravityEngine with pragma omp parallel. It will be crashed simulation.
That this does not happen, you must first call this function with the greatest body_id.
(workaround, to use serial GravityEngine before any parallel engine which need physicalActions).

-- 
Best regards, Sergei D.

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Tue Sep 30 20:38:54 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Tue, 30 Sep 2008 20:38:54 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1534 - in trunk: gui/py
	pkg/dem/PreProcessor
Message-ID: <200809301838.m8UIcsdP024829@sheep.berlios.de>

Author: eudoxos
Date: 2008-09-30 20:38:52 +0200 (Tue, 30 Sep 2008)
New Revision: 1534

Modified:
   trunk/gui/py/_utils.cpp
   trunk/gui/py/eudoxos.py
   trunk/pkg/dem/PreProcessor/TriaxialTest.cpp
   trunk/pkg/dem/PreProcessor/TriaxialTest.hpp
Log:
1. TriaxialTest now takes readiusMean argument (by default negative, i.e. disabled); if >0, box size is scaled so that both requested porosity and mean size can be preserved.
2. Attempt to fix computation of stress from stored elastic energy.


Modified: trunk/gui/py/_utils.cpp
===================================================================
--- trunk/gui/py/_utils.cpp	2008-09-30 10:49:22 UTC (rev 1533)
+++ trunk/gui/py/_utils.cpp	2008-09-30 18:38:52 UTC (rev 1534)
@@ -17,20 +17,20 @@
 bool isInBB(Vector3r p, Vector3r bbMin, Vector3r bbMax){return p[0]>bbMin[0] && p[0]<bbMax[0] && p[1]>bbMin[1] && p[1]<bbMax[1] && p[2]>bbMin[2] && p[2]<bbMax[2];}
 
 /* \todo implement groupMask */
-python::tuple aabbExtrema(Real cutoff=0.0){
+python::tuple aabbExtrema(Real cutoff=0.0, bool centers=false){
 	if(cutoff<0. || cutoff>1.) throw invalid_argument("Cutoff must be >=0 and <=1.");
 	Real inf=std::numeric_limits<Real>::infinity();
 	Vector3r minimum(inf,inf,inf),maximum(-inf,-inf,-inf);
 	FOREACH(const shared_ptr<Body>& b, *Omega::instance().getRootBody()->bodies){
 		shared_ptr<Sphere> s=dynamic_pointer_cast<Sphere>(b->geometricalModel); if(!s) continue;
 		Vector3r rrr(s->radius,s->radius,s->radius);
-		minimum=componentMinVector(minimum,b->physicalParameters->se3.position-rrr);
-		maximum=componentMaxVector(maximum,b->physicalParameters->se3.position+rrr);
+		minimum=componentMinVector(minimum,b->physicalParameters->se3.position-(centers?0:rrr));
+		maximum=componentMaxVector(maximum,b->physicalParameters->se3.position+(centers?0:rrr));
 	}
 	Vector3r dim=maximum-minimum;
 	return python::make_tuple(vec2tuple(minimum+.5*cutoff*dim),vec2tuple(maximum-.5*cutoff*dim));
 }
-BOOST_PYTHON_FUNCTION_OVERLOADS(aabbExtrema_overloads,aabbExtrema,0,1);
+BOOST_PYTHON_FUNCTION_OVERLOADS(aabbExtrema_overloads,aabbExtrema,0,2);
 
 python::tuple negPosExtremeIds(int axis, Real distFactor=1.1){
 	python::tuple extrema=aabbExtrema();
@@ -163,7 +163,7 @@
 
 BOOST_PYTHON_MODULE(_utils){
 	def("PWaveTimeStep",PWaveTimeStep);
-	def("aabbExtrema",aabbExtrema,aabbExtrema_overloads(args("cutoff")));
+	def("aabbExtrema",aabbExtrema,aabbExtrema_overloads(args("cutoff","centers")));
 	def("negPosExtremeIds",negPosExtremeIds,negPosExtremeIds_overloads(args("axis","distFactor")));
 	def("coordsAndDisplacements",coordsAndDisplacements,coordsAndDisplacements_overloads(args("AABB")));
 	def("setRefSe3",setRefSe3);

Modified: trunk/gui/py/eudoxos.py
===================================================================
--- trunk/gui/py/eudoxos.py	2008-09-30 10:49:22 UTC (rev 1533)
+++ trunk/gui/py/eudoxos.py	2008-09-30 18:38:52 UTC (rev 1534)
@@ -9,7 +9,7 @@
 	# E=(1/2)??Al # global stored energy
 	# ?=EE/(.5?Al)=EE/(.5?V)
 	from yade import utils
-	dim=utils.aabbDim(cutoff)
+	dim=utils.aabbDim(cutoff,centers=True)
 	return utils.elasticEnergy(utils.aabbExtrema(cutoff))/(.5*strain*dim[0]*dim[1]*dim[2])
 
 def estimatePoissonYoung(principalAxis,stress=0,plot=False,cutoff=0.):

Modified: trunk/pkg/dem/PreProcessor/TriaxialTest.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/TriaxialTest.cpp	2008-09-30 10:49:22 UTC (rev 1533)
+++ trunk/pkg/dem/PreProcessor/TriaxialTest.cpp	2008-09-30 18:38:52 UTC (rev 1534)
@@ -81,15 +81,12 @@
 #include <boost/random/normal_distribution.hpp>
 
 
+CREATE_LOGGER(TriaxialTest);
 
-
 using namespace boost;
 using namespace std;
 
 
-typedef pair<Vector3r, Real> BasicSphere;
-//! generate a list of non-overlapping spheres
-string GenerateCloud(vector<BasicSphere>& sphere_list, Vector3r lowerCorner, Vector3r upperCorner, long number, Real rad_std_dev, Real porosity);
 
 
 TriaxialTest::TriaxialTest () : FileGenerator()
@@ -161,6 +158,7 @@
 	biaxial2dTest=false;
 
 	radiusStdDev=0.3;
+	radiusMean=-1; // no radius specified
 	
 //	wall_top_id =0;
 // 	wall_bottom_id =0;
@@ -192,6 +190,7 @@
 	REGISTER_ATTRIBUTE(maxMultiplier);
 	REGISTER_ATTRIBUTE(finalMaxMultiplier);
 	REGISTER_ATTRIBUTE(radiusStdDev);
+	REGISTER_ATTRIBUTE(radiusMean);
 
 	REGISTER_ATTRIBUTE(sphereYoungModulus);
 	REGISTER_ATTRIBUTE(spherePoissonRatio);
@@ -277,6 +276,25 @@
 	rootBody->bodies 			= shared_ptr<BodyContainer>(new BodyRedirectionVector);
 
 	shared_ptr<Body> body;
+
+
+
+	/* if _mean_radius is not given (i.e. <=0), then calculate it from box size;
+	 * OTOH, if it is specified, scale the box preserving its ratio and lowerCorner so that the radius can be as requested
+	 */
+	Vector3r dimensions=upperCorner-lowerCorner; Real volume=dimensions.X()*dimensions.Y()*dimensions.Z();
+	Real porosity=.75;
+	Real really_radiusMean;
+
+	if(radiusMean<=0) really_radiusMean=pow(volume*(1-porosity)/(Mathr::PI*(4/3.)*numberOfGrains),1/3.);
+	else {
+		Real boxScaleFactor=radiusMean*pow((4/3.)*Mathr::PI*numberOfGrains/(volume*(1-porosity)),1/3.);
+		LOG_INFO("Mean radius value of "<<radiusMean<<" requested, scaling box by "<<boxScaleFactor);
+		dimensions*=boxScaleFactor;
+		upperCorner=lowerCorner+dimensions;
+		really_radiusMean=radiusMean;
+	}
+
 	
 	
 	
@@ -386,27 +404,18 @@
 	
 	vector<BasicSphere> sphere_list;
 	if(importFilename!="") sphere_list=Shop::loadSpheresFromFile(importFilename,lowerCorner,upperCorner);
-	else message+=GenerateCloud(sphere_list, lowerCorner, upperCorner, numberOfGrains, radiusStdDev, 0.75);
-	
+	else message+=GenerateCloud(sphere_list, lowerCorner, upperCorner, numberOfGrains, radiusStdDev, really_radiusMean, porosity);
 	vector<BasicSphere>::iterator it = sphere_list.begin();
 	vector<BasicSphere>::iterator it_end = sphere_list.end();
-			
-	for (;it!=it_end; ++it)
-	{
-		cerr << "sphere (" << it->first << " " << it->second << ")"<<endl;
-		createSphere(body,it->first,it->second,false,true);
+	FOREACH(const BasicSphere& it, sphere_list){
+		LOG_DEBUG("sphere (" << it.first << " " << it.second << ")");
+		createSphere(body,it.first,it.second,false,true);
 		rootBody->bodies->insert(body);
 	}	
+
 	
 	
 	return true;
-//  	return "Generated a sample inside box of dimensions: (" 
-//  		+ lexical_cast<string>(lowerCorner[0]) + "," 
-//  		+ lexical_cast<string>(lowerCorner[1]) + "," 
-//  		+ lexical_cast<string>(lowerCorner[2]) + ") and (" 
-//  		+ lexical_cast<string>(upperCorner[0]) + "," 
-//  		+ lexical_cast<string>(upperCorner[1]) + "," 
-//  		+ lexical_cast<string>(upperCorner[2]) + ").";
 
 }
 
@@ -609,10 +618,12 @@
 	//cerr << "fin de section triaxialcompressionEngine = shared_ptr<TriaxialCompressionEngine> (new TriaxialCompressionEngine);" << std::endl;
 	
 // recording global stress
-	triaxialStateRecorder = shared_ptr<TriaxialStateRecorder>(new TriaxialStateRecorder);
-	triaxialStateRecorder-> outputFile 		= WallStressRecordFile + Key;
-	triaxialStateRecorder-> interval 		= recordIntervalIter;
-	//triaxialStateRecorderer-> thickness 		= thickness;
+	if(recordIntervalIter>0){
+		triaxialStateRecorder = shared_ptr<TriaxialStateRecorder>(new TriaxialStateRecorder);
+		triaxialStateRecorder-> outputFile 		= WallStressRecordFile + Key;
+		triaxialStateRecorder-> interval 		= recordIntervalIter;
+		//triaxialStateRecorderer-> thickness 		= thickness;
+	}
 
 	shared_ptr<MakeItFlat> makeItFlat(new MakeItFlat);
 	makeItFlat->direction=2;
@@ -699,7 +710,7 @@
 }
 
 
-string GenerateCloud(vector<BasicSphere>& sphere_list, Vector3r lowerCorner, Vector3r upperCorner, long number, Real rad_std_dev, Real porosity)
+string TriaxialTest::GenerateCloud(vector<BasicSphere>& sphere_list, Vector3r lowerCorner, Vector3r upperCorner, long number, Real rad_std_dev, Real mean_radius, Real porosity)
 {
 	typedef boost::minstd_rand StdGenerator;
 	static StdGenerator generator;
@@ -711,11 +722,8 @@
 	sphere_list.clear();
 	long tries = 1000; //nb of tries for positionning the next sphere
 	Vector3r dimensions = upperCorner - lowerCorner;
-		
-	Real mean_radius = std::pow(dimensions.X()*dimensions.Y()*dimensions.Z()*(1-porosity)/(3.1416*1.3333*number),0.333333);
-        //cerr << mean_radius;
 
-	std::cerr << "generating aggregates ... ";
+	LOG_INFO("Generating aggregates ...");
 	
 	long t, i;
 	for (i=0; i<number; ++i) {

Modified: trunk/pkg/dem/PreProcessor/TriaxialTest.hpp
===================================================================
--- trunk/pkg/dem/PreProcessor/TriaxialTest.hpp	2008-09-30 10:49:22 UTC (rev 1533)
+++ trunk/pkg/dem/PreProcessor/TriaxialTest.hpp	2008-09-30 18:38:52 UTC (rev 1534)
@@ -73,9 +73,9 @@
 				StabilityCriterion,
 				maxMultiplier, ///max multiplier of diameters during internal compaction
 				finalMaxMultiplier,
-				wallOversizeFactor,
-				radiusStdDev; // make walls bigger (/smaller) than necessary by this factor
-
+				wallOversizeFactor, // make walls bigger (/smaller) than necessary by this factor
+				radiusStdDev,
+				radiusMean;
 		bool		 wall_top
 				,wall_bottom
 				,wall_1
@@ -127,6 +127,11 @@
 		void createSphere(shared_ptr<Body>& body, Vector3r position, Real radius,bool big,bool dynamic);
 		void createActors(shared_ptr<MetaBody>& rootBody);
 		void positionRootBody(shared_ptr<MetaBody>& rootBody);
+
+		typedef pair<Vector3r, Real> BasicSphere;
+		//! generate a list of non-overlapping spheres
+		string GenerateCloud(vector<BasicSphere>& sphere_list, Vector3r lowerCorner, Vector3r upperCorner, long number, Real rad_std_dev, Real mean_radius, Real porosity);
+
 	
 	public : 
 		TriaxialTest ();
@@ -137,6 +142,7 @@
 		void registerAttributes();
 	REGISTER_CLASS_NAME(TriaxialTest);
 	REGISTER_BASE_CLASS_NAME(FileGenerator);
+	DECLARE_LOGGER;
 };
 
 REGISTER_SERIALIZABLE(TriaxialTest,false);


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at arcig.cz  Wed Oct  1 10:47:10 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 01 Oct 2008 10:47:10 +0200
Subject: [deprecated list] [Yade-dev] random-access container for
	interactions
In-Reply-To: <200809302215.12524.sj2001@yandex.ru>
References: <200809301508.28061.sj2001@yandex.ru> <48E22E94.2000302@arcig.cz>
	<200809302215.12524.sj2001@yandex.ru>
Message-ID: <48E3390E.5030004@arcig.cz>

sega napsal(a):
>>> 2. How to incorporate random access to Interaction*MetaEngines?
>>>       
>
> I mean, whether to ensure compatibility for containers with serial access? Or in the future to require only random-access containers? 
>   
Please run some tests how does your container perform compared to
containers we already have. If it is roughly on par with them, random
access is a great bonus and I would be all for using only the new one.


>>> and PhysicalActionVectorVector::find break a parallel computations because it resize
>>> physicalActions container.
>>>       
>> ? It should resize only when number of bodies changes.
>>     
>
> No. For example, try GravityEngine with pragma omp parallel. It will be crashed simulation.
> That this does not happen, you must first call this function with the greatest body_id.
> (workaround, to use serial GravityEngine before any parallel engine which need physicalActions).
>   
Janek could comment on this, perhaps? How about
physicalActionContainerResetter, that is normally run at the beginning
of each iteration; don't you have problems there?

Vaclav


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Wed Oct  1 11:41:04 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Wed, 1 Oct 2008 11:41:04 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1535 - in trunk: gui/py
	pkg/dem/PreProcessor
Message-ID: <200810010941.m919f4TV002106@sheep.berlios.de>

Author: eudoxos
Date: 2008-10-01 11:41:03 +0200 (Wed, 01 Oct 2008)
New Revision: 1535

Modified:
   trunk/gui/py/_utils.cpp
   trunk/gui/py/eudoxos.py
   trunk/gui/py/utils.py
   trunk/pkg/dem/PreProcessor/TriaxialTest.cpp
Log:
1. Fix adding empty engine if record wall stress interval <= 0 in TriaxialTest (bug introduced yesterday)


Modified: trunk/gui/py/_utils.cpp
===================================================================
--- trunk/gui/py/_utils.cpp	2008-09-30 18:38:52 UTC (rev 1534)
+++ trunk/gui/py/_utils.cpp	2008-10-01 09:41:03 UTC (rev 1535)
@@ -24,8 +24,8 @@
 	FOREACH(const shared_ptr<Body>& b, *Omega::instance().getRootBody()->bodies){
 		shared_ptr<Sphere> s=dynamic_pointer_cast<Sphere>(b->geometricalModel); if(!s) continue;
 		Vector3r rrr(s->radius,s->radius,s->radius);
-		minimum=componentMinVector(minimum,b->physicalParameters->se3.position-(centers?0:rrr));
-		maximum=componentMaxVector(maximum,b->physicalParameters->se3.position+(centers?0:rrr));
+		minimum=componentMinVector(minimum,b->physicalParameters->se3.position-(centers?Vector3r::ZERO:rrr));
+		maximum=componentMaxVector(maximum,b->physicalParameters->se3.position+(centers?Vector3r::ZERO:rrr));
 	}
 	Vector3r dim=maximum-minimum;
 	return python::make_tuple(vec2tuple(minimum+.5*cutoff*dim),vec2tuple(maximum-.5*cutoff*dim));

Modified: trunk/gui/py/eudoxos.py
===================================================================
--- trunk/gui/py/eudoxos.py	2008-09-30 18:38:52 UTC (rev 1534)
+++ trunk/gui/py/eudoxos.py	2008-10-01 09:41:03 UTC (rev 1535)
@@ -9,7 +9,7 @@
 	# E=(1/2)??Al # global stored energy
 	# ?=EE/(.5?Al)=EE/(.5?V)
 	from yade import utils
-	dim=utils.aabbDim(cutoff,centers=True)
+	dim=utils.aabbDim(cutoff,centers=False)
 	return utils.elasticEnergy(utils.aabbExtrema(cutoff))/(.5*strain*dim[0]*dim[1]*dim[2])
 
 def estimatePoissonYoung(principalAxis,stress=0,plot=False,cutoff=0.):

Modified: trunk/gui/py/utils.py
===================================================================
--- trunk/gui/py/utils.py	2008-09-30 18:38:52 UTC (rev 1534)
+++ trunk/gui/py/utils.py	2008-10-01 09:41:03 UTC (rev 1535)
@@ -79,9 +79,9 @@
 	return walls
 
 
-def aabbDim(cutoff=0.):
+def aabbDim(cutoff=0.,centers=False):
 	"""return dimensions of the bounding box, optionally cut."""
-	a=aabbExtrema(cutoff)
+	a=aabbExtrema(cutoff,centers)
 	return (a[1][0]-a[0][0],a[1][1]-a[0][1],a[1][2]-a[0][2])
 
 def perpendicularArea(axis):

Modified: trunk/pkg/dem/PreProcessor/TriaxialTest.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/TriaxialTest.cpp	2008-09-30 18:38:52 UTC (rev 1534)
+++ trunk/pkg/dem/PreProcessor/TriaxialTest.cpp	2008-10-01 09:41:03 UTC (rev 1535)
@@ -659,7 +659,7 @@
 	rootBody->engines.push_back(globalStiffnessCounter);
 	rootBody->engines.push_back(globalStiffnessTimeStepper);
 	rootBody->engines.push_back(triaxialcompressionEngine);
-	rootBody->engines.push_back(triaxialStateRecorder);
+	if(recordIntervalIter>0) rootBody->engines.push_back(triaxialStateRecorder);
 	//rootBody->engines.push_back(gravityCondition);
 	
 	rootBody->engines.push_back(shared_ptr<Engine> (new NewtonsDampedLaw));
@@ -673,9 +673,10 @@
 	
 		
 	if (saveAnimationSnapshots) {
-	shared_ptr<PositionOrientationRecorder> positionOrientationRecorder(new PositionOrientationRecorder);
-	positionOrientationRecorder->outputFile = AnimationSnapshotsBaseName;
-	rootBody->engines.push_back(positionOrientationRecorder);}
+		shared_ptr<PositionOrientationRecorder> positionOrientationRecorder(new PositionOrientationRecorder);
+		positionOrientationRecorder->outputFile = AnimationSnapshotsBaseName;
+		rootBody->engines.push_back(positionOrientationRecorder);
+	}
 	
 	rootBody->initializers.clear();
 	rootBody->initializers.push_back(physicalActionInitializer);


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From dorofeenko at icp.ac.ru  Wed Oct  1 13:26:05 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Wed, 1 Oct 2008 15:26:05 +0400
Subject: [deprecated list] [Yade-dev] random-access container for
	interactions
In-Reply-To: <48E3390E.5030004@arcig.cz>
References: <200809301508.28061.sj2001@yandex.ru>
	<200809302215.12524.sj2001@yandex.ru> <48E3390E.5030004@arcig.cz>
Message-ID: <200810011526.05572.dorofeenko@icp.ac.ru>


> Please run some tests how does your container perform compared to
> containers we already have. If it is roughly on par with them, random
> access is a great bonus and I would be all for using only the new one.

According to my reasons and results, InteractionVecMap does not slow, 
and even a little faster than InteractionVecSet.

> How about
> physicalActionContainerResetter, that is normally run at the beginning
> of each iteration; don't you have problems there?

not sure that understood the question. 
There should be no problems, because physicalActionContainerResetter is performed in sequential mode...



-- 
Best regards, 
Sergei D. 	dorofeenko at icp.ac.ru

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Wed Oct  1 15:59:18 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Wed, 1 Oct 2008 15:59:18 +0200
Subject: [deprecated list] [Yade-dev] random-access container for
	interactions
In-Reply-To: <200810011526.05572.dorofeenko@icp.ac.ru>
References: <200809301508.28061.sj2001@yandex.ru>
	<200809302215.12524.sj2001@yandex.ru> <48E3390E.5030004@arcig.cz>
	<200810011526.05572.dorofeenko@icp.ac.ru>
Message-ID: <20081001155918.0ac10b0a@szpak>

sega said:     (by the date of Wed, 1 Oct 2008 15:26:05 +0400)

> > How about
> > physicalActionContainerResetter, that is normally run at the beginning
> > of each iteration; don't you have problems there?
> 
> not sure that understood the question. 
> There should be no problems, because physicalActionContainerResetter
> is performed in sequential mode...

Sega is right. It goes from begin() to end() so isn't resizing the
container. That shouldn't be a problem then.

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Thu Oct  2 12:31:55 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Thu, 02 Oct 2008 12:31:55 +0200
Subject: [deprecated list] [Yade-dev] goReverse
Message-ID: <48E4A31B.4090305@arcig.cz>

Hi (Janek),

do you think it would be possible for the 2d metaengines to not accept
both combinations of types, but only one? To put it straight: facet
(/box etc) and sphere can create two interactions, with

 1. id1=Facet, id2=Sphere
 2. id1=Sphere, id2=Facet

For the case 1., IFacet2IS4SCG::go is called, which is just fine.
However, for the second case, we call goReverse, which in turn calls
::go and then swaps a some variables. The swapping happens at _every
iteration_.

My point, therefore, would be to mandate type order for 2d metaengines
-- the collider could, when creating new the interaction, swap ids
easily, so that they would be always in the order expected by the
metaengine. Or - perhaps better, since collider knows nothing about
types, swap them in the MetaEngine

I am currently experimenting with swapping the order in the
EngineUnit::goReverse, I will see what the results are.

Vaclav

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Thu Oct  2 16:10:39 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Thu, 2 Oct 2008 16:10:39 +0200
Subject: [deprecated list] [Yade-dev] random-access container for
	interactions
In-Reply-To: <48E39C89.2080107@arcig.cz>
References: <200809301508.28061.sj2001@yandex.ru>
	<200809302215.12524.sj2001@yandex.ru> <48E3390E.5030004@arcig.cz>
	<200810011526.05572.dorofeenko@icp.ac.ru>
	<20081001155918.0ac10b0a@szpak> <48E39C89.2080107@arcig.cz>
Message-ID: <20081002161039.5f90aaf4@szpak>

V?clav S(milauer said:     (by the date of Wed, 01 Oct 2008 17:51:37 +0200)


> > Sega is right. It goes from begin() to end() so isn't resizing the
> > container. That shouldn't be a problem then.
> >   
> Right, but I thought the problem was when running gravity in parallel
> mode that if number of bodies doesn't match number of physical actions,
> then the container is resized and crashes. I don't understant why should
> gravityEngine resize physicalActions container at every iteration... ?

If GravityEngine is resizing - it is doing that only ONCE. In fact
the first engine in the loop that assigns any PhysicalAction is
responsible for this resizing.

So if we don't use GravityEngine - this will be another one, first in
the loop. I didn't check in the code right now, so it would require
some investigation.

It might be better to resize once, I dunno.

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Thu Oct  2 16:39:32 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Thu, 2 Oct 2008 16:39:32 +0200
Subject: [deprecated list] [Yade-dev] goReverse
In-Reply-To: <48E4A31B.4090305@arcig.cz>
References: <48E4A31B.4090305@arcig.cz>
Message-ID: <20081002163932.3ae40cc0@szpak>

V?clav ?milauer said:     (by the date of Thu, 02 Oct 2008 12:31:55 +0200)

> Hi (Janek),
> 
> do you think it would be possible for the 2d metaengines to not accept
> both combinations of types, but only one? To put it straight: facet
> (/box etc) and sphere can create two interactions, with
> 
>  1. id1=Facet, id2=Sphere
>  2. id1=Sphere, id2=Facet
> 
> For the case 1., IFacet2IS4SCG::go is called, which is just fine.
> However, for the second case, we call goReverse, which in turn calls
> ::go and then swaps a some variables. The swapping happens at _every
> iteration_.
> 
> My point, therefore, would be to mandate type order for 2d metaengines
> -- the collider could, when creating new the interaction, swap ids
> easily, so that they would be always in the order expected by the
> metaengine. Or - perhaps better, since collider knows nothing about
> types, swap them in the MetaEngine
> 
> I am currently experimenting with swapping the order in the
> EngineUnit::goReverse, I will see what the results are.

It is possible of course. But I don't think it will be useful.
Swapping is just swapping - it doesn't matter where you do it -
inside ::goReverse() or inside MetaEngine, it's just the same number
of computer assembly instructions.

That will reduce the amount of swapping, because it will be
done only when interaction is created. I feel that the speed
improvement will be < 0.01% and that you are wasting your time with
that. Remember that it's swapping only pointers, so it's roughly
equivalent of std::swap(void*,void*).

If you will achieve any better speed improvement I will be really
surprised.

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From sj2001 at yandex.ru  Thu Oct  2 17:27:30 2008
From: sj2001 at yandex.ru (sega)
Date: Thu, 2 Oct 2008 19:27:30 +0400
Subject: [deprecated list] [Yade-dev] random-access container for
	interactions
In-Reply-To: <20081002161039.5f90aaf4@szpak>
References: <200809301508.28061.sj2001@yandex.ru> <48E39C89.2080107@arcig.cz>
	<20081002161039.5f90aaf4@szpak>
Message-ID: <200810021927.30669.sj2001@yandex.ru>


> If GravityEngine is resizing - it is doing that only ONCE. In fact
> the first engine in the loop that assigns any PhysicalAction is
> responsible for this resizing.

Not once! It is doing resizing in each case when body_id > physicalActions.size()!!
So, in a parallel loop a first thread will be crash because a second thread (with greatest body ids)
will doing resizing on each loop iteration. Although this is happens only at the first iteration simulation... so only once.

-- 
Best regards, Sergei D.

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From sj2001 at yandex.ru  Thu Oct  2 17:52:35 2008
From: sj2001 at yandex.ru (sega)
Date: Thu, 2 Oct 2008 19:52:35 +0400
Subject: [deprecated list] [Yade-dev] goReverse
In-Reply-To: <20081002163932.3ae40cc0@szpak>
References: <48E4A31B.4090305@arcig.cz> <20081002163932.3ae40cc0@szpak>
Message-ID: <200810021952.35448.sj2001@yandex.ru>

 
> That will reduce the amount of swapping, because it will be
> done only when interaction is created. I feel that the speed
> improvement will be < 0.01% and that you are wasting your time with
> that. Remember that it's swapping only pointers, so it's roughly
> equivalent of std::swap(void*,void*).

I agree. From profiling I get own cost goReverse is < 0.01%...
For about 18000 spheres and 200 iteration I get
65% integral cost for MetaBody::MoveToNextTimeStep, when main cost is:
26% PersistentSAPCollider::action
10.8% ElasticContactLaw::action
10.8% InteractionGeometryMetaEngine::action
...rest < 6% on a function...


-- 
Best regards, Sergei D.

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Sun Oct  5 15:21:52 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Sun, 5 Oct 2008 15:21:52 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1536 - in trunk: core gui/qt3
	lib/multimethods	pkg/dem/Engine/EngineUnit	pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry
Message-ID: <200810051321.m95DLqFm021992@sheep.berlios.de>

Author: eudoxos
Date: 2008-10-05 15:21:51 +0200 (Sun, 05 Oct 2008)
New Revision: 1536

Modified:
   trunk/core/Interaction.cpp
   trunk/core/Interaction.hpp
   trunk/gui/qt3/GLViewer.cpp
   trunk/gui/qt3/SnapshotEngine.cpp
   trunk/gui/qt3/SnapshotEngine.hpp
   trunk/gui/qt3/qt.py
   trunk/lib/multimethods/DynLibDispatcher.hpp
   trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp
   trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp
   trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp
   trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.hpp
Log:
1. Add Interaction::swapOrder(), for use in EngineUnits that want to avoid calling goReverse()
2. SnapshotEngine can sleep specified number of msecs after shot, which probably can avoid some hw problems (make_current failed in mesa, freezes etc)
3. InteractingFacet2IS4SCG now works "correctly" (not exactly physically, though) with shear
4. DynLibDispatcher should report names of classes if dispatch fails.




Modified: trunk/core/Interaction.cpp
===================================================================
--- trunk/core/Interaction.cpp	2008-10-01 09:41:03 UTC (rev 1535)
+++ trunk/core/Interaction.cpp	2008-10-05 13:21:51 UTC (rev 1536)
@@ -43,3 +43,9 @@
 	REGISTER_ATTRIBUTE(interactionPhysics);
 }
 
+void Interaction::swapOrder(){
+	if(interactionGeometry || interactionPhysics || !isNew){
+		throw std::logic_error("Bodies in interaction cannot be swapped if !isNew, have interactionGeometry or have interactionPhysics.");
+	}
+	std::swap(id1,id2);
+}

Modified: trunk/core/Interaction.hpp
===================================================================
--- trunk/core/Interaction.hpp	2008-10-01 09:41:03 UTC (rev 1535)
+++ trunk/core/Interaction.hpp	2008-10-05 13:21:51 UTC (rev 1536)
@@ -13,6 +13,8 @@
 //BOOST_STRONG_TYPEDEF(int, body_id_t)
 typedef int body_id_t;
 
+class InteractionGeometryEngineUnit;
+
 class Interaction : public Serializable
 {
 	private	:
@@ -33,6 +35,9 @@
 		body_id_t getId1() {return id1;};
 		body_id_t getId2() {return id2;};
 
+		//! swaps order of bodies within the interaction
+		void swapOrder();
+
 		#if 0
 			//! Whether both bodies involved in interaction satisfies given mask; provide rootBody for faster lookup
 			bool maskBothOK(int mask, MetaBody* rootBody=NULL){return (mask==0) || (Body::byId(id1,rootBody)->maskOK(mask) && Body::byId(id2,rootBody)->maskOK(mask));}

Modified: trunk/gui/qt3/GLViewer.cpp
===================================================================
--- trunk/gui/qt3/GLViewer.cpp	2008-10-01 09:41:03 UTC (rev 1535)
+++ trunk/gui/qt3/GLViewer.cpp	2008-10-05 13:21:51 UTC (rev 1536)
@@ -228,7 +228,7 @@
 		}
 	}
 	else if(e->key()==Qt::Key_S){
-		LOG_DEBUG("Saving QGLViewer state to /tmp/qglviewerState.xml");
+		LOG_INFO("Saving QGLViewer state to /tmp/qglviewerState.xml");
 		setStateFileName("/tmp/qglviewerState.xml"); saveStateToFile(); setStateFileName(QString::null);
 	}
 	else if(e->key()==Qt::Key_X || e->key()==Qt::Key_Y || e->key()==Qt::Key_Z){

Modified: trunk/gui/qt3/SnapshotEngine.cpp
===================================================================
--- trunk/gui/qt3/SnapshotEngine.cpp	2008-10-01 09:41:03 UTC (rev 1535)
+++ trunk/gui/qt3/SnapshotEngine.cpp	2008-10-05 13:21:51 UTC (rev 1536)
@@ -13,5 +13,6 @@
 	glv->setSnapshotFormat("PNG");
 	glv->saveSnapshot(QString(fss.str()),/*overwrite*/ true);
 	savedSnapshots.push_back(fss.str());
+	usleep((long)(msecSleep*1000));
 }
 

Modified: trunk/gui/qt3/SnapshotEngine.hpp
===================================================================
--- trunk/gui/qt3/SnapshotEngine.hpp	2008-10-01 09:41:03 UTC (rev 1535)
+++ trunk/gui/qt3/SnapshotEngine.hpp	2008-10-05 13:21:51 UTC (rev 1536)
@@ -21,7 +21,9 @@
 		bool ignoreErrors;
 		//! files that have been created so far
 		vector<string> savedSnapshots;
-	SnapshotEngine():counter(0),viewNo(0),ignoreErrors(true){}
+		//! number of msec to sleep after snapshot (to prevent 3d hw problems)
+		int msecSleep;
+	SnapshotEngine():counter(0),viewNo(0),ignoreErrors(true),msecSleep(0){}
 	virtual void action(MetaBody*);
 	void registerAttributes(){	
 		PeriodicEngine::registerAttributes();
@@ -30,6 +32,7 @@
 		REGISTER_ATTRIBUTE(viewNo);
 		REGISTER_ATTRIBUTE(ignoreErrors);
 		REGISTER_ATTRIBUTE(savedSnapshots);
+		REGISTER_ATTRIBUTE(msecSleep);
 	}
 	DECLARE_LOGGER;
 	REGISTER_CLASS_NAME(SnapshotEngine);

Modified: trunk/gui/qt3/qt.py
===================================================================
--- trunk/gui/qt3/qt.py	2008-10-01 09:41:03 UTC (rev 1535)
+++ trunk/gui/qt3/qt.py	2008-10-05 13:21:51 UTC (rev 1536)
@@ -6,7 +6,7 @@
 
 
 
-def makeSimulationVideo(output,realPeriod=1,virtPeriod=0,iterPeriod=0,viewNo=0,fps=24):
+def makeSimulationVideo(output,realPeriod=1,virtPeriod=0,iterPeriod=0,viewNo=0,fps=24,msecSleep=0):
 	"""Create video by running simulation. SnapshotEngine is added (and removed once done), temporary
 	files are deleted. The video is theora-encoded in the ogg container. Periodicity is controlled
 	in the same way as for PeriodicEngine (SnapshotEngine is a PeriodicEngine and realPeriod, virtPeriod 
@@ -26,7 +26,7 @@
 	# create primary view if none
 	if len(views())==0: View()
 	# remove existing SnaphotEngines
-	se=wrapper.StandAloneEngine('SnapshotEngine',{'iterPeriod':iterPeriod,'realPeriod':realPeriod,'virtPeriod':virtPeriod,'fileBase':os.tmpnam(),'ignoreErrors':False,'viewNo':viewNo})
+	se=wrapper.StandAloneEngine('SnapshotEngine',{'iterPeriod':iterPeriod,'realPeriod':realPeriod,'virtPeriod':virtPeriod,'fileBase':os.tmpnam(),'ignoreErrors':False,'viewNo':viewNo,'msecSleep':msecSleep})
 	origEngines=o.engines; o.engines=[e for e in o.engines if e.name!='SnapshotEngine']+[se]
 	o.run(); o.wait();
 	wildcard=se['fileBase']+'%04d.png'

Modified: trunk/lib/multimethods/DynLibDispatcher.hpp
===================================================================
--- trunk/lib/multimethods/DynLibDispatcher.hpp	2008-10-01 09:41:03 UTC (rev 1535)
+++ trunk/lib/multimethods/DynLibDispatcher.hpp	2008-10-05 13:21:51 UTC (rev 1536)
@@ -494,7 +494,7 @@
 				}
 			}
 			else if( index1_tmp != -1 && index2_tmp != -1 )
-				cerr << "DynLibDispatcher: ambigious dispatch, could not determine which multivirtual function should be called\n";
+				throw std::runtime_error("DynLibDispatcher: ambiguous or undefined dispatch for 2d multivirtual function, classes: "+base1->getClassName()+" "+base2->getClassName());
 			
 			return false;
 		  };

Modified: trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp
===================================================================
--- trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp	2008-10-01 09:41:03 UTC (rev 1535)
+++ trunk/pkg/dem/Engine/EngineUnit/InteractingFacet2InteractingSphere4SpheresContactGeometry.cpp	2008-10-05 13:21:51 UTC (rev 1536)
@@ -35,12 +35,18 @@
 							const shared_ptr<Interaction>& c)
 {
 	InteractingFacet*   facet = static_cast<InteractingFacet*>(cm1.get());
+	/* could be written as (needs to be tested):
+	 * Vector3r cl=se32.orientation.Conjugate()*(se32.position-se32.position);
+	 */
 	Matrix3r facetAxisT; se31.orientation.ToRotationMatrix(facetAxisT); 
 	Matrix3r facetAxis = facetAxisT.Transpose();
-	
 	// local orientation
 	Vector3r cl = facetAxis*(se32.position - se31.position); 
 
+	//
+	// BEGIN everything in facet-local coordinates
+	//
+
 	Vector3r normal = facet->nf;
 	Real L = normal.Dot(cl);
 	if (L<0) { normal=-normal; L=-L; }
@@ -67,7 +73,7 @@
 
 	if (icr<0)
 	{
-		LOG_INFO("WARNING: a radius of a facet's inscribed circle less than zero! So, shrinkFactor is too large and would be reduced to zero.");
+		LOG_WARN("a radius of a facet's inscribed circle less than zero! So, shrinkFactor is too large and would be reduced to zero.");
 		shrinkFactor=0;
 		icr = facet->icr;
 		sh = 0;
@@ -92,6 +98,10 @@
 		penetrationDepth = sphereRadius - normal.Normalize();
 	}
 
+	//
+	// END everything in facet-local coordinates
+	//
+
 	if (penetrationDepth>0)
 	{
 		shared_ptr<SpheresContactGeometry> scm;
@@ -100,7 +110,7 @@
 		else
 			scm = shared_ptr<SpheresContactGeometry>(new SpheresContactGeometry());
 	  
-	    normal = facetAxisT*normal; // global orientation
+		normal = facetAxisT*normal; // in global orientation
 		scm->contactPoint = se32.position - (sphereRadius-0.5*penetrationDepth)*normal; 
 		scm->normal = normal; 
 		scm->penetrationDepth = penetrationDepth;
@@ -112,17 +122,18 @@
 
 		if(hasShear){
 			scm->hasShear=true;
-			scm->pos1=scm->contactPoint-(2*sphereRadius-.5*penetrationDepth)*normal; scm->pos2=se32.position;
+			// fictive center of the sphere representing the facet in the sphere-sphere contact
+			scm->pos1=scm->contactPoint-(scm->radius1-.5*penetrationDepth)*normal; scm->pos2=se32.position;
 			scm->ori1=se31.orientation; scm->ori2=se32.orientation;
 			if(c->isNew){
-				scm->d0=(scm->pos2-scm->pos1).Length();
-				scm->d1=2*sphereRadius-penetrationDepth; scm->d2=sphereRadius-penetrationDepth;
+				scm->d0=scm->radius1+scm->radius2-penetrationDepth;
+				scm->d1=scm->radius1-.5*penetrationDepth; scm->d2=scm->radius2-.5*penetrationDepth;
 				// quasi-constants
 				scm->cp1rel.Align(Vector3r::UNIT_X,se31.orientation.Conjugate()*normal);
 				scm->cp2rel.Align(Vector3r::UNIT_X,se32.orientation.Conjugate()*(-normal));
 				scm->cp1rel.Normalize(); scm->cp2rel.Normalize();
 			}
-			cerr<<"[n"<<scm->displacementN()<<" t"<<scm->displacementT()<<"]";
+			TRVAR2(scm->contPtInTgPlane1(),scm->contPtInTgPlane2());
 		}
 
 		return true;
@@ -137,16 +148,23 @@
 								const Se3r& se32,
 								const shared_ptr<Interaction>& c)
 {
+	c->swapOrder();
+	//LOG_WARN("Swapped interaction order for "<<c->getId2()<<"&"<<c->getId1());
+	return go(cm2,cm1,se32,se31,c);
+#if 0	
 	bool isInteracting = go(cm2,cm1,se32,se31,c);
 	if (isInteracting)
 	{
 	    SpheresContactGeometry* scm = static_cast<SpheresContactGeometry*>(c->interactionGeometry.get());
-	    scm->normal = -scm->normal;
-	    Real tmpR = scm->radius1;
-	    scm->radius1 = scm->radius2;
-	    scm->radius2 = tmpR;
+		 scm->normal*=-1;
+		 std::swap(scm->radius1,scm->radius2);
+		 if(hasShear){
+			 swap(scm->pos1,scm->pos2); swap(scm->ori1,scm->ori2);
+			 if(c->isNew){ swap(scm->cp1rel,scm->cp2rel); swap(scm->d1,scm->d2); }
+		 }
 	}
 	return isInteracting;
+#endif
 }
 
 YADE_PLUGIN();

Modified: trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp
===================================================================
--- trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp	2008-10-01 09:41:03 UTC (rev 1535)
+++ trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp	2008-10-05 13:21:51 UTC (rev 1536)
@@ -36,7 +36,6 @@
 		shared_ptr<SpheresContactGeometry> scm;
 		if(c->interactionGeometry) scm=YADE_PTR_CAST<SpheresContactGeometry>(c->interactionGeometry);
 		else { scm=shared_ptr<SpheresContactGeometry>(new SpheresContactGeometry()); c->interactionGeometry=scm; }
-		//cerr<<"Assigned scm "<<scm.get()<<"=="<<c->interactionGeometry.get()<<endl;
 
 		Real penetrationDepth=s1->radius+s2->radius-normal.Normalize(); /* Normalize() works in-place and returns length before normalization; from here, normal is unit vector */
 		scm->contactPoint=se31.position+(s1->radius-0.5*penetrationDepth)*normal;//0.5*(pt1+pt2);

Modified: trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp
===================================================================
--- trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp	2008-10-01 09:41:03 UTC (rev 1535)
+++ trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp	2008-10-05 13:21:51 UTC (rev 1536)
@@ -15,6 +15,7 @@
 #include<yade/lib-opengl/GLUtils.hpp>
 
 YADE_PLUGIN("GLDrawSpheresContactGeometry");
+CREATE_LOGGER(GLDrawSpheresContactGeometry);
 
 void GLDrawSpheresContactGeometry::go(
 		const shared_ptr<InteractionGeometry>& ig,
@@ -77,15 +78,19 @@
 	}
 
 	if(sc->hasShear){
-		Vector3r contPt=se31.position+(sc->d1/sc->d0)*(se32.position-se31.position); // must be recalculated to not be unscaled if scaling displacements ...
+		Vector3r pos1=sc->pos1, pos2=sc->pos2, contPt=sc->contPt();
+		//Vector3r contPt=se31.position+(sc->d1/sc->d0)*(se32.position-se31.position); // must be recalculated to not be unscaled if scaling displacements ...
 		GLUtils::GLDrawLine(pos1,pos2,Vector3r(.5,.5,.5));
 		// sphere center to point on the sphere
 		//GLUtils::GLDrawLine(pos1,pos1+(sc->ori1*sc->cp1rel*Vector3r::UNIT_X*sc->d1),Vector3r(0,.5,1));
 		//GLUtils::GLDrawLine(pos2,pos2+(sc->ori2*sc->cp2rel*Vector3r::UNIT_X*sc->d2),Vector3r(0,1,.5));
+		//TRVAR4(pos1,sc->ori1,pos2,sc->ori2);
+		//TRVAR2(sc->cp2rel,pos2+(sc->ori2*sc->cp2rel*Vector3r::UNIT_X*sc->d2));
 		// contact point to projected points
 		Vector3r ptTg1=sc->contPtInTgPlane1(), ptTg2=sc->contPtInTgPlane2();
-		GLUtils::GLDrawLine(contPt,contPt+ptTg1,Vector3r(0,.5,1));
-		GLUtils::GLDrawLine(contPt,contPt+ptTg2,Vector3r(0,1,.5));
+		TRVAR3(ptTg1,ptTg2,sc->normal)
+		//GLUtils::GLDrawLine(contPt,contPt+ptTg1,Vector3r(0,.5,1)); GLUtils::GLDrawLine(pos1,contPt+ptTg1,Vector3r(0,.5,1));
+		//GLUtils::GLDrawLine(contPt,contPt+ptTg2,Vector3r(0,1,.5)); GLUtils::GLDrawLine(pos2,contPt+ptTg2,Vector3r(0,1,.5));
 		// projected shear
 		GLUtils::GLDrawLine(contPt+ptTg1,contPt+ptTg2,Vector3r(1,1,1));
 		// 

Modified: trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.hpp
===================================================================
--- trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.hpp	2008-10-01 09:41:03 UTC (rev 1535)
+++ trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.hpp	2008-10-05 13:21:51 UTC (rev 1536)
@@ -20,6 +20,7 @@
 		virtual void go(const shared_ptr<InteractionGeometry>&,const shared_ptr<Interaction>&,const shared_ptr<Body>&,const shared_ptr<Body>&,bool wireFrame);
 		//	virtual void registerAttributes();
 
+	DECLARE_LOGGER;
 	RENDERS(SpheresContactGeometry);
 	REGISTER_CLASS_NAME(GLDrawSpheresContactGeometry);
 	REGISTER_BASE_CLASS_NAME(GLDrawInteractionGeometryFunctor);


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Mon Oct  6 19:55:23 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Mon, 06 Oct 2008 19:55:23 +0200
Subject: [deprecated list] [Yade-dev] calling EngineUnit::go to create
	persistent interaction?
Message-ID: <48EA510B.8070207@arcig.cz>

Hi, do we have some plan how to use existing EngineUnits to create
"persistent interactions", i.e. transient but requested explicitly, not
using the collider? We need to disable proximity checks (see IS2IS4SCG)
so that the interaction can be created even if the spheres are too far away.

I thought of setting Interaction::isReal==true &&
Interaction::isNew==true, then calling some
InteractionGeometryEngineUnit (e.g. IS2IS4SCG) and then
InteractionPhysicsEngineUnit. Would that be OK? We should have some
clear policy on this, since persistentInteractions will all be created
in this way at some point.

Secondly, I would like to use dispatcher for this: take b1, b2 and say
something like
InteractionGeometryMetaEngine::oneAction(b1,b2,interaction) that would
in turn call
InteractionGeometryMetaEngine::operator()(b1->interactingGeometry ,
b2->interactingGeometry, b1->physicalParameters->se3,
b2->physicalParameters->se3, interaction); sounds OK to you, Janek?

Vaclav



_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Tue Oct  7 09:02:50 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Tue, 7 Oct 2008 09:02:50 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1538 - in trunk: core extra
	extra/clump gui/py	pkg/common/Engine/MetaEngine
	pkg/dem/Engine/StandAloneEngine scripts
Message-ID: <200810070702.m9772oG1016531@sheep.berlios.de>

Author: eudoxos
Date: 2008-10-07 09:02:48 +0200 (Tue, 07 Oct 2008)
New Revision: 1538

Added:
   trunk/scripts/chain-distant-interactions.py
Modified:
   trunk/core/Interaction.cpp
   trunk/extra/Brefcom.cpp
   trunk/extra/clump/Shop.cpp
   trunk/extra/clump/Shop.hpp
   trunk/gui/py/_utils.cpp
   trunk/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.cpp
   trunk/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.hpp
   trunk/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine.cpp
   trunk/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.hpp
Log:
1. Add InteractionGeometryMetaEngine::explicitAction and InteractionPhysicsMetaEngine::explicitAction for creating contacts manually using the dispatcher
2. add utils.createInteraction(id1,id2) that requests explicit transient interaction creation
3. Add sample ElasticContactLaw2 (in ElasticContactLaw.cpp) that uses new SpheresContactGeometry code and can be used for "persistent" (transient but not deleted by the collider) contacts.
4. Add Shop::applyForceAtContactPoint (applies contact force at contact point to both bodies (reversed for body2) and moments acting on their cenroids as well)
5. All the previous new functionality is demonstrated in scripts/chain-distant-interactions.py.



Modified: trunk/core/Interaction.cpp
===================================================================
--- trunk/core/Interaction.cpp	2008-10-07 06:19:24 UTC (rev 1537)
+++ trunk/core/Interaction.cpp	2008-10-07 07:02:48 UTC (rev 1538)
@@ -27,7 +27,6 @@
 {	
 	isNew = true;
 	isReal = false;
-	isNeighbor = true;
 	isNeighbor = true;//NOTE : TriangulationCollider needs that
 
 }

Modified: trunk/extra/Brefcom.cpp
===================================================================
--- trunk/extra/Brefcom.cpp	2008-10-07 06:19:24 UTC (rev 1537)
+++ trunk/extra/Brefcom.cpp	2008-10-07 07:02:48 UTC (rev 1538)
@@ -128,7 +128,7 @@
 	Shop::Bex::force(id1,rootBody)+=force;
 	Shop::Bex::force(id2,rootBody)-=force;
 	Shop::Bex::momentum(id1,rootBody)+=(contGeom->contactPoint-contGeom->pos1).Cross(force);
-	Shop::Bex::momentum(id1,rootBody)-=(contGeom->contactPoint-contGeom->pos2).Cross(force);
+	Shop::Bex::momentum(id2,rootBody)-=(contGeom->contactPoint-contGeom->pos2).Cross(force);
 }
 
 void BrefcomLaw::action(MetaBody* _rootBody){

Modified: trunk/extra/clump/Shop.cpp
===================================================================
--- trunk/extra/clump/Shop.cpp	2008-10-07 06:19:24 UTC (rev 1537)
+++ trunk/extra/clump/Shop.cpp	2008-10-07 07:02:48 UTC (rev 1538)
@@ -97,13 +97,22 @@
 	}
 }
 
-#define __BEX_ACCESS(retType,shopBexMember,bexClass,bexIdx,bexAttribute) retType& Shop::Bex::shopBexMember(body_id_t id,MetaBody* mb){ assert(bexIdx>=0); return static_pointer_cast<bexClass>((mb?mb:Omega::instance().getRootBody().get())->physicalActions->find(id,bexIdx))->bexAttribute; }
+#define __BEX_ACCESS(retType,shopBexMember,bexClass,bexIdx,bexAttribute) retType& Shop::Bex::shopBexMember(body_id_t id,MetaBody* mb){ assert(bexIdx>=0); shared_ptr<PhysicalActionContainer> pac=(mb?mb:Omega::instance().getRootBody().get())->physicalActions; /*if((long)pac->size()<=id) throw invalid_argument("No " #shopBexMember " for #"+lexical_cast<string>(id)+" (max="+lexical_cast<string>(((long)pac->size()-1))+")");*/ return static_pointer_cast<bexClass>(pac->find(id,bexIdx))->bexAttribute; }
 __BEX_ACCESS(Vector3r,force,Force,forceIdx,force);
 __BEX_ACCESS(Vector3r,momentum,Momentum,momentumIdx,momentum);
 __BEX_ACCESS(Vector3r,globalStiffness,GlobalStiffness,globalStiffnessIdx,stiffness);
 __BEX_ACCESS(Vector3r,globalRStiffness,GlobalStiffness,globalStiffnessIdx,Rstiffness);
 #undef __BEX_ACCESS
 
+/* Apply force on contact point to 2 bodies; the force is oriented as it applies on the first body and is reversed on the second.
+ *
+ * Shop::Bex::initCache must have been called at some point. */
+void Shop::applyForceAtContactPoint(const Vector3r& force, const Vector3r& contPt, body_id_t id1, const Vector3r& pos1, body_id_t id2, const Vector3r& pos2, MetaBody* rootBody){
+	Shop::Bex::force(id1,rootBody)+=force;
+	Shop::Bex::force(id2,rootBody)-=force;
+	Shop::Bex::momentum(id1,rootBody)+=(contPt-pos1).Cross(force);
+	Shop::Bex::momentum(id2,rootBody)-=(contPt-pos2).Cross(force);
+}
 
 
 Real Shop::unbalancedForce(bool useMaxForce, MetaBody* _rb){
@@ -496,6 +505,26 @@
 	return dt;
 }
 
+
+shared_ptr<Interaction> Shop::createExplicitInteraction(body_id_t id1, body_id_t id2){
+	InteractionGeometryMetaEngine* geomMeta=NULL;
+	InteractionPhysicsMetaEngine* physMeta=NULL;
+	shared_ptr<MetaBody> rb=Omega::instance().getRootBody();
+	if(rb->transientInteractions->find(body_id_t(id1),body_id_t(id2))!=0) throw runtime_error(string("transientInteraction already exists between #")+lexical_cast<string>(id1)+" and "+lexical_cast<string>(id2));
+	FOREACH(const shared_ptr<Engine>& e, rb->engines){
+		if(!geomMeta) { geomMeta=dynamic_cast<InteractionGeometryMetaEngine*>(e.get()); if(geomMeta) continue; }
+		if(!physMeta) { physMeta=dynamic_cast<InteractionPhysicsMetaEngine*>(e.get()); if(physMeta) continue; }
+		if(geomMeta&&physMeta){break;}
+	}
+	if(!geomMeta) throw runtime_error("No InteractionGeometryMetaEngine in engines.");
+	if(!physMeta) throw runtime_error("No InteractionPhysicsMetaEngine in engines.");
+	shared_ptr<Body> b1=Body::byId(id1,rb), b2=Body::byId(id2,rb);
+	shared_ptr<Interaction> i=geomMeta->explicitAction(b1,b2);
+	physMeta->explicitAction(b1->physicalParameters,b2->physicalParameters,i);
+	rb->transientInteractions->insert(i);
+	return i;
+}
+
 Shop::sphereGeomStruct Shop::smallSdecXyzData[]={
 	{0.027814,0.028311,0.053055,0.006921},
 	{0.040115,0.039488,0.051634,0.009072},

Modified: trunk/extra/clump/Shop.hpp
===================================================================
--- trunk/extra/clump/Shop.hpp	2008-10-07 06:19:24 UTC (rev 1537)
+++ trunk/extra/clump/Shop.hpp	2008-10-07 07:02:48 UTC (rev 1538)
@@ -102,4 +102,10 @@
 
 		//! Get unbalanced force of the whole simulation
 		static Real unbalancedForce(bool useMaxForce=false, MetaBody* _rb=NULL);
+
+		//! create transientInteraction between 2 bodies, using existing MetaEngine in Omega
+		static shared_ptr<Interaction> createExplicitInteraction(body_id_t id1, body_id_t id2);
+
+		//! apply force on contact point on both bodies (reversed on body 2)
+		static void applyForceAtContactPoint(const Vector3r& force, const Vector3r& contPt, body_id_t id1, const Vector3r& pos1, body_id_t id2, const Vector3r& pos2, MetaBody* rb);
 };

Modified: trunk/gui/py/_utils.cpp
===================================================================
--- trunk/gui/py/_utils.cpp	2008-10-07 06:19:24 UTC (rev 1537)
+++ trunk/gui/py/_utils.cpp	2008-10-07 07:02:48 UTC (rev 1538)
@@ -4,7 +4,7 @@
 #include<yade/core/Omega.hpp>
 #include<yade/pkg-common/Sphere.hpp>
 #include<yade/pkg-dem/SpheresContactGeometry.hpp>
-#include<yade/extra/Brefcom.hpp>
+#include<yade/pkg-common/NormalShearInteractions.hpp>
 #include<cmath>
 using namespace boost::python;
 
@@ -73,8 +73,8 @@
 	Real E=0;
 	FOREACH(const shared_ptr<Interaction>&i, *rb->transientInteractions){
 		if(!i->interactionPhysics) continue;
-		shared_ptr<BrefcomContact> bc=dynamic_pointer_cast<BrefcomContact>(i->interactionPhysics); if(!bc) continue;
-		shared_ptr<SpheresContactGeometry> geom=dynamic_pointer_cast<SpheresContactGeometry>(i->interactionGeometry); if(!bc){LOG_ERROR("Brefcom contact doesn't have SpheresContactGeomety associated?!"); continue;}
+		shared_ptr<NormalShearInteraction> bc=dynamic_pointer_cast<NormalShearInteraction>(i->interactionPhysics); if(!bc) continue;
+		shared_ptr<SpheresContactGeometry> geom=dynamic_pointer_cast<SpheresContactGeometry>(i->interactionGeometry); if(!bc){LOG_ERROR("NormalShearInteraction contact doesn't have SpheresContactGeomety associated?!"); continue;}
 		const shared_ptr<Body>& b1=Body::byId(i->getId1(),rb), b2=Body::byId(i->getId2(),rb);
 		bool isIn1=isInBB(b1->physicalParameters->se3.position,bbMin,bbMax), isIn2=isInBB(b2->physicalParameters->se3.position,bbMin,bbMax);
 		if(!isIn1 && !isIn2) continue;
@@ -89,9 +89,7 @@
 			//cerr<<"Interaction crosses AABB boundary, weight is "<<weight<<endl;
 			//LOG_DEBUG("Interaction crosses AABB boundary, weight is "<<weight);
 		} else {assert(isIn1 && isIn2); /* cerr<<"Interaction inside, weight is "<<weight<<endl;*/ /*LOG_DEBUG("Interaction inside, weight is "<<weight);*/}
-		E+=geom->d0*weight*(.5*bc->E*bc->crossSection*pow(geom->epsN(),2)+.5*bc->G*bc->crossSection*pow(geom->epsT().Length(),2));
-		//TRVAR5(bc->crossSection,bc->E,bc->G,bc->epsN,bc->epsT.Length());;
-		//cerr<<bc->crossSection<<","<<bc->E<<","<<bc->G<<","<<bc->epsN<<","<<bc->epsT.Length()<<endl;
+		E+=geom->d0*weight*(.5*bc->kn*pow(geom->epsN(),2)+.5*bc->ks*pow(geom->epsT().Length(),2));
 	}
 	return E;
 }
@@ -158,7 +156,52 @@
 {
 	return vec2tuple(Shop::inscribedCircleCenter(Vector3r(python::extract<double>(v0[0]),python::extract<double>(v0[1]),python::extract<double>(v0[2])), Vector3r(python::extract<double>(v1[0]),python::extract<double>(v1[1]),python::extract<double>(v1[2])), Vector3r(python::extract<double>(v2[0]),python::extract<double>(v2[1]),python::extract<double>(v2[2]))));
 }
+/* Sum moments acting on bodies within mask.
+ *
+ * @param mask is Body::groupMask that must match for a body to be taken in account.
+ * @param axis is the direction of axis with respect to which the moment is calculated.
+ * @param axisPt is a point on the axis.
+ *
+ * The computation is trivial: moment from force is is by definition r?F, where r
+ * is position relative to axisPt; moment from moment is m; such moment per body is
+ * projected onto axis.
+ */
+Real sumBexMoments(int mask, python::tuple _axis, python::tuple _axisPt){
+	Shop::Bex::initCache();
+	shared_ptr<MetaBody> rb=Omega::instance().getRootBody();
+	Real ret;
+	Vector3r axis=tuple2vec(_axis), axisPt=tuple2vec(_axisPt);
+	FOREACH(const shared_ptr<Body> b, *rb->bodies){
+		if(!b->maskOk(mask)) continue;
+		const Vector3r& m=Shop::Bex::momentum(b->getId(),rb.get());
+		const Vector3r& f=Shop::Bex::force(b->getId(),rb.get());
+		Vector3r r=b->physicalParameters->se3.position-axisPt;
+		ret+=axis.Dot(m+r.Cross(f));
+	}
+	return ret;
+}
+/* Sum forces actiong on bodies within mask.
+ *
+ * @param mask groupMask of matching bodies
+ * @param direction direction in which forces are summed
+ *
+ */
+Real sumBexForces(int mask, python::tuple _direction){
+	Shop::Bex::initCache();
+	shared_ptr<MetaBody> rb=Omega::instance().getRootBody();
+	Real ret;
+	Vector3r direction=tuple2vec(_direction);
+	FOREACH(const shared_ptr<Body> b, *rb->bodies){
+		if(!b->maskOk(mask)) continue;
+		const Vector3r& f=Shop::Bex::force(b->getId(),rb.get());
+		ret+=direction.Dot(f);
+	}
+	return ret;
+}
 
+// for now, don't return anything, since we would have to include the whole yadeControl.cpp because of pyInteraction
+void Shop__createExplicitInteraction(body_id_t id1, body_id_t id2){ (void) Shop::createExplicitInteraction(id1,id2);}
+
 BOOST_PYTHON_FUNCTION_OVERLOADS(unbalancedForce_overloads,Shop::unbalancedForce,0,1);
 
 BOOST_PYTHON_MODULE(_utils){
@@ -172,6 +215,9 @@
 	def("elasticEnergy",elasticEnergyInAABB);
 	def("inscribedCircleCenter",inscribedCircleCenter);
 	def("unbalancedForce",&Shop::unbalancedForce,unbalancedForce_overloads(args("useMaxForce")));
+	def("sumBexForces",sumBexForces);
+	def("sumBexMoments",sumBexMoments);
+	def("createInteraction",Shop__createExplicitInteraction);
 }
 
 

Modified: trunk/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.cpp	2008-10-07 06:19:24 UTC (rev 1537)
+++ trunk/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.cpp	2008-10-07 07:02:48 UTC (rev 1538)
@@ -12,7 +12,22 @@
 
 
 #include<yade/core/MetaBody.hpp>
+	
+/* Single dispatch for given pair of bodies, returning new interaction.
+ *
+ * The caller is responsible for inserting the interaction into some interaction container.
+ *
+ * The EngineUnit must not fail (return false).
+ */
 
+shared_ptr<Interaction> InteractionGeometryMetaEngine::explicitAction(const shared_ptr<Body>& b1, const shared_ptr<Body> b2){
+	assert(b1->interactingGeometry && b2->interactingGeometry);
+	shared_ptr<Interaction> i(new Interaction(b1->getId(),b2->getId()));
+	i->isReal=true;
+	bool op=operator()(b1->interactingGeometry,b2->interactingGeometry,b1->physicalParameters->se3,b2->physicalParameters->se3,i);
+	if(!op) throw runtime_error("InteractionGeometryMetaEngine::explicitAction could not dispatch for given types ("+b1->interactingGeometry->getClassName()+","+b2->interactingGeometry->getClassName()+") or the dispatchee returned false.");
+	return i;
+}
 
 void InteractionGeometryMetaEngine::action(MetaBody* ncb)
 {

Modified: trunk/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.hpp	2008-10-07 06:19:24 UTC (rev 1537)
+++ trunk/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.hpp	2008-10-07 07:02:48 UTC (rev 1538)
@@ -37,6 +37,7 @@
 {
 	public :
 		virtual void action(MetaBody*);
+		shared_ptr<Interaction> explicitAction(const shared_ptr<Body>& b1, const shared_ptr<Body> b2);
 
 	REGISTER_CLASS_NAME(InteractionGeometryMetaEngine);
 	REGISTER_BASE_CLASS_NAME(MetaEngine2D);

Modified: trunk/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine.cpp	2008-10-07 06:19:24 UTC (rev 1537)
+++ trunk/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine.cpp	2008-10-07 07:02:48 UTC (rev 1538)
@@ -10,6 +10,15 @@
 
 
 #include<yade/core/MetaBody.hpp>
+/* Single dispatch for given bodies pp's and interaction.
+ * 
+ * The interaction must be real (needed?).
+ */
+void InteractionPhysicsMetaEngine::explicitAction(shared_ptr<PhysicalParameters>& pp1, shared_ptr<PhysicalParameters>& pp2, shared_ptr<Interaction>& i){
+	// should we throw instead of asserting?
+	assert(i->isReal);
+	operator()(pp1,pp2,i);
+}
 
 
 void InteractionPhysicsMetaEngine::action(MetaBody* ncb)

Modified: trunk/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine.hpp	2008-10-07 06:19:24 UTC (rev 1537)
+++ trunk/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine.hpp	2008-10-07 07:02:48 UTC (rev 1538)
@@ -30,6 +30,7 @@
 {		
 	public :
 		virtual void action(MetaBody*);
+		void explicitAction(shared_ptr<PhysicalParameters>& pp1, shared_ptr<PhysicalParameters>& pp2, shared_ptr<Interaction>& i);
 
 	REGISTER_CLASS_NAME(InteractionPhysicsMetaEngine);
 	REGISTER_BASE_CLASS_NAME(MetaEngine2D);

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp	2008-10-07 06:19:24 UTC (rev 1537)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp	2008-10-07 07:02:48 UTC (rev 1538)
@@ -17,7 +17,34 @@
 #include<yade/pkg-common/Momentum.hpp>
 #include<yade/core/PhysicalAction.hpp>
 
+#include<yade/extra/Shop.hpp>
 
+ElasticContactLaw2::ElasticContactLaw2(){
+	Shop::Bex::initCache();
+	isCohesive=true;
+}
+
+ElasticContactLaw2::~ElasticContactLaw2(){}
+
+void ElasticContactLaw2::action(MetaBody* rb){
+	FOREACH(shared_ptr<Interaction> i, *rb->transientInteractions){
+		if(!i->isReal) continue;
+		shared_ptr<SpheresContactGeometry> contGeom=YADE_PTR_CAST<SpheresContactGeometry>(i->interactionGeometry);
+		shared_ptr<ElasticContactInteraction> contPhys=YADE_PTR_CAST<ElasticContactInteraction>(i->interactionPhysics);
+		assert(contGeom); assert(contPhys);
+		if(!contGeom->hasShear) throw runtime_error("SpheresContactGeometry::hasShear must be true for ElasticContactLaw2");
+		Real Fn=contPhys->kn*contGeom->displacementN(); // scalar normal force; displacementN()>=0 ? elongation of the contact
+		if(!isCohesive && contGeom->displacementN()>0){ cerr<<"deleting"<<endl; /* delete the interaction */ i->isReal=false; continue;}
+		contPhys->normalForce=Fn*contGeom->normal;
+		contGeom->slipToDisplacementTMax(max(0.,(-Fn*contPhys->tangensOfFrictionAngle)/contPhys->ks)); // limit shear displacement -- Coulomb criterion
+		contPhys->shearForce=contPhys->ks*contGeom->displacementT();
+		Vector3r force=contPhys->shearForce+contPhys->normalForce;
+		Shop::applyForceAtContactPoint(force,contGeom->contactPoint,i->getId1(),contGeom->pos1,i->getId2(),contGeom->pos2,rb);
+	}
+}
+
+
+
 ElasticContactLaw::ElasticContactLaw() : InteractionSolver() , actionForce(new Force) , actionMomentum(new Momentum)
 {
 	sdecGroupMask=1;

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.hpp	2008-10-07 06:19:24 UTC (rev 1537)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.hpp	2008-10-07 07:02:48 UTC (rev 1538)
@@ -17,6 +17,23 @@
 
 class PhysicalAction;
 
+class ElasticContactLaw2: public InteractionSolver{
+	public:
+	//! this should really be property of the interaction, but for simplicity keep it here now...
+	bool isCohesive;
+	ElasticContactLaw2();
+	virtual ~ElasticContactLaw2();
+	void action(MetaBody*);
+	void registerAttributes(){
+		InteractionSolver::registerAttributes();
+		REGISTER_ATTRIBUTE(isCohesive);
+	}
+	NEEDS_BEX("Force","Momentum");
+	REGISTER_CLASS_NAME(ElasticContactLaw2);
+	REGISTER_BASE_CLASS_NAME(InteractionSolver);
+};
+REGISTER_SERIALIZABLE(ElasticContactLaw2,false);
+
 class ElasticContactLaw : public InteractionSolver
 {
 /// Attributes

Added: trunk/scripts/chain-distant-interactions.py
===================================================================
--- trunk/scripts/chain-distant-interactions.py	2008-10-07 06:19:24 UTC (rev 1537)
+++ trunk/scripts/chain-distant-interactions.py	2008-10-07 07:02:48 UTC (rev 1538)
@@ -0,0 +1,28 @@
+#!/usr/local/bin/yade-trunk -x
+# -*- encoding=utf-8 -*-
+
+o=Omega()
+o.initializers=[
+	StandAloneEngine('PhysicalActionContainerInitializer'),
+	MetaEngine('BoundingVolumeMetaEngine',[EngineUnit('InteractingSphere2AABB'),EngineUnit('InteractingBox2AABB'),EngineUnit('MetaInteractingGeometry2AABB')])
+	]
+o.engines=[
+	StandAloneEngine('PhysicalActionContainerReseter'),
+	MetaEngine('BoundingVolumeMetaEngine',[EngineUnit('InteractingSphere2AABB'),EngineUnit('MetaInteractingGeometry2AABB')
+	]),
+	StandAloneEngine('PersistentSAPCollider',{'haveDistantTransient':True}),
+	MetaEngine('InteractionGeometryMetaEngine',[EngineUnit('InteractingSphere2InteractingSphere4SpheresContactGeometry',{'hasShear':True}),]),
+	MetaEngine('InteractionPhysicsMetaEngine',[EngineUnit('SimpleElasticRelationships')]),
+	StandAloneEngine('ElasticContactLaw2',{'isCohesive':True}),
+	DeusExMachina('GravityEngine',{'gravity':[0,0,-1e5]}),
+	DeusExMachina('NewtonsDampedLaw',{'damping':0.2})
+]
+from yade import utils
+for n in range(20):
+	o.bodies.append(utils.sphere([0,n,0],.5,dynamic=(n>0),color=[1-(n/20.),n/20.,0],young=30e9,poisson=.3,density=2400))
+	# looks for metaengine found in Omega() and uses those
+	if n>0: utils.createInteraction(n-1,n)
+
+
+o.dt=.04*utils.PWaveTimeStep()
+o.save('/tmp/a.xml.bz2')


Property changes on: trunk/scripts/chain-distant-interactions.py
___________________________________________________________________
Name: svn:executable
   + *


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at arcig.cz  Tue Oct  7 09:10:23 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 07 Oct 2008 09:10:23 +0200
Subject: [deprecated list] [Yade-dev] calling EngineUnit::go to create
	persistent	interaction?
In-Reply-To: <48EA510B.8070207@arcig.cz>
References: <48EA510B.8070207@arcig.cz>
Message-ID: <48EB0B5F.9030005@arcig.cz>


> Secondly, I would like to use dispatcher for this: take b1, b2 and say
> something like
> InteractionGeometryMetaEngine::oneAction(b1,b2,interaction) that would
> in turn call
> InteractionGeometryMetaEngine::operator()(b1->interactingGeometry ,
> b2->interactingGeometry, b1->physicalParameters->se3,
> b2->physicalParameters->se3, interaction); sounds OK to you, Janek?
>   
OK, implemented in 1538,
InteractionGeometryMetaEngine::explicitAction(...) and
InteractionPhysicsMetaEngine::explicitAction(...); see
Shop::createExplicitInteraction for the use and
scripts/chain-distant-interactions.py for a very simple example.

Vaclav


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Tue Oct  7 09:17:27 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Tue, 07 Oct 2008 09:17:27 +0200
Subject: [deprecated list] [Yade-dev] ContactLaw1
In-Reply-To: <20080927133734.6cb5f3a9@szpak>
References: <200809260802.m8Q82DfS028074@sheep.berlios.de>	<48DCB0B5.3090808@arcig.cz>
	<48DCB959.6040209@geo.hmg.inpg.fr>	<20080926141211.18247d5f@szpak>
	<48DE0B9C.1050009@arcig.cz> <20080927133734.6cb5f3a9@szpak>
Message-ID: <48EB0D07.7060809@arcig.cz>


>> If the constitutive law is simple as
>>
>> // loop over interactions etc
>> Fn=contactGeom->strainN()*crossSection*E;
>> Ft=contactGeom->strainT()*crossSection*G;
>> // apply forces here
>>
>> the code for computing strain being elsewhere, then that code is still
>> in one place (and can be fixed at one place) and the constitutive law is
>> not a mess of flags.
>>     

Hi there, I implemented ElasticContactLaw2 (for ilustration) that
behaves like ElasticContactLaw (except that all contact are cohesive
(don't break) and there is no moment rotation law) and uses new
SpheresContactGeometry code; the code is about 15 lines.

This is the way I imagine all constitutive laws should eventually look
like: relationship from relative displacements (computed in the contact
geometry class) to forces, nothing else.

Vaclav

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Thu Oct  9 14:22:34 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Thu, 9 Oct 2008 14:22:34 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1539 - in trunk: core
	gui/py	pkg/dem/DataClass/InteractionGeometry	pkg/dem/Engine/StandAloneEngine
	scripts
Message-ID: <200810091222.m99CMYmN019881@sheep.berlios.de>

Author: eudoxos
Date: 2008-10-09 14:22:33 +0200 (Thu, 09 Oct 2008)
New Revision: 1539

Modified:
   trunk/core/Omega.cpp
   trunk/core/Omega.hpp
   trunk/gui/py/utils.py
   trunk/gui/py/yadeControl.cpp
   trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.cpp
   trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp
   trunk/scripts/chain-distant-interactions.py
Log:
1. Add Omega().reload()
2. Create map<string,string> Omega::memSavedSimulations, where simulations are saved if they begin with special sequence ":memory:" and can be loaded again, within lifetime of Omega.
3. Add Omega().tmpLoad() and Omega().tmpSave() that use the above mentioned thing.
4. add utils.readParamsFromTable that reads any python variables from text file (useful for automatic parametric studies)
5. Add less expensive routine for sontact point relocation in SpheresContactGeometry



Modified: trunk/core/Omega.cpp
===================================================================
--- trunk/core/Omega.cpp	2008-10-07 07:02:48 UTC (rev 1538)
+++ trunk/core/Omega.cpp	2008-10-09 12:22:33 UTC (rev 1539)
@@ -68,6 +68,7 @@
 void Omega::init(){
 	simulationFileName="";
 	resetRootBody();
+	timeInit();
 }
 
 void Omega::timeInit(){
@@ -215,7 +216,6 @@
 void Omega::loadSimulationFromStream(std::istream& stream){
 	LOG_DEBUG("Loading simulation from stream.");
 	resetRootBody();
-	timeInit();
 	IOFormatManager::loadFromStream("XMLFormatManager",stream,"rootBody",rootBody);
 }
 void Omega::saveSimulationToStream(std::ostream& stream){
@@ -223,10 +223,10 @@
 	IOFormatManager::saveToStream("XMLFormatManager",stream,"rootBody",rootBody);
 }
 
-void Omega::loadSimulation()
-{
+void Omega::loadSimulation(){
+
 	if(Omega::instance().getSimulationFileName().size()==0) throw yadeBadFile("Simulation filename to load has zero length");
-	if(!filesystem::exists(simulationFileName)) throw yadeBadFile("Simulation file to load doesn't exist");
+	if(!filesystem::exists(simulationFileName) && !algorithm::starts_with(simulationFileName,":memory")) throw yadeBadFile("Simulation file to load doesn't exist");
 	
 	// FIXME: should stop running simulation!!
 	LOG_INFO("Loading file " + simulationFileName);
@@ -244,6 +244,12 @@
 			resetRootBody();
 			IOFormatManager::loadFromFile("BINFormatManager",simulationFileName,"rootBody",rootBody);
 		}
+		else if(algorithm::starts_with(simulationFileName,":memory:")){
+			if(memSavedSimulations.count(simulationFileName)==0) throw yadeBadFile(("Cannot load nonexistent memory-saved simulation "+simulationFileName).c_str());
+			resetRootBody();
+			istringstream iss(memSavedSimulations[simulationFileName]);
+			IOFormatManager::loadFromStream("XMLFormatManager",iss,"rootBody",rootBody);
+		}
 		else throw (yadeBadFile("Extension of file not recognized."));
 	}
 
@@ -269,6 +275,12 @@
 		FormatChecker::format=FormatChecker::BIN;
 		IOFormatManager::saveToFile("BINFormatManager",name,"rootBody",rootBody);
 	}
+	else if(algorithm::starts_with(name,":memory:")){
+		if(memSavedSimulations.count(simulationFileName)>0) LOG_INFO("Overwriting in-memory saved simulation "<<name);
+		ostringstream oss;
+		IOFormatManager::saveToStream("XMLFormatManager",oss,"rootBody",rootBody);
+		memSavedSimulations[name]=oss.str();
+	}
 	else {
 		throw(yadeBadFile(("Filename extension not recognized in `"+name+"'").c_str()));
 	}

Modified: trunk/core/Omega.hpp
===================================================================
--- trunk/core/Omega.hpp	2008-10-07 07:02:48 UTC (rev 1538)
+++ trunk/core/Omega.hpp	2008-10-09 12:22:33 UTC (rev 1539)
@@ -87,6 +87,8 @@
 		string				 simulationFileName;
 		void buildDynlibDatabase(const vector<string>& dynlibsList); // FIXME - maybe in ClassFactory ?
 
+		map<string,string> memSavedSimulations;
+
 	public :
 		shared_ptr<Preferences> preferences;
 		string 				 yadeConfigPath;	// FIXME - must be private and more clean

Modified: trunk/gui/py/utils.py
===================================================================
--- trunk/gui/py/utils.py	2008-10-07 07:02:48 UTC (rev 1538)
+++ trunk/gui/py/utils.py	2008-10-09 12:22:33 UTC (rev 1539)
@@ -17,6 +17,8 @@
 from yade._utils import *
 
 
+def typedEngine(name): return [e for e in Omega().engines if e.name==name][0]
+
 def sphere(center,radius,density=1,young=30e9,poisson=.3,frictionAngle=0.5236,dynamic=True,wire=False,color=[1,1,1],physParamsClass='BodyMacroParameters'):
 	"""Create default sphere, with given parameters. Physical properties such as mass and inertia are calculated automatically."""
 	s=Body()
@@ -216,3 +218,50 @@
 	mainloop.run()
 	pipeline.set_state(gst.STATE_NULL); pipeline.get_state()
 
+def readParamsFromTable(tableFile=None,tableLine=None,noTableOk=False,**kw):
+	"""
+	Read parameters from a file and assign them to __builtin__ variables.
+
+	tableFile is a text file (with one value per blank-separated columns)
+	tableLine is number of line where to get the values from
+
+		The format of the file is as follows (no comments, empty lines etc allowed?)
+		
+		name1 name2 ? # 0th line
+		val1  val2  ? # 1st line
+		val2  val2  ? # 2nd line
+		?
+
+	The name `description' is special and is assigned to Omega().tags['description']
+
+	assigns Omega().tags['params']="name1=val1,name2=val2,?"
+	
+	assigns Omega().tags['defaultParams']="unassignedName1=defaultValue1,?"
+
+	return value is the number of assigned parameters.
+	"""
+	o=Omega()
+	tagsParams=[]
+	import os, __builtin__
+	if not tableFile and not os.environ.has_key('PARAM_TABLE'):
+		if not noTableOk: raise EnvironmentError("PARAM_TABLE is not defined in the environment")
+	else:
+		if not tableFile: tableFile=os.environ['PARAM_TABLE']
+		if not tableLine: tableLine=int(os.environ['PARAM_LINE'])
+		ll=open(tableFile).readlines(); names=ll[0].split(); values=ll[tableLine].split()
+		assert(len(names)==len(values))
+		for i in range(len(names)):
+			if names[i]=='description': o.tags['description']=values[i]
+			else:
+				if names[i] not in kw.keys(): raise NameError("Parameter `%s' has no default value assigned"%names[i])
+				kw.pop(names[i])
+				eq="%s=%s"%(names[i],values[i])
+				exec('__builtin__.%s=%s'%(names[i],values[i])); tagsParams+=['%s=%s'%(names[i],values[i])]
+	defaults=[]
+	for k in kw.keys():
+		exec("__builtin__.%s=%s"%(k,kw[k]))
+		defaults+=["%s=%s"%(k,kw[k])]
+	o.tags['defaultParams']=",".join(defaults)
+	o.tags['params']=",".join(tagsParams)
+	return len(tagsParams)
+

Modified: trunk/gui/py/yadeControl.cpp
===================================================================
--- trunk/gui/py/yadeControl.cpp	2008-10-07 07:02:48 UTC (rev 1538)
+++ trunk/gui/py/yadeControl.cpp	2008-10-09 12:22:33 UTC (rev 1539)
@@ -424,7 +424,11 @@
 		OMEGA.createSimulationLoop();
 		LOG_DEBUG("LOAD!");
 	}
+	void reload(){	load(OMEGA.getSimulationFileName());}
+	void saveTmp(string mark){ save(":memory:"+mark);}
+	void loadTmp(string mark){ load(":memory:"+mark);}
 
+
 	void reset(){Py_BEGIN_ALLOW_THREADS; OMEGA.reset(); Py_END_ALLOW_THREADS; }
 
 	void save(std::string fileName){
@@ -520,7 +524,10 @@
 		.add_property("dt",&pyOmega::dt_get,&pyOmega::dt_set)
 		.add_property("usesTimeStepper",&pyOmega::usesTimeStepper_get,&pyOmega::usesTimeStepper_set)
 		.def("load",&pyOmega::load)
+		.def("reload",&pyOmega::reload)
 		.def("save",&pyOmega::save)
+		.def("loadTmp",&pyOmega::loadTmp)
+		.def("saveTmp",&pyOmega::saveTmp)
 		.def("saveSpheres",&pyOmega::saveSpheres)
 		.def("run",&pyOmega::run,omega_run_overloads())
 		.def("pause",&pyOmega::pause)

Modified: trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.cpp
===================================================================
--- trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.cpp	2008-10-07 07:02:48 UTC (rev 1538)
+++ trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.cpp	2008-10-09 12:22:33 UTC (rev 1539)
@@ -25,8 +25,15 @@
  */
 void SpheresContactGeometry::relocateContactPoints(){
 	assert(hasShear);
-	Vector3r p1=contPtInTgPlane1(), p2=contPtInTgPlane2();
-	Vector3r midPt=.5*(p1+p2);
+	relocateContactPoints(contPtInTgPlane1(),contPtInTgPlane2());
+}
+
+/* Like SpheresContactGeometry::relocateContactPoints(), but use already computed tangent plane points.
+ *
+ *
+ */
+void SpheresContactGeometry::relocateContactPoints(const Vector3r& p1, const Vector3r& p2){
+	Vector3r midPt=(d1/(d1+d2))*(p1+p2); // proportionally to radii, so that angle would be the same
 	if((p1.SquaredLength()>4*d1 || p2.SquaredLength()>4*d2) && midPt.SquaredLength()>.5*min(d1,d2)){
 		//cerr<<"RELOCATION with displacementT="<<displacementT(); // should be the same before and after relocation
 		setTgPlanePts(p1-midPt,p2-midPt);
@@ -34,6 +41,7 @@
 	}
 }
 
+
 /*! Perform slip of the projected contact points so that their distance becomes equal (or remains smaller) than the given one.
  * The slipped distance is returned.
  */

Modified: trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp
===================================================================
--- trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp	2008-10-07 07:02:48 UTC (rev 1538)
+++ trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp	2008-10-09 12:22:33 UTC (rev 1539)
@@ -22,7 +22,9 @@
  *
  * TODO: add torsion code, that will (if a flag is on) compute torsion angle on the contact axis.
  *
+ * TODO: add bending code, that will compute bending angle of the contact axis
  *
+ *
  */
 class SpheresContactGeometry: public InteractionGeometry{
 	public:
@@ -58,7 +60,17 @@
 
 		Real displacementN(){assert(hasShear); return (pos2-pos1).Length()-d0;}
 		Real epsN(){return displacementN()*(1./d0);}
-		Vector3r displacementT(){ assert(hasShear); return contPtInTgPlane2()-contPtInTgPlane1();}
+		Vector3r displacementT(){ assert(hasShear);
+			// enabling automatic relocation decreases overall simulation speed by about 3%
+			// perhaps: bool largeStrains ... ?
+			#if 0 
+				Vector3r p1=contPtInTgPlane1(), p2=contPtInTgPlane2();
+				relocateContactPoints(p1,p2);
+				return p2-p1; // shear before relocation, but that should be OK
+			#else
+				return contPtInTgPlane2()-contPtInTgPlane1();
+			#endif
+		}
 		Vector3r epsT(){return displacementT()*(1./d0);}
 	
 		Real slipToDisplacementTMax(Real displacementTMax);
@@ -66,6 +78,7 @@
 		Real slipToEpsTMax(Real epsTMax){ return (1/d0)*slipToDisplacementTMax(epsTMax*d0);}
 
 		void relocateContactPoints();
+		void relocateContactPoints(const Vector3r& tgPlanePt1, const Vector3r& tgPlanePt2);
 
 		SpheresContactGeometry():contactPoint(Vector3r::ZERO),radius1(0),radius2(0),hasShear(false),pos1(Vector3r::ZERO),pos2(Vector3r::ZERO){createIndex();}
 		virtual ~SpheresContactGeometry();

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp	2008-10-07 07:02:48 UTC (rev 1538)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp	2008-10-09 12:22:33 UTC (rev 1539)
@@ -36,6 +36,7 @@
 		Real Fn=contPhys->kn*contGeom->displacementN(); // scalar normal force; displacementN()>=0 ? elongation of the contact
 		if(!isCohesive && contGeom->displacementN()>0){ cerr<<"deleting"<<endl; /* delete the interaction */ i->isReal=false; continue;}
 		contPhys->normalForce=Fn*contGeom->normal;
+		//contGeom->relocateContactPoints();
 		contGeom->slipToDisplacementTMax(max(0.,(-Fn*contPhys->tangensOfFrictionAngle)/contPhys->ks)); // limit shear displacement -- Coulomb criterion
 		contPhys->shearForce=contPhys->ks*contGeom->displacementT();
 		Vector3r force=contPhys->shearForce+contPhys->normalForce;

Modified: trunk/scripts/chain-distant-interactions.py
===================================================================
--- trunk/scripts/chain-distant-interactions.py	2008-10-07 07:02:48 UTC (rev 1538)
+++ trunk/scripts/chain-distant-interactions.py	2008-10-09 12:22:33 UTC (rev 1539)
@@ -15,7 +15,7 @@
 	MetaEngine('InteractionPhysicsMetaEngine',[EngineUnit('SimpleElasticRelationships')]),
 	StandAloneEngine('ElasticContactLaw2',{'isCohesive':True}),
 	DeusExMachina('GravityEngine',{'gravity':[0,0,-1e5]}),
-	DeusExMachina('NewtonsDampedLaw',{'damping':0.2})
+	DeusExMachina('NewtonsDampedLaw',{'damping':0.1})
 ]
 from yade import utils
 for n in range(20):
@@ -25,4 +25,7 @@
 
 
 o.dt=.04*utils.PWaveTimeStep()
-o.save('/tmp/a.xml.bz2')
+#o.save('/tmp/a.xml.bz2')
+#o.reload()
+#o.run(50000,True)
+#print o.iter/o.realtime


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From bruno.chareyre at hmg.inpg.fr  Fri Oct 10 15:10:05 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Fri, 10 Oct 2008 15:10:05 +0200
Subject: [deprecated list] [Yade-dev] ContactLaw1
In-Reply-To: <48EB0D07.7060809@arcig.cz>
References: <200809260802.m8Q82DfS028074@sheep.berlios.de>	<48DCB0B5.3090808@arcig.cz>	<48DCB959.6040209@geo.hmg.inpg.fr>	<20080926141211.18247d5f@szpak>	<48DE0B9C.1050009@arcig.cz>
	<20080927133734.6cb5f3a9@szpak> <48EB0D07.7060809@arcig.cz>
Message-ID: <48EF542D.1050402@hmg.inpg.fr>

It sounds good to me, except for two ascpects :
- it will require different geometry classes for different constitutive 
laws, because if you don't have moment at contacts, you don't want a 
geometry class computing relative rotations (waste of time).
- less fundamentally : due to this change, old xml's can't be loaded in 
the new version (said Jerome Duriez).

Bruno



V?clav ?milauer a ?crit :
>>> If the constitutive law is simple as
>>>
>>> // loop over interactions etc
>>> Fn=contactGeom->strainN()*crossSection*E;
>>> Ft=contactGeom->strainT()*crossSection*G;
>>> // apply forces here
>>>
>>> the code for computing strain being elsewhere, then that code is still
>>> in one place (and can be fixed at one place) and the constitutive law is
>>> not a mess of flags.
>>>     
>>>       
>
> Hi there, I implemented ElasticContactLaw2 (for ilustration) that
> behaves like ElasticContactLaw (except that all contact are cohesive
> (don't break) and there is no moment rotation law) and uses new
> SpheresContactGeometry code; the code is about 15 lines.
>
> This is the way I imagine all constitutive laws should eventually look
> like: relationship from relative displacements (computed in the contact
> geometry class) to forces, nothing else.
>
> Vaclav
>
> _______________________________________________
> Mailing list: https://launchpad.net/~yade-dev
> Post to     : yade-dev at lists.launchpad.net
> Unsubscribe : https://launchpad.net/~yade-dev
> More help   : https://help.launchpad.net/ListHelp
>
>
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Grenoble INP
Laboratoire 3SR - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Fri Oct 10 22:15:03 2008
From: eudoxos at arcig.cz (=?windows-1252?Q?V=E1clav_=8Amilauer?=)
Date: Fri, 10 Oct 2008 22:15:03 +0200
Subject: [deprecated list] [Yade-dev] ContactLaw1
In-Reply-To: <48EF542D.1050402@hmg.inpg.fr>
References: <200809260802.m8Q82DfS028074@sheep.berlios.de>	<48DCB0B5.3090808@arcig.cz>	<48DCB959.6040209@geo.hmg.inpg.fr>	<20080926141211.18247d5f@szpak>	<48DE0B9C.1050009@arcig.cz>	<20080927133734.6cb5f3a9@szpak>
	<48EB0D07.7060809@arcig.cz> <48EF542D.1050402@hmg.inpg.fr>
Message-ID: <48EFB7C7.8030101@arcig.cz>


> It sounds good to me, except for two ascpects :
> - it will require different geometry classes for different
> constitutive laws, because if you don't have moment at contacts, you
> don't want a geometry class computing relative rotations (waste of time).
SpheresContactGeometry::hasShear determines whether shear parameters are
computed; otherwise, you have only the penalty of one if. i.e. almost 0.
We _could_make derived classes etc, but I think it would be too heavy
for this.
> - less fundamentally : due to this change, old xml's can't be loaded
> in the new version (said Jerome Duriez).
Yes, like always. I suggested to Jerome to use python as the portable
way of generating scenes ;-)

Vaclav

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Sat Oct 11 15:28:18 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Sat, 11 Oct 2008 15:28:18 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1541 - in trunk/gui: . py
Message-ID: <200810111328.m9BDSIPn025427@sheep.berlios.de>

Author: eudoxos
Date: 2008-10-11 15:28:17 +0200 (Sat, 11 Oct 2008)
New Revision: 1541

Added:
   trunk/gui/py/PythonTCPServer.py
Modified:
   trunk/gui/SConscript
   trunk/gui/py/PythonUI_rc.py
Log:
1. Yade now runs TCP server at the first free port above 9000 (accessible from localhost only), which simulates python console. (let me know if you need this over network -- it is DANGEROUS, since someone can delete all your files etc without any authentication). The interpreter has its own namespace.



Modified: trunk/gui/SConscript
===================================================================
--- trunk/gui/SConscript	2008-10-11 07:45:14 UTC (rev 1540)
+++ trunk/gui/SConscript	2008-10-11 13:28:17 UTC (rev 1541)
@@ -75,5 +75,6 @@
 		env.File('runtime.py','py'),
 		env.File('ipython.py','py'),
 		env.File('plot.py','py'),
+		env.File('PythonTCPServer.py','py'),
 	])
 

Added: trunk/gui/py/PythonTCPServer.py
===================================================================
--- trunk/gui/py/PythonTCPServer.py	2008-10-11 07:45:14 UTC (rev 1540)
+++ trunk/gui/py/PythonTCPServer.py	2008-10-11 13:28:17 UTC (rev 1541)
@@ -0,0 +1,75 @@
+import SocketServer
+import sys
+
+from yade.wrapper import *
+
+class PythonConsoleSocketEmulator(SocketServer.BaseRequestHandler):
+	def setup(self):
+		if not self.client_address[0].startswith('127.0.0'):
+			print "TCP Connection from non-127.0.0.* address %s rejected"%self.client_address[0]
+			return
+		print self.client_address, 'connected!'
+		self.request.send("""__   __    ____                 __  _____ ____ ____  
+\ \ / /_ _|  _ \  ___    ___   / / |_   _/ ___|  _ \ 
+ \ V / _` | | | |/ _ \  / _ \ / /    | || |   | |_) |
+  | | (_| | |_| |  __/ | (_) / /     | || |___|  __/ 
+  |_|\__,_|____/ \___|  \___/_/      |_| \____|_|    
+
+(connected from %s:%d)
+>>> """%(str(self.client_address[0]),self.client_address[1]))
+	def displayhook(self,s):
+		import pprint
+		self.request.send(pprint.pformat(s))
+	def handle(self):
+		import code,cStringIO,traceback
+		buf=[]
+		while True:
+			data = self.request.recv(1024).rstrip()
+			if data=='\x04' or data=='exit' or data=='quit': # \x04 == ^D 
+				return
+			buf.append(data)
+			orig_displayhook,orig_stdout=sys.displayhook,sys.stdout
+			sio=cStringIO.StringIO()
+			continuation=False
+			#print "buffer:",buf
+			try:
+				comp=code.compile_command('\n'.join(buf))
+				if comp:
+					sys.displayhook=self.displayhook
+					sys.stdout=sio
+					exec comp
+					self.request.send(sio.getvalue())
+					buf=[]
+				else:
+					self.request.send('... '); continuation=True
+			except:
+				self.request.send(traceback.format_exc())
+				buf=[]
+			finally:
+				sys.displayhook,sys.stdout=orig_displayhook,orig_stdout
+				if not continuation: self.request.send('\n>>> ')
+	def finish(self):
+		print self.client_address, 'disconnected!'
+		self.request.send('\nBye ' + str(self.client_address) + '\n')
+
+class PythonTCPServer:
+	def __init__(self,minPort=9000,host='',maxPort=65536,background=True):
+		import socket
+		self.port=-1
+		self.host=host
+		tryPort=minPort
+		if maxPort==None: maxPort=minPort
+		while self.port==-1 and tryPort<=maxPort:
+			try:
+				self.server=SocketServer.ThreadingTCPServer((host,tryPort),PythonConsoleSocketEmulator)
+				self.port=tryPort
+				print "Python TCP server listening on %s:%d"%(host if host else 'localhost',self.port)
+				if background:
+					import thread; thread.start_new_thread(self.server.serve_forever,())
+				else: self.server.serve_forever()
+			except socket.error:
+				tryPort+=1
+		if self.port==-1: raise RuntimeError("No free port to listen on in range %d-%d"%(minPort,maxPort))
+
+if __name__=='__main__':
+	PythonTCPServer(background=False)

Modified: trunk/gui/py/PythonUI_rc.py
===================================================================
--- trunk/gui/py/PythonUI_rc.py	2008-10-11 07:45:14 UTC (rev 1540)
+++ trunk/gui/py/PythonUI_rc.py	2008-10-11 13:28:17 UTC (rev 1541)
@@ -5,7 +5,7 @@
 
 from yade import runtime
 import sys
-sys.excepthook=sys.__excepthook__ # apport on ubuntu override this, we don't need it
+sys.excepthook=sys.__excepthook__ # apport on ubuntu overrides this, we don't need it
 # sys.path.insert(0,runtime.prefix+'/lib/yade'+runtime.suffix+'/extra')
 
 from yade.wrapper import *
@@ -20,6 +20,10 @@
 	def _quit(): import sys; sys.exit(0)
 	__builtins__.quit=_quit
 
+## run the TCP server
+import yade.PythonTCPServer
+yade.PythonTCPServer.PythonTCPServer(minPort=9000)
+
 ## run simulation if requested from the command line
 if runtime.simulation:
 	print "Running simulation "+runtime.simulation


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From cosurgi at mail.berlios.de  Sat Oct 11 16:23:54 2008
From: cosurgi at mail.berlios.de (cosurgi at BerliOS)
Date: Sat, 11 Oct 2008 16:23:54 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1542 - in trunk:
	gui/qt3/pictures	pkg/common/RenderingEngine/GLDrawGeometricalModel	pkg/common/RenderingEngine/GLDrawInteractingGeometry	pkg/dem/Engine/EngineUnit	pkg/dem/RenderingEngine/GLDrawCohesiveFrictionalContactInteraction
Message-ID: <200810111423.m9BENsvc032695@sheep.berlios.de>

Author: cosurgi
Date: 2008-10-11 16:23:53 +0200 (Sat, 11 Oct 2008)
New Revision: 1542

Added:
   trunk/gui/qt3/pictures/XYZ.png
   trunk/gui/qt3/pictures/YZX.png
   trunk/gui/qt3/pictures/ZXY.png
Modified:
   trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere.cpp
   trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere.hpp
   trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere.cpp
   trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere.hpp
   trunk/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2AABB.cpp
   trunk/pkg/dem/RenderingEngine/GLDrawCohesiveFrictionalContactInteraction/GLDrawCohesiveFrictionalContactInteraction.cpp
Log:
Fixed OpenGL problems with displaying spheres, which
 - never occurred on my desktop
 - I've seen them sometimes on other peoples computers, but never could reproduce them
 - but finally have appeared on my laptop.

Everyone: those static variables in GL*Sphere* classes have to be static, don't change that.

Vaclav - go ahead and uncomment back your code in there. I just commented it,
because I wasn't sure what was causing the bug. After it's fixed I'm sure it
wasn't your code, but some odd harware, graphics card stuff.

Small fixes in InteractingMyTetrahedron (btw, who broke that? it was working,
perhaps I should browse SVN history to find out ;)



Added: trunk/gui/qt3/pictures/XYZ.png
===================================================================
(Binary files differ)


Property changes on: trunk/gui/qt3/pictures/XYZ.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/gui/qt3/pictures/YZX.png
===================================================================
(Binary files differ)


Property changes on: trunk/gui/qt3/pictures/YZX.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/gui/qt3/pictures/ZXY.png
===================================================================
(Binary files differ)


Property changes on: trunk/gui/qt3/pictures/ZXY.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere.cpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere.cpp	2008-10-11 13:28:17 UTC (rev 1541)
+++ trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere.cpp	2008-10-11 14:23:53 UTC (rev 1542)
@@ -21,16 +21,23 @@
 //      glPopMatrix();
 //}
 
+int GLDrawSphere::glSphereList=-1;
+int GLDrawSphere::glWiredSphereList=-1;
+
+vector<Vector3r> GLDrawSphere::vertices;
+vector<Vector3r> GLDrawSphere::faces;
+bool GLDrawSphere::first = true;
+
 bool GLDrawSphere::glutUse=false;
 bool GLDrawSphere::glutNormalize=true;
 int  GLDrawSphere::glutSlices=12;
 int  GLDrawSphere::glutStacks=6;
 
-GLDrawSphere::GLDrawSphere() : first(true), glWiredSphereList(-1), glSphereList(-1){};
+GLDrawSphere::GLDrawSphere(){first=true;};
 
 void GLDrawSphere::go(const shared_ptr<GeometricalModel>& gm, const shared_ptr<PhysicalParameters>& ph,bool wire)
 {
-	if(glutUse){
+	/*if(glutUse){
 		Real r= (static_cast<Sphere*>(gm.get()))->radius;
 		glMaterialv(GL_FRONT, GL_AMBIENT_AND_DIFFUSE, Vector3f(gm->diffuseColor[0],gm->diffuseColor[1],gm->diffuseColor[2]));
 		glColor3v(gm->diffuseColor);
@@ -39,8 +46,9 @@
 			else glutSolidSphere(r,glutSlices,glutStacks);
 		if(glutNormalize) glPopAttrib();
 		return;
-	}
+	}*/
 
+	//first = true;
 	if (first)
 	{
 		Real X = 0.525731112119133606;

Modified: trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere.hpp	2008-10-11 13:28:17 UTC (rev 1541)
+++ trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere.hpp	2008-10-11 14:23:53 UTC (rev 1542)
@@ -14,11 +14,11 @@
 class GLDrawSphere : public GLDrawGeometricalModelFunctor
 {
 	private :
-		bool first;
-		vector<Vector3r> vertices;
-		vector<Vector3r> faces;
-		int glWiredSphereList;
-		int glSphereList;
+		static bool first;
+		static vector<Vector3r> vertices;
+		static vector<Vector3r> faces;
+		static int glWiredSphereList;
+		static int glSphereList;
 		void subdivideTriangle(Vector3r& v1,Vector3r& v2,Vector3r& v3, int depth);
 		void drawSphere(int depth);
 		void drawCircle(bool filled);
@@ -29,6 +29,9 @@
 	public :
 		GLDrawSphere();
 		virtual void go(const shared_ptr<GeometricalModel>&, const shared_ptr<PhysicalParameters>&,bool);
+/// Serialization
+	protected :
+		virtual void postProcessAttributes(bool deserializing){if(deserializing){first=true;};};
 		virtual void registerAttributes(){REGISTER_ATTRIBUTE(glutUse); REGISTER_ATTRIBUTE(glutNormalize); REGISTER_ATTRIBUTE(glutSlices); REGISTER_ATTRIBUTE(glutStacks); }
 		
 	RENDERS(Sphere);

Modified: trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere.cpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere.cpp	2008-10-11 13:28:17 UTC (rev 1541)
+++ trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere.cpp	2008-10-11 14:23:53 UTC (rev 1542)
@@ -17,10 +17,13 @@
 vector<Vector3r> GLDrawInteractingSphere::vertices;
 vector<Vector3r> GLDrawInteractingSphere::faces;
 
+bool GLDrawInteractingSphere::first = true;
 
+GLDrawInteractingSphere::GLDrawInteractingSphere(){first=true;};
+
 void GLDrawInteractingSphere::go(const shared_ptr<InteractingGeometry>& cm, const shared_ptr<PhysicalParameters>& ,bool)
 {
-	static bool first=true;
+	//first=true;
 	
 	if (first)
 	{
@@ -153,3 +156,4 @@
 }
 
 YADE_PLUGIN();
+

Modified: trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere.hpp	2008-10-11 13:28:17 UTC (rev 1541)
+++ trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere.hpp	2008-10-11 14:23:53 UTC (rev 1542)
@@ -14,6 +14,7 @@
 class GLDrawInteractingSphere : public GLDrawInteractingGeometryFunctor
 {	
 	private :
+		static bool first;
 		static vector<Vector3r> vertices;
 		static vector<Vector3r> faces;
 		static int glWiredSphereList;
@@ -22,7 +23,11 @@
 		void drawSphere(int depth);
 	
 	public :
+		GLDrawInteractingSphere();
 		virtual void go(const shared_ptr<InteractingGeometry>&, const shared_ptr<PhysicalParameters>&,bool);
+/// Serialization
+	protected :
+		virtual void postProcessAttributes(bool deserializing){if(deserializing){first=true;};};
 
 	RENDERS(InteractingSphere);
 	REGISTER_CLASS_NAME(GLDrawInteractingSphere);

Modified: trunk/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2AABB.cpp
===================================================================
--- trunk/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2AABB.cpp	2008-10-11 13:28:17 UTC (rev 1541)
+++ trunk/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2AABB.cpp	2008-10-11 14:23:53 UTC (rev 1542)
@@ -20,18 +20,18 @@
 	AABB* aabb = static_cast<AABB*>(bv.get());
 
 	// create a bounding volume from four spheres ( InteractingMyTetrahedron )
-	Vector3r min = Vector3r(0,0,0);
+	Vector3r min = Vector3r(1,1,1)*100000;
 	min = componentMinVector(min,se3.orientation*myTet->c1 - Vector3r(myTet->r1,myTet->r1,myTet->r1));
 	min = componentMinVector(min,se3.orientation*myTet->c2 - Vector3r(myTet->r2,myTet->r2,myTet->r2));
 	min = componentMinVector(min,se3.orientation*myTet->c3 - Vector3r(myTet->r3,myTet->r3,myTet->r3));
 	min = componentMinVector(min,se3.orientation*myTet->c4 - Vector3r(myTet->r4,myTet->r4,myTet->r4));
 	min += se3.position;
 
-	Vector3r max = Vector3r(0,0,0);
-	max = componentMaxVector(min,se3.orientation*myTet->c1 + Vector3r(myTet->r1,myTet->r1,myTet->r1));
-	max = componentMaxVector(min,se3.orientation*myTet->c2 + Vector3r(myTet->r2,myTet->r2,myTet->r2));
-	max = componentMaxVector(min,se3.orientation*myTet->c3 + Vector3r(myTet->r3,myTet->r3,myTet->r3));
-	max = componentMaxVector(min,se3.orientation*myTet->c4 + Vector3r(myTet->r4,myTet->r4,myTet->r4));
+	Vector3r max = Vector3r(1,1,1)*(-100000);
+	max = componentMaxVector(max,se3.orientation*myTet->c1 + Vector3r(myTet->r1,myTet->r1,myTet->r1));
+	max = componentMaxVector(max,se3.orientation*myTet->c2 + Vector3r(myTet->r2,myTet->r2,myTet->r2));
+	max = componentMaxVector(max,se3.orientation*myTet->c3 + Vector3r(myTet->r3,myTet->r3,myTet->r3));
+	max = componentMaxVector(max,se3.orientation*myTet->c4 + Vector3r(myTet->r4,myTet->r4,myTet->r4));
 	max += se3.position;
 
 	// AABB

Modified: trunk/pkg/dem/RenderingEngine/GLDrawCohesiveFrictionalContactInteraction/GLDrawCohesiveFrictionalContactInteraction.cpp
===================================================================
--- trunk/pkg/dem/RenderingEngine/GLDrawCohesiveFrictionalContactInteraction/GLDrawCohesiveFrictionalContactInteraction.cpp	2008-10-11 13:28:17 UTC (rev 1541)
+++ trunk/pkg/dem/RenderingEngine/GLDrawCohesiveFrictionalContactInteraction/GLDrawCohesiveFrictionalContactInteraction.cpp	2008-10-11 14:23:53 UTC (rev 1542)
@@ -74,6 +74,7 @@
 	const Real size,
 	const Vector3r color)
 {
+	glPushMatrix();
 	Vector3r axis;Real angle;
 	Quaternionr delta(q);
 	delta.ToAxisAngle(axis,angle);
@@ -84,6 +85,7 @@
 	Vector3r m(pos+ret*size);
 	drawArrow(pos, m ,color);
 	drawFlatText(m,txt);
+	glPopMatrix();
 	return ret;
 }
 
@@ -94,7 +96,7 @@
 		const shared_ptr<Body>& b2,
 		bool wireFrame)
 {
-//	if(!i->isReal) return;
+	if(!i->isReal) return;
 	isReal=i->isReal;
 
 	CohesiveFrictionalContactInteraction*    ph = static_cast<CohesiveFrictionalContactInteraction*>(ih.get());
@@ -162,8 +164,8 @@
 //	drawArrow(middle+M2*size, middle+(M2-M1)*size ,Vector3r(1.0,0.4,0.4));
 
 
-	drawArrow(middle, middle+ph->shearForce*size/4000.0 ,Vector3r(isReal?1:0.4,0,isReal?1:0.4));
-	drawFlatText(     middle+ph->shearForce*size/4000.0 ,std::string(" Fs"));
+	drawArrow(middle, middle+ph->shearForce*size/4000000.0 ,Vector3r(isReal?1:0.4,0,isReal?1:0.4));
+	drawFlatText(     middle+ph->shearForce*size/4000000.0 ,std::string(" Fs"));
 
 // draw normal
 	drawArrow(middle, middle+sc->normal*size*0.9 ,Vector3r(0,isReal?1:0.4,0));


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Sat Oct 11 22:08:02 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Sat, 11 Oct 2008 22:08:02 +0200
Subject: [deprecated list] [Yade-dev] r1542 static variables
In-Reply-To: <200810111423.m9BENsvc032695@sheep.berlios.de>
References: <200810111423.m9BENsvc032695@sheep.berlios.de>
Message-ID: <48F107A2.60904@arcig.cz>


> Fixed OpenGL problems with displaying spheres, which
>  - never occurred on my desktop
>  - I've seen them sometimes on other peoples computers, but never could reproduce them
>  - but finally have appeared on my laptop.
>
> Everyone: those static variables in GL*Sphere* classes have to be static, don't change that.
>   
It is you who changed that, in 1054:

svn blame
pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere.hpp                                    
<

[...]
   794    galizzi
   369    galizzi class GLDrawSphere : public GLDrawGeometricalModelFunctor
   369    galizzi {
   937    cosurgi       private :
  1054    cosurgi               bool first;
  1054    cosurgi               vector<Vector3r> vertices;
  1054    cosurgi               vector<Vector3r> faces;
  1054    cosurgi               int glWiredSphereList;
  1054    cosurgi               int glSphereList;
   937    cosurgi               void subdivideTriangle(Vector3r&
v1,Vector3r& v2,Vector3r& v3, int depth);
   937    cosurgi               void drawSphere(int depth);
  1287    cosurgi               void drawCircle(bool filled);
  1286    cosurgi               void clearGlMatrix();
  1404    eudoxos               static bool glutUse, glutNormalize;
  1404    eudoxos               static int glutSlices, glutStacks;
  1404    eudoxos
   937    cosurgi       public :
[...]


Oh, BTW for the TCP console, you connect to it by "telnet localhost
9001" and finish with ^D.

Vaclav

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Mon Oct 13 09:38:24 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Mon, 13 Oct 2008 09:38:24 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1543 - in trunk: extra gui/py
	gui/qt3	pkg/common/Engine/StandAloneEngine
	pkg/dem/Engine/DeusExMachina
Message-ID: <200810130738.m9D7cOIk003647@sheep.berlios.de>

Author: eudoxos
Date: 2008-10-13 09:38:23 +0200 (Mon, 13 Oct 2008)
New Revision: 1543

Modified:
   trunk/extra/Brefcom.cpp
   trunk/extra/Brefcom.hpp
   trunk/gui/py/PeriodicPythonRunner.hpp
   trunk/gui/qt3/QtGUI-python.cpp
   trunk/pkg/common/Engine/StandAloneEngine/PeriodicEngines.hpp
   trunk/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider.cpp
   trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp
Log:
1. Fix crasher (under special circumstances) in PersistentSAPCollider (deletion invalidating iterator)
2. PeriodicEngine now takes nDo and nDone attributes, limitng number of activations
3. Fix minor things is BrefcomDamageColorizer, add normalized damage to BrefcomPhysParams
4. Fix some indents in Triaxial


Modified: trunk/extra/Brefcom.cpp
===================================================================
--- trunk/extra/Brefcom.cpp	2008-10-11 14:23:53 UTC (rev 1542)
+++ trunk/extra/Brefcom.cpp	2008-10-13 07:38:23 UTC (rev 1543)
@@ -233,7 +233,7 @@
 void BrefcomDamageColorizer::action(MetaBody* rootBody){
 	vector<pair<short,Real> > bodyDamage; /* number of cohesive interactions per body; cummulative damage of interactions */
 	bodyDamage.resize(rootBody->bodies->size(),pair<short,Real>(0,0));
-	FOREACH(shared_ptr<Interaction> I, *rootBody->transientInteractions){
+	FOREACH(const shared_ptr<Interaction>& I, *rootBody->transientInteractions){
 		shared_ptr<BrefcomContact> BC=dynamic_pointer_cast<BrefcomContact>(I->interactionPhysics);
 		if(!BC || !BC->isCohesive) continue;
 		const body_id_t id1=I->getId1(), id2=I->getId2();
@@ -242,11 +242,14 @@
 		maxOmega=max(maxOmega,BC->omega);
 	}
 	FOREACH(shared_ptr<Body> B, *rootBody->bodies){
+		body_id_t id=B->getId();
 		// add damaged contacts that have already been deleted
-		unsigned numBrokenCohesive=YADE_PTR_CAST<BrefcomPhysParams>(B->physicalParameters)->numBrokenCohesive;
-		if(bodyDamage[B->getId()].first==0) {B->geometricalModel->diffuseColor=Vector3r(0.5,0.5,B->isDynamic?0:1); continue; }
-		Real normDmg=(bodyDamage[B->getId()].second+numBrokenCohesive)/(bodyDamage[B->getId()].first+numBrokenCohesive);
-		B->geometricalModel->diffuseColor=Vector3r(normDmg,1-normDmg,B->isDynamic?0:1);
+		shared_ptr<BrefcomPhysParams> bpp=YADE_PTR_CAST<BrefcomPhysParams>(B->physicalParameters);
+		//if(bodyDamage[B->getId()].first==0) {B->geometricalModel->diffuseColor=Vector3r(0.5,0.5,B->isDynamic?0:1); continue; }
+		int pastOrPresentContacts=bodyDamage[id].first+bpp->numBrokenCohesive;
+		if(pastOrPresentContacts>0) bpp->normDmg=(bodyDamage[id].second+bpp->numBrokenCohesive)/pastOrPresentContacts;
+		else bpp->normDmg=0;
+		B->geometricalModel->diffuseColor=Vector3r(bpp->normDmg,1-bpp->normDmg,B->isDynamic?0:1);
 	}
 }
 

Modified: trunk/extra/Brefcom.hpp
===================================================================
--- trunk/extra/Brefcom.hpp	2008-10-11 14:23:53 UTC (rev 1542)
+++ trunk/extra/Brefcom.hpp	2008-10-13 07:38:23 UTC (rev 1543)
@@ -137,8 +137,10 @@
 		int numBrokenCohesive;
 		//! number of contacts with this body
 		int numContacts;
-		BrefcomPhysParams(): epsVolumetric(0.), numBrokenCohesive(0), numContacts(0) {createIndex();};
-		virtual void registerAttributes(){BodyMacroParameters::registerAttributes(); REGISTER_ATTRIBUTE(epsVolumetric); REGISTER_ATTRIBUTE(numBrokenCohesive); REGISTER_ATTRIBUTE(numContacts); }
+		//! average damage including already deleted contacts
+		Real normDmg;
+		BrefcomPhysParams(): epsVolumetric(0.), numBrokenCohesive(0), numContacts(0), normDmg(0.) {createIndex();};
+		virtual void registerAttributes(){BodyMacroParameters::registerAttributes(); REGISTER_ATTRIBUTE(epsVolumetric); REGISTER_ATTRIBUTE(numBrokenCohesive); REGISTER_ATTRIBUTE(numContacts); REGISTER_ATTRIBUTE(normDmg); }
 		REGISTER_CLASS_NAME(BrefcomPhysParams);
 		REGISTER_BASE_CLASS_NAME(BodyMacroParameters);
 };

Modified: trunk/gui/py/PeriodicPythonRunner.hpp
===================================================================
--- trunk/gui/py/PeriodicPythonRunner.hpp	2008-10-11 14:23:53 UTC (rev 1542)
+++ trunk/gui/py/PeriodicPythonRunner.hpp	2008-10-13 07:38:23 UTC (rev 1543)
@@ -14,7 +14,7 @@
 		string command;
 	public :
 		PeriodicPythonRunner(): command("pass"){};
-		/* virtual bool isActivated: not overridden, PeriodicEngine handles that */
+		/* virtual bool isActivated: not overridden, StretchPeriodicEngine handles that */
 		virtual void action(MetaBody* b){
 			PyGILState_STATE gstate;
 				gstate = PyGILState_Ensure();

Modified: trunk/gui/qt3/QtGUI-python.cpp
===================================================================
--- trunk/gui/qt3/QtGUI-python.cpp	2008-10-11 14:23:53 UTC (rev 1542)
+++ trunk/gui/qt3/QtGUI-python.cpp	2008-10-13 07:38:23 UTC (rev 1543)
@@ -96,7 +96,9 @@
 	if(dispParamsNo>=0) { LOG_INFO("Loading view state from state #"<<dispParamsNo); glv->useDisplayParameters(dispParamsNo);}
 	glv->raise();
 	glv->startAnimation();
+	Py_BEGIN_ALLOW_THREADS;
 	while(glv->animationIsStarted()) { usleep(2000000); LOG_DEBUG("Last msg: "<<*player->messages.rbegin()); }
+	Py_END_ALLOW_THREADS;
 	python::list snaps; FOREACH(string s, glv->snapshots){snaps.append(s);}
 	return python::make_tuple(snapBase2+"-%.04d.png",snaps);
 }

Modified: trunk/pkg/common/Engine/StandAloneEngine/PeriodicEngines.hpp
===================================================================
--- trunk/pkg/common/Engine/StandAloneEngine/PeriodicEngines.hpp	2008-10-11 14:23:53 UTC (rev 1542)
+++ trunk/pkg/common/Engine/StandAloneEngine/PeriodicEngines.hpp	2008-10-13 07:38:23 UTC (rev 1543)
@@ -5,21 +5,26 @@
 #include<yade/core/StandAloneEngine.hpp>
 #include<yade/core/Omega.hpp>
 /* run an action with given fixed periodicity (real time, virtual time, iteration number), by setting any of 
- * those criteria to a number > 0. */
+ * those criteria to a number > 0.
+ *
+ * The number of times this engine is activated can be limited by setting nDo>0. In the contrary case, or if
+ * the number of activations was already reached, no action will be called even if any of active period has elapsed.
+ */
 class PeriodicEngine:  public StandAloneEngine {
 	protected:
 		static Real getClock(){ timeval tp; gettimeofday(&tp,NULL); return tp.tv_sec+tp.tv_usec/1e6; }
 	public:
-		Real virtPeriod, virtLast, realPeriod, realLast; long iterPeriod,iterLast;
-		PeriodicEngine(): virtPeriod(0),virtLast(0),realPeriod(0),realLast(0),iterPeriod(0),iterLast(0) { realLast=getClock(); }
+		Real virtPeriod, virtLast, realPeriod, realLast; long iterPeriod,iterLast,nDo,nDone;
+		PeriodicEngine(): virtPeriod(0),virtLast(0),realPeriod(0),realLast(0),iterPeriod(0),iterLast(0),nDo(-1),nDone(0) { realLast=getClock(); }
 		virtual bool isActivated(){
 			Real virtNow=Omega::instance().getSimulationTime();
 			Real realNow=getClock();
 			long iterNow=Omega::instance().getCurrentIteration();
-			if((virtPeriod>0 && virtNow-virtLast>=virtPeriod) ||
-				(realPeriod>0 && realNow-realLast>=realPeriod) ||
-				(iterPeriod>0 && iterNow-iterLast>=iterPeriod)){
-				realLast=realNow; virtLast=virtNow; iterLast=iterNow;
+			if((nDo<0 || nDone<nDo) &&
+				((virtPeriod>0 && virtNow-virtLast>=virtPeriod) ||
+				 (realPeriod>0 && realNow-realLast>=realPeriod) ||
+				 (iterPeriod>0 && iterNow-iterLast>=iterPeriod))){
+				realLast=realNow; virtLast=virtNow; iterLast=iterNow; nDone++;
 				return true;
 			}
 			return false;
@@ -33,12 +38,21 @@
 			REGISTER_ATTRIBUTE(virtLast);
 			REGISTER_ATTRIBUTE(realLast);
 			REGISTER_ATTRIBUTE(iterLast);
+			REGISTER_ATTRIBUTE(nDo);
+			REGISTER_ATTRIBUTE(nDone);
 		}
 	REGISTER_CLASS_NAME(PeriodicEngine);
 	REGISTER_BASE_CLASS_NAME(StandAloneEngine);
 };
 REGISTER_SERIALIZABLE(PeriodicEngine,false);
 
+#if 0
+class StridePeriodicEngine: public PeriodicEngine{
+	public:
+		StridePeriodicEngine(): stride, maxStride
+}
+#endif
+
 /* PeriodicEngine but with constraint that may be stretched by a given stretchFactor (default 2).
  * Limits for each periodicity criterion may be set and the mayStretch bool says whether the period
  * can be stretched (default: doubled) without active criteria getting off limits.
@@ -55,7 +69,7 @@
 	StretchPeriodicEngine(): PeriodicEngine(), realLim(0.), virtLim(0.), iterLim(0), stretchFactor(2.){}
 	Real realLim, virtLim; long iterLim;
 	Real stretchFactor;
-	int mayStretch;
+	bool mayStretch;
 	virtual bool isActivated(){
 		assert(stretchFactor>0);
 		if(iterLim==0 && iterPeriod!=0){iterLim=iterPeriod;} else if(iterLim!=0 && iterPeriod==0){iterPeriod=iterLim;}

Modified: trunk/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider.cpp
===================================================================
--- trunk/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider.cpp	2008-10-11 14:23:53 UTC (rev 1542)
+++ trunk/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider.cpp	2008-10-13 07:38:23 UTC (rev 1543)
@@ -71,10 +71,12 @@
 			maxima[offset+0]=pos[0]; maxima[offset+1]=pos[1]; maxima[offset+2]=pos[2];
 		}
 	}
+	typedef pair<body_id_t,body_id_t> bodyIdPair;
+	list<bodyIdPair> toBeDeleted;
 	FOREACH(const shared_ptr<Interaction>& I,*ncb->transientInteractions){
 		// remove interactions deleted by the constitutive law: thay are not new, but nor real either
 		// to make sure, do that only with haveDistantTransient
-		if(haveDistantTransient && !I->isNew && !I->isReal) { transientInteractions->erase(I->getId1(),I->getId2()); continue; }
+		if(haveDistantTransient && !I->isNew && !I->isReal) { toBeDeleted.push_back(bodyIdPair(I->getId1(),I->getId2())); continue; }
 		// Once the interaction has been fully created, it is not "new" anymore
 		if (I->isReal) I->isNew=false;
 		// OTOH if is is now real anymore, it falls back to the potential state
@@ -85,6 +87,7 @@
 		if(!haveDistantTransient) I->isReal=false;
 		//if(!I->isReal){LOG_DEBUG("Interaction #"<<I->getId1()<<"=#"<<I->getId2()<<" is not real.");}
 	}
+	FOREACH(const bodyIdPair& p, toBeDeleted){ transientInteractions->erase(p.first,p.second); }
 	
 	updateIds(bodies->size());
 	nbObjects=bodies->size();

Modified: trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp	2008-10-11 14:23:53 UTC (rev 1542)
+++ trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp	2008-10-13 07:38:23 UTC (rev 1543)
@@ -269,27 +269,21 @@
 	}
 		
 	InteractionContainer::iterator ii    = ncb->transientInteractions->begin();
-        InteractionContainer::iterator iiEnd = ncb->transientInteractions->end();
-        
-        for(  ; ii!=iiEnd ; ++ii ) 
-        {
-        	if ((*ii)->isReal)
-                {	
-                       	const shared_ptr<BodyMacroParameters>& sdec1 = YADE_PTR_CAST<BodyMacroParameters>((*bodies)[(body_id_t) ((*ii)->getId1())]->physicalParameters);
-			const shared_ptr<BodyMacroParameters>& sdec2 = YADE_PTR_CAST<BodyMacroParameters>((*bodies)[(body_id_t) ((*ii)->getId2())]->physicalParameters);
-						
-			//FIXME - why dynamic_cast fails here?
-			//const shared_ptr<ElasticContactInteraction>& contactPhysics = YADE_PTR_CAST<ElasticContactInteraction>((*ii)->interactionPhysics);
-			const shared_ptr<ElasticContactInteraction>& contactPhysics = static_pointer_cast<ElasticContactInteraction>((*ii)->interactionPhysics);
-			
-			Real fa 	= sdec1->frictionAngle;
-			Real fb 	= sdec2->frictionAngle;
+	InteractionContainer::iterator iiEnd = ncb->transientInteractions->end(); 
+	for(  ; ii!=iiEnd ; ++ii ) {
+		if (!(*ii)->isReal) continue;
+		const shared_ptr<BodyMacroParameters>& sdec1 = YADE_PTR_CAST<BodyMacroParameters>((*bodies)[(body_id_t) ((*ii)->getId1())]->physicalParameters);
+		const shared_ptr<BodyMacroParameters>& sdec2 = YADE_PTR_CAST<BodyMacroParameters>((*bodies)[(body_id_t) ((*ii)->getId2())]->physicalParameters);		
+		//FIXME - why dynamic_cast fails here?
+		//const shared_ptr<ElasticContactInteraction>& contactPhysics = YADE_PTR_CAST<ElasticContactInteraction>((*ii)->interactionPhysics);
+		const shared_ptr<ElasticContactInteraction>& contactPhysics = static_pointer_cast<ElasticContactInteraction>((*ii)->interactionPhysics);
 
-			contactPhysics->frictionAngle			= std::min(fa,fb);
-			contactPhysics->tangensOfFrictionAngle		= std::tan(contactPhysics->frictionAngle); 
-		}
-	}
+		Real fa 	= sdec1->frictionAngle;
+		Real fb 	= sdec2->frictionAngle;
 
+		contactPhysics->frictionAngle			= std::min(fa,fb);
+		contactPhysics->tangensOfFrictionAngle		= std::tan(contactPhysics->frictionAngle); 
+	}
 }
 
 


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Mon Oct 13 21:27:16 2008
From: eudoxos at arcig.cz (=?windows-1252?Q?V=E1clav_=8Amilauer?=)
Date: Mon, 13 Oct 2008 21:27:16 +0200
Subject: [deprecated list] [Yade-dev] Error during compiling
In-Reply-To: <48F387E4.2090409@geo.hmg.inpg.fr>
References: <48F387E4.2090409@geo.hmg.inpg.fr>
Message-ID: <48F3A114.40900@arcig.cz>


> ? scons: ***
> [/home/jf/YADE/build-svn1543jf/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.os]
> /home/jf/YADE/build-svn1543jf/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.os:
> Permission denied
> scons: ***
> [/home/jf/YADE/build-svn1543jf/pkg/dem/PreProcessor/TriaxialTest.os]
> /home/jf/YADE/build-svn1543jf/pkg/dem/PreProcessor/TriaxialTest.os:
> Permission denied
> scons: done building targets (errors occurred during build).
Didn't you run scons as root (sudo ...) previously? It would create
root-owned files that you are not allowed to overwrite (the plugins). If
that is the case, try running "sudo chown -r jf: /home/jf/YADE" to
change the owner to yourself. HTH, Vaclav


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Tue Oct 14 10:52:48 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Tue, 14 Oct 2008 10:52:48 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1544 - trunk/extra
Message-ID: <200810140852.m9E8qm9k022822@sheep.berlios.de>

Author: eudoxos
Date: 2008-10-14 10:52:46 +0200 (Tue, 14 Oct 2008)
New Revision: 1544

Modified:
   trunk/extra/Brefcom.cpp
Log:
Fix stupid sign mistake when applying contact force in brefcom.


Modified: trunk/extra/Brefcom.cpp
===================================================================
--- trunk/extra/Brefcom.cpp	2008-10-13 07:38:23 UTC (rev 1543)
+++ trunk/extra/Brefcom.cpp	2008-10-14 08:52:46 UTC (rev 1544)
@@ -128,7 +128,7 @@
 	Shop::Bex::force(id1,rootBody)+=force;
 	Shop::Bex::force(id2,rootBody)-=force;
 	Shop::Bex::momentum(id1,rootBody)+=(contGeom->contactPoint-contGeom->pos1).Cross(force);
-	Shop::Bex::momentum(id2,rootBody)-=(contGeom->contactPoint-contGeom->pos2).Cross(force);
+	Shop::Bex::momentum(id2,rootBody)+=(contGeom->contactPoint-contGeom->pos2).Cross(-force);
 }
 
 void BrefcomLaw::action(MetaBody* _rootBody){


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Tue Oct 14 11:48:01 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Tue, 14 Oct 2008 11:48:01 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1545 - trunk/gui/py
Message-ID: <200810140948.m9E9m1FV030739@sheep.berlios.de>

Author: eudoxos
Date: 2008-10-14 11:48:01 +0200 (Tue, 14 Oct 2008)
New Revision: 1545

Modified:
   trunk/gui/py/PythonTCPServer.py
   trunk/gui/py/PythonUI_rc.py
Log:
1. PythonTCPServer now generates random 6-letter cookie (password) at startup and authenticates all connections by that cookie.
It can be retrieved from yade.runtime.cookie



Modified: trunk/gui/py/PythonTCPServer.py
===================================================================
--- trunk/gui/py/PythonTCPServer.py	2008-10-14 08:52:46 UTC (rev 1544)
+++ trunk/gui/py/PythonTCPServer.py	2008-10-14 09:48:01 UTC (rev 1545)
@@ -1,5 +1,5 @@
 import SocketServer
-import sys
+import sys,time
 
 from yade.wrapper import *
 
@@ -9,7 +9,11 @@
 			print "TCP Connection from non-127.0.0.* address %s rejected"%self.client_address[0]
 			return
 		print self.client_address, 'connected!'
-		self.request.send("""__   __    ____                 __  _____ ____ ____  
+		self.request.send('Enter auth cookie: ')
+	def tryLogin(self):
+		if self.request.recv(1024).rstrip()==self.server.cookie:
+	  		self.server.authenticated+=[self.client_address]
+			self.request.send("""__   __    ____                 __  _____ ____ ____  
 \ \ / /_ _|  _ \  ___    ___   / / |_   _/ ___|  _ \ 
  \ V / _` | | | |/ _ \  / _ \ / /    | || |   | |_) |
   | | (_| | |_| |  __/ | (_) / /     | || |___|  __/ 
@@ -17,10 +21,15 @@
 
 (connected from %s:%d)
 >>> """%(str(self.client_address[0]),self.client_address[1]))
+  			return True
+		else:
+			print "invalid cookie"
+			return False
 	def displayhook(self,s):
 		import pprint
 		self.request.send(pprint.pformat(s))
 	def handle(self):
+		if self.client_address not in self.server.authenticated and not self.tryLogin(): return
 		import code,cStringIO,traceback
 		buf=[]
 		while True:
@@ -54,7 +63,7 @@
 
 class PythonTCPServer:
 	def __init__(self,minPort=9000,host='',maxPort=65536,background=True):
-		import socket
+		import socket, random
 		self.port=-1
 		self.host=host
 		tryPort=minPort
@@ -63,7 +72,9 @@
 			try:
 				self.server=SocketServer.ThreadingTCPServer((host,tryPort),PythonConsoleSocketEmulator)
 				self.port=tryPort
-				print "Python TCP server listening on %s:%d"%(host if host else 'localhost',self.port)
+				self.server.cookie=''.join([i for i in random.sample('yadesucks',6)])
+				print "Python TCP server listening on %s:%d, auth cookie is `%s'"%(host if host else 'localhost',self.port,self.server.cookie)
+				self.server.authenticated=[]
 				if background:
 					import thread; thread.start_new_thread(self.server.serve_forever,())
 				else: self.server.serve_forever()
@@ -72,4 +83,6 @@
 		if self.port==-1: raise RuntimeError("No free port to listen on in range %d-%d"%(minPort,maxPort))
 
 if __name__=='__main__':
-	PythonTCPServer(background=False)
+	p=PythonTCPServer(background=False)
+	#while True: time.sleep(2)
+

Modified: trunk/gui/py/PythonUI_rc.py
===================================================================
--- trunk/gui/py/PythonUI_rc.py	2008-10-14 08:52:46 UTC (rev 1544)
+++ trunk/gui/py/PythonUI_rc.py	2008-10-14 09:48:01 UTC (rev 1545)
@@ -22,7 +22,8 @@
 
 ## run the TCP server
 import yade.PythonTCPServer
-yade.PythonTCPServer.PythonTCPServer(minPort=9000)
+srv=yade.PythonTCPServer.PythonTCPServer(minPort=9000)
+yade.runtime.cookie=srv.server.cookie
 
 ## run simulation if requested from the command line
 if runtime.simulation:


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From jerier at geo.hmg.inpg.fr  Mon Oct 13 19:39:48 2008
From: jerier at geo.hmg.inpg.fr (Jean-Francois Jerier)
Date: Mon, 13 Oct 2008 19:39:48 +0200
Subject: [deprecated list] [Yade-dev] Error during compiling
Message-ID: <48F387E4.2090409@geo.hmg.inpg.fr>


Hi all,

I have updated YADE. I have built it by scons, it works. Then, when i 
modified by example TriaxialCompressionEngine.cpp and TriaxialTest.cpp 
files. After i build the project with KDE. I have this error

? scons: *** 
[/home/jf/YADE/build-svn1543jf/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.os] 
/home/jf/YADE/build-svn1543jf/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.os: 
Permission denied
scons: *** 
[/home/jf/YADE/build-svn1543jf/pkg/dem/PreProcessor/TriaxialTest.os] 
/home/jf/YADE/build-svn1543jf/pkg/dem/PreProcessor/TriaxialTest.os: 
Permission denied
scons: done building targets (errors occurred during build).

I think, it is a minor problem. But i don't manage to find a solution.

Thanks a lot for your reply.

JF

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From jerier at geo.hmg.inpg.fr  Tue Oct 14 15:10:37 2008
From: jerier at geo.hmg.inpg.fr (=?ISO-8859-1?Q?JERIER_Jean-Fran=E7ois?=)
Date: Tue, 14 Oct 2008 15:10:37 +0200
Subject: [deprecated list] [Yade-dev] Simulation with Python
Message-ID: <48F49A4D.1050704@geo.hmg.inpg.fr>


Hi Vaclav,

Thank you for your last request. I change the permission files with  
sudo chown -R name:  /u with u the folder which was destined to be 
linked had it's permissions changed.

My new question is about Python. I have a simulation which represents a 
fiber (red spheres) pull out in a matrix . I have the initial sphere 
packing (see attached file) with two types of spheres (fiber and matrix).
After our conversation, i am sure that it is easier to do this 
simulation with Python. But i need know how :

  * Allocate different contact laws between two types of spheres.
  * Move only few spheres.
  * etc...

I didn't find Python tutorial on the Yade's site. Moreover, i think the 
Python lines for YADE are not general, the user must know the specific 
syntax.
Please, can you help me to find good examples or this specific synthax 
to realize my modeling.

King regards
JF
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Picture1.gif
Type: image/gif
Size: 28885 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20081014/d06e4b26/attachment.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: jerier.vcf
Type: text/x-vcard
Size: 362 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20081014/d06e4b26/attachment.vcf>
-------------- next part --------------
_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at arcig.cz  Tue Oct 14 22:31:29 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 14 Oct 2008 22:31:29 +0200
Subject: [deprecated list] [Yade-dev] Simulation with Python
In-Reply-To: <48F49A4D.1050704@geo.hmg.inpg.fr>
References: <48F49A4D.1050704@geo.hmg.inpg.fr>
Message-ID: <48F501A1.6050409@arcig.cz>


>
> My new question is about Python. I have a simulation which represents
> a fiber (red spheres) pull out in a matrix . I have the initial sphere
> packing (see attached file) with two types of spheres (fiber and matrix).
> After our conversation, i am sure that it is easier to do this
> simulation with Python. But i need know how :
>
>  * Allocate different contact laws between two types of spheres.
>  * Move only few spheres.
>  * etc...
Hi, your question is rather about engines. You will probably have to use
groupMask magic to differentiate types of spheres and adjust the
constitutive law for that. Unfortunately there is no unification on this
(yet).

For moving the spheres that are being pulled out: create
TranslationEngine and subscribe only those red spheres, something like
this (let's suppose that they have groupMask==2, for example):

ids=[b.id for b in o.bodies if int(b['groupMask'] & 2)] # this will give
you the list of IDs of red spheres

then put something like this amongst your engines:

DeusExMachina('TranslationEngine',{'subscribedBodies':ids,'param1':value1,...})

OK, but maybe you want to move only a few spheres that are at the
beginning of the bar?

I am sorry to reply in such a brief manner, if you send me (here or
privately) the simulation setup (.xml or just sphere coordinates), I can
prepare for you abundantly commented script thursday.

HTH, Vaclav

>
> I didn't find Python tutorial on the Yade's site. Moreover, i think
> the Python lines for YADE are not general, the user must know the
> specific syntax.
> Please, can you help me to find good examples or this specific synthax
> to realize my modeling.
>
> King regards
> JF
> _______________________________________________
> Mailing list: https://launchpad.net/~yade-dev
> Post to     : yade-dev at lists.launchpad.net
> Unsubscribe : https://launchpad.net/~yade-dev
> More help   : https://help.launchpad.net/ListHelp
>   


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From jerier at geo.hmg.inpg.fr  Wed Oct 15 20:20:35 2008
From: jerier at geo.hmg.inpg.fr (jerier at geo.hmg.inpg.fr)
Date: Wed, 15 Oct 2008 14:20:35 -0400
Subject: [deprecated list] [Yade-dev] Simulation with Python
Message-ID: <380-2200810315182035610@M2W103.mail2web.com>



Hi Vaclav,

  Thank again for your request, you gave me all informations. I don't want
to disturb you, therefore for the moment i put on the back burner this
interesting simulation. When i will be a YADE master (soon), i will realize
it.

For the moment, i am concentrating on the compression simulation in a
cylindrical die. Concerning the last thing, please can you send me the file
in python that you have realized at AUSSOIS?

Moreover, i think this python's example will interest different peopole on
this mail list.


best regards
JF



Begin forwarded message:
Date: Tue, 14 Oct 2008 22:31:29 +0200
From: V?clav S(milauer <eudoxos at arcig.cz>
To: yade-dev at lists.launchpad.net
Subject: Re: [Yade-dev] Simulation with Python

>
> My new question is about Python. I have a simulation which represents
> a fiber (red spheres) pull out in a matrix . I have the initial sphere
> packing (see attached file) with two types of spheres (fiber and matrix).
> After our conversation, i am sure that it is easier to do this
> simulation with Python. But i need know how :
>
>  * Allocate different contact laws between two types of spheres.
>  * Move only few spheres.
>  * etc...
Hi, your question is rather about engines. You will probably have to use
groupMask magic to differentiate types of spheres and adjust the
constitutive law for that. Unfortunately there is no unification on this
(yet).

For moving the spheres that are being pulled out: create
TranslationEngine and subscribe only those red spheres, something like
this (let's suppose that they have groupMask==2, for example):

ids=[b.id for b in o.bodies if int(b['groupMask'] & 2)] # this will give
you the list of IDs of red spheres

then put something like this amongst your engines:

DeusExMachina('TranslationEngine',{'subscribedBodies':ids,'param1':value1,..
.})

OK, but maybe you want to move only a few spheres that are at the
beginning of the bar?

I am sorry to reply in such a brief manner, if you send me (here or
privately) the simulation setup (.xml or just sphere coordinates), I can
prepare for you abundantly commented script thursday.

HTH, Vaclav

>
> I didn't find Python tutorial on the Yade's site. Moreover, i think
> the Python lines for YADE are not general, the user must know the
> specific syntax.
> Please, can you help me to find good examples or this specific synthax
> to realize my modeling.
>
> King regards
> JF
> _______________________________________________
> Mailing list: https://launchpad.net/~yade-dev
> Post to     : yade-dev at lists.launchpad.net
> Unsubscribe : https://launchpad.net/~yade-dev
> More help   : https://help.launchpad.net/ListHelp
>   


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp
_______________________________________________
yade-dev mailing list
yade-dev at lists.berlios.de
https://lists.berlios.de/mailman/listinfo/yade-dev





--------------------------------------------------------------------
mail2web.com - Microsoft? Exchange solutions from a leading provider -
http://link.mail2web.com/Business/Exchange



_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Thu Oct 16 11:45:39 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Thu, 16 Oct 2008 11:45:39 +0200
Subject: [deprecated list] [Yade-dev] Simulation with Python
In-Reply-To: <380-2200810315182035610@M2W103.mail2web.com>
References: <380-2200810315182035610@M2W103.mail2web.com>
Message-ID: <48F70D43.8020701@arcig.cz>


> For the moment, i am concentrating on the compression simulation in a
> cylindrical die. Concerning the last thing, please can you send me the file
> in python that you have realized at AUSSOIS?
>
> Moreover, i think this python's example will interest different peopole on
> this mail list.
>   
I put the whole talk slides (with many hyperlinks added) to Publications
section on the wiki, 
http://images2.wikia.nocookie.net/yade/images//4/40/Yade-python-aussois-2008.pdf,
it references also the cylindrical packing. If you want to go direct,
http://yade.wikia.com/wiki/ScriptGenerateCylindricalPacking

Best regards, Vaclav


PS I have some more time since today, don't hesitate.

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Thu Oct 16 12:26:13 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Thu, 16 Oct 2008 12:26:13 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1546 - in trunk: extra gui/py
	gui/qt3	pkg/common/RenderingEngine/GLDrawGeometricalModel
Message-ID: <200810161026.m9GAQDCe021765@sheep.berlios.de>

Author: eudoxos
Date: 2008-10-16 12:26:12 +0200 (Thu, 16 Oct 2008)
New Revision: 1546

Modified:
   trunk/extra/Brefcom.cpp
   trunk/extra/Brefcom.hpp
   trunk/gui/py/yadeControl.cpp
   trunk/gui/qt3/YadeQtMainWindow.cpp
   trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawFacet.cpp
Log:
1. Add Body().mask in python
2. Add PhysicalParameters().pos and .ori instead of ugly pp['se3'][:3] and pp['se3'][3:]
3. Add dmgPlane plot in brefcom
4. Do not delete renderer if we close the last view (loses all renderer settings)


Modified: trunk/extra/Brefcom.cpp
===================================================================
--- trunk/extra/Brefcom.cpp	2008-10-14 09:48:01 UTC (rev 1545)
+++ trunk/extra/Brefcom.cpp	2008-10-16 10:26:12 UTC (rev 1546)
@@ -139,6 +139,11 @@
 		BC=YADE_PTR_CAST<BrefcomContact>(I->interactionPhysics);
 		contGeom=YADE_PTR_CAST<SpheresContactGeometry>(I->interactionGeometry);
 		assert(BC); assert(contGeom);
+		/* kept fully damaged contacts; note that normally the contact is deleted _after_ the BREFCOM_MATERIAL_MODEL,
+		 * i.e. if it is 1.0 here, omegaThreshold is >= 1.0 for sure.
+		 * &&'ing that just to make sure anyway ...
+		 */
+		if(BC->omega>=1.0 && BC->omegaThreshold>=1.0) continue;
 
 		// shorthands
 		Real& epsN(BC->epsN); Vector3r& epsT(BC->epsT); Real& kappaD(BC->kappaD); const Real& xiShear(BC->xiShear); const Real& E(BC->E); const Real& undamagedCohesion(BC->undamagedCohesion); const Real& tanFrictionAngle(BC->tanFrictionAngle); const Real& G(BC->G); const Real& crossSection(BC->crossSection); const Real& tau(BC->tau); const Real& expDmgRate(BC->expDmgRate); const Real& omegaThreshold(BC->omegaThreshold); const Real& transStrainCoeff(BC->transStrainCoeff); const Real& epsTrans(BC->epsTrans); const Real& epsCrackOnset(BC->epsCrackOnset);
@@ -188,6 +193,7 @@
 
 bool GLDrawBrefcomContact::contactLine=true;
 bool GLDrawBrefcomContact::dmgLabel=true;
+bool GLDrawBrefcomContact::dmgPlane=false;
 bool GLDrawBrefcomContact::epsNLabel=true;
 bool GLDrawBrefcomContact::epsT=false;
 bool GLDrawBrefcomContact::epsTAxes=false;
@@ -206,9 +212,29 @@
 		min(1.,max(0.,BC->epsTrans/BC->epsCrackOnset)),
 		min(1.,max(0.,abs(BC->epsTrans)/BC->epsCrackOnset-1)));
 
-	if(contactLine) GLUtils::GLDrawLine(b1->physicalParameters->dispSe3.position,b2->physicalParameters->dispSe3.position,lineColor);
+	if(contactLine) GLUtils::GLDrawLine(b1->physicalParameters->dispSe3.position,b2->physicalParameters->dispSe3.position,.5*lineColor);
 	if(dmgLabel){ GLUtils::GLDrawNum(BC->omega,0.5*(b1->physicalParameters->dispSe3.position+b2->physicalParameters->dispSe3.position),lineColor); }
 	else if(epsNLabel){ GLUtils::GLDrawNum(BC->epsN,0.5*(b1->physicalParameters->dispSe3.position+b2->physicalParameters->dispSe3.position),lineColor); }
+	if(BC->omega>0 && dmgPlane){
+		Real halfSize=sqrt(BC->omega)*.705*sqrt(BC->crossSection);
+		Vector3r midPt=.5*Vector3r(b1->physicalParameters->dispSe3.position+b2->physicalParameters->dispSe3.position);
+		glDisable(GL_CULL_FACE);
+		glPushMatrix();
+			glTranslatev(midPt);
+			Quaternionr q; q.Align(Vector3r::UNIT_Z,geom->normal);
+			Vector3r axis; Real angle; q.ToAxisAngle(axis,angle);
+			glRotatef(angle*Mathr::RAD_TO_DEG,axis[0],axis[1],axis[2]);
+			glBegin(GL_POLYGON);
+				glColor3v(lineColor); 
+				glVertex3d(halfSize,0.,0.);
+				glVertex3d(.5*halfSize,.866*halfSize,0.);
+				glVertex3d(-.5*halfSize,.866*halfSize,0.);
+				glVertex3d(-halfSize,0.,0.);
+				glVertex3d(-.5*halfSize,-.866*halfSize,0.);
+				glVertex3d(.5*halfSize,-.866*halfSize,0.);
+			glEnd();
+		glPopMatrix();
+	}
 
 	const Vector3r& cp=static_pointer_cast<SpheresContactGeometry>(i->interactionGeometry)->contactPoint;
 	if(epsT){

Modified: trunk/extra/Brefcom.hpp
===================================================================
--- trunk/extra/Brefcom.hpp	2008-10-14 09:48:01 UTC (rev 1545)
+++ trunk/extra/Brefcom.hpp	2008-10-16 10:26:12 UTC (rev 1546)
@@ -233,12 +233,12 @@
 class GLDrawBrefcomContact: public GLDrawInteractionPhysicsFunctor {
 	public: virtual void go(const shared_ptr<InteractionPhysics>&,const shared_ptr<Interaction>&,const shared_ptr<Body>&,const shared_ptr<Body>&,bool wireFrame);
 	virtual ~GLDrawBrefcomContact() {};
-	virtual void registerAttributes(){ REGISTER_ATTRIBUTE(contactLine); REGISTER_ATTRIBUTE(dmgLabel); REGISTER_ATTRIBUTE(epsT); REGISTER_ATTRIBUTE(epsTAxes); REGISTER_ATTRIBUTE(normal); REGISTER_ATTRIBUTE(colorStrain); REGISTER_ATTRIBUTE(epsNLabel);}
+	virtual void registerAttributes(){ REGISTER_ATTRIBUTE(contactLine); REGISTER_ATTRIBUTE(dmgLabel); REGISTER_ATTRIBUTE(dmgPlane); REGISTER_ATTRIBUTE(epsT); REGISTER_ATTRIBUTE(epsTAxes); REGISTER_ATTRIBUTE(normal); REGISTER_ATTRIBUTE(colorStrain); REGISTER_ATTRIBUTE(epsNLabel);}
 	RENDERS(BrefcomContact);
 	REGISTER_CLASS_NAME(GLDrawBrefcomContact);
 	REGISTER_BASE_CLASS_NAME(GLDrawInteractionPhysicsFunctor);
 	DECLARE_LOGGER;
-	static bool contactLine,dmgLabel,epsT,epsTAxes,normal,colorStrain,epsNLabel;
+	static bool contactLine,dmgLabel,dmgPlane,epsT,epsTAxes,normal,colorStrain,epsNLabel;
 };
 REGISTER_SERIALIZABLE(GLDrawBrefcomContact,false);
 

Modified: trunk/gui/py/yadeControl.cpp
===================================================================
--- trunk/gui/py/yadeControl.cpp	2008-10-14 09:48:01 UTC (rev 1545)
+++ trunk/gui/py/yadeControl.cpp	2008-10-16 10:26:12 UTC (rev 1546)
@@ -150,6 +150,10 @@
 			throw std::invalid_argument("Invalid  DOF specification `"+s+"', must be ?{x,y,z,rx,ry,rz}.");
 		}
 	}
+	python::tuple pos_get(){const Vector3r& p=proxee->se3.position; return python::make_tuple(p[0],p[1],p[2]);}
+	python::tuple ori_get(){Vector3r axis; Real angle; proxee->se3.orientation.ToAxisAngle(axis,angle); return python::make_tuple(axis[0],axis[1],axis[2],angle);}
+	void pos_set(python::list l){if(python::len(l)!=3) throw invalid_argument("Wrong number of vector3 elements "+lexical_cast<string>(python::len(l))+", should be 3"); proxee->se3.position=Vector3r(python::extract<double>(l[0])(),python::extract<double>(l[1])(),python::extract<double>(l[2])());}
+	void ori_set(python::list l){if(python::len(l)!=4) throw invalid_argument("Wrong number of quaternion elements "+lexical_cast<string>(python::len(l))+", should be 4"); proxee->se3.orientation=Quaternionr(Vector3r(python::extract<double>(l[0])(),python::extract<double>(l[1])(),python::extract<double>(l[2])()),python::extract<double>(l[3])());}
 BASIC_PY_PROXY_TAIL;
 
 BASIC_PY_PROXY(pyBoundingVolume,BoundingVolume);
@@ -271,6 +275,8 @@
 	NONPOD_ATTRIBUTE_ACCESS(bound,pyBoundingVolume,boundingVolume);
 	NONPOD_ATTRIBUTE_ACCESS(phys,pyPhysicalParameters,physicalParameters);
 	unsigned id_get(){ensureAcc(); return proxee->getId();}
+	int mask_get(){ensureAcc(); return proxee->groupMask;}
+	void mask_set(int m){ensureAcc(); proxee->groupMask=m;}
 	bool isStandalone(){ensureAcc(); return proxee->isStandalone();} bool isClumpMember(){ensureAcc(); return proxee->isClumpMember();} bool isClump(){ensureAcc(); return proxee->isClump();}
 BASIC_PY_PROXY_TAIL;
 
@@ -585,7 +591,10 @@
 	BASIC_PY_PROXY_WRAPPER(pyGeometricalModel,"GeometricalModel");
 	BASIC_PY_PROXY_WRAPPER(pyInteractingGeometry,"InteractingGeometry");
 	BASIC_PY_PROXY_WRAPPER(pyPhysicalParameters,"PhysicalParameters")	
-		.add_property("blockedDOFs",&pyPhysicalParameters::blockedDOFs_get,&pyPhysicalParameters::blockedDOFs_set);
+		.add_property("blockedDOFs",&pyPhysicalParameters::blockedDOFs_get,&pyPhysicalParameters::blockedDOFs_set)
+		.add_property("pos",&pyPhysicalParameters::pos_get,&pyPhysicalParameters::pos_set)
+		.add_property("ori",&pyPhysicalParameters::ori_get,&pyPhysicalParameters::ori_set)
+		;
 	BASIC_PY_PROXY_WRAPPER(pyBoundingVolume,"BoundingVolume");
 	BASIC_PY_PROXY_WRAPPER(pyInteractionGeometry,"InteractionGeometry");
 	BASIC_PY_PROXY_WRAPPER(pyInteractionPhysics,"InteractionPhysics");
@@ -598,6 +607,7 @@
 		.add_property("bound",&pyBody::bound_get,&pyBody::bound_set)
 		.add_property("phys",&pyBody::phys_get,&pyBody::phys_set)
 		.add_property("id",&pyBody::id_get)
+		.add_property("mask",&pyBody::mask_get,&pyBody::mask_set)
 		.add_property("isStandalone",&pyBody::isStandalone)
 		.add_property("isClumpMember",&pyBody::isClumpMember)
 		.add_property("isClump",&pyBody::isClump);

Modified: trunk/gui/qt3/YadeQtMainWindow.cpp
===================================================================
--- trunk/gui/qt3/YadeQtMainWindow.cpp	2008-10-14 09:48:01 UTC (rev 1545)
+++ trunk/gui/qt3/YadeQtMainWindow.cpp	2008-10-16 10:26:12 UTC (rev 1546)
@@ -93,7 +93,7 @@
 
 void YadeQtMainWindow::redrawAll(bool force){
 	// controller has its own timer -- and will update instead of us periodically
-	if(renderer && (force /* || (controller  && !controller->syncRunning ) */ || (!controller))){
+	if((renderer && glViews.size()>0) && (force /* || (controller  && !controller->syncRunning ) */ || (!controller))){
 		FOREACH(const shared_ptr<GLViewer>& glv,glViews){ if(glv) glv->updateGL(); }
 	}
 }
@@ -205,7 +205,8 @@
 				if(noOtherViews){
 					LOG_DEBUG("Deleting primary view (no other views exist).");
 					glViews.clear();
-					renderer=shared_ptr<OpenGLRenderingEngine>();
+					// why delete renderer if we close view? That obliterates all renderer settings.
+					// renderer=shared_ptr<OpenGLRenderingEngine>();
 				}else{LOG_INFO("Cannot close primary view, other views still exist.");}
 				return;
 			}

Modified: trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawFacet.cpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawFacet.cpp	2008-10-14 09:48:01 UTC (rev 1545)
+++ trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawFacet.cpp	2008-10-16 10:26:12 UTC (rev 1546)
@@ -29,7 +29,7 @@
     }
     else
     {
-		//glDisable(GL_CULL_FACE);
+		glDisable(GL_CULL_FACE);
 		//glPolygonMode(GL_FRONT_AND_BACK, GL_FILL); 
 		//glBegin(GL_TRIANGLES);
 		glEnable(GL_LIGHTING);


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at arcig.cz  Sun Oct 19 00:11:00 2008
From: eudoxos at arcig.cz (eudoxos at arcig.cz)
Date: Sun, 19 Oct 2008 00:11:00 +0200 (CEST)
Subject: [deprecated list] [Yade-dev] Automated crash report
	for	/tmp/yade-22719/bin/yade-svn1548:	DirectShearCis, FEMBeam,
	HydraulicTest, SDECImpactTest, STLImporterTest, SimpleShear, USCTGen
Message-ID: <20081018221100.ECD0298086@delta>

################################################################################
DirectShearCis: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `syauck'
Running script /tmp/yade-test-26013.py
Cannot find input file
Traceback (most recent call last):
  File "/tmp/yade-22719/lib/yade-svn1548/gui/PythonUI_rc.py", line 37, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-26013.py", line 3, in <module>
    Preprocessor('DirectShearCis').generate('/tmp/yade-test-26013.xml')
RuntimeError: Generator reported error: Cannot find input file

################################################################################
FEMBeam: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `ekdcss'
Running script /tmp/yade-test-26013.py
/tmp/yade-22719/build-svn1548/include/yade-svn1548/yade/core/MetaEngine1D.hpp:57 WARNING! dynamic cast of engine unit FEMTetrahedronStiffness failed, will use static_cast. Go figure why.
/tmp/yade-22719/build-svn1548/include/yade-svn1548/yade/core/MetaEngine2D.hpp:61 WARNING! dynamic cast of engine unit FEMSet2Tetrahedrons failed, will use static_cast. Go figure why.
Traceback (most recent call last):
  File "/tmp/yade-22719/lib/yade-svn1548/gui/PythonUI_rc.py", line 37, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-26013.py", line 3, in <module>
    Preprocessor('FEMBeam').generate('/tmp/yade-test-26013.xml')
RuntimeError: Generator reported error: Cannot find input file, you can copy it from examples/ directory

################################################################################
HydraulicTest: generator CRASH
################################################################################
Traceback (most recent call last):
  File "/tmp/yade-22719/lib/yade-svn1548/gui/PythonUI_rc.py", line 37, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-26013.py", line 3, in <module>
    Preprocessor('HydraulicTest').generate('/tmp/yade-test-26013.xml')
RuntimeError: Generator reported error: Error: cannot load the file that should contain spheres
Python TCP server listening on localhost:9001, auth cookie is `udecky'
Running script /tmp/yade-test-26013.py

################################################################################
SDECImpactTest: generator CRASH
################################################################################
Traceback (most recent call last):
  File "/tmp/yade-22719/lib/yade-svn1548/gui/PythonUI_rc.py", line 37, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-26013.py", line 3, in <module>
    Preprocessor('SDECImpactTest').generate('/tmp/yade-test-26013.xml')
RuntimeError: Generator reported error: Cannot find input file, you can copy it from examples/ directory
Python TCP server listening on localhost:9001, auth cookie is `esycds'
Running script /tmp/yade-test-26013.py

################################################################################
STLImporterTest: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `skseau'
Running script /tmp/yade-test-26013.py
Import walls geometry from file: hourglass.stl
705 [140351562319664] ERROR yade.STLImporter  - lib/import/STLImporter.cpp:27 open: Can't open file: hourglass.stl
ERROR: Bad file: hourglass.stl
Traceback (most recent call last):
  File "/tmp/yade-22719/lib/yade-svn1548/gui/PythonUI_rc.py", line 37, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-26013.py", line 3, in <module>
    Preprocessor('STLImporterTest').generate('/tmp/yade-test-26013.xml')
RuntimeError: Generator reported error: Input file not found, you can copy it from examples/ directory or make one using blender 3D modelling

################################################################################
SimpleShear: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `uedysa'
Running script /tmp/yade-test-26013.py
Cannot find input file
Traceback (most recent call last):
  File "/tmp/yade-22719/lib/yade-svn1548/gui/PythonUI_rc.py", line 37, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-26013.py", line 3, in <module>
    Preprocessor('SimpleShear').generate('/tmp/yade-test-26013.xml')
RuntimeError: Generator reported error: Cannot find input file

################################################################################
USCTGen: simulation CRASH
################################################################################
yade-svn1548: extra/Brefcom.cpp:155: virtual void BrefcomLaw::action(MetaBody*): Assertion `contGeom->hasShear' failed.
Python TCP server listening on localhost:9001, auth cookie is `deckua'
Running script /tmp/yade-test-26013.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1548/gdb_crash_batch-pid26200'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0x7fb8b303e730 (LWP 26200)]
[New Thread 0x409ef950 (LWP 26202)]
[New Thread 0x4186b950 (LWP 26201)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 0000000000000120
0x00007fb8b28e3e81 in nanosleep () from /lib/libpthread.so.0
No symbol "info" in current context.

Thread 3 (Thread 0x4186b950 (LWP 26201)):
#0  0x00007fb8b28e37fb in accept () from /lib/libpthread.so.0
#1  0x00007fb884567947 in ?? () from /usr/lib/python2.5/lib-dynload/_socket.so
#2  0x00007fb8b2ba9b57 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#3  0x00007fb8b2baa893 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#4  0x00007fb8b2baa893 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#5  0x00007fb8b2baa893 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#6  0x00007fb8b2baba86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#7  0x00007fb8b2b4b70a in ?? () from /usr/lib/libpython2.5.so.1.0
#8  0x00007fb8b2b29f23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#9  0x00007fb8b2b3165f in ?? () from /usr/lib/libpython2.5.so.1.0
#10 0x00007fb8b2b29f23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007fb8b2ba4a1e in PyEval_CallObjectWithKeywords () from /usr/lib/libpython2.5.so.1.0
#12 0x00007fb8b2bd9eed in ?? () from /usr/lib/libpython2.5.so.1.0
#13 0x00007fb8b28dc3f7 in start_thread () from /lib/libpthread.so.0
#14 0x00007fb8aed10b3d in clone () from /lib/libc.so.6
#15 0x0000000000000000 in ?? ()

Thread 2 (Thread 0x409ef950 (LWP 26202)):
#0  0x00007fb8aecd64df in waitpid () from /lib/libc.so.6
#1  0x00007fb8aec77461 in ?? () from /lib/libc.so.6
#2  0x00007fb8aec777e7 in system () from /lib/libc.so.6
#3  0x000000000058efcd in sigHandler (sig=6) at core/yade.cpp:60
#4  <signal handler called>
#5  0x00007fb8aec6b095 in raise () from /lib/libc.so.6
#6  0x00007fb8aec6caf0 in abort () from /lib/libc.so.6
#7  0x00007fb8aec642df in __assert_fail () from /lib/libc.so.6
#8  0x00007fb8a14ecc42 in BrefcomLaw::action (this=0xad1520, _rootBody=0x916e60) at extra/Brefcom.cpp:155
#9  0x000000000052d84f in MetaBody::moveToNextTimeStep (this=0x916e60) at core/MetaBody.cpp:95
#10 0x0000000000585f1b in SimulationFlow::singleAction (this=0x838c10) at core/SimulationFlow.cpp:18
#11 0x0000000000587e6f in ThreadWorker::callSingleAction (this=0x838c10) at core/ThreadWorker.cpp:71
#12 0x0000000000587662 in ThreadRunner::call (this=0xad2c20) at core/ThreadRunner.cpp:44
#13 0x00000000005876c8 in ThreadRunner::run (this=0xad2c20) at core/ThreadRunner.cpp:23
#14 0x0000000000587b40 in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x409ef0c8, p=0xad2c20) at /usr/include/boost/bind/mem_fn_template.hpp:49
#15 0x0000000000587bad in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x409ef0d8, f=@0x409ef0c8, a=@0x409ef02f) at /usr/include/boost/bind.hpp:231
#16 0x0000000000587bea in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x409ef0c8) at /usr/include/boost/bind/bind_template.hpp:20
#17 0x0000000000587c09 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x409ef0c8) at /usr/include/boost/function/function_template.hpp:155
#18 0x00007fb8b227d537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#19 0x00007fb8b227d1a2 in ?? () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#20 0x00007fb8b28dc3f7 in start_thread () from /lib/libpthread.so.0
#21 0x00007fb8aed10b3d in clone () from /lib/libc.so.6
#22 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7fb8b303e730 (LWP 26200)):
#0  0x00007fb8b28e3e81 in nanosleep () from /lib/libpthread.so.0
#1  0x00007fb884d52477 in pyOmega::wait (this=0xac0f40) at gui/py/yadeControl.cpp:424
#2  0x00007fb884c4c469 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0xa71d88, tc=@0x7fffbb07dfe0) at /usr/include/boost/python/detail/invoke.hpp:94
#3  0x00007fb884ced62e in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0xa71d88, args_=0xafc990) at /usr/include/boost/python/detail/caller.hpp:199
#4  0x00007fb884ced681 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0xa71d80, args=0xafc990, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#5  0x00007fb8b05faabe in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#6  0x00007fb8b05fade8 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#7  0x00007fb8b227d537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#8  0x00007fb8b06029f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#9  0x00007fb8b05f8127 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#10 0x00007fb8b2b29f23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007fb8b2ba7bb0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#12 0x00007fb8b2baba86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#13 0x00007fb8b2babba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#14 0x00007fb8b2bceda1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#15 0x00007fb8b2ba38d6 in ?? () from /usr/lib/libpython2.5.so.1.0
#16 0x00007fb8b2baa940 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0x00007fb8b2baba86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0x00007fb8b2babba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#19 0x00007fb8b2bceda1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#20 0x00007fb8b2bcf03b in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#21 0x00007fb89f5ddfe6 in PythonUI::execScript (script={static npos = 18446744073709551615, _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7fffbb07f020 "?\230\203"}}) at gui/py/PythonUI.cpp:44
#22 0x00007fb89f5df30b in PythonUI::pythonSession () at gui/py/PythonUI.cpp:96
#23 0x00007fb89f5e02c9 in PythonUI::run (this=0x8396e0, argc=4, argv=0x7fffbb07fd40) at gui/py/PythonUI.cpp:128
#24 0x000000000058e92e in main (argc=4, argv=0x7fffbb07fd40) at core/yade.cpp:253
#0  0x00007fb8b28e3e81 in nanosleep () from /lib/libpthread.so.0

-------------- next part --------------
_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at arcig.cz  Tue Oct 21 08:13:37 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Tue, 21 Oct 2008 08:13:37 +0200
Subject: [deprecated list] [Yade-dev] lock on interaction container in the
	draw loop
Message-ID: <48FD7311.1030606@arcig.cz>

Janek, could you please add the mutex on interactions so that the
rendering engine doesn't crash if they are deleted? We talked about that
in Aussois, if you remember. If you don't have time, please just briefly
explain to me how to do that -- I can probably copy most of that from
the body container lock.

Thanks, V?clav

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Tue Oct 21 10:35:10 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Tue, 21 Oct 2008 10:35:10 +0200
Subject: [deprecated list] [Yade-dev] lock on interaction container in
	the draw loop
In-Reply-To: <48FD7311.1030606@arcig.cz>
References: <48FD7311.1030606@arcig.cz>
Message-ID: <20081021103510.20d0a2b1@szpak>

V?clav ?milauer said:     (by the date of Tue, 21 Oct 2008 08:13:37 +0200)

> Janek, could you please add the mutex on interactions so that the
> rendering engine doesn't crash if they are deleted? We talked about that
> in Aussois, if you remember. If you don't have time, please just briefly
> explain to me how to do that -- I can probably copy most of that from
> the body container lock.

I checked the code briefly. We have a problem, the mutex is added for
interactions, not for bodies. Apparently it doesn't work correctly.
Sorry, fixing that is a bigger call. I can't do this now/quickly.

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Wed Oct 22 18:38:51 2008
From: eudoxos at arcig.cz (=?windows-1252?Q?V=E1clav_=8Amilauer?=)
Date: Wed, 22 Oct 2008 18:38:51 +0200
Subject: [deprecated list] [Yade-dev] ContactLaw1
In-Reply-To: <48FF5377.2040603@geo.hmg.inpg.fr>
References: <200809260802.m8Q82DfS028074@sheep.berlios.de>	<48DCB0B5.3090808@arcig.cz>	<48DCB959.6040209@geo.hmg.inpg.fr>	<20080926141211.18247d5f@szpak>	<48DE0B9C.1050009@arcig.cz>
	<20080927133734.6cb5f3a9@szpak> <48EB0D07.7060809@arcig.cz>
	<48FF5377.2040603@geo.hmg.inpg.fr>
Message-ID: <48FF571B.2090606@arcig.cz>


>>  
> I just noticed I do not find anywhere this "ElasticContactLaw2". Is
> this file supposed to be in the svn ?
(Make sure you reply to the list, not to my personal address)

It is in ElasticContactLaw.hpp and .cpp, I just commited a revision that
adds bending and torsion (though not correctly implemeneted, in some
aspects) and an update example in scripts/chain-distant-interactions.py.

Regards, Vaclav


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Wed Oct 22 18:38:51 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Wed, 22 Oct 2008 18:38:51 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1549 - in trunk: core extra
	extra/clump gui/py	gui/qt3
	pkg/dem/DataClass/InteractionGeometry	pkg/dem/Engine/EngineUnit
	pkg/dem/Engine/StandAloneEngine	pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry
	scripts
Message-ID: <200810221638.m9MGcpRZ019297@sheep.berlios.de>

Author: eudoxos
Date: 2008-10-22 18:38:47 +0200 (Wed, 22 Oct 2008)
New Revision: 1549

Modified:
   trunk/core/DisplayParameters.hpp
   trunk/extra/Brefcom.cpp
   trunk/extra/Brefcom.hpp
   trunk/extra/BrefcomTestGen.cpp
   trunk/extra/clump/Shop.cpp
   trunk/extra/clump/Shop.hpp
   trunk/gui/py/PythonUI_rc.py
   trunk/gui/py/_utils.cpp
   trunk/gui/qt3/GLViewer.cpp
   trunk/gui/qt3/SimulationController.cpp
   trunk/gui/qt3/YadeQtMainWindow.cpp
   trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.cpp
   trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp
   trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp
   trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp
   trunk/scripts/chain-distant-interactions.py
   trunk/scripts/default-test.py
Log:
1. Add a quick implementation of bending and torsion code to SpheresContactGeometry
2. Update ElasticContactLaw2 to use that code; stiffnesses are hard-coded for now.
3. Update scripts/chain-distant-interactions.py to show that that code really works
4. Plot residual strength instead of damage in brefcom
5. Add some functions for spiral projections (not correctly working yet)
6. Fix missing std:: in DisplayParameters



Modified: trunk/core/DisplayParameters.hpp
===================================================================
--- trunk/core/DisplayParameters.hpp	2008-10-17 16:17:12 UTC (rev 1548)
+++ trunk/core/DisplayParameters.hpp	2008-10-22 16:38:47 UTC (rev 1549)
@@ -12,13 +12,13 @@
 
 class DisplayParameters: public Serializable{
 	private:
-		vector<string> values;
-		vector<string> displayTypes;
+		std::vector<std::string> values;
+		std::vector<std::string> displayTypes;
 	public:
 		//! Get value of given display type and put it in string& value and return true; if there is no such display type, return false.
-		bool getValue(string displayType, string& value){assert(values.size()==displayTypes.size()); vector<string>::iterator I=std::find(displayTypes.begin(),displayTypes.end(),displayType); if(I==displayTypes.end()) return false; value=values[std::distance(displayTypes.begin(),I)]; return true;}
+		bool getValue(std::string displayType, std::string& value){assert(values.size()==displayTypes.size()); vector<string>::iterator I=std::find(displayTypes.begin(),displayTypes.end(),displayType); if(I==displayTypes.end()) return false; value=values[std::distance(displayTypes.begin(),I)]; return true;}
 		//! Set value of given display type; if such display type exists, it is overwritten, otherwise a new one is created.
-		void setValue(string displayType, string value){assert(values.size()==displayTypes.size()); vector<string>::iterator I=std::find(displayTypes.begin(),displayTypes.end(),displayType); if(I==displayTypes.end()){displayTypes.push_back(displayType); values.push_back(value);} else {values[std::distance(displayTypes.begin(),I)]=value;};}
+		void setValue(std::string displayType, std::string value){assert(values.size()==displayTypes.size()); vector<string>::iterator I=std::find(displayTypes.begin(),displayTypes.end(),displayType); if(I==displayTypes.end()){displayTypes.push_back(displayType); values.push_back(value);} else {values[std::distance(displayTypes.begin(),I)]=value;};}
 	DisplayParameters(){}
 	virtual ~DisplayParameters(){}
 	virtual void registerAttributes(){ REGISTER_ATTRIBUTE(displayTypes); REGISTER_ATTRIBUTE(values); }

Modified: trunk/extra/Brefcom.cpp
===================================================================
--- trunk/extra/Brefcom.cpp	2008-10-17 16:17:12 UTC (rev 1548)
+++ trunk/extra/Brefcom.cpp	2008-10-22 16:38:47 UTC (rev 1549)
@@ -146,7 +146,7 @@
 		if(BC->omega>=1.0 && BC->omegaThreshold>=1.0) continue;
 
 		// shorthands
-		Real& epsN(BC->epsN); Vector3r& epsT(BC->epsT); Real& kappaD(BC->kappaD); const Real& xiShear(BC->xiShear); const Real& E(BC->E); const Real& undamagedCohesion(BC->undamagedCohesion); const Real& tanFrictionAngle(BC->tanFrictionAngle); const Real& G(BC->G); const Real& crossSection(BC->crossSection); const Real& tau(BC->tau); const Real& expDmgRate(BC->expDmgRate); const Real& omegaThreshold(BC->omegaThreshold); const Real& transStrainCoeff(BC->transStrainCoeff); const Real& epsTrans(BC->epsTrans); const Real& epsCrackOnset(BC->epsCrackOnset);
+		Real& epsN(BC->epsN); Vector3r& epsT(BC->epsT); Real& kappaD(BC->kappaD); const Real& xiShear(BC->xiShear); const Real& E(BC->E); const Real& undamagedCohesion(BC->undamagedCohesion); const Real& tanFrictionAngle(BC->tanFrictionAngle); const Real& G(BC->G); const Real& crossSection(BC->crossSection); const Real& tau(BC->tau); const Real& expDmgRate(BC->expDmgRate); const Real& omegaThreshold(BC->omegaThreshold); const Real& transStrainCoeff(BC->transStrainCoeff); const Real& epsTrans(BC->epsTrans); const Real& epsCrackOnset(BC->epsCrackOnset); Real& relResidualStrength(BC->relResidualStrength);
 		// for python access
 		Real& omega(BC->omega); Real& sigmaN(BC->sigmaN);  Vector3r& sigmaT(BC->sigmaT); Real& Fn(BC->Fn); Vector3r& Fs(BC->Fs);
 		// for rate-dependence
@@ -205,18 +205,19 @@
 	const shared_ptr<BrefcomContact>& BC=static_pointer_cast<BrefcomContact>(ip);
 	const shared_ptr<SpheresContactGeometry>& geom=YADE_PTR_CAST<SpheresContactGeometry>(i->interactionGeometry);
 
-	Vector3r lineColor(BC->omega,1-BC->omega,0.0); /* damaged links red, undamaged green */
+	//Vector3r lineColor(BC->omega,1-BC->omega,0.0); /* damaged links red, undamaged green */
+	Vector3r lineColor=Shop::scalarOnColorScale(1.-BC->relResidualStrength);
 
 	if(colorStrain) lineColor=Vector3r(
 		min(1.,max(0.,-BC->epsTrans/BC->epsCrackOnset)),
 		min(1.,max(0.,BC->epsTrans/BC->epsCrackOnset)),
 		min(1.,max(0.,abs(BC->epsTrans)/BC->epsCrackOnset-1)));
 
-	if(contactLine) GLUtils::GLDrawLine(b1->physicalParameters->dispSe3.position,b2->physicalParameters->dispSe3.position,.5*lineColor);
+	if(contactLine) GLUtils::GLDrawLine(b1->physicalParameters->dispSe3.position,b2->physicalParameters->dispSe3.position,lineColor);
 	if(dmgLabel){ GLUtils::GLDrawNum(BC->omega,0.5*(b1->physicalParameters->dispSe3.position+b2->physicalParameters->dispSe3.position),lineColor); }
 	else if(epsNLabel){ GLUtils::GLDrawNum(BC->epsN,0.5*(b1->physicalParameters->dispSe3.position+b2->physicalParameters->dispSe3.position),lineColor); }
 	if(BC->omega>0 && dmgPlane){
-		Real halfSize=sqrt(BC->omega)*.705*sqrt(BC->crossSection);
+		Real halfSize=sqrt(1-BC->relResidualStrength)*.5*.705*sqrt(BC->crossSection);
 		Vector3r midPt=.5*Vector3r(b1->physicalParameters->dispSe3.position+b2->physicalParameters->dispSe3.position);
 		glDisable(GL_CULL_FACE);
 		glPushMatrix();

Modified: trunk/extra/Brefcom.hpp
===================================================================
--- trunk/extra/Brefcom.hpp	2008-10-17 16:17:12 UTC (rev 1548)
+++ trunk/extra/Brefcom.hpp	2008-10-22 16:38:47 UTC (rev 1549)
@@ -84,7 +84,7 @@
 
 		/*! auxiliary variable for visualization, recalculated in BrefcomLaw at every iteration */
 		// FIXME: Fn and Fs are stored as Vector3r normalForce, shearForce in NormalShearInteraction 
-		Real omega, Fn, sigmaN, epsN; Vector3r epsT, sigmaT, Fs;
+		Real omega, Fn, sigmaN, epsN, relResidualStrength; Vector3r epsT, sigmaT, Fs;
 
 		BrefcomContact(): NormalShearInteraction(),E(0), G(0), tanFrictionAngle(0), undamagedCohesion(0), crossSection(0), xiShear(0), tau(0), expDmgRate(0) { createIndex(); epsT=Vector3r::ZERO; kappaD=0; isCohesive=false; neverDamage=false; omega=0; Fn=0; Fs=Vector3r::ZERO; }
 		//	BrefcomContact(Real _E, Real _G, Real _tanFrictionAngle, Real _undamagedCohesion, Real _equilibriumDist, Real _crossSection, Real _epsCrackOnset, Real _epsFracture, Real _expBending, Real _xiShear, Real _tau=0, Real _expDmgRate=1): InteractionPhysics(), E(_E), G(_G), tanFrictionAngle(_tanFrictionAngle), undamagedCohesion(_undamagedCohesion), equilibriumDist(_equilibriumDist), crossSection(_crossSection), epsCrackOnset(_epsCrackOnset), epsFracture(_epsFracture), expBending(_expBending), xiShear(_xiShear), tau(_tau), expDmgRate(_expDmgRate) { epsT=Vector3r::ZERO; kappaD=0; isCohesive=false; neverDamage=false; omega=0; Fn=0; Fs=Vector3r::ZERO; /*TRVAR5(epsCrackOnset,epsFracture,Kn,crossSection,equilibriumDist); */ }
@@ -120,6 +120,7 @@
 			REGISTER_ATTRIBUTE(epsN);
 			REGISTER_ATTRIBUTE(sigmaN);
 			REGISTER_ATTRIBUTE(sigmaT);
+			REGISTER_ATTRIBUTE(relResidualStrength);
 		};
 
 	REGISTER_CLASS_NAME(BrefcomContact);

Modified: trunk/extra/BrefcomTestGen.cpp
===================================================================
--- trunk/extra/BrefcomTestGen.cpp	2008-10-17 16:17:12 UTC (rev 1548)
+++ trunk/extra/BrefcomTestGen.cpp	2008-10-22 16:38:47 UTC (rev 1549)
@@ -91,7 +91,9 @@
 	rootBody->engines.push_back(collider);
 
 	shared_ptr<InteractionGeometryMetaEngine> igeomDispatcher(new InteractionGeometryMetaEngine);
-	igeomDispatcher->add(new InteractingSphere2InteractingSphere4SpheresContactGeometry);
+	shared_ptr<InteractingSphere2InteractingSphere4SpheresContactGeometry> is2is4scg(new InteractingSphere2InteractingSphere4SpheresContactGeometry);
+	is2is4scg->hasShear=true;
+	igeomDispatcher->add(is2is4scg);
 	rootBody->engines.push_back(igeomDispatcher);
 
 	shared_ptr<InteractionPhysicsMetaEngine> iphysDispatcher(new InteractionPhysicsMetaEngine);

Modified: trunk/extra/clump/Shop.cpp
===================================================================
--- trunk/extra/clump/Shop.cpp	2008-10-17 16:17:12 UTC (rev 1548)
+++ trunk/extra/clump/Shop.cpp	2008-10-22 16:38:47 UTC (rev 1549)
@@ -1146,3 +1146,25 @@
 	return v0+((v2-v0)*(v1-v0).Length()+(v1-v0)*(v2-v0).Length())/((v1-v0).Length()+(v2-v1).Length()+(v0-v2).Length());
 }
 
+
+/* This function is copied almost verbatim from scientific python, module Visualization, class ColorScale
+ *
+ */
+Vector3r Shop::scalarOnColorScale(Real x, Real xmin, Real xmax){
+	Real xnorm=min(1.,max((x-xmin)/(xmax-xmin),0.));
+	if(xnorm<.25) return Vector3r(0,.4*xnorm,1);
+	if(xnorm<.5)  return Vector3r(0,1,1.-4.*(xnorm-.25));
+	if(xnorm<.75) return Vector3r(4*(xnorm-.5),1.,0);
+	return Vector3r(1,1-4*(xnorm-.75),0);
+}
+
+/* Wrap floating point number into interval (x0,x1?such that it is shifted
+ * by integral number of the interval range. If given, *period will hold
+ * this number. The wrapped value is returned.
+ */
+Real Shop::periodicWrap(Real x, Real x0, Real x1, long* period){
+	double xNorm=(x-x0)/(x1-x0);
+	double xxNorm=xNorm-floor(xNorm);
+	if(period) *period=(long)floor(xNorm);
+	return x0+xxNorm*(x1-x0);
+}

Modified: trunk/extra/clump/Shop.hpp
===================================================================
--- trunk/extra/clump/Shop.hpp	2008-10-17 16:17:12 UTC (rev 1548)
+++ trunk/extra/clump/Shop.hpp	2008-10-22 16:38:47 UTC (rev 1549)
@@ -108,4 +108,10 @@
 
 		//! apply force on contact point on both bodies (reversed on body 2)
 		static void applyForceAtContactPoint(const Vector3r& force, const Vector3r& contPt, body_id_t id1, const Vector3r& pos1, body_id_t id2, const Vector3r& pos2, MetaBody* rb);
+
+		//! map scalar variable to 1d colorscale
+		static Vector3r scalarOnColorScale(Real x, Real xmin=0., Real xmax=1.);
+
+		//! wrap floating number periodically to the given range
+		static Real periodicWrap(Real x, Real x0, Real x1, long* period=NULL);
 };

Modified: trunk/gui/py/PythonUI_rc.py
===================================================================
--- trunk/gui/py/PythonUI_rc.py	2008-10-17 16:17:12 UTC (rev 1548)
+++ trunk/gui/py/PythonUI_rc.py	2008-10-22 16:38:47 UTC (rev 1549)
@@ -3,12 +3,12 @@
 
 yade.runtime must have already been populated from within c++."""
 
-from yade import runtime
 import sys
 sys.excepthook=sys.__excepthook__ # apport on ubuntu overrides this, we don't need it
 # sys.path.insert(0,runtime.prefix+'/lib/yade'+runtime.suffix+'/extra')
 
 from yade.wrapper import *
+from yade import runtime
 
 #try:
 #	import yade.qt.atexit

Modified: trunk/gui/py/_utils.cpp
===================================================================
--- trunk/gui/py/_utils.cpp	2008-10-17 16:17:12 UTC (rev 1548)
+++ trunk/gui/py/_utils.cpp	2008-10-22 16:38:47 UTC (rev 1549)
@@ -199,6 +199,30 @@
 	return ret;
 }
 
+/* Project 3d point into 2d using spiral projection along given axis;
+ * the returned tuple is
+ * 	
+ *  ( (height relative to the spiral, distance from axis), theta )
+ *
+ * dH_dTheta is the inclination of the spiral (height increase per radian),
+ * theta0 is the angle for zero height (by given axis).
+ */
+python::tuple spiralProject(python::tuple _pt, Real dH_dTheta, int axis=2, Real theta0=0){
+	int ax1=(axis+1)%3,ax2=(axis+2)%3;
+	Vector3r pt=tuple2vec(_pt);
+	Real r=sqrt(pow(pt[ax1],2)+pow(pt[ax2],2));
+	Real theta;
+	if(r>Mathr::ZERO_TOLERANCE) theta=acos(pt[ax1]/r);
+	if(pt[ax2]<0) theta=Mathr::TWO_PI-theta;
+	else theta=0;
+	Real hRef=dH_dTheta*(theta-theta0);
+	long period;
+	Real h=Shop::periodicWrap(pt[axis],hRef-Mathr::PI*dH_dTheta,hRef+Mathr::PI*dH_dTheta,&period);
+	cerr<<":"<<h-hRef<<" "<<h<<" "<<hRef<<" "<<" ("<<hRef-Mathr::PI*dH_dTheta<<","<<hRef+Mathr::PI*dH_dTheta<<") "<<theta<<" "<<endl;
+	return python::make_tuple(python::make_tuple(r,h-dH_dTheta*(theta-theta0+2*Mathr::PI*period)),theta);
+}
+BOOST_PYTHON_FUNCTION_OVERLOADS(spiralProject_overloads,spiralProject,2,4);
+
 // for now, don't return anything, since we would have to include the whole yadeControl.cpp because of pyInteraction
 void Shop__createExplicitInteraction(body_id_t id1, body_id_t id2){ (void) Shop::createExplicitInteraction(id1,id2);}
 
@@ -218,6 +242,7 @@
 	def("sumBexForces",sumBexForces);
 	def("sumBexMoments",sumBexMoments);
 	def("createInteraction",Shop__createExplicitInteraction);
+	def("spiralProject",spiralProject,spiralProject_overloads(args("axis","theta0")));
 }
 
 

Modified: trunk/gui/qt3/GLViewer.cpp
===================================================================
--- trunk/gui/qt3/GLViewer.cpp	2008-10-17 16:17:12 UTC (rev 1548)
+++ trunk/gui/qt3/GLViewer.cpp	2008-10-22 16:38:47 UTC (rev 1549)
@@ -518,7 +518,7 @@
 		}
 		if(timeDispMask & GLViewer::TIME_ITER){
 			ostringstream oss;
-			oss<<"#"<<Omega::instance().getCurrentIteration()<<"\n";
+			oss<<"#"<<Omega::instance().getCurrentIteration();
 			QGLViewer::drawText(x,y,oss.str());
 			y-=lineHt;
 		}

Modified: trunk/gui/qt3/SimulationController.cpp
===================================================================
--- trunk/gui/qt3/SimulationController.cpp	2008-10-17 16:17:12 UTC (rev 1548)
+++ trunk/gui/qt3/SimulationController.cpp	2008-10-22 16:38:47 UTC (rev 1549)
@@ -133,7 +133,7 @@
 
 void SimulationController::loadSimulationFromFileName(const std::string& fileName,bool center, bool useTimeStepperIfPresent)
 {
-	assert(filesystem::exists(fileName));
+	assert(filesystem::exists(fileName) || fileName.find(":memory:")==(size_t)0);
 
 		Omega::instance().finishSimulationLoop();
 		Omega::instance().joinSimulationLoop();

Modified: trunk/gui/qt3/YadeQtMainWindow.cpp
===================================================================
--- trunk/gui/qt3/YadeQtMainWindow.cpp	2008-10-17 16:17:12 UTC (rev 1548)
+++ trunk/gui/qt3/YadeQtMainWindow.cpp	2008-10-22 16:38:47 UTC (rev 1549)
@@ -114,7 +114,7 @@
 
 void YadeQtMainWindow::Quit(){ emit close(); }
 
-void YadeQtMainWindow::closeEvent(QCloseEvent *e){ closeAllChilds(); YadeQtGeneratedMainWindow::closeEvent(e); }
+void YadeQtMainWindow::closeEvent(QCloseEvent *e){ renderer=shared_ptr<OpenGLRenderingEngine>(); closeAllChilds(); YadeQtGeneratedMainWindow::closeEvent(e); }
 
 void YadeQtMainWindow::ensureRenderer(){
 	if(!renderer){

Modified: trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.cpp
===================================================================
--- trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.cpp	2008-10-17 16:17:12 UTC (rev 1548)
+++ trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.cpp	2008-10-22 16:38:47 UTC (rev 1549)
@@ -8,7 +8,21 @@
 // At least one virtual method must be in the .cpp file (!!!)
 SpheresContactGeometry::~SpheresContactGeometry(){};
 
+Vector3r SpheresContactGeometry::relRotVector() const{
+	Quaternionr relOri12=ori1.Conjugate()*ori2;
+	Quaternionr oriDiff=initRelOri12.Conjugate()*relOri12;
+	Vector3r axis; Real angle;
+	oriDiff.ToAxisAngle(axis,angle);
+	if(angle>Mathr::PI)angle-=Mathr::TWO_PI;
+	return angle*axis;
+}
 
+void SpheresContactGeometry::bendingTorsionAbs(Vector3r& bend, Real& tors){
+	Vector3r relRot=relRotVector();
+	tors=relRot.Dot(normal);
+	bend=relRot-tors*normal;
+}
+
 /* Set contact points on both spheres such that their projection is the one given
  * (should be on the plane passing through origin and oriented with normal; not checked!)
  */

Modified: trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp
===================================================================
--- trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp	2008-10-17 16:17:12 UTC (rev 1548)
+++ trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp	2008-10-22 16:38:47 UTC (rev 1549)
@@ -47,6 +47,8 @@
 		// d1 is really distance from the sphere1 center to the contact plane, it may not correspond to the sphere radius!
 		// therefore, d1+d2=d0 (distance at which the contact was created)
 		Real d1, d2, d0;
+		// initial relative orientation, used for bending and torsion computation
+		Quaternionr initRelOri12;
 
 		// auxiliary functions; the quaternion magic is all in here
 		static Vector3r unrollSpherePtToPlane(const Quaternionr& fromXtoPtOri, const Real& radius, const Vector3r& normal);
@@ -54,13 +56,13 @@
 
 		void setTgPlanePts(Vector3r p1new, Vector3r p2new);
 
-		Vector3r contPtInTgPlane1(){assert(hasShear); return unrollSpherePtToPlane(ori1*cp1rel,d1,normal);}
-		Vector3r contPtInTgPlane2(){assert(hasShear); return unrollSpherePtToPlane(ori2*cp2rel,d2,-normal);}
-		Vector3r contPt(){return contactPoint; /*pos1+(d1/d0)*(pos2-pos1)*/}
+		Vector3r contPtInTgPlane1() const {assert(hasShear); return unrollSpherePtToPlane(ori1*cp1rel,d1,normal);}
+		Vector3r contPtInTgPlane2() const {assert(hasShear); return unrollSpherePtToPlane(ori2*cp2rel,d2,-normal);}
+		Vector3r contPt() const {return contactPoint; /*pos1+(d1/d0)*(pos2-pos1)*/}
 
-		Real displacementN(){assert(hasShear); return (pos2-pos1).Length()-d0;}
-		Real epsN(){return displacementN()*(1./d0);}
-		Vector3r displacementT(){ assert(hasShear);
+		Real displacementN() const {assert(hasShear); return (pos2-pos1).Length()-d0;}
+		Real epsN() const {return displacementN()*(1./d0);}
+		Vector3r displacementT() const { assert(hasShear);
 			// enabling automatic relocation decreases overall simulation speed by about 3%
 			// perhaps: bool largeStrains ... ?
 			#if 0 
@@ -71,7 +73,7 @@
 				return contPtInTgPlane2()-contPtInTgPlane1();
 			#endif
 		}
-		Vector3r epsT(){return displacementT()*(1./d0);}
+		Vector3r epsT() const {return displacementT()*(1./d0);}
 	
 		Real slipToDisplacementTMax(Real displacementTMax);
 		//! slip to epsTMax if current epsT is greater; return the relative slip magnitude
@@ -80,6 +82,11 @@
 		void relocateContactPoints();
 		void relocateContactPoints(const Vector3r& tgPlanePt1, const Vector3r& tgPlanePt2);
 
+		void bendingTorsionAbs(Vector3r& bend, Real& tors);
+		void bendingTorsionRel(Vector3r& bend, Real& tors){ bendingTorsionAbs(bend,tors); bend/=d0; tors/=d0;}
+
+		Vector3r relRotVector() const;
+
 		SpheresContactGeometry():contactPoint(Vector3r::ZERO),radius1(0),radius2(0),hasShear(false),pos1(Vector3r::ZERO),pos2(Vector3r::ZERO){createIndex();}
 		virtual ~SpheresContactGeometry();
 	protected :
@@ -98,6 +105,7 @@
 			REGISTER_ATTRIBUTE(d1);
 			REGISTER_ATTRIBUTE(d2);
 			REGISTER_ATTRIBUTE(d0);
+			REGISTER_ATTRIBUTE(initRelOri12);
 		}
 	REGISTER_CLASS_NAME(SpheresContactGeometry);
 	REGISTER_BASE_CLASS_NAME(InteractionGeometry);

Modified: trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp
===================================================================
--- trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp	2008-10-17 16:17:12 UTC (rev 1548)
+++ trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp	2008-10-22 16:38:47 UTC (rev 1549)
@@ -51,6 +51,7 @@
 				// contact constants
 				scm->d0=(se32.position-se31.position).Length();
 				scm->d1=s1->radius-penetrationDepth; scm->d2=s2->radius-penetrationDepth;
+				scm->initRelOri12=se31.orientation.Conjugate()*se32.orientation;
 				// quasi-constants
 				scm->cp1rel.Align(Vector3r::UNIT_X,se31.orientation.Conjugate()*normal);
 				scm->cp2rel.Align(Vector3r::UNIT_X,se32.orientation.Conjugate()*(-normal));

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp	2008-10-17 16:17:12 UTC (rev 1548)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp	2008-10-22 16:38:47 UTC (rev 1549)
@@ -27,6 +27,7 @@
 ElasticContactLaw2::~ElasticContactLaw2(){}
 
 void ElasticContactLaw2::action(MetaBody* rb){
+	Real /* bending stiffness */ kb=1e7, /* torsion stiffness */ ktor=1e8;
 	FOREACH(shared_ptr<Interaction> i, *rb->transientInteractions){
 		if(!i->isReal) continue;
 		shared_ptr<SpheresContactGeometry> contGeom=YADE_PTR_CAST<SpheresContactGeometry>(i->interactionGeometry);
@@ -37,10 +38,16 @@
 		if(!isCohesive && contGeom->displacementN()>0){ cerr<<"deleting"<<endl; /* delete the interaction */ i->isReal=false; continue;}
 		contPhys->normalForce=Fn*contGeom->normal;
 		//contGeom->relocateContactPoints();
-		contGeom->slipToDisplacementTMax(max(0.,(-Fn*contPhys->tangensOfFrictionAngle)/contPhys->ks)); // limit shear displacement -- Coulomb criterion
+		//contGeom->slipToDisplacementTMax(max(0.,(-Fn*contPhys->tangensOfFrictionAngle)/contPhys->ks)); // limit shear displacement -- Coulomb criterion
 		contPhys->shearForce=contPhys->ks*contGeom->displacementT();
 		Vector3r force=contPhys->shearForce+contPhys->normalForce;
 		Shop::applyForceAtContactPoint(force,contGeom->contactPoint,i->getId1(),contGeom->pos1,i->getId2(),contGeom->pos2,rb);
+
+		Vector3r bendAbs; Real torsionAbs; contGeom->bendingTorsionAbs(bendAbs,torsionAbs);
+		Shop::Bex::momentum(i->getId1(),rb)+=contGeom->normal*torsionAbs*ktor;
+		Shop::Bex::momentum(i->getId2(),rb)-=contGeom->normal*torsionAbs*ktor;
+		Shop::Bex::momentum(i->getId1(),rb)+=bendAbs*kb;
+		Shop::Bex::momentum(i->getId2(),rb)-=bendAbs*kb;
 	}
 }
 

Modified: trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp
===================================================================
--- trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp	2008-10-17 16:17:12 UTC (rev 1548)
+++ trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp	2008-10-22 16:38:47 UTC (rev 1549)
@@ -81,6 +81,15 @@
 		Vector3r pos1=sc->pos1, pos2=sc->pos2, contPt=sc->contPt();
 		//Vector3r contPt=se31.position+(sc->d1/sc->d0)*(se32.position-se31.position); // must be recalculated to not be unscaled if scaling displacements ...
 		GLUtils::GLDrawLine(pos1,pos2,Vector3r(.5,.5,.5));
+		Vector3r bend; Real tors;
+		sc->bendingTorsionRel(bend,tors);
+		GLUtils::GLDrawLine(contPt,contPt+10*sc->radius1*(bend+sc->normal*tors),Vector3r(1,0,0));
+		#if 0
+		GLUtils::GLDrawNum(bend[0],contPt-.2*sc->normal*sc->radius1,Vector3r(1,0,0));
+		GLUtils::GLDrawNum(bend[1],contPt,Vector3r(0,1,0));
+		GLUtils::GLDrawNum(bend[2],contPt+.2*sc->normal*sc->radius1,Vector3r(0,0,1));
+		GLUtils::GLDrawNum(tors,contPt+.5*sc->normal*sc->radius2,Vector3r(1,1,0));
+		#endif
 		// sphere center to point on the sphere
 		//GLUtils::GLDrawLine(pos1,pos1+(sc->ori1*sc->cp1rel*Vector3r::UNIT_X*sc->d1),Vector3r(0,.5,1));
 		//GLUtils::GLDrawLine(pos2,pos2+(sc->ori2*sc->cp2rel*Vector3r::UNIT_X*sc->d2),Vector3r(0,1,.5));

Modified: trunk/scripts/chain-distant-interactions.py
===================================================================
--- trunk/scripts/chain-distant-interactions.py	2008-10-17 16:17:12 UTC (rev 1548)
+++ trunk/scripts/chain-distant-interactions.py	2008-10-22 16:38:47 UTC (rev 1549)
@@ -14,17 +14,32 @@
 	MetaEngine('InteractionGeometryMetaEngine',[EngineUnit('InteractingSphere2InteractingSphere4SpheresContactGeometry',{'hasShear':True}),]),
 	MetaEngine('InteractionPhysicsMetaEngine',[EngineUnit('SimpleElasticRelationships')]),
 	StandAloneEngine('ElasticContactLaw2',{'isCohesive':True}),
-	DeusExMachina('GravityEngine',{'gravity':[0,0,-1e5]}),
-	DeusExMachina('NewtonsDampedLaw',{'damping':0.1})
+	#DeusExMachina('MomentEngine',{'subscribedBodies':[1],'moment':[0,1000,0]}),
+	DeusExMachina('GravityEngine',{'gravity':[0,0,-1e2]}),
+	DeusExMachina('NewtonsDampedLaw',{'damping':0.2})
 ]
+o.miscParams=[Generic('GLDrawSphere',{'glutUse':True})]
+
 from yade import utils
-for n in range(20):
+from math import *
+for n in range(5):
 	o.bodies.append(utils.sphere([0,n,0],.5,dynamic=(n>0),color=[1-(n/20.),n/20.,0],young=30e9,poisson=.3,density=2400))
 	# looks for metaengine found in Omega() and uses those
 	if n>0: utils.createInteraction(n-1,n)
+for i in o.interactions: i.phys['ks']=1e7
 
 
-o.dt=.04*utils.PWaveTimeStep()
+o.dt=utils.PWaveTimeStep()
+o.saveTmp('init')
+
+try:
+	from yade import qt
+	renderer=qt.Renderer()
+	renderer['Body_wire']=True
+	renderer['Interaction_geometry']=True
+except ImportError: pass
+
+
 #o.save('/tmp/a.xml.bz2')
 #o.reload()
 #o.run(50000,True)

Modified: trunk/scripts/default-test.py
===================================================================
--- trunk/scripts/default-test.py	2008-10-17 16:17:12 UTC (rev 1548)
+++ trunk/scripts/default-test.py	2008-10-22 16:38:47 UTC (rev 1549)
@@ -84,7 +84,7 @@
 		msg['Subject']="Automated crash report for "+yade.runtime.executable+": "+",".join([r[0] for r in reports])
 		msg['From']=mailFrom
 		msg['To']=mailTo
-		msg['Reply-To']='yade-dev at lists.berlios.de'
+		msg['Reply-To']='yade-dev at lists.launchpad.net'
 		import smtplib
 		s=smtplib.SMTP()
 		s.connect()


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at arcig.cz  Thu Oct 23 08:04:36 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Thu, 23 Oct 2008 08:04:36 +0200
Subject: [deprecated list] [Yade-dev] drop .gz support in favor of .bz2 only?
Message-ID: <490013F4.3080303@arcig.cz>

Hi, I am thinking of removing gzip support from loading/saving routines,
since bzip2 has better compression ratio and having both in the code is
not useful. Any objections? Vaclav

PS If you have an old simulation saved as .xml.gz, you can still
uncompress it with the command gunzip (and compress with the command
bzip2).

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From jduriez at mail.berlios.de  Thu Oct 23 19:35:34 2008
From: jduriez at mail.berlios.de (jduriez at BerliOS)
Date: Thu, 23 Oct 2008 19:35:34 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1551 - in trunk/pkg/dem:
	Engine/StandAloneEngine	PreProcessor
Message-ID: <200810231735.m9NHZYS4021975@sheep.berlios.de>

Author: jduriez
Date: 2008-10-23 19:35:34 +0200 (Thu, 23 Oct 2008)
New Revision: 1551

Modified:
   trunk/pkg/dem/Engine/StandAloneEngine/ContactLaw1.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/ContactLaw1.hpp
   trunk/pkg/dem/PreProcessor/SimpleShear.cpp
   trunk/pkg/dem/PreProcessor/SimpleShear.hpp
Log:
-ContactLaw1 : correction of prototype of action() : it needed a body, whereas now action methods of Engines need a Metabody. This led the simulation to crash and is 
now fixed
- SimpleShear : now all is normaly done so that this preprocessor could be used (with success) with this ContactLaw. Moreover it is now linked to the 
GlobalStifnessTimeStepper (instead of the ElasticOne)



Modified: trunk/pkg/dem/Engine/StandAloneEngine/ContactLaw1.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ContactLaw1.cpp	2008-10-23 13:36:45 UTC (rev 1550)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ContactLaw1.cpp	2008-10-23 17:35:34 UTC (rev 1551)
@@ -9,7 +9,6 @@
 #include "ContactLaw1.hpp"
 #include<yade/pkg-dem/CohesiveFrictionalBodyParameters.hpp>
 #include<yade/pkg-dem/SpheresContactGeometry.hpp>
-#include<yade/pkg-dem/SDECLinkGeometry.hpp>
 #include<yade/pkg-dem/ContactLaw1Interaction.hpp>
 #include<yade/pkg-dem/SDECLinkPhysics.hpp>
 #include<yade/core/Omega.hpp>
@@ -42,9 +41,8 @@
 }
 
 
-void ContactLaw1::action(Body* body)
+void ContactLaw1::action(MetaBody* ncb)
 {
-    MetaBody * ncb = YADE_CAST<MetaBody*>(body);
     shared_ptr<BodyContainer>& bodies = ncb->bodies;
 
     Real dt = Omega::instance().getTimeStep();

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ContactLaw1.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ContactLaw1.hpp	2008-10-23 13:36:45 UTC (rev 1550)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ContactLaw1.hpp	2008-10-23 17:35:34 UTC (rev 1551)
@@ -19,10 +19,12 @@
 This contact Law is inspired by CohesiveFrictionalContactLaw (inspired itselve directly from the work of Plassiard & Belheine, see the corresponding articles in "Annual Report 2006" in http://geo.hmg.inpg.fr/frederic/Discrete_Element_Group_FVD.html for example). It allows so to set moments, cohesion, tension limit and (that's the difference) inelastic unloadings in compression between bodies.
 All that concerned brokenBodies (this flag and the erosionactivated one) and the useless "iter" has been suppressed.
 
-The Relationsships corresponding are Relationships_1, where the rigidities, the friction angles (with their tan()), and the orientations of the interactions are calculated. No more cohesion and tension limits are computed for all the interactions
+The Relationsships corresponding are CL1Relationships, where the rigidities, the friction angles (with their tan()), and the orientations of the interactions are calculated. No more cohesion and tension limits are computed for all the interactions
 To use it you should also use :
-- CohesiveFrictionalBodyParameters for the bodies, with "isCohesive" = 1
+- CohesiveFrictionalBodyParameters for the bodies, with "isCohesive" = 1 (A verifier ce dernier point)
 - CL1Relationships (=> which involves interactions of "ContactLaw1Interaction" type)
+
+MODIF / SVN : ContactLaw1::action recevait un body, il faut un MetaBody
  */
 
 
@@ -42,7 +44,7 @@
 		bool momentAlwaysElastic;	// if true the value of the momentum (computed only if momentRotationLaw !!) is not limited by a plastic threshold
 	
 		ContactLaw1();
-		void action(Body* body);
+		void action(MetaBody*);
 
 	protected :
 		void registerAttributes();

Modified: trunk/pkg/dem/PreProcessor/SimpleShear.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/SimpleShear.cpp	2008-10-23 13:36:45 UTC (rev 1550)
+++ trunk/pkg/dem/PreProcessor/SimpleShear.cpp	2008-10-23 17:35:34 UTC (rev 1551)
@@ -15,11 +15,11 @@
 
 #include <yade/lib-miniWm3/Wm3Math.h>
 
-#include <yade/pkg-dem/BodyMacroParameters.hpp>
-#include <yade/pkg-dem/ElasticContactLaw.hpp>
-#include <yade/pkg-dem/MacroMicroElasticRelationships.hpp>
-#include <yade/pkg-dem/SimpleElasticRelationships.hpp>
-#include <yade/pkg-dem/ElasticCriterionTimeStepper.hpp>
+#include <yade/pkg-dem/CohesiveFrictionalBodyParameters.hpp>
+#include <yade/pkg-dem/ContactLaw1.hpp>
+#include <yade/pkg-dem/CL1Relationships.hpp>
+#include<yade/pkg-dem/GlobalStiffnessCounter.hpp>
+#include<yade/pkg-dem/GlobalStiffnessTimeStepper.hpp>
 #include <yade/pkg-dem/PositionOrientationRecorder.hpp>
 
 #include <yade/pkg-dem/PositionRecorder.hpp>
@@ -42,11 +42,7 @@
 #include<yade/pkg-common/PhysicalActionContainerReseter.hpp>
 #include<yade/pkg-common/PhysicalActionContainerInitializer.hpp>
 
-#include<yade/pkg-common/PhysicalActionDamper.hpp>
-#include<yade/pkg-common/PhysicalActionApplier.hpp>
-
-#include<yade/pkg-common/CundallNonViscousDamping.hpp>
-#include<yade/pkg-common/CundallNonViscousDamping.hpp>
+#include<yade/pkg-dem/NewtonsDampedLaw.hpp>
 #include<yade/pkg-common/GravityEngines.hpp>
 #include<yade/pkg-common/CinemDNCEngine.hpp>
 
@@ -73,7 +69,7 @@
 	gravity = Vector3r(0,-9.81,0);
 
 // Fichier contenant la liste des positions des centres et des rayons des spheres qui vont generer l'echantillon :
-	filename = "../data/porosite0_55.txt";
+	filename = "../porosite0_44.txt";
 //  Deux parametres necessaires si on veut utiliser au contraire la methode de TriaxialTest pour generer l'echantillon de spheres :
 // 	porosite=0.75;
 // 	nBilles=8000;
@@ -83,18 +79,15 @@
 	profondeur=0.04;
 
 	density=2600;
-	sphereYoungModulus=10000000; // 10 MPa
-	spherePoissonRatio=0.2;
+	sphereYoungModulus=2.0e9; // 2 GPa, n?cessaire apparemment si on veut reproduire un joint rocheux
+	spherePoissonRatio=0.04; // Venant de "Calibration procedure...." (Plassiard et al)
 	sphereFrictionDeg=26;
 
-	boxYoungModulus=10000000; // 10 MPa
-	boxPoissonRatio=0.2;
+	boxYoungModulus=2.0e9; // 2 GPa, n?cessaire apparemment si on veut reproduire un joint rocheux
+	boxPoissonRatio=0.04;
 
 	shearSpeed=0.1;
 	
-	dampingForce = 0.3;
-	dampingMomentum = 0.3;
-
 	timeStepUpdateInterval = 50;
 	
 	gravApplied = true;
@@ -135,8 +128,6 @@
 	REGISTER_ATTRIBUTE(shearSpeed);
 	REGISTER_ATTRIBUTE(gravApplied);
 	REGISTER_ATTRIBUTE(shearApplied);
-	REGISTER_ATTRIBUTE(dampingForce);
-	REGISTER_ATTRIBUTE(dampingMomentum );
 	REGISTER_ATTRIBUTE(timeStepUpdateInterval );
 }
 
@@ -162,7 +153,7 @@
 
 	shared_ptr<Body> w2;	// The lower one :
 	createBox(w2,Vector3r(width/2.0,-thickness/2.0,0),Vector3r(width/2.0,thickness/2.0,profondeur/2.0));
-	YADE_CAST<BodyMacroParameters*>(w2->physicalParameters.get())->frictionAngle = sphereFrictionDeg; // so that we have phi(spheres-inferior wall)=phi(sphere-sphere)
+	YADE_CAST<CohesiveFrictionalBodyParameters*>(w2->physicalParameters.get())->frictionAngle = sphereFrictionDeg * Mathr::PI/180.0;; // so that we have phi(spheres-inferior wall)=phi(sphere-sphere)
 	rootBody->bodies->insert(w2);
 
 	shared_ptr<Body> w3;	// The right one
@@ -171,7 +162,7 @@
 
 	shared_ptr<Body> w4; // The upper one
 	createBox(w4,Vector3r(width/2.0,height+thickness/2.0,0),Vector3r(width/2.0,thickness/2.0,profondeur/2.0));
-	YADE_CAST<BodyMacroParameters*>(w4->physicalParameters.get())->frictionAngle = sphereFrictionDeg; // so that we have phi(spheres-superior wall)=phi(sphere-sphere)
+	YADE_CAST<CohesiveFrictionalBodyParameters*>(w4->physicalParameters.get())->frictionAngle = sphereFrictionDeg * Mathr::PI/180.0;; // so that we have phi(spheres-superior wall)=phi(sphere-sphere)
 	rootBody->bodies->insert(w4);
 
 // To close the front and the bottom of the box 
@@ -211,7 +202,7 @@
 void SimpleShear::createSphere(shared_ptr<Body>& body, Vector3r position, Real radius)
 {
 	body = shared_ptr<Body>(new Body(0,1));
-	shared_ptr<BodyMacroParameters> physics(new BodyMacroParameters);
+	shared_ptr<CohesiveFrictionalBodyParameters> physics(new CohesiveFrictionalBodyParameters);
 	shared_ptr<AABB> aabb(new AABB);
 	shared_ptr<Sphere> gSphere(new Sphere);
 	shared_ptr<InteractingSphere> iSphere(new InteractingSphere);
@@ -229,6 +220,7 @@
 	physics->young			= sphereYoungModulus;
 	physics->poisson		= spherePoissonRatio;
 	physics->frictionAngle		= sphereFrictionDeg * Mathr::PI/180.0;
+	physics->isCohesive		= 1;
 
 	aabb->diffuseColor		= Vector3r(0,1,0);
 
@@ -253,7 +245,7 @@
 void SimpleShear::createBox(shared_ptr<Body>& body, Vector3r position, Vector3r extents)
 {
 	body = shared_ptr<Body>(new Body(0,1));
-	shared_ptr<BodyMacroParameters> physics(new BodyMacroParameters);
+	shared_ptr<CohesiveFrictionalBodyParameters> physics(new CohesiveFrictionalBodyParameters);
 	shared_ptr<AABB> aabb(new AABB);
 	shared_ptr<Box> gBox(new Box);
 	shared_ptr<InteractingBox> iBox(new InteractingBox);
@@ -278,6 +270,7 @@
 	physics->young			= boxYoungModulus;
 	physics->poisson		= boxPoissonRatio;
 	physics->frictionAngle		= 0.0;	//default value, modified after for w2 and w4 to have good values of phi(sphere-walls)
+	physics->isCohesive		= 1;
 
 	aabb->diffuseColor		= Vector3r(1,0,0);
 
@@ -318,14 +311,15 @@
 	shared_ptr<PhysicalActionContainerInitializer> physicalActionInitializer(new PhysicalActionContainerInitializer);
 	physicalActionInitializer->physicalActionNames.push_back("Force");
 	physicalActionInitializer->physicalActionNames.push_back("Momentum");
+	physicalActionInitializer->physicalActionNames.push_back("GlobalStiffness");
 	
 	shared_ptr<InteractionGeometryMetaEngine> interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
 	interactionGeometryDispatcher->add("InteractingSphere2InteractingSphere4SpheresContactGeometry");
 	interactionGeometryDispatcher->add("InteractingBox2InteractingSphere4SpheresContactGeometry");
 
 	shared_ptr<InteractionPhysicsMetaEngine> interactionPhysicsDispatcher(new InteractionPhysicsMetaEngine);
-	shared_ptr<InteractionPhysicsEngineUnit> ss(new SimpleElasticRelationships);
-	interactionPhysicsDispatcher->add(ss);
+	shared_ptr<InteractionPhysicsEngineUnit> CL1Rel(new CL1Relationships);
+	interactionPhysicsDispatcher->add(CL1Rel);
 
 	shared_ptr<BoundingVolumeMetaEngine> boundingVolumeDispatcher	= shared_ptr<BoundingVolumeMetaEngine>(new BoundingVolumeMetaEngine);
 	boundingVolumeDispatcher->add("InteractingSphere2AABB");
@@ -335,47 +329,27 @@
 	shared_ptr<GravityEngine> gravityCondition(new GravityEngine);
 	gravityCondition->gravity = gravity;
 	
-	shared_ptr<CundallNonViscousForceDamping> actionForceDamping(new CundallNonViscousForceDamping);
-	actionForceDamping->damping = dampingForce;
-	shared_ptr<CundallNonViscousMomentumDamping> actionMomentumDamping(new CundallNonViscousMomentumDamping);
-	actionMomentumDamping->damping = dampingMomentum;
-	shared_ptr<PhysicalActionDamper> actionDampingDispatcher(new PhysicalActionDamper);
-	actionDampingDispatcher->add(actionForceDamping);
-	actionDampingDispatcher->add(actionMomentumDamping);
-	
-	shared_ptr<PhysicalActionApplier> applyActionDispatcher(new PhysicalActionApplier);
-	applyActionDispatcher->add("NewtonsForceLaw");
-	applyActionDispatcher->add("NewtonsMomentumLaw");
-	
-	shared_ptr<PhysicalParametersMetaEngine> positionIntegrator(new PhysicalParametersMetaEngine);
-	positionIntegrator->add("LeapFrogPositionIntegrator");
-	shared_ptr<PhysicalParametersMetaEngine> orientationIntegrator(new PhysicalParametersMetaEngine);
-	orientationIntegrator->add("LeapFrogOrientationIntegrator");
- 	
 
-	shared_ptr<ElasticCriterionTimeStepper> sdecTimeStepper(new ElasticCriterionTimeStepper);
-	sdecTimeStepper->sdecGroupMask = 1;
-	sdecTimeStepper->timeStepUpdateInterval = timeStepUpdateInterval;
+	shared_ptr<GlobalStiffnessTimeStepper> globalStiffnessTimeStepper(new GlobalStiffnessTimeStepper);
+	globalStiffnessTimeStepper->sdecGroupMask = 1;
+	globalStiffnessTimeStepper->timeStepUpdateInterval = timeStepUpdateInterval;
 
 
 	rootBody->engines.clear();
 	rootBody->engines.push_back(shared_ptr<Engine>(new PhysicalActionContainerReseter));
-	rootBody->engines.push_back(sdecTimeStepper);
+	rootBody->engines.push_back(globalStiffnessTimeStepper);
 	rootBody->engines.push_back(boundingVolumeDispatcher);	
 	rootBody->engines.push_back(shared_ptr<Engine>(new PersistentSAPCollider));
 	rootBody->engines.push_back(interactionGeometryDispatcher);
 	rootBody->engines.push_back(interactionPhysicsDispatcher);
-	rootBody->engines.push_back(shared_ptr<Engine>(new ElasticContactLaw));
+	rootBody->engines.push_back(shared_ptr<Engine>(new ContactLaw1));
 	if(gravApplied)
 		rootBody->engines.push_back(gravityCondition);
 	if(shearApplied)
 		rootBody->engines.push_back(kinematic);
-	rootBody->engines.push_back(actionDampingDispatcher);
-	rootBody->engines.push_back(applyActionDispatcher);
-	rootBody->engines.push_back(positionIntegrator);
-	rootBody->engines.push_back(orientationIntegrator);
-	rootBody->engines.push_back(possnap);
-	rootBody->engines.push_back(forcesnap);
+	rootBody->engines.push_back(shared_ptr<Engine> (new NewtonsDampedLaw));
+// 	rootBody->engines.push_back(possnap);
+// 	rootBody->engines.push_back(forcesnap);
 	rootBody->initializers.clear();
 	rootBody->initializers.push_back(physicalActionInitializer);
 	rootBody->initializers.push_back(boundingVolumeDispatcher);

Modified: trunk/pkg/dem/PreProcessor/SimpleShear.hpp
===================================================================
--- trunk/pkg/dem/PreProcessor/SimpleShear.hpp	2008-10-23 13:36:45 UTC (rev 1550)
+++ trunk/pkg/dem/PreProcessor/SimpleShear.hpp	2008-10-23 17:35:34 UTC (rev 1551)
@@ -18,6 +18,11 @@
 The sample could be generated via the same method used in TriaxialTest Preprocesor (=> see GenerateCloud) or by reading a text file containing positions and radii of a sample (=> see ImportCloud). This last one is the one by default used by this PreProcessor as it is written here => you need to have such a file.
 Thanks to the Engines (in pkg/common/Engine/DeusExMachina) CinemDNCEngine, CinemKNCEngine and CinemCNCEngine, respectively constant normal displacement, constant normal rigidity and constant normal stress are possible to execute over such samples
 NB : in this PreProcessor only CinemDNCEngine appears, if you want to use other engines the best is maybe to modify directly .xml files
+
+Chgts depuis derniers svn
+- utilisation de ContactLaw1 => Changer les parameters en Cohe...Parameters
+- de globalstifness... pour calcul de dt
+- correction que le phi des boites etaient en la valeurs en deg (alors qu'il faut des rad)
  */
 
 
@@ -50,8 +55,6 @@
 				;
 		Real		 displacement
 				,shearSpeed;
-		Real		 dampingForce
-				,dampingMomentum;
 
 		int		 recordIntervalIter
 				,timeStepUpdateInterval;


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From jduriez at mail.berlios.de  Thu Oct 23 19:39:31 2008
From: jduriez at mail.berlios.de (jduriez at BerliOS)
Date: Thu, 23 Oct 2008 19:39:31 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1552 - in trunk/pkg/dem:
	Engine/StandAloneEngine	PreProcessor
Message-ID: <200810231739.m9NHdVU5022404@sheep.berlios.de>

Author: jduriez
Date: 2008-10-23 19:39:31 +0200 (Thu, 23 Oct 2008)
New Revision: 1552

Modified:
   trunk/pkg/dem/Engine/StandAloneEngine/ContactLaw1.hpp
   trunk/pkg/dem/PreProcessor/SimpleShear.hpp
Log:
Suppress of some useful comments (sorry for the extra mail)



Modified: trunk/pkg/dem/Engine/StandAloneEngine/ContactLaw1.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ContactLaw1.hpp	2008-10-23 17:35:34 UTC (rev 1551)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ContactLaw1.hpp	2008-10-23 17:39:31 UTC (rev 1552)
@@ -24,7 +24,6 @@
 - CohesiveFrictionalBodyParameters for the bodies, with "isCohesive" = 1 (A verifier ce dernier point)
 - CL1Relationships (=> which involves interactions of "ContactLaw1Interaction" type)
 
-MODIF / SVN : ContactLaw1::action recevait un body, il faut un MetaBody
  */
 
 

Modified: trunk/pkg/dem/PreProcessor/SimpleShear.hpp
===================================================================
--- trunk/pkg/dem/PreProcessor/SimpleShear.hpp	2008-10-23 17:35:34 UTC (rev 1551)
+++ trunk/pkg/dem/PreProcessor/SimpleShear.hpp	2008-10-23 17:39:31 UTC (rev 1552)
@@ -19,10 +19,6 @@
 Thanks to the Engines (in pkg/common/Engine/DeusExMachina) CinemDNCEngine, CinemKNCEngine and CinemCNCEngine, respectively constant normal displacement, constant normal rigidity and constant normal stress are possible to execute over such samples
 NB : in this PreProcessor only CinemDNCEngine appears, if you want to use other engines the best is maybe to modify directly .xml files
 
-Chgts depuis derniers svn
-- utilisation de ContactLaw1 => Changer les parameters en Cohe...Parameters
-- de globalstifness... pour calcul de dt
-- correction que le phi des boites etaient en la valeurs en deg (alors qu'il faut des rad)
  */
 
 


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From jduriez at mail.berlios.de  Fri Oct 24 10:47:46 2008
From: jduriez at mail.berlios.de (jduriez at BerliOS)
Date: Fri, 24 Oct 2008 10:47:46 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1553 - trunk/pkg/dem
Message-ID: <200810240847.m9O8lk1k028788@sheep.berlios.de>

Author: jduriez
Date: 2008-10-24 10:47:46 +0200 (Fri, 24 Oct 2008)
New Revision: 1553

Modified:
   trunk/pkg/dem/SConscript
Log:
(At last) The good Sconscript file


Modified: trunk/pkg/dem/SConscript
===================================================================
--- trunk/pkg/dem/SConscript	2008-10-23 17:39:31 UTC (rev 1552)
+++ trunk/pkg/dem/SConscript	2008-10-24 08:47:46 UTC (rev 1553)
@@ -485,11 +485,12 @@
 	env.SharedLibrary('SimpleShear',
 		['PreProcessor/SimpleShear.cpp'],
 		LIBS=env['LIBS']+['SDECLinkGeometry',
-			'BodyMacroParameters',
-			'ElasticContactLaw',
-			'MacroMicroElasticRelationships',
-			'SimpleElasticRelationships',
-			'ElasticCriterionTimeStepper',
+			'CohesiveFrictionalBodyParameters',
+			'ContactLaw1',
+			'CL1Relationships',
+			'GlobalStiffness',
+			'GlobalStiffnessCounter',
+			'GlobalStiffnessTimeStepper',
 			'PositionOrientationRecorder',
 			'PositionRecorder',
 			'PositionSnapshot',
@@ -500,8 +501,7 @@
 			'BodyRedirectionVector',
 			'InteractingSphere',
 			'InteractingBox',
-			'CundallNonViscousDamping',
-			'CundallNonViscousDamping',
+			'NewtonsDampedLaw',
 			'MetaInteractingGeometry',
 			'GravityEngines',
 			'CinemDNCEngine',


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From jduriez at mail.berlios.de  Fri Oct 24 11:09:38 2008
From: jduriez at mail.berlios.de (jduriez at BerliOS)
Date: Fri, 24 Oct 2008 11:09:38 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1554 -
	trunk/pkg/dem/PreProcessor
Message-ID: <200810240909.m9O99cwO031021@sheep.berlios.de>

Author: jduriez
Date: 2008-10-24 11:09:38 +0200 (Fri, 24 Oct 2008)
New Revision: 1554

Modified:
   trunk/pkg/dem/PreProcessor/SimpleShear.cpp
Log:
- The GlobalStifnessCounter engine (for correct use of GlobalStifnessTimeStepper) was forgotten in the preprocessor SimpleShear...


Modified: trunk/pkg/dem/PreProcessor/SimpleShear.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/SimpleShear.cpp	2008-10-24 08:47:46 UTC (rev 1553)
+++ trunk/pkg/dem/PreProcessor/SimpleShear.cpp	2008-10-24 09:09:38 UTC (rev 1554)
@@ -333,10 +333,16 @@
 	shared_ptr<GlobalStiffnessTimeStepper> globalStiffnessTimeStepper(new GlobalStiffnessTimeStepper);
 	globalStiffnessTimeStepper->sdecGroupMask = 1;
 	globalStiffnessTimeStepper->timeStepUpdateInterval = timeStepUpdateInterval;
+	globalStiffnessTimeStepper->defaultDt=1e-5;
 
+	shared_ptr<GlobalStiffnessCounter> globalStiffnessCounter(new GlobalStiffnessCounter);
+	globalStiffnessCounter->interval = timeStepUpdateInterval;
 
+
+
 	rootBody->engines.clear();
 	rootBody->engines.push_back(shared_ptr<Engine>(new PhysicalActionContainerReseter));
+	rootBody->engines.push_back(globalStiffnessCounter);
 	rootBody->engines.push_back(globalStiffnessTimeStepper);
 	rootBody->engines.push_back(boundingVolumeDispatcher);	
 	rootBody->engines.push_back(shared_ptr<Engine>(new PersistentSAPCollider));


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Fri Oct 24 21:57:01 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Fri, 24 Oct 2008 21:57:01 +0200
Subject: [deprecated list] [Yade-dev] drop .gz support in favor of .bz2
	only?
In-Reply-To: <490013F4.3080303@arcig.cz>
References: <490013F4.3080303@arcig.cz>
Message-ID: <20081024215701.20e69875@absurd>

V?clav ?milauer said:     (by the date of Thu, 23 Oct 2008 08:04:36 +0200)

> Hi, I am thinking of removing gzip support from loading/saving routines,
> since bzip2 has better compression ratio and having both in the code is
> not useful. Any objections? Vaclav

no objections, go ahead.

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Sat Oct 25 19:40:17 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Sat, 25 Oct 2008 19:40:17 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1557 - in trunk: core
	extra/clump gui/py lib	lib/serialization lib/smoothing
Message-ID: <200810251740.m9PHeH76006242@sheep.berlios.de>

Author: eudoxos
Date: 2008-10-25 19:40:16 +0200 (Sat, 25 Oct 2008)
New Revision: 1557

Added:
   trunk/lib/smoothing/
   trunk/lib/smoothing/WeightedAverage2d.cpp
   trunk/lib/smoothing/WeightedAverage2d.hpp
Modified:
   trunk/core/Omega.cpp
   trunk/extra/clump/Shop.cpp
   trunk/gui/py/_utils.cpp
   trunk/gui/py/yadeControl.cpp
   trunk/lib/SConscript
   trunk/lib/serialization/IOFormatManager.tpp
Log:
1. Add 2d weighted average smoothing abstract class and its specialization on symmetric gaussian kernel, with python glue of course.
2. Remove .gz support.
3. Fix some bugs in the spiral projection code.


Modified: trunk/core/Omega.cpp
===================================================================
--- trunk/core/Omega.cpp	2008-10-24 15:29:45 UTC (rev 1556)
+++ trunk/core/Omega.cpp	2008-10-25 17:40:16 UTC (rev 1557)
@@ -236,7 +236,7 @@
 		//boost::mutex::scoped_lock lock1(rootBody->persistentInteractions->drawloopmutex);
 		//boost::mutex::scoped_lock lock2(rootBody->transientInteractions->drawloopmutex);
 		
-		if(algorithm::ends_with(simulationFileName,".xml") || algorithm::ends_with(simulationFileName,".xml.gz") || algorithm::ends_with(simulationFileName,".xml.bz2")){
+		if(algorithm::ends_with(simulationFileName,".xml") || algorithm::ends_with(simulationFileName,".xml.bz2")){
 			resetRootBody();
 			IOFormatManager::loadFromFile("XMLFormatManager",simulationFileName,"rootBody",rootBody);
 		}
@@ -267,7 +267,7 @@
 	if(name.size()==0) throw yadeBadFile("Filename with zero length.");
 	LOG_INFO("Saving file " << name);
 
-	if(algorithm::ends_with(name,".xml") || algorithm::ends_with(name,".xml.gz") || algorithm::ends_with(name,".xml.bz2")){
+	if(algorithm::ends_with(name,".xml") || algorithm::ends_with(name,".xml.bz2")){
 		FormatChecker::format=FormatChecker::XML;
 		IOFormatManager::saveToFile("XMLFormatManager",name,"rootBody",rootBody);
 	}

Modified: trunk/extra/clump/Shop.cpp
===================================================================
--- trunk/extra/clump/Shop.cpp	2008-10-24 15:29:45 UTC (rev 1556)
+++ trunk/extra/clump/Shop.cpp	2008-10-25 17:40:16 UTC (rev 1557)
@@ -1163,8 +1163,9 @@
  * this number. The wrapped value is returned.
  */
 Real Shop::periodicWrap(Real x, Real x0, Real x1, long* period){
-	double xNorm=(x-x0)/(x1-x0);
-	double xxNorm=xNorm-floor(xNorm);
+	Real xNorm=(x-x0)/(x1-x0);
+	Real xxNorm=xNorm-floor(xNorm);
 	if(period) *period=(long)floor(xNorm);
 	return x0+xxNorm*(x1-x0);
 }
+

Modified: trunk/gui/py/_utils.cpp
===================================================================
--- trunk/gui/py/_utils.cpp	2008-10-24 15:29:45 UTC (rev 1556)
+++ trunk/gui/py/_utils.cpp	2008-10-25 17:40:16 UTC (rev 1557)
@@ -217,9 +217,9 @@
 	else theta=0;
 	Real hRef=dH_dTheta*(theta-theta0);
 	long period;
-	Real h=Shop::periodicWrap(pt[axis],hRef-Mathr::PI*dH_dTheta,hRef+Mathr::PI*dH_dTheta,&period);
-	cerr<<":"<<h-hRef<<" "<<h<<" "<<hRef<<" "<<" ("<<hRef-Mathr::PI*dH_dTheta<<","<<hRef+Mathr::PI*dH_dTheta<<") "<<theta<<" "<<endl;
-	return python::make_tuple(python::make_tuple(r,h-dH_dTheta*(theta-theta0+2*Mathr::PI*period)),theta);
+	Real h=Shop::periodicWrap(pt[axis],hRef-.5*Mathr::PI*dH_dTheta,hRef+.5*Mathr::PI*dH_dTheta,&period);
+	if(abs(h-hRef)>0.005) cerr<<"@@@ "<<h-hRef<<" "<<h<<" "<<hRef<<" "<<pt[axis]<<" ("<<hRef-.5*Mathr::PI*dH_dTheta<<","<<hRef+.5*Mathr::PI*dH_dTheta<<") "<<theta<<" "<<endl;
+	return python::make_tuple(python::make_tuple(r,h-hRef),theta);
 }
 BOOST_PYTHON_FUNCTION_OVERLOADS(spiralProject_overloads,spiralProject,2,4);
 

Modified: trunk/gui/py/yadeControl.cpp
===================================================================
--- trunk/gui/py/yadeControl.cpp	2008-10-24 15:29:45 UTC (rev 1556)
+++ trunk/gui/py/yadeControl.cpp	2008-10-25 17:40:16 UTC (rev 1557)
@@ -433,8 +433,19 @@
 	void reload(){	load(OMEGA.getSimulationFileName());}
 	void saveTmp(string mark){ save(":memory:"+mark);}
 	void loadTmp(string mark){ load(":memory:"+mark);}
+	void tmpToFile(string mark, string filename){
+		// FIXME: memSavedSimulations are private, but I don't want to recompile all yade now; move it to public and uncomment these few lines at some point
+		// if(OMEGA.memSavedSimulations.count(":memory:"+mark)==0) throw runtime_error("No memory-saved simulation named "+mark);
+		iostreams::filtering_ostream out;
+		if(boost::algorithm::ends_with(filename,".bz2")) out.push(iostreams::bzip2_compressor());
+		out.push(iostreams::file_sink(filename));
+		if(!out.good()) throw runtime_error("Error while opening file `"+filename+"' for writing.");
+		LOG_INFO("Saving :memory:"<<mark<<" to "<<filename);
+		//out<<OMEGA.memSavedSimulations[":memory:"+mark];
+	}
 
 
+
 	void reset(){Py_BEGIN_ALLOW_THREADS; OMEGA.reset(); Py_END_ALLOW_THREADS; }
 
 	void save(std::string fileName){
@@ -534,6 +545,7 @@
 		.def("save",&pyOmega::save)
 		.def("loadTmp",&pyOmega::loadTmp)
 		.def("saveTmp",&pyOmega::saveTmp)
+		.def("tmpToFile",&pyOmega::tmpToFile)
 		.def("saveSpheres",&pyOmega::saveSpheres)
 		.def("run",&pyOmega::run,omega_run_overloads())
 		.def("pause",&pyOmega::pause)

Modified: trunk/lib/SConscript
===================================================================
--- trunk/lib/SConscript	2008-10-24 15:29:45 UTC (rev 1556)
+++ trunk/lib/SConscript	2008-10-25 17:40:16 UTC (rev 1557)
@@ -1,6 +1,11 @@
 # vim: set filetype=python :
 Import('*')
 
+if 'EMBED_PYTHON' in env['CPPDEFINES']:
+	env.Install('$PREFIX/lib/yade$SUFFIX/gui/yade',[
+		env.SharedLibrary('WeightedAverage2d',['smoothing/WeightedAverage2d.cpp'],SHLIBPREFIX='',
+		LIBS=env['LIBS']+['yade-base'])
+	])
 
 
 if 'qt3' not in env['exclude']:

Modified: trunk/lib/serialization/IOFormatManager.tpp
===================================================================
--- trunk/lib/serialization/IOFormatManager.tpp	2008-10-24 15:29:45 UTC (rev 1556)
+++ trunk/lib/serialization/IOFormatManager.tpp	2008-10-25 17:40:16 UTC (rev 1557)
@@ -17,7 +17,6 @@
 #include "IOManagerExceptions.hpp"
 #include<boost/scoped_ptr.hpp>
 #include<boost/iostreams/filtering_stream.hpp>
-#include<boost/iostreams/filter/gzip.hpp>
 #include<boost/iostreams/filter/bzip2.hpp>
 #include<boost/iostreams/device/file.hpp>
 #include<boost/algorithm/string.hpp>
@@ -45,8 +44,7 @@
 template<typename Type>
 void IOFormatManager::loadFromFile(const string& libName, const string& fileName,const string& name, Type& t){
 	iostreams::filtering_istream in;
-	if(boost::algorithm::ends_with(fileName,".gz")) in.push(iostreams::gzip_decompressor());
-	else if(boost::algorithm::ends_with(fileName,".bz2")) in.push(iostreams::bzip2_decompressor());
+	if(boost::algorithm::ends_with(fileName,".bz2")) in.push(iostreams::bzip2_decompressor());
 	in.push(iostreams::file_source(fileName));
 	if(!in.good()) throw SerializableError(IOManagerExceptions::FileNotGood);
 
@@ -57,8 +55,7 @@
 template<typename Type>
 void IOFormatManager::saveToFile(const string& libName, const string& fileName,const string& name, Type& t){
 	iostreams::filtering_ostream out;
-	if(boost::algorithm::ends_with(fileName,".gz")) out.push(iostreams::gzip_compressor());
-	else if(boost::algorithm::ends_with(fileName,".bz2")) out.push(iostreams::bzip2_compressor());
+	if(boost::algorithm::ends_with(fileName,".bz2")) out.push(iostreams::bzip2_compressor());
 	out.push(iostreams::file_sink(fileName));
 	if(!out.good()) throw SerializableError(IOManagerExceptions::FileNotGood);
 	saveToStream(libName,out,name,t);

Added: trunk/lib/smoothing/WeightedAverage2d.cpp
===================================================================
--- trunk/lib/smoothing/WeightedAverage2d.cpp	2008-10-24 15:29:45 UTC (rev 1556)
+++ trunk/lib/smoothing/WeightedAverage2d.cpp	2008-10-25 17:40:16 UTC (rev 1557)
@@ -0,0 +1,12 @@
+#include"WeightedAverage2d.hpp"
+
+BOOST_PYTHON_MODULE(WeightedAverage2d)
+{
+	boost::python::class_<pyGaussAverage>("GaussAverage",python::init<python::tuple,python::tuple,python::tuple,Real>())
+		.def("add",&pyGaussAverage::addPt)
+		.def("avg",&pyGaussAverage::avg)
+		.add_property("stDev",&pyGaussAverage::stDev_get,&pyGaussAverage::stDev_set)
+		.add_property("relThreshold",&pyGaussAverage::relThreshold_get,&pyGaussAverage::relThreshold_set)
+	;
+};
+

Added: trunk/lib/smoothing/WeightedAverage2d.hpp
===================================================================
--- trunk/lib/smoothing/WeightedAverage2d.hpp	2008-10-24 15:29:45 UTC (rev 1556)
+++ trunk/lib/smoothing/WeightedAverage2d.hpp	2008-10-25 17:40:16 UTC (rev 1557)
@@ -0,0 +1,166 @@
+// ? 2008 V?clav ?milauer <eudoxos at arcig.cz>
+
+#pragma once
+
+#include<iostream>
+#include<vector>
+#include<cstdlib>
+#include<algorithm>
+#include<cassert>
+#include<cmath>
+#include<stdexcept>
+#include<boost/foreach.hpp>
+#include<boost/lexical_cast.hpp>
+#include<boost/python.hpp>
+
+#define FOREACH BOOST_FOREACH
+using namespace std;
+using namespace boost;
+
+#include<yade/lib-base/yadeWm3.hpp>
+#include<Wm3Vector2.h>
+typedef Wm3::Vector2<int> Vector2i;
+
+
+template<typename T>
+struct GridContainer{
+	private:
+		Vector2r lo, hi;
+		Vector2r cellSizes;
+		Vector2i nCells;
+	public:
+		vector<vector<vector<T> > > grid;
+	/* construct grid from lower left corner, upper right corner and number of cells in each direction */
+	GridContainer(Vector2r _lo, Vector2r _hi, Vector2i _nCells): lo(_lo), hi(_hi), nCells(_nCells){
+		cellSizes=Vector2r((hi[0]-lo[0])/nCells[0],(hi[1]-lo[1])/nCells[1]);
+		grid.resize(nCells[0]); for(int i=0; i<nCells[0]; i++) grid[i].resize(nCells[1]);
+	}
+	/* turn spatial coordinates into cell coordinates; if inGrid is not given, out-of-grid throws; otherwise, it sets inGrid=false. */
+	Vector2i xy2cell(Vector2r xy, bool* inGrid=NULL) const {
+		Vector2i ret((int)(floor((xy[0]-lo[0])/cellSizes[0])),(int)(floor((xy[1]-lo[1])/cellSizes[1])));
+		if(ret[0]<0 || ret[0]>=nCells[0] || ret[1]<0 || ret[1]>=nCells[1]){
+			if(inGrid) *inGrid=false; else throw std::invalid_argument("Cell coordinates outside grid (xy="+lexical_cast<string>(xy[0])+","+lexical_cast<string>(xy[1])+", computed cell coordinates "+lexical_cast<string>(ret[0])+","+lexical_cast<string>(ret[1])+").");
+		} else {if(inGrid) *inGrid=true;}
+		return ret;
+	}
+	Vector2r cell2xyMid(Vector2i cxy) const { return Vector2r(lo[0]+cellSizes[0]*(.5+cxy[0]),lo[1]+cellSizes[1]*(.5+cxy[1])); }
+
+	// add new element to the right cell
+	void add(const T& t, Vector2r xy){Vector2i cxy=xy2cell(xy); grid[cxy[0]][cxy[1]].push_back(t);}
+
+	/* Filters: return list of cells, based on some spatial criterion: rectangle, ellipse, circle (add more if you need that) */
+	vector<Vector2i> rectangleFilter(Vector2r bbLo, Vector2r bbHi) const {
+		vector<Vector2i> ret; bool dummy; Vector2i cxymin=xy2cell(bbLo,&dummy), cxymax=xy2cell(bbHi,&dummy);
+		for(int cx=cxymin[0]; cx<=cxymax[0]; cx++){ for(int cy=cxymin[1]; cy<=cxymax[1]; cy++){ if(cx>=0 && cx<nCells[0] && cy>=0 && cy<nCells[1]) ret.push_back(Vector2i(cx,cy));	} }
+		return ret;
+	}
+	vector<Vector2i> circleFilter(Vector2r xy, Real radius) const { return ellipseFilter(xy,Vector2r(radius,radius));}
+	vector<Vector2i> ellipseFilter(Vector2r xy0, Vector2r radii) const {
+		vector<Vector2i> rectangle=rectangleFilter(Vector2r(xy0[0]-radii[0],xy0[1]-radii[1]),Vector2r(xy0[0]+radii[0],xy0[1]+radii[1]));
+		vector<Vector2i> ret; bool inGrid;
+		Vector2i cxy=xy2cell(xy0,&inGrid);
+		FOREACH(Vector2i mid, rectangle){
+			// if we are in the cell where the middle is also, this cell passes the filter
+			if(inGrid && mid[0]==cxy[0] && mid[1]==cxy[1]){ret.push_back(mid); continue;}
+			Vector2r xyMid=cell2xyMid(mid);
+			Vector2r xy(xyMid[0]-xy0[0],xyMid[1]-xy0[1]); // relative mid-cell coords
+			// tricky: move the mid-cell to the corner (or aligned pt on edge) according to position WRT center
+			if(mid[0]!=cxy[0]) xy.X()+=(mid[0]<cxy[0]?1:-1)*.5*cellSizes[0]; else xy.X()=0;
+			if(mid[1]!=cxy[1]) xy.X()+=(mid[1]<cxy[1]?1:-1)*.5*cellSizes[1]; else xy.Y()=0;
+			// are we inside the ellipse? pass the filter, then
+			if((pow(xy[0],2)/pow(radii[0],2)+pow(xy[1],2)/pow(radii[1],2))<=1) ret.push_back(mid);
+		}
+		return ret;
+	}
+
+	// graphical representation of a set of filtered cells
+	string dumpGrid(vector<Vector2i> v){
+		vector<vector<bool> > vvb; string ret; vvb.resize(nCells[0]); for(size_t i=0; i<(size_t)nCells[0]; i++) vvb[i].resize(nCells[1],false); FOREACH(Vector2i& vv, v) vvb[vv[0]][vv[1]]=true;
+		for(int cy=nCells[1]-1; cy>=0; cy--){ ret+="|"; for(int cx=0; cx<nCells[0]; cx++){ ret+=vvb[cx][cy]?"@":"."; }	ret+="|\n";	}
+		return ret;
+	}
+};
+/* Abstract class for averages templated by elements stored in the grid and by the type of average value.
+ *
+ * To define your own class, you need to override getPosition (returns exact position of an element),
+ * getWeight (return weight associated with given point and element -- may be 0, but should not be negative),
+ * getValue (for an element),and filterCells (returns vector of cells of which elements will be used in computation).
+ *
+ * computeAverage computes weighted average using the overridden methods.
+ */
+template<typename T, typename Tvalue>
+struct WeightedAverage{
+	const shared_ptr<GridContainer<T> > grid;
+	WeightedAverage(const shared_ptr<GridContainer<T> >& _grid):grid(_grid){};
+	virtual Vector2r getPosition(const T&)=0;
+	virtual Real getWeight(const Vector2r& refPt, const T&)=0;
+	virtual Tvalue getValue(const T&)=0;
+	virtual vector<Vector2i> filterCells(const Vector2r& refPt)=0;
+	Tvalue computeAverage(const Vector2r& refPt){
+		vector<Vector2i> filtered=filterCells(refPt);
+		Real sumValues=0, sumWeights=0;
+		FOREACH(Vector2i cell, filtered){
+			FOREACH(const T& element, grid->grid[cell[0]][cell[1]]){
+				Real weight=getWeight(refPt,element);
+				sumValues+=weight*getValue(element); sumWeights+=weight;
+			}
+		}
+		return sumValues/sumWeights;
+	}
+};
+
+/* Compute nonlocal average with isotropic Gaussian kernel.
+ *
+ */
+template<typename T, typename Tvalue>
+struct SymmGaussianKernelAverage: public WeightedAverage<T,Tvalue> {
+	Real stDev, relThreshold;
+	SymmGaussianKernelAverage(const shared_ptr<GridContainer<T> >& _grid, Real _stDev, Real _relThreshold=3): WeightedAverage<T,Tvalue>(_grid), stDev(_stDev), relThreshold(_relThreshold){}
+	virtual Real getWeight(const Vector2r& meanPt, const T& e){	
+		Vector2r pos=getPosition(e);
+		Real rSq=pow(meanPt[0]-pos[0],2)+pow(meanPt[1]-pos[1],2);
+		if(rSq>relThreshold*stDev) return 0.;
+		return (1./sqrt(2*M_PI*stDev))*exp(-rSq/(2*stDev));
+	}
+	virtual vector<Vector2i> filterCells(const Vector2r& refPt){return WeightedAverage<T,Tvalue>::grid->circleFilter(refPt,stDev*relThreshold);}
+};
+
+/* Class for doing template specialization of gaussian kernel average  on SGKA_dataPt and for testing */
+struct dataPt{
+	Vector2r pos;
+	int val;
+};
+
+/* Final specialization; it only needs to define getValue and getPosition -- these functions contain knowledge about the element class itself */
+struct SGKA_dataPt: public SymmGaussianKernelAverage<dataPt,Real>{
+	SGKA_dataPt(const shared_ptr<GridContainer<dataPt> >& _grid, Real _stDev, Real _relThreshold=3): SymmGaussianKernelAverage<dataPt,Real>(_grid,_stDev,_relThreshold){}
+	virtual Real getValue(const dataPt& dp){return (Real)dp.val;}
+	virtual Vector2r getPosition(const dataPt& dp){return dp.pos;}
+};
+
+/* simplified interface for python:
+ * 
+ * ga=GaussAverage((0,0),(100,100),(10,10),5)
+ * ga.add(53.444,(15.6,43.0))
+ * ...
+ * ga.avg((10,10))
+ * ...
+ *
+ * */
+class pyGaussAverage{
+	//struct dataPt{Vector2r pos; Real val;};
+	Vector2r tuple2vec2r(const python::tuple& t){return Vector2r(python::extract<Real>(t[0])(),python::extract<Real>(t[1])());}
+	Vector2i tuple2vec2i(const python::tuple& t){return Vector2i(python::extract<int>(t[0])(),python::extract<int>(t[1])());}
+	shared_ptr<SGKA_dataPt> sgka;
+	public:
+	pyGaussAverage(python::tuple lo, python::tuple hi, python::tuple nCells, Real stDev){
+		shared_ptr<GridContainer<dataPt> > g(new GridContainer<dataPt>(tuple2vec2r(lo),tuple2vec2r(hi),tuple2vec2i(nCells)));
+		sgka=shared_ptr<SGKA_dataPt>(new SGKA_dataPt(g,stDev));
+	}
+	void addPt(Real val, python::tuple pos){dataPt d; d.pos=tuple2vec2r(pos); d.val=val; sgka->grid->add(d,d.pos); }
+	Real avg(python::tuple pt){return sgka->computeAverage(tuple2vec2r(pt));}
+
+	Real stDev_get(){return sgka->stDev;} void stDev_set(Real s){sgka->stDev=s;}
+	Real relThreshold_get(){return sgka->relThreshold;} void relThreshold_set(Real rt){sgka->relThreshold=rt;}
+};
+


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at mail.berlios.de  Sat Oct 25 21:03:18 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Sat, 25 Oct 2008 21:03:18 +0200
Subject: [deprecated list] [Yade-dev] [svn] r1558 - in trunk/pkg/dem: .
	Engine/StandAloneEngine
Message-ID: <200810251903.m9PJ3Ihw013319@sheep.berlios.de>

Author: eudoxos
Date: 2008-10-25 21:03:17 +0200 (Sat, 25 Oct 2008)
New Revision: 1558

Modified:
   trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.cpp
   trunk/pkg/dem/SConscript
Log:
1. Fix errors preventing compilation due to missing TesselationWrapper.


Modified: trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.cpp	2008-10-25 17:40:16 UTC (rev 1557)
+++ trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.cpp	2008-10-25 19:03:17 UTC (rev 1558)
@@ -22,14 +22,8 @@
 
 #include "VolumicContactLaw.hpp"
 
-// <<<<<<< .mine
-// 	#include</home/jf/YADE/trunk/lib/miniWm3/Wm3Math.h>#include <cmath>
-     #include "/home/jf/YADE/trunk-clean/extra/triangulation/TesselationWrapper.h"
+#include<yade/extra/TesselationWrapper.h>
 
-// =======
-//      #include "TesselationWrapper.h"
-// >>>>>>> .r1327
-
  
 
 VolumicContactLaw::VolumicContactLaw() : InteractionSolver() , actionForce(new Force) , actionMomentum(new Momentum)

Modified: trunk/pkg/dem/SConscript
===================================================================
--- trunk/pkg/dem/SConscript	2008-10-25 17:40:16 UTC (rev 1557)
+++ trunk/pkg/dem/SConscript	2008-10-25 19:03:17 UTC (rev 1558)
@@ -1,5 +1,32 @@
 # vim: set filetype=python :
 Import('*')
+
+import os.path,os
+#  Dir('#') expands to the root of the source tree -- that is done by scons
+if os.path.exists(Dir('#').abspath+'/extra/triangulation/libTesselationWrapper.a'):
+	print "Will build VolumetricContactLaw since libTesselationWrapper.a was found."
+	env.Install('$PREFIX/lib/yade$SUFFIX/pkg-dem',[
+		env.SharedLibrary('VolumicContactLaw',
+			['Engine/StandAloneEngine/VolumicContactLaw.cpp'],
+			LIBPATH=env['LIBPATH']+['../extra/triangulation'],
+			LIBS=env['LIBS']+['SDECLinkPhysics',
+				'ElasticContactInteraction',
+				'SDECLinkGeometry',
+				'SpheresContactGeometry',
+				'BodyMacroParameters',
+				'yade-serialization',
+				'yade-base',
+				'GLDrawInteractingSphere',
+				'yade-multimethods',
+				'Force',
+				'Momentum',
+				'Sphere',
+				'RigidBodyParameters',
+				'InteractingSphere',
+				'TesselationWrapper',
+				'CGAL'])
+		])
+
 env.Install('$PREFIX/lib/yade$SUFFIX/pkg-dem',[
 
 	env.SharedLibrary('SQLiteRecorder',
@@ -188,28 +215,7 @@
 			'Momentum',
 			'Sphere',
 			'RigidBodyParameters']),
-			
-   
-			
-	env.SharedLibrary('VolumicContactLaw',
-		['Engine/StandAloneEngine/VolumicContactLaw.cpp'],
-		#LIBPATH=env['LIBPATH']+['/home/jf/YADE/trunk-clean/extra/triangulation'],
-		LIBS=env['LIBS']+['SDECLinkPhysics',
-			'ElasticContactInteraction',
-			'SDECLinkGeometry',
-			'SpheresContactGeometry',
-			'BodyMacroParameters',
-			'yade-serialization',
-			'yade-base',
-			'GLDrawInteractingSphere',
-			'yade-multimethods',
-			'Force',
-			'Momentum',
-			'Sphere',
-			'RigidBodyParameters',
-			'InteractingSphere',
-			'TesselationWrapper',
-			'CGAL']),
+	
 
 	env.SharedLibrary('CohesiveFrictionalContactLaw',
 		['Engine/StandAloneEngine/CohesiveFrictionalContactLaw.cpp'],


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Sat Oct 25 21:04:39 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Sat, 25 Oct 2008 21:04:39 +0200
Subject: [deprecated list] [Yade-dev] trunk doesn't compile
	(TesselationWrapper)
Message-ID: <49036DC7.2040708@arcig.cz>

It seems that Jean-Fran?ois commited broken code, including some
conflicts that svn marks with >>>>>>>> etc in the code. Please always
make sure that your code compiles before commiting.

I added conditional compilation of VolumicContactLaw, so that it is
compiled only in case the file
extra/triangulation/libTesselationWrapper.a exists. Otherwise, linking
would fail. It is at the beginning of pkg/dem/SConscript, kif you need
to change that.

I commited both fixes, so it compiles at least for those who don't have
TesselationWrapper.

Regards, Vaclav

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From jerier at geo.hmg.inpg.fr  Sat Oct 25 23:32:20 2008
From: jerier at geo.hmg.inpg.fr (jerier at geo.hmg.inpg.fr)
Date: Sat, 25 Oct 2008 17:32:20 -0400
Subject: [deprecated list] [Yade-dev] trunk doesn't compile
	(TesselationWrapper)
Message-ID: <380-2200810625213220790@M2W027.mail2web.com>


Hello Vaclav,

 Sorry for the mistakes are generated by my post. Thank you for your
corrections. 

I thought that the libTesselationWrapper.a file was integrated within the
Yade version in the extra file !!!???

Concerning the mark >>>>>>>> etc in the code, i didn't receive by the Yade
mail list my commit. I don't know why ? but if you have the files, can you
send me them because in my files (TriaxialTest.cpp,
TriaxialCompressionEngine.cpp, ...), i have not these marks.

I must understand what happen. 

Thank again for all these informations. Now, i will exclude in my commit
the files concerning the VolumicContactLaw. 

JF



Original Message:
-----------------
From: V?clav ?milauer eudoxos at arcig.cz
Date: Sat, 25 Oct 2008 21:04:39 +0200
To: yade-dev at lists.launchpad.net
Subject: [Yade-dev] trunk doesn't compile (TesselationWrapper)


It seems that Jean-Fran?ois commited broken code, including some
conflicts that svn marks with >>>>>>>> etc in the code. Please always
make sure that your code compiles before commiting.

I added conditional compilation of VolumicContactLaw, so that it is
compiled only in case the file
extra/triangulation/libTesselationWrapper.a exists. Otherwise, linking
would fail. It is at the beginning of pkg/dem/SConscript, kif you need
to change that.

I commited both fixes, so it compiles at least for those who don't have
TesselationWrapper.

Regards, Vaclav

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp










--------------------------------------------------------------------
myhosting.com - Premium Microsoft? Windows? and Linux web and application
hosting - http://link.myhosting.com/myhosting



_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Sun Oct 26 00:10:37 2008
From: eudoxos at arcig.cz (eudoxos at arcig.cz)
Date: Sun, 26 Oct 2008 00:10:37 +0200 (CEST)
Subject: [deprecated list] [Yade-dev] Automated crash report
	for	/tmp/yade-26020/bin/yade-svn1558:	DirectShearCis, FEMBeam,
	HydraulicTest, SDECImpactTest, STLImporterTest, SimpleShear,
	TriaxialTest, USCTGen
Message-ID: <20081025221037.250529806A@delta>

################################################################################
DirectShearCis: generator CRASH
################################################################################
Python TCP server listening on localhost:9002, auth cookie is `sdyeks'
Running script /tmp/yade-test-29105.py
Cannot find input file
Traceback (most recent call last):
  File "/tmp/yade-26020/lib/yade-svn1558/gui/PythonUI_rc.py", line 37, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-29105.py", line 3, in <module>
    Preprocessor('DirectShearCis').generate('/tmp/yade-test-29105.xml')
RuntimeError: Generator reported error: Cannot find input file

################################################################################
FEMBeam: generator CRASH
################################################################################
Python TCP server listening on localhost:9002, auth cookie is `aeucsk'
Running script /tmp/yade-test-29105.py
/tmp/yade-26020/build-svn1558/include/yade-svn1558/yade/core/MetaEngine1D.hpp:57 WARNING! dynamic cast of engine unit FEMTetrahedronStiffness failed, will use static_cast. Go figure why.
/tmp/yade-26020/build-svn1558/include/yade-svn1558/yade/core/MetaEngine2D.hpp:61 WARNING! dynamic cast of engine unit FEMSet2Tetrahedrons failed, will use static_cast. Go figure why.
Traceback (most recent call last):
  File "/tmp/yade-26020/lib/yade-svn1558/gui/PythonUI_rc.py", line 37, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-29105.py", line 3, in <module>
    Preprocessor('FEMBeam').generate('/tmp/yade-test-29105.xml')
RuntimeError: Generator reported error: Cannot find input file, you can copy it from examples/ directory

################################################################################
HydraulicTest: generator CRASH
################################################################################
Traceback (most recent call last):
  File "/tmp/yade-26020/lib/yade-svn1558/gui/PythonUI_rc.py", line 37, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-29105.py", line 3, in <module>
    Preprocessor('HydraulicTest').generate('/tmp/yade-test-29105.xml')
RuntimeError: Generator reported error: Error: cannot load the file that should contain spheres
Python TCP server listening on localhost:9002, auth cookie is `asueyc'
Running script /tmp/yade-test-29105.py

################################################################################
SDECImpactTest: generator CRASH
################################################################################
Traceback (most recent call last):
  File "/tmp/yade-26020/lib/yade-svn1558/gui/PythonUI_rc.py", line 37, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-29105.py", line 3, in <module>
    Preprocessor('SDECImpactTest').generate('/tmp/yade-test-29105.xml')
RuntimeError: Generator reported error: Cannot find input file, you can copy it from examples/ directory
Python TCP server listening on localhost:9002, auth cookie is `yedcks'
Running script /tmp/yade-test-29105.py

################################################################################
STLImporterTest: generator CRASH
################################################################################
Python TCP server listening on localhost:9002, auth cookie is `duessy'
Running script /tmp/yade-test-29105.py
Import walls geometry from file: hourglass.stl
730 [140538818066224] ERROR yade.STLImporter  - lib/import/STLImporter.cpp:27 open: Can't open file: hourglass.stl
ERROR: Bad file: hourglass.stl
Traceback (most recent call last):
  File "/tmp/yade-26020/lib/yade-svn1558/gui/PythonUI_rc.py", line 37, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-29105.py", line 3, in <module>
    Preprocessor('STLImporterTest').generate('/tmp/yade-test-29105.xml')
RuntimeError: Generator reported error: Input file not found, you can copy it from examples/ directory or make one using blender 3D modelling

################################################################################
SimpleShear: generator CRASH
################################################################################
Python TCP server listening on localhost:9002, auth cookie is `ksucsa'
Running script /tmp/yade-test-29105.py
Cannot find input file
Traceback (most recent call last):
  File "/tmp/yade-26020/lib/yade-svn1558/gui/PythonUI_rc.py", line 37, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-29105.py", line 3, in <module>
    Preprocessor('SimpleShear').generate('/tmp/yade-test-29105.xml')
RuntimeError: Generator reported error: Cannot find input file

################################################################################
TriaxialTest: generator CRASH
################################################################################
Python TCP server listening on localhost:9002, auth cookie is `cakusy'
Running script /tmp/yade-test-29105.py
617 [139767962916656] FATAL yade.FileGenerator  - core/FileGenerator.cpp:71 generateAndSave: Unhandled exception: St16invalid_argument : File with spheres `../../YADE/trunk-clean/examples/sphere16bidisperse.txt' doesn't exist.
Traceback (most recent call last):
  File "/tmp/yade-26020/lib/yade-svn1558/gui/PythonUI_rc.py", line 37, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-29105.py", line 3, in <module>
    Preprocessor('TriaxialTest').generate('/tmp/yade-test-29105.xml')
RuntimeError: Generator reported error: Unhandled exception: St16invalid_argument : File with spheres `../../YADE/trunk-clean/examples/sphere16bidisperse.txt' doesn't exist.

################################################################################
USCTGen: simulation CRASH
################################################################################
yade-svn1558: extra/Brefcom.cpp:155: virtual void BrefcomLaw::action(MetaBody*): Assertion `contGeom->hasShear' failed.
Python TCP server listening on localhost:9002, auth cookie is `uedcsa'
Running script /tmp/yade-test-29105.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1558/gdb_crash_batch-pid29267'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0x7f302b2b2730 (LWP 29267)]
[New Thread 0x40df9950 (LWP 29269)]
[New Thread 0x426b5950 (LWP 29268)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 0000000000000120
0x00007f302ab58e81 in nanosleep () from /lib/libpthread.so.0
No symbol "info" in current context.

Thread 3 (Thread 0x426b5950 (LWP 29268)):
#0  0x00007f302ab587fb in accept () from /lib/libpthread.so.0
#1  0x00007f2ffc8b5947 in ?? () from /usr/lib/python2.5/lib-dynload/_socket.so
#2  0x00007f302ae1eb57 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#3  0x00007f302ae1f893 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#4  0x00007f302ae1f893 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#5  0x00007f302ae1f893 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#6  0x00007f302ae20a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#7  0x00007f302adc070a in ?? () from /usr/lib/libpython2.5.so.1.0
#8  0x00007f302ad9ef23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#9  0x00007f302ada665f in ?? () from /usr/lib/libpython2.5.so.1.0
#10 0x00007f302ad9ef23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007f302ae19a1e in PyEval_CallObjectWithKeywords () from /usr/lib/libpython2.5.so.1.0
#12 0x00007f302ae4eeed in ?? () from /usr/lib/libpython2.5.so.1.0
#13 0x00007f302ab513f7 in start_thread () from /lib/libpthread.so.0
#14 0x00007f3026f85b3d in clone () from /lib/libc.so.6
#15 0x0000000000000000 in ?? ()

Thread 2 (Thread 0x40df9950 (LWP 29269)):
#0  0x00007f3026f4b4df in waitpid () from /lib/libc.so.6
#1  0x00007f3026eec461 in ?? () from /lib/libc.so.6
#2  0x00007f3026eec7e7 in system () from /lib/libc.so.6
#3  0x0000000000577b3d in sigHandler (sig=6) at core/yade.cpp:60
#4  <signal handler called>
#5  0x00007f3026ee0095 in raise () from /lib/libc.so.6
#6  0x00007f3026ee1af0 in abort () from /lib/libc.so.6
#7  0x00007f3026ed92df in __assert_fail () from /lib/libc.so.6
#8  0x00007f301977dc9f in BrefcomLaw::action (this=0x7f2ff4007340, _rootBody=0x7f2ff40055f0) at extra/Brefcom.cpp:155
#9  0x000000000051aabf in MetaBody::moveToNextTimeStep (this=0x7f2ff40055f0) at core/MetaBody.cpp:95
#10 0x000000000056ea8b in SimulationFlow::singleAction (this=0x819c10) at core/SimulationFlow.cpp:18
#11 0x00000000005709df in ThreadWorker::callSingleAction (this=0x819c10) at core/ThreadWorker.cpp:71
#12 0x00000000005701d2 in ThreadRunner::call (this=0x7f2ff40058d0) at core/ThreadRunner.cpp:44
#13 0x0000000000570238 in ThreadRunner::run (this=0x7f2ff40058d0) at core/ThreadRunner.cpp:23
#14 0x00000000005706b0 in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x40df90c8, p=0x7f2ff40058d0) at /usr/include/boost/bind/mem_fn_template.hpp:49
#15 0x000000000057071d in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x40df90d8, f=@0x40df90c8, a=@0x40df902f) at /usr/include/boost/bind.hpp:231
#16 0x000000000057075a in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x40df90c8) at /usr/include/boost/bind/bind_template.hpp:20
#17 0x0000000000570779 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x40df90c8) at /usr/include/boost/function/function_template.hpp:155
#18 0x00007f302a4f2537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#19 0x00007f302a4f21a2 in ?? () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#20 0x00007f302ab513f7 in start_thread () from /lib/libpthread.so.0
#21 0x00007f3026f85b3d in clone () from /lib/libc.so.6
#22 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7f302b2b2730 (LWP 29267)):
#0  0x00007f302ab58e81 in nanosleep () from /lib/libpthread.so.0
#1  0x00007f2ffd0c4995 in pyOmega::wait (this=0x7f2ff4000a50) at gui/py/yadeControl.cpp:424
#2  0x00007f2ffcfb6761 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0xa539a8, tc=@0x7fff332f3260) at /usr/include/boost/python/detail/invoke.hpp:94
#3  0x00007f2ffd05bb74 in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0xa539a8, args_=0xadc990) at /usr/include/boost/python/detail/caller.hpp:199
#4  0x00007f2ffd05bbc7 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0xa539a0, args=0xadc990, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#5  0x00007f302886fabe in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#6  0x00007f302886fde8 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#7  0x00007f302a4f2537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#8  0x00007f30288779f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#9  0x00007f302886d127 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#10 0x00007f302ad9ef23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007f302ae1cbb0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#12 0x00007f302ae20a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#13 0x00007f302ae20ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#14 0x00007f302ae43da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#15 0x00007f302ae188d6 in ?? () from /usr/lib/libpython2.5.so.1.0
#16 0x00007f302ae1f940 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0x00007f302ae20a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0x00007f302ae20ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#19 0x00007f302ae43da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#20 0x00007f302ae4403b in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#21 0x00007f3017892fe6 in PythonUI::execScript (script={static npos = 18446744073709551615, _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7fff332f42a0 "??\201"}}) at gui/py/PythonUI.cpp:44
#22 0x00007f301789430b in PythonUI::pythonSession () at gui/py/PythonUI.cpp:96
#23 0x00007f30178952c9 in PythonUI::run (this=0x81a6e0, argc=4, argv=0x7fff332f4fc0) at gui/py/PythonUI.cpp:128
#24 0x000000000057749e in main (argc=4, argv=0x7fff332f4fc0) at core/yade.cpp:253
#0  0x00007f302ab58e81 in nanosleep () from /lib/libpthread.so.0

-------------- next part --------------
_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at mail.berlios.de  Sun Oct 26 22:47:45 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Sun, 26 Oct 2008 22:47:45 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1559 - in trunk: . gui/py
	lib/smoothing
Message-ID: <200810262147.m9QLljLH022453@sheep.berlios.de>

Author: eudoxos
Date: 2008-10-26 22:47:44 +0100 (Sun, 26 Oct 2008)
New Revision: 1559

Modified:
   trunk/SConstruct
   trunk/gui/py/_utils.cpp
   trunk/lib/smoothing/WeightedAverage2d.cpp
   trunk/lib/smoothing/WeightedAverage2d.hpp
Log:
!! IMPORTANT !! Introduced new dependency on "python-numpy" package
(numpy/ndarrayobject.h header), which is now checked for by scons.
Tell me if this is not OK!

1. Fix many things in the weighted average smoother, add polygon clipping.
2. Add utils.pointInsidePolygon to rapidly compue what it says; this is what
needs numpy.




Modified: trunk/SConstruct
===================================================================
--- trunk/SConstruct	2008-10-25 19:03:17 UTC (rev 1558)
+++ trunk/SConstruct	2008-10-26 21:47:44 UTC (rev 1559)
@@ -324,9 +324,10 @@
 		if not ok: featureNotOK('log4cxx')
 		env.Append(CPPDEFINES=['LOG4CXX'])
 	if 'python' in env['features']:
-		ok=(conf.CheckPython() and conf.CheckIPython() # not needed now: and conf.CheckScientificPython()
-			and (conf.CheckLibWithHeader('boost_python-mt','boost/python.hpp','c++','boost::python::scope();',autoadd=1)
-				or conf.CheckLibWithHeader('boost_python','boost/python.hpp','c++','boost::python::scope();',autoadd=1)))
+		ok=(conf.CheckPython()
+			and conf.CheckIPython() # not needed now: and conf.CheckScientificPython()
+			and CheckLib_maybeMT(conf,'boost_python','boost/python.hpp','c++','boost::python::scope();')
+			and conf.CheckCXXHeader(['Python.h','numpy/ndarrayobject.h'],'<>'))
 		if not ok: featureNotOK('python')
 		env.Append(CPPDEFINES=['EMBED_PYTHON'])
 	if env['useMiniWm3']: env.Append(LIBS='miniWm3',CPPDEFINES=['MINIWM3'])

Modified: trunk/gui/py/_utils.cpp
===================================================================
--- trunk/gui/py/_utils.cpp	2008-10-25 19:03:17 UTC (rev 1558)
+++ trunk/gui/py/_utils.cpp	2008-10-26 21:47:44 UTC (rev 1559)
@@ -6,6 +6,11 @@
 #include<yade/pkg-dem/SpheresContactGeometry.hpp>
 #include<yade/pkg-common/NormalShearInteractions.hpp>
 #include<cmath>
+
+#include<numpy/ndarrayobject.h>
+
+
+
 using namespace boost::python;
 
 #ifdef LOG4CXX
@@ -199,6 +204,39 @@
 	return ret;
 }
 
+/* Tell us whether a point lies in polygon given by array of points.
+ *  @param xy is the point that is being tested
+ *  @param vertices is Numeric.array (or list or tuple) of vertices of the polygon.
+ *         Every row of the array is x and y coordinate, numer of rows is >= 3 (triangle).
+ *
+ * Copying the algorithm from http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html
+ * is gratefully acknowledged:
+ *
+ * License to Use:
+ * Copyright (c) 1970-2003, Wm. Randolph Franklin
+ * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
+ *   1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimers.
+ *   2. Redistributions in binary form must reproduce the above copyright notice in the documentation and/or other materials provided with the distribution.
+ *   3. The name of W. Randolph Franklin may not be used to endorse or promote products derived from this Software without specific prior written permission. 
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ *
+ * http://numpy.scipy.org/numpydoc/numpy-13.html told me how to use Numeric.array from c
+ */
+bool pointInsidePolygon(python::tuple xy, python::object vertices){
+	Real testx=python::extract<double>(xy[0])(),testy=python::extract<double>(xy[1])();
+	char** vertData; int rows, cols; PyArrayObject* vert=(PyArrayObject*)vertices.ptr();
+	int result=PyArray_As2D((PyObject**)&vert /* is replaced */ ,&vertData,&rows,&cols,PyArray_DOUBLE);
+	if(result!=0) throw invalid_argument("Unable to cast vertices to 2d array");
+	if(cols!=2 || rows<3) throw invalid_argument("Vertices must have 2 columns (x and y) and at least 3 rows.");
+	int i /*current node*/, j/*previous node*/; bool inside=false;
+	for(i=0,j=rows-1; i<rows; j=i++){
+		double vx_i=*(double*)(vert->data+i*vert->strides[0]), vy_i=*(double*)(vert->data+i*vert->strides[0]+vert->strides[1]), vx_j=*(double*)(vert->data+j*vert->strides[0]), vy_j=*(double*)(vert->data+j*vert->strides[0]+vert->strides[1]);
+		if (((vy_i>testy)!=(vy_j>testy)) && (testx < (vx_j-vx_i) * (testy-vy_i) / (vy_j-vy_i) + vx_i) ) inside=!inside;
+	}
+	Py_DECREF(vert);
+	return inside;
+}
+
 /* Project 3d point into 2d using spiral projection along given axis;
  * the returned tuple is
  * 	
@@ -218,7 +256,6 @@
 	Real hRef=dH_dTheta*(theta-theta0);
 	long period;
 	Real h=Shop::periodicWrap(pt[axis],hRef-.5*Mathr::PI*dH_dTheta,hRef+.5*Mathr::PI*dH_dTheta,&period);
-	if(abs(h-hRef)>0.005) cerr<<"@@@ "<<h-hRef<<" "<<h<<" "<<hRef<<" "<<pt[axis]<<" ("<<hRef-.5*Mathr::PI*dH_dTheta<<","<<hRef+.5*Mathr::PI*dH_dTheta<<") "<<theta<<" "<<endl;
 	return python::make_tuple(python::make_tuple(r,h-hRef),theta);
 }
 BOOST_PYTHON_FUNCTION_OVERLOADS(spiralProject_overloads,spiralProject,2,4);
@@ -229,6 +266,9 @@
 BOOST_PYTHON_FUNCTION_OVERLOADS(unbalancedForce_overloads,Shop::unbalancedForce,0,1);
 
 BOOST_PYTHON_MODULE(_utils){
+	// http://numpy.scipy.org/numpydoc/numpy-13.html mentions this must be done in module init, otherwise we will crash
+	import_array();
+
 	def("PWaveTimeStep",PWaveTimeStep);
 	def("aabbExtrema",aabbExtrema,aabbExtrema_overloads(args("cutoff","centers")));
 	def("negPosExtremeIds",negPosExtremeIds,negPosExtremeIds_overloads(args("axis","distFactor")));
@@ -243,6 +283,7 @@
 	def("sumBexMoments",sumBexMoments);
 	def("createInteraction",Shop__createExplicitInteraction);
 	def("spiralProject",spiralProject,spiralProject_overloads(args("axis","theta0")));
+	def("pointInsidePolygon",pointInsidePolygon);
 }
 
 

Modified: trunk/lib/smoothing/WeightedAverage2d.cpp
===================================================================
--- trunk/lib/smoothing/WeightedAverage2d.cpp	2008-10-25 19:03:17 UTC (rev 1558)
+++ trunk/lib/smoothing/WeightedAverage2d.cpp	2008-10-26 21:47:44 UTC (rev 1559)
@@ -1,5 +1,19 @@
 #include"WeightedAverage2d.hpp"
 
+/* Tell whether point is inside polygon
+ *
+ * See _utils.cpp: pointInsidePolygon for docs and license.
+ */
+bool pyGaussAverage::pointInsidePolygon(const Vector2r& pt, const vector<Vector2r>& vertices){
+	int i /*current node*/, j/*previous node*/; bool inside=false; int rows=(int)vertices.size();
+	const Real& testx=pt[0],testy=pt[1];
+	for(i=0,j=rows-1; i<rows; j=i++){
+		const Real& vx_i=vertices[i][0], vy_i=vertices[i][1], vx_j=vertices[j][0], vy_j=vertices[j][1];
+		if (((vy_i>testy)!=(vy_j>testy)) && (testx < (vx_j-vx_i) * (testy-vy_i) / (vy_j-vy_i) + vx_i) ) inside=!inside;
+	}
+	return inside;
+}
+
 BOOST_PYTHON_MODULE(WeightedAverage2d)
 {
 	boost::python::class_<pyGaussAverage>("GaussAverage",python::init<python::tuple,python::tuple,python::tuple,Real>())
@@ -7,6 +21,7 @@
 		.def("avg",&pyGaussAverage::avg)
 		.add_property("stDev",&pyGaussAverage::stDev_get,&pyGaussAverage::stDev_set)
 		.add_property("relThreshold",&pyGaussAverage::relThreshold_get,&pyGaussAverage::relThreshold_set)
+		.add_property("clips",&pyGaussAverage::clips_get,&pyGaussAverage::clips_set)
 	;
 };
 

Modified: trunk/lib/smoothing/WeightedAverage2d.hpp
===================================================================
--- trunk/lib/smoothing/WeightedAverage2d.hpp	2008-10-25 19:03:17 UTC (rev 1558)
+++ trunk/lib/smoothing/WeightedAverage2d.hpp	2008-10-26 21:47:44 UTC (rev 1559)
@@ -119,23 +119,23 @@
 	virtual Real getWeight(const Vector2r& meanPt, const T& e){	
 		Vector2r pos=getPosition(e);
 		Real rSq=pow(meanPt[0]-pos[0],2)+pow(meanPt[1]-pos[1],2);
-		if(rSq>relThreshold*stDev) return 0.;
-		return (1./sqrt(2*M_PI*stDev))*exp(-rSq/(2*stDev));
+		if(rSq>relThreshold*stDev*stDev) return 0.;
+		return (1./sqrt(2*M_PI*stDev*stDev))*exp(-rSq/(2*stDev*stDev));
 	}
 	virtual vector<Vector2i> filterCells(const Vector2r& refPt){return WeightedAverage<T,Tvalue>::grid->circleFilter(refPt,stDev*relThreshold);}
 };
 
-/* Class for doing template specialization of gaussian kernel average  on SGKA_dataPt and for testing */
-struct dataPt{
+/* Class for doing template specialization of gaussian kernel average on SGKA_Scalar2d and for testing */
+struct Scalar2d{
 	Vector2r pos;
-	int val;
+	Real val;
 };
 
 /* Final specialization; it only needs to define getValue and getPosition -- these functions contain knowledge about the element class itself */
-struct SGKA_dataPt: public SymmGaussianKernelAverage<dataPt,Real>{
-	SGKA_dataPt(const shared_ptr<GridContainer<dataPt> >& _grid, Real _stDev, Real _relThreshold=3): SymmGaussianKernelAverage<dataPt,Real>(_grid,_stDev,_relThreshold){}
-	virtual Real getValue(const dataPt& dp){return (Real)dp.val;}
-	virtual Vector2r getPosition(const dataPt& dp){return dp.pos;}
+struct SGKA_Scalar2d: public SymmGaussianKernelAverage<Scalar2d,Real>{
+	SGKA_Scalar2d(const shared_ptr<GridContainer<Scalar2d> >& _grid, Real _stDev, Real _relThreshold=3): SymmGaussianKernelAverage<Scalar2d,Real>(_grid,_stDev,_relThreshold){}
+	virtual Real getValue(const Scalar2d& dp){return (Real)dp.val;}
+	virtual Vector2r getPosition(const Scalar2d& dp){return dp.pos;}
 };
 
 /* simplified interface for python:
@@ -148,19 +148,50 @@
  *
  * */
 class pyGaussAverage{
-	//struct dataPt{Vector2r pos; Real val;};
+	//struct Scalar2d{Vector2r pos; Real val;};
 	Vector2r tuple2vec2r(const python::tuple& t){return Vector2r(python::extract<Real>(t[0])(),python::extract<Real>(t[1])());}
 	Vector2i tuple2vec2i(const python::tuple& t){return Vector2i(python::extract<int>(t[0])(),python::extract<int>(t[1])());}
-	shared_ptr<SGKA_dataPt> sgka;
+	shared_ptr<SGKA_Scalar2d> sgka;
+	struct Poly2d{vector<Vector2r> vertices; bool inclusive;};
+	vector<Poly2d> clips;
 	public:
 	pyGaussAverage(python::tuple lo, python::tuple hi, python::tuple nCells, Real stDev){
-		shared_ptr<GridContainer<dataPt> > g(new GridContainer<dataPt>(tuple2vec2r(lo),tuple2vec2r(hi),tuple2vec2i(nCells)));
-		sgka=shared_ptr<SGKA_dataPt>(new SGKA_dataPt(g,stDev));
+		shared_ptr<GridContainer<Scalar2d> > g(new GridContainer<Scalar2d>(tuple2vec2r(lo),tuple2vec2r(hi),tuple2vec2i(nCells)));
+		sgka=shared_ptr<SGKA_Scalar2d>(new SGKA_Scalar2d(g,stDev));
 	}
-	void addPt(Real val, python::tuple pos){dataPt d; d.pos=tuple2vec2r(pos); d.val=val; sgka->grid->add(d,d.pos); }
-	Real avg(python::tuple pt){return sgka->computeAverage(tuple2vec2r(pt));}
-
+	bool pointInsidePolygon(const Vector2r&,const vector<Vector2r>&);
+	bool ptIsClipped(const Vector2r& pt){
+		FOREACH(const Poly2d& poly, clips){
+			bool inside=pointInsidePolygon(pt,poly.vertices);
+			if((inside && !poly.inclusive) || (!inside && poly.inclusive)) return true;
+		}
+		return false;
+	}
+	bool addPt(Real val, python::tuple pos){Scalar2d d; d.pos=tuple2vec2r(pos); if(ptIsClipped(d.pos)) return false; d.val=val; sgka->grid->add(d,d.pos); return true; } 
+	Real avg(python::tuple _pt){Vector2r pt=tuple2vec2r(_pt); if(ptIsClipped(pt)) return std::numeric_limits<Real>::quiet_NaN(); return sgka->computeAverage(pt);}
 	Real stDev_get(){return sgka->stDev;} void stDev_set(Real s){sgka->stDev=s;}
 	Real relThreshold_get(){return sgka->relThreshold;} void relThreshold_set(Real rt){sgka->relThreshold=rt;}
+	python::list clips_get(){
+		python::list ret;
+		FOREACH(const Poly2d& poly, clips){
+			python::list vertices;
+			FOREACH(const Vector2r& v, poly.vertices) vertices.append(python::make_tuple(v[0],v[1]));
+			ret.append(python::make_tuple(vertices,poly.inclusive));
+		}
+		return ret;
+	}
+	void clips_set(python::list l){
+		/* [ ( [(x1,y1),(x2,y2),?], true), ? ] */
+		clips.clear();
+		for(int i=0; i<python::len(l); i++){
+			python::tuple polyDesc=python::extract<python::tuple>(l[i])();
+			python::list coords=python::extract<python::list>(polyDesc[0]);
+			Poly2d poly; poly.inclusive=python::extract<bool>(polyDesc[1]);
+			for(int j=0; j<python::len(coords); j++){
+				poly.vertices.push_back(tuple2vec2r(python::extract<python::tuple>(coords[j])));
+			}
+			clips.push_back(poly);
+		}
+	}
 };
 


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at arcig.cz  Mon Oct 27 11:37:19 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Mon, 27 Oct 2008 11:37:19 +0100
Subject: [deprecated list] [Yade-dev] Mandatory engines
In-Reply-To: <9838F124-AC1C-4908-915D-A51AECC367B4@geo.hmg.inpg.fr>
References: <9838F124-AC1C-4908-915D-A51AECC367B4@geo.hmg.inpg.fr>
Message-ID: <490599DF.4060702@arcig.cz>


> * HERE IS THE STORY:
>
> Say I want to implement a new geometry for bodies. I code pluggins
> that I needed (GeometriclModel, InteractingGeometry,Functors,
> GLDraw*,Preprocessor...) after discussing with Janeck
>
> I wanted to make some check on the displaying of this new geometry so
> I created a new PreProcessor that generates the wanted bodies. In a
> first stage, the 'lists' rootBody->engines and rootBody->initializers
> was copy&past from the TetrahedronsTest pre-processor. It worked fine
> at generation but  crashed during the first step of simulation (!)
>
> I decided to clear all engines and initializers...  it crashed during
> generation!
>
> * HERE ARE MY QUESTIONS:
>
> Can we have empty 'lists' of engines and initializers without crash
> (only to make some graphical checks)?
> If it does not, what are the engines (and initializers) that MUST
> absolutely be 'defined'?
Hi, There are no mandatory engines/initializers per se, but some engines
need PhysicalActions, that must be initialized with
PhysicalActionContainerInitializer. If you use the debug version and
have gdb installed, you will get backtrace after crash, which will tell
you (or us, if you can't make sense of it) what went wrong.

However, if you want just to create a simple simulation for testing, I
suggest that you use python for that -- see scripts/simple-scene.py for
an example. For testing display, you can only create the body, without
any engines, like this:

 b=Body()
 b.shape=GeometricalModel('VincentGeomModel',{'attribute1':value1,'attribue2':value2})
 b.mold=InteractingGeometry('VincentInteractingGeom',{'attr1':val1,'attr2',val2})
 b.phys=PhysicalParameters('BodyMacroParameters',{'se3':[x,y,z,1,0,0,0]})
 b.bound=BoundingVolume('AABB')
 o=Omega()
 o.bodies.append(b)

You can save that in somefile.py and run "yade-... somefile.py" or you
can type that to the python console. At this point, you should have your
body displayed in the 3d view.

Regards, Vaclav




_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Mon Oct 27 21:26:43 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Mon, 27 Oct 2008 21:26:43 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1560 - in trunk: .
	gui/py	pkg/dem/DataClass/InteractionGeometry
Message-ID: <200810272026.m9RKQhZO000905@sheep.berlios.de>

Author: eudoxos
Date: 2008-10-27 21:26:39 +0100 (Mon, 27 Oct 2008)
New Revision: 1560

Modified:
   trunk/SConstruct
   trunk/gui/py/utils.py
   trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp
Log:
1. Add initializers for all SpheresContactGeometry members, to avoid nan's in the .xml file
2. Add code for saving arbitrary python variables within the .xml file, see documentation on utils.saveVars() and utils.loadVars()
3. Fix error (hopefully) caused by dangling symlinks in the symlinked buildDir/include tree



Modified: trunk/SConstruct
===================================================================
--- trunk/SConstruct	2008-10-26 21:47:44 UTC (rev 1559)
+++ trunk/SConstruct	2008-10-27 20:26:39 UTC (rev 1560)
@@ -451,7 +451,7 @@
 	If not, include tree will be created and syumlinked in buildDir, using relative symlinks."""
 	global env
 	import os,string,re
-	from os.path import join,split,isabs,isdir,exists,islink,isfile,sep
+	from os.path import join,split,isabs,isdir,exists,lexists,islink,isfile,sep
 	if not prefix: yadeRoot=buildDir
 	else: yadeRoot=prefix
 	yadeInc=join(yadeRoot,'include','yade-%s'%env['version'],'yade')
@@ -489,7 +489,9 @@
 							while apfl[i]==aptl[i] and i<min(len(apfl),len(aptl))-1: i+=1
 							return sep.join(['..' for j in range(0,len(apfl)-i)]+aptl[i:])
 						linkName=join(subInc,f); linkTarget=relpath(linkName,join(root,f))
-						if not exists(linkName): os.symlink(linkTarget,linkName)
+						if not exists(linkName):
+							if lexists(linkName): os.remove(linkName) # broken symlink: remove it
+							os.symlink(linkTarget,linkName)
 					else: # install directory: use scons' Install facility
 						env.Install(subInc,join(root,f))
 

Modified: trunk/gui/py/utils.py
===================================================================
--- trunk/gui/py/utils.py	2008-10-26 21:47:44 UTC (rev 1559)
+++ trunk/gui/py/utils.py	2008-10-27 20:26:39 UTC (rev 1560)
@@ -16,7 +16,30 @@
 # c++ implementations for performance reasons
 from yade._utils import *
 
+def saveVars(**kw):
+	"""Save passed variables into the simulation so that it can be recovered when the simulation is loaded again.
 
+	For example, variables a=5, b=66 and c=7.5e-4 are defined. To save those, use
+
+	 utils.saveVars(a=a,b=b,c=c)
+
+	those variables will be save in the .xml file, when the simulation itself is saved. To recover those variables once
+	the .xml is loaded again, use
+
+	 utils.loadVars()
+
+	and they will be defined in the __builtin__ namespace (i.e. available from anywhere in the python code).
+	"""
+	import cPickle
+	Omega().tags['pickledPythonVariablesDictionary']=cPickle.dumps(kw)
+
+def loadVars():
+	import cPickle
+	import __builtin__
+	d=cPickle.loads(Omega().tags['pickledPythonVariablesDictionary'])
+	for k in d: __builtin__.__dict__[k]=d[k]
+
+
 def typedEngine(name): return [e for e in Omega().engines if e.name==name][0]
 
 def sphere(center,radius,density=1,young=30e9,poisson=.3,frictionAngle=0.5236,dynamic=True,wire=False,color=[1,1,1],physParamsClass='BodyMacroParameters'):

Modified: trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp
===================================================================
--- trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp	2008-10-26 21:47:44 UTC (rev 1559)
+++ trunk/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp	2008-10-27 20:26:39 UTC (rev 1560)
@@ -87,7 +87,7 @@
 
 		Vector3r relRotVector() const;
 
-		SpheresContactGeometry():contactPoint(Vector3r::ZERO),radius1(0),radius2(0),hasShear(false),pos1(Vector3r::ZERO),pos2(Vector3r::ZERO){createIndex();}
+		SpheresContactGeometry():contactPoint(Vector3r::ZERO),radius1(0),radius2(0),hasShear(false),pos1(Vector3r::ZERO),pos2(Vector3r::ZERO),ori1(Quaternionr::IDENTITY),ori2(Quaternionr::IDENTITY),cp1rel(Quaternionr::IDENTITY),cp2rel(Quaternionr::IDENTITY),d1(0),d2(0),d0(0),initRelOri12(Quaternionr::IDENTITY){createIndex();}
 		virtual ~SpheresContactGeometry();
 	protected :
 		virtual void registerAttributes(){


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Mon Oct 27 22:41:21 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Mon, 27 Oct 2008 22:41:21 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1561 - trunk/lib/smoothing
Message-ID: <200810272141.m9RLfLup023366@sheep.berlios.de>

Author: eudoxos
Date: 2008-10-27 22:41:21 +0100 (Mon, 27 Oct 2008)
New Revision: 1561

Modified:
   trunk/lib/smoothing/WeightedAverage2d.hpp
Log:
1. Fix algebraic typo in max distance check.


Modified: trunk/lib/smoothing/WeightedAverage2d.hpp
===================================================================
--- trunk/lib/smoothing/WeightedAverage2d.hpp	2008-10-27 20:26:39 UTC (rev 1560)
+++ trunk/lib/smoothing/WeightedAverage2d.hpp	2008-10-27 21:41:21 UTC (rev 1561)
@@ -119,8 +119,8 @@
 	virtual Real getWeight(const Vector2r& meanPt, const T& e){	
 		Vector2r pos=getPosition(e);
 		Real rSq=pow(meanPt[0]-pos[0],2)+pow(meanPt[1]-pos[1],2);
-		if(rSq>relThreshold*stDev*stDev) return 0.;
-		return (1./sqrt(2*M_PI*stDev*stDev))*exp(-rSq/(2*stDev*stDev));
+		if(rSq>pow(relThreshold*stDev,2)) return 0.; // discard points further than relThreshold*stDev, by default 3*stDev
+		return (1./(stDev*sqrt(2*M_PI)))*exp(-rSq/(2*stDev*stDev));
 	}
 	virtual vector<Vector2i> filterCells(const Vector2r& refPt){return WeightedAverage<T,Tvalue>::grid->circleFilter(refPt,stDev*relThreshold);}
 };


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Tue Oct 28 11:30:53 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Tue, 28 Oct 2008 11:30:53 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1562 - in trunk: core gui
	gui/py scripts
Message-ID: <200810281030.m9SAUrgr008201@sheep.berlios.de>

Author: eudoxos
Date: 2008-10-28 11:30:53 +0100 (Tue, 28 Oct 2008)
New Revision: 1562

Added:
   trunk/gui/py/yade-multi
   trunk/scripts/multi.py
   trunk/scripts/multi.table
Modified:
   trunk/core/MetaBody.cpp
   trunk/gui/SConscript
   trunk/gui/py/PythonUI_rc.py
   trunk/gui/py/utils.py
Log:
1. Commit simple parametric study interface, documented at http://yade.wikia.com/index.php?title=ScriptParametricStudy and wrapper script to queue jobs, which is installed as yade-trunk-multi, yade-trunk-opt-multi and so on.
2. Examples of such parametric "study" added in scripts/multi.py and scripts/multi.table
3. MetaBody now create Omega().tags['id'] at initialization like '20081028T102950p15498' (date, time, pid) that is unique



Modified: trunk/core/MetaBody.cpp
===================================================================
--- trunk/core/MetaBody.cpp	2008-10-27 21:41:21 UTC (rev 1561)
+++ trunk/core/MetaBody.cpp	2008-10-28 10:30:53 UTC (rev 1562)
@@ -52,6 +52,7 @@
 	string gecos(pw->pw_gecos), gecos2; size_t p=gecos.find(","); if(p!=string::npos) boost::algorithm::erase_tail(gecos,gecos.size()-p); for(size_t i=0;i<gecos.size();i++){gecos2.push_back(((unsigned char)gecos[i])<128 ? gecos[i] : '?'); }
 	tags.push_back(boost::algorithm::replace_all_copy(string("author=")+gecos2+" ("+string(pw->pw_name)+"@"+hostname+")"," ","~"));
 	tags.push_back(string("isoTime="+boost::posix_time::to_iso_string(boost::posix_time::second_clock::local_time())));
+	tags.push_back(string("id="+boost::posix_time::to_iso_string(boost::posix_time::second_clock::local_time())+"p"+lexical_cast<string>(getpid())));
 	tags.push_back(string("description="));
 }
 

Modified: trunk/gui/SConscript
===================================================================
--- trunk/gui/SConscript	2008-10-27 21:41:21 UTC (rev 1561)
+++ trunk/gui/SConscript	2008-10-28 10:30:53 UTC (rev 1562)
@@ -52,6 +52,8 @@
 			env.File('qt.py','qt3'),
 		])
 
+	env.InstallAs('$PREFIX/bin/yade$SUFFIX-multi',env.File('yade-multi','py'))
+
 	# python modules are one level deeper so that you can say: from yade.wrapper import *
 	env.Install('$PREFIX/lib/yade$SUFFIX/gui/yade',[
 		env.SharedLibrary('wrapper',['py/yadeControl.cpp'],SHLIBPREFIX='',

Modified: trunk/gui/py/PythonUI_rc.py
===================================================================
--- trunk/gui/py/PythonUI_rc.py	2008-10-27 21:41:21 UTC (rev 1561)
+++ trunk/gui/py/PythonUI_rc.py	2008-10-28 10:30:53 UTC (rev 1562)
@@ -24,6 +24,7 @@
 import yade.PythonTCPServer
 srv=yade.PythonTCPServer.PythonTCPServer(minPort=9000)
 yade.runtime.cookie=srv.server.cookie
+sys.stdout.flush()
 
 ## run simulation if requested from the command line
 if runtime.simulation:
@@ -40,7 +41,9 @@
 		import traceback
 		traceback.print_exc()
 		if(runtime.nonInteractive or runtime.stopAfter): sys.exit(1)
-if runtime.stopAfter: sys.exit(0)
+if runtime.stopAfter:
+	print "Finished, bye."
+	sys.exit(0)
 
 # run commands if requested from the command line
 #if yadeRunCommands:

Modified: trunk/gui/py/utils.py
===================================================================
--- trunk/gui/py/utils.py	2008-10-27 21:41:21 UTC (rev 1561)
+++ trunk/gui/py/utils.py	2008-10-28 10:30:53 UTC (rev 1562)
@@ -16,7 +16,7 @@
 # c++ implementations for performance reasons
 from yade._utils import *
 
-def saveVars(**kw):
+def saveVars(mark='',**kw):
 	"""Save passed variables into the simulation so that it can be recovered when the simulation is loaded again.
 
 	For example, variables a=5, b=66 and c=7.5e-4 are defined. To save those, use
@@ -31,12 +31,12 @@
 	and they will be defined in the __builtin__ namespace (i.e. available from anywhere in the python code).
 	"""
 	import cPickle
-	Omega().tags['pickledPythonVariablesDictionary']=cPickle.dumps(kw)
+	Omega().tags['pickledPythonVariablesDictionary'+mark]=cPickle.dumps(kw)
 
-def loadVars():
+def loadVars(mark=''):
 	import cPickle
 	import __builtin__
-	d=cPickle.loads(Omega().tags['pickledPythonVariablesDictionary'])
+	d=cPickle.loads(Omega().tags['pickledPythonVariablesDictionary'+mark])
 	for k in d: __builtin__.__dict__[k]=d[k]
 
 
@@ -241,14 +241,14 @@
 	mainloop.run()
 	pipeline.set_state(gst.STATE_NULL); pipeline.get_state()
 
-def readParamsFromTable(tableFile=None,tableLine=None,noTableOk=False,**kw):
+def readParamsFromTable(tableFileLine=None,noTableOk=False,**kw):
 	"""
 	Read parameters from a file and assign them to __builtin__ variables.
 
 	tableFile is a text file (with one value per blank-separated columns)
 	tableLine is number of line where to get the values from
 
-		The format of the file is as follows (no comments, empty lines etc allowed?)
+		The format of the file is as follows (commens starting with # and empty lines allowed
 		
 		name1 name2 ? # 0th line
 		val1  val2  ? # 1st line
@@ -261,17 +261,22 @@
 	
 	assigns Omega().tags['defaultParams']="unassignedName1=defaultValue1,?"
 
+	saves all parameters (default as well as settable) using saveVars('table')
+
 	return value is the number of assigned parameters.
 	"""
 	o=Omega()
 	tagsParams=[]
+	dictDefaults,dictParams={},{}
 	import os, __builtin__
-	if not tableFile and not os.environ.has_key('PARAM_TABLE'):
+	if not tableFileLine and not os.environ.has_key('PARAM_TABLE'):
 		if not noTableOk: raise EnvironmentError("PARAM_TABLE is not defined in the environment")
+		o.tags['line']='l!'
 	else:
-		if not tableFile: tableFile=os.environ['PARAM_TABLE']
-		if not tableLine: tableLine=int(os.environ['PARAM_LINE'])
-		ll=open(tableFile).readlines(); names=ll[0].split(); values=ll[tableLine].split()
+		if not tableFileLine: tableFileLine=os.environ['PARAM_TABLE']
+		tableFile,tableLine=tableFileLine.split(':')
+		o.tags['line']='l'+tableLine
+		ll=[l.split('#')[0] for l in open(tableFile).readlines()]; names=ll[0].split(); values=ll[int(tableLine)].split()
 		assert(len(names)==len(values))
 		for i in range(len(names)):
 			if names[i]=='description': o.tags['description']=values[i]
@@ -279,12 +284,13 @@
 				if names[i] not in kw.keys(): raise NameError("Parameter `%s' has no default value assigned"%names[i])
 				kw.pop(names[i])
 				eq="%s=%s"%(names[i],values[i])
-				exec('__builtin__.%s=%s'%(names[i],values[i])); tagsParams+=['%s=%s'%(names[i],values[i])]
+				exec('__builtin__.%s=%s'%(names[i],values[i])); tagsParams+=['%s=%s'%(names[i],values[i])]; dictParams[names[i]]=values[i]
 	defaults=[]
 	for k in kw.keys():
 		exec("__builtin__.%s=%s"%(k,kw[k]))
-		defaults+=["%s=%s"%(k,kw[k])]
+		defaults+=["%s=%s"%(k,kw[k])]; dictDefaults[k]=kw[k]
 	o.tags['defaultParams']=",".join(defaults)
 	o.tags['params']=",".join(tagsParams)
+	dictParams.update(dictDefaults); saveVars('table',**dictParams)
 	return len(tagsParams)
 

Added: trunk/gui/py/yade-multi
===================================================================
--- trunk/gui/py/yade-multi	2008-10-27 21:41:21 UTC (rev 1561)
+++ trunk/gui/py/yade-multi	2008-10-28 10:30:53 UTC (rev 1562)
@@ -0,0 +1,138 @@
+#!/usr/bin/env python
+#?encoding: utf-8
+#
+# portions ? 2008 V?clav ?milauer <eudoxos at arcig.cz>
+
+
+#
+# _MANY_ thanks to Mark Pettit for concurrent jobs handling!
+# http://code.activestate.com/recipes/534160/
+#
+
+import os, sys, thread, time
+
+def __concurrent_batch(cmd,thread_num,completion_status_dict,exit_code_dict):
+	"""Helper routine for 'concurrent_batches."""
+
+	t0=time.time()
+	print '#%d started on %s'%(thread_num,time.asctime())
+	exit_code_dict[thread_num] = os.system(cmd)
+	completion_status_dict[thread_num] = 1  # for sum() routine
+	dt=int(time.time()-t0)
+	strDt='%02d:%02d:%02d'%(dt//3600,(dt%3600)//60,(dt%60))
+	strStatus='done   ' if exit_code_dict[thread_num]==0 else 'FAILED '
+	print "#%d %s (exit status %d), duration %s"%(thread_num,strStatus,exit_code_dict[thread_num],strDt)
+
+def concurrent_batches(batchlist,maxjobs=0,maxtime=0):
+	"""Run a list of batch commands simultaneously.
+
+	'batchlist' is a list of strings suitable for submitting under os.system().
+	Each job will run in a separate thread, with the thread ending when the
+	subprocess ends.
+	'maxjobs' will, if greater then zero, be the maximum number of simultaneous
+	jobs which can concurrently run.  This would be used to limit the number of
+	processes where too many could flood a system, causing performance issues.
+	'maxtime', when greater than zero, be the maximum amount of time (seconds)
+	that we will wait for processes to complete.  After that, we will return,
+	but no jobs will be killed.  In other words, the jobs still running will
+	continue to run, and hopefully finish in the course of time.
+
+	example: concurrent_batches(("gzip abc","gzip def","gzip xyz"))
+
+	returns: a dictionary of exit status codes, but only when ALL jobs are
+			 complete, or the maximum time has been exceeded.
+			 Note that if returning due to exceeding time, the dictionary will
+			 continue to be updated by the threads as they complete.
+			 The key of the dictionary is the thread number, which matches the
+			 index of the list of batch commands.  The value is the result of
+			 the os.system call.
+
+	gotcha:  If both the maxjobs and maxtime is set, there is a possibility that
+			 not all jobs will be submitted.  The only way to detect this will be
+			 by checking for the absence of the KEY in the returned dictionary.
+	"""
+
+	if not batchlist: return {}
+	completion_status_dict, exit_code_dict = {}, {}
+	num_jobs = len(batchlist)
+	start_time = time.time()
+	for thread_num, cmd in enumerate(batchlist):
+		exit_code_dict[thread_num] = None
+		completion_status_dict[thread_num] = 0 # for sum() routine
+		thread.start_new_thread(__concurrent_batch,
+			  (cmd,thread_num,completion_status_dict,exit_code_dict))
+		while True:
+			completed = sum(completion_status_dict.values())
+			if num_jobs == completed:
+				return exit_code_dict	  # all done
+			running = thread_num - completed + 1
+			if maxtime > 0:
+				if time.time() - start_time > maxtime:
+					return exit_code_dict
+			if not maxjobs:
+				if thread_num < num_jobs-1:  # have we submitted all jobs ?
+					break				  #  no, so break to for cmd loop
+				else:
+					time.sleep(.2)		 #  yes, so wait until jobs are complete
+					continue
+			if running < maxjobs and thread_num < num_jobs-1:
+				break	# for next for loop
+			time.sleep(.2)
+#
+# now begins the yade code
+#
+
+import sys,re,optparse
+def getNumCores(): return len([l for l in open('/proc/cpuinfo','r') if l.find('processor')==0])
+
+parser=optparse.OptionParser(usage='%prog [options] TABLE SIMULATION.py\n\n  %prog runs yade simulation multiple times with different parameters.\n  See http://yade.wikia.com/wiki/ScriptParametricStudy for details.')
+parser.add_option('-j',dest='maxJobs',type='int',help="Maximum number of simultaneous jobs to run (default: number of cores, i.e. %d)"%getNumCores(),metavar='NUM',default=getNumCores())
+parser.add_option('--log',dest='logFormat',help='Format of log files -- must contain a %, which will be replaced by line number (default: SIMULATION.%.log)',metavar='FORMAT')
+parser.add_option('-l','--lines',dest='lineList',help='Lines of TABLE to use, in the format 2,3-5,8,11-13 (default: all available lines in TABLE)',metavar='LIST')
+parser.add_option('--nice',dest='nice',type='int',help='Nice value of spawned jobs (default: 10)',default=10)
+parser.add_option('--executable',dest='executable',help='Name of the program to run (default: %s)'%sys.argv[0][:-6],default=sys.argv[0][:-6],metavar='FILE') ## strip the '-multi' extension
+opts,args=parser.parse_args()
+logFormat,lineList,maxJobs,nice,executable=opts.logFormat,opts.lineList,opts.maxJobs,opts.nice,opts.executable
+
+if len(args)!=2:
+	#print "Exactly two non-option arguments must be specified -- parameter table and script to be run.\n"
+	parser.print_help()
+	sys.exit(1)
+table,simul=args[0:2]
+if not logFormat: logFormat=(simul[:-3] if simul[-3:]=='.py' else simul)+".%.log"
+if not '%' in logFormat: raise StandardError("Log string must contain a `%'")
+
+print "Will run `%s' on `%s' with nice value %d, output redirected to `%s', %d jobs at a time."%(executable,simul,nice,logFormat,maxJobs)
+
+ll=open(table,'r').readlines()
+availableLines=[i for i in range(len(ll)) if not re.match(r'^\s*(#.*)?$',ll[i][:-1]) and i>0]
+
+print "Will use table `%s', with available lines"%(table),', '.join([str(i) for i in availableLines])+'.'
+
+if lineList:
+	useLines=[]
+	def numRange2List(s):
+		ret=[]
+		for l in s.split(','):
+			if "-" in l: ret+=range(*[int(s) for s in l.split('-')]); ret+=[ret[-1]+1]
+			else: ret+=[int(l)]
+		return ret
+	useLines0=numRange2List(lineList)
+	for l in useLines0:
+		if l not in availableLines: print "WARNING: skipping unavailable line %d that was requested from the command line."%l
+		elif l==0: print "WARNING: skipping line 0 that should contain variable labels"
+		else: useLines+=[l]
+else: useLines=availableLines
+print "Will use lines ",', '.join([str(i) for i in useLines])+'.'
+
+
+batches=[]
+for l in useLines:
+	logFile=logFormat.replace('%',str(l))
+	batches.append('PARAM_TABLE=%s:%d nice -n %d %s -N PythonUI -- -n -x %s > %s 2>&1'%(table,l,nice,executable,simul,logFile))
+print "Job summary:"
+for i in range(len(batches)):
+	print '   #%d:'%i, batches[i]
+# OK, go now
+concurrent_batches(batches,maxjobs=maxJobs)
+print 'All jobs finished, bye.'


Property changes on: trunk/gui/py/yade-multi
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/scripts/multi.py
===================================================================
--- trunk/scripts/multi.py	2008-10-27 21:41:21 UTC (rev 1561)
+++ trunk/scripts/multi.py	2008-10-28 10:30:53 UTC (rev 1562)
@@ -0,0 +1,45 @@
+#
+# see http://yade.wikia.com/wiki/ScriptParametricStudy#scripts.2Fmulti.py for explanations
+#
+## read parameters from table here
+from yade import utils
+utils.readParamsFromTable(gravity=-9.81,density=2400,initialSpeed=20,noTableOk=True)
+print gravity,density,initialSpeed
+
+o=Omega()
+o.initializers=[
+	StandAloneEngine('PhysicalActionContainerInitializer'),
+	MetaEngine('BoundingVolumeMetaEngine',[EngineUnit('InteractingSphere2AABB'),EngineUnit('InteractingFacet2AABB'),EngineUnit('MetaInteractingGeometry2AABB')])
+	]
+o.engines=[
+	StandAloneEngine('PhysicalActionContainerReseter'),
+	MetaEngine('BoundingVolumeMetaEngine',[
+		EngineUnit('InteractingSphere2AABB'),
+		EngineUnit('InteractingBox2AABB'),
+		EngineUnit('MetaInteractingGeometry2AABB')
+	]),
+	StandAloneEngine('PersistentSAPCollider'),
+	MetaEngine('InteractionGeometryMetaEngine',[
+		EngineUnit('InteractingSphere2InteractingSphere4SpheresContactGeometry'),
+		EngineUnit('InteractingBox2InteractingSphere4SpheresContactGeometry')
+	]),
+	MetaEngine('InteractionPhysicsMetaEngine',[EngineUnit('SimpleElasticRelationships')]),
+	StandAloneEngine('ElasticContactLaw'),
+	DeusExMachina('GravityEngine',{'gravity':[0,0,gravity]}), ## here we use the 'gravity' parameter
+	DeusExMachina('NewtonsDampedLaw',{'damping':0.4})
+]
+o.bodies.append(utils.box([0,50,0],extents=[1,50,1],dynamic=False,color=[1,0,0],young=30e9,poisson=.3,density=density)) ## here we use the density parameter
+o.bodies.append(utils.sphere([0,0,10],1,color=[0,1,0],young=30e9,poisson=.3,density=density)) ## here again
+
+o.bodies[1].phys['velocity']=[0,initialSpeed,0] ## assign initial velocity
+
+o.dt=.8*utils.PWaveTimeStep()
+## o.saveTmp('initial')
+
+# run 30000 iterations
+o.run(30000,True)
+
+# write some results to a common file
+# (we rely on the fact that 2 processes will not write results at exactly the same time)
+# 'a' means to open for appending
+file('multi.out','a').write('%s %g %g %g %g\n'%(o.tags['description'],gravity,density,initialSpeed,o.bodies[1].phys.pos[1]))

Added: trunk/scripts/multi.table
===================================================================
--- trunk/scripts/multi.table	2008-10-27 21:41:21 UTC (rev 1561)
+++ trunk/scripts/multi.table	2008-10-28 10:30:53 UTC (rev 1562)
@@ -0,0 +1,9 @@
+description density initialSpeed ## comment here
+reference   2400    10
+hi_v       	2400    20
+lo_v        2400     5  # comment there
+hi_rho      5000    10
+hi_rho_v    5000    20
+hi_rh0_lo_v 5000     5
+
+  # comment-only line


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From jerier at geo.hmg.inpg.fr  Tue Oct 28 12:12:49 2008
From: jerier at geo.hmg.inpg.fr (Jean-Francois Jerier)
Date: Tue, 28 Oct 2008 12:12:49 +0100
Subject: [deprecated list] [Yade-dev] Move a wall  and plot (force,
	displacement) in a Python simulation
Message-ID: <4906F3B1.7050700@geo.hmg.inpg.fr>


 Hi all,

      If anyone can help me on Python. I have modified the script in 
Python to generate a cylindrical packing written by Vaclav.
    I added with the facet, a wall at top (execute the attached file) in 
order to realize a uniaxial compaction.

  Now, i need :
             1) define this wall   (the last facet in my simulation) 
like a dynamic body. ==> b['isDynamic']=True. What is b? It is not a 
number !!!
             2) give a translation velocity at this wall. What is the 
Python line to give a velocity at a body ?
             3) plot the applied forces on this wall according to wall 
displacement.

Thank you for your replies.

JF 

  






-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: fichier2.txt
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20081028/2408dc9a/attachment.txt>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ScriptGenerateCylindricalPacking.py
Type: text/x-python
Size: 2951 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/yade-dev/attachments/20081028/2408dc9a/attachment.py>
-------------- next part --------------
_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at arcig.cz  Tue Oct 28 13:37:52 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Tue, 28 Oct 2008 13:37:52 +0100
Subject: [deprecated list] [Yade-dev] Move a wall  and plot (force,
 displacement) in a Python simulation
In-Reply-To: <4906F3B1.7050700@geo.hmg.inpg.fr>
References: <4906F3B1.7050700@geo.hmg.inpg.fr>
Message-ID: <490707A0.4090902@arcig.cz>


>
>      If anyone can help me on Python. I have modified the script in
> Python to generate a cylindrical packing written by Vaclav.
>    I added with the facet, a wall at top (execute the attached file)
> in order to realize a uniaxial compaction.
Welcome to the python world! I will do my best...

fichier = open('150_billes.txt','r')
for ligne in fichier.readlines() :
     donnees = map(float,ligne.split(","))
 o.bodies.append(utils.sphere([donnees[0],donnees[1],donnees[2]],donnees[3],wire=True,color=[random.random(),random.random(),random.random()]))

This you can do easier (since I've been doing that again and again, I've
written a function for that)

utils.spheresFromFile('150_billes.txt',wire=True)
for s in o.bodies:
b.shape['diffuseColor']=[random.random(),random.random(),random.random()]


>
>             1) define this wall   (the last facet in my simulation)
> like a dynamic body. ==> b['isDynamic']=True. What is b? It is not a
> number !!!
b is Body instance (o.bodies[id]), you need something like
o.bodies[id]['isDynamic']=True; or you can define wall=o.bodies[wallId],
say wall['isDynamic']=True; this wall variable can be used later
>             2) give a translation velocity at this wall. What is the
> Python line to give a velocity at a body ?
o.bodies[id].phys['velocity']=[velX,velY,velZ]

But that will give it initial velocity, that will be influenced by
collisions etc. If you need constant translation velocity, you have to
use TranslationEngine for that (put it somewhere into your engines,
perhaps after NewtonsDampedLaw):

DeusExMachina('TranslationEngine',{'subscribedBodies':[idWall],'velocity':[x,y,z]})

>             3) plot the applied forces on this wall according to wall
> displacement.
have a look at scripts/simple-scene-graph.py 
(http://svn.berlios.de/viewcvs/yade/trunk/scripts/simple-scene-graph.py?view=markup)
and http://yade.wikia.com/wiki/PythonPlotting. Basically, you need an
engine that records the data (PeriodicPythonRunner), a function that
does that (myAddPlotData) and set yade.plot.plots to what you want to plot.

You get the velocity again like wall.phys['velocity'][2] ([2] is for the
z-component).

Have a look at yade.plot.saveGnuplot, that saves your data to file so
that you can plot it with gnuplot once you will have quit yade.

Hope this helps, Vaclav

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From jerier at geo.hmg.inpg.fr  Tue Oct 28 18:18:15 2008
From: jerier at geo.hmg.inpg.fr (Jean-Francois Jerier)
Date: Tue, 28 Oct 2008 18:18:15 +0100
Subject: [deprecated list] [Yade-dev] Problem with
 DeusExMachina('TranslationEngine', {'subscribedBodies':[idWall],
 'velocity':[x, y, z]}) on Python
In-Reply-To: <490707A0.4090902@arcig.cz>
References: <4906F3B1.7050700@geo.hmg.inpg.fr> <490707A0.4090902@arcig.cz>
Message-ID: <49074957.3020409@geo.hmg.inpg.fr>


Hi Vaclav,

  Thank for all these Python lines, now i think i'll manage my 
simulation. But i have again a little problem with :

DeusExMachina('TranslationEngine',{'subscribedBodies':[idWall],'velocity':[x,y,z]})

I have this problem:

  File "ScriptGenerateCylindricalPacking.py", line 78, in <module>
    
DeusExMachina('TranslationEngine',{'subscribedBodies':[41],'velocity':[0,0,-1]})
RuntimeError: Could not extract type double

The number 41 is the idwall which corresponds at with a facet at top. Do 
you know this mistake ?


Thank
JF


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Tue Oct 28 19:01:06 2008
From: eudoxos at arcig.cz (=?UTF-8?B?VsOhY2xhdiDFoG1pbGF1ZXI=?=)
Date: Tue, 28 Oct 2008 19:01:06 +0100
Subject: [deprecated list] [Yade-dev] Problem with
 DeusExMachina('TranslationEngine', {'subscribedBodies':[idWall],
 'velocity':[x, y, z]}) on Python
In-Reply-To: <49074957.3020409@geo.hmg.inpg.fr>
References: <4906F3B1.7050700@geo.hmg.inpg.fr> <490707A0.4090902@arcig.cz>
	<49074957.3020409@geo.hmg.inpg.fr>
Message-ID: <49075362.10905@arcig.cz>


>  File "ScriptGenerateCylindricalPacking.py", line 78, in <module>
>   
> DeusExMachina('TranslationEngine',{'subscribedBodies':[41],'velocity':[0,0,-1]})
>
> RuntimeError: Could not extract type double
I am sorry, this was my fault.. If you look at TranslationEngine, it
defines Real velocity (hence trying to extract (i.e. convert to c type)
double from the list [0,0,-1], which fails -- it should be a number) and
Vector3r translationAxis. Therefore, the correct way would be

 DeuxExMachina('TranslationEngine',{'subscribedBodies':[41],'velocity':1,'translationAxis':[0,0,-1])

(Not very logical, though, it would be enough to have one velocity
parameter instead of two...)

Vaclav


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Tue Oct 28 19:07:05 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Tue, 28 Oct 2008 19:07:05 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1563 - trunk/gui/py
Message-ID: <200810281807.m9SI758q023961@sheep.berlios.de>

Author: eudoxos
Date: 2008-10-28 19:06:54 +0100 (Tue, 28 Oct 2008)
New Revision: 1563

Modified:
   trunk/gui/py/utils.py
Log:
1. Changed colors to be random by default on utils.{sphere,box,facet}



Modified: trunk/gui/py/utils.py
===================================================================
--- trunk/gui/py/utils.py	2008-10-28 10:30:53 UTC (rev 1562)
+++ trunk/gui/py/utils.py	2008-10-28 18:06:54 UTC (rev 1563)
@@ -40,11 +40,14 @@
 	for k in d: __builtin__.__dict__[k]=d[k]
 
 
+def randomColor(): return [random.random(),random.random(),random.random()]
+
 def typedEngine(name): return [e for e in Omega().engines if e.name==name][0]
 
-def sphere(center,radius,density=1,young=30e9,poisson=.3,frictionAngle=0.5236,dynamic=True,wire=False,color=[1,1,1],physParamsClass='BodyMacroParameters'):
+def sphere(center,radius,density=1,young=30e9,poisson=.3,frictionAngle=0.5236,dynamic=True,wire=False,color=None,physParamsClass='BodyMacroParameters'):
 	"""Create default sphere, with given parameters. Physical properties such as mass and inertia are calculated automatically."""
 	s=Body()
+	if not color: color=randomColor()
 	s.shape=GeometricalModel('Sphere',{'radius':radius,'diffuseColor':color,'wire':wire,'visible':True})
 	s.mold=InteractingGeometry('InteractingSphere',{'radius':radius,'diffuseColor':color})
 	V=(4./3)*math.pi*radius**3
@@ -54,9 +57,10 @@
 	s['isDynamic']=dynamic
 	return s
 
-def box(center,extents,orientation=[1,0,0,0],density=1,young=30e9,poisson=.3,frictionAngle=0.5236,dynamic=True,wire=False,color=[1,1,1],physParamsClass='BodyMacroParameters'):
+def box(center,extents,orientation=[1,0,0,0],density=1,young=30e9,poisson=.3,frictionAngle=0.5236,dynamic=True,wire=False,color=None,physParamsClass='BodyMacroParameters'):
 	"""Create default box (cuboid), with given parameters. Physical properties such as mass and inertia are calculated automatically."""
 	b=Body()
+	if not color: color=randomColor()
 	b.shape=GeometricalModel('Box',{'extents':extents,'diffuseColor':color,'wire':wire,'visible':True})
 	b.mold=InteractingGeometry('InteractingBox',{'extents':extents,'diffuseColor':color})
 	mass=8*extents[0]*extents[1]*extents[2]*density
@@ -65,9 +69,10 @@
 	b['isDynamic']=dynamic
 	return b
 
-def facet(vertices,young=30e9,poisson=.3,frictionAngle=0.5236,dynamic=False,wire=True,color=[1,1,1],physParamsClass='BodyMacroParameters'):
+def facet(vertices,young=30e9,poisson=.3,frictionAngle=0.5236,dynamic=False,wire=True,color=None,physParamsClass='BodyMacroParameters'):
 	"""Create Facet"""
 	b=Body()
+	if not color: color=randomColor()
 	b.shape=GeometricalModel('Facet',{'diffuseColor':color,'wire':wire,'visible':True})
 	b.mold=InteractingGeometry('InteractingFacet',{'diffuseColor':color})
 	center=inscribedCircleCenter(list(vertices[0]),list(vertices[1]),list(vertices[2]))


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Tue Oct 28 19:07:56 2008
From: eudoxos at arcig.cz (=?UTF-8?B?VsOhY2xhdiDFoG1pbGF1ZXI=?=)
Date: Tue, 28 Oct 2008 19:07:56 +0100
Subject: [deprecated list] [Yade-dev] Problem with
 DeusExMachina('TranslationEngine', {'subscribedBodies':[idWall],
 'velocity':[x, y, z]}) on Python
In-Reply-To: <49074957.3020409@geo.hmg.inpg.fr>
References: <4906F3B1.7050700@geo.hmg.inpg.fr> <490707A0.4090902@arcig.cz>
	<49074957.3020409@geo.hmg.inpg.fr>
Message-ID: <490754FC.6090806@arcig.cz>

BTW for the colors "problem", there is utils.randomizeColors() of which
existence I forgot. Also, I changed utils.sphere etc to have random
color by default, since it makes no sense to have white by default... I
just commited that now (1563)

Vaclav

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Wed Oct 29 09:55:24 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 29 Oct 2008 09:55:24 +0100
Subject: [deprecated list] [Yade-dev] Mandatory engines
In-Reply-To: <46524A53-4ED0-4668-9578-CE69751EBB39@geo.hmg.inpg.fr>
References: <9838F124-AC1C-4908-915D-A51AECC367B4@geo.hmg.inpg.fr>	<490599DF.4060702@arcig.cz>
	<46524A53-4ED0-4668-9578-CE69751EBB39@geo.hmg.inpg.fr>
Message-ID: <490824FC.4040905@arcig.cz>


> Thanks a lot for explanations. I will write the needed
> physicalAction(s) after.
> For the moment, I would simply like to test (with display) two new
> functors:
> - the one make interactingGeometry (BssSweptSphereLineSegment) from
> GeometricalModel (BshTube),
> - the other make AABB from interactingGeometry.
> To 'launch' these functor, I pushed back to the initializers.
> Nevertheless, it seems that initializations
> are performed during the first step of calculation. Is it right?
Yes, initializers are run right before the first iteration (though there
is some confusion now if that means before iteration #1 or also before
the first iteration after having loaded a simulation etc -- not
important for now).

You should put the InteractingGeometryMetaEngine to initializers (sice
it needs to be run only once, the Bss doesn't change), but the
BoundingVolumeMetaEngine should be in Omega().engines, since you need to
update that at every iteration as the body moves.


>
> do you think I can add to svn repository my pluggins even if they are
> not yet usable?
> (I'm sure they will not interact with the rest)
> Is there a rule about that?
Yes, you are actually encouraged to commit your stuff, the only rule is
that your code should compile so that you don't break other peoples'
builds; it doens't matter if it is functionally wrong, since other
people won't be using it for now.

Regards, Vaclav


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From jerier at geo.hmg.inpg.fr  Wed Oct 29 12:07:37 2008
From: jerier at geo.hmg.inpg.fr (Jean-Francois Jerier)
Date: Wed, 29 Oct 2008 12:07:37 +0100
Subject: [deprecated list] [Yade-dev] commit not reported!
In-Reply-To: <663C36C4-2F4E-484A-9177-3BFAA90F1382@geo.hmg.inpg.fr>
References: <663C36C4-2F4E-484A-9177-3BFAA90F1382@geo.hmg.inpg.fr>
Message-ID: <490843F9.8020503@geo.hmg.inpg.fr>


Hi Vincent,

  Maybe, you need read this page web : 
http://yade.wikia.com/wiki/Launchpad_Migration

More particularly the section about :  SVN commiters

See you
JF




Vincent Richefeu wrote:
> Hi everybody,
>
> I added and committed new plugins.
> The commit is not reported in the mailling list. Instead, I received 
> the following message from yade-dev-bounces:
>
> >>>
>
> Your mail to 'Yade-dev' with the subject
>
>     [svn] r1564 - in trunk/pkg: common
> common/DataClass/GeometricalModel common/DataClass/InteractingGeometry
> common/DataClass/PhysicalParameters common/Engine/EngineUnit
> common/RenderingEngine/GLDrawGeometricalModel dem dem/PreProcessor
>
> Is being held until the list moderator can review it for approval.
>
> The reason it is being held:
>
>     Message body is too big: 44742 bytes with a limit of 40 KB
>
> <<<
>
> Perhaps because I added a lot of files.
> Could someone test whether the compilation is going well?
>
> Thanks,
> Vincent
>
>
>
>
> _______________________________________________
> Mailing list: https://launchpad.net/~yade-dev
> Post to     : yade-dev at lists.launchpad.net
> Unsubscribe : https://launchpad.net/~yade-dev
> More help   : https://help.launchpad.net/ListHelp
>


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From duriez at geo.hmg.inpg.fr  Wed Oct 22 18:26:26 2008
From: duriez at geo.hmg.inpg.fr (Jerome Duriez)
Date: Wed, 22 Oct 2008 18:26:26 +0200
Subject: [deprecated list] [Yade-dev] ContactLaw1
In-Reply-To: <48EB0D07.7060809@arcig.cz>
References: <200809260802.m8Q82DfS028074@sheep.berlios.de>	<48DCB0B5.3090808@arcig.cz>	<48DCB959.6040209@geo.hmg.inpg.fr>	<20080926141211.18247d5f@szpak>	<48DE0B9C.1050009@arcig.cz>
	<20080927133734.6cb5f3a9@szpak> <48EB0D07.7060809@arcig.cz>
Message-ID: <48FF5432.2070006@geo.hmg.inpg.fr>

(Sorry for the private email Vaclav, this one was not intentional)

V?clav ?milauer a ?crit :
>
> Hi there, I implemented ElasticContactLaw2 (for ilustration) that
> behaves like ElasticContactLaw (except that all contact are cohesive
> (don't break) and there is no moment rotation law) and uses new
> SpheresContactGeometry code; the code is about 15 lines.
>
I just noticed I do not find anywhere this "ElasticContactLaw2". Is this 
file supposed to be in the svn ?

Jerome

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From richefeu at geo.hmg.inpg.fr  Mon Oct 27 10:03:16 2008
From: richefeu at geo.hmg.inpg.fr (Vincent Richefeu)
Date: Mon, 27 Oct 2008 10:03:16 +0100
Subject: [deprecated list] [Yade-dev] Mandatory engines
Message-ID: <9838F124-AC1C-4908-915D-A51AECC367B4@geo.hmg.inpg.fr>

Hello everybody,

I'm Vincent, a new yade-dev member. I am currently in a learning  
phase in yade.

* HERE IS THE STORY:

Say I want to implement a new geometry for bodies. I code pluggins  
that I needed (GeometriclModel, InteractingGeometry,Functors,  
GLDraw*,Preprocessor...) after discussing with Janeck

I wanted to make some check on the displaying of this new geometry so  
I created a new PreProcessor that generates the wanted bodies. In a  
first stage, the 'lists' rootBody->engines and rootBody->initializers  
was copy&past from the TetrahedronsTest pre-processor. It worked fine  
at generation but  crashed during the first step of simulation (!)

I decided to clear all engines and initializers...  it crashed during  
generation!

* HERE ARE MY QUESTIONS:

Can we have empty 'lists' of engines and initializers without crash  
(only to make some graphical checks)?
If it does not, what are the engines (and initializers) that MUST  
absolutely be 'defined'?

Thanks,
Vincent


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From richefeu at geo.hmg.inpg.fr  Wed Oct 29 09:32:08 2008
From: richefeu at geo.hmg.inpg.fr (Vincent Richefeu)
Date: Wed, 29 Oct 2008 09:32:08 +0100
Subject: [deprecated list] [Yade-dev] Mandatory engines
In-Reply-To: <490599DF.4060702@arcig.cz>
References: <9838F124-AC1C-4908-915D-A51AECC367B4@geo.hmg.inpg.fr>
	<490599DF.4060702@arcig.cz>
Message-ID: <46524A53-4ED0-4668-9578-CE69751EBB39@geo.hmg.inpg.fr>

Hi Vaclav,

Thanks a lot for explanations. I will write the needed physicalAction 
(s) after.
For the moment, I would simply like to test (with display) two new  
functors:
- the one make interactingGeometry (BssSweptSphereLineSegment) from  
GeometricalModel (BshTube),
- the other make AABB from interactingGeometry.
To 'launch' these functor, I pushed back to the initializers.  
Nevertheless, it seems that initializations
are performed during the first step of calculation. Is it right?

Another questions:
do you think I can add to svn repository my pluggins even if they are  
not yet usable?
(I'm sure they will not interact with the rest)
Is there a rule about that?

Regards,
Vincent

>
>> * HERE IS THE STORY:
>>
>> Say I want to implement a new geometry for bodies. I code pluggins
>> that I needed (GeometriclModel, InteractingGeometry,Functors,
>> GLDraw*,Preprocessor...) after discussing with Janeck
>>
>> I wanted to make some check on the displaying of this new geometry so
>> I created a new PreProcessor that generates the wanted bodies. In a
>> first stage, the 'lists' rootBody->engines and rootBody->initializers
>> was copy&past from the TetrahedronsTest pre-processor. It worked fine
>> at generation but  crashed during the first step of simulation (!)
>>
>> I decided to clear all engines and initializers...  it crashed during
>> generation!
>>
>> * HERE ARE MY QUESTIONS:
>>
>> Can we have empty 'lists' of engines and initializers without crash
>> (only to make some graphical checks)?
>> If it does not, what are the engines (and initializers) that MUST
>> absolutely be 'defined'?
> Hi, There are no mandatory engines/initializers per se, but some  
> engines
> need PhysicalActions, that must be initialized with
> PhysicalActionContainerInitializer. If you use the debug version and
> have gdb installed, you will get backtrace after crash, which will  
> tell
> you (or us, if you can't make sense of it) what went wrong.
>
> However, if you want just to create a simple simulation for testing, I
> suggest that you use python for that -- see scripts/simple-scene.py  
> for
> an example. For testing display, you can only create the body, without
> any engines, like this:
>
>  b=Body()
>  b.shape=GeometricalModel('VincentGeomModel', 
> {'attribute1':value1,'attribue2':value2})
>  b.mold=InteractingGeometry('VincentInteractingGeom', 
> {'attr1':val1,'attr2',val2})
>  b.phys=PhysicalParameters('BodyMacroParameters',{'se3':[x,y,z, 
> 1,0,0,0]})
>  b.bound=BoundingVolume('AABB')
>  o=Omega()
>  o.bodies.append(b)
>
> You can save that in somefile.py and run "yade-... somefile.py" or you
> can type that to the python console. At this point, you should have  
> your
> body displayed in the 3d view.
>
> Regards, Vaclav
>
>
>
>
> _______________________________________________
> Mailing list: https://launchpad.net/~yade-dev
> Post to     : yade-dev at lists.launchpad.net
> Unsubscribe : https://launchpad.net/~yade-dev
> More help   : https://help.launchpad.net/ListHelp


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From richefeu at geo.hmg.inpg.fr  Wed Oct 29 11:55:48 2008
From: richefeu at geo.hmg.inpg.fr (Vincent Richefeu)
Date: Wed, 29 Oct 2008 11:55:48 +0100
Subject: [deprecated list] [Yade-dev] commit not reported!
Message-ID: <663C36C4-2F4E-484A-9177-3BFAA90F1382@geo.hmg.inpg.fr>

Hi everybody,

I added and committed new plugins.
The commit is not reported in the mailling list. Instead, I received  
the following message from yade-dev-bounces:

 >>>

Your mail to 'Yade-dev' with the subject

     [svn] r1564 - in trunk/pkg: common
common/DataClass/GeometricalModel common/DataClass/InteractingGeometry
common/DataClass/PhysicalParameters common/Engine/EngineUnit
common/RenderingEngine/GLDrawGeometricalModel dem dem/PreProcessor

Is being held until the list moderator can review it for approval.

The reason it is being held:

     Message body is too big: 44742 bytes with a limit of 40 KB

<<<

Perhaps because I added a lot of files.
Could someone test whether the compilation is going well?

Thanks,
Vincent




_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From dorofeenko at icp.ac.ru  Wed Oct 29 12:17:50 2008
From: dorofeenko at icp.ac.ru (sega)
Date: Wed, 29 Oct 2008 14:17:50 +0300
Subject: [deprecated list] [Yade-dev] commit not reported!
In-Reply-To: <663C36C4-2F4E-484A-9177-3BFAA90F1382@geo.hmg.inpg.fr>
References: <663C36C4-2F4E-484A-9177-3BFAA90F1382@geo.hmg.inpg.fr>
Message-ID: <200810291417.50747.dorofeenko@icp.ac.ru>

>      Message body is too big: 44742 bytes with a limit of 40 KB
don't worry about it...

-- 
Best regards, 
Sergei D. 	dorofeenko at icp.ac.ru

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Wed Oct 29 16:53:11 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 29 Oct 2008 16:53:11 +0100
Subject: [deprecated list] [Yade-dev] Incomprehensible crash
In-Reply-To: <0CE3986B-6408-4C8A-8C75-EDFA81E6EF55@geo.hmg.inpg.fr>
References: <4eb6799e0810290736w6d76a698kd4960ce301fca547@mail.gmail.com>	<490875B6.4030609@geo.hmg.inpg.fr>
	<0CE3986B-6408-4C8A-8C75-EDFA81E6EF55@geo.hmg.inpg.fr>
Message-ID: <490886E7.2060908@arcig.cz>

In case of crash always look for the following (or similar, if abort()
is called)

#6  <signal handler called>

then the strack below has what functions were called in what order.

Second thing is message printed right before the crash:

yade-trunk:
/home/vaclav/yade/build-trunk/include/yade-trunk/yade/lib-multimethods/DynLibDispatcher.hpp:447:
bool DynLibDispatcher<BaseClass, Executor, ResultType, TList,
autoSymmetry>::locateMultivirtualFunctor2D(int&, int&,
boost::shared_ptr<typename Loki::TL::TypeAtNonStrict<typename
Loki::TL::Append<Loki::NullType, T>::Result, 0u,
Loki::NullType>::Result>&, boost::shared_ptr<typename
Loki::TL::TypeAtNonStrict<typename Loki::TL::Append<Loki::NullType,
T>::Result, 1u, Loki::NullType>::Result>&) [with BaseClass =
Loki::Typelist<GeometricalModel, Loki::Typelist<InteractingGeometry,
Loki::NullType> >, Executor = InteractingGeometryEngineUnit, ResultType
= void, TList = Loki::Typelist<const
boost::shared_ptr<GeometricalModel>&,
Loki::Typelist<boost::shared_ptr<InteractingGeometry>&,
Loki::Typelist<const Se3r&, Loki::Typelist<const Body*, Loki::NullType>
> > >, bool autoSymmetry = true]: Assertion `index1 >= 0 && (unsigned
int)( index1 ) < callBacks.size() && index2 >= 0 && (unsigned int)(
index2 ) < callBacks[index1].size()' failed.

(well, informative, right? Basically, the metaengine doesn't have a
callback for that particular class, if I understand correctly. Anyway,
shouldn't it throw an informative exception instead of asserting and
failing? That makes me look at the MetaEngine in a closer way...:

Interesting is the generated .xml file at that place
(Preprocessor('MembraneTest').generate('/tmp/a.xml'))

    <initializers _className_="InteractingGeometryMetaEngine"  label=""
functorNames="[]">
                <functorArguments size="0" />
    </initializers>

No functores? Why is this line commented out?

  //
interactingGeometryDispatcher->add("ef2_BshTube_BssSweptSphereLineSegment_makeBssSweptSphereLineSegment");

Re-enabling this line makes me run without crash :-)

PS. You really _want_ to use those ugly names of classes? OMG... at
least skip the _make part and write just _BssSweptSpheres..., no?





_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Wed Oct 29 20:29:21 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Wed, 29 Oct 2008 20:29:21 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1565 - in trunk: gui/py
	lib/serialization	pkg/dem/PreProcessor
Message-ID: <200810291929.m9TJTL8j021378@sheep.berlios.de>

Author: eudoxos
Date: 2008-10-29 20:29:18 +0100 (Wed, 29 Oct 2008)
New Revision: 1565

Modified:
   trunk/gui/py/pyAttrUtils.hpp
   trunk/lib/serialization/FundamentalHandler.tpp
   trunk/lib/serialization/KnownFundamentalsHandler.tpp
   trunk/pkg/dem/PreProcessor/MembraneTest.cpp
   trunk/pkg/dem/PreProcessor/TriaxialTest.cpp
   trunk/pkg/dem/PreProcessor/TriaxialTest.hpp
Log:
1. Make our intelligence-challenged deserializer finally gracefully handle nan, inf, -inf (arbitrary lower-upper case).
2. Fix crash in MembraneTest (leftover in the commit from testing, oh well)
3. Add TriaxialTest::fixedBoxDims to not scale selected box dimensions if sphere mean radius is given (example underway).



Modified: trunk/gui/py/pyAttrUtils.hpp
===================================================================
--- trunk/gui/py/pyAttrUtils.hpp	2008-10-29 10:31:21 UTC (rev 1564)
+++ trunk/gui/py/pyAttrUtils.hpp	2008-10-29 19:29:18 UTC (rev 1565)
@@ -4,6 +4,7 @@
 #include<map>
 #include<vector>
 #include<boost/shared_ptr.hpp>
+#include<yade/lib-serialization/Archive.hpp>
 #include<yade/lib-serialization-xml/XMLFormatManager.hpp>
 #include<boost/python.hpp>
 
@@ -159,6 +160,7 @@
 		//! return python list of keys (attribute names)
 		boost::python::list pyKeys(){boost::python::list ret; for(DescriptorMap::iterator I=descriptors.begin();I!=descriptors.end();I++)ret.append(I->first); return ret;}
 
+
 		//! return attribute value as python object
 		boost::python::object pyGet(std::string key){
 			DescriptorMap::iterator I=descriptors.find(key);
@@ -167,15 +169,15 @@
 			LOG_DEBUG("Got raw attribute `"<<key<<"'");
 			switch(descriptors[key].type){
 				case BOOL: return python::object(lexical_cast<bool>(raw[0]));
-				case NUMBER: return python::object(lexical_cast<double>(raw[0]));
+				case NUMBER: return python::object(lexical_cast_maybeNanInf<double>(raw[0]));
 				case STRING: return python::object(raw[0]);
 				case SEQ_STRING: {python::list ret; for(size_t i=0; i<raw.size(); i++) ret.append(python::object(raw[i])); return ret;}
-				case SEQ_NUMBER: {python::list ret; for(size_t i=0; i<raw.size(); i++){ ret.append(python::object(lexical_cast<double>(raw[i]))); LOG_TRACE("Appended "<<raw[i]);} return ret; }
+				case SEQ_NUMBER: {python::list ret; for(size_t i=0; i<raw.size(); i++){ ret.append(python::object(lexical_cast_maybeNanInf<double>(raw[i]))); LOG_TRACE("Appended "<<raw[i]);} return ret; }
 				case VEC_VEC: {
 					python::list ret; for(size_t i=0; i<raw.size(); i++){
 						/* raw[i] has the form "{number number number}" */
 						vector<string> s; boost::algorithm::split(s,raw[i],algorithm::is_any_of("{} "),algorithm::token_compress_on);
-						python::list subList; FOREACH(string ss, s) subList.append(python::object(lexical_cast<double>(ss)));
+						python::list subList; FOREACH(string ss, s) subList.append(python::object(lexical_cast_maybeNanInf<double>(ss)));
 						ret.append(subList);
 					}
 				}

Modified: trunk/lib/serialization/FundamentalHandler.tpp
===================================================================
--- trunk/lib/serialization/FundamentalHandler.tpp	2008-10-29 10:31:21 UTC (rev 1564)
+++ trunk/lib/serialization/FundamentalHandler.tpp	2008-10-29 19:29:18 UTC (rev 1565)
@@ -87,6 +87,15 @@
 	}
 };
 
+template <typename RealType>
+RealType lexical_cast_maybeNanInf(const string& s){
+	if((s[0]=='n' || s[0]=='N') && (s[1]=='a' || s[1]=='A') && (s[2]=='n' || s[2]=='N')) return std::numeric_limits<RealType>::quiet_NaN();
+	if((s[0]=='i' || s[0]=='I') && (s[1]=='n' || s[1]=='N') && (s[2]=='f' || s[2]=='F')) return std::numeric_limits<RealType>::infinity();
+	if(s[0]=='-' && (s[1]=='i' || s[1]=='I') && (s[2]=='n' || s[2]=='N') && (s[3]=='f' || s[3]=='F')) return -std::numeric_limits<RealType>::infinity();
+	return lexical_cast<RealType>(s);
+};
+
+
 template<typename Type >
 inline void lexical_copy(Archive& ac , any& a )
 {
@@ -99,7 +108,9 @@
 		try{
 			*tmp = lexical_cast<Type>(*tmpStr);
 		} catch(boost::bad_lexical_cast& e){
-			if(typeid(tmp)==typeid(bool*) && atoi(tmpStr->c_str())!=0) { cerr<<"warning: offensive bool value `"<<*tmpStr<<"' encountered (interpreted as true)."<<endl; *tmp=lexical_cast<Type>("1"); /* cerr<<"New value: "<<lexical_cast<string>(*tmp)<<endl; cerr<<"Atoi returns "<<atoi(tmpStr->c_str())<<", bool !=0 is "<<(atoi(tmpStr->c_str())!=0)<<endl;*/ }
+			if(typeid(tmp)==typeid(bool*) && atoi(tmpStr->c_str())!=0) { cerr<<"warning: offensive bool value `"<<*tmpStr<<"' encountered (interpreted as true)."<<endl; *tmp=lexical_cast<Type>("1"); /* cerr<<"New value: "<<lexical_cast<string>(*tmp)<<endl; cerr<<"Atoi returns "<<atoi(tmpStr->c_str())<<", bool !=0 is "<<(atoi(tmpStr->c_str())!=0)<<endl;*/
+			}
+			else *tmp=lexical_cast_maybeNanInf<Type>(*tmpStr);
 		}
 	}
 	else if (a.type()==typeid(string*)) // serialization - writing to string from some Type
@@ -115,6 +126,9 @@
 		throw HandlerError(SerializationExceptions::LexicalCopyError);
 }
 
+
+
+
 template< >
 struct FundamentalHandler< int >
 {

Modified: trunk/lib/serialization/KnownFundamentalsHandler.tpp
===================================================================
--- trunk/lib/serialization/KnownFundamentalsHandler.tpp	2008-10-29 10:31:21 UTC (rev 1564)
+++ trunk/lib/serialization/KnownFundamentalsHandler.tpp	2008-10-29 19:29:18 UTC (rev 1565)
@@ -110,8 +110,8 @@
 			vector<string> tokens;
 			IOFormatManager::parseFundamental(*tmpStr, tokens);
 		
-			tmp->X() = lexical_cast<RealType>(tokens[0]);
-			tmp->Y() = lexical_cast<RealType>(tokens[1]);
+			tmp->X() = lexical_cast_maybeNanInf<RealType>(tokens[0]);
+			tmp->Y() = lexical_cast_maybeNanInf<RealType>(tokens[1]);
 		}
 		else if (a.type()==typeid(const vector<unsigned char>*)) // from binary stream to Type
 		{
@@ -168,9 +168,9 @@
 			vector<string> tokens;
 			IOFormatManager::parseFundamental(*tmpStr, tokens);
 		
-			tmp->X() = lexical_cast<RealType>(tokens[0]);
-			tmp->Y() = lexical_cast<RealType>(tokens[1]);
-			tmp->Z() = lexical_cast<RealType>(tokens[2]);
+			tmp->X() = lexical_cast_maybeNanInf<RealType>(tokens[0]);
+			tmp->Y() = lexical_cast_maybeNanInf<RealType>(tokens[1]);
+			tmp->Z() = lexical_cast_maybeNanInf<RealType>(tokens[2]);
 		}
 		else if (a.type()==typeid(const vector<unsigned char>*)) // from binary stream to Type
 		{
@@ -231,10 +231,10 @@
 			vector<string> tokens;
 			IOFormatManager::parseFundamental(*tmpStr, tokens);
 		
-			tmp->X() = lexical_cast<RealType>(tokens[0]);
-			tmp->Y() = lexical_cast<RealType>(tokens[1]);
-			tmp->Z() = lexical_cast<RealType>(tokens[2]);
-			tmp->W() = lexical_cast<RealType>(tokens[3]);
+			tmp->X() = lexical_cast_maybeNanInf<RealType>(tokens[0]);
+			tmp->Y() = lexical_cast_maybeNanInf<RealType>(tokens[1]);
+			tmp->Z() = lexical_cast_maybeNanInf<RealType>(tokens[2]);
+			tmp->W() = lexical_cast_maybeNanInf<RealType>(tokens[3]);
 		}
 		else if (a.type()==typeid(const vector<unsigned char>*)) // from binary stream to Type
 		{
@@ -299,10 +299,11 @@
 			vector<string> tokens;
 			IOFormatManager::parseFundamental(*tmpStr, tokens);
 		
-			*tmp = Matrix2<RealType>(	lexical_cast<RealType>(tokens[0]),
-							lexical_cast<RealType>(tokens[1]),
-							lexical_cast<RealType>(tokens[2]),
-							lexical_cast<RealType>(tokens[3]));
+			*tmp = Matrix2<RealType>(
+							lexical_cast_maybeNanInf<RealType>(tokens[0]),
+							lexical_cast_maybeNanInf<RealType>(tokens[1]),
+							lexical_cast_maybeNanInf<RealType>(tokens[2]),
+							lexical_cast_maybeNanInf<RealType>(tokens[3]));
 		}
 		else if (a.type()==typeid(const vector<unsigned char>*)) // from binary stream to Type
 		{
@@ -367,15 +368,16 @@
 			vector<string> tokens;
 			IOFormatManager::parseFundamental(*tmpStr, tokens);
 		
-			*tmp = Matrix3<RealType>(	lexical_cast<RealType>(tokens[0]),
-							lexical_cast<RealType>(tokens[1]),
-							lexical_cast<RealType>(tokens[2]),
-							lexical_cast<RealType>(tokens[3]),
-							lexical_cast<RealType>(tokens[4]),
-							lexical_cast<RealType>(tokens[5]),
-							lexical_cast<RealType>(tokens[6]),
-							lexical_cast<RealType>(tokens[7]),
-							lexical_cast<RealType>(tokens[8]));
+			*tmp = Matrix3<RealType>(
+							lexical_cast_maybeNanInf<RealType>(tokens[0]),
+							lexical_cast_maybeNanInf<RealType>(tokens[1]),
+							lexical_cast_maybeNanInf<RealType>(tokens[2]),
+							lexical_cast_maybeNanInf<RealType>(tokens[3]),
+							lexical_cast_maybeNanInf<RealType>(tokens[4]),
+							lexical_cast_maybeNanInf<RealType>(tokens[5]),
+							lexical_cast_maybeNanInf<RealType>(tokens[6]),
+							lexical_cast_maybeNanInf<RealType>(tokens[7]),
+							lexical_cast_maybeNanInf<RealType>(tokens[8]));
 		}
 		else if (a.type()==typeid(const vector<unsigned char>*)) // from binary stream to Type
 		{
@@ -460,22 +462,23 @@
 			vector<string> tokens;
 			IOFormatManager::parseFundamental(*tmpStr, tokens);
 		
-			*tmp = Matrix4<RealType>(	lexical_cast<RealType>(tokens[0]),
-							lexical_cast<RealType>(tokens[1]),
-							lexical_cast<RealType>(tokens[2]),
-							lexical_cast<RealType>(tokens[3]),
-							lexical_cast<RealType>(tokens[4]),
-							lexical_cast<RealType>(tokens[5]),
-							lexical_cast<RealType>(tokens[6]),
-							lexical_cast<RealType>(tokens[7]),
-							lexical_cast<RealType>(tokens[8]),
-							lexical_cast<RealType>(tokens[9]),
-							lexical_cast<RealType>(tokens[10]),
-							lexical_cast<RealType>(tokens[11]),
-							lexical_cast<RealType>(tokens[12]),
-							lexical_cast<RealType>(tokens[13]),
-							lexical_cast<RealType>(tokens[14]),
-							lexical_cast<RealType>(tokens[15]));
+			*tmp = Matrix4<RealType>(
+							lexical_cast_maybeNanInf<RealType>(tokens[0]),
+							lexical_cast_maybeNanInf<RealType>(tokens[1]),
+							lexical_cast_maybeNanInf<RealType>(tokens[2]),
+							lexical_cast_maybeNanInf<RealType>(tokens[3]),
+							lexical_cast_maybeNanInf<RealType>(tokens[4]),
+							lexical_cast_maybeNanInf<RealType>(tokens[5]),
+							lexical_cast_maybeNanInf<RealType>(tokens[6]),
+							lexical_cast_maybeNanInf<RealType>(tokens[7]),
+							lexical_cast_maybeNanInf<RealType>(tokens[8]),
+							lexical_cast_maybeNanInf<RealType>(tokens[9]),
+							lexical_cast_maybeNanInf<RealType>(tokens[10]),
+							lexical_cast_maybeNanInf<RealType>(tokens[11]),
+							lexical_cast_maybeNanInf<RealType>(tokens[12]),
+							lexical_cast_maybeNanInf<RealType>(tokens[13]),
+							lexical_cast_maybeNanInf<RealType>(tokens[14]),
+							lexical_cast_maybeNanInf<RealType>(tokens[15]));
 		}
 		else if (a.type()==typeid(const vector<unsigned char>*)) // from binary stream to Type
 		{
@@ -594,17 +597,17 @@
 		
 			if (tokens.size()==3) // Quaternion is written as axis which norm is the angle in radian
 			{
-				axis[0] = lexical_cast<RealType>(tokens[0]);
-				axis[1] = lexical_cast<RealType>(tokens[1]);
-				axis[2] = lexical_cast<RealType>(tokens[2]);
+				axis[0] = lexical_cast_maybeNanInf<RealType>(tokens[0]);
+				axis[1] = lexical_cast_maybeNanInf<RealType>(tokens[1]);
+				axis[2] = lexical_cast_maybeNanInf<RealType>(tokens[2]);
 				angle = axis.Normalize();
 			}
 			else // tokens.size()==4 Quaternion is written as axis angle
 			{
-				axis[0] = lexical_cast<RealType>(tokens[0]);
-				axis[1] = lexical_cast<RealType>(tokens[1]);
-				axis[2] = lexical_cast<RealType>(tokens[2]);
-				angle   = lexical_cast<RealType>(tokens[3]);
+				axis[0] = lexical_cast_maybeNanInf<RealType>(tokens[0]);
+				axis[1] = lexical_cast_maybeNanInf<RealType>(tokens[1]);
+				axis[2] = lexical_cast_maybeNanInf<RealType>(tokens[2]);
+				angle   = lexical_cast_maybeNanInf<RealType>(tokens[3]);
 			}
 			tmp->FromAxisAngle(axis,angle);
 		}
@@ -687,23 +690,23 @@
 		
 			if (tokens.size()==6) // Quaternion is written as axis which norm is the angle in radian
 			{
-				position[0]	= lexical_cast<RealType>(tokens[0]);
-				position[1]	= lexical_cast<RealType>(tokens[1]);
-				position[2]	= lexical_cast<RealType>(tokens[2]);
-				axis[0]		= lexical_cast<RealType>(tokens[4]);
-				axis[1]		= lexical_cast<RealType>(tokens[3]);
-				axis[2]		= lexical_cast<RealType>(tokens[5]);
+				position[0]	= lexical_cast_maybeNanInf<RealType>(tokens[0]);
+				position[1]	= lexical_cast_maybeNanInf<RealType>(tokens[1]);
+				position[2]	= lexical_cast_maybeNanInf<RealType>(tokens[2]);
+				axis[0]		= lexical_cast_maybeNanInf<RealType>(tokens[4]);
+				axis[1]		= lexical_cast_maybeNanInf<RealType>(tokens[3]);
+				axis[2]		= lexical_cast_maybeNanInf<RealType>(tokens[5]);
 				angle		= axis.Normalize();
 			}
 			else // tokens.size()==7 Quaternion is writted as axis angle
 			{
-				position[0]	= lexical_cast<RealType>(tokens[0]);
-				position[1]	= lexical_cast<RealType>(tokens[1]);
-				position[2]	= lexical_cast<RealType>(tokens[2]);
-				axis[0]		= lexical_cast<RealType>(tokens[3]);
-				axis[1]		= lexical_cast<RealType>(tokens[4]);
-				axis[2]		= lexical_cast<RealType>(tokens[5]);
-				angle		= lexical_cast<RealType>(tokens[6]);
+				position[0]	= lexical_cast_maybeNanInf<RealType>(tokens[0]);
+				position[1]	= lexical_cast_maybeNanInf<RealType>(tokens[1]);
+				position[2]	= lexical_cast_maybeNanInf<RealType>(tokens[2]);
+				axis[0]		= lexical_cast_maybeNanInf<RealType>(tokens[3]);
+				axis[1]		= lexical_cast_maybeNanInf<RealType>(tokens[4]);
+				axis[2]		= lexical_cast_maybeNanInf<RealType>(tokens[5]);
+				angle		= lexical_cast_maybeNanInf<RealType>(tokens[6]);
 			}
 			orientation.FromAxisAngle(axis,angle);
 			*tmp = Se3<RealType>(position,orientation);

Modified: trunk/pkg/dem/PreProcessor/MembraneTest.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/MembraneTest.cpp	2008-10-29 10:31:21 UTC (rev 1564)
+++ trunk/pkg/dem/PreProcessor/MembraneTest.cpp	2008-10-29 19:29:18 UTC (rev 1565)
@@ -301,7 +301,7 @@
 	//interactionGeometryDispatcher->add("InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron");
 
 	shared_ptr<InteractingGeometryMetaEngine> interactingGeometryDispatcher	= shared_ptr<InteractingGeometryMetaEngine>(new InteractingGeometryMetaEngine);
-	//interactingGeometryDispatcher->add("ef2_BshTube_BssSweptSphereLineSegment_makeBssSweptSphereLineSegment");
+	interactingGeometryDispatcher->add("ef2_BshTube_BssSweptSphereLineSegment_makeBssSweptSphereLineSegment");
 	
 	shared_ptr<BoundingVolumeMetaEngine> boundingVolumeDispatcher	= shared_ptr<BoundingVolumeMetaEngine>(new BoundingVolumeMetaEngine);
 	boundingVolumeDispatcher->add("InteractingSphere2AABB"); // 

Modified: trunk/pkg/dem/PreProcessor/TriaxialTest.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/TriaxialTest.cpp	2008-10-29 10:31:21 UTC (rev 1564)
+++ trunk/pkg/dem/PreProcessor/TriaxialTest.cpp	2008-10-29 19:29:18 UTC (rev 1565)
@@ -94,7 +94,7 @@
 	lowerCorner 		= Vector3r(0,0,0);
 	upperCorner 		= Vector3r(1,1,1);
 	thickness 		= 0.001;
-	importFilename 		= "../../YADE/trunk-clean/examples/sphere16bidisperse.txt"; // "./small.sdec.xyz";
+	importFilename 		= ""; // oh, PLEASE, keep this empty -- i.e., by default, generate spheres in the box, not load them.
 	Key			="";
 	outputFileName 		= "./TriaxialTest"+Key+".xml";
 	//nlayers = 1;
@@ -260,6 +260,7 @@
 	REGISTER_ATTRIBUTE(DieCompaction);
 	REGISTER_ATTRIBUTE(translationspeed);
 	REGISTER_ATTRIBUTE(wishedporosity);
+	REGISTER_ATTRIBUTE(fixedBoxDims);
  
 
 
@@ -301,9 +302,13 @@
 
 	if(radiusMean<=0) really_radiusMean=pow(volume*(1-porosity)/(Mathr::PI*(4/3.)*numberOfGrains),1/3.);
 	else {
-		Real boxScaleFactor=radiusMean*pow((4/3.)*Mathr::PI*numberOfGrains/(volume*(1-porosity)),1/3.);
-		LOG_INFO("Mean radius value of "<<radiusMean<<" requested, scaling box by "<<boxScaleFactor);
-		dimensions*=boxScaleFactor;
+		bool fixedDims[3];
+		fixedDims[0]=fixedBoxDims.find('x')!=string::npos; fixedDims[1]=fixedBoxDims.find('y')!=string::npos; fixedDims[2]=fixedBoxDims.find('z')!=string::npos;
+		int nScaled=(3-(int)fixedDims[0]+(int)fixedDims[1]+(int)fixedDims[2]);
+		if(nScaled==3) throw std::invalid_argument("At most 2 (not 3) axes can have fixed dimensions in fixedBoxDims if scaling for given radiusMean.");
+		Real boxScaleFactor=radiusMean*pow((4/3.)*Mathr::PI*numberOfGrains/(volume*(1-porosity)),1./nScaled);
+		LOG_INFO("Mean radius value of "<<radiusMean<<" requested, scaling "<<nScaled<<" dimensions by "<<boxScaleFactor);
+		dimensions[0]*=fixedDims[0]?1.:boxScaleFactor; dimensions[1]*=fixedDims[1]?1.:boxScaleFactor; dimensions[2]*=fixedDims[2]?1.:boxScaleFactor;
 		upperCorner=lowerCorner+dimensions;
 		really_radiusMean=radiusMean;
 	}

Modified: trunk/pkg/dem/PreProcessor/TriaxialTest.hpp
===================================================================
--- trunk/pkg/dem/PreProcessor/TriaxialTest.hpp	2008-10-29 10:31:21 UTC (rev 1564)
+++ trunk/pkg/dem/PreProcessor/TriaxialTest.hpp	2008-10-29 19:29:18 UTC (rev 1565)
@@ -120,7 +120,9 @@
 		string		importFilename
 				,AnimationSnapshotsBaseName
 				,WallStressRecordFile
-				,Key;//A code that is added to output filenames
+				,Key //A code that is added to output filenames
+				//! string that contains some subset (max. 2) of {'x','y','z'} ; containes axes will have box dimension hardcoded, even if box is scaled as mean_radius is prescribed: scaling will be applied on the rest.
+				,fixedBoxDims;
 	
 		shared_ptr<TriaxialCompressionEngine> triaxialcompressionEngine;
 		shared_ptr<TriaxialStressController> triaxialstressController;


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Wed Oct 29 20:58:37 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Wed, 29 Oct 2008 20:58:37 +0100
Subject: [deprecated list] [Yade-dev] recent changes in
	TriaxialCompressionEngine
Message-ID: <4908C06D.6030903@arcig.cz>

Hi Jean-Fran?ois,

according to the svn log, you did some modifications to
TriaxialCompressionEngine, which made a few things break for me. Please
bear in mind:

1. always document things that you implement: what is
STATE_DIE_COMPRESSION, wishedPorosity, dieCompation, for example?

2. To the extent as it is practical, also try to keep the default
behavior the same, as long your new parameters are not set. I expect
triaxial to behave identically even if you add some porosity stuff, as
long as I don't set wishedporosity etc.

I reset wishedporosity to -1 by default, since otherwise regular
triaxial would never stop:

 (UnbalancedForce<=StabilityCriterion && abs ( ( meanStress-sigma_iso )
/sigma_iso ) <0.005 && wishedporosity<1)

you get the point, right?Other simulations depend on many of default
params, be thoughtful... Changing inputFile to TriaxialGenerator is
certainly bad idea, since that particular file probably exists only on
your computer. I reverted that as well, to empty string, which has a
special meaning to generate random packing.

If you are not sure, there is always the list where other people can
tell whether they care if you change something.

Regards, Vaclav





_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Wed Oct 29 22:33:50 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 29 Oct 2008 22:33:50 +0100
Subject: [deprecated list] [Yade-dev] recent changes in
	TriaxialCompressionEngine
In-Reply-To: <380-2200810329212855676@M2W042.mail2web.com>
References: <380-2200810329212855676@M2W042.mail2web.com>
Message-ID: <4908D6BE.3020307@arcig.cz>

(make sure you reply to the list, not to me directly)
>   Sure, there is a problem for the other state in a
> TriaxialCompressionEngine.cpp, the condition && wishedporosity < 1 is
> wrong. I was too happy to realize my first commit.
> I am sorry for the generated problems. I think the best thing to do is to
> replace the files : triaxialcompressionengine, triaxialtest,
> triaxialstaterecorder, elasticcontactinteraction by the same files just
> before my commit. I am conscious, it is not the wonder solution.
>   
No problem with the code commited, I think that we can keep it, because
it can certainly be useful, it will be ironed our progressively. Unless
you really want to revert your changes, which should be quite easy --
svn has all the history.
> Concerning: STATE_DIE_COMPRESSION is a new state in the triaxail simulation
> in order to realize a compaction by the wall displacement until a porosity
> controlled (parameter : wishedPorosity) by the user.
> The code calculates the porosity in a cube (parameter: calculatedporosity),
> when the wishedPorosity equal to calculatedporosity => the simulation is
> stopped.
>
> To resume, it is an isotropic compaction until a fixed porosity value.
>   
Nice explanation. Now just copy&paste that to
TriaxialCompressionEngine.hpp, to the big comment before "class
TriaxialCompressionEngine :-)

A+, Vaclav


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From duriez at geo.hmg.inpg.fr  Wed Oct 29 15:39:50 2008
From: duriez at geo.hmg.inpg.fr (Jerome Duriez)
Date: Wed, 29 Oct 2008 15:39:50 +0100
Subject: [deprecated list] [Yade-dev] Incomprehensible crash
In-Reply-To: <4eb6799e0810290736w6d76a698kd4960ce301fca547@mail.gmail.com>
References: <4eb6799e0810290736w6d76a698kd4960ce301fca547@mail.gmail.com>
Message-ID: <490875B6.4030609@geo.hmg.inpg.fr>


Vincent Richefeu a ?crit :
> The following is the beginning of the console log:
>
>   
It's better if you send the whole message. It seems hard to believe but 
some of us succeed in understanding something from it !

Jerome

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From richefeu at geo.hmg.inpg.fr  Wed Oct 29 15:51:15 2008
From: richefeu at geo.hmg.inpg.fr (Vincent Richefeu)
Date: Wed, 29 Oct 2008 15:51:15 +0100
Subject: [deprecated list] [Yade-dev] Incomprehensible crash
In-Reply-To: <490875B6.4030609@geo.hmg.inpg.fr>
References: <4eb6799e0810290736w6d76a698kd4960ce301fca547@mail.gmail.com>
	<490875B6.4030609@geo.hmg.inpg.fr>
Message-ID: <0CE3986B-6408-4C8A-8C75-EDFA81E6EF55@geo.hmg.inpg.fr>


>> The following is the beginning of the console log:
>>
>>
> It's better if you send the whole message. It seems hard to believe  
> but some of us succeed in understanding something from it !
>
> Jerome

OK, sorry.
here is the complet log:

In [1]: SIGSEGV/SIGABRT handler called; gdb batch file is
`/home/vincent/.yade-svn1564/gdb_crash_batch-pid7103'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/ 
gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show  
copying"
and "show warranty" for details.
This GDB was configured as "i486-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0xb5345700 (LWP 7103)]
[New Thread 0xaf7c9b90 (LWP 7107)]
[New Thread 0xb002eb90 (LWP 7105)]
[New Thread 0xb0f36b90 (LWP 7104)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at  
000000b4
0xb7f64410 in __kernel_vsyscall ()
No symbol "info" in current context.

Thread 4 (Thread 0xb0f36b90 (LWP 7104)):
#0  0xb7f64410 in __kernel_vsyscall ()
#1  0xb71ab881 in select () from /lib/tls/i686/cmov/libc.so.6
#2  0xb00b6aa9 in ?? () from /usr/lib/python2.5/lib-dynload/readline.so
#3  0xb7e35be8 in PyOS_Readline () from /usr/lib/libpython2.5.so.1.0
#4  0xb7eb33d7 in ?? () from /usr/lib/libpython2.5.so.1.0
#5  0xb7e6f5ea in PyCFunction_Call () from /usr/lib/libpython2.5.so.1.0
#6  0xb7ebde16 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so. 
1.0
#7  0xb7ebf5a8 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#8  0xb7ebdafc in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so. 
1.0
#9  0xb7ebf5a8 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#10 0xb7ebdafc in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so. 
1.0
#11 0xb7ebf5a8 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#12 0xb7ebdafc in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so. 
1.0
#13 0xb7ebf5a8 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#14 0xb7e5b676 in ?? () from /usr/lib/libpython2.5.so.1.0
#15 0xb7e38897 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#16 0xb7e4009c in ?? () from /usr/lib/libpython2.5.so.1.0
#17 0xb7e38897 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#18 0xb7e40666 in ?? () from /usr/lib/libpython2.5.so.1.0
#19 0xb7e38897 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#20 0xb7ebaeb0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so. 
1.0
#21 0xb7ebf5a8 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#22 0xb7ebf703 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#23 0xb7ee2b1a in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#24 0xb7ee2e1a in PyRun_SimpleFileExFlags () from /usr/lib/ 
libpython2.5.so.1.0
#25 0xb427f268 in PythonUI::execScript (script=@0xb0f36274) at
gui/py/PythonUI.cpp:44
#26 0xb427ffdd in PythonUI::pythonSession () at gui/py/PythonUI.cpp:96
#27 0xb412a68b in boost::detail::function::void_function_invoker0<void
(*)(), void>::invoke (function_ptr=@0xb0f36360) at
/usr/include/boost/function/function_template.hpp:114
#28 0xb7db601b in boost::function0<void,
std::allocator<boost::function_base> >::operator() () from
/usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#29 0xb7db5c27 in ?? () from /usr/lib/libboost_thread-gcc42- 
mt-1_34_1.so.1.34.1
#30 0xb7e044fb in start_thread () from /lib/tls/i686/cmov/ 
libpthread.so.0
#31 0xb71b2e5e in clone () from /lib/tls/i686/cmov/libc.so.6

Thread 3 (Thread 0xb002eb90 (LWP 7105)):
#0  0xb7f64410 in __kernel_vsyscall ()
#1  0xb7e0bbb8 in accept () from /lib/tls/i686/cmov/libpthread.so.0
#2  0xb0fe4e84 in ?? () from /usr/lib/python2.5/lib-dynload/_socket.so
#3  0xb7ebd6ce in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so. 
1.0
#4  0xb7ebe490 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so. 
1.0
#5  0xb7ebe490 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so. 
1.0
#6  0xb7ebe490 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so. 
1.0
#7  0xb7ebf5a8 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#8  0xb7e5b676 in ?? () from /usr/lib/libpython2.5.so.1.0
#9  0xb7e38897 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#10 0xb7e4009c in ?? () from /usr/lib/libpython2.5.so.1.0
#11 0xb7e38897 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#12 0xb7eb6dec in PyEval_CallObjectWithKeywords () from
/usr/lib/libpython2.5.so.1.0
#13 0xb7eeef34 in ?? () from /usr/lib/libpython2.5.so.1.0
#14 0xb7e044fb in start_thread () from /lib/tls/i686/cmov/ 
libpthread.so.0
#15 0xb71b2e5e in clone () from /lib/tls/i686/cmov/libc.so.6

Thread 2 (Thread 0xaf7c9b90 (LWP 7107)):
#0  0xb7f64410 in __kernel_vsyscall ()
#1  0xb71714fb in waitpid () from /lib/tls/i686/cmov/libc.so.6
#2  0xb7114643 in ?? () from /lib/tls/i686/cmov/libc.so.6
#3  0xb7114a02 in system () from /lib/tls/i686/cmov/libc.so.6
#4  0xb7e0cd7d in system () from /lib/tls/i686/cmov/libpthread.so.0
#5  0x0813458a in sigHandler (sig=11) at core/yade.cpp:60
#6  <signal handler called>
#7  0xb3e903a2 in DynLibDispatcher<Loki::Typelist<GeometricalModel,
Loki::Typelist<InteractingGeometry, Loki::NullType> >,
InteractingGeometryEngineUnit, void,
Loki::Typelist<boost::shared_ptr<GeometricalModel> const&,
Loki::Typelist<boost::shared_ptr<InteractingGeometry>&,
Loki::Typelist<Se3<double> const&, Loki::Typelist<Body const*,
Loki::NullType> > > >, true>::locateMultivirtualFunctor2D
(this=0x8bc3674, index1=@0xaf7c9254, index2=@0xaf7c9258,
base1=@0x8bc3d10, base2=@0x8bc3d18) at
/usr/include/boost/shared_ptr.hpp:363
#8  0xb3e77d05 in InteractingGeometryMetaEngine::action
(this=0x8bc3650, ncb=0x8bc0350) at
/home/vincent/yade-local/build-svn1564/include/yade-svn1564/yade/lib- 
multimethods/DynLibDispatcher.hpp:856
#9  0x080dda74 in MetaBody::moveToNextTimeStep (this=0x8bc0350) at
core/MetaBody.cpp:93
#10 0x0812c757 in SimulationFlow::singleAction (this=0x81944f8) at
core/SimulationFlow.cpp:18
#11 0x08130cad in ThreadWorker::callSingleAction (this=0x81944f8) at
core/ThreadWorker.cpp:71
#12 0x081303e6 in ThreadRunner::call (this=0x8bac118) at
core/ThreadRunner.cpp:44
#13 0xb7db601b in boost::function0<void,
std::allocator<boost::function_base> >::operator() () from
/usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#14 0xb7db5c27 in ?? () from /usr/lib/libboost_thread-gcc42- 
mt-1_34_1.so.1.34.1
#15 0xb7e044fb in start_thread () from /lib/tls/i686/cmov/ 
libpthread.so.0
#16 0xb71b2e5e in clone () from /lib/tls/i686/cmov/libc.so.6

Thread 1 (Thread 0xb5345700 (LWP 7103)):
#0  0xb7f64410 in __kernel_vsyscall ()
#1  0xb71ab881 in select () from /lib/tls/i686/cmov/libc.so.6
#2  0xb77440e3 in QEventLoop::processEvents () from /usr/lib/libqt- 
mt.so.3
#3  0xb77b9f90 in QEventLoop::enterLoop () from /usr/lib/libqt-mt.so.3
#4  0xb77b9c8e in QEventLoop::exec () from /usr/lib/libqt-mt.so.3
#5  0xb77a07df in QApplication::exec () from /usr/lib/libqt-mt.so.3
#6  0xb4126dfe in QtGUI::run (this=0x8269ce8, argc=1, argv=0xbfd863b4)
at gui/qt3/QtGUI.cpp:69
#7  0x08136dd2 in main (argc=1, argv=0xbfd863b4) at core/yade.cpp:253
#0  0xb7f64410 in __kernel_vsyscall ()
Erreur de segmentation


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From duriez at geo.hmg.inpg.fr  Wed Oct 29 16:11:51 2008
From: duriez at geo.hmg.inpg.fr (Jerome Duriez)
Date: Wed, 29 Oct 2008 16:11:51 +0100
Subject: [deprecated list] [Yade-dev] Incomprehensible crash
In-Reply-To: <0CE3986B-6408-4C8A-8C75-EDFA81E6EF55@geo.hmg.inpg.fr>
References: <4eb6799e0810290736w6d76a698kd4960ce301fca547@mail.gmail.com>	<490875B6.4030609@geo.hmg.inpg.fr>
	<0CE3986B-6408-4C8A-8C75-EDFA81E6EF55@geo.hmg.inpg.fr>
Message-ID: <49087D37.1020806@geo.hmg.inpg.fr>

 From this you can extract in fact "only" these two ? : (from thread 2)

#7  0xb3e903a2 in DynLibDispatcher<Loki::Typelist<GeometricalModel,
Loki::Typelist<InteractingGeometry, Loki::NullType> >,
InteractingGeometryEngineUnit, void,
Loki::Typelist<boost::shared_ptr<GeometricalModel> const&,
Loki::Typelist<boost::shared_ptr<InteractingGeometry>&,
Loki::Typelist<Se3<double> const&, Loki::Typelist<Body const*,
Loki::NullType> > > >, true>::locateMultivirtualFunctor2D
(this=0x8bc3674, index1=@0xaf7c9254, index2=@0xaf7c9258,
base1=@0x8bc3d10, base2=@0x8bc3d18) at
/usr/include/boost/shared_ptr.hpp:363
#8  0xb3e77d05 in InteractingGeometryMetaEngine::action
(this=0x8bc3650, ncb=0x8bc0350) at
/home/vincent/yade-local/build-svn1564/include/yade-svn1564/yade/lib-multimethods/DynLibDispatcher.hpp:856 


Why only these two ? First because that they are surely the only ones 
that mean something for you (it speaks about 
InteractingGeometryMetaEngine, InteractingGeometry and you begin surely 
to interest about it) whereas it is normal (at least, it is my case) to 
not see at all to what the others could refer ! Moreover you will surely 
see, after a few crashes..., that most of these lines you understand 
nothing are always the same, and only a few, corresponding generally to 
files you modified..., differ at each time.
    So these lines say you that it is more precisely during the 
execution of InteractingGeometryMetaEngine::action, that something goes 
wrong. What could this be ?? A wrong type of parameter (Body instead of 
Metabody for exemple), access to the 10th element of something which has 
only 5, so more or less all...
But now you know a bit more where to search...

Jerome

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From richefeu at gmail.com  Wed Oct 29 15:36:35 2008
From: richefeu at gmail.com (Vincent Richefeu)
Date: Wed, 29 Oct 2008 15:36:35 +0100
Subject: [deprecated list] [Yade-dev] Incomprehensible crash
Message-ID: <4eb6799e0810290736w6d76a698kd4960ce301fca547@mail.gmail.com>

Hello,

I still got problems with 'MembraneTest'.
It crash at the first time step. I really can't understand why!
If someone has an idea, I'm taker...

The files MembraneTest.* have been added in the svn repository into
the folder pkg/dem/PreProcessor.
The following is the beginning of the console log:

 SIGSEGV/SIGABRT handler called; gdb batch file is
`/home/vincent/.yade-svn1564/gdb_crash_batch-pid7103'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "i486-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0xb5345700 (LWP 7103)]
[New Thread 0xaf7c9b90 (LWP 7107)]
[New Thread 0xb002eb90 (LWP 7105)]
[New Thread 0xb0f36b90 (LWP 7104)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 000000b4
0xb7f64410 in __kernel_vsyscall ()
No symbol "info" in current context.

[...]

Thanks again for answers,

Vincent

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From richefeu at mail.berlios.de  Thu Oct 30 09:50:59 2008
From: richefeu at mail.berlios.de (richefeu at BerliOS)
Date: Thu, 30 Oct 2008 09:50:59 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1566 - in trunk/pkg:
	common	common/DataClass/InteractingGeometry
	common/Engine/EngineUnit	common/RenderingEngine/GLDrawGeometricalModel	common/RenderingEngine/GLDrawInteractingGeometry
	dem/PreProcessor
Message-ID: <200810300850.m9U8ox7e018612@sheep.berlios.de>

Author: richefeu
Date: 2008-10-30 09:50:59 +0100 (Thu, 30 Oct 2008)
New Revision: 1566

Added:
   trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawBssSweptSphereLineSegment.cpp
   trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawBssSweptSphereLineSegment.hpp
Modified:
   trunk/pkg/common/DataClass/InteractingGeometry/BssSweptSphereLineSegment.hpp
   trunk/pkg/common/Engine/EngineUnit/ef2_BshTube_BssSweptSphereLineSegment_makeBssSweptSphereLineSegment.cpp
   trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTube.cpp
   trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTube.hpp
   trunk/pkg/common/SConscript
   trunk/pkg/dem/PreProcessor/MembraneTest.cpp
Log:
- add GLDraw plugin for BssSweptSphereLineSegment displaying


Modified: trunk/pkg/common/DataClass/InteractingGeometry/BssSweptSphereLineSegment.hpp
===================================================================
--- trunk/pkg/common/DataClass/InteractingGeometry/BssSweptSphereLineSegment.hpp	2008-10-29 19:29:18 UTC (rev 1565)
+++ trunk/pkg/common/DataClass/InteractingGeometry/BssSweptSphereLineSegment.hpp	2008-10-30 08:50:59 UTC (rev 1566)
@@ -1,6 +1,6 @@
 /*************************************************************************
 *  Copyright (C) 2008 by Vincent Richefeu                                *
-*  vincent.richefeu at hmg.inpg.fr                                               *
+*  vincent.richefeu at hmg.inpg.fr                                          *
 *                                                                        *
 *  This program is free software; it is licensed under the terms of the  *
 *  GNU General Public License v2 or later. See file LICENSE for details. *

Modified: trunk/pkg/common/Engine/EngineUnit/ef2_BshTube_BssSweptSphereLineSegment_makeBssSweptSphereLineSegment.cpp
===================================================================
--- trunk/pkg/common/Engine/EngineUnit/ef2_BshTube_BssSweptSphereLineSegment_makeBssSweptSphereLineSegment.cpp	2008-10-29 19:29:18 UTC (rev 1565)
+++ trunk/pkg/common/Engine/EngineUnit/ef2_BshTube_BssSweptSphereLineSegment_makeBssSweptSphereLineSegment.cpp	2008-10-30 08:50:59 UTC (rev 1566)
@@ -20,16 +20,17 @@
   //if(ig == 0)
   //  ig = boost::shared_ptr<InteractingGeometry>(new BshTube);
 
-  BssSweptSphereLineSegment* SSLS = YADE_CAST<BssSweptSphereLineSegment*>(ig.get());
+  BssSweptSphereLineSegment* SSLS = static_cast<BssSweptSphereLineSegment*>(ig.get());
   
   SSLS->radius = tube->radius;
-  SSLS->length = 2.0 * tube->half_height;
+  //SSLS->length = 2.0 * tube->half_height;
   
-  BcpConnection* bc = YADE_CAST<BcpConnection*>(body->physicalParameters.get());
+  BcpConnection* bc = static_cast<BcpConnection*>(body->physicalParameters.get());
 
   SSLS->position = (*(Omega::instance().getRootBody()->bodies))[bc->id1]->physicalParameters->se3.position;
   Vector3r len = (*(Omega::instance().getRootBody()->bodies))[bc->id2]->physicalParameters->se3.position - SSLS->position;
-  *(SSLS->orientation) = len.Normalize();
+  SSLS->length = len.Normalize();
+  SSLS->orientation = len;
   
 }
 	

Modified: trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTube.cpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTube.cpp	2008-10-29 19:29:18 UTC (rev 1565)
+++ trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTube.cpp	2008-10-30 08:50:59 UTC (rev 1566)
@@ -11,7 +11,10 @@
 #include<yade/lib-opengl/OpenGLWrapper.hpp>
 #include<yade/lib-base/yadeWm3.hpp>
 
-
+bool GLDrawTube::first           = true;
+int  GLDrawTube::glWiredTubeList = -1;
+int  GLDrawTube::glTubeList      = -1;
+    
 void GLDrawTube::go(const shared_ptr<GeometricalModel>& gm, const shared_ptr<PhysicalParameters>&,bool wire)
 {
 	

Modified: trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTube.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTube.hpp	2008-10-29 19:29:18 UTC (rev 1565)
+++ trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTube.hpp	2008-10-30 08:50:59 UTC (rev 1566)
@@ -11,12 +11,13 @@
 
 #include<yade/pkg-common/GLDrawFunctors.hpp>
 
+
 class GLDrawTube : public GLDrawGeometricalModelFunctor
 {
 	private :
-		bool first;
-		int  glWiredTubeList;
-		int  glTubeList;
+		static bool first;
+		static int  glWiredTubeList;
+		static int  glTubeList;
                 
 	public :
 		virtual void go(const shared_ptr<GeometricalModel>&, const shared_ptr<PhysicalParameters>&,bool);

Added: trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawBssSweptSphereLineSegment.cpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawBssSweptSphereLineSegment.cpp	2008-10-29 19:29:18 UTC (rev 1565)
+++ trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawBssSweptSphereLineSegment.cpp	2008-10-30 08:50:59 UTC (rev 1566)
@@ -0,0 +1,73 @@
+/*************************************************************************
+*  Copyright (C) 2008 by Vincent Richefeu                                *
+*  vincent.richefeu at hmg.inpg.fr                                          *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#include "GLDrawBssSweptSphereLineSegment.hpp"
+#include<yade/pkg-common/BssSweptSphereLineSegment.hpp>
+#include<yade/lib-opengl/OpenGLWrapper.hpp>
+
+bool GLDrawBssSweptSphereLineSegment::first       = true;
+int  GLDrawBssSweptSphereLineSegment::glList      = -1;
+int  GLDrawBssSweptSphereLineSegment::glWiredList = -1;
+
+GLDrawBssSweptSphereLineSegment::GLDrawBssSweptSphereLineSegment(){ /*first=true;*/ };
+
+void GLDrawBssSweptSphereLineSegment::go(const shared_ptr<InteractingGeometry>& cm, const shared_ptr<PhysicalParameters>& ,bool)
+{
+        
+  if (first)
+  {        
+        const Real my2PI  = 6.28318530717958647692;
+        const Real myPI_6 = 5.23598775598298873077e-1;
+                                
+        glList = glGenLists(1);
+        glNewList(glList,GL_COMPILE);
+        glDisable(GL_CULL_FACE);
+        glEnable(GL_LIGHTING);
+        glBegin(GL_TRIANGLE_STRIP);
+        for (Real a = 0.0 ; a < my2PI ; a += myPI_6)
+        {
+                glVertex3f(-1.0f, cos(a), sin(a));
+                glVertex3f( 1.0f, cos(a), sin(a));
+        }
+                glVertex3f(-1.0f, cos(0.0), sin(0.0));
+                glVertex3f( 1.0f, cos(0.0), sin(0.0));
+        glEnd(); 
+        glEndList();
+                
+        first = false;
+  }
+
+  BssSweptSphereLineSegment* ssls = static_cast<BssSweptSphereLineSegment*> (cm.get());
+  
+  Real radius = ssls->radius;
+  Real half_length = 0.5 * ssls->length;
+
+  glMaterialv(GL_FRONT, GL_AMBIENT_AND_DIFFUSE, Vector3f(cm->diffuseColor[0],cm->diffuseColor[1],cm->diffuseColor[2]));
+  glColor3v(cm->diffuseColor);
+  
+  static GLUquadric* quadric = gluNewQuadric();
+  
+  glPushMatrix();
+  glScalef(half_length,radius,radius);
+  glCallList(glList);
+  glPopMatrix();
+  
+  // It is not very elegant but it provides assistance
+  // TODO - write a gl-list that draw 2 halh spheres 
+  glTranslate(-half_length, 0.0, 0.0);
+  gluSphere(quadric, radius, 5, 5);
+  glTranslate(2.0*half_length, 0.0, 0.0);
+  gluSphere(quadric, radius, 5, 5);
+}
+
+
+
+
+
+YADE_PLUGIN();
+

Added: trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawBssSweptSphereLineSegment.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawBssSweptSphereLineSegment.hpp	2008-10-29 19:29:18 UTC (rev 1565)
+++ trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawBssSweptSphereLineSegment.hpp	2008-10-30 08:50:59 UTC (rev 1566)
@@ -0,0 +1,36 @@
+/*************************************************************************
+*  Copyright (C) 2008 by Vincent Richefeu                                *
+*  vincent.richefeu at hmg.inpg.fr                                          *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#ifndef GLDRAW_BSS_SWEPT_SPHERE_LINE_SEGMENT_HPP
+#define GLDRAW_BSS_SWEPT_SPHERE_LINE_SEGMENT_HPP
+
+#include<yade/pkg-common/GLDrawFunctors.hpp>
+
+class GLDrawBssSweptSphereLineSegment : public GLDrawInteractingGeometryFunctor
+{	
+	private :
+		static bool first;
+		static int  glWiredList;
+		static int  glList;
+	
+	public :
+                GLDrawBssSweptSphereLineSegment();
+		virtual void go(const shared_ptr<InteractingGeometry>&, const shared_ptr<PhysicalParameters>&,bool);
+/// Serialization
+	protected :
+		virtual void postProcessAttributes(bool deserializing){if(deserializing){first=true;};};
+
+        RENDERS(BssSweptSphereLineSegment);
+        REGISTER_CLASS_NAME(GLDrawBssSweptSphereLineSegment);
+	REGISTER_BASE_CLASS_NAME(GLDrawInteractingGeometryFunctor);
+};
+
+REGISTER_SERIALIZABLE(GLDrawBssSweptSphereLineSegment,false);
+
+#endif //  GLDRAW_BSS_SWEPT_SPHERE_LINE_SEGMENT_HPP
+

Modified: trunk/pkg/common/SConscript
===================================================================
--- trunk/pkg/common/SConscript	2008-10-29 19:29:18 UTC (rev 1565)
+++ trunk/pkg/common/SConscript	2008-10-30 08:50:59 UTC (rev 1566)
@@ -164,7 +164,7 @@
 	env.SharedLibrary('GLDrawMesh2D',['RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D.cpp'],
 		LIBS=env['LIBS']+['yade-base','Mesh2D','yade-opengl']),
 	env.SharedLibrary('GLDrawSphere',['RenderingEngine/GLDrawGeometricalModel/GLDrawSphere.cpp'],
-		LIBS=env['LIBS']+['yade-base','Sphere','yade-opengl']),
+		LIBS=env['LIBS']+['yade-base','Sphere','yade-opengl']),               
 	env.SharedLibrary('GLDrawQuadrilateral',['RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral.cpp'],
 		LIBS=env['LIBS']+['yade-base','Quadrilateral','yade-opengl']),
 	env.SharedLibrary('GLDrawFacet',['RenderingEngine/GLDrawGeometricalModel/GLDrawFacet.cpp']
@@ -173,6 +173,8 @@
 		LIBS=env['LIBS']+['yade-base','InteractingBox','yade-opengl']),
 	env.SharedLibrary('GLDrawInteractingSphere',['RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere.cpp'],
 		LIBS=env['LIBS']+['yade-base','InteractingSphere','yade-opengl'],),
+         env.SharedLibrary('GLDrawBssSweptSphereLineSegment',['RenderingEngine/GLDrawInteractingGeometry/GLDrawBssSweptSphereLineSegment.cpp'],
+                LIBS=env['LIBS']+['yade-base','BssSweptSphereLineSegment','yade-opengl']),               
 	env.SharedLibrary('GLDrawMetaInteractingGeometry',['RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry.cpp'],
 		LIBS=env['LIBS']+['yade-opengl']),
 	env.SharedLibrary('GLDrawInteractingFacet',['RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingFacet.cpp']

Modified: trunk/pkg/dem/PreProcessor/MembraneTest.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/MembraneTest.cpp	2008-10-29 19:29:18 UTC (rev 1565)
+++ trunk/pkg/dem/PreProcessor/MembraneTest.cpp	2008-10-30 08:50:59 UTC (rev 1566)
@@ -204,6 +204,8 @@
         tube->half_height           = 0.5 * link.Length();
         tube->diffuseColor          = Vector3r(Mathr::UnitRandom(),Mathr::UnitRandom(),Mathr::UnitRandom());
         
+        bss->diffuseColor           = Vector3r(Mathr::UnitRandom(),Mathr::UnitRandom(),Mathr::UnitRandom());
+        
         body->isDynamic             = false;
         body->geometricalModel      = tube;
         body->interactingGeometry   = bss;
@@ -259,10 +261,11 @@
         shared_ptr<InteractingSphere> isph(new InteractingSphere);      // Bss
         	
         
-	if ((i==0 && j==0)||(i==0 && j==nbZ)||(i==nbX && j==nbZ)||(i==nbX && j==0))
-		body->isDynamic = false;
-	else
-		body->isDynamic = true;
+// 	if ((i==0 && j==0)||(i==0 && j==nbZ)||(i==nbX && j==nbZ)||(i==nbX && j==0))
+// 		body->isDynamic = false;
+// 	else
+// 		body->isDynamic = true;
+        body->isDynamic = false; // During interaction debuging
         
         node->radius                    = 0.5 * membraneThickness;
 	node->diffuseColor		= Vector3r(0.7,0.7,0.7);
@@ -293,7 +296,7 @@
 	physicalActionInitializer->physicalActionNames.push_back("Force");
 	//physicalActionInitializer->physicalActionNames.push_back("Momentum");
 	
-	shared_ptr<InteractionPhysicsMetaEngine> interactionPhysicsDispatcher(new InteractionPhysicsMetaEngine);
+	//shared_ptr<InteractionPhysicsMetaEngine> interactionPhysicsDispatcher(new InteractionPhysicsMetaEngine);
         //interactionPhysicsDispatcher->add("ElasticBodySimpleRelationship");
 		
 	shared_ptr<InteractionGeometryMetaEngine> interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
@@ -306,7 +309,7 @@
 	shared_ptr<BoundingVolumeMetaEngine> boundingVolumeDispatcher	= shared_ptr<BoundingVolumeMetaEngine>(new BoundingVolumeMetaEngine);
 	boundingVolumeDispatcher->add("InteractingSphere2AABB"); // 
 	//boundingVolumeDispatcher->add("InteractingBox2AABB");
-	//boundingVolumeDispatcher->add("ef2_BssSweptSphereLineSegment_AABB_makeAABB"); // 
+	//boundingVolumeDispatcher->add("ef2_BssSweptSphereLineSegment_AABB_makeAABB");
 	boundingVolumeDispatcher->add("MetaInteractingGeometry2AABB"); 
 	
 	shared_ptr<GravityEngine> gravityCondition(new GravityEngine);
@@ -329,8 +332,8 @@
 	shared_ptr<PhysicalParametersMetaEngine> positionIntegrator(new PhysicalParametersMetaEngine);
 	positionIntegrator->add("LeapFrogPositionIntegrator");
 
-	shared_ptr<PhysicalParametersMetaEngine> orientationIntegrator(new PhysicalParametersMetaEngine);
-	orientationIntegrator->add("LeapFrogOrientationIntegrator");
+	//shared_ptr<PhysicalParametersMetaEngine> orientationIntegrator(new PhysicalParametersMetaEngine);
+	//orientationIntegrator->add("LeapFrogOrientationIntegrator");
 	//////////////////
  	
 /*
@@ -342,18 +345,18 @@
 */
 
 	rootBody->engines.clear();
-	rootBody->engines.push_back(shared_ptr<Engine>(new PhysicalActionContainerReseter));
+	//rootBody->engines.push_back(shared_ptr<Engine>(new PhysicalActionContainerReseter));
 	rootBody->engines.push_back(boundingVolumeDispatcher);	
 	rootBody->engines.push_back(shared_ptr<Engine>(new PersistentSAPCollider));
-	rootBody->engines.push_back(interactionGeometryDispatcher);
-	rootBody->engines.push_back(interactionPhysicsDispatcher);
+	//rootBody->engines.push_back(interactionGeometryDispatcher);
+	//rootBody->engines.push_back(interactionPhysicsDispatcher);
 	//rootBody->engines.push_back(shared_ptr<Engine>(new MyTetrahedronLaw));
 	rootBody->engines.push_back(gravityCondition);
 	//rootBody->engines.push_back(actionDampingDispatcher);
 	rootBody->engines.push_back(applyActionDispatcher);
 	rootBody->engines.push_back(positionIntegrator);
 	//if(!rotationBlocked)
-		rootBody->engines.push_back(orientationIntegrator);
+	//	rootBody->engines.push_back(orientationIntegrator);
 	
 	rootBody->initializers.clear();
 	rootBody->initializers.push_back(physicalActionInitializer);


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Thu Oct 30 20:44:00 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Thu, 30 Oct 2008 20:44:00 +0100
Subject: [deprecated list] [Yade-dev] Incomprehensible crash
In-Reply-To: <9424D9EC-8FE1-418E-B918-EC1D5E57B152@geo.hmg.inpg.fr>
References: <4eb6799e0810290736w6d76a698kd4960ce301fca547@mail.gmail.com>	<490875B6.4030609@geo.hmg.inpg.fr>	<0CE3986B-6408-4C8A-8C75-EDFA81E6EF55@geo.hmg.inpg.fr>	<490886E7.2060908@arcig.cz>
	<9424D9EC-8FE1-418E-B918-EC1D5E57B152@geo.hmg.inpg.fr>
Message-ID: <490A0E80.4030807@arcig.cz>


> Thank you Vaclav. It was also necessary to remove the engine
> 'PhysicalActionContainerReseter'
> in order to have no crash...
Weird... mind posting stacktrace? If you don't have it available
anymore, laisse tomber.
>> PS. You really _want_ to use those ugly names of classes? OMG... at
>> least skip the _make part and write just _BssSweptSpheres..., no?
>
> I agree with you. I usually use short names but these long names aim to
> get a quick identification of the task performed by the plugin.
Admittedly, your naming is consistent with what Janek proposed in his
papers; to me it seems design bloat. Oh well, never mind.

BTW, please put YADE_PLUGIN("className1","className2") into your files
instead of YADE_PLUGIN() -- even if there is only one class named the
same as the file. There can be problems when loading that plugin if it
links with another plugin that does explicit YADE_PLUGIN("a",...), since
this plugin will override the default name and the class will not be
known to exist. If you say YADE_PLUGIN("className1") explicitly, the
linked symbol will be shadowed.

Vaclav

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Sun Nov  2 00:10:41 2008
From: eudoxos at arcig.cz (eudoxos at arcig.cz)
Date: Sun,  2 Nov 2008 00:10:41 +0100 (CET)
Subject: [deprecated list] [Yade-dev] Automated crash report
	for	/tmp/yade-20695/bin/yade-svn1567:	DirectShearCis, FEMBeam,
	HydraulicTest, SDECImpactTest, STLImporterTest, SimpleShear, USCTGen
Message-ID: <20081101231041.3624A9806A@delta>

################################################################################
DirectShearCis: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `kuyadc'
Running script /tmp/yade-test-23841.py
Cannot find input file
Traceback (most recent call last):
  File "/tmp/yade-20695/lib/yade-svn1567/gui/PythonUI_rc.py", line 38, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-23841.py", line 3, in <module>
    Preprocessor('DirectShearCis').generate('/tmp/yade-test-23841.xml')
RuntimeError: Generator reported error: Cannot find input file

################################################################################
FEMBeam: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `ckydss'
Running script /tmp/yade-test-23841.py
/tmp/yade-20695/build-svn1567/include/yade-svn1567/yade/core/MetaEngine1D.hpp:57 WARNING! dynamic cast of engine unit FEMTetrahedronStiffness failed, will use static_cast. Go figure why.
/tmp/yade-20695/build-svn1567/include/yade-svn1567/yade/core/MetaEngine2D.hpp:61 WARNING! dynamic cast of engine unit FEMSet2Tetrahedrons failed, will use static_cast. Go figure why.
Traceback (most recent call last):
  File "/tmp/yade-20695/lib/yade-svn1567/gui/PythonUI_rc.py", line 38, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-23841.py", line 3, in <module>
    Preprocessor('FEMBeam').generate('/tmp/yade-test-23841.xml')
RuntimeError: Generator reported error: Cannot find input file, you can copy it from examples/ directory

################################################################################
HydraulicTest: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `acksye'
Traceback (most recent call last):
  File "/tmp/yade-20695/lib/yade-svn1567/gui/PythonUI_rc.py", line 38, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-23841.py", line 3, in <module>
    Preprocessor('HydraulicTest').generate('/tmp/yade-test-23841.xml')
RuntimeError: Generator reported error: Error: cannot load the file that should contain spheres
Running script /tmp/yade-test-23841.py

################################################################################
SDECImpactTest: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `euksac'
Traceback (most recent call last):
  File "/tmp/yade-20695/lib/yade-svn1567/gui/PythonUI_rc.py", line 38, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-23841.py", line 3, in <module>
    Preprocessor('SDECImpactTest').generate('/tmp/yade-test-23841.xml')
RuntimeError: Generator reported error: Cannot find input file, you can copy it from examples/ directory
Running script /tmp/yade-test-23841.py

################################################################################
STLImporterTest: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `ausyks'
Running script /tmp/yade-test-23841.py
Import walls geometry from file: hourglass.stl
564 [139648203974448] ERROR yade.STLImporter  - lib/import/STLImporter.cpp:27 open: Can't open file: hourglass.stl
ERROR: Bad file: hourglass.stl
Traceback (most recent call last):
  File "/tmp/yade-20695/lib/yade-svn1567/gui/PythonUI_rc.py", line 38, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-23841.py", line 3, in <module>
    Preprocessor('STLImporterTest').generate('/tmp/yade-test-23841.xml')
RuntimeError: Generator reported error: Input file not found, you can copy it from examples/ directory or make one using blender 3D modelling

################################################################################
SimpleShear: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `sesyuc'
Running script /tmp/yade-test-23841.py
Cannot find input file
Traceback (most recent call last):
  File "/tmp/yade-20695/lib/yade-svn1567/gui/PythonUI_rc.py", line 38, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-23841.py", line 3, in <module>
    Preprocessor('SimpleShear').generate('/tmp/yade-test-23841.xml')
RuntimeError: Generator reported error: Cannot find input file

################################################################################
USCTGen: simulation CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `ckyedu'
yade-svn1567: extra/Brefcom.cpp:155: virtual void BrefcomLaw::action(MetaBody*): Assertion `contGeom->hasShear' failed.
Running script /tmp/yade-test-23841.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1567/gdb_crash_batch-pid24010'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0x7f98ed042730 (LWP 24010)]
[New Thread 0x40c3b950 (LWP 24012)]
[New Thread 0x42109950 (LWP 24011)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 0000000000000120
0x00007f98ec8e8e81 in nanosleep () from /lib/libpthread.so.0
No symbol "info" in current context.

Thread 3 (Thread 0x42109950 (LWP 24011)):
#0  0x00007f98ec8e87fb in accept () from /lib/libpthread.so.0
#1  0x00007f98bd243947 in ?? () from /usr/lib/python2.5/lib-dynload/_socket.so
#2  0x00007f98ecbaeb57 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#3  0x00007f98ecbaf893 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#4  0x00007f98ecbaf893 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#5  0x00007f98ecbaf893 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#6  0x00007f98ecbb0a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#7  0x00007f98ecb5070a in ?? () from /usr/lib/libpython2.5.so.1.0
#8  0x00007f98ecb2ef23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#9  0x00007f98ecb3665f in ?? () from /usr/lib/libpython2.5.so.1.0
#10 0x00007f98ecb2ef23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007f98ecba9a1e in PyEval_CallObjectWithKeywords () from /usr/lib/libpython2.5.so.1.0
#12 0x00007f98ecbdeeed in ?? () from /usr/lib/libpython2.5.so.1.0
#13 0x00007f98ec8e13f7 in start_thread () from /lib/libpthread.so.0
#14 0x00007f98e8d15b3d in clone () from /lib/libc.so.6
#15 0x0000000000000000 in ?? ()

Thread 2 (Thread 0x40c3b950 (LWP 24012)):
#0  0x00007f98e8cdb4df in waitpid () from /lib/libc.so.6
#1  0x00007f98e8c7c461 in ?? () from /lib/libc.so.6
#2  0x00007f98e8c7c7e7 in system () from /lib/libc.so.6
#3  0x0000000000578ec5 in sigHandler (sig=6) at core/yade.cpp:60
#4  <signal handler called>
#5  0x00007f98e8c70095 in raise () from /lib/libc.so.6
#6  0x00007f98e8c71af0 in abort () from /lib/libc.so.6
#7  0x00007f98e8c692df in __assert_fail () from /lib/libc.so.6
#8  0x00007f98db4f611f in BrefcomLaw::action (this=0xab9c50, _rootBody=0x8f7840) at extra/Brefcom.cpp:155
#9  0x000000000051b7db in MetaBody::moveToNextTimeStep (this=0x8f7840) at core/MetaBody.cpp:96
#10 0x000000000056fe13 in SimulationFlow::singleAction (this=0x81ac10) at core/SimulationFlow.cpp:18
#11 0x0000000000571d67 in ThreadWorker::callSingleAction (this=0x81ac10) at core/ThreadWorker.cpp:71
#12 0x000000000057155a in ThreadRunner::call (this=0xabb290) at core/ThreadRunner.cpp:44
#13 0x00000000005715c0 in ThreadRunner::run (this=0xabb290) at core/ThreadRunner.cpp:23
#14 0x0000000000571a38 in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x40c3b0c8, p=0xabb290) at /usr/include/boost/bind/mem_fn_template.hpp:49
#15 0x0000000000571aa5 in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x40c3b0d8, f=@0x40c3b0c8, a=@0x40c3b02f) at /usr/include/boost/bind.hpp:231
#16 0x0000000000571ae2 in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x40c3b0c8) at /usr/include/boost/bind/bind_template.hpp:20
#17 0x0000000000571b01 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x40c3b0c8) at /usr/include/boost/function/function_template.hpp:155
#18 0x00007f98ec282537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#19 0x00007f98ec2821a2 in ?? () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#20 0x00007f98ec8e13f7 in start_thread () from /lib/libpthread.so.0
#21 0x00007f98e8d15b3d in clone () from /lib/libc.so.6
#22 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7f98ed042730 (LWP 24010)):
#0  0x00007f98ec8e8e81 in nanosleep () from /lib/libpthread.so.0
#1  0x00007f98bda53027 in pyOmega::wait (this=0xaa96f0) at gui/py/yadeControl.cpp:424
#2  0x00007f98bd9449a9 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0xa169d8, tc=@0x7ffff5082ff0) at /usr/include/boost/python/detail/invoke.hpp:94
#3  0x00007f98bd9ea206 in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0xa169d8, args_=0xae4990) at /usr/include/boost/python/detail/caller.hpp:199
#4  0x00007f98bd9ea259 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0xa169d0, args=0xae4990, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#5  0x00007f98ea5ffabe in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#6  0x00007f98ea5ffde8 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#7  0x00007f98ec282537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#8  0x00007f98ea6079f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#9  0x00007f98ea5fd127 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#10 0x00007f98ecb2ef23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007f98ecbacbb0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#12 0x00007f98ecbb0a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#13 0x00007f98ecbb0ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#14 0x00007f98ecbd3da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#15 0x00007f98ecba88d6 in ?? () from /usr/lib/libpython2.5.so.1.0
#16 0x00007f98ecbaf940 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0x00007f98ecbb0a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0x00007f98ecbb0ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#19 0x00007f98ecbd3da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#20 0x00007f98ecbd403b in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#21 0x00007f98d96041d6 in PythonUI::execScript (script={static npos = 18446744073709551615, _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7ffff5084030 "??\201"}}) at gui/py/PythonUI.cpp:44
#22 0x00007f98d96054fb in PythonUI::pythonSession () at gui/py/PythonUI.cpp:96
#23 0x00007f98d96064b9 in PythonUI::run (this=0x81b800, argc=4, argv=0x7ffff5084d50) at gui/py/PythonUI.cpp:128
#24 0x0000000000578826 in main (argc=4, argv=0x7ffff5084d50) at core/yade.cpp:253
#0  0x00007f98ec8e8e81 in nanosleep () from /lib/libpthread.so.0

-------------- next part --------------
_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From richefeu at geo.hmg.inpg.fr  Thu Oct 30 09:26:23 2008
From: richefeu at geo.hmg.inpg.fr (Vincent Richefeu)
Date: Thu, 30 Oct 2008 09:26:23 +0100
Subject: [deprecated list] [Yade-dev] Incomprehensible crash
In-Reply-To: <490886E7.2060908@arcig.cz>
References: <4eb6799e0810290736w6d76a698kd4960ce301fca547@mail.gmail.com>	<490875B6.4030609@geo.hmg.inpg.fr>
	<0CE3986B-6408-4C8A-8C75-EDFA81E6EF55@geo.hmg.inpg.fr>
	<490886E7.2060908@arcig.cz>
Message-ID: <9424D9EC-8FE1-418E-B918-EC1D5E57B152@geo.hmg.inpg.fr>

> Re-enabling this line makes me run without crash :-)

Thank you Vaclav. It was also necessary to remove the engine  
'PhysicalActionContainerReseter'
in order to have no crash...

It's a pleasure to work with you because you are very reactive!

> PS. You really _want_ to use those ugly names of classes? OMG... at
> least skip the _make part and write just _BssSweptSpheres..., no?

I agree with you. I usually use short names but these long names aim to
get a quick identification of the task performed by the plugin.

If this is really annoying I can rename the files (svn move -m)...


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From richefeu at gmail.com  Thu Oct 30 21:35:54 2008
From: richefeu at gmail.com (Vincent Richefeu)
Date: Thu, 30 Oct 2008 21:35:54 +0100
Subject: [deprecated list] [Yade-dev] Incomprehensible crash
In-Reply-To: <490A0E80.4030807@arcig.cz>
References: <4eb6799e0810290736w6d76a698kd4960ce301fca547@mail.gmail.com>	<490875B6.4030609@geo.hmg.inpg.fr>	<0CE3986B-6408-4C8A-8C75-EDFA81E6EF55@geo.hmg.inpg.fr>	<490886E7.2060908@arcig.cz>
	<9424D9EC-8FE1-418E-B918-EC1D5E57B152@geo.hmg.inpg.fr>
	<490A0E80.4030807@arcig.cz>
Message-ID: <C693FC08-BE4A-4A56-B68B-107D9B9506A5@gmail.com>

>>> PS. You really _want_ to use those ugly names of classes? OMG... at
>>> least skip the _make part and write just _BssSweptSpheres..., no?
>>
>> I agree with you. I usually use short names but these long names  
>> aim to
>> get a quick identification of the task performed by the plugin.

> Admittedly, your naming is consistent with what Janek proposed in his
> papers; to me it seems design bloat. Oh well, never mind.

OK. I will stop using these long names, at least until the new names  
will take place.
My next commit would involve a file with a name like that (hold on  
tight!):

ef2_InteractingSphere_BssSweptSphereLineSegment_makeSpheresContactGeomet 
ry.*

Now I will use a name like that:

InteractingSphere2SweptSphereLineSegment4SpheresContactGeometry.*

(In fact, it is not much longer!)

> BTW, please put YADE_PLUGIN("className1","className2") into your files
> instead of YADE_PLUGIN() -- even if there is only one class named the
> same as the file. There can be problems when loading that plugin if it
> links with another plugin that does explicit YADE_PLUGIN("a",...),  
> since
> this plugin will override the default name and the class will not be
> known to exist. If you say YADE_PLUGIN("className1") explicitly, the
> linked symbol will be shadowed.

OK, I will do.

@+,
Vincent


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From bruno.chareyre at hmg.inpg.fr  Fri Nov  7 19:18:53 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Fri, 07 Nov 2008 19:18:53 +0100
Subject: [deprecated list] [Yade-dev] Damping at the contact level
In-Reply-To: <607313BD-714E-47F2-B1E4-9AD00BD3C08A@geo.hmg.inpg.fr>
References: <607313BD-714E-47F2-B1E4-9AD00BD3C08A@geo.hmg.inpg.fr>
Message-ID: <4914868D.90704@hmg.inpg.fr>

Vincent Richefeu a ?crit :
> Hi everybody,
>
> I am very surprised that no viscosity is taken into account at contact 
> level in Yade.
> Maybe I'm wrong, but I have not seen anything like it!
> I do not usually use a global damping ('NonViscousDamping' in Yade) 
> and I prefer to
> use local (at the contact level) damping that can be related to a 
> 'coefficient of restitution'.
>
Global damping is the original Cundall's model damping, probably the 
most common. Its a numerical trick more than a physical ingredient, but 
I would say the same about the restitution coefficient (let the troll 
start ;-)).
Global damping is more efficient because it does not affect the critical 
timestep.

> Without going into sterile discussions, I would like to know if 
> something like that exists in Yade.
> Otherwise, I will need to add the class 'NormalViscousInteraction' 
> (and/or 'NormalViscousShearInteraction')
> that store the damping parameter. I will need also to add a relative 
> normal velocity parameter in the
> very complet class SpheresContactGeometry. Note that it will be the 
> possible to put aside the local
> vicosity by setting the damping parameter to zero.
>
No need to add relative velocity, you can compute vel(1)-vel(2) when you 
need it, and save memory.
Viscous creep as been implemented by janek, but the type of viscosity 
you want is not implemented yet.
You could just add it in ElasticFrictionalContactLaw, or even better, 
make a contact law inheriting from EFCL so people who don't want 
viscosity will use the current law without the need to set it to 0 and 
without useless if(viscosity!=0).

Bruno

>


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Grenoble INP
Laboratoire 3SR - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Tue Nov 11 09:06:11 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Tue, 11 Nov 2008 09:06:11 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1569 - in trunk:
	gui/py	pkg/common/RenderingEngine/GLDrawInteractingGeometry
Message-ID: <200811110806.mAB86BJT014024@sheep.berlios.de>

Author: eudoxos
Date: 2008-11-11 09:06:10 +0100 (Tue, 11 Nov 2008)
New Revision: 1569

Modified:
   trunk/gui/py/pyAttrUtils.hpp
   trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawBssSweptSphereLineSegment.cpp
Log:
1. Add INTEGER (besides FLOAT) to the list of wrapped c++ types in python. Fix type detection for long double
2. Fix Real->double conversions in GLDrawBssSweptSphereLineSegment.cpp



Modified: trunk/gui/py/pyAttrUtils.hpp
===================================================================
--- trunk/gui/py/pyAttrUtils.hpp	2008-11-10 21:33:00 UTC (rev 1568)
+++ trunk/gui/py/pyAttrUtils.hpp	2008-11-11 08:06:10 UTC (rev 1569)
@@ -92,7 +92,7 @@
 		//! maps attribute name to its archive and vector of its types (given as ints, from the following enum)
 		DescriptorMap descriptors;
 		//! allowed types
-		enum {BOOL,STRING,NUMBER, SEQ_NUMBER, SEQ_STRING, VEC_VEC }; // allowed types
+		enum {BOOL,STRING,FLOAT,INTEGER,SEQ_FLOAT, SEQ_STRING, VEC_VEC }; // allowed types
 		
 		AttrAccess(Serializable* _ser): ser(shared_ptr<Serializable>(_ser)){init();}
 		AttrAccess(shared_ptr<Serializable> _ser):ser(_ser){init();}
@@ -108,10 +108,11 @@
 					desc.archive=*ai;
 					any instance=(*ai)->getAddress(); // gets pointer to the stored value
 					//cerr<<"["<<(*ai)->getName()<<","<<instance.type().name()<<"]";
-					// 3 possibilities: one BOOL, one or more STRINGS, one or more NUMBERs (fallback if none matches)
+					// 3 possibilities: one BOOL, one or more STRINGS, one or more FLOATs (fallback if none matches)
 					if      (any_cast<string*>(&instance)) { desc.type=AttrAccess::STRING; goto found; }
 					else if (any_cast<bool*>(&instance)) { desc.type=AttrAccess::BOOL; goto found; }
-					else if (any_cast<Real*>(&instance) || any_cast<int*>(&instance) || any_cast<unsigned int*>(&instance) || any_cast<long*>(&instance) || any_cast<unsigned long*>(&instance)) { desc.type=AttrAccess::NUMBER; goto found;}
+					else if (any_cast<Real*>(&instance) || any_cast<long double*>(&instance) || any_cast<double*>(&instance) || any_cast<float*>(&instance)) { desc.type=AttrAccess::FLOAT; goto found;}
+					else if (any_cast<int*>(&instance) || any_cast<unsigned int*>(&instance) || any_cast<long*>(&instance) || any_cast<unsigned long*>(&instance)) {desc.type=AttrAccess::INTEGER; goto found; }
 					else if (any_cast<vector<string>*>(&instance)) { desc.type=AttrAccess::SEQ_STRING; goto found; }
 				#if 0
 					else if (any_cast<vector<Vector3r>*>(&instance)) { cerr<<"WWWWWWWWWWWWW"<<endl;}
@@ -121,10 +122,10 @@
 					else if (any_cast<vector<Wm3::Vector3<double> >*>(&instance)) {
 						desc.type=AttrAccess::VEC_VEC;
 						cerr<<"Attribute "<<(*ai)->getName()<<" is a vector<Vector3r>";
-					//else if (any_cast<vector<Real>*>(&instance)) desc.type=AttrAccess::SEQ_NUMBER;
+					//else if (any_cast<vector<Real>*>(&instance)) desc.type=AttrAccess::SEQ_FLOAT;
 					}
 				#endif
-					desc.type=AttrAccess::SEQ_NUMBER;
+					desc.type=AttrAccess::SEQ_FLOAT;
 					found:
 						descriptors[(*ai)->getName()]=desc;
 				}
@@ -145,7 +146,7 @@
 		string dumpAttr(string name){
 			string vals,types; AttrDesc desc=descriptors[name]; vector<string> values=getAttrStr(name);
 			for(size_t i=0; i<values.size(); i++) vals+=(i>0?" ":"")+values[i];
-			string typeDesc(desc.type==BOOL?"BOOL":(desc.type==STRING?"STRING":(desc.type==NUMBER?"NUMBER":(desc.type==SEQ_NUMBER?"SEQ_NUMBER":(desc.type==SEQ_STRING?"SEQ_STRING":(desc.type==VEC_VEC?"VEC_VEC":"<unknown>"))))));
+			string typeDesc(desc.type==BOOL?"BOOL":(desc.type==STRING?"STRING":(desc.type==FLOAT?"FLOAT":(desc.type==INTEGER?"INTEGER":(desc.type==SEQ_FLOAT?"SEQ_FLOAT":(desc.type==SEQ_STRING?"SEQ_STRING":(desc.type==VEC_VEC?"VEC_VEC":"<unknown>")))))));
 			return name+" =\t"+vals+"\t ("+typeDesc+")";
 		}
 		//! call dumpAttr for all attributes (used for debugging)
@@ -168,10 +169,11 @@
 			LOG_DEBUG("Got raw attribute `"<<key<<"'");
 			switch(descriptors[key].type){
 				case BOOL: return python::object(lexical_cast<bool>(raw[0]));
-				case NUMBER: return python::object(lexical_cast_maybeNanInf<double>(raw[0]));
+				case FLOAT: return python::object(lexical_cast_maybeNanInf<double>(raw[0]));
+				case INTEGER: return python::object(lexical_cast_maybeNanInf<long>(raw[0]));
 				case STRING: return python::object(raw[0]);
 				case SEQ_STRING: {python::list ret; for(size_t i=0; i<raw.size(); i++) ret.append(python::object(raw[i])); return ret;}
-				case SEQ_NUMBER: {python::list ret; for(size_t i=0; i<raw.size(); i++){ ret.append(python::object(lexical_cast_maybeNanInf<double>(raw[i]))); LOG_TRACE("Appended "<<raw[i]);} return ret; }
+				case SEQ_FLOAT: {python::list ret; for(size_t i=0; i<raw.size(); i++){ ret.append(python::object(lexical_cast_maybeNanInf<double>(raw[i]))); LOG_TRACE("Appended "<<raw[i]);} return ret; }
 				case VEC_VEC: {
 					python::list ret; for(size_t i=0; i<raw.size(); i++){
 						/* raw[i] has the form "{number number number}" */
@@ -190,7 +192,8 @@
 			#define SAFE_EXTRACT(from,to,type) python::extract<type> to(from); if(!to.check()) throw invalid_argument(string("Could not extract type ")+#type);
 			switch(descriptors[key].type){
 				case BOOL: {SAFE_EXTRACT(val.ptr(),extr,bool); setAttrStr(key,extr()?"1":"0"); break;}
-				case NUMBER: {SAFE_EXTRACT(val.ptr(),extr,double); setAttrStr(key,lexical_cast<string>(extr())); break; }
+				case FLOAT: {SAFE_EXTRACT(val.ptr(),extr,double); setAttrStr(key,lexical_cast<string>(extr())); break; }
+				case INTEGER: {SAFE_EXTRACT(val.ptr(),extr,long); setAttrStr(key,lexical_cast<string>(extr())); break; }
 				case STRING: {SAFE_EXTRACT(val.ptr(),extr,string); setAttrStr(key,extr()); break;}
 				case SEQ_STRING:{
 					if(!PySequence_Check(val.ptr())) throw invalid_argument("String sequence argument required.");
@@ -199,7 +202,7 @@
 					setAttrStr(key,strVal+"]");
 				} 
 				break;
-				case SEQ_NUMBER:{
+				case SEQ_FLOAT:{
 					if(!PySequence_Check(val.ptr())) throw invalid_argument("Number sequence argument required.");
 					string strVal("{");
 					for(int i=0; i<PySequence_Size(val.ptr()); i++){SAFE_EXTRACT(PySequence_GetItem(val.ptr(),i),extr,double); strVal+=lexical_cast<string>(extr())+" ";}

Modified: trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawBssSweptSphereLineSegment.cpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawBssSweptSphereLineSegment.cpp	2008-11-10 21:33:00 UTC (rev 1568)
+++ trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawBssSweptSphereLineSegment.cpp	2008-11-11 08:06:10 UTC (rev 1569)
@@ -59,9 +59,9 @@
   
   // It is not very elegant but it provides assistance
   // TODO - write a gl-list that draw 2 halh spheres 
-  glTranslate(-half_length, 0.0, 0.0);
+  glTranslate((double)(-half_length), 0.0, 0.0);
   gluSphere(quadric, radius, 5, 5);
-  glTranslate(2.0*half_length, 0.0, 0.0);
+  glTranslate((double)(2.0*half_length), 0.0, 0.0);
   gluSphere(quadric, radius, 5, 5);
 }
 


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Sat Nov 15 10:07:37 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Sat, 15 Nov 2008 10:07:37 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1570 - trunk/gui/py
Message-ID: <200811150907.mAF97bFb017845@sheep.berlios.de>

Author: eudoxos
Date: 2008-11-15 10:07:37 +0100 (Sat, 15 Nov 2008)
New Revision: 1570

Modified:
   trunk/gui/py/eudoxos.py
   trunk/gui/py/yadeControl.cpp
Log:
1. Body().phys.refPos is directly accessible now (old way Body().phys['refSe3'[0:3]] still works, though)
2. Labeled engines are at load-time or when Omega().engines are modified assigned to variables __builtins__.label;
  for example
	  
	  Omega().engines=[DeusExMachina('NewtonsDampedLaw',{'label':'dlaw'})]

	automatically create dlaw variable (in the builtin namespace) referring to that engine.
	Unlike Omega().labeledEngine('dlaw'), which may point to a fictive engine after re-loading the simulation, for example,
	this should be always kept in sync.

	Adding labels for bodies (and maybe "persistent" interactions) is under consideration.



Modified: trunk/gui/py/eudoxos.py
===================================================================
--- trunk/gui/py/eudoxos.py	2008-11-11 08:06:10 UTC (rev 1569)
+++ trunk/gui/py/eudoxos.py	2008-11-15 09:07:37 UTC (rev 1570)
@@ -3,6 +3,8 @@
 #
 # I doubt there functions will be useful for anyone besides me.
 #
+from yade.wrapper import *
+from math import *
 
 def estimateStress(strain,cutoff=0.):
 	"""Use summed stored energy in contacts to compute macroscopic stress over the same volume, provided known strain."""
@@ -51,7 +53,7 @@
 	return -avgTransHomogenizedStrain/principalHomogenizedStrain,stress/principalHomogenizedStrain
 
 
-def oofemTextExport():
+def oofemTextExport(fName):
 	"""Export simulation data in text format 
 	
 	The format is line-oriented as follows:
@@ -67,6 +69,8 @@
 	material,bodies,interactions=[],[],[]
 	o=Omega()
 
+	f=open(fName,'w') # fail early on I/O problem
+
 	ph=o.interactions.nth(0).phys # some params are the same everywhere
 	material.append("%g %g"%(ph['E'],ph['G']))
 	material.append("%g %g %g %g"%(ph['epsCrackOnset'],ph['epsFracture'],1e50,ph['xiShear']))
@@ -87,9 +91,10 @@
 		if not i.geom or not i.phys: continue
 		cp=i.geom['contactPoint']
 		interactions.append("%d %d %g %g %g %g"%(i.id1,i.id2,cp[0],cp[1],cp[2],i.phys['crossSection']))
+	
+	f.write('\n'.join(material+["%d %d"%(len(bodies),len(interactions))]+bodies+interactions))
+	f.close()
 
-	return material+["%d %d"%(len(bodies),len(interactions))]+bodies+interactions
-
 def oofemDirectExport(fileBase,title=None,negIds=[],posIds=[]):
 	from yade.wrapper import Omega
 	material,bodies,interactions=[],[],[]
@@ -131,9 +136,31 @@
 	f.write('PiecewiseLinFunction 1 npoints 3 t 3 0. 10. 1000.  f(t) 3 0. 10. 1000.\n')
 
 
+def displacementsInteractionsExport(fName):
+	f=open(fName,'w')
+	print "Writing body displacements and interaction strains."
+	o=Omega()
+	for b in o.bodies:
+		x0,y0,z0=b.phys['refSe3'][0:3]; x,y,z=b.phys.pos
+		rx,ry,rz,rr=b.phys['se3'][3:7]
+		f.write('%d xyz [ %g %g %g ] dxyz [ %g %g %g ] rxyz [ %g %g %g ] \n'%(b.id,x0,y0,z0,x-x0,y-y0,z-z0,rr*rx,rr*ry,rr*rz))
+	f.write('\n')
+	for i in o.interactions:
+		if not i['isReal']:continue
+		epsTNorm=sqrt(sum([e**2 for e in i.phys['epsT']]))
+		epsT='epsT [ %g %g %g ] %g'%(i.phys['epsT'][0],i.phys['epsT'][1],i.phys['epsT'][2],epsTNorm)
+		en=i.phys['epsN']; n=i.geom['normal']
+		epsN='epsN [ %g %g %g ] %g'%(en*n[0],en*n[1],en*n[2],en)
+		Fn='Fn [ %g %g %g ] %g'%(i.phys['normalForce'][0],i.phys['normalForce'][1],i.phys['normalForce'][2],i.phys['Fn'])
+		Fs='Fs [ %lf %lf %lf ] %lf'%(i.phys['shearForce'][0],i.phys['shearForce'][1],i.phys['shearForce'][2],sqrt(sum([fs**2 for fs in i.phys['shearForce']])))
+		f.write('%d %d %s %s %s %s\n'%(i.id1,i.id2,epsN,epsT,Fn,Fs))
+		# f.write('%d %d %g %g %g %g %g\n'%(i.id1,i.id2,i.phys['epsN'],i.phys['epsT'][0],i.phys['epsT'][1],i.phys['epsT'][2],epsTNorm))
+	f.close()
 
 
 
+
+
 def eliminateJumps(eps,sigma,numSteep=10,gapWidth=5,movWd=40):
 	from matplotlib.mlab import movavg
 	from numpy import diff,abs

Modified: trunk/gui/py/yadeControl.cpp
===================================================================
--- trunk/gui/py/yadeControl.cpp	2008-11-11 08:06:10 UTC (rev 1569)
+++ trunk/gui/py/yadeControl.cpp	2008-11-15 09:07:37 UTC (rev 1570)
@@ -150,8 +150,10 @@
 		}
 	}
 	python::tuple pos_get(){const Vector3r& p=proxee->se3.position; return python::make_tuple(p[0],p[1],p[2]);}
+	python::tuple refPos_get(){const Vector3r& p=proxee->refSe3.position; return python::make_tuple(p[0],p[1],p[2]);}
 	python::tuple ori_get(){Vector3r axis; Real angle; proxee->se3.orientation.ToAxisAngle(axis,angle); return python::make_tuple(axis[0],axis[1],axis[2],angle);}
 	void pos_set(python::list l){if(python::len(l)!=3) throw invalid_argument("Wrong number of vector3 elements "+lexical_cast<string>(python::len(l))+", should be 3"); proxee->se3.position=Vector3r(python::extract<double>(l[0])(),python::extract<double>(l[1])(),python::extract<double>(l[2])());}
+	void refPos_set(python::list l){if(python::len(l)!=3) throw invalid_argument("Wrong number of vector3 elements "+lexical_cast<string>(python::len(l))+", should be 3"); proxee->refSe3.position=Vector3r(python::extract<double>(l[0])(),python::extract<double>(l[1])(),python::extract<double>(l[2])());}
 	void ori_set(python::list l){if(python::len(l)!=4) throw invalid_argument("Wrong number of quaternion elements "+lexical_cast<string>(python::len(l))+", should be 4"); proxee->se3.orientation=Quaternionr(Vector3r(python::extract<double>(l[0])(),python::extract<double>(l[1])(),python::extract<double>(l[2])()),python::extract<double>(l[3])());}
 BASIC_PY_PROXY_TAIL;
 
@@ -398,6 +400,16 @@
 			OMEGA.createSimulationLoop();
 		}
 	};
+	/* Create variables in python's __builtin__ namespace that correspond to labeled objects. At this moment, only engines can be labeled. */
+	void mapLabeledEntitiesToVariables(){
+		FOREACH(const shared_ptr<Engine>& e, OMEGA.getRootBody()->engines){
+			if(!e->label.empty()){
+				PyGILState_STATE gstate; gstate = PyGILState_Ensure();
+				PyRun_SimpleString(("__builtins__."+e->label+"=Omega().labeledEngine('"+e->label+"')").c_str());
+				PyGILState_Release(gstate);
+			}
+		}
+	}
 
 	long iter(){ return OMEGA.getCurrentIteration();}
 	double simulationTime(){return OMEGA.getSimulationTime();}
@@ -427,6 +439,7 @@
 		OMEGA.setSimulationFileName(fileName);
 		OMEGA.loadSimulation();
 		OMEGA.createSimulationLoop();
+		mapLabeledEntitiesToVariables();
 		LOG_DEBUG("LOAD!");
 	}
 	void reload(){	load(OMEGA.getSimulationFileName());}
@@ -475,7 +488,7 @@
 	}
 
 	python::list engines_get(void){assertRootBody(); return anyEngines_get(OMEGA.getRootBody()->engines);}
-	void engines_set(python::object egs){assertRootBody(); anyEngines_set(OMEGA.getRootBody()->engines,egs);}
+	void engines_set(python::object egs){assertRootBody(); anyEngines_set(OMEGA.getRootBody()->engines,egs); mapLabeledEntitiesToVariables(); }
 	python::list initializers_get(void){assertRootBody(); return anyEngines_get(OMEGA.getRootBody()->initializers);}
 	void initializers_set(python::object egs){assertRootBody(); anyEngines_set(OMEGA.getRootBody()->initializers,egs); OMEGA.getRootBody()->needsInitializers=true; }
 
@@ -605,6 +618,7 @@
 		.add_property("blockedDOFs",&pyPhysicalParameters::blockedDOFs_get,&pyPhysicalParameters::blockedDOFs_set)
 		.add_property("pos",&pyPhysicalParameters::pos_get,&pyPhysicalParameters::pos_set)
 		.add_property("ori",&pyPhysicalParameters::ori_get,&pyPhysicalParameters::ori_set)
+		.add_property("refPos",&pyPhysicalParameters::refPos_get,&pyPhysicalParameters::refPos_set)
 		;
 	BASIC_PY_PROXY_WRAPPER(pyBoundingVolume,"BoundingVolume");
 	BASIC_PY_PROXY_WRAPPER(pyInteractionGeometry,"InteractionGeometry");


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Sun Nov 16 10:12:37 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Sun, 16 Nov 2008 10:12:37 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1571 - trunk/gui/py
Message-ID: <200811160912.mAG9CbA9009171@sheep.berlios.de>

Author: eudoxos
Date: 2008-11-16 10:12:37 +0100 (Sun, 16 Nov 2008)
New Revision: 1571

Added:
   trunk/gui/py/_eudoxos.cpp
Log:
Add forgotten file. 


Added: trunk/gui/py/_eudoxos.cpp
===================================================================
--- trunk/gui/py/_eudoxos.cpp	2008-11-15 09:07:37 UTC (rev 1570)
+++ trunk/gui/py/_eudoxos.cpp	2008-11-16 09:12:37 UTC (rev 1571)
@@ -0,0 +1,29 @@
+#include<yade/extra/Brefcom.hpp>
+#include<boost/python.hpp>
+using namespace boost;
+using namespace std;
+# if 0
+Real elasticEnergyDensityInAABB(python::tuple AABB){
+	Vector3r bbMin=tuple2vec(python::extract<python::tuple>(AABB[0])()), bbMax=tuple2vec(python::extract<python::tuple>(AABB[1])()); Vector3r box=bbMax-bbMin;
+	shared_ptr<MetaBody> rb=Omega::instance().getRootBody();
+	Real E=0;
+	FOREACH(const shared_ptr<Interaction>&i, *rb->transientInteractions){
+		if(!i->interactionPhysics) continue;
+		shared_ptr<BrefcomContact> bc=dynamic_pointer_cast<BrefcomContact>(i->interactionPhysics); if(!bc) continue;
+		const shared_ptr<Body>& b1=Body::byId(i->getId1(),rb), b2=Body::byId(i->getId2(),rb);
+		bool isIn1=isInBB(b1->physicalParameters->se3.position,bbMin,bbMax), isIn2=isInBB(b2->physicalParameters->se3.position,bbMin,bbMax);
+		if(!isIn1 && !isIn2) continue;
+		Real weight=1.;
+		if((!isIn1 && isIn2) || (isIn1 && !isIn2)){
+			//shared_ptr<Body> bIn=isIn1?b1:b2, bOut=isIn2?b2:b1;
+			Vector3r vIn=(isIn1?b1:b2)->physicalParameters->se3.position, vOut=(isIn2?b1:b2)->physicalParameters->se3.position;
+			#define _WEIGHT_COMPONENT(axis) if(vOut[axis]<bbMin[axis]) weight=min(weight,abs((vOut[axis]-bbMin[axis])/(vOut[axis]-vIn[axis]))); else if(vOut[axis]>bbMax[axis]) weight=min(weight,abs((vOut[axis]-bbMax[axis])/(vOut[axis]-vIn[axis])));
+			_WEIGHT_COMPONENT(0); _WEIGHT_COMPONENT(1); _WEIGHT_COMPONENT(2);
+			assert(weight>=0 && weight<=1);
+		}
+		E+=.5*bc->E*bc->crossSection*pow(bc->epsN,2)+.5*bc->G*bc->crossSection*pow(bc->epsT.Length(),2);
+	}
+	return E/(box[0]*box[1]*box[2]);
+}
+#endif
+


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From bruno.chareyre at hmg.inpg.fr  Mon Nov 17 11:22:15 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Mon, 17 Nov 2008 11:22:15 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1571 - trunk/gui/py
In-Reply-To: <200811160912.mAG9CbA9009171@sheep.berlios.de>
References: <200811160912.mAG9CbA9009171@sheep.berlios.de>
Message-ID: <492145D7.7040907@hmg.inpg.fr>

I don't know since when its like that but there is a new Python 
prerequisite.
I just added it on the wiki :

/*sudo aptitude install python-numpy*/

Bruno



eudoxos at BerliOS a e'crit :
> Author: eudoxos
> Date: 2008-11-16 10:12:37 +0100 (Sun, 16 Nov 2008)
> New Revision: 1571
>
> Added:
>    trunk/gui/py/_eudoxos.cpp
> Log:
> Add forgotten file. 
>
>
> Added: trunk/gui/py/_eudoxos.cpp
> ===================================================================
> --- trunk/gui/py/_eudoxos.cpp	2008-11-15 09:07:37 UTC (rev 1570)
> +++ trunk/gui/py/_eudoxos.cpp	2008-11-16 09:12:37 UTC (rev 1571)
> @@ -0,0 +1,29 @@
> +#include<yade/extra/Brefcom.hpp>
> +#include<boost/python.hpp>
> +using namespace boost;
> +using namespace std;
> +# if 0
> +Real elasticEnergyDensityInAABB(python::tuple AABB){
> +	Vector3r bbMin=tuple2vec(python::extract<python::tuple>(AABB[0])()), bbMax=tuple2vec(python::extract<python::tuple>(AABB[1])()); Vector3r box=bbMax-bbMin;
> +	shared_ptr<MetaBody> rb=Omega::instance().getRootBody();
> +	Real E=0;
> +	FOREACH(const shared_ptr<Interaction>&i, *rb->transientInteractions){
> +		if(!i->interactionPhysics) continue;
> +		shared_ptr<BrefcomContact> bc=dynamic_pointer_cast<BrefcomContact>(i->interactionPhysics); if(!bc) continue;
> +		const shared_ptr<Body>& b1=Body::byId(i->getId1(),rb), b2=Body::byId(i->getId2(),rb);
> +		bool isIn1=isInBB(b1->physicalParameters->se3.position,bbMin,bbMax), isIn2=isInBB(b2->physicalParameters->se3.position,bbMin,bbMax);
> +		if(!isIn1 && !isIn2) continue;
> +		Real weight=1.;
> +		if((!isIn1 && isIn2) || (isIn1 && !isIn2)){
> +			//shared_ptr<Body> bIn=isIn1?b1:b2, bOut=isIn2?b2:b1;
> +			Vector3r vIn=(isIn1?b1:b2)->physicalParameters->se3.position, vOut=(isIn2?b1:b2)->physicalParameters->se3.position;
> +			#define _WEIGHT_COMPONENT(axis) if(vOut[axis]<bbMin[axis]) weight=min(weight,abs((vOut[axis]-bbMin[axis])/(vOut[axis]-vIn[axis]))); else if(vOut[axis]>bbMax[axis]) weight=min(weight,abs((vOut[axis]-bbMax[axis])/(vOut[axis]-vIn[axis])));
> +			_WEIGHT_COMPONENT(0); _WEIGHT_COMPONENT(1); _WEIGHT_COMPONENT(2);
> +			assert(weight>=0 && weight<=1);
> +		}
> +		E+=.5*bc->E*bc->crossSection*pow(bc->epsN,2)+.5*bc->G*bc->crossSection*pow(bc->epsT.Length(),2);
> +	}
> +	return E/(box[0]*box[1]*box[2]);
> +}
> +#endif
> +
>
>
> _______________________________________________
> Mailing list: https://launchpad.net/~yade-dev
> Post to     : yade-dev at lists.launchpad.net
> Unsubscribe : https://launchpad.net/~yade-dev
> More help   : https://help.launchpad.net/ListHelp
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Grenoble INP
Laboratoire 3SR - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
Te'l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From chareyre at mail.berlios.de  Mon Nov 17 11:54:38 2008
From: chareyre at mail.berlios.de (chareyre at BerliOS)
Date: Mon, 17 Nov 2008 11:54:38 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1572 -
	trunk/pkg/dem/PreProcessor
Message-ID: <200811171054.mAHAscni019872@sheep.berlios.de>

Author: chareyre
Date: 2008-11-17 11:54:38 +0100 (Mon, 17 Nov 2008)
New Revision: 1572

Modified:
   trunk/pkg/dem/PreProcessor/TriaxialTest.cpp
Log:
svn update - no real change (in principle)  - recovering from erased local file



Modified: trunk/pkg/dem/PreProcessor/TriaxialTest.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/TriaxialTest.cpp	2008-11-16 09:12:37 UTC (rev 1571)
+++ trunk/pkg/dem/PreProcessor/TriaxialTest.cpp	2008-11-17 10:54:38 UTC (rev 1572)
@@ -10,9 +10,9 @@
 *  GNU General Public License v2 or later. See file LICENSE for details. *
 *************************************************************************/
 
- 
 
 
+
 #include "TriaxialTest.hpp"
 
 #include<yade/pkg-dem/ElasticContactLaw.hpp>
@@ -26,8 +26,8 @@
 #include<yade/pkg-dem/MakeItFlat.hpp>
 
 #include<yade/pkg-dem/AveragePositionRecorder.hpp>
-#include<yade/pkg-dem/ForceRecorder.hpp>
-#include<yade/pkg-dem/VelocityRecorder.hpp>
+//#include<yade/pkg-dem/ForceRecorder.hpp>
+//#include<yade/pkg-dem/VelocityRecorder.hpp>
 #include<yade/pkg-dem/TriaxialStressController.hpp>
 #include<yade/pkg-dem/TriaxialCompressionEngine.hpp>
 #include <yade/pkg-dem/TriaxialStateRecorder.hpp>
@@ -88,13 +88,13 @@
 
 
 
- 
+
 TriaxialTest::TriaxialTest () : FileGenerator()
 {
 	lowerCorner 		= Vector3r(0,0,0);
 	upperCorner 		= Vector3r(1,1,1);
 	thickness 		= 0.001;
-	importFilename 		= ""; // oh, PLEASE, keep this empty -- i.e., by default, generate spheres in the box, not load them.
+	importFilename          = ""; // oh, PLEASE, keep this empty -- i.e., by default, generate spheres in the box, not load them.
 	Key			="";
 	outputFileName 		= "./TriaxialTest"+Key+".xml";
 	//nlayers = 1;
@@ -159,14 +159,13 @@
 
 	radiusStdDev=0.3;
 	radiusMean=-1; // no radius specified
-
+	
 	isotropicCompaction=false;
 	translationSpeed = 0;
 	fixedPorosity = 1;
 
- 
-
 	
+	
 //	wall_top_id =0;
 // 	wall_bottom_id =0;
 // 	wall_left_id =0;
@@ -222,38 +221,11 @@
 	REGISTER_ATTRIBUTE(StabilityCriterion);
 	REGISTER_ATTRIBUTE(autoCompressionActivation);
 	REGISTER_ATTRIBUTE(autoUnload);
-//	REGISTER_ATTRIBUTE(wall_top);
-//	REGISTER_ATTRIBUTE(wall_bottom);
-//	REGISTER_ATTRIBUTE(wall_1);
-//	REGISTER_ATTRIBUTE(wall_2);
-//	REGISTER_ATTRIBUTE(wall_3);
-//	REGISTER_ATTRIBUTE(wall_4);
-//	REGISTER_ATTRIBUTE(wall_top_wire);
-//	REGISTER_ATTRIBUTE(wall_bottom_wire);
-//	REGISTER_ATTRIBUTE(wall_1_wire);
-//	REGISTER_ATTRIBUTE(wall_2_wire);
-//	REGISTER_ATTRIBUTE(wall_3_wire);
-//	REGISTER_ATTRIBUTE(wall_4_wire);
-//	REGISTER_ATTRIBUTE(spheresColor);
-//	REGISTER_ATTRIBUTE(spheresRandomColor);
 	REGISTER_ATTRIBUTE(recordIntervalIter);
 	REGISTER_ATTRIBUTE(saveAnimationSnapshots);
 	REGISTER_ATTRIBUTE(AnimationSnapshotsBaseName);
 	REGISTER_ATTRIBUTE(WallStressRecordFile);
-
 	REGISTER_ATTRIBUTE(wallOversizeFactor);
-
-//	REGISTER_ATTRIBUTE(gravity);
-	
-	//REGISTER_ATTRIBUTE(bigBall);
-	//REGISTER_ATTRIBUTE(bigBallRadius);
-	//REGISTER_ATTRIBUTE(bigBallDensity);
-	//REGISTER_ATTRIBUTE(bigBallDropTimeSeconds);
-	//REGISTER_ATTRIBUTE(bigBallFrictDeg);
-	//REGISTER_ATTRIBUTE(bigBallYoungModulus);
-	//REGISTER_ATTRIBUTE(bigBallPoissonRatio);
-	//REGISTER_ATTRIBUTE(bigBallDropHeight);
-	//REGISTER_ATTRIBUTE(sigma_iso);
 	REGISTER_ATTRIBUTE(sigmaIsoCompaction);
 	REGISTER_ATTRIBUTE(sigmaLateralConfinement);
 	REGISTER_ATTRIBUTE(Key);
@@ -261,10 +233,8 @@
 	REGISTER_ATTRIBUTE(translationSpeed);
 	REGISTER_ATTRIBUTE(fixedPorosity);
 	REGISTER_ATTRIBUTE(fixedBoxDims);
- 
 
 
-
 }
 
 
@@ -618,7 +588,6 @@
 	triaxialcompressionEngine = shared_ptr<TriaxialCompressionEngine> (new TriaxialCompressionEngine);
 	triaxialcompressionEngine-> stiffnessUpdateInterval = wallStiffnessUpdateInterval;// = stiffness update interval
 	triaxialcompressionEngine-> radiusControlInterval = radiusControlInterval;// = stiffness update interval
-	//triaxialcompressionEngine-> sigma_iso = sigma_iso;
 	triaxialcompressionEngine-> sigmaIsoCompaction = sigmaIsoCompaction;
 	triaxialcompressionEngine-> sigmaLateralConfinement = sigmaLateralConfinement;
 	triaxialcompressionEngine->max_vel = maxWallVelocity;
@@ -635,10 +604,9 @@
 	triaxialcompressionEngine->translationSpeed = translationSpeed;
 	triaxialcompressionEngine->fixedPorosity = fixedPorosity;
 	triaxialcompressionEngine->isotropicCompaction = isotropicCompaction;
-		
-	//cerr << "fin de section triaxialcompressionEngine = shared_ptr<TriaxialCompressionEngine> (new TriaxialCompressionEngine);" << std::endl;
+
 	
-// recording global stress
+	// recording global stress
 	if(recordIntervalIter>0){
 		triaxialStateRecorder = shared_ptr<TriaxialStateRecorder>(new TriaxialStateRecorder);
 		triaxialStateRecorder-> outputFile 		= WallStressRecordFile + Key;
@@ -651,7 +619,20 @@
 	makeItFlat->plane_position = (lowerCorner[2]+upperCorner[2])*0.5;
 	makeItFlat->reset_force = false;	
 
+	#if 0	
+	// moving walls to regulate the stress applied
+	//cerr << "triaxialstressController = shared_ptr<TriaxialStressController> (new TriaxialStressController);" << std::endl;
+	triaxialstressController = shared_ptr<TriaxialStressController> (new TriaxialStressController);
+	triaxialstressController-> stiffnessUpdateInterval = 20;// = recordIntervalIter
+	triaxialstressController-> sigma_iso = sigma_iso;
+	triaxialstressController-> max_vel = 0.0001;
+	triaxialstressController-> thickness = thickness;
+	triaxialstressController->wall_bottom_activated = false;
+	triaxialstressController->wall_top_activated = false;	
+		//cerr << "fin de sezction triaxialstressController = shared_ptr<TriaxialStressController> (new TriaxialStressController);" << std::endl;
+	#endif
 	
+	
 	rootBody->engines.clear();
 	rootBody->engines.push_back(shared_ptr<Engine>(new PhysicalActionContainerReseter));
 //	rootBody->engines.push_back(sdecTimeStepper);	


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From bruno.chareyre at hmg.inpg.fr  Mon Nov 17 16:11:12 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Mon, 17 Nov 2008 16:11:12 +0100
Subject: [deprecated list] [Yade-dev] (x,y,z) convention
Message-ID: <49218990.2060402@hmg.inpg.fr>

Hello

Could we get the previous default QGL orientation back please (I guess 
this is a question for Va?lav)?
Everyone needs to rotate his view when he starts a simulation, it seems. 
Yes, we have nice new buttons to make it fast, but still... what is the 
point of changing axis convention after few years of development?
Don't worry, this is the usual whining "Oh my god!! I've not work on 
Yade for 2 months and I can't get it to work normally now!"
It will stop soon...

Bruno


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Grenoble INP
Laboratoire 3SR - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Mon Nov 17 16:40:02 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Mon, 17 Nov 2008 16:40:02 +0100
Subject: [deprecated list] [Yade-dev] (x,y,z) convention
In-Reply-To: <49218990.2060402@hmg.inpg.fr>
References: <49218990.2060402@hmg.inpg.fr>
Message-ID: <49219052.1070101@arcig.cz>


> Could we get the previous default QGL orientation back please (I guess
> this is a question for Va?lav)?
> Everyone needs to rotate his view when he starts a simulation, it
> seems. Yes, we have nice new buttons to make it fast, but still...
> what is the point of changing axis convention after few years of
> development?
> Don't worry, this is the usual whining "Oh my god!! I've not work on
> Yade for 2 months and I can't get it to work normally now!"
> It will stop soon...
It was Janek who changed that (we had a tough discussion on that in
Aussois) claiming that as there is no overall convention for
orientation, we will orient the scene agains the sense of gravity (if
there is a GravityEngine) -- I thought this to be non-obvious and was
opposing that. Glad that you speak up, Bruno, I am for democratically
reverting that :-)

Vaclav


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From chareyre at mail.berlios.de  Mon Nov 17 16:41:44 2008
From: chareyre at mail.berlios.de (chareyre at BerliOS)
Date: Mon, 17 Nov 2008 16:41:44 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1573 - in trunk:
	extra/triangulation	pkg/dem/Engine/DeusExMachina
	pkg/dem/Engine/StandAloneEngine
Message-ID: <200811171541.mAHFfixL009826@sheep.berlios.de>

Author: chareyre
Date: 2008-11-17 16:41:43 +0100 (Mon, 17 Nov 2008)
New Revision: 1573

Modified:
   trunk/extra/triangulation/Tesselation.cpp
   trunk/extra/triangulation/TesselationWrapper.cpp
   trunk/extra/triangulation/makefile
   trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp
   trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.cpp
Log:
- Fix conflicts and prepare next implementation of isotropic compression




Modified: trunk/extra/triangulation/Tesselation.cpp
===================================================================
--- trunk/extra/triangulation/Tesselation.cpp	2008-11-17 10:54:38 UTC (rev 1572)
+++ trunk/extra/triangulation/Tesselation.cpp	2008-11-17 15:41:43 UTC (rev 1573)
@@ -1,13 +1,13 @@
 #include "Tesselation.h"
 #include "CGAL/constructions/constructions_on_weighted_points_cartesian_3.h"
 //Tesselation TESSELATION = Tesselation();
- 
 
+
 using namespace std;
-  
+
 Tesselation::Tesselation ( void )
 {
-// 	std::cout << "Tesselation(void)" << std::endl;
+//  std::cout << "Tesselation(void)" << std::endl;
 	Tri = new RTriangulation;
 	Tes = Tri;
 	computed = false;
@@ -22,7 +22,7 @@
 Tesselation::Tesselation ( RTriangulation &T )
 		: Tri ( &T ), Tes ( &T ), computed ( true )
 {
-// 	std::cout << "Tesselation(RTriangulation &T)" << std::endl;
+//  std::cout << "Tesselation(RTriangulation &T)" << std::endl;
 	Compute();
 }
 
@@ -42,20 +42,20 @@
 
 // bool Tesselation::insert ( Real x, Real y, Real z, Real rad, unsigned int id, bool isFictious )
 // {
-// 	Vertex_handle Vh;
-// 	Vh = Tri->insert ( Sphere ( Point ( x,y,z ),pow ( rad,2 ) ) );
-// 	if ( Vh!=NULL )
-// 	{
-// 		Vh->info() = id;
-// 		Vh->info().isFictious = isFictious;
-// 		if ( !isFictious ) max_id = std::max ( max_id, id );
-// 	}
-// 	else return false;
-// 	return true;
+//  Vertex_handle Vh;
+//  Vh = Tri->insert ( Sphere ( Point ( x,y,z ),pow ( rad,2 ) ) );
+//  if ( Vh!=NULL )
+//  {
+//   Vh->info() = id;
+//   Vh->info().isFictious = isFictious;
+//   if ( !isFictious ) max_id = std::max ( max_id, id );
+//  }
+//  else return false;
+//  return true;
 // }
 
 
-Vertex_handle Tesselation::insert(Real x, Real y, Real z, Real rad, unsigned int id, bool isFictious)
+Vertex_handle Tesselation::insert ( Real x, Real y, Real z, Real rad, unsigned int id, bool isFictious )
 {
 
 	Vertex_handle Vh;
@@ -66,12 +66,12 @@
 		Vh->info().isFictious = isFictious;
 		if ( !isFictious ) max_id = std::max ( max_id, id );
 	}
- 	else cout << id <<  " : Vh==NULL!!" << endl;
+	else cout << id <<  " : Vh==NULL!!" << endl;
 	return Vh;
 }
 
 
-Vertex_handle Tesselation::move(Real x, Real y, Real z, Real rad, unsigned int id)
+Vertex_handle Tesselation::move ( Real x, Real y, Real z, Real rad, unsigned int id )
 {
 	bool fictious = vertexHandles[id]->info().isFictious;
 	Vertex_handle Vh;
@@ -80,13 +80,14 @@
 	{
 		vertexHandles[id] = Vh;
 		Vh->info() = id;
-		Vh->info().isFictious = fictious;		
-	} else cerr << "Vh==NULL" << " id=" << id << " Point=" << Point ( x,y,z ) << " rad=" << rad << endl;
+		Vh->info().isFictious = fictious;
+	}
+	else cerr << "Vh==NULL" << " id=" << id << " Point=" << Point ( x,y,z ) << " rad=" << rad << endl;
 	return Vh;
 }
- 
 
 
+
 bool Tesselation::redirect ( void )
 {
 	if ( !redirected )
@@ -159,11 +160,8 @@
 
 void Tesselation::Compute ()
 {
-<<<<<<< .mine
-// 	std::cout << "Tesselation::Compute ()" << std::endl;
-=======
-	std::cerr << "Tesselation::Compute ()" << std::endl;
->>>>>>> .r1529
+
+//  std::cout << "Tesselation::Compute ()" << std::endl;
 	Finite_cells_iterator cell_end = Tri->finite_cells_end();
 
 	for ( Finite_cells_iterator cell = Tri->finite_cells_begin(); cell != cell_end; cell++ )
@@ -185,11 +183,11 @@
 			S3.point().x(), S3.point().y(), S3.point().z(), S3.weight(),
 			x, y, z );
 		cell->info() =Point ( x,y,z );
-		//cout << "voronoi cell : " <<  cell->vertex(0)->info().id() << " " 
-		//		<<  cell->vertex(1)->info().id() << " " 
-		//		<<  cell->vertex(2)->info().id() << " " 
-		//		<<  cell->vertex(3)->info().id() << "(center : " << (Point) cell->info() << ")" << endl;
-}
+		//cout << "voronoi cell : " <<  cell->vertex(0)->info().id() << " "
+		//  <<  cell->vertex(1)->info().id() << " "
+		//  <<  cell->vertex(2)->info().id() << " "
+		//  <<  cell->vertex(3)->info().id() << "(center : " << (Point) cell->info() << ")" << endl;
+	}
 
 
 	computed = true;
@@ -400,30 +398,30 @@
 	}
 	cell0=cell2++;
 	Cell_circulator cell1=cell2++;
-  //std::cout << "edge : " << ed_it->first->vertex ( ed_it->second )->info().id() << "-" << ed_it->first->vertex ( ed_it->third )->info().id() << std::endl;
+	//std::cout << "edge : " << ed_it->first->vertex ( ed_it->second )->info().id() << "-" << ed_it->first->vertex ( ed_it->third )->info().id() << std::endl;
 	bool isFictious1 = ( ed_it->first )->vertex ( ed_it->second )->info().isFictious;
 	bool isFictious2 = ( ed_it->first )->vertex ( ed_it->third )->info().isFictious;
 	Real r;
-	
-	//cout << "cell0 : " <<  cell0->vertex(0)->info().id() << " " 
-	//			<<  cell0->vertex(1)->info().id() << " " 
-	//			<<  cell0->vertex(2)->info().id() << " " 
-	//			<<  cell0->vertex(3)->info().id() << "(center : " << (Point) cell0->info() << ")" <<   endl;
 
+	//cout << "cell0 : " <<  cell0->vertex(0)->info().id() << " "
+	//   <<  cell0->vertex(1)->info().id() << " "
+	//   <<  cell0->vertex(2)->info().id() << " "
+	//   <<  cell0->vertex(3)->info().id() << "(center : " << (Point) cell0->info() << ")" <<   endl;
+
 	while ( cell2!=cell0 )
-	{		
+	{
 		if ( !Tri->is_infinite ( cell1 )  && !Tri->is_infinite ( cell2 ) )
 		{
-	//	cout << "cell1 : " <<  cell1->vertex(0)->info().id() << " " 
-	//			<<  cell1->vertex(1)->info().id() << " " 
-	//			<<  cell1->vertex(2)->info().id() << " " 
-	//			<<  cell1->vertex(3)->info().id() << "(center : " << (Point) cell1->info() << ")" << endl;
-	//	cout << "cell2 : " <<  cell2->vertex(0)->info().id() << " " 
-	//			<<  cell2->vertex(1)->info().id() << " " 
-	//			<<  cell2->vertex(2)->info().id() << " " 
-	//			<<  cell2->vertex(3)->info().id() << "(center : " << (Point) cell2->info() << ")" << endl;
-		
-    //std::cout << "assign tetra : (" << ed_it->first->vertex ( ed_it->second )->point() << "),(" << cell0->info() << "),(" << cell1->info() << "),(" <<cell2->info() << ")" << std::endl;
+			// cout << "cell1 : " <<  cell1->vertex(0)->info().id() << " "
+			//   <<  cell1->vertex(1)->info().id() << " "
+			//   <<  cell1->vertex(2)->info().id() << " "
+			//   <<  cell1->vertex(3)->info().id() << "(center : " << (Point) cell1->info() << ")" << endl;
+			// cout << "cell2 : " <<  cell2->vertex(0)->info().id() << " "
+			//   <<  cell2->vertex(1)->info().id() << " "
+			//   <<  cell2->vertex(2)->info().id() << " "
+			//   <<  cell2->vertex(3)->info().id() << "(center : " << (Point) cell2->info() << ")" << endl;
+
+			//std::cout << "assign tetra : (" << ed_it->first->vertex ( ed_it->second )->point() << "),(" << cell0->info() << "),(" << cell1->info() << "),(" <<cell2->info() << ")" << std::endl;
 			if ( !isFictious1 )
 			{
 				r = std::abs ( ( Tetraedre ( ed_it->first->vertex ( ed_it->second )->point(), cell0->info(), cell1->info(), cell2->info() ) ).volume() );
@@ -431,7 +429,7 @@
 				( ed_it->first )->vertex ( ed_it->second )->info().v() += r;
 				TotalFiniteVoronoiVolume+=r;
 			}
-    //std::cout << "assign tetra : (" << ed_it->first->vertex ( ed_it->third )->point() << "),(" << cell0->info() << "),(" << cell1->info() << "),(" <<cell2->info() << ")" << std::endl;
+			//std::cout << "assign tetra : (" << ed_it->first->vertex ( ed_it->third )->point() << "),(" << cell0->info() << "),(" << cell1->info() << "),(" <<cell2->info() << ")" << std::endl;
 			if ( !isFictious2 )
 			{
 				r = std::abs ( ( Tetraedre ( ed_it->first->vertex ( ed_it->third )->point(), cell0->info(),  cell1->info(), cell2->info() ) ).volume() );
@@ -474,11 +472,12 @@
 
 
 	redirect();
-// 	cout << "TotalVolume : " << TotalFiniteVoronoiVolume << endl;
+//  cout << "TotalVolume : " << TotalFiniteVoronoiVolume << endl;
 }
 
 void Tesselation::ComputePorosity ( void )  //WARNING : This function will erase real volumes of cells
-{      // and replace it with porosity
+{
+	// and replace it with porosity
 	ComputeVolumes();
 	//Real rr=0;
 	Finite_vertices_iterator vertices_end = Tri->finite_vertices_end ();

Modified: trunk/extra/triangulation/TesselationWrapper.cpp
===================================================================
--- trunk/extra/triangulation/TesselationWrapper.cpp	2008-11-17 10:54:38 UTC (rev 1572)
+++ trunk/extra/triangulation/TesselationWrapper.cpp	2008-11-17 15:41:43 UTC (rev 1573)
@@ -57,11 +57,9 @@
 	facet_it = Tes->Triangulation().finite_edges_end ();
 	
  }
-<<<<<<< .mine
+
  
-=======
  
- 
  void TesselationWrapper::clear2(void) //for testing purpose
  {
  	Tes->Clear();
@@ -76,7 +74,7 @@
  }
  
 
->>>>>>> .r1529
+
 double TesselationWrapper::Volume( unsigned int id )
 {
 	return Tes->Volume(id);

Modified: trunk/extra/triangulation/makefile
===================================================================
--- trunk/extra/triangulation/makefile	2008-11-17 10:54:38 UTC (rev 1572)
+++ trunk/extra/triangulation/makefile	2008-11-17 15:41:43 UTC (rev 1573)
@@ -83,18 +83,12 @@
 libTesselationWrapper.a : 	TesselationWrapper$(OBJ_EXT) \
 				Tenseur3$(OBJ_EXT) \
 				Tesselation$(OBJ_EXT) \
-<<<<<<< .mine
-				RegularTriangulation$(OBJ_EXT)
-	ar cr 	libTesselationWrapper.a \
-				TesselationWrapper$(OBJ_EXT) \
-=======
 				RegularTriangulation$(OBJ_EXT) \
 				TriaxialState$(OBJ_EXT) \
 				KinematicLocalisationAnalyser$(OBJ_EXT)
 	 		ar cr	libTesselationWrapper.a \
 	 			TesselationWrapper$(OBJ_EXT) \
 				Tenseur3$(OBJ_EXT) \
->>>>>>> .r1529
 				Tesselation$(OBJ_EXT) \
 				RegularTriangulation$(OBJ_EXT) \
 				TriaxialState$(OBJ_EXT) \

Modified: trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp	2008-11-17 10:54:38 UTC (rev 1572)
+++ trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp	2008-11-17 15:41:43 UTC (rev 1573)
@@ -51,14 +51,14 @@
 	previousSigmaIso=sigma_iso;
 	frictionAngleDegree = -1;
 	epsilonMax = 0.5;
+<<<<<<< .mine
 
 	isotropicCompaction=false;
 	spheresVolume=0;
  	boxVolume=0;
 
-	calculatedPorosity=1.1;	
+//	calculatedPorosity=1.1;	
 
-
 }
 
 TriaxialCompressionEngine::~TriaxialCompressionEngine()
@@ -184,11 +184,13 @@
 			doStateTransition (ncb, STATE_LIMBO );
 			}
 		}
-		else if ( calculatedPorosity<=fixedPorosity && currentState==STATE_FIXED_POROSITY_COMPACTION )
+
+		else if ( porosity<=fixedPorosity && currentState==STATE_FIXED_POROSITY_COMPACTION )
 		{
-		Omega::instance().stopSimulationLoop();
-		return;
+			Omega::instance().stopSimulationLoop();
+			return;
 		}
+
 #if 0
 		//This is a hack in order to allow subsequent run without activating compression - like for the YADE-COMSOL coupling
 		if ( !compressionActivated )
@@ -222,21 +224,22 @@
 		LOG_INFO ( "First run, will initialize!" );
 		/* FIXME: are these three if's mutually exclusive and are partition of all possibilities? */
 		//sigma_iso was changed, we need to rerun compaction
+
 		if ( (sigmaIsoCompaction!=previousSigmaIso || currentState==STATE_UNINITIALIZED || currentState== STATE_LIMBO) && currentState!=STATE_TRIAX_LOADING && isotropicCompaction == false) doStateTransition (ncb, STATE_ISO_COMPACTION );
 		if ( previousState==STATE_LIMBO && currentState==STATE_TRIAX_LOADING && isotropicCompaction == false ) doStateTransition (ncb, STATE_TRIAX_LOADING );
-		if ( fixedPorosity<1 && currentState==STATE_UNINITIALIZED && isotropicCompaction!=false )
-		{
-			doStateTransition (ncb, STATE_FIXED_POROSITY_COMPACTION );
-			FOREACH(const shared_ptr<Body>& b, *ncb->bodies){
-				if(!b->isDynamic) continue;
-				const shared_ptr<Sphere>& sphere=YADE_PTR_CAST<Sphere> ( b->geometricalModel );
-				spheresVolume += (4./3.)*Mathr::PI*pow( sphere->radius, 3 );
-			}
-			previousState=currentState;
-			previousSigmaIso=sigma_iso;
-			firstRun=false; // change this only _after_ state transitions
-		}
+		//if ( fixedPorosity<1 && currentState==STATE_UNINITIALIZED && isotropicCompaction!=false )
+		//{
+		//	doStateTransition (ncb, STATE_FIXED_POROSITY_COMPACTION );
+// 			FOREACH(const shared_ptr<Body>& b, *ncb->bodies){
+// 				if(!b->isDynamic) continue;
+// 				const shared_ptr<Sphere>& sphere=YADE_PTR_CAST<Sphere> ( b->geometricalModel );
+// 				spheresVolume += (4./3.)*Mathr::PI*pow( sphere->radius, 3 );
+// 			}
+		previousState=currentState;
+		previousSigmaIso=sigma_iso;
+		firstRun=false; // change this only _after_ state transitions
 	}
+
 	if ( saveSimulation )
 	{
 		string fileName = "./"+ Key + "_" + Phase1End + "_" +
@@ -288,6 +291,7 @@
 			Omega::instance().stopSimulationLoop();
 		}
 	}
+
 	if ( currentState==STATE_FIXED_POROSITY_COMPACTION )
 	{
 		if ( Omega::instance().getCurrentIteration() % 100 == 0 )
@@ -311,13 +315,6 @@
 		p->se3.position += 0.5*translationSpeed*width*translationAxisx*dt;
 		p = static_cast<PhysicalParameters*> ( Body::byId ( wall_right_id )->physicalParameters.get() );
 		p->se3.position -= 0.5*translationSpeed*width*translationAxisx*dt;
-
-	
-		boxVolume=height*width*depth;
-		
-		calculatedPorosity=1-spheresVolume/boxVolume;
-
-
 	}
  
 }

Modified: trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.cpp	2008-11-17 10:54:38 UTC (rev 1572)
+++ trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.cpp	2008-11-17 15:41:43 UTC (rev 1573)
@@ -27,15 +27,17 @@
 	//StiffnessMatrixClassIndex = actionParameterStiffnessMatrix->getClassIndex();
 	shared_ptr<Force> tmpF(new Force);
 	ForceClassIndex=tmpF->getClassIndex();
-
+	firstRun = true;
+	
 	previousStress = 0;
 	previousMultiplier = 1;
-	
+		
 	stiffnessUpdateInterval =10;
 	radiusControlInterval =10;
 	computeStressStrainInterval = 10;
 	wallDamping = 0.25;
 	//force = Vector3r::ZERO;
+	stiffness.resize(6);
 	for (int i=0; i<6; ++i)
 	{
 		wall_id[i] = 0;
@@ -68,6 +70,9 @@
 	height = 0;
 	width = 0;
 	depth = 0;
+	spheresVolume=0;
+	boxVolume=0;
+	porosity=0;
 	height0 = 0;
 	width0 = 0;
 	depth0 = 0;
@@ -93,7 +98,7 @@
 	
 	//REGISTER_ATTRIBUTE(UnbalancedForce);
 	
-	//REGISTER_ATTRIBUTE(stiffness);
+	REGISTER_ATTRIBUTE(stiffness);
  	REGISTER_ATTRIBUTE(wall_bottom_id);
  	REGISTER_ATTRIBUTE(wall_top_id);
  	REGISTER_ATTRIBUTE(wall_left_id);
@@ -193,8 +198,11 @@
 void TriaxialStressController::applyCondition(MetaBody* ncb)
 {
 	//cerr << "TriaxialStressController::applyCondition" << endl;
-		
+	
+	
 	shared_ptr<BodyContainer>& bodies = ncb->bodies;
+	
+	
 
 	if(thickness<=0) thickness=YADE_PTR_CAST<InteractingBox>(Body::byId(wall_bottom_id,ncb)->interactingGeometry)->extents.Y();
 
@@ -208,8 +216,28 @@
 	height = p_top->se3.position.Y() - p_bottom->se3.position.Y() - thickness;
 	width = p_right->se3.position.X() - p_left->se3.position.X() - thickness;
 	depth = p_front->se3.position.Z() - p_back->se3.position.Z() - thickness;
+	
+	boxVolume = height * width * depth;
+	
+	if (firstRun) {
+		BodyContainer::iterator bi = ncb->bodies->begin();
+		BodyContainer::iterator biEnd = ncb->bodies->end();
+		spheresVolume = 0;
+		for ( ; bi!=biEnd; ++bi )
+		{
+			const shared_ptr<Body>& b = *bi;
+			if ( b->isDynamic )
+			{
+				const shared_ptr<Sphere>& sphere =
+						YADE_PTR_CAST<Sphere> ( b->geometricalModel );
+				spheresVolume += 1.3333333*Mathr::PI*pow ( sphere->radius, 3 );
+			}
+		}
+		
+		firstRun = false;	
+	}
+	//porosity = ( boxVolume - spheresVolume ) /boxVolume;
 
-
 	position_top = p_top->se3.position.Y();
 	position_bottom = p_bottom->se3.position.Y();
 	position_right = p_right->se3.position.X();
@@ -221,7 +249,7 @@
 
 	// must be done _after_ height, width, depth have been calculated
 	//Update stiffness only if it has been computed by StiffnessCounter (see "stiffnessUpdateInterval")
-	if (Omega::instance().getCurrentIteration() % stiffnessUpdateInterval == 0 || Omega::instance().getCurrentIteration()<1000) updateStiffness(ncb);
+	if (Omega::instance().getCurrentIteration() % stiffnessUpdateInterval == 0 || Omega::instance().getCurrentIteration()<100) updateStiffness(ncb);
 
  
 		bool isARadiusControlIteration = (Omega::instance().getCurrentIteration() % radiusControlInterval == 0);
@@ -233,9 +261,11 @@
 		Vector3r wallForce (0, sigma_iso*width*depth, 0);
 		if (wall_bottom_activated) controlExternalStress(wall_bottom, ncb, -wallForce, p_bottom, max_vel);
 		if (wall_top_activated) controlExternalStress(wall_top, ncb, wallForce, p_top, max_vel);
+		
 		wallForce = Vector3r(sigma_iso*height*depth, 0, 0);
 		if (wall_left_activated) controlExternalStress(wall_left, ncb, -wallForce, p_left, max_vel*width/height);
 		if (wall_right_activated) controlExternalStress(wall_right, ncb, wallForce, p_right, max_vel*width/height);
+		
 		wallForce = Vector3r(0, 0, sigma_iso*height*width);
 		if (wall_back_activated) controlExternalStress(wall_back, ncb, -wallForce, p_back, max_vel*depth/height);
 		if (wall_front_activated) controlExternalStress(wall_front, ncb, wallForce, p_front, max_vel*depth/height);
@@ -316,39 +346,40 @@
 	meanStress/=6.;
 }
 
-void TriaxialStressController::controlInternalStress(MetaBody* ncb, Real multiplier)
+void TriaxialStressController::controlInternalStress ( MetaBody* ncb, Real multiplier )
 {
-   BodyContainer::iterator bi    = ncb->bodies->begin();
-   BodyContainer::iterator biEnd = ncb->bodies->end();
-   //cerr << "meanstress = "radius = " << endl;
-   //cerr << "bouclesurBodies" << endl;
-   for (  ; bi!=biEnd ; ++bi )
-   {
-		if ((*bi)->isDynamic)
+	spheresVolume *= pow ( multiplier,3 );
+	BodyContainer::iterator bi    = ncb->bodies->begin();
+	BodyContainer::iterator biEnd = ncb->bodies->end();
+	//cerr << "meanstress = "radius = " << endl;
+	//cerr << "bouclesurBodies" << endl;
+	for ( ; bi!=biEnd ; ++bi )
+	{
+		if ( ( *bi )->isDynamic )
 		{
-			(static_cast<InteractingSphere*> ((*bi)->interactingGeometry.get()))->radius *= multiplier;
-			(static_cast<Sphere*>((*bi)->geometricalModel.get()))->radius *= multiplier;
-			(static_cast<ParticleParameters*>((*bi)->physicalParameters.get()))->mass *= pow(multiplier,3);
-			(static_cast<RigidBodyParameters*>((*bi)->physicalParameters.get()))->inertia *= pow(multiplier,5);
-			
+			( static_cast<InteractingSphere*> ( ( *bi )->interactingGeometry.get() ) )->radius *= multiplier;
+			( static_cast<Sphere*> ( ( *bi )->geometricalModel.get() ) )->radius *= multiplier;
+			( static_cast<ParticleParameters*> ( ( *bi )->physicalParameters.get() ) )->mass *= pow ( multiplier,3 );
+			( static_cast<RigidBodyParameters*> ( ( *bi )->physicalParameters.get() ) )->inertia *= pow ( multiplier,5 );
+
 		}
 	}
 	// << "bouclesurInteraction" << endl;
 	InteractionContainer::iterator ii    = ncb->transientInteractions->begin();
 	InteractionContainer::iterator iiEnd = ncb->transientInteractions->end();
-	for (  ; ii!=iiEnd ; ++ii )
+	for ( ; ii!=iiEnd ; ++ii )
 	{
-		if ((*ii)->isReal)
+		if ( ( *ii )->isReal )
 		{
-			SpheresContactGeometry* contact = static_cast<SpheresContactGeometry*> ((*ii)->interactionGeometry.get());
-			//	     if ((*(ncb->bodies))[(*ii)->getId1()]->isDynamic)
-			//		 contact->radius1 *= multiplier;
-			//	     if ((*(ncb->bodies))[(*ii)->getId2()]->isDynamic)
-			//		 contact->radius2 *= multiplier;
-			if ((*(ncb->bodies))[(*ii)->getId1()]->isDynamic)
-				contact->radius1 = static_cast<InteractingSphere*> ((*(ncb->bodies))[(*ii)->getId1()]->interactingGeometry.get())->radius;
-			if ((*(ncb->bodies))[(*ii)->getId2()]->isDynamic)
-				contact->radius2 = static_cast<InteractingSphere*> ((*(ncb->bodies))[(*ii)->getId2()]->interactingGeometry.get())->radius;
+			SpheresContactGeometry* contact = static_cast<SpheresContactGeometry*> ( ( *ii )->interactionGeometry.get() );
+			//      if ((*(ncb->bodies))[(*ii)->getId1()]->isDynamic)
+			//   contact->radius1 *= multiplier;
+			//      if ((*(ncb->bodies))[(*ii)->getId2()]->isDynamic)
+			//   contact->radius2 *= multiplier;
+			if ( ( * ( ncb->bodies ) ) [ ( *ii )->getId1() ]->isDynamic )
+				contact->radius1 = static_cast<InteractingSphere*> ( ( * ( ncb->bodies ) ) [ ( *ii )->getId1() ]->interactingGeometry.get() )->radius;
+			if ( ( * ( ncb->bodies ) ) [ ( *ii )->getId2() ]->isDynamic )
+				contact->radius2 = static_cast<InteractingSphere*> ( ( * ( ncb->bodies ) ) [ ( *ii )->getId2() ]->interactingGeometry.get() )->radius;
 		}
 	}
 }

Modified: trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.cpp	2008-11-17 10:54:38 UTC (rev 1572)
+++ trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.cpp	2008-11-17 15:41:43 UTC (rev 1573)
@@ -19,13 +19,10 @@
 
 
 #include <yade/pkg-common/InteractingSphere.hpp>
-
 #include "VolumicContactLaw.hpp"
-
 #include<yade/extra/TesselationWrapper.h>
+#include <time.h>
 
- 
-
 VolumicContactLaw::VolumicContactLaw() : InteractionSolver() , actionForce(new Force) , actionMomentum(new Momentum)
 {
 	sdecGroupMask=1;
@@ -44,12 +41,79 @@
 }
 
 
+
+void VolumicContactLaw::speedTest(MetaBody* ncb)
+{
+//BEGIN SPEED TEST
+	shared_ptr<BodyContainer>& bodies = ncb->bodies;
+	TesselationWrapper T;
+	BodyContainer::iterator biBegin    = bodies->begin();
+	BodyContainer::iterator biEnd = bodies->end();
+	BodyContainer::iterator bi = biBegin;
+	for(  ; bi!=biEnd ; ++bi )
+	{
+		if ((*bi)->isDynamic) {//means "is it a sphere (not a wall)"
+			const InteractingSphere* s = YADE_CAST<InteractingSphere*>((*bi)->interactingGeometry.get());
+			const RigidBodyParameters* p = YADE_CAST<RigidBodyParameters*>((*bi)->physicalParameters.get());
+			T.checkMinMax(p->se3.position[0],p->se3.position[1],p->se3.position[2], s->radius);
+		}
+	}
+	
+	clock_t	T1 = clock();	
+	
+	for (int j=0; j<30; j++)
+	{
+		T.clear2();
+		T.bounded = false;
+		for( bi = biBegin; bi!=biEnd ; ++bi )
+		{
+			if ((*bi)->isDynamic) {//means "is it a sphere (not a wall)"
+				const InteractingSphere* s = YADE_CAST<InteractingSphere*>((*bi)->interactingGeometry.get());
+				const RigidBodyParameters* p = YADE_CAST<RigidBodyParameters*>((*bi)->physicalParameters.get());
+				T.insert(p->se3.position[0],p->se3.position[1],p->se3.position[2], s->radius, (*bi)->getId());
+			}
+		}
+		//T.AddBoundingPlanes();	
+	}
+	
+	
+	cerr << "Bouding planes apres : time = "<< difftime(clock(), T1)/ CLOCKS_PER_SEC << endl;
+	T1 = clock();
+	
+	
+	for (int j=0; j<30; j++)
+	{	
+		T.clear2();
+		T.bounded = false;
+		//T.AddBoundingPlanes();
+		for( bi = biBegin; bi!=biEnd ; ++bi )
+		{
+			if ((*bi)->isDynamic) {//means "is it a sphere (not a wall)"
+				const InteractingSphere* s = YADE_CAST<InteractingSphere*>((*bi)->interactingGeometry.get());
+				const RigidBodyParameters* p = YADE_CAST<RigidBodyParameters*>((*bi)->physicalParameters.get());
+				T.insert(p->se3.position[0],p->se3.position[1],p->se3.position[2], s->radius, (*bi)->getId());
+			}
+		
+		}
+	
+	}	
+	
+	cerr << "Bouding planes avant : time = "<< difftime(clock(), T1)/ CLOCKS_PER_SEC << endl;
+//END SPEED TEST
+
+
+
+
+}
+
+
 void VolumicContactLaw::action(MetaBody* ncb)
 {
 	shared_ptr<BodyContainer>& bodies = ncb->bodies;
 
 	Real dt = Omega::instance().getTimeStep();
 
+	speedTest(ncb);	
 
 	//BEGIN VORONOI TESSELATION
 	TesselationWrapper T1;	
@@ -139,7 +203,6 @@
 	    }
 	} 
 	//ENDOF VORONOI TESSELATION
-	 
 			
 /// Non Permanents Links												///
 


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From chareyre at mail.berlios.de  Mon Nov 17 16:48:38 2008
From: chareyre at mail.berlios.de (chareyre at BerliOS)
Date: Mon, 17 Nov 2008 16:48:38 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1574 - in trunk:
	extra/triangulation	pkg/dem/Engine/DeusExMachina
	pkg/dem/Engine/StandAloneEngine
Message-ID: <200811171548.mAHFmcx6010665@sheep.berlios.de>

Author: chareyre
Date: 2008-11-17 16:48:37 +0100 (Mon, 17 Nov 2008)
New Revision: 1574

Added:
   trunk/pkg/dem/Engine/StandAloneEngine/MicroMacroAnalyser.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/MicroMacroAnalyser.hpp
Modified:
   trunk/extra/triangulation/TesselationWrapper.h
   trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.hpp
   trunk/pkg/dem/Engine/DeusExMachina/TriaxialStateRecorder.cpp
   trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.hpp
Log:
- Few files missing in the previous commit.
- Add a new class for computing/recording micromechanical data based on 
tesselation




Modified: trunk/extra/triangulation/TesselationWrapper.h
===================================================================
--- trunk/extra/triangulation/TesselationWrapper.h	2008-11-17 15:41:43 UTC (rev 1573)
+++ trunk/extra/triangulation/TesselationWrapper.h	2008-11-17 15:48:37 UTC (rev 1574)
@@ -25,7 +25,7 @@
 
 class TesselationWrapper{
 
-private:
+public:
 
 	Tesselation* Tes;
 	double mean_radius;
@@ -40,11 +40,10 @@
     	///Insert a sphere
 	
     	bool insert(double x, double y, double z, double rad, unsigned int id);
+    	void checkMinMax(double x, double y, double z, double rad);//for experimentation purpose
     	bool move (double x, double y, double z, double rad, unsigned int id);
     	void clear(void);
-
-
-
+    	void clear2(void);
     	    	
 	///Add axis aligned bounding planes (modelised as spheres with (almost) infinite radius)
 //  	void 	AddBoundingPlanes (void); 

Modified: trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.hpp	2008-11-17 15:41:43 UTC (rev 1573)
+++ trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.hpp	2008-11-17 15:48:37 UTC (rev 1574)
@@ -88,17 +88,12 @@
 		Real& uniaxialEpsilonCurr;
 		//! Value of friction to use for the compression test
 		Real frictionAngleDegree;
-		//! document TODO
-		Real spheresVolume;
-		//! Value of spheres volume 
-		Real boxVolume;
-		//! Value of box volume 
-		Real calculatedPorosity;
-		//! Value of porosity during the simulation 
-		Real translationSpeed;
+		
 		//! Value of translation speed
-		Real fixedPorosity;
+		Real translationSpeed;
 		//! Value of porosity chosen by the user
+		Real fixedPorosity;
+		
 
 		//! Previous state (used to detect manual changes of the state in .xml)
 		stateNum previousState;
@@ -135,6 +130,7 @@
 	protected :
 		virtual void postProcessAttributes(bool);
 		virtual void registerAttributes();
+		
 	REGISTER_CLASS_NAME(TriaxialCompressionEngine);
 	REGISTER_BASE_CLASS_NAME(TriaxialStressController);
 };

Modified: trunk/pkg/dem/Engine/DeusExMachina/TriaxialStateRecorder.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/TriaxialStateRecorder.cpp	2008-11-17 15:41:43 UTC (rev 1573)
+++ trunk/pkg/dem/Engine/DeusExMachina/TriaxialStateRecorder.cpp	2008-11-17 15:48:37 UTC (rev 1574)
@@ -183,5 +183,127 @@
 
 
 }
+/*
+TriaxialStressController::ComputeLoveStress ( MetaBody * ncb )
+{
+	shared_ptr<BodyContainer>& bodies = ncb->bodies;
 
+	Real f1_el_x=0, f1_el_y=0, f1_el_z=0, x1=0, y1=0, z1=0, x2=0, y2=0, z2=0;
+
+	Real sig11_el=0, sig22_el=0, sig33_el=0, sig12_el=0, sig13_el=0,
+ sig23_el=0;
+	//, Vwater = 0,
+ Real kinematicE = 0;
+
+ InteractionContainer::iterator ii    = ncb->transientInteractions->begin();
+ InteractionContainer::iterator iiEnd = ncb->transientInteractions->end();
+
+ Real j = 0;
+ Real FT[3][3] = {{0,0,0},{0,0,0},{0,0,0}};
+
+ for ( ; ii!=iiEnd ; ++ii )
+ {
+	 if ( ( *ii )->isReal )
+	 {
+		 const shared_ptr<Interaction>& interaction = *ii;
+
+		 unsigned int id1 = interaction -> getId1();
+		 unsigned int id2 = interaction -> getId2();
+
+		 SpheresContactGeometry* currentContactGeometry  =
+				 static_cast<SpheresContactGeometry*> ( interaction->interactionGeometry.
+				 get() );
+
+		 ElasticContactInteraction* currentContactPhysics =
+				 static_cast<ElasticContactInteraction*>
+				 ( interaction->interactionPhysics.get() );
+
+		 Real fn = currentContactPhysics->normalForce.Length();
+
+		 if ( fn!=0 )
+
+				//if (currentContactGeometry->penetrationDepth >= 0)
+
+		 {
+			 j=j+1;
+
+			 Vector3r fel =
+					 currentContactPhysics->normalForce + currentContactPhysics->shearForce;
+
+			 f1_el_x=fel[0];
+			 f1_el_y=fel[1];
+			 f1_el_z=fel[2];
+
+			 int geometryIndex1 =
+					 ( *bodies ) [id1]->geometricalModel->getClassIndex();
+			 int geometryIndex2 =
+					 ( *bodies ) [id2]->geometricalModel->getClassIndex();
+
+			 if ( geometryIndex1 == geometryIndex2 )
+
+			 {
+				 BodyMacroParameters* de1 =
+						 static_cast<BodyMacroParameters*> ( ( *bodies ) [id1]->physicalParameters.get() );
+				 x1 = de1->se3.position[0];
+				 y1 = de1->se3.position[1];
+				 z1 = de1->se3.position[2];
+
+
+				 BodyMacroParameters* de2 =
+						 static_cast<BodyMacroParameters*> ( ( *bodies ) [id2]->physicalParameters.get() );
+				 x2 = de2->se3.position[0];
+				 y2 = de2->se3.position[1];
+				 z2 = de2->se3.position[2];
+
+					///Calcul des contraintes elastiques spheres/spheres
+
+				 sig11_el = sig11_el + f1_el_x* ( x2 - x1 );
+				 sig22_el = sig22_el + f1_el_y* ( y2 - y1 );
+				 sig33_el = sig33_el + f1_el_z* ( z2 - z1 );
+				 sig12_el = sig12_el + f1_el_x* ( y2 - y1 );
+				 sig13_el = sig13_el + f1_el_x* ( z2 - z1 );
+				 sig23_el = sig23_el + f1_el_y* ( z2 - z1 );
+
+			 }
+
+			 else
+
+			 {
+				 Vector3r l =
+						 std::min ( currentContactGeometry->radius2,
+						 currentContactGeometry->radius1 )
+						 *currentContactGeometry->normal;
+
+					/// Calcul des contraintes elastiques spheres/parois
+
+				 sig11_el = sig11_el + f1_el_x*l[0];
+				 sig22_el = sig22_el + f1_el_y*l[1];
+				 sig33_el = sig33_el + f1_el_z*l[2];
+				 sig12_el = sig12_el + f1_el_x*l[1];
+				 sig13_el = sig13_el + f1_el_x*l[2];
+				 sig23_el = sig23_el + f1_el_y*l[2];
+
+			 }
+
+				/// fabric tensor
+
+			 Vector3r normal = currentContactGeometry->normal;
+
+			 for ( int i=0; i<3; ++i )
+			 {
+				 for ( int n=0; n<3; ++n )
+				 {
+						//fabricTensor[i][n]
+					 FT[i][n]
+							 += normal[i]*normal[n];
+				 }
+			 }
+
+		 }
+	 }
+ }
+}*/
+
+
+
 YADE_PLUGIN();

Modified: trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.hpp	2008-11-17 15:41:43 UTC (rev 1573)
+++ trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.hpp	2008-11-17 15:48:37 UTC (rev 1574)
@@ -31,6 +31,7 @@
 		//int cachedForceClassIndex;
 		int ForceClassIndex;
 		Real previousStress, previousMultiplier; //previous mean stress and size multiplier		
+		bool firstRun;
 		
 		 	
 	public :
@@ -44,7 +45,7 @@
 		//! Stores the value of the translation at the previous time step, stiffness, and normal
 		Vector3r	previousTranslation [6];
 		//! The value of stiffness (updated according to stiffnessUpdateInterval) 
-		Real		stiffness [6];
+		vector<Real>	stiffness;
 		Real 		strain [3];
 		Real volumetricStrain;
 		Vector3r	normal [6];
@@ -52,6 +53,12 @@
 		Vector3r	stress [6];
 		Vector3r	force [6];
 		Real		meanStress;
+		//! Value of spheres volume (solid volume)
+		Real spheresVolume;
+		//! Value of box volume 
+		Real boxVolume;
+		//! Sample porosity
+		Real porosity;
 				
 		
 		//Real UnbalancedForce;		

Added: trunk/pkg/dem/Engine/StandAloneEngine/MicroMacroAnalyser.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/MicroMacroAnalyser.cpp	2008-11-17 15:41:43 UTC (rev 1573)
+++ trunk/pkg/dem/Engine/StandAloneEngine/MicroMacroAnalyser.cpp	2008-11-17 15:48:37 UTC (rev 1574)
@@ -0,0 +1,237 @@
+/*************************************************************************
+*  Copyright (C) 2008 by Bruno Chareyre                                  *
+*  bruno.chareyre at hmg.inpg.fr                                            *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+
+#include<yade/pkg-dem/BodyMacroParameters.hpp>
+#include<yade/pkg-dem/SpheresContactGeometry.hpp>
+
+#include<yade/pkg-dem/ElasticContactInteraction.hpp>
+
+#include<yade/core/Omega.hpp>
+#include<yade/core/MetaBody.hpp>
+#include<yade/pkg-common/Force.hpp>
+#include<yade/pkg-common/Momentum.hpp>
+#include<yade/core/PhysicalAction.hpp>
+
+#include <yade/pkg-common/InteractingSphere.hpp>
+
+#include "MicroMacroAnalyser.hpp"
+
+#include "TesselationWrapper.h"
+
+#include "KinematicLocalisationAnalyser.hpp"
+#include "TriaxialState.h"
+
+CREATE_LOGGER(MicroMacroAnalyser);
+
+MicroMacroAnalyser::MicroMacroAnalyser() : StandAloneEngine() , actionForce(new Force) , actionMomentum(new Momentum)
+{
+	actionForceIndex = actionForce->getClassIndex();
+	actionMomentumIndex = actionMomentum->getClassIndex();
+	analyser = shared_ptr<KinematicLocalisationAnalyser> (new KinematicLocalisationAnalyser);
+	analyser->SetConsecutive (true);
+	analyser->SetNO_ZERO_ID (false);
+	interval = 100;
+	outputFile = "MicroMacroAnalysis";
+	stateFileName = "./snapshots/state";
+}
+
+
+void MicroMacroAnalyser::registerAttributes()
+{
+	REGISTER_ATTRIBUTE(interval);
+	REGISTER_ATTRIBUTE(outputFile);
+}
+
+void MicroMacroAnalyser::postProcessAttributes(bool deserializing)
+{
+	if(deserializing)
+	{
+		bool file_exists = std::ifstream (outputFile.c_str()); //if file does not exist, we will write colums titles
+		ofile.open(outputFile.c_str(), std::ios::app);
+		if (!file_exists) ofile<<"iteration eps1w eps2w eps3w eps11g eps22g eps33g eps12g eps13g eps23g"<< endl;
+	}
+}
+
+void MicroMacroAnalyser::action(MetaBody* ncb)
+{
+	//cerr << "MicroMacroAnalyser::action(MetaBody* ncb) (interval="<< interval <<", iteration="<< Omega::instance().getCurrentIteration()<<")" << endl;
+	if (Omega::instance().getCurrentIteration() == 0) setState(ncb, 1);
+	else if (Omega::instance().getCurrentIteration() % interval == 0) {
+		setState(ncb, 2, true, true);
+		analyser->ComputeParticlesDeformation();
+		Tenseur_sym3 epsg ( analyser->grad_u_total );
+		ofile << Omega::instance().getCurrentIteration() << analyser->Delta_epsilon(1,1)<<" "<<analyser->Delta_epsilon(2,2)<<" "<<analyser->Delta_epsilon(3,3)<<" "<<epsg(1,1)<<" "<<epsg(2,2)<< " "<<epsg(3,3)<<" "<<epsg(1,2)<<" "<<epsg(1,3)<<" "<<epsg(2,3)<<endl;
+		analyser->SwitchStates();
+	}
+	//cerr << "ENDOF MicroMacro::action" << endl;
+}
+
+
+
+void MicroMacroAnalyser::setState ( MetaBody* ncb, unsigned int state, bool saveStates, bool computeIncrement )
+{
+	LOG_INFO ("MicroMacroAnalyser::setState");
+	if ( !triaxialCompressionEngine )
+	{
+		vector<shared_ptr<Engine> >::iterator itFirst = ncb->engines.begin();
+		vector<shared_ptr<Engine> >::iterator itLast = ncb->engines.end();
+		for ( ;itFirst!=itLast; ++itFirst )
+		{
+			if ( ( *itFirst )->getClassName() == "TriaxialCompressionEngine" ) //|| (*itFirst)->getBaseClassName() == "TriaxialCompressionEngine")
+			{
+				LOG_DEBUG ( "stress controller engine found" );
+				triaxialCompressionEngine =  YADE_PTR_CAST<TriaxialCompressionEngine> ( *itFirst );
+				//triaxialCompressionEngine = shared_ptr<TriaxialCompressionEngine> (static_cast<TriaxialCompressionEngine*> ( (*itFirst).get()));
+			}
+		}
+		if ( !triaxialCompressionEngine ) LOG_ERROR ( "stress controller engine not found" );
+	}
+
+	shared_ptr<BodyContainer>& bodies = ncb->bodies;
+	TriaxialState* ts;
+	if ( state==1 ) ts = analyser->TS0;
+	else if ( state==2 ) ts = analyser->TS1;
+	else LOG_ERROR ( "state must be 1 or 2, instead of " << state );
+	TriaxialState& TS = *ts;
+
+	TS.reset();
+
+	long Ng = bodies->size();
+	//cerr << "Ng= " << Ng << endl;
+	//Statefile >> Ng;
+	//Real x, y, z, rad; //coordonn?es/rayon
+	//Real tx, ty, tz;
+	//Point pos;
+	TS.mean_radius=0;
+	//Vecteur trans, rot;
+	//Real rad; //coordonn?es/rayon
+
+	TS.grains.resize ( Ng );
+	//cerr << "Ngrains =" << Ng << endl;
+	//GrainIterator git= grains.begin();
+//  git->id=0;
+//  git->sphere = Sphere(CGAL::ORIGIN, 0);
+//  git->translation = CGAL::NULL_VECTOR;
+//  git->rotation = CGAL::NULL_VECTOR;
+
+	BodyContainer::iterator biBegin    = bodies->begin();
+	BodyContainer::iterator biEnd = bodies->end();
+	BodyContainer::iterator bi = biBegin;
+	Ng = 0;
+
+	
+	for ( ; bi!=biEnd ; ++bi )
+	{
+		body_id_t Idg = ( *bi )->getId();
+		TS.grains[Idg].id = Idg;
+		
+		if ( !( *bi )->isDynamic ) TS.grains[Idg].isSphere = false;
+		else {//then it is a sphere (not a wall)
+			++Ng;
+			const InteractingSphere* s = YADE_CAST<InteractingSphere*> ( ( *bi )->interactingGeometry.get() );
+			const RigidBodyParameters* p = YADE_CAST<RigidBodyParameters*> ( ( *bi )->physicalParameters.get() );
+			const Vector3r& pos = p->se3.position;
+			Real rad = s->radius;
+
+			TS.grains[Idg].sphere = Sphere ( Point ( p->se3.position[0],p->se3.position[1],p->se3.position[2] ),  rad );
+//    TS.grains[Idg].translation = trans;
+//    grains[Idg].rotation = rot;
+			TS.box.base = Point ( min ( TS.box.base.x(), pos.X()-rad ),
+								  min ( TS.box.base.y(), pos.Y()-rad ),
+								  min ( TS.box.base.z(), pos.Z()-rad ) );
+			TS.box.sommet = Point ( max ( TS.box.sommet.x(), pos.X() +rad ),
+									max ( TS.box.sommet.y(), pos.Y() +rad ),
+									max ( TS.box.sommet.z(), pos.Z() +rad ) );
+			TS.mean_radius += TS.grains[Idg].sphere.weight();
+
+
+		}
+	}
+
+	TS.mean_radius /= Ng;//rayon moyen
+	LOG_INFO ( " loaded : " << Ng << " grains with mean radius = " << TS.mean_radius );
+
+	InteractionContainer::iterator ii    = ncb->transientInteractions->begin();
+	InteractionContainer::iterator iiEnd = ncb->transientInteractions->end();
+	for ( ; ii!=iiEnd ; ++ii )
+	{
+		if ( ( *ii )->isReal )
+		{
+			TriaxialState::Contact *c = new TriaxialState::Contact;
+			TS.contacts.push_back ( c );
+			TriaxialState::VectorGrain& grains = TS.grains;
+			body_id_t id1 = ( *ii )->getId1();
+			body_id_t id2 = ( *ii )->getId2();
+
+			c->grain1 = & ( TS.grains[id1] );
+			c->grain2 = & ( TS.grains[id2] );
+			grains[id1].contacts.push_back ( c );
+			grains[id2].contacts.push_back ( c );
+			c->normal = Vecteur ( 
+					 ( YADE_CAST<SpheresContactGeometry*> ( ( *ii )->interactionGeometry.get() ) )->normal.X(),
+					 ( YADE_CAST<SpheresContactGeometry*> ( ( *ii )->interactionGeometry.get() ) )->normal.Y(),
+					 ( YADE_CAST<SpheresContactGeometry*> ( ( *ii )->interactionGeometry.get() ) )->normal.Z() );
+// 			c->normal = ( grains[id2].sphere.point()-grains[id1].sphere.point() );
+// 			c->normal = c->normal/sqrt ( pow ( c->normal.x(),2 ) +pow ( c->normal.y(),2 ) +pow ( c->normal.z(),2 ) );
+			c->position = Vecteur ( 
+					( YADE_CAST<SpheresContactGeometry*> ( ( *ii )->interactionGeometry.get() ) )->contactPoint.X(),
+					( YADE_CAST<SpheresContactGeometry*> ( ( *ii )->interactionGeometry.get() ) )->contactPoint.Y(),
+					( YADE_CAST<SpheresContactGeometry*> ( ( *ii )->interactionGeometry.get() ) )->contactPoint.Z() );
+// 			c->position = 0.5* ( ( grains[id1].sphere.point()-CGAL::ORIGIN ) +
+// 								 ( grains[id1].sphere.weight() *c->normal ) +
+// 								 ( grains[id2].sphere.point()-CGAL::ORIGIN ) -
+// 								 ( grains[id2].sphere.weight() *c->normal ) );
+
+
+			c->fn = YADE_CAST<ElasticContactInteraction*> ( ( ( *ii )->interactionPhysics.get() ) )->normalForce.Dot ( ( YADE_CAST<SpheresContactGeometry*> ( ( *ii )->interactionGeometry.get() ) )->normal );
+			Vector3r fs = YADE_CAST<ElasticContactInteraction*> ( ( *ii )->interactionPhysics.get() )->shearForce;
+			c->fs = Vecteur ( fs.X(),fs.Y(),fs.Z() );
+			c->old_fn = c->fn;
+			c->old_fs = c->fs;
+			c->frictional_work = 0;
+		}
+	}
+
+	//Load various parameters
+
+	//rfric = find_parameter("rfric=", Statefile);// ? remettre quand les fichiers n'auront plus l'espace de trop...
+//  Eyn = find_parameter("Eyn=", Statefile);
+//  Eys = find_parameter("Eys=", Statefile);
+	TS.wszzh = triaxialCompressionEngine->stress[triaxialCompressionEngine->wall_top][1];//find_parameter("wszzh=", Statefile);
+	TS.wsxxd = triaxialCompressionEngine->stress[triaxialCompressionEngine->wall_right][0];//find_parameter("wsxxd=", Statefile);
+	TS.wsyyfa = triaxialCompressionEngine->stress[triaxialCompressionEngine->wall_front][2];//find_parameter("wsyyfa=", Statefile);
+	TS.eps3 = triaxialCompressionEngine->strain[2];//find_parameter("eps3=", Statefile);
+	TS.eps1 = triaxialCompressionEngine->strain[0];//find_parameter("eps1=", Statefile);
+	TS.eps2 = triaxialCompressionEngine->strain[1];//find_parameter("eps2=", Statefile);
+
+	TS.haut = triaxialCompressionEngine->height;//find_parameter("haut=", Statefile);
+	TS.larg = triaxialCompressionEngine->width;//find_parameter("larg=", Statefile);
+	TS.prof = triaxialCompressionEngine->depth;//find_parameter("prof=", Statefile);
+	TS.porom = analyser->ComputeMacroPorosity();//find_parameter("porom=", Statefile);
+	TS.ratio_f = triaxialCompressionEngine-> ComputeUnbalancedForce ( ncb );//find_parameter("ratio_f=", Statefile);
+//  vit = find_parameter("vit=", Statefile);
+
+	
+	if ( state == 2 && computeIncrement )
+	{
+		analyser->SetForceIncrements();
+		analyser->SetDisplacementIncrements();
+	}
+	if ( saveStates ) 
+	{
+		ostringstream oss;
+		oss<<stateFileName<<"_"<<Omega::instance().getCurrentIteration();
+		TS.to_file ( oss.str().c_str() );
+	}
+	cerr << "ENDOF MicroMacroAnalyser::setState" << endl;
+}
+
+
+
+YADE_PLUGIN();

Added: trunk/pkg/dem/Engine/StandAloneEngine/MicroMacroAnalyser.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/MicroMacroAnalyser.hpp	2008-11-17 15:41:43 UTC (rev 1573)
+++ trunk/pkg/dem/Engine/StandAloneEngine/MicroMacroAnalyser.hpp	2008-11-17 15:48:37 UTC (rev 1574)
@@ -0,0 +1,61 @@
+/*************************************************************************
+*  Copyright (C) 2008 by Bruno Chareyre                                  *
+*  bruno.chareyre at hmg.inpg.fr                                            *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#ifndef MACRO_MICRO_ANALYSER_HPP
+#define MACRO_MICRO_ANALYSER_HPP
+
+#include<yade/core/StandAloneEngine.hpp>
+#include<yade/pkg-dem/TriaxialCompressionEngine.hpp>
+
+#include <set>
+#include <boost/tuple/tuple.hpp>
+#include <string>
+#include <fstream>
+
+/*! \brief Compute quantities like fabric tensor, local porosity, local deformation, and other micromechanicaly defined quantities based on triangulation/tesselation of the packing
+		
+	This class is using a separate library built from extra/triangulation sources		
+ */
+
+class PhysicalAction;
+class KinematicLocalisationAnalyser;
+
+class MicroMacroAnalyser : public StandAloneEngine
+{
+/// Attributes
+	private :
+		shared_ptr<PhysicalAction> actionForce;
+		shared_ptr<PhysicalAction> actionMomentum;
+		int actionForceIndex;
+		int actionMomentumIndex;
+		std::ofstream ofile;
+		
+		shared_ptr<TriaxialCompressionEngine> triaxialCompressionEngine;
+		shared_ptr<KinematicLocalisationAnalyser> analyser;
+		std::string	 outputFile;
+		std::string	 stateFileName;
+		
+	public :
+		MicroMacroAnalyser();
+		void action(MetaBody*);
+		void setState(MetaBody* ncb, unsigned int state, bool saveStates = false, bool computeIncrement = false);//Set current state as initial (state=1) or final (state=2) congiguration for later kinematic analysis on the increment; if requested : save snapshots (with specific format) - possibly including contact forces increments on the state1->state2 interval
+		int interval;
+		
+	DECLARE_LOGGER;
+	
+	protected :
+		virtual void postProcessAttributes(bool deserializing);
+		void registerAttributes();
+	REGISTER_CLASS_NAME(MicroMacroAnalyser);
+	REGISTER_BASE_CLASS_NAME(StandAloneEngine);
+};
+
+REGISTER_SERIALIZABLE(MicroMacroAnalyser,false);
+
+#endif // MACRO_MICRO_ANALYZER_HPP
+


Property changes on: trunk/pkg/dem/Engine/StandAloneEngine/MicroMacroAnalyser.hpp
___________________________________________________________________
Name: svn:executable
   + *

Modified: trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.hpp	2008-11-17 15:41:43 UTC (rev 1573)
+++ trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.hpp	2008-11-17 15:48:37 UTC (rev 1574)
@@ -45,6 +45,7 @@
 	
 		VolumicContactLaw();
 		void action(MetaBody*);
+		void speedTest(MetaBody* ncb);
 
 	protected :
 		void registerAttributes();


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From chareyre at mail.berlios.de  Mon Nov 17 18:11:32 2008
From: chareyre at mail.berlios.de (chareyre at BerliOS)
Date: Mon, 17 Nov 2008 18:11:32 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1575 -
	trunk/pkg/dem/Engine/DeusExMachina
Message-ID: <200811171711.mAHHBWVq020955@sheep.berlios.de>

Author: chareyre
Date: 2008-11-17 18:11:31 +0100 (Mon, 17 Nov 2008)
New Revision: 1575

Modified:
   trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp
Log:

Still recovering from conflicted files... I hope this is the last one.



Modified: trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp	2008-11-17 15:48:37 UTC (rev 1574)
+++ trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp	2008-11-17 17:11:31 UTC (rev 1575)
@@ -51,7 +51,6 @@
 	previousSigmaIso=sigma_iso;
 	frictionAngleDegree = -1;
 	epsilonMax = 0.5;
-<<<<<<< .mine
 
 	isotropicCompaction=false;
 	spheresVolume=0;


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From richefeu at geo.hmg.inpg.fr  Fri Nov  7 09:50:40 2008
From: richefeu at geo.hmg.inpg.fr (Vincent Richefeu)
Date: Fri, 7 Nov 2008 09:50:40 +0100
Subject: [deprecated list] [Yade-dev] Damping at the contact level
Message-ID: <607313BD-714E-47F2-B1E4-9AD00BD3C08A@geo.hmg.inpg.fr>

Hi everybody,

I am very surprised that no viscosity is taken into account at  
contact level in Yade.
Maybe I'm wrong, but I have not seen anything like it!
I do not usually use a global damping ('NonViscousDamping' in Yade)  
and I prefer to
use local (at the contact level) damping that can be related to a  
'coefficient of restitution'.

Without going into sterile discussions, I would like to know if  
something like that exists in Yade.
Otherwise, I will need to add the class  
'NormalViscousInteraction' (and/or 'NormalViscousShearInteraction')
that store the damping parameter. I will need also to add a relative  
normal velocity parameter in the
very complet class SpheresContactGeometry. Note that it will be the  
possible to put aside the local
vicosity by setting the damping parameter to zero.

Does anyone has an objection?

Thanks,
Vincent


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From richefeu at geo.hmg.inpg.fr  Fri Nov  7 14:49:48 2008
From: richefeu at geo.hmg.inpg.fr (Vincent Richefeu)
Date: Fri, 7 Nov 2008 14:49:48 +0100
Subject: [deprecated list] [Yade-dev] Damping at the contact level
In-Reply-To: <49142137.6030409@arcig.cz>
References: <607313BD-714E-47F2-B1E4-9AD00BD3C08A@geo.hmg.inpg.fr>
	<49142137.6030409@arcig.cz>
Message-ID: <433576EE-1220-4671-BF3F-A76747EC691C@geo.hmg.inpg.fr>


>
>> Without going into sterile discussions, I would like to know if
>> something like that exists in Yade.
>> Otherwise, I will need to add the class 'NormalViscousInteraction'
>> (and/or 'NormalViscousShearInteraction')
>> that store the damping parameter. I will need also to add a relative
>> normal velocity parameter in the
>> very complet class SpheresContactGeometry. Note that it will be the
>> possible to put aside the local
>> vicosity by setting the damping parameter to zero.
> Hi, you could add bool hasViscosity so that even computation of  
> relative
> speeds is skipped if that is not used. But maybe youwill  find a  
> better
> way...
>
> Vaclav

Thank you Vaclav.
Finally, I have found some classes (*SimpleViscoelasticInteraction*  
written by Sega) that actually manage the contact damping.
I apologize for this Yade-beginner's mistake.
Vincent



_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Tue Nov 18 20:32:24 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Tue, 18 Nov 2008 20:32:24 +0100
Subject: [deprecated list] [Yade-dev] (x,y,z) convention
In-Reply-To: <49219052.1070101@arcig.cz>
References: <49218990.2060402@hmg.inpg.fr>
	<49219052.1070101@arcig.cz>
Message-ID: <20081118203224.2f64a3e7@szpak>

V?clav S(milauer said:     (by the date of Mon, 17 Nov 2008 16:40:02 +0100)

> 
> > Could we get the previous default QGL orientation back please (I guess
> > this is a question for Va?lav)?
> > Everyone needs to rotate his view when he starts a simulation, it
> > seems. Yes, we have nice new buttons to make it fast, but still...
> > what is the point of changing axis convention after few years of
> > development?
> > Don't worry, this is the usual whining "Oh my god!! I've not work on
> > Yade for 2 months and I can't get it to work normally now!"
> > It will stop soon...
> It was Janek who changed that (we had a tough discussion on that in
> Aussois) claiming that as there is no overall convention for
> orientation, we will orient the scene agains the sense of gravity (if
> there is a GravityEngine) -- I thought this to be non-obvious and was
> opposing that. Glad that you speak up, Bruno, I am for democratically
> reverting that :-)

Hey, you are too quick for blaming that on me. You changed the
default GL view, which (arbitrarily ;) assumes currently that gravity is in Z
direction. And before it was in Y direction. I sort-of mitigated the
"complaint problem" due to your change by adding those XYZ buttons.
And by assuming that default view is directed depending on gravity
direction.

Bruno is complaining on what you have done. And he is complaining
because actually in triaxial tests there is no gravity. Would there
be gravity then nobody wouldn't notice that there's anything to complain.

You can comment out this "view downwards grvity" code, but Bruno is
asking you to change the default view, so that by default gravity is
along Y.

Another solution is to save somewhere the view position and load on
next time. Maybe. This way people will need to do this camera
rotating with mouse just once.

Using Y as downwards direction has only one reasoning: it works for
both 2D and 3D simulations. If you have 2D - then Y is downwards. Then
if you go into 3D then Y is still downwards.

Personally I have no preferences here, because I like those XYZ buttons
that I've added.

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Tue Nov 18 21:43:47 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Tue, 18 Nov 2008 21:43:47 +0100
Subject: [deprecated list] [Yade-dev] (x,y,z) convention
In-Reply-To: <20081118203224.2f64a3e7@szpak>
References: <49218990.2060402@hmg.inpg.fr>	<49219052.1070101@arcig.cz>
	<20081118203224.2f64a3e7@szpak>
Message-ID: <49232903.5050004@arcig.cz>


> Hey, you are too quick for blaming that on me. You changed the
> default GL view, which (arbitrarily ;) assumes currently that gravity is in Z
> direction. And before it was in Y direction. I sort-of mitigated the
> "complaint problem" due to your change by adding those XYZ buttons.
> And by assuming that default view is directed depending on gravity
> direction.
>   
Oh, you're right, I suppressed remembrance of me changing that and only
remembered that we had that discussion. Sorry for that, you're right.

My reasoning behind that was that it is computer graphics folks that use
y for upwards (which I thought was a relict of Olivier making that
code), whereas physicists use xy for the plane and z for height. I
assumed that the latter would be what yade users will (including me)
would expect, so I changed that. But I am in no strong opposition
against reverting that.

BTW, for saving the view config, you can use alt-7, alt-8, alt-9 to save
view state into #0, #1, #2 "slots", which are stored in the simulation
.xml, and load those by pressing 7, 8, 9 respectively.

Vaclav


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From richefeu at geo.hmg.inpg.fr  Wed Nov 19 14:59:39 2008
From: richefeu at geo.hmg.inpg.fr (Vincent Richefeu)
Date: Wed, 19 Nov 2008 14:59:39 +0100
Subject: [deprecated list] [Yade-dev] (x,y,z) convention
In-Reply-To: <49232903.5050004@arcig.cz>
References: <49218990.2060402@hmg.inpg.fr>	<49219052.1070101@arcig.cz>
	<20081118203224.2f64a3e7@szpak> <49232903.5050004@arcig.cz>
Message-ID: <9479DCC7-690D-4968-BD75-F763B5FAA5F2@geo.hmg.inpg.fr>

Hi everybody,

I have just a brief comment concerning this discussion.
I have write a visualizer for DEM simulations (mgpost, see google).
This tool could be incorporated 'into' Yade in the future.
It may be interesting to known that I used the 'vertical Y' convention.

Vincent



Le 18 nov. 08 ? 21:43, V?clav ?milauer a ?crit :

>
>> Hey, you are too quick for blaming that on me. You changed the
>> default GL view, which (arbitrarily ;) assumes currently that  
>> gravity is in Z
>> direction. And before it was in Y direction. I sort-of mitigated the
>> "complaint problem" due to your change by adding those XYZ buttons.
>> And by assuming that default view is directed depending on gravity
>> direction.
>>
> Oh, you're right, I suppressed remembrance of me changing that and  
> only
> remembered that we had that discussion. Sorry for that, you're right.
>
> My reasoning behind that was that it is computer graphics folks  
> that use
> y for upwards (which I thought was a relict of Olivier making that
> code), whereas physicists use xy for the plane and z for height. I
> assumed that the latter would be what yade users will (including me)
> would expect, so I changed that. But I am in no strong opposition
> against reverting that.
>
> BTW, for saving the view config, you can use alt-7, alt-8, alt-9 to  
> save
> view state into #0, #1, #2 "slots", which are stored in the simulation
> .xml, and load those by pressing 7, 8, 9 respectively.
>
> Vaclav
>
>
> _______________________________________________
> Mailing list: https://launchpad.net/~yade-dev
> Post to     : yade-dev at lists.launchpad.net
> Unsubscribe : https://launchpad.net/~yade-dev
> More help   : https://help.launchpad.net/ListHelp


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From chareyre at mail.berlios.de  Thu Nov 20 15:48:17 2008
From: chareyre at mail.berlios.de (chareyre at BerliOS)
Date: Thu, 20 Nov 2008 15:48:17 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1576 - trunk/extra/triangulation
Message-ID: <200811201448.mAKEmH8T022245@sheep.berlios.de>

Author: chareyre
Date: 2008-11-20 15:48:17 +0100 (Thu, 20 Nov 2008)
New Revision: 1576

Added:
   trunk/extra/triangulation/KinematicLocalisationAnalyser.cpp
   trunk/extra/triangulation/KinematicLocalisationAnalyser.hpp
Log:
A class with algorithm for analysing contacts-forces-displacements 
statistics. Using the triangulation lib.




Added: trunk/extra/triangulation/KinematicLocalisationAnalyser.cpp
===================================================================
--- trunk/extra/triangulation/KinematicLocalisationAnalyser.cpp	2008-11-17 17:11:31 UTC (rev 1575)
+++ trunk/extra/triangulation/KinematicLocalisationAnalyser.cpp	2008-11-20 14:48:17 UTC (rev 1576)
@@ -0,0 +1,1039 @@
+/*************************************************************************
+*  Copyright (C) 2006 by Bruno Chareyre                                *
+*  bruno.chareyre at hmg.inpg.fr                                            *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+//This class computes statistics of micro-variables assuming axi-symetry
+
+
+
+#include "Tesselation.h"
+#include "KinematicLocalisationAnalyser.hpp"
+#include "TriaxialState.h"
+#include <iostream>
+#include <fstream>
+#include <sstream>
+//#include <utility>
+
+int n_debug = 0;
+//cerr << "n_debug=" << n_debug++ << endl;   /// DEBUG LINE  ///
+ 
+ 
+//Usefull fonction to convert int to string (define it elsewhere) 
+std::string _itoa(int i) {
+ std::ostringstream buffer;
+ buffer << i;
+ return buffer.str();
+} 
+
+KinematicLocalisationAnalyser::KinematicLocalisationAnalyser()
+{
+	sphere_discretisation = SPHERE_DISCRETISATION;
+	linear_discretisation = LINEAR_DISCRETISATION;
+	consecutive = true;
+	TS1=new TriaxialState;
+	TS0=new TriaxialState;
+}
+
+
+KinematicLocalisationAnalyser::~KinematicLocalisationAnalyser()
+{
+	delete (TS1);
+	delete (TS0);
+}
+
+KinematicLocalisationAnalyser::KinematicLocalisationAnalyser(const char*
+state_file1)
+{
+	sphere_discretisation = SPHERE_DISCRETISATION;
+	linear_discretisation = LINEAR_DISCRETISATION;
+	consecutive = true;
+	TS1 = new(TriaxialState);
+	TS0 = NULL;
+	TS1->from_file(state_file1);
+}
+
+KinematicLocalisationAnalyser::KinematicLocalisationAnalyser(const char*
+state_file1, const char* state_file0, bool consecutive_files)
+{
+	consecutive = consecutive_files;
+	sphere_discretisation = SPHERE_DISCRETISATION;
+	linear_discretisation = LINEAR_DISCRETISATION;
+	TS1 = new(TriaxialState);
+	TS0 = new(TriaxialState);
+	TS1->from_file(state_file1);
+	TS0->from_file(state_file0);
+
+	Delta_epsilon(3,3) = TS1->eps3 - TS0->eps3;
+	Delta_epsilon(1,1) = TS1->eps1 - TS0->eps1;
+	Delta_epsilon(2,2) = TS1->eps2 - TS0->eps2;
+}
+
+
+
+void KinematicLocalisationAnalyser::SetBaseFileName (string name)
+{
+	base_file_name = name;
+}
+
+
+bool KinematicLocalisationAnalyser::SetFileNumbers ( int n0, int n1 )
+{
+	//TriaxialState* TS3;
+	//string file_name;
+	bool bf0 = false;
+	bool bf1 = false;
+// char buffer [50];
+	if ( file_number_0 != n0 )
+	{
+		if ( file_number_1 != n0 )
+		{
+			//file_name = base_file_name + n0;
+			bf0 = TS0->from_file ( ( base_file_name +_itoa ( file_number_0 ) ).c_str() );
+		}
+		else
+		{
+			delete ( TS0 );
+			TS0 = TS1;
+			bf0=true;
+			TS1 = new ( TriaxialState );
+			//file_name = base_file_name + string(n1);
+			bf1 = TS1->from_file ( ( base_file_name + _itoa ( file_number_1 ) ).c_str() );
+		}
+	}
+	else if ( n1 != file_number_1 )
+	{
+		//file_name = base_file_name + string(n1);
+		bf0 = true;
+		bf1 = TS1->from_file ( ( base_file_name + _itoa ( file_number_1 ) ).c_str() );
+	}
+
+	file_number_1 = n1;
+	file_number_0 = n0;
+	consecutive = ( ( n1-n0 ) ==1 );
+	Delta_epsilon ( 3,3 ) = TS1->eps3 - TS0->eps3;
+	Delta_epsilon ( 1,1 ) = TS1->eps1 - TS0->eps1;
+	Delta_epsilon ( 2,2 ) = TS1->eps2 - TS0->eps2;
+	return ( bf0 && bf1 );
+}
+
+
+void KinematicLocalisationAnalyser::SetConsecutive ( bool t )
+{
+	consecutive = t;
+}
+
+void KinematicLocalisationAnalyser::SetNO_ZERO_ID (bool t)
+{
+	TS0->NO_ZERO_ID = t;
+	TS1->NO_ZERO_ID = t;
+}
+
+
+void KinematicLocalisationAnalyser::SwitchStates (void ) 
+{
+	TriaxialState* TStemp = TS0;
+	TS0 = TS1;
+	TS1 = TStemp;
+}
+
+vector<Edge_iterator>& KinematicLocalisationAnalyser::Oriented_Filtered_edges (Real Nymin, Real Nymax, vector<Edge_iterator>& filteredList)
+{
+	RTriangulation& T = TS1->tesselation().Triangulation();
+	filteredList.clear();
+	Edge_iterator ed_end = T.edges_end();
+	for (Edge_iterator ed_it = T.edges_begin(); ed_it != ed_end; ++ed_it)
+	{
+		if (!T.is_infinite(*ed_it)
+				   && TS1->inside ( T.segment ( *ed_it ).source() )
+				   && TS1->inside ( T.segment ( *ed_it ).target() ) )
+		{
+			Segment s = T.segment(*ed_it);
+			Vecteur v = s.to_vector();
+			Real ny = abs( v.y()/sqrt(s.squared_length()));		
+	
+			if (Nymin < ny && ny <= Nymax) filteredList.push_back(ed_it);
+		}
+	}
+	return filteredList;
+}
+
+
+bool KinematicLocalisationAnalyser::ToFile (const char* output_file_name)
+{
+	ofstream output_file (output_file_name);
+	if (!output_file.is_open())	{
+		cerr << "Error opening files";
+		return false;	}
+		
+	output_file << "sym_grad_u_total_g (wrong averaged strain):"<< endl << Tenseur_sym3 ( grad_u_total_g ) << endl;
+	output_file << "Total volume = " << v_total << ", grad_u = " << endl << grad_u_total << endl << "sym_grad_u (true average strain): " << endl << Tenseur_sym3 ( grad_u_total ) << endl;
+	output_file << "Macro strain = " << Delta_epsilon << endl;
+
+	ContactDistributionToFile(output_file);
+	AllNeighborDistributionToFile(output_file);
+	
+	TS1->filter_distance = 2.0;
+	ContactDistributionToFile(output_file);
+	AllNeighborDistributionToFile(output_file);
+
+	TS1->filter_distance = 4.0;
+	ContactDistributionToFile(output_file);
+	AllNeighborDistributionToFile(output_file);
+
+	output_file << "Contact_fabric : ";
+	output_file << (Tenseur_sym3) Contact_fabric(*TS1);// << endl;
+	output_file << "Contact_anisotropy : " << Contact_anisotropy(*TS1) << endl << endl;
+	output_file << "Neighbor_fabric : " << Neighbor_fabric(*TS1) << endl;	
+	output_file << "Neighbor_anisotropy : " << Neighbor_anisotropy(*TS1) << endl << endl;
+		
+	RTriangulation& T = TS1->tesselation().Triangulation();
+	Edge_iterator ed_end = T.edges_end();
+	vector<Edge_iterator> edges;
+	for (Edge_iterator ed_it = T.edges_begin(); ed_it != ed_end; ++ed_it)
+	{
+		if (!T.is_infinite(*ed_it))
+		{
+			Segment s = T.segment(*ed_it);
+			Vecteur v = s.to_vector();
+			Real xx = abs( v.z()/sqrt(s.squared_length()));		
+	
+			if (xx>0.95) edges.push_back(ed_it);
+		}
+	}
+	NormalDisplacementDistributionToFile(edges, output_file);
+
+	edges.clear();
+	for (Edge_iterator ed_it = T.edges_begin(); ed_it != ed_end; ++ed_it)
+	{
+		if (!T.is_infinite(*ed_it))
+		{
+			Segment s = T.segment(*ed_it);
+			Vecteur v = s.to_vector();
+			Real xx = abs( v.z()/sqrt(s.squared_length()));		
+	
+			if (xx<0.05) edges.push_back(ed_it);
+		}
+	}
+	NormalDisplacementDistributionToFile(edges, output_file);
+
+	edges.clear();
+	for (Edge_iterator ed_it = T.edges_begin(); ed_it != ed_end; ++ed_it)
+	{
+		if (!T.is_infinite(*ed_it))
+		{
+			Segment s = T.segment(*ed_it);
+			Vecteur v = s.to_vector();
+			Real xx = abs( v.z()/sqrt(s.squared_length()));		
+	
+			if (xx>0.65 && xx<0.75) edges.push_back(ed_it);
+		}
+	}
+	NormalDisplacementDistributionToFile(edges, output_file);
+
+
+	output_file.close();
+	return true;
+}
+
+long KinematicLocalisationAnalyser::Filtered_contacts (TriaxialState& state)
+{
+	long nc1 =0;
+	TriaxialState::ContactIterator cend = state.contacts_end();
+	for (TriaxialState::ContactIterator cit = state.contacts_begin(); cit!=cend; ++cit)
+	{
+		if (state.inside((*cit)->grain1->sphere.point()) && state.inside((*cit)->grain2->sphere.point()))
+			nc1 += 2;
+		else if (state.inside((*cit)->grain1->sphere.point()) || state.inside((*cit)->grain2->sphere.point()))	
+			++nc1;			
+	}
+	return nc1;
+}
+
+long KinematicLocalisationAnalyser::Filtered_neighbors ( TriaxialState& state )
+{
+	long nv1=0;
+	RTriangulation& T = state.tesselation().Triangulation();
+	Edge_iterator ed_end = T.edges_end();
+	for ( Edge_iterator ed_it = T.edges_begin(); ed_it != ed_end; ++ed_it )
+	{
+		if ( !T.is_infinite ( *ed_it ) )
+		{
+			Segment s ( T.segment ( *ed_it ) );
+			if ( state.inside ( s.source() ) &&
+					state.inside ( s.target() ) ) nv1 += 2;
+			else if ( state.inside ( s.source() ) ||
+					  state.inside ( s.target() ) )  ++nv1;
+		}
+	}
+	return nv1;
+}
+
+long KinematicLocalisationAnalyser::Filtered_grains (TriaxialState& state)
+{
+	long ng1 =0;
+	TriaxialState::GrainIterator gend = state.grains_end();
+	for (TriaxialState::GrainIterator git = state.grains_begin(); git!=gend;
+++git) {
+		if (state.inside(git->sphere.point())) ++ng1;}
+	return ng1;
+}
+
+Real KinematicLocalisationAnalyser::Filtered_volume (TriaxialState& state)
+{
+	return 0;
+}
+
+Real KinematicLocalisationAnalyser::Contact_coordination (TriaxialState& state)
+{
+	return Filtered_contacts(state) / Filtered_grains(state);
+}
+
+Real KinematicLocalisationAnalyser::Neighbor_coordination (TriaxialState& state)
+{
+	return Filtered_neighbors(state) / Filtered_grains(state);
+}
+
+
+Tenseur_sym3 KinematicLocalisationAnalyser::Neighbor_fabric ( TriaxialState&
+		state )
+{
+	RTriangulation& T = state.tesselation().Triangulation();
+	Edge_iterator ed_end = T.edges_end();
+	Tenseur_sym3 Tens;
+	Vecteur v;
+	Segment s;
+	for ( Edge_iterator ed_it = T.edges_begin(); ed_it != ed_end; ++ed_it )
+	{
+		if ( !T.is_infinite ( *ed_it ) )
+		{
+			s = T.segment ( *ed_it );
+			if ( state.inside ( s.source() ) &&
+					state.inside ( s.target() ) )
+			{
+				v =
+					T.segment ( *ed_it ).to_vector() * ( 1/sqrt ( T.segment ( *ed_it ).squared_length() ) );
+				for ( int i=1; i<4; i++ ) for ( int j=3; j>=i; j-- )
+						Tens ( i,j ) += 2*v[i-1]*v[j-1];
+			}
+			else if ( state.inside ( s.source() ) ||
+					  state.inside ( s.target() ) )
+			{
+				v =
+					T.segment ( *ed_it ).to_vector() * ( 1/sqrt ( T.segment ( *ed_it ).squared_length() ) );
+				for ( int i=1; i<4; i++ ) for ( int j=3; j>=i; j-- )
+						Tens ( i,j ) += v[i-1]*v[j-1];
+			}
+		}
+	}
+	Tens /= Filtered_neighbors ( state );
+	return Tens;
+}
+
+Tenseur_sym3 KinematicLocalisationAnalyser::Contact_fabric ( TriaxialState&
+		state )
+{
+	Tenseur_sym3 Tens;
+	Vecteur v;
+	TriaxialState::ContactIterator cend = state.contacts_end();
+
+	for ( TriaxialState::ContactIterator cit = state.contacts_begin();
+			cit!=cend; ++cit )
+	{
+		if ( state.inside ( ( *cit )->grain1->sphere.point() ) &&
+				state.inside ( ( *cit )->grain2->sphere.point() ) )
+		{
+			v = ( *cit )->normal;
+			for ( int i=1; i<4; i++ ) for ( int j=3; j>=i; j-- )
+					Tens ( i,j ) += 2*v[i-1]*v[j-1];
+		}
+		else if ( state.inside ( ( *cit )->grain1->sphere.point() ) ||
+				  state.inside ( ( *cit )->grain2->sphere.point() ) )
+		{
+			v = ( *cit )->normal;
+			for ( int i=1; i<4; i++ ) for ( int j=3; j>=i; j-- )
+					Tens ( i,j ) += v[i-1]*v[j-1];
+		}
+	}
+	Tens /= Filtered_contacts ( state );
+	return Tens;
+}
+
+
+
+
+
+Real KinematicLocalisationAnalyser::Contact_anisotropy (TriaxialState& state)
+{
+	Tenseur_sym3 tens (Contact_fabric(state));
+	return tens.Deviatoric().Norme()/tens.Trace();
+}
+
+
+Real KinematicLocalisationAnalyser::Neighbor_anisotropy (TriaxialState& state)
+{
+	Tenseur_sym3 tens (Neighbor_fabric(state));
+	return tens.Deviatoric().Norme()/tens.Trace();
+}
+
+vector<pair<Real,Real> >& KinematicLocalisationAnalyser::
+NormalDisplacementDistribution ( vector<Edge_iterator>& edges, vector<pair<Real,Real> > &row )
+{
+	cerr << "n_debug=" << n_debug++ << endl;   /// DEBUG LINE  ///
+	row.clear();
+	row.resize ( linear_discretisation+1 );
+	vector<Real> Un_values;
+	Un_values.resize ( edges.size() );
+	Real UNmin ( 100000 ), UNmax ( -100000 );
+	Vecteur branch, U;
+	Real Un;
+	Vertex_handle Vh1, Vh2;
+	vector<Edge_iterator>::iterator ed_end = edges.end();
+	long val_count = 0;
+
+	cerr << "n_debug=" << n_debug++ << endl;   /// DEBUG LINE  ///
+	for ( vector<Edge_iterator>::iterator ed_it = edges.begin();
+			ed_it!=ed_end; ++ed_it )
+	{
+		Vh1= ( *ed_it )->first->vertex ( ( *ed_it )->second );
+		Vh2= ( *ed_it )->first->vertex ( ( *ed_it )->third );
+		branch = Vh1->point()- Vh2->point();
+		NORMALIZE ( branch );
+		if ( consecutive )
+			U = TS1->grain ( Vh1->info().id() ).translation -
+				TS1->grain ( Vh2->info().id() ).translation;
+		else
+		{
+			U = ( TS1->grain ( Vh1->info().id() ).sphere.point() -
+				  TS0->grain ( Vh1->info().id() ).sphere.point() )
+				- ( TS1->grain ( Vh2->info().id() ).sphere.point() -
+					TS0->grain ( Vh2->info().id() ).sphere.point() );
+		}
+		//Un = (U - (Delta_epsilon*branch))*branch; //Diff?rence par rapport ? Un moyen
+		Un = U*branch;
+		
+		UNmin = min ( UNmin,Un );
+		UNmax = max ( UNmax,Un );
+		Un_values[val_count++] = Un;
+		//cerr << "Un=" << Un << " U=" << U << " branch=" << branch << 	endl;
+	}
+	cerr << "n_debug=" << n_debug++ << endl;   /// DEBUG LINE  ///
+
+	Real DUN = ( UNmax-UNmin ) /linear_discretisation;
+	for ( int i = 0; i <= linear_discretisation; ++i )
+	{
+		row[i].first = UNmin+ ( i+0.5 ) *DUN;
+		row[i].second = 0;
+	}
+	cerr << "n_debug=" << n_debug++ << endl;   /// DEBUG LINE  ///
+
+	val_count = val_count-1;
+	cerr << "nval=" << val_count << " reserved=" << edges.size() << endl;
+	for ( ; val_count>=0; --val_count )
+	{
+		//cerr << "n_debug0=" << n_debug << endl;   /// DEBUG LINE  ///
+		row[ ( int ) ( ( Un_values[val_count]-UNmin ) /DUN ) ].second += 1;
+	}
+	cerr << "DUN=" << DUN << " UNmin=" << UNmin << " UNmax=" << UNmax << endl;
+	return row;
+	//cerr << "n_debug=" << n_debug++ << endl;   /// DEBUG LINE  ///
+}
+
+
+ofstream& KinematicLocalisationAnalyser::
+NormalDisplacementDistributionToFile ( vector<Edge_iterator>& edges, ofstream& output_file )
+{
+	vector< pair<Real, Real> > row;
+	NormalDisplacementDistribution ( edges, row );
+	vector< pair<Real, Real> >::iterator r_end = row.end();
+
+	//output part :
+	output_file << "#Normal displacement distribution" << endl << "eps3=" << Delta_epsilon ( 3,3 )
+	<< " eps2=" << Delta_epsilon ( 2,2 ) << " eps1=" << Delta_epsilon ( 1,1 ) << " number of neigbors: "<< edges.size()
+	<< endl << "Un_min=" << 1.5*row[0].first - 0.5*row[1].first << " Un_max="
+	<< row[row.size()-1].first << endl;
+	cout << "#Normal displacement distribution" << endl << "eps3=" << Delta_epsilon ( 3,3 )
+	<< " eps2=" << Delta_epsilon ( 2,2 ) << " eps1=" << Delta_epsilon ( 1,1 ) << " number of neigbors: "<< edges.size()
+	<< endl << "Un_min=" << 1.5*row[0].first - 0.5*row[1].first << " Un_max="
+	<< row[row.size()-1].first << endl;
+	for ( vector< pair<Real, Real> >::iterator r_it = row.begin(); r_it != r_end; ++r_it )
+	{
+		output_file << r_it->first << " " << r_it->second << endl;
+		cout << r_it->first << " " << r_it->second << endl;
+	}
+	output_file << endl;
+	return output_file;
+
+}
+
+
+//vector<pair<Real,Real> >  KinematicLocalisationAnalyser::
+//NormalDisplacementDistribution(TriaxialState& state, TriaxialState& state0)
+//{
+// vector<pair<Real,Real> > table;
+// table.resize(linear_discretisation);
+//
+//
+// return table;
+//}
+
+
+
+ofstream& KinematicLocalisationAnalyser::
+ContactDistributionToFile ( ofstream& output_file )
+{
+	//cerr << "ContactDistributionToFile" << endl;
+	vector< pair<Real, Real> > row;
+	row.resize ( sphere_discretisation+1 );
+	Real DZ = 1.0/sphere_discretisation;//interval in term of cos(teta)
+	long nc1=0;
+	long nc2=0;
+	long ng1=0;
+	long ng2=0;
+	//cerr << "ContactDistributionToFile05" << endl;
+	TriaxialState::ContactIterator cend = ( *TS1 ).contacts_end();
+	TriaxialState::GrainIterator gend = ( *TS1 ).grains_end();
+
+	for ( int i = 0; i <= sphere_discretisation; ++i )
+	{
+		row[i].first = ( i+0.5 ) *DZ;
+		row[i].second = 0;
+	}
+
+	for ( TriaxialState::GrainIterator git = ( *TS1 ).grains_begin(); git!=gend; ++git )
+	{
+		if ( ( *TS1 ).inside ( git->sphere.point() ) ) ++ng1;
+		else ++ng2;
+	}
+
+	for ( TriaxialState::ContactIterator cit = ( *TS1 ).contacts_begin(); cit!=cend; ++cit )
+	{
+		if ( ( *TS1 ).inside ( ( *cit )->grain1->sphere.point() ) && ( *TS1 ).inside ( ( *cit )->grain2->sphere.point() ) )
+		{
+			row[ ( int ) ( abs ( ( *cit )->normal.z() ) /DZ ) ].second += 2;
+			nc1 += 2;
+		}
+		else
+		{
+			if ( ( *TS1 ).inside ( ( *cit )->grain1->sphere.point() ) || ( *TS1 ).inside ( ( *cit )->grain2->sphere.point() ) )
+			{
+				row[ ( int ) ( abs ( ( *cit )->normal.z() ) /DZ ) ].second += 1;
+				++nc1;
+			}
+			//cerr << "(*cit)->normal.z(),DZ : " << (*cit)->normal.z() << " " << DZ << endl;}
+			else ++nc2;
+		}
+	}
+	//normalisation :
+	Real normalize = 1.0/ ( ng1*4*DZ*3.141592653 );
+	for ( int i = 0; i <= sphere_discretisation; ++i ) row[i].second *= normalize;
+
+	//output part :
+	output_file << "#Contacts distribution" << endl << "(filter dist. = " << ( *TS1 ).filter_distance
+	<< ", "<< nc1 << " contacts, " << nc2 << " excluded contacts, for "<< ng1
+	<<"/"<< ( ng1+ng2 ) << " grains)" << endl;
+	output_file << "max_nz number_of_contacts" << endl;
+	cerr << "#Contacts distribution (filter dist. = " << ( *TS1 ).filter_distance
+	<< ", "<< nc1 << " contacts, " << nc2 << " excluded contacts, for "<< ng1
+	<<"/"<< ( ng1+ng2 ) << " grains)" << endl;
+	cerr << "mean_nz number_of_contacts" << endl;
+	for ( int i = 0; i <= sphere_discretisation; ++i )
+	{
+		output_file << row[i].first << " " << row[i].second << endl;
+		cerr << row[i].first << " " << row[i].second << endl;
+	}
+
+	output_file << endl;
+	return output_file;
+}
+
+
+
+ofstream& KinematicLocalisationAnalyser::
+AllNeighborDistributionToFile ( ofstream& output_file )
+{
+	vector< pair<Real, Real> > row;
+	row.resize ( sphere_discretisation );
+	Real DZ = 1.0/sphere_discretisation;
+	long nv1=0;
+	long nv2=0;
+	long nv3=0;
+	long ng1=0;
+	long ng2=0;
+
+	for ( int i = 0; i < sphere_discretisation; ++i )
+	{
+		row[i].first = ( i+0.5 ) *DZ;
+		row[i].second = 0;
+	}
+
+	TriaxialState::GrainIterator gend = ( *TS1 ).grains_end();
+	for ( TriaxialState::GrainIterator git = ( *TS1 ).grains_begin(); git!=gend; ++git )
+	{
+		if ( ( *TS1 ).inside ( git->sphere.point() ) ) ++ng1;
+		else ++ng2;
+	}
+
+	RTriangulation& T = ( *TS1 ).tesselation().Triangulation();
+	Segment s;
+	Vecteur v;
+	for ( Edge_iterator ed_it = T.edges_begin(); ed_it != T.edges_end(); ed_it++ )
+	{
+		if ( !T.is_infinite ( *ed_it ) )
+		{
+			s = T.segment ( *ed_it );
+			if ( ( *TS1 ).inside ( s.source() ) && ( *TS1 ).inside ( s.target() ) )
+			{
+				v = s.to_vector();
+				row[ ( int ) ( abs ( v.z() /sqrt ( s.squared_length() ) ) /DZ ) ].second += 2;
+				nv1 += 2;
+			}
+			else
+			{
+				if ( ( *TS1 ).inside ( s.source() ) || ( *TS1 ).inside ( s.target() ) )
+				{
+					v = s.to_vector();
+					row[ ( int ) ( abs ( v.z() /sqrt ( s.squared_length() ) ) /DZ ) ].second += 1;
+					++nv1;
+				}
+				else ++nv2;
+			}
+		}
+		else ++nv3;
+	}
+
+	Real normalize = 1.0/ ( ng1*4*DZ*3.141592653 );
+	for ( int i = 0; i < sphere_discretisation; ++i ) row[i].second *= normalize;
+
+	output_file << "#Neighbors distribution" << endl << "(filter dist. = " << ( *TS1 ).filter_distance
+	<< ", "<< nv1 << " neighbors + " << nv2 << " excluded + "
+	<< nv3 << " infinite, for "<< ng1 <<"/"<< ( ng1+ng2 ) << " grains)" << endl;
+	output_file << "max_nz number_of_neighbors" << endl;
+	cerr << "#Neighbors distribution" << endl << "(filter dist. = " << ( *TS1 ).filter_distance
+	<< ", "<< nv1 << " neighbors + " << nv2 << " excluded + "
+	<< nv3 << " infinite, for "<< ng1 <<"/"<< ( ng1+ng2 ) << " grains)" << endl;
+	cerr << "mean_nz number_of_neighbors" << endl;
+	for ( int i = 0; i < sphere_discretisation; ++i )
+	{
+		output_file << row[i].first << " " << row[i].second << endl;
+		cerr << row[i].first << " " << row[i].second << endl;
+	}
+
+	output_file << endl;
+	return output_file;
+}
+
+void KinematicLocalisationAnalyser::
+SetForceIncrements ( void ) //WARNING : This function will modify the contact lists : add virtual (lost)) contacts in state 1 and modify old_force and force in state 0, execute this function after all other force analysis functions if you want to avoid problems
+{
+	if ( true ) cerr << "SetForceIncrements"<< endl;
+//  vector< pair<Real, Real> > row;
+//  row.resize ( sphere_discretisation );
+//  Real DZ = 1.0/sphere_discretisation;
+	long Nc0 = TS0->contacts.size();
+	long Nc1 = TS1->contacts.size();
+
+//  long nv1=0;
+//  long nv2=0;
+//  long nv3=0;
+//  long ng1=0;
+//  long ng2=0;
+	n_persistent = 0; n_new = 0; n_lost = 0;
+	long lost_in_state0 = 0;
+
+	for ( int i = 0; i < Nc0; ++i ) {
+		TS0->contacts[i]->visited = false;
+		if (TS0->contacts[i]->status == TriaxialState::Contact::LOST) ++lost_in_state0;}
+	for ( int i = 0; i < Nc1; ++i ) TS1->contacts[i]->visited = false;
+	cerr << "Nc1 "<<Nc1<<", Nc0 "<<Nc0<<" ("<<Nc0-lost_in_state0<<" real)"<<endl;
+	for ( int i = 0; i < Nc0; ++i )
+	{
+	//	cerr << 1;
+		if ( TS0->contacts[i]->status != TriaxialState::Contact::LOST )
+		{
+	//		cerr << 2;
+			for ( int j = 0; j < Nc1; ++j )
+			{
+				
+				if ( TS0->contacts[i]->grain1->id == TS1->contacts[j]->grain1->id && TS0->contacts[i]->grain2->id == TS1->contacts[j]->grain2->id) // This is a PERSISTENT contact (i.e. it is present in state 0 and 1)
+				{
+					//TS0->contacts[i]->visited = true;
+					TS1->contacts[j]->visited = true;
+					//TS0->contacts[i]->status = TriaxialState::Contact::PERSISTENT;
+					TS1->contacts[j]->status = TriaxialState::Contact::PERSISTENT;
+					TS1->contacts[j]->old_fn = TS0->contacts[i]->fn;
+					TS1->contacts[j]->old_fs = TS0->contacts[i]->fs;
+					++n_persistent;
+					break;
+				}
+				else if ( j+1==Nc1 ) //This contact was not found in state 1, add it as a LOST contact
+				{
+	//				cerr << 3 << endl;
+					TriaxialState::Contact* c = new TriaxialState::Contact;
+					c->visited = true;
+					c->status = TriaxialState::Contact::LOST;
+					c->grain1 = TS0->contacts[i]->grain1;
+					c->grain2 = TS0->contacts[i]->grain2;
+					c->position = TS0->contacts[i]->position;
+					c->normal = TS0->contacts[i]->normal;
+					c->old_fn = TS0->contacts[i]->fn;
+					c->fn = 0;
+					c->old_fs = TS0->contacts[i]->fs;
+					c->frictional_work = TS0->contacts[i]->frictional_work;
+					c->fs = CGAL::NULL_VECTOR;
+					TS1->contacts.push_back ( c );
+					++Nc1;
+					++n_lost;
+					break;
+				}
+			}
+		}
+	}
+	//cerr << 4;
+	for ( int j = 0; j < Nc1; ++j ) //This contact was not visited, it is a NEW one
+	{
+		//cerr << 5;
+		if ( !TS1->contacts[j]->visited /*&& TS1->contacts[j]->status != TriaxialState::Contact::LOST*/)
+		{
+			cerr << 6;
+			TS1->contacts[j]->status = TriaxialState::Contact::NEW;
+			TS1->contacts[j]->old_fn = 0;
+			TS1->contacts[j]->old_fs = CGAL::NULL_VECTOR;
+			++n_new;
+		}
+	}
+	//cerr << 7;
+	if ( true ) cerr << "Contact Status : "<< n_persistent << " persistent, "<< n_new << " new, "<< n_lost << " lost"<< endl;
+	/*
+	RGrid1D table;
+
+	for ( Edge_iterator ed_it = T.edges_begin(); ed_it != T.edges_end(); ed_it++ )
+	{
+	 if ( !T.is_infinite ( *ed_it ) )
+	 {
+	  s = T.segment ( *ed_it );
+	  if ( ( *TS1 ).inside ( s.source() ) && ( *TS1 ).inside ( s.target() ) )
+	  {
+	   v = s.to_vector();
+	   row[ ( int ) ( abs ( v.z() /sqrt ( s.squared_length() ) ) /DZ ) ].second += 2;
+	   nv1 += 2;
+	  }
+	  else
+	  {
+	   if ( ( *TS1 ).inside ( s.source() ) || ( *TS1 ).inside ( s.target() ) )
+	   {
+	    v = s.to_vector();
+	    row[ ( int ) ( abs ( v.z() /sqrt ( s.squared_length() ) ) /DZ ) ].second += 1;
+	    ++nv1;
+	   }
+	   else ++nv2;
+	  }
+	 }
+	 else ++nv3;
+	}
+
+	Real normalize = 1.0/ ( ng1*4*DZ*3.141592653 );
+	for ( int i = 0; i < sphere_discretisation; ++i ) row[i].second *= normalize;
+
+	output_file << "#Neighbors distribution" << endl << "(filter dist. = " << ( *TS1 ).filter_distance
+	  << ", "<< nv1 << " neighbors + " << nv2 << " excluded + "
+	  << nv3 << " infinite, for "<< ng1 <<"/"<< ( ng1+ng2 ) << " grains)" << endl;
+	output_file << "max_nz number_of_neighbors" << endl;
+	cerr << "#Neighbors distribution" << endl << "(filter dist. = " << ( *TS1 ).filter_distance
+	  << ", "<< nv1 << " neighbors + " << nv2 << " excluded + "
+	  << nv3 << " infinite, for "<< ng1 <<"/"<< ( ng1+ng2 ) << " grains)" << endl;
+	cerr << "mean_nz number_of_neighbors" << endl;
+	for ( int i = 0; i < sphere_discretisation; ++i )
+	{
+	 output_file << row[i].first << " " << row[i].second << endl;
+	 cerr << row[i].first << " " << row[i].second << endl;
+	}
+
+	output_file << endl;
+	return output_file;*/
+}
+
+
+
+void KinematicLocalisationAnalyser::SetDisplacementIncrements ( void )
+{
+	TriaxialState::GrainIterator gend = TS1->grains_end();
+	for (TriaxialState::GrainIterator git = TS1->grains_begin(); git!=gend; ++git) 
+		if (git->id >= 0) git->translation =  TS1->grain ( git->id ).sphere.point() - TS0->grain ( git->id ).sphere.point();
+	consecutive = true;
+			
+	
+}
+
+
+
+ofstream& KinematicLocalisationAnalyser::
+StrictNeighborDistributionToFile (ofstream& output_file)
+{
+	return output_file;
+}
+
+
+
+
+
+
+
+// Tenseur3 KinematicLocalisationAnalyser::Grad_u (Point &p1, Point &p2, Point &p3)
+// {
+// 	Tenseur3 T;
+// 	Vecteur V = (Deplacement(p1)+Deplacement(p2)+Deplacement(p3))/3.00;
+// 	Grad_u(p1, p2, p3, V, T);
+// 	return T;
+// 	//Vecteur V = (Deplacement(p1)+Deplacement(p2)+Deplacement(p3))/3;
+// }
+
+//Vecteur KinematicLocalisationAnalyser::Deplacement (Point &p) {return (p-CGAL::ORIGIN)/100;}
+
+Vecteur KinematicLocalisationAnalyser::Deplacement ( Finite_cells_iterator cell, int facet ) // D?p. moyen sur une facette
+{
+	Vecteur v ( 0.f, 0.f, 0.f );
+	int id;// ident. de la particule
+	for ( int i=0; i<4; i++ )
+	{
+		//  char msg [256];
+		if ( i!=facet )
+		{
+			id = cell->vertex ( i )->info().id();
+			if ( consecutive )
+				v = v + TS1->grain ( id ).translation;
+			else  v = v + ( TS1->grain ( id ).sphere.point() - TS0->grain ( id ).sphere.point() );
+
+			//for tests with affine displacement field
+			//if ((TS1->grain(id).sphere.point().y()+TS1->grain(id).sphere.point().z())>0.035)//a discontinuity
+			//v = v + Vecteur(0, 0.01*TS1->grain(id).sphere.point().x(), 0);
+		}
+	}
+	v = v*0.333333333333333333333333;
+	return v;
+}
+
+
+
+void KinematicLocalisationAnalyser::Grad_u ( Finite_cells_iterator cell, int facet, Vecteur &V, Tenseur3& T )
+{
+	Vecteur S = cross_product ( ( cell->vertex ( l_vertices[facet][1] )->point() )
+					- ( cell->vertex ( l_vertices[facet][0] )->point() ),
+					( cell->vertex ( l_vertices[facet][2] )->point() ) -
+					( cell->vertex ( l_vertices[facet][1] )->point() ) ) /2.f;
+	Somme ( T, V, S );
+}
+
+
+// void KinematicLocalisationAnalyser::Grad_u (Point &p1, Point &p2, Point &p3, Vecteur &V, Tenseur3& T) // rotation 1->2->3 orient?e vers l'ext?rieur
+// {		
+// 	Vecteur S = 0.5*cross_product(p2-p1, p3-p2);
+//     	Somme (T, V, S);
+// }
+
+void KinematicLocalisationAnalyser::Grad_u (Finite_cells_iterator cell,
+Tenseur3& T, bool vol_divide)// Calcule le gradient de d?p. 
+{
+	/*char msg [256];
+	sprintf(msg, "Exec Grad_u (Finite_cells_iterator cell, Tenseur3& T, bool
+vol_divide)");
+	Udata::out(msg);
+	sprintf(msg, "***  Hv = \n %f %f %f \n %f %f %f \n %f %f %f \n",  
+	T(1,1), T(1,2), T(1,3), T(2,1), T(2,2), T(2,3),
+	T(3,1), T(3,2), T(3,3));
+	Udata::out(msg);*/
+	T.reset();
+	Vecteur v;
+	for (int facet=0; facet<4; facet++)
+	{
+		v = Deplacement(cell, facet);
+		Grad_u (cell, facet, v, T);
+	}
+	if (vol_divide) T/= Tesselation::Volume(cell);
+}
+
+
+
+
+
+
+// Calcul du tenseur d'orientation des voisins
+// Tenseur_sym3 Orientation_voisins (Tesselation &Tes)
+// {
+// 	RTriangulation& T = Tes.Triangulation();
+// 	Tenseur3 Tens;
+// 	Vecteur v;
+// 	long Nv = 0; //nombre de voisins
+// 	for (Edge_iterator ed_it = T.edges_begin(); ed_it != T.edges_end(); ed_it++)
+// 	{	
+// 		if (!T.is_infinite(*ed_it))
+// 		{
+// 			Nv++;
+// 			v = T.segment(*ed_it).to_vector()/sqrt(T.segment(*ed_it).squared_length());
+// 			for (int i=1; i<4; i++) for (int j=3; j>=i; j--)Tens(i,j) += v[i-1]*v[j-1];
+// 		}
+// 	} 
+// 	Tens /= Nv;
+// 	return Tens;
+// }
+
+
+
+
+
+
+//
+//;------------------------------------------------
+//;orient_n_Y
+//;calcul de la distribution des orientations de contact
+//;(angle entre n et l'axe y)
+//;param?tres d'entr?e : N_classes (nombre de classes), e_filtre (?paisseur de la bordure supprim?e)
+//;sortie : table 20
+//
+//def orient_n_Z
+//
+//X_min = w_x(waddg) + e_filtre
+//X_max = l + w_x(waddd) - e_filtre
+//Y_min = w_y(waddfa) + e_filtre
+//Y_max = l + w_y(waddfo) - e_filtre
+//Z_min = w_z(waddb) + e_filtre
+//Z_max = h + w_z(waddh) - e_filtre
+//DZ_classes = 1./(N_classes*1.)
+//
+//command
+//table 20 erase
+//table 21 erase
+//endcommand
+//loop temp (0, N_classes)
+//	xtable (20, temp+1) = temp * DZ_classes
+//endloop
+//
+//cp=contact_head
+//N_filtre1 = 0
+//n_cont = 0
+//loop while cp#null
+//	if c_nforce(cp) # 0
+//	n_cont = n_cont +1
+//	if filtre1 = 1
+//	N_filtre1 = N_filtre1 +1
+//		classe = int(abs(c_zun(cp))/DZ_classes) + 1
+//		ytable (20, classe) = ytable (20, classe) +1
+//	endif
+//	endif
+//cp=c_next(cp)
+//endloop
+//
+//command
+//print N_filtre1 n_cont
+//set logfile orient.txt
+//set log on ov
+//pr table 20
+//set log off
+//set logfile res.dat
+//endcommand
+//;Normalisation :
+//
+//end
+
+void KinematicLocalisationAnalyser::ComputeParticlesDeformation ( void )
+{
+	//cerr << "compute particle deformation" << endl;
+	Tesselation& Tes = TS1->tesselation();
+	RTriangulation& Tri = Tes.Triangulation();
+	Tenseur3 grad_u;
+	Real v;
+	v_total = 0;
+	v_solid_total = 0;
+	grad_u_total = NULL_TENSEUR3;
+	v_total_g = 0;
+	grad_u_total_g = NULL_TENSEUR3;
+	Delta_epsilon ( 3,3 ) = TS1->eps3 - TS0->eps3;
+	Delta_epsilon ( 1,1 ) = TS1->eps1 - TS0->eps1;
+	Delta_epsilon ( 2,2 ) = TS1->eps2 - TS0->eps2;
+
+	//Compute Voronoi tesselation (i.e. voronoi center of each cell)
+	if ( !Tes.Computed() ) Tes.Compute();
+	//cerr << "ParticleDeformation.size() = " << ParticleDeformation.size() << endl;
+	if ( ParticleDeformation.size() != ( Tes.Max_id() + 1 ) )
+	{
+		//cerr << "resize to " << Tes.Max_id() + 1 << endl;
+		ParticleDeformation.clear();
+		ParticleDeformation.resize ( Tes.Max_id() + 1 );
+	}
+	//cerr << "ENDOF ParticleDeformation.size() = " << ParticleDeformation.size() << endl;
+	//reset volumes and tensors of each particle
+	for ( RTriangulation::Finite_vertices_iterator  V_it =
+				Tri.finite_vertices_begin (); V_it !=  Tri.finite_vertices_end (); V_it++ )
+	{
+		//cerr << V_it->info().id() << endl;
+		V_it->info().v() =0;//WARNING : this will erase previous values if some have been computed
+		ParticleDeformation[V_it->info().id() ]=NULL_TENSEUR3;
+	}
+	//cerr << "RTriangulation::Finite_vertices_iterator  V_it  = " << ParticleDeformation.size() << endl;
+
+	Finite_cells_iterator cell = Tri.finite_cells_begin();
+	Finite_cells_iterator cell0 = Tri.finite_cells_end();
+
+
+	//Compute grad_u and volumes of all cells in the triangulation, and assign them to each of the vertices ( volume*grad_u is added here rather than grad_u, the weighted average is computed later )
+	//cerr << "for ( ; cell != cell0; cell++ )" << endl;
+	for ( ; cell != cell0; cell++ ) // calcule la norme du d?viateur dans chaque cellule
+	{
+		//cerr << "ij=" <<ij++<<endl;
+		//cerr << "ij2=" <<ij2++<<endl;
+		//if (!cell->info()->isFictious) //FIXME
+		Grad_u ( cell, grad_u, false );// false : don't divide by volume, here grad_u = volume of cell * average grad_u in cell
+		//cerr << "grad_u=" << grad_u << endl;
+		v = Tri.tetrahedron ( cell ).volume();
+		grad_u_total += grad_u;
+		v_total += v;
+		for ( unsigned int index=0; index<4; index++ )
+		{
+			cell->vertex ( index )->info().v() += v;//WARNING2 : this will affect values which differ from the volumes of voronoi cells
+			//cerr << "ParticleDeformation[cell->vertex (" << cell->vertex ( index )->info().id() << ")"<< endl;
+			ParticleDeformation[cell->vertex ( index )->info().id() ] += grad_u;
+		}
+	}
+
+	//Delete volume and grad_u for particles on the border FIXME : replace that using isFictious flags?
+	Tesselation::Vector_Vertex border_vertices;
+	Tes.Voisins ( Tri.infinite_vertex (), border_vertices );
+	unsigned int l = border_vertices.size();
+	//cerr << "l=" << l << endl;
+	
+	//cerr << "for ( ; cell != cell0; cell++ )" << endl;
+	for ( unsigned int i=0; i<l; ++i )
+	{
+		//cerr << "border " << i << endl;
+		border_vertices[i]->info().v() =0;
+
+		ParticleDeformation[border_vertices[i]->info().id() ]=NULL_TENSEUR3;
+	}
+
+	//Divide sum(v*grad_u) by sum(v) to get the average grad_u on each particle
+	for ( RTriangulation::Finite_vertices_iterator  V_it = Tri.finite_vertices_begin (); V_it !=  Tri.finite_vertices_end (); V_it++ )
+	{
+		v_total_g += V_it->info().v();
+		v_solid_total += 4.188790*pow(V_it->point().weight(),1.5);//4.18... = 4/3*PI; and here, weight is rad?
+		grad_u_total_g += ParticleDeformation[V_it->info().id() ];
+		if ( V_it->info().v() ) ParticleDeformation[V_it->info().id() ]/=V_it->info().v();
+	}
+	grad_u_total_g /= v_total_g;
+	cerr << "sym_grad_u_total_g (wrong averaged strain):"<< endl << Tenseur_sym3 ( grad_u_total_g ) << endl;
+
+	if ( v_total ) grad_u_total /= v_total;
+	cerr << "Total volume = " << v_total << ", grad_u = " << endl << grad_u_total << endl << "sym_grad_u (true average strain): " << endl << Tenseur_sym3 ( grad_u_total ) << endl;
+	cerr << "Macro strain = " << Delta_epsilon << endl;
+	
+}
+
+Real KinematicLocalisationAnalyser::ComputeMacroPorosity (void)
+{
+	return (1-v_solid_total/(TS1->haut*TS1->larg*TS1->prof));
+}
+
+
+


Property changes on: trunk/extra/triangulation/KinematicLocalisationAnalyser.cpp
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/extra/triangulation/KinematicLocalisationAnalyser.hpp
===================================================================
--- trunk/extra/triangulation/KinematicLocalisationAnalyser.hpp	2008-11-17 17:11:31 UTC (rev 1575)
+++ trunk/extra/triangulation/KinematicLocalisationAnalyser.hpp	2008-11-20 14:48:17 UTC (rev 1576)
@@ -0,0 +1,125 @@
+/*************************************************************************
+*  Copyright (C) 2006 by Bruno Chareyre                                *
+*  bruno.chareyre at hmg.inpg.fr                                            *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+/**
+ at author Bruno Chareyre
+*/
+//This class computes statistics of micro-variables assuming axi-symetry
+
+
+#ifndef KINEMATICLOCALISATIONANALYSER_H
+#define KINEMATICLOCALISATIONANALYSER_H
+
+#include "TriaxialState.h"
+#include "Tenseur3.h"
+//class TriaxialState;
+
+
+#define SPHERE_DISCRETISATION 20; //number of "teta" intervals on the unit sphere
+#define LINEAR_DISCRETISATION 200; //number of intervals on segments like [UNmin,UNmax]
+
+
+// l_vertices : d?finition de l'ordre de parcours des sommets
+// pour la facette k, les indices des 3 sommets sont dans la colonne k
+const int l_vertices [4][3] = { {1, 2, 3}, {0, 3, 2}, {3, 0, 1}, {2, 1, 0} };
+
+
+
+
+
+
+
+class KinematicLocalisationAnalyser
+{
+
+
+
+	public:
+
+		typedef vector< pair<Real,Real> > RGrid1D;
+		typedef vector<vector <Real> >  RGrid2D;
+		typedef vector<vector<vector<Real> > > RGrid3D;
+
+
+		KinematicLocalisationAnalyser();
+		KinematicLocalisationAnalyser ( const char* state_file1 );
+		KinematicLocalisationAnalyser ( const char* state_file1, const char* state_file0, bool consecutive_files = true );
+		KinematicLocalisationAnalyser ( const char* base_name, int file_number0, int file_number1 );
+
+		~KinematicLocalisationAnalyser();
+
+		void SetBaseFileName ( string name );
+		bool SetFileNumbers ( int n0, int n1 );
+		void SetConsecutive (bool);
+		void SetNO_ZERO_ID (bool);
+		void SwitchStates ( void );
+
+		bool ToFile ( const char* output_file_name );
+		ofstream& ContactDistributionToFile ( ofstream& output_file );
+		ofstream& AllNeighborDistributionToFile ( ofstream& output_file );
+		ofstream& StrictNeighborDistributionToFile ( ofstream& output_file );
+		ofstream& NormalDisplacementDistributionToFile ( vector<Edge_iterator>& edges, ofstream& output_file );
+
+		long Filtered_contacts ( TriaxialState& state );
+		long Filtered_neighbors ( TriaxialState& state );
+		long Filtered_grains ( TriaxialState& state );
+		Real Filtered_volume ( TriaxialState& state );
+		Real Contact_coordination ( TriaxialState& state );
+		Real Neighbor_coordination ( TriaxialState& state );
+		Tenseur_sym3 Neighbor_fabric ( TriaxialState& state );
+		Tenseur_sym3 Contact_fabric ( TriaxialState& state );
+		Real Contact_anisotropy ( TriaxialState& state );
+		Real Neighbor_anisotropy ( TriaxialState& state );
+		
+		void SetForceIncrements (void);
+		void SetDisplacementIncrements (void);
+
+		///Add surface*displacement to T
+		void Grad_u ( Finite_cells_iterator cell, int facet, Vecteur &V, Tenseur3& T );
+		///Compute grad_u in cell (by default, T= average grad_u in cell, if !vol_divide, T=grad_u*volume
+		void Grad_u ( Finite_cells_iterator cell, Tenseur3& T, bool vol_divide=true );
+		///Compute grad_u for all particles, by summing grad_u of all adjaent cells
+		void ComputeParticlesDeformation (void);
+		///Compute porisity from cumulated spheres volumes and positions of boxes
+		Real ComputeMacroPorosity (void );
+
+
+		Vecteur Deplacement ( Cell_handle cell );  //donne le d?placement d'un sommet de voronoi
+		Vecteur Deplacement ( Finite_cells_iterator cell, int facet ); //mean displacement on a facet
+
+		// Calcul du tenseur d'orientation des voisins
+		//Tenseur_sym3 Orientation_voisins (Tesselation& Tes);
+
+		vector<pair<Real,Real> >& NormalDisplacementDistribution ( vector<Edge_iterator>& edges, vector<pair<Real,Real> >& row );
+		//vector<pair<Real,Real> > NormalDisplacementDistribution(TriaxialState& state, TriaxialState& state0);
+
+		//member data
+		int sphere_discretisation;
+		int linear_discretisation;
+		Tenseur_sym3 Delta_epsilon;
+		Tenseur3 grad_u_total;
+		vector<Tenseur3> ParticleDeformation;		
+		Tenseur3 grad_u_total_g;//grad_u averaged on extended grain cells
+		TriaxialState *TS1, *TS0;
+	private:
+
+		int file_number_1, file_number_0;
+		//Characteristic size of particles
+		string base_file_name;   //Base name of state-files, complete name is (base_name+state_number).
+		bool consecutive; //Are the two triax states consecutive? if "false" displacements are re-computed
+		//from the two source files; if "true" one file is enough.
+		Real v_solid_total;//solid volume in the box
+		Real v_total;//volume of the box
+		Real v_total_g;//summed volumes of extended grain cells
+		long n_persistent, n_new, n_lost;
+
+
+
+};
+
+#endif


Property changes on: trunk/extra/triangulation/KinematicLocalisationAnalyser.hpp
___________________________________________________________________
Name: svn:executable
   + *


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From sj2001 at yandex.ru  Thu Nov 20 18:27:07 2008
From: sj2001 at yandex.ru (sega)
Date: Thu, 20 Nov 2008 20:27:07 +0300
Subject: [deprecated list] [Yade-dev] inherited PhysicalParameters
	for	InteractionPhysicsEngineUnit
In-Reply-To: <4eb6799e0811200848h1f64543cs1af732a9966810c4@mail.gmail.com>
References: <4eb6799e0811200848h1f64543cs1af732a9966810c4@mail.gmail.com>
Message-ID: <200811202027.07921.sj2001@yandex.ru>

> I've got a problem with 'SimpleViscoelasticRelationships'. This
> 2d-functor needs 2 'PhysicalParameters' that are casted into
> 'SimpleViscoelasticBodyParameters' in the method 'go'.
> 
> I want to use BcpConnection that inherit from
> SimpleViscoelasticBodyParameters for one of the parameters.
> The problem is that call 'SimpleViscoelasticRelationships::go' fail
> (before entering the function).
> I've got the following message:
> 
> terminate called after throwing an instance of 'std::runtime_error'
>   what():  DynLibDispatcher: ambiguous or undefined dispatch for 2d
> multivirtual function, classes: SimpleViscoelasticBodyParameters
> BcpConnection
> 

You need own 2d-functor "*Relationships" for your PhysicalParameters (BcpConnection). 
SimpleViscoelasticRelationships only for SimpleViscoelasticBodyParameters, 
see line 29 in SimpleViscoelasticRelationships.hpp:

FUNCTOR2D(SimpleViscoelasticBodyParameters,SimpleViscoelasticBodyParameters);

It calculate InteractionPhysics (SimpleViscoelasticInteraction) from 
PhysicalParameters of contacting bodys.

So, if you have own PhysicalParameters, you need own Relationships for calculating InteractionPhysics from this parameters. (or you can modify exant classes with take care of their default behavior without changes)...

-- 
Best regards, Sergei D.

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From richefeu at geo.hmg.inpg.fr  Fri Nov 21 09:20:53 2008
From: richefeu at geo.hmg.inpg.fr (Vincent Richefeu)
Date: Fri, 21 Nov 2008 09:20:53 +0100
Subject: [deprecated list] [Yade-dev] inherited PhysicalParameters
	for	InteractionPhysicsEngineUnit
In-Reply-To: <200811202027.07921.sj2001@yandex.ru>
References: <4eb6799e0811200848h1f64543cs1af732a9966810c4@mail.gmail.com>
	<200811202027.07921.sj2001@yandex.ru>
Message-ID: <00E1C5C0-9FB3-4F9E-918F-B4D6E4D4613D@geo.hmg.inpg.fr>


>> I've got a problem with 'SimpleViscoelasticRelationships'. This
>> 2d-functor needs 2 'PhysicalParameters' that are casted into
>> 'SimpleViscoelasticBodyParameters' in the method 'go'.
>>
>> I want to use BcpConnection that inherit from
>> SimpleViscoelasticBodyParameters for one of the parameters.
>> The problem is that call 'SimpleViscoelasticRelationships::go' fail
>> (before entering the function).
>> I've got the following message:
>>
>> terminate called after throwing an instance of 'std::runtime_error'
>>   what():  DynLibDispatcher: ambiguous or undefined dispatch for 2d
>> multivirtual function, classes: SimpleViscoelasticBodyParameters
>> BcpConnection
>>
>
> You need own 2d-functor "*Relationships" for your  
> PhysicalParameters (BcpConnection).
> SimpleViscoelasticRelationships only for  
> SimpleViscoelasticBodyParameters,
> see line 29 in SimpleViscoelasticRelationships.hpp:
>
> FUNCTOR2D 
> (SimpleViscoelasticBodyParameters,SimpleViscoelasticBodyParameters);
>
> It calculate InteractionPhysics (SimpleViscoelasticInteraction) from
> PhysicalParameters of contacting bodys.
>
> So, if you have own PhysicalParameters, you need own Relationships  
> for calculating InteractionPhysics from this parameters. (or you  
> can modify exant classes with take care of their default behavior  
> without changes)...
>

Thank for your answer Sega,

There is still something boring:
as I said, BcpConnection IS a SimpleViscoelasticBodyParameters.
If I write my own functor, it will do exactly the same job as  
SimpleViscoelasticRelationships !
Besides, casting BcpConnection into SimpleViscoelasticBodyParameters  
is possible
without any problem. Maybe the 'problem' come from the DynLibDispatcher?

Vincent




_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From richefeu at mail.berlios.de  Fri Nov 21 12:07:46 2008
From: richefeu at mail.berlios.de (richefeu at BerliOS)
Date: Fri, 21 Nov 2008 12:07:46 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1578 - in
	trunk/pkg:	common/DataClass/InteractingGeometry
	dem/Engine/EngineUnit
Message-ID: <200811211107.mALB7kWG010382@sheep.berlios.de>

Author: richefeu
Date: 2008-11-21 12:07:45 +0100 (Fri, 21 Nov 2008)
New Revision: 1578

Added:
   trunk/pkg/common/DataClass/InteractingGeometry/InteractingNode.cpp
   trunk/pkg/common/DataClass/InteractingGeometry/InteractingNode.hpp
   trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2BssSweptSphereLineSegment4SpheresContactGeometry.cpp
   trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2BssSweptSphereLineSegment4SpheresContactGeometry.hpp
Log:
- forgotten files



Added: trunk/pkg/common/DataClass/InteractingGeometry/InteractingNode.cpp
===================================================================
--- trunk/pkg/common/DataClass/InteractingGeometry/InteractingNode.cpp	2008-11-21 11:05:06 UTC (rev 1577)
+++ trunk/pkg/common/DataClass/InteractingGeometry/InteractingNode.cpp	2008-11-21 11:07:45 UTC (rev 1578)
@@ -0,0 +1,26 @@
+/*************************************************************************
+*  Copyright (C) 2008 by Vincent Richefeu                                *
+*  vincent.richefeu at hmg.inpg.fr                                          *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#include "InteractingNode.hpp"
+
+InteractingNode::InteractingNode () : InteractingGeometry()
+{
+	createIndex();
+}
+
+InteractingNode::~InteractingNode ()
+{
+}
+
+void InteractingNode::registerAttributes()
+{
+	InteractingGeometry::registerAttributes();
+}
+
+
+YADE_PLUGIN("InteractingNode");

Added: trunk/pkg/common/DataClass/InteractingGeometry/InteractingNode.hpp
===================================================================
--- trunk/pkg/common/DataClass/InteractingGeometry/InteractingNode.hpp	2008-11-21 11:05:06 UTC (rev 1577)
+++ trunk/pkg/common/DataClass/InteractingGeometry/InteractingNode.hpp	2008-11-21 11:07:45 UTC (rev 1578)
@@ -0,0 +1,32 @@
+/*************************************************************************
+*  Copyright (C) 2008 by Vincent Richefeu                                *
+*  vincent.richefeu at hmg.inpg.fr                                          *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#ifndef INTERACTING_NODE_HPP
+#define INTERACTING_NODE_HPP
+
+#include<yade/core/InteractingGeometry.hpp>
+
+class InteractingNode : public InteractingGeometry
+{
+	public :
+		InteractingNode ();
+		virtual ~InteractingNode ();
+
+/// Serialization
+	protected :
+		void registerAttributes();
+	REGISTER_CLASS_NAME(InteractingNode);
+	REGISTER_BASE_CLASS_NAME(InteractingGeometry);
+
+/// Indexable
+	REGISTER_CLASS_INDEX(InteractingNode,InteractingGeometry);
+};
+
+REGISTER_SERIALIZABLE(InteractingNode,false);
+
+#endif // INTERACTING_NODE_HPP

Added: trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2BssSweptSphereLineSegment4SpheresContactGeometry.cpp
===================================================================
--- trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2BssSweptSphereLineSegment4SpheresContactGeometry.cpp	2008-11-21 11:05:06 UTC (rev 1577)
+++ trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2BssSweptSphereLineSegment4SpheresContactGeometry.cpp	2008-11-21 11:07:45 UTC (rev 1578)
@@ -0,0 +1,82 @@
+/*************************************************************************
+*  Copyright (C) 2008 by Vincent Richefeu                                *
+*  vincent.richefeu at hmg.inpg.fr                                          *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#include"InteractingSphere2BssSweptSphereLineSegment4SpheresContactGeometry.hpp"
+#include<yade/pkg-dem/SpheresContactGeometry.hpp>
+#include<yade/pkg-common/InteractingSphere.hpp>
+#include<yade/pkg-common/BssSweptSphereLineSegment.hpp>
+
+#include<yade/lib-base/yadeWm3Extra.hpp>
+
+// BUILDING WORK !!!!
+
+bool InteractingSphere2BssSweptSphereLineSegment4SpheresContactGeometry::go(
+		const shared_ptr<InteractingGeometry>& cm1,
+		const shared_ptr<InteractingGeometry>& cm2,
+		const Se3r& se31,
+  
+		const Se3r& se32,
+		const shared_ptr<Interaction>& c)
+{
+        InteractingSphere* s            = static_cast<InteractingSphere*>(cm1.get());
+        BssSweptSphereLineSegment* ssls = static_cast<BssSweptSphereLineSegment*>(cm2.get());
+        
+        Real SquaredHalfLength = 0.25 * ssls->length * ssls->length; // FIXME - ssls should store halfLength
+        Vector3r cc = se31.position - se32.position;
+        Vector3r proj = (cc.Dot(ssls->orientation)) * ssls->orientation; 
+     
+	if (proj.SquaredLength() < SquaredHalfLength) // Potential contact with the cylindrical part of ssls 
+        {
+                Vector3r ccn = cc - proj;           
+                Real ccn_dist = ccn.Normalize();
+                        
+                Real overlap = ccn_dist - s->radius - ssls->radius;
+                if (overlap <= 0.0)
+                {
+                        shared_ptr<SpheresContactGeometry> scm;
+                        if (c->isNew) scm = shared_ptr<SpheresContactGeometry>(new SpheresContactGeometry());
+                        else scm = YADE_PTR_CAST<SpheresContactGeometry>(c->interactionGeometry);
+        
+                        scm->contactPoint = se32.position + proj + (ssls->radius+0.5*overlap)*ccn;
+                        scm->normal = -ccn;
+                        scm->penetrationDepth = -overlap;
+                        scm->radius1 = s->radius;
+                        scm->radius2 = ssls->radius;
+                        c->interactionGeometry = scm;
+                        return true;
+                }
+                
+                return false;
+        }
+        // else ... TODO
+
+	return false;
+}
+
+
+bool InteractingSphere2BssSweptSphereLineSegment4SpheresContactGeometry::goReverse(	const shared_ptr<InteractingGeometry>& cm1,
+						const shared_ptr<InteractingGeometry>& cm2,
+						const Se3r& se31,
+						const Se3r& se32,
+						const shared_ptr<Interaction>& c)
+{
+	bool isInteracting = go(cm2,cm1,se32,se31,c);
+	if (isInteracting)
+	{
+		SpheresContactGeometry* scm = static_cast<SpheresContactGeometry*>(c->interactionGeometry.get());
+
+                // Inverse the normal direction and swap the radii
+		scm->normal = -scm->normal;
+                Real tmpR  = scm->radius1;
+		scm->radius1 = scm->radius2;
+		scm->radius2 = tmpR;
+	}
+	return isInteracting;
+}
+
+YADE_PLUGIN("InteractingSphere2BssSweptSphereLineSegment4SpheresContactGeometry");

Added: trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2BssSweptSphereLineSegment4SpheresContactGeometry.hpp
===================================================================
--- trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2BssSweptSphereLineSegment4SpheresContactGeometry.hpp	2008-11-21 11:05:06 UTC (rev 1577)
+++ trunk/pkg/dem/Engine/EngineUnit/InteractingSphere2BssSweptSphereLineSegment4SpheresContactGeometry.hpp	2008-11-21 11:07:45 UTC (rev 1578)
@@ -0,0 +1,40 @@
+/*************************************************************************
+*  Copyright (C) 2008 by Vincent Richefeu                                *
+*  vincent.richefeu at hmg.inpg.fr                                          *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#ifndef EF2_SSLS_SPHERE_MAKE_SDECCONTACTMODEL_HPP
+#define EF2_SSLS_SPHERE_MAKE_SDECCONTACTMODEL_HPP
+
+#include<yade/pkg-common/InteractionGeometryEngineUnit.hpp>
+
+class InteractingSphere2BssSweptSphereLineSegment4SpheresContactGeometry : public InteractionGeometryEngineUnit
+{
+	public :
+		virtual bool go(	const shared_ptr<InteractingGeometry>& cm1,
+					const shared_ptr<InteractingGeometry>& cm2,
+					const Se3r& se31,
+					const Se3r& se32,
+					const shared_ptr<Interaction>& c);
+
+		virtual bool goReverse(	const shared_ptr<InteractingGeometry>& cm1,
+					const shared_ptr<InteractingGeometry>& cm2,
+					const Se3r& se31,
+					const Se3r& se32,
+					const shared_ptr<Interaction>& c);
+
+        REGISTER_CLASS_NAME(InteractingSphere2BssSweptSphereLineSegment4SpheresContactGeometry);
+	REGISTER_BASE_CLASS_NAME(InteractionGeometryEngineUnit);
+
+        FUNCTOR2D(InteractingSphere,BssSweptSphereLineSegment);
+
+        DEFINE_FUNCTOR_ORDER_2D(InteractingSphere,BssSweptSphereLineSegment);
+};
+
+REGISTER_SERIALIZABLE(InteractingSphere2BssSweptSphereLineSegment4SpheresContactGeometry,false);
+
+#endif // EF2_SSLS_SPHERE_MAKE_SDECCONTACTMODEL_HPP
+


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Fri Nov 21 17:20:12 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Fri, 21 Nov 2008 17:20:12 +0100
Subject: [deprecated list] [Yade-dev] scons, and compiling HEAD
Message-ID: <20081121172012.4055e81f@szpak>

Hi (Vaclav ;)

What should I do to avoid full automatic recompile between
"scons jobs=4" and "scons jobs=1"

I remember you were saying something about copying some directories...


There's a compilation problem: compilation must be done in TWO
passes. On first pass I get errors:

  gui/qt3/YadeQtMainWindow.hpp:65: error: `class SimulationController' has no member named `raise'

On second compile - it compiles just fine. Weird, isn't it?

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From richefeu at gmail.com  Thu Nov 20 17:48:23 2008
From: richefeu at gmail.com (Vincent Richefeu)
Date: Thu, 20 Nov 2008 17:48:23 +0100
Subject: [deprecated list] [Yade-dev] inherited PhysicalParameters
	for	InteractionPhysicsEngineUnit
Message-ID: <4eb6799e0811200848h1f64543cs1af732a9966810c4@mail.gmail.com>

Hello everybody,

I've got a problem with 'SimpleViscoelasticRelationships'. This
2d-functor needs 2 'PhysicalParameters' that are casted into
'SimpleViscoelasticBodyParameters' in the method 'go'.

I want to use BcpConnection that inherit from
SimpleViscoelasticBodyParameters for one of the parameters.
The problem is that call 'SimpleViscoelasticRelationships::go' fail
(before entering the function).
I've got the following message:

terminate called after throwing an instance of 'std::runtime_error'
  what():  DynLibDispatcher: ambiguous or undefined dispatch for 2d
multivirtual function, classes: SimpleViscoelasticBodyParameters
BcpConnection

Maybe I do something wrong. Please tell me.

Vincent

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Sat Nov 22 20:05:17 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Sat, 22 Nov 2008 20:05:17 +0100
Subject: [deprecated list] [Yade-dev] scons, and compiling HEAD
In-Reply-To: <20081121172012.4055e81f@szpak>
References: <20081121172012.4055e81f@szpak>
Message-ID: <492857ED.7060102@arcig.cz>


> What should I do to avoid full automatic recompile between
> "scons jobs=4" and "scons jobs=1"
>   
It shouldn't recompile. It works for me.
> There's a compilation problem: compilation must be done in TWO
> passes. On first pass I get errors:
>
>   gui/qt3/YadeQtMainWindow.hpp:65: error: `class SimulationController' has no member named `raise'
>
> On second compile - it compiles just fine. Weird, isn't it?
>   
Again, it doesn't happen here. I am running automatic compilation from
clean svn trunk and it works (that is where we get automated crash
reports from: download, compile, test).

Can you test on clean trunk (and clean builddir, of course) and/or on
different machine?

Vaclav


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From cosurgi at mail.berlios.de  Sat Nov 22 23:48:28 2008
From: cosurgi at mail.berlios.de (cosurgi at BerliOS)
Date: Sat, 22 Nov 2008 23:48:28 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1579 - in trunk: . gui/qt3
Message-ID: <200811222248.mAMMmSNQ022381@sheep.berlios.de>

Author: cosurgi
Date: 2008-11-22 23:48:27 +0100 (Sat, 22 Nov 2008)
New Revision: 1579

Modified:
   trunk/INSTALL
   trunk/NEWS
   trunk/gui/qt3/YadeQtMainWindow.cpp
Log:
up direction on Y
release 0.12.1



Modified: trunk/INSTALL
===================================================================
--- trunk/INSTALL	2008-11-21 11:07:45 UTC (rev 1578)
+++ trunk/INSTALL	2008-11-22 22:48:27 UTC (rev 1579)
@@ -36,7 +36,7 @@
     * Doxygen
     * wildmagic 3.11 - only if you want Delaunay triangulation support in lattice model
     * log4cxx - extensive logging support and debugging
-    * python-dev, python-scientific, python-matplotlib - for python scripting interface
+    * python-dev, python-scientific, python-matplotlib, python-numpy - for python scripting interface
 	 * gdb
 
 Installation

Modified: trunk/NEWS
===================================================================
--- trunk/NEWS	2008-11-21 11:07:45 UTC (rev 1578)
+++ trunk/NEWS	2008-11-22 22:48:27 UTC (rev 1579)
@@ -1,5 +1,19 @@
 vim:syntax=changelog
 
+2008-08-20 Janek Kozicki <cosurgi at gmail.com> revision 1579
+
+	* RELEASE: 0.12.1
+	
+		- several python interface improvements
+		- add code for plotting histogram of interaction directions
+		- added buttons for looking from different directions
+		- new contact algorithm for facets
+		- added python script for making videos
+		- added a TCP server on port 9000 with python console in it
+		- new dependency on python-numpy package, which allows faster math in python
+		- added a script for parametric studies
+
+
 2008-08-20 Janek Kozicki <cosurgi at gmail.com> revision 1486
 
 	* RELEASE: 0.12

Modified: trunk/gui/qt3/YadeQtMainWindow.cpp
===================================================================
--- trunk/gui/qt3/YadeQtMainWindow.cpp	2008-11-21 11:07:45 UTC (rev 1578)
+++ trunk/gui/qt3/YadeQtMainWindow.cpp	2008-11-22 22:48:27 UTC (rev 1579)
@@ -151,7 +151,7 @@
 	shared_ptr<GLViewer> glv=shared_ptr<GLViewer>(new GLViewer(glViews.size(),renderer,NULL,isFirst?NULL:glViews[0].get()));
 	glv->setCamera(new YadeCamera);
 	glv->camera()->frame()->setWheelSensitivity(-1.0f);
-	glv->camera()->setUpVector(qglviewer::Vec(0,0,1));
+	glv->camera()->setUpVector(qglviewer::Vec(0,1,0));
 	glv->camera()->setViewDirection(qglviewer::Vec(-1,-1,-1));
 	lookDown(glv);
 	glViews.push_back(glv);
@@ -163,14 +163,14 @@
 	bool hasSimulation=(Omega::instance().getRootBody() ? Omega::instance().getRootBody()->bodies->size()>0 : false );
 	if(hasSimulation)
 	{	
-		Vector3r g(0,0,1);
+		Vector3r g(0,1,0);
 		FOREACH(const shared_ptr<Engine>& e,Omega::instance().getRootBody()->engines){
 			if(e && e->getClassName()=="GravityEngine")  
 				g = -1.0*(dynamic_cast<GravityEngine*>(e.get()))->gravity;
 		}
 		glv->camera()->setUpVector(qglviewer::Vec(g[0],g[1],g[2]));
 	} else {
-		glv->camera()->setUpVector(qglviewer::Vec(0,0,1));
+		glv->camera()->setUpVector(qglviewer::Vec(0,1,0));
 	}
 	glv->camera()->setViewDirection(qglviewer::Vec(-1,-1,-1));
 	glv->centerScene();


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From cosurgi at mail.berlios.de  Sat Nov 22 23:54:47 2008
From: cosurgi at mail.berlios.de (cosurgi at BerliOS)
Date: Sat, 22 Nov 2008 23:54:47 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1580 - tags
Message-ID: <200811222254.mAMMsl1X022699@sheep.berlios.de>

Author: cosurgi
Date: 2008-11-22 23:54:46 +0100 (Sat, 22 Nov 2008)
New Revision: 1580

Added:
   tags/yade-0.12.1/
Log:
tag 0.12.1 release



Copied: tags/yade-0.12.1 (from rev 1579, trunk)


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Sun Nov 23 00:08:28 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Sun, 23 Nov 2008 00:08:28 +0100
Subject: [deprecated list] [Yade-dev] scons, and compiling HEAD
In-Reply-To: <492857ED.7060102@arcig.cz>
References: <20081121172012.4055e81f@szpak>
	<492857ED.7060102@arcig.cz>
Message-ID: <20081123000828.1a7109ce@szpak>

V?clav S(milauer said:     (by the date of Sat, 22 Nov 2008 20:05:17 +0100)

> 
> > What should I do to avoid full automatic recompile between
> > "scons jobs=4" and "scons jobs=1"
> >   
> It shouldn't recompile. It works for me.

oh, right. sorry.

> > On second compile - it compiles just fine. Weird, isn't it?
> >   
> Again, it doesn't happen here. I am running automatic compilation from
> clean svn trunk and it works (that is where we get automated crash
> reports from: download, compile, test).
> 
> Can you test on clean trunk (and clean builddir, of course) and/or on
> different machine?

ok, it works on different machine.

I made release 0.12.1

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Mon Nov 24 13:18:50 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Mon, 24 Nov 2008 13:18:50 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1581 - in trunk: extra/usct
	gui/qt3	pkg/common/Engine/DeusExMachina
Message-ID: <200811241218.mAOCIoJa002762@sheep.berlios.de>

Author: eudoxos
Date: 2008-11-24 13:18:47 +0100 (Mon, 24 Nov 2008)
New Revision: 1581

Added:
   trunk/pkg/common/Engine/DeusExMachina/LinearInterpolate.hpp
Modified:
   trunk/extra/usct/UniaxialStrainControlledTest.cpp
   trunk/extra/usct/UniaxialStrainControlledTest.hpp
   trunk/gui/qt3/QtGUI.cpp
   trunk/pkg/common/Engine/DeusExMachina/RotationEngine.cpp
   trunk/pkg/common/Engine/DeusExMachina/RotationEngine.hpp
Log:
1. Add linear templated interpolation function working on 2 lists, t and values
2. Add InterpolatingRotationEngine that changes rotation speed as given by value table
3. Lower info about starting python thread to debug message only.



Modified: trunk/extra/usct/UniaxialStrainControlledTest.cpp
===================================================================
--- trunk/extra/usct/UniaxialStrainControlledTest.cpp	2008-11-22 22:54:46 UTC (rev 1580)
+++ trunk/extra/usct/UniaxialStrainControlledTest.cpp	2008-11-24 12:18:47 UTC (rev 1581)
@@ -102,6 +102,9 @@
 	// reverse if we're over the limit strain
 	if(notYetReversed && limitStrain!=0 && ((currentStrainRate>0 && strain>limitStrain) || (currentStrainRate<0 && strain<limitStrain))) { currentStrainRate*=-1; notYetReversed=false; LOG_INFO("Reversed strain rate to "<<currentStrainRate); }
 
+	// if(strain==stopAtStrain){LOG_INFO("Prescibed strain "<<stopAtStrain<<" reached, pausing."); }
+	if(!isnan(stopAtStrain) && ((strain*stopAtStrain>0) && abs(strain)>abs(stopAtStrain))) { strain=stopAtStrain;	rootBody->stopAtIteration=Omega::instance().getCurrentIteration()+2; LOG_INFO("Prescribed strain "<<stopAtStrain<<" reached, will stop in 2 iterations"); }
+
 	if(Omega::instance().getCurrentIteration()%10==0 ) {
 		computeAxialForce(rootBody);
 		#if 0

Modified: trunk/extra/usct/UniaxialStrainControlledTest.hpp
===================================================================
--- trunk/extra/usct/UniaxialStrainControlledTest.hpp	2008-11-22 22:54:46 UTC (rev 1580)
+++ trunk/extra/usct/UniaxialStrainControlledTest.hpp	2008-11-24 12:18:47 UTC (rev 1581)
@@ -15,7 +15,7 @@
 	private:
 		void createEngines();
 	public:
-		USCTGen(){ axis=1; limitStrain=0; damping=0.2;cohesiveThresholdIter=200; };
+		USCTGen(){ axis=1; limitStrain=0; damping=0.2;cohesiveThresholdIter=200;};
 		~USCTGen (){};
 		bool generate();
 		string spheresFile;
@@ -81,6 +81,8 @@
 		void init();
 	public:
 		Real strainRate,currentStrainRate;
+		//! strain at which we will pause simulation; inactive (nan) by default; must be reached from below (in absolute value)
+		Real stopAtStrain;
 		//! distance of reference bodies in the direction of axis before straining started
 		Real originalLength;
 		vector<Real> originalWidths;
@@ -124,11 +126,12 @@
 		Real strain, avgStress;
 
 		virtual void applyCondition(MetaBody* rootBody);
-		UniaxialStrainer(){axis=2; asymmetry=0; currentStrainRate=0; originalLength=-1; limitStrain=0; notYetReversed=true; crossSectionArea=-1; needsInit=true; /* sensorsPusher=shared_ptr<UniaxialStrainSensorPusher>(); */ recordFile="/tmp/usct.data"; strain=avgStress=/*avgTransStrain=*/0; blockRotations=false; blockDisplacements=false;};
+		UniaxialStrainer(){axis=2; asymmetry=0; currentStrainRate=0; originalLength=-1; limitStrain=0; notYetReversed=true; crossSectionArea=-1; needsInit=true; /* sensorsPusher=shared_ptr<UniaxialStrainSensorPusher>(); */ recordFile="/tmp/usct.data"; strain=avgStress=/*avgTransStrain=*/0; blockRotations=false; blockDisplacements=false;  stopAtStrain=numeric_limits<Real>::quiet_NaN();};
 		virtual ~UniaxialStrainer(){};
 		void registerAttributes(){
 			DeusExMachina::registerAttributes();
 			REGISTER_ATTRIBUTE(strainRate);
+			REGISTER_ATTRIBUTE(stopAtStrain);
 			REGISTER_ATTRIBUTE(currentStrainRate);
 			REGISTER_ATTRIBUTE(axis);
 			REGISTER_ATTRIBUTE(asymmetry);

Modified: trunk/gui/qt3/QtGUI.cpp
===================================================================
--- trunk/gui/qt3/QtGUI.cpp	2008-11-22 22:54:46 UTC (rev 1580)
+++ trunk/gui/qt3/QtGUI.cpp	2008-11-24 12:18:47 UTC (rev 1581)
@@ -62,7 +62,7 @@
 	mainWindow->show();
 	app.setMainWidget(mainWindow);
 	#ifdef EMBED_PYTHON
-		LOG_INFO("Launching Python thread now...");
+		LOG_DEBUG("Launching Python thread now...");
 		//PyEval_InitThreads();
 		boost::thread pyThread(boost::function0<void>(&PythonUI::pythonSession));
 	#endif

Added: trunk/pkg/common/Engine/DeusExMachina/LinearInterpolate.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/LinearInterpolate.hpp	2008-11-22 22:54:46 UTC (rev 1580)
+++ trunk/pkg/common/Engine/DeusExMachina/LinearInterpolate.hpp	2008-11-24 12:18:47 UTC (rev 1581)
@@ -0,0 +1,47 @@
+// 2008 ? V?clav ?milauer <eudoxos at arcig.cz>
+
+#include<vector>
+#include<iostream>
+#include<cassert>
+
+/* Linear interpolation function suitable only for sequential interpolation.
+ *
+ * Template parameter T must support: addition, subtraction, scalar multiplication.
+ *
+ * @param t "time" at which the interpolated variable should be evaluated.
+ * @param tt "time" points at which values are given; must be increasing.
+ * @param values values at "time" points specified by tt
+ * @param pos holds lookup state
+ *
+ * @return value at "time" t; out of range: t<t0 ? value(t0), t>t_last ? value(t_last)
+ */
+template<typename T>
+T linearInterpolate(const Real t, const std::vector<Real>& tt, const std::vector<T>& values, size_t& pos){
+	assert(tt.size()==values.size());
+	if(t<=tt[0]){ pos=0; return values[0];}
+	if(t>=*tt.rbegin()){ pos=tt.size()-2; return *values.rbegin();}
+	pos=std::min(pos,tt.size()-2);
+	while((tt[pos]>t) || (tt[pos+1]<t)){
+		assert(tt[pos]<tt[pos+1]);
+		if(tt[pos]>t) pos--;
+		else pos++;
+	}
+	const Real& t0=tt[pos], t1=tt[pos+1]; const T& v0=values[pos], v1=values[pos+1];
+	return v0+(v1-v0)*((t-t0)/(t1-t0));
+}
+
+#if 0
+	// test program
+	int main(void){
+		Real t,v;
+		std::vector<Real> tt,vv;
+		while(std::cin){
+			std::cin>>t>>v;
+			tt.push_back(t); vv.push_back(v);	
+		}
+		size_t pos;
+		for(Real t=0; t<10; t+=0.1){
+			std::cout<<t<<" "<<linearInterpolate<Real>(t,tt,vv,pos)<<std::endl;
+		}
+	}
+#endif 

Modified: trunk/pkg/common/Engine/DeusExMachina/RotationEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/RotationEngine.cpp	2008-11-22 22:54:46 UTC (rev 1580)
+++ trunk/pkg/common/Engine/DeusExMachina/RotationEngine.cpp	2008-11-24 12:18:47 UTC (rev 1581)
@@ -9,12 +9,20 @@
 *************************************************************************/
 
 
-#include "RotationEngine.hpp"
+#include"RotationEngine.hpp"
 #include<yade/pkg-common/RigidBodyParameters.hpp>
 #include<yade/core/MetaBody.hpp>
 #include<yade/lib-base/yadeWm3Extra.hpp>
 
+#include<yade/pkg-common/LinearInterpolate.hpp>
 
+YADE_PLUGIN("RotationEngine","InterpolatingRotationEngine");
+
+void InterpolatingRotationEngine::applyCondition(MetaBody* rb){
+	angularVelocity=linearInterpolate<Real>(rb->simulationTime,times,velocities,pos);
+	RotationEngine::applyCondition(rb);
+}
+
 RotationEngine::RotationEngine()
 {
 	rotateAroundZero = false;
@@ -73,4 +81,3 @@
 
 }
 
-YADE_PLUGIN();

Modified: trunk/pkg/common/Engine/DeusExMachina/RotationEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/RotationEngine.hpp	2008-11-22 22:54:46 UTC (rev 1580)
+++ trunk/pkg/common/Engine/DeusExMachina/RotationEngine.hpp	2008-11-24 12:18:47 UTC (rev 1581)
@@ -1,18 +1,14 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  olivier.galizzi at imag.fr                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
+// ? 2004 Olivier Galizzi <olivier.galizzi at imag.fr>
+// ? 2008 V?clav ?milauer <eudoxos at arcig.cz>
+#pragma once
 
-#ifndef ROTATIONENGINE_HPP
-#define ROTATIONENGINE_HPP
-
 #include<yade/core/DeusExMachina.hpp>
-#include <Wm3Vector3.h>
+#include<Wm3Vector3.h>
 #include<yade/lib-base/yadeWm3.hpp>
 
+/*! Engine applying rotation (by setting angular velocity) to subscribed bodies.
+ * If rotateAroundZero is set, then each body is also displaced around zeroPoint.
+ */
 class RotationEngine : public DeusExMachina
 {
 	public :
@@ -31,8 +27,23 @@
 	REGISTER_CLASS_NAME(RotationEngine);
 	REGISTER_BASE_CLASS_NAME(DeusExMachina);
 };
-
 REGISTER_SERIALIZABLE(RotationEngine,false);
 
-#endif // ROTATIONENGINE_HPP
+/*! Engine applying rotation, finding current angular velocity by interpolating in times and velocities */
+class InterpolatingRotationEngine: public RotationEngine{
+	public:
+		//! list of times at which velocities are given; must be increasing
+		vector<Real> times;
+		//! list of angular velocities
+		vector<Real> velocities;
+		//! holder of interpolation state, should not be touched by the user.
+		size_t pos;
+		InterpolatingRotationEngine(){pos=0;}
+		void registerAttributes(){ RotationEngine::registerAttributes(); REGISTER_ATTRIBUTE(times); REGISTER_ATTRIBUTE(velocities); REGISTER_ATTRIBUTE(pos); }
+		void applyCondition(MetaBody* rb);
+	REGISTER_CLASS_NAME(InterpolatingRotationEngine);
+	REGISTER_BASE_CLASS_NAME(RotationEngine);
+};
+REGISTER_SERIALIZABLE(InterpolatingRotationEngine,false);
 
+


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From janek_listy at wp.pl  Mon Nov 24 18:40:02 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Mon, 24 Nov 2008 18:40:02 +0100
Subject: [deprecated list] [Yade-dev] scons, and compiling HEAD
In-Reply-To: <20081123000828.1a7109ce@szpak>
References: <20081121172012.4055e81f@szpak> <492857ED.7060102@arcig.cz>
	<20081123000828.1a7109ce@szpak>
Message-ID: <20081124184002.01a9ee1a@szpak>

Janek Kozicki said:     (by the date of Sun, 23 Nov 2008 00:08:28 +0100)

> > > What should I do to avoid full automatic recompile between
> > > "scons jobs=4" and "scons jobs=1"
> > >   
> > It shouldn't recompile. It works for me.
> 
> oh, right. sorry.

a followup question. If in scons.profile I change:

  variant = '-slow'
  version = '0.12'

to

  variant = '-slow'
  version = '0.12.1'

is it enough to rename ../build-0.12-slow into ../build-0.12.1-slow to
avoid full recompiling?

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Tue Nov 25 05:59:58 2008
From: eudoxos at arcig.cz (=?windows-1250?Q?V=E1clav_=8Amilauer?=)
Date: Tue, 25 Nov 2008 05:59:58 +0100
Subject: [deprecated list] [Yade-dev] scons, and compiling HEAD
In-Reply-To: <20081124184002.01a9ee1a@szpak>
References: <20081121172012.4055e81f@szpak>
	<492857ED.7060102@arcig.cz>	<20081123000828.1a7109ce@szpak>
	<20081124184002.01a9ee1a@szpak>
Message-ID: <492B864E.6050504@arcig.cz>


> a followup question. If in scons.profile I change:
>
>   variant = '-slow'
>   version = '0.12'
>
> to
>
>   variant = '-slow'
>   version = '0.12.1'
>
> is it enough to rename ../build-0.12-slow into ../build-0.12.1-slow to
> avoid full recompiling?
>   
No, since  -DSUFFIX=\"-0.12-slow\" is passed to every g++ call (check
with pretty=0). Hence all objects will be recompiled, since their
command-line has changed. There is hardly a way to avoid that, except
for putting such stuff inside Omega and #define those macros only for a
few translation units.

Vaclav



_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Wed Nov 26 21:08:38 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Wed, 26 Nov 2008 21:08:38 +0100
Subject: [deprecated list] [Yade-dev] commit 1583, 3d view, serialization.
Message-ID: <20081126210838.33476551@szpak>

Hi Vaclav,

After you commit, the "primary view" window is empty (draws nothing),
but when I click "New 3D" view - the new window draws everything as
it should. Can you fix that?

In my commit 1584 I'm adding some snow-related stuff. It's my files
that I have been developing as a separate code in the past. That code
is using boost::serialization. So I guess that this is time for
adding to yade a dependency on boost serialiaztion (unless you
exclude='snow'). I think that actually having "twice" serialization
in whole yade isn't too difficult to add. Look at how I'm using it in
my files, and you can start adding it too in other files.... if you want.

When we have it "twice" in whole yade and it works, we can start
slowly removing the old one.

-- 
Janek Kozicki

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From cosurgi at mail.berlios.de  Wed Nov 26 21:36:08 2008
From: cosurgi at mail.berlios.de (cosurgi at BerliOS)
Date: Wed, 26 Nov 2008 21:36:08 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1585 - in trunk/pkg/snow: .
	RenderingEngine
Message-ID: <200811262036.mAQKa8rr029586@sheep.berlios.de>

Author: cosurgi
Date: 2008-11-26 21:36:08 +0100 (Wed, 26 Nov 2008)
New Revision: 1585

Added:
   trunk/pkg/snow/RenderingEngine/
   trunk/pkg/snow/RenderingEngine/Ef1_BshSnowGrain_glDraw.cpp
   trunk/pkg/snow/RenderingEngine/Ef1_BshSnowGrain_glDraw.hpp
Log:
forgot some files



Added: trunk/pkg/snow/RenderingEngine/Ef1_BshSnowGrain_glDraw.cpp
===================================================================
--- trunk/pkg/snow/RenderingEngine/Ef1_BshSnowGrain_glDraw.cpp	2008-11-26 20:10:06 UTC (rev 1584)
+++ trunk/pkg/snow/RenderingEngine/Ef1_BshSnowGrain_glDraw.cpp	2008-11-26 20:36:08 UTC (rev 1585)
@@ -0,0 +1,97 @@
+/*************************************************************************
+*  Copyright (C) 2008 by Janek Kozicki                                   *
+*  cosurgi at berlios.de                                                    *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#include"Ef1_BshSnowGrain_glDraw.hpp"
+#include<yade/pkg-snow/BshSnowGrain.hpp>
+#include<yade/lib-opengl/OpenGLWrapper.hpp>
+
+
+void Ef1_BshSnowGrain_glDraw::go(const shared_ptr<GeometricalModel>& gm, const shared_ptr<PhysicalParameters>&,bool wire)
+{
+	bool surface = !wire;
+	BshSnowGrain* gr = static_cast<BshSnowGrain*>(gm.get());
+	Real LEN=(gr->start - gr->end).Length();
+
+//	glTranslatef(gr->center[0],gr->center[1],gr->center[2]);
+	glColor3f(0.5,0.5,1.0);
+	glutSolidCube(LEN*0.1);
+	glTranslatef(-gr->center[0],-gr->center[1],-gr->center[2]);
+
+  	glMaterialv(GL_FRONT, GL_AMBIENT_AND_DIFFUSE, Vector3f(gm->diffuseColor[0],gm->diffuseColor[1],gm->diffuseColor[2]));
+	glColor3v(gm->diffuseColor);
+
+//	std::cerr << gr->slices.size() << " ===========  \n";
+
+	if(surface)
+	{
+		glDisable(GL_CULL_FACE);
+		glEnable(GL_LIGHTING);
+		//glShadeModel(GL_SMOOTH);
+		//glColor3f(gr->color[0],gr->color[1],gr->color[2]);
+		for(int i=0;i<gr->slices.size()-1;++i)
+		{
+			glBegin(GL_QUAD_STRIP);
+				for(int j=0;j<gr->slices[i].size()-1;++j)
+				{
+					Vector3r n=1.0*((gr->slices[i  ][j] - gr->slices[i+1][j]).Cross(gr->slices[i  ][j+1] - gr->slices[i][j]));
+					n.Normalize();
+					glNormal3f(n[0],n[1],n[2]);
+
+					glVertex3d(gr->slices[i  ][j][0],gr->slices[i  ][j][1],gr->slices[i  ][j][2]);
+					glVertex3d(gr->slices[i+1][j][0],gr->slices[i+1][j][1],gr->slices[i+1][j][2]);
+				}
+				glVertex3d(gr->slices[i  ][0][0],gr->slices[i  ][0][1],gr->slices[i  ][0][2]);
+				glVertex3d(gr->slices[i+1][0][0],gr->slices[i+1][0][1],gr->slices[i+1][0][2]);
+			glEnd();
+		}
+		glEnable(GL_CULL_FACE);
+	}
+	else
+	{
+		glDisable(GL_LIGHTING);
+		glBegin(GL_LINE_STRIP);
+			glColor3f(0,0,0);
+			glVertex3d(gr->start[0],gr->start[1],gr->start[2]);
+			glVertex3d(gr->end[0]  ,gr->end[1]  ,gr->end[2]);
+		glEnd();
+			glColor3v(gm->diffuseColor);
+			for(int i=0;i < gr->slices.size();++i)
+			{
+				glBegin(GL_LINE_STRIP);
+					for(int j=0 ; j < gr->slices[i].size() ; ++j)
+						glVertex3d(gr->slices[i][j][0],gr->slices[i][j][1],gr->slices[i][j][2]);
+					glVertex3d(gr->slices[i][0][0],gr->slices[i][0][1],gr->slices[i][0][2]);
+				glEnd();
+			}
+		glEnable(GL_LIGHTING);
+	}
+	glTranslatef(gr->center[0],gr->center[1],gr->center[2]);
+/*	// FIXME : check that : one of those 2 lines are useless
+  	glMaterialv(GL_FRONT, GL_AMBIENT_AND_DIFFUSE, Vector3f(gm->diffuseColor[0],gm->diffuseColor[1],gm->diffuseColor[2]));
+	glColor3v(gm->diffuseColor);
+	
+	Vector3r &extents = (static_cast<Box*>(gm.get()))->extents;
+	
+	glScalef(2*extents[0],2*extents[1],2*extents[2]);
+
+	if (gm->wire || wire)
+	{
+		glDisable(GL_LIGHTING);
+		glutWireCube(1);
+	}
+	else
+	{
+		glEnable(GL_LIGHTING);
+		glutSolidCube(1);
+	}
+*/
+}
+
+
+YADE_PLUGIN();
+

Added: trunk/pkg/snow/RenderingEngine/Ef1_BshSnowGrain_glDraw.hpp
===================================================================
--- trunk/pkg/snow/RenderingEngine/Ef1_BshSnowGrain_glDraw.hpp	2008-11-26 20:10:06 UTC (rev 1584)
+++ trunk/pkg/snow/RenderingEngine/Ef1_BshSnowGrain_glDraw.hpp	2008-11-26 20:36:08 UTC (rev 1585)
@@ -0,0 +1,24 @@
+/*************************************************************************
+*  Copyright (C) 2008 by Janek Kozicki                                   *
+*  cosurgi at berlios.de                                                    *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#pragma once
+
+#include<yade/pkg-common/GLDrawFunctors.hpp>
+
+class Ef1_BshSnowGrain_glDraw : public GLDrawGeometricalModelFunctor
+{
+	public :
+		virtual void go(const shared_ptr<GeometricalModel>&, const shared_ptr<PhysicalParameters>&,bool);
+
+	RENDERS(BshSnowGrain);
+	REGISTER_CLASS_NAME(Ef1_BshSnowGrain_glDraw);
+	REGISTER_BASE_CLASS_NAME(GLDrawGeometricalModelFunctor);
+};
+
+REGISTER_SERIALIZABLE(Ef1_BshSnowGrain_glDraw);
+


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Wed Nov 26 23:12:56 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 26 Nov 2008 23:12:56 +0100
Subject: [deprecated list] [Yade-dev] commit 1583, 3d view,
	serialization.
In-Reply-To: <20081126210838.33476551@szpak>
References: <20081126210838.33476551@szpak>
Message-ID: <492DC9E8.8080503@arcig.cz>


> After you commit, the "primary view" window is empty (draws nothing),
> but when I click "New 3D" view - the new window draws everything as
> it should. Can you fix that?
>   
I am not aware of changing anything related to the 3d view lately. Can
you precise?
> In my commit 1584 I'm adding some snow-related stuff. It's my files
> that I have been developing as a separate code in the past. That code
> is using boost::serialization. So I guess that this is time for
> adding to yade a dependency on boost serialiaztion (unless you
> exclude='snow'). I think that actually having "twice" serialization
> in whole yade isn't too difficult to add. Look at how I'm using it in
> my files, and you can start adding it too in other files.... if you want.
>   
Hmmm... I don't have exactly time to do that, but I will study your
code, it can surely be interesting.

There is more things I would like to change in yade globally (besides
serialization), so I think I will try to develop a working prototype
from scratch (using existing classes here and there). What I would like
to address specifically is:

1. Use shared_ptr only if necessary, it has some performance penalties.
It would be enough if the owner (Body, Interaction, ...) used auto_ptr
to avoid leaks. If the owned object is used after the owner has been
destroyed (which is OK with shared_ptr, but will crash with auto_ptr),
it is a bug anyway.
2. Better and faster python support, be it through py++ wrapper or other
option, but _not_ by using conversions from and to strings.
3. Better serialization, if possible automatically getting attributes to
save (needs reflection - for example reflex library from CERN's root; if
we have that, most macros in class declarations can be avoided).
4. Experiment with multimethods, if it would not be faster to have
hardwired if/else if/else if/... clauses for a few combinations rather
than completely generic solution. I know it defeats genericity, but it
is a compromise to consider.
5. Experiment with pluginless build and whether plugins should be
supported. The current state is that I know of exactly 0 cases that
external plugin was built and used with yade compiled elsewhere. (oofem,
for example, is a single binary, and is still very modular)
6. Use some neat features from c++0x (future; g++ doesn't support those
as of now)
7. Use new (or better than those new) class names, have less files, less
management code, more real code that does something.

My time is constrained, though, those are just a few ideas about things
that I find frustrating at times.

Regards, Vaclav

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Wed Nov 26 23:14:15 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Wed, 26 Nov 2008 23:14:15 +0100
Subject: [deprecated list] [Yade-dev] commit 1583, 3d view,
	serialization.
In-Reply-To: <20081126210838.33476551@szpak>
References: <20081126210838.33476551@szpak>
Message-ID: <492DCA37.1020102@arcig.cz>

For the dependency on boost::serialization, I don't have a problem with
that. It's been a part of boost since quite some time and we depend on
many parts of boost already, so this is no additional burden IMHO.


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Thu Nov 27 00:21:31 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Thu, 27 Nov 2008 00:21:31 +0100
Subject: [deprecated list] [Yade-dev] commit 1583, 3d view,
	serialization.
In-Reply-To: <492DC9E8.8080503@arcig.cz>
References: <20081126210838.33476551@szpak>
	<492DC9E8.8080503@arcig.cz>
Message-ID: <20081127002131.652f42cd@szpak>

V?clav S(milauer said:     (by the date of Wed, 26 Nov 2008 23:12:56 +0100)

> 
> > After you commit, the "primary view" window is empty (draws nothing),
> > but when I click "New 3D" view - the new window draws everything as
> > it should. Can you fix that?
> >   
> I am not aware of changing anything related to the 3d view lately. Can
> you precise?

Well, I'm sure that it happened only after I did 'svn up', and see
commit history. I did svn up from my 1582 to your 1583. It's not too
annoying though, it's enough if I close the automatically opened
3dview and reopen a new one.

And (of course) it' doesn't happen always. But it never happened
before. To reproduce this, just start GUI, generate something and let
it automatically open the controller. The 3dview will be empty. Even
'a','g' will not work for toggling axis/grid.



> There is more things I would like to change in yade globally (besides
> serialization), so I think I will try to develop a working prototype
> from scratch (using existing classes here and there). 

yes, this is exactly what sometimes I dream about doing. But I don't
think I'll ever have time for that.....


> What I would like
> to address specifically is:
> 
> 1. Use shared_ptr only if necessary, it has some performance penalties.
> It would be enough if the owner (Body, Interaction, ...) used auto_ptr
> to avoid leaks. If the owned object is used after the owner has been
> destroyed (which is OK with shared_ptr, but will crash with auto_ptr),
> it is a bug anyway.
> 2. Better and faster python support, be it through py++ wrapper or other
> option, but _not_ by using conversions from and to strings.
> 3. Better serialization, if possible automatically getting attributes to
> save (needs reflection - for example reflex library from CERN's root; if
> we have that, most macros in class declarations can be avoided).
> 4. Experiment with multimethods, if it would not be faster to have
> hardwired if/else if/else if/... clauses for a few combinations rather
> than completely generic solution. I know it defeats genericity, but it
> is a compromise to consider.
> 5. Experiment with pluginless build and whether plugins should be
> supported. The current state is that I know of exactly 0 cases that
> external plugin was built and used with yade compiled elsewhere. (oofem,
> for example, is a single binary, and is still very modular)
> 6. Use some neat features from c++0x (future; g++ doesn't support those
> as of now)
> 7. Use new (or better than those new) class names, have less files, less
> management code, more real code that does something.


your ideas are good. Almost each of them is a great deal of work.

I can tell you that multimethods won't get faster with your approach.
Linear access time to read a function pointer in a table *is* a
linear time. With if/else you are getting logarithmic time. If
logarithmic time is faster than linear in case if there are only a
few choices - honestly I don't know. But it's not worth the effort to
check that. So that one I'd skip.

But if you want to try that anyway, there's an exact copy/paste
implementation of that in "Modern C++ Design" book by Andrei
Alexandrescu.


-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Thu Nov 27 01:34:18 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Thu, 27 Nov 2008 01:34:18 +0100
Subject: [deprecated list] [Yade-dev] commit 1583, 3d view,
	serialization.
In-Reply-To: <20081127002131.652f42cd@szpak>
References: <20081126210838.33476551@szpak> <492DC9E8.8080503@arcig.cz>
	<20081127002131.652f42cd@szpak>
Message-ID: <20081127013418.522d1cc7@szpak>

> > 5. Experiment with pluginless build and whether plugins should be
> > supported. The current state is that I know of exactly 0 cases that
> > external plugin was built and used with yade compiled elsewhere. (oofem,
> > for example, is a single binary, and is still very modular)

I'm all in favour of this. The link time will increase considerably,
but we will have no more constraints on using templates. Which can
speed up calculations considerably.

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From richefeu at geo.hmg.inpg.fr  Thu Nov 27 10:25:08 2008
From: richefeu at geo.hmg.inpg.fr (Vincent Richefeu)
Date: Thu, 27 Nov 2008 10:25:08 +0100
Subject: [deprecated list] [Yade-dev] Fwd: inherited PhysicalParameters
	for	InteractionPhysicsEngineUnit
References: <00E1C5C0-9FB3-4F9E-918F-B4D6E4D4613D@geo.hmg.inpg.fr>
Message-ID: <515DB602-882C-4540-96AD-9877D5AC672E@geo.hmg.inpg.fr>

>>>


UP ?


>>> I've got a problem with 'SimpleViscoelasticRelationships'. This
>>> 2d-functor needs 2 'PhysicalParameters' that are casted into
>>> 'SimpleViscoelasticBodyParameters' in the method 'go'.
>>>
>>> I want to use BcpConnection that inherit from
>>> SimpleViscoelasticBodyParameters for one of the parameters.
>>> The problem is that call 'SimpleViscoelasticRelationships::go' fail
>>> (before entering the function).
>>> I've got the following message:
>>>
>>> terminate called after throwing an instance of 'std::runtime_error'
>>>   what():  DynLibDispatcher: ambiguous or undefined dispatch for 2d
>>> multivirtual function, classes: SimpleViscoelasticBodyParameters
>>> BcpConnection
>>>
>>
>> You need own 2d-functor "*Relationships" for your  
>> PhysicalParameters (BcpConnection).
>> SimpleViscoelasticRelationships only for  
>> SimpleViscoelasticBodyParameters,
>> see line 29 in SimpleViscoelasticRelationships.hpp:
>>
>> FUNCTOR2D 
>> (SimpleViscoelasticBodyParameters,SimpleViscoelasticBodyParameters);
>>
>> It calculate InteractionPhysics (SimpleViscoelasticInteraction) from
>> PhysicalParameters of contacting bodys.
>>
>> So, if you have own PhysicalParameters, you need own Relationships  
>> for calculating InteractionPhysics from this parameters. (or you  
>> can modify exant classes with take care of their default behavior  
>> without changes)...
>>
>
> Thank for your answer Sega,
>
> There is still something boring:
> as I said, BcpConnection IS a SimpleViscoelasticBodyParameters.
> If I write my own functor, it will do exactly the same job as  
> SimpleViscoelasticRelationships !
> Besides, casting BcpConnection into  
> SimpleViscoelasticBodyParameters is possible
> without any problem. Maybe the 'problem' come from the  
> DynLibDispatcher?
>
> Vincent


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Sun Nov 30 12:42:22 2008
From: eudoxos at arcig.cz (Vaclav Smilauer)
Date: Sun, 30 Nov 2008 12:42:22 +0100 (CET)
Subject: [deprecated list] [Yade-dev] [robot] build failed
Message-ID: <20081130114223.2C67E98086@delta>

Compiling current svn failed, log is http://beta.arcig.cz/~eudoxos/yade/testlog-20081130:1235.fail.bz2

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Sun Nov 30 16:37:50 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Sun, 30 Nov 2008 16:37:50 +0100
Subject: [deprecated list] [Yade-dev] [robot] build failed
In-Reply-To: <20081130114223.2C67E98086@delta>
References: <20081130114223.2C67E98086@delta>
Message-ID: <20081130163750.60ef511b@szpak>

Vaclav Smilauer said:     (by the date of Sun, 30 Nov 2008 12:42:22 +0100 (CET))

> Compiling current svn failed, log is http://beta.arcig.cz/~eudoxos/yade/testlog-20081130:1235.fail.bz2

I'm using there boost::threads from 1.35 which has more features than
1.34. I that critical? Maybe I can comment that out, and make that code dead.

-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Sun Nov 30 22:49:29 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Sun, 30 Nov 2008 22:49:29 +0100
Subject: [deprecated list] [Yade-dev] [robot] build failed
In-Reply-To: <20081130163750.60ef511b@szpak>
References: <20081130114223.2C67E98086@delta> <20081130163750.60ef511b@szpak>
Message-ID: <49330A69.4010906@arcig.cz>


>> Compiling current svn failed, log is http://beta.arcig.cz/~eudoxos/yade/testlog-20081130:1235.fail.bz2
>>     
>
> I'm using there boost::threads from 1.35 which has more features than
> 1.34. I that critical? Maybe I can comment that out, and make that code dead.
>   
Most users, AFAIK, are on Ubuntu, which has 1.34 and it is the case also
for me and the machine running the build robot. I would suggest that you
put it in #if BOOST_VERSION>=1.35 (you know what I mean), to not break
the functionality for you at least. Regards, Vaclav


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Mon Dec  1 20:47:19 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Mon, 1 Dec 2008 20:47:19 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1587 - in trunk: extra
	extra/usct gui/py	pkg/common
	pkg/common/Engine/DeusExMachina	pkg/common/Engine/StandAloneEngine
	scripts scripts/test
Message-ID: <200812011947.mB1JlJU8002448@sheep.berlios.de>

Author: eudoxos
Date: 2008-12-01 20:47:18 +0100 (Mon, 01 Dec 2008)
New Revision: 1587

Added:
   trunk/pkg/common/Engine/DeusExMachina/Se3Interpolator.cpp
   trunk/pkg/common/Engine/DeusExMachina/Se3Interpolator.hpp
   trunk/scripts/test/
   trunk/scripts/test/Se3Interpolator.py
Modified:
   trunk/extra/Brefcom.cpp
   trunk/extra/usct/UniaxialStrainControlledTest.cpp
   trunk/extra/usct/UniaxialStrainControlledTest.hpp
   trunk/gui/py/PythonUI_rc.py
   trunk/pkg/common/Engine/StandAloneEngine/PeriodicEngines.hpp
   trunk/pkg/common/Engine/StandAloneEngine/ResetPositionEngine.cpp
   trunk/pkg/common/SConscript
Log:
1. Added Se3Interpolator engine, with scripts/test/Se3Interpolator.py
2. Added from math import * to PythonUI_rc.py so that math functions are readily accessible everywhere
3. Implemented stopStrain in UniaxialStrainControlledTest
4. other small fixes


Modified: trunk/extra/Brefcom.cpp
===================================================================
--- trunk/extra/Brefcom.cpp	2008-11-27 08:32:53 UTC (rev 1586)
+++ trunk/extra/Brefcom.cpp	2008-12-01 19:47:18 UTC (rev 1587)
@@ -156,6 +156,7 @@
 
 		epsN=contGeom->epsN();
 		epsT=contGeom->epsT();
+		//if(I->getId1()==0 && (Omega::instance().getCurrentIteration()%10==0)) LOG_INFO("##"<<I->getId1()<<"+"<<I->getId2()<<": "<<" dist2-1="<<(contGeom->pos1-contGeom->pos2).Length()-1.<<", d0="<<contGeom->d0<<", epsN="<<epsN<<", |epsT|="<<epsT.Length());
 
 		#ifdef BREFCOM_MATERIAL_MODEL
 			BREFCOM_MATERIAL_MODEL

Modified: trunk/extra/usct/UniaxialStrainControlledTest.cpp
===================================================================
--- trunk/extra/usct/UniaxialStrainControlledTest.cpp	2008-11-27 08:32:53 UTC (rev 1586)
+++ trunk/extra/usct/UniaxialStrainControlledTest.cpp	2008-12-01 19:47:18 UTC (rev 1587)
@@ -84,8 +84,19 @@
 	if(posIds.size()==0 || negIds.size()==0) return;
 	// linearly increase strain to the desired value
 	if(abs(currentStrainRate)<abs(strainRate))currentStrainRate+=strainRate*.005; else currentStrainRate=strainRate;
-	// how much do we move; in the symmetric case, half of the strain is applied at each end;
-	Real dAX=(asymmetry==0?.5:1)*currentStrainRate*originalLength*Omega::instance().getTimeStep();
+	// how much do we move (in total, symmetry handled below)
+	Real dAX=currentStrainRate*originalLength*Omega::instance().getTimeStep();
+	if(!isnan(stopStrain)){
+		Real axialLength=axisCoord(posIds[0])-axisCoord(negIds[0]);
+		Real newStrain=(axialLength+dAX)/originalLength-1;
+		if((newStrain*stopStrain>0) && abs(newStrain)>=stopStrain){ // same sign of newStrain and stopStrain && over the limit from below in abs values
+			dAX=originalLength*(stopStrain+1)-axialLength;
+			LOG_INFO("Reached stopStrain "<<stopStrain<<", deactivating self and stopping in "<<idleIterations+1<<" iterations.");
+			this->active=false;
+			rootBody->stopAtIteration=Omega::instance().getCurrentIteration()+1+idleIterations;
+		}
+	}
+	if(asymmetry==0) dAX*=.5; // apply half on both sides if straining symetrically
 	for(size_t i=0; i<negIds.size(); i++){
 		if(asymmetry==0 || asymmetry==-1 /* for +1, don't move*/) negCoords[i]-=dAX;
 		axisCoord(negIds[i])=negCoords[i]; // update current position
@@ -102,9 +113,6 @@
 	// reverse if we're over the limit strain
 	if(notYetReversed && limitStrain!=0 && ((currentStrainRate>0 && strain>limitStrain) || (currentStrainRate<0 && strain<limitStrain))) { currentStrainRate*=-1; notYetReversed=false; LOG_INFO("Reversed strain rate to "<<currentStrainRate); }
 
-	// if(strain==stopAtStrain){LOG_INFO("Prescibed strain "<<stopAtStrain<<" reached, pausing."); }
-	if(!isnan(stopAtStrain) && ((strain*stopAtStrain>0) && abs(strain)>abs(stopAtStrain))) { strain=stopAtStrain;	rootBody->stopAtIteration=Omega::instance().getCurrentIteration()+2; LOG_INFO("Prescribed strain "<<stopAtStrain<<" reached, will stop in 2 iterations"); }
-
 	if(Omega::instance().getCurrentIteration()%10==0 ) {
 		computeAxialForce(rootBody);
 		#if 0
@@ -297,12 +305,6 @@
 
 	rootBody->engines.push_back(shared_ptr<BrefcomDamageColorizer>(new BrefcomDamageColorizer));
 
-	shared_ptr<PositionOrientationRecorder> por(new PositionOrientationRecorder);
-	por->outputFile="/tmp/usct-traction";
-	por->interval=300;
-	por->saveRgb=true;
-	rootBody->engines.push_back(por);
-
 }
 
 

Modified: trunk/extra/usct/UniaxialStrainControlledTest.hpp
===================================================================
--- trunk/extra/usct/UniaxialStrainControlledTest.hpp	2008-11-27 08:32:53 UTC (rev 1586)
+++ trunk/extra/usct/UniaxialStrainControlledTest.hpp	2008-12-01 19:47:18 UTC (rev 1587)
@@ -80,9 +80,10 @@
 		Real& axisCoord(body_id_t id){ return Body::byId(id)->physicalParameters->se3.position[axis]; };
 		void init();
 	public:
+		virtual bool isActivated(){return active;}
 		Real strainRate,currentStrainRate;
 		//! strain at which we will pause simulation; inactive (nan) by default; must be reached from below (in absolute value)
-		Real stopAtStrain;
+		Real stopStrain;
 		//! distance of reference bodies in the direction of axis before straining started
 		Real originalLength;
 		vector<Real> originalWidths;
@@ -100,6 +101,10 @@
 		bool blockDisplacements;
 		//! Whether rotations of boundary bodies are blocked.
 		bool blockRotations;
+		//! Are we activated?
+		bool active;
+		//! Number of iterations that will pass without straining activity after stopStrain has been reached (default: 0)
+		long idleIterations;
 
 		/** bodies on which straining will be applied (on the positive and negative side of axis) */
 		vector<body_id_t> posIds, negIds;
@@ -126,11 +131,13 @@
 		Real strain, avgStress;
 
 		virtual void applyCondition(MetaBody* rootBody);
-		UniaxialStrainer(){axis=2; asymmetry=0; currentStrainRate=0; originalLength=-1; limitStrain=0; notYetReversed=true; crossSectionArea=-1; needsInit=true; /* sensorsPusher=shared_ptr<UniaxialStrainSensorPusher>(); */ recordFile="/tmp/usct.data"; strain=avgStress=/*avgTransStrain=*/0; blockRotations=false; blockDisplacements=false;  stopAtStrain=numeric_limits<Real>::quiet_NaN();};
+		UniaxialStrainer(){axis=2; asymmetry=0; currentStrainRate=0; originalLength=-1; limitStrain=0; notYetReversed=true; crossSectionArea=-1; needsInit=true; /* sensorsPusher=shared_ptr<UniaxialStrainSensorPusher>(); */ recordFile="/tmp/usct.data"; strain=avgStress=/*avgTransStrain=*/0; blockRotations=false; blockDisplacements=false;  stopStrain=numeric_limits<Real>::quiet_NaN(); active=true; idleIterations=0; };
 		virtual ~UniaxialStrainer(){};
 		REGISTER_ATTRIBUTES_WITH_BASE(DeusExMachina,
 				(strainRate) 
-				(stopAtStrain) 
+				(stopStrain) 
+				(active)
+				(idleIterations)
 				(currentStrainRate) 
 				(axis) 
 				(asymmetry) 

Modified: trunk/gui/py/PythonUI_rc.py
===================================================================
--- trunk/gui/py/PythonUI_rc.py	2008-11-27 08:32:53 UTC (rev 1586)
+++ trunk/gui/py/PythonUI_rc.py	2008-12-01 19:47:18 UTC (rev 1587)
@@ -7,6 +7,7 @@
 sys.excepthook=sys.__excepthook__ # apport on ubuntu overrides this, we don't need it
 # sys.path.insert(0,runtime.prefix+'/lib/yade'+runtime.suffix+'/extra')
 
+from math import *
 from yade.wrapper import *
 from yade import runtime
 from yade import utils

Added: trunk/pkg/common/Engine/DeusExMachina/Se3Interpolator.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/Se3Interpolator.cpp	2008-11-27 08:32:53 UTC (rev 1586)
+++ trunk/pkg/common/Engine/DeusExMachina/Se3Interpolator.cpp	2008-12-01 19:47:18 UTC (rev 1587)
@@ -0,0 +1,37 @@
+
+#include"Se3Interpolator.hpp"
+#include<yade/pkg-common/PeriodicEngines.hpp>
+
+YADE_PLUGIN("Se3Interpolator")
+CREATE_LOGGER(Se3Interpolator);
+
+void Se3Interpolator::applyCondition(MetaBody* mb){
+	assert(subscribedBodies.size()==1);
+	const shared_ptr<Body>&b=Body::byId(subscribedBodies[0],mb);
+	Omega& O=Omega::instance();
+	if(!started){
+		started=true;
+		start=b->physicalParameters->se3;
+		if(rotRelative) goal.orientation=goal.orientation*start.orientation;
+		int numGoalEndpoints=0;
+		if(goalVirt>0){startVirt=O.getSimulationTime(); numGoalEndpoints++;}
+		if(goalReal>0){startReal=PeriodicEngine::getClock(); numGoalEndpoints++;}
+		if(goalIter>0){startIter=O.getCurrentIteration(); numGoalEndpoints++;}
+		assert(numGoalEndpoints==1);
+		LOG_DEBUG("Init'ed.");
+	}
+	Real t=-1; // t?[0,1]
+	if(goalVirt>0) t=(O.getSimulationTime()-startVirt)/(goalVirt-startVirt);
+	if(goalReal>0) t=(PeriodicEngine::getClock()-startReal)/(goalReal-startReal);
+	if(goalIter>0) t=(O.getCurrentIteration()-startIter)/(goalIter-startIter);
+	assert(t>=0);
+	LOG_DEBUG("t="<<t);
+	t=min(t,1.);
+	b->physicalParameters->se3.position=start.position+t*(goal.position-start.position);
+	b->physicalParameters->se3.orientation=Quaternionr().Slerp(t,start.orientation,goal.orientation);
+	if(t>=1.){
+		done=true;
+		LOG_DEBUG("Goal reached.");
+		if(!goalHook.empty()){ PyGILState_STATE gstate; gstate=PyGILState_Ensure(); PyRun_SimpleString(goalHook.c_str()); PyGILState_Release(gstate); }
+	}
+}

Added: trunk/pkg/common/Engine/DeusExMachina/Se3Interpolator.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/Se3Interpolator.hpp	2008-11-27 08:32:53 UTC (rev 1586)
+++ trunk/pkg/common/Engine/DeusExMachina/Se3Interpolator.hpp	2008-12-01 19:47:18 UTC (rev 1587)
@@ -0,0 +1,60 @@
+// 2008 ? V?clav ?milauer <eudoxos at arcig.cz> 
+#pragma once
+
+#include<yade/core/DeusExMachina.hpp>
+#include<yade/core/PhysicalParameters.hpp>
+#include<yade/pkg-common/RigidBodyParameters.hpp>
+#include<Python.h>
+
+/* Engine interpolating between starting (current) and goal (given) se3, both position and orientation.
+ *
+ * The interpolation is linear, either in iteration space or (real/virtual) time space.
+ *
+ * A given python code can be executed when the ending se3 is reached and the engine deactivates itself.
+ *
+ * Note that eactly one body must be subscribed to this engine, since interpolating positions
+ * on multiple bodies is meaningless.
+ *
+ * Attributes that should be assigned:
+ * 	subscribedBodies (exactly one)
+ * 	goal (7-tuple of position and orientation)
+ * 	startVirt XOR startReal XOR startIter (at what time point to start)
+ * 	goalVirt XOR goalReal XOR goalIter (at what time point to reach desired se3)
+ * 	goalHook (optional: python command to be run when finished)
+ * 	rotRelative (optional: rotation part of goal is relative to the rotation at the beginning)
+ */
+class Se3Interpolator: public DeusExMachina {
+	public:
+		bool done,started;
+		Se3r start;
+		Se3r goal;
+		bool rotRelative;
+		Real goalVirt, goalReal; long goalIter;
+		long startVirt, startReal; long startIter;
+		string goalHook;
+		virtual bool isActivated(){return !done;}
+		Se3Interpolator(): done(false), started(false), rotRelative(false), goalVirt(0), goalReal(0), goalIter(0) {};
+		virtual ~Se3Interpolator(){};
+		virtual void applyCondition(MetaBody* mb);
+	protected:
+		REGISTER_ATTRIBUTES_WITH_BASE(DeusExMachina,
+			(done)
+			(started)
+			(start)
+			(goal)
+			(rotRelative)
+			(goalVirt)
+			(goalReal)
+			(goalIter)
+			(startVirt)
+			(startReal)
+			(startIter)
+			(goalHook)
+		);
+		REGISTER_CLASS_AND_BASE(Se3Interpolator,DeusExMachina);
+		DECLARE_LOGGER;
+};
+REGISTER_SERIALIZABLE(Se3Interpolator);
+	
+
+

Modified: trunk/pkg/common/Engine/StandAloneEngine/PeriodicEngines.hpp
===================================================================
--- trunk/pkg/common/Engine/StandAloneEngine/PeriodicEngines.hpp	2008-11-27 08:32:53 UTC (rev 1586)
+++ trunk/pkg/common/Engine/StandAloneEngine/PeriodicEngines.hpp	2008-12-01 19:47:18 UTC (rev 1587)
@@ -11,9 +11,8 @@
  * the number of activations was already reached, no action will be called even if any of active period has elapsed.
  */
 class PeriodicEngine:  public StandAloneEngine {
-	protected:
-		static Real getClock(){ timeval tp; gettimeofday(&tp,NULL); return tp.tv_sec+tp.tv_usec/1e6; }
 	public:
+		static Real getClock(){ timeval tp; gettimeofday(&tp,NULL); return tp.tv_sec+tp.tv_usec/1e6; }
 		Real virtPeriod, virtLast, realPeriod, realLast; long iterPeriod,iterLast,nDo,nDone;
 		PeriodicEngine(): virtPeriod(0),virtLast(0),realPeriod(0),realLast(0),iterPeriod(0),iterLast(0),nDo(-1),nDone(0) { realLast=getClock(); }
 		virtual bool isActivated(){

Modified: trunk/pkg/common/Engine/StandAloneEngine/ResetPositionEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/StandAloneEngine/ResetPositionEngine.cpp	2008-11-27 08:32:53 UTC (rev 1586)
+++ trunk/pkg/common/Engine/StandAloneEngine/ResetPositionEngine.cpp	2008-12-01 19:47:18 UTC (rev 1587)
@@ -8,7 +8,7 @@
 
 #include"ResetPositionEngine.hpp"
 #include<yade/core/MetaBody.hpp>
-#include<yade/pkg-common/ParticleParameters.hpp>#include<yade/pkg-common/ParticleParameters.hpp>
+#include<yade/pkg-common/ParticleParameters.hpp>
 #include<boost/foreach.hpp>
 
 CREATE_LOGGER(ResetPositionEngine);

Modified: trunk/pkg/common/SConscript
===================================================================
--- trunk/pkg/common/SConscript	2008-11-27 08:32:53 UTC (rev 1586)
+++ trunk/pkg/common/SConscript	2008-12-01 19:47:18 UTC (rev 1587)
@@ -55,8 +55,8 @@
 		LIBS=env['LIBS']+['Force','ParticleParameters']),
 	env.SharedLibrary('GravityEngines',['Engine/DeusExMachina/GravityEngines.cpp'],
 		LIBS=env['LIBS']+['Force','ParticleParameters']),
-	env.SharedLibrary('JumpChangeSe3',['Engine/DeusExMachina/JumpChangeSe3.cpp'],
-		LIBS=env['LIBS']+['RigidBodyParameters']),
+	env.SharedLibrary('JumpChangeSe3',['Engine/DeusExMachina/JumpChangeSe3.cpp'], LIBS=env['LIBS']+['RigidBodyParameters']),
+	env.SharedLibrary('Se3Interpolator',['Engine/DeusExMachina/Se3Interpolator.cpp'], LIBS=env['LIBS']+['RigidBodyParameters']),
 	env.SharedLibrary('RotationEngine',['Engine/DeusExMachina/RotationEngine.cpp'],
 		LIBS=env['LIBS']+['ParticleParameters','RigidBodyParameters']),
 	env.SharedLibrary('TranslationEngine',['Engine/DeusExMachina/TranslationEngine.cpp'],

Added: trunk/scripts/test/Se3Interpolator.py
===================================================================
--- trunk/scripts/test/Se3Interpolator.py	2008-11-27 08:32:53 UTC (rev 1586)
+++ trunk/scripts/test/Se3Interpolator.py	2008-12-01 19:47:18 UTC (rev 1587)
@@ -0,0 +1,14 @@
+# default parameters or from table
+# encoding: utf-8
+O.bodies.append([
+	utils.sphere([0,0,0],radius=.5),
+])
+
+O.engines=[
+	DeusExMachina('Se3Interpolator',{'subscribedBodies':[0],'goal':[10,10,0,0,0,1,pi],'startIter':10,'goalIter':1010,'goalHook':'print "Finished moving the thing!"; O.pause()'}),
+]
+O.dt=1e-6
+print 'Initial se3:',O.bodies[0].phys['se3']
+#O.saveTmp('init'); O.run(); O.wait();
+#print 'Final   se3:',O.bodies[0].phys['se3']
+#quit()


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From cosurgi at mail.berlios.de  Tue Dec  2 08:18:19 2008
From: cosurgi at mail.berlios.de (cosurgi at BerliOS)
Date: Tue, 2 Dec 2008 08:18:19 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1589 -
	trunk/pkg/snow/PreProcessor/Voxel
Message-ID: <200812020718.mB27IJmF004416@sheep.berlios.de>

Author: cosurgi
Date: 2008-12-02 08:18:18 +0100 (Tue, 02 Dec 2008)
New Revision: 1589

Modified:
   trunk/pkg/snow/PreProcessor/Voxel/SafeVectors3.hpp
Log:
- another fix. now it really compiles with boost 1.34



Modified: trunk/pkg/snow/PreProcessor/Voxel/SafeVectors3.hpp
===================================================================
--- trunk/pkg/snow/PreProcessor/Voxel/SafeVectors3.hpp	2008-12-02 06:53:57 UTC (rev 1588)
+++ trunk/pkg/snow/PreProcessor/Voxel/SafeVectors3.hpp	2008-12-02 07:18:18 UTC (rev 1589)
@@ -6,7 +6,7 @@
 #include<vector>
 #include<boost/archive/binary_oarchive.hpp>
 #include<boost/archive/binary_iarchive.hpp>
-#include<boost/serialization/vector.hpp>
+//#include<boost/serialization/vector.hpp>
 
 class SafeVectors3
 {


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Sun Dec  7 00:12:09 2008
From: eudoxos at arcig.cz (eudoxos at arcig.cz)
Date: Sun,  7 Dec 2008 00:12:09 +0100 (CET)
Subject: [deprecated list] [Yade-dev] Automated crash report
	for	/tmp/yade-6982/bin/yade-svn1593:	DirectShearCis, FEMBeam,
	HydraulicTest, SDECImpactTest, STLImporterTest, SimpleShear,
	SnowVoxelsLoader, USCTGen
Message-ID: <20081206231209.AC9169806A@delta>

################################################################################
DirectShearCis: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `eaycks'
Running script /tmp/yade-test-14516.py
Cannot find input file
Traceback (most recent call last):
  File "/tmp/yade-6982/lib/yade-svn1593/gui/PythonUI_rc.py", line 41, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-14516.py", line 3, in <module>
    Preprocessor('DirectShearCis').generate('/tmp/yade-test-14516.xml')
RuntimeError: Generator reported error: Cannot find input file

################################################################################
FEMBeam: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `sdkcye'
Running script /tmp/yade-test-14516.py
/tmp/yade-6982/build-svn1593/include/yade-svn1593/yade/core/MetaEngine1D.hpp:57 WARNING! dynamic cast of engine unit FEMTetrahedronStiffness failed, will use static_cast. Go figure why.
/tmp/yade-6982/build-svn1593/include/yade-svn1593/yade/core/MetaEngine2D.hpp:61 WARNING! dynamic cast of engine unit FEMSet2Tetrahedrons failed, will use static_cast. Go figure why.
Traceback (most recent call last):
  File "/tmp/yade-6982/lib/yade-svn1593/gui/PythonUI_rc.py", line 41, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-14516.py", line 3, in <module>
    Preprocessor('FEMBeam').generate('/tmp/yade-test-14516.xml')
RuntimeError: Generator reported error: Cannot find input file, you can copy it from examples/ directory

################################################################################
HydraulicTest: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `duyase'
Traceback (most recent call last):
  File "/tmp/yade-6982/lib/yade-svn1593/gui/PythonUI_rc.py", line 41, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-14516.py", line 3, in <module>
    Preprocessor('HydraulicTest').generate('/tmp/yade-test-14516.xml')
RuntimeError: Generator reported error: Error: cannot load the file that should contain spheres
Running script /tmp/yade-test-14516.py

################################################################################
SDECImpactTest: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `kdsyua'
Traceback (most recent call last):
  File "/tmp/yade-6982/lib/yade-svn1593/gui/PythonUI_rc.py", line 41, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-14516.py", line 3, in <module>
    Preprocessor('SDECImpactTest').generate('/tmp/yade-test-14516.xml')
RuntimeError: Generator reported error: Cannot find input file, you can copy it from examples/ directory
Running script /tmp/yade-test-14516.py

################################################################################
STLImporterTest: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `yuessd'
Running script /tmp/yade-test-14516.py
Import walls geometry from file: hourglass.stl
976 [139972041340720] ERROR yade.STLImporter  - lib/import/STLImporter.cpp:27 open: Can't open file: hourglass.stl
ERROR: Bad file: hourglass.stl
Traceback (most recent call last):
  File "/tmp/yade-6982/lib/yade-svn1593/gui/PythonUI_rc.py", line 41, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-14516.py", line 3, in <module>
    Preprocessor('STLImporterTest').generate('/tmp/yade-test-14516.xml')
RuntimeError: Generator reported error: Input file not found, you can copy it from examples/ directory or make one using blender 3D modelling

################################################################################
SimpleShear: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `ysukse'
Running script /tmp/yade-test-14516.py
Cannot find input file
Traceback (most recent call last):
  File "/tmp/yade-6982/lib/yade-svn1593/gui/PythonUI_rc.py", line 41, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-14516.py", line 3, in <module>
    Preprocessor('SimpleShear').generate('/tmp/yade-test-14516.xml')
RuntimeError: Generator reported error: Cannot find input file

################################################################################
SnowVoxelsLoader: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `uskdsa'
Traceback (most recent call last):
  File "/tmp/yade-6982/lib/yade-svn1593/gui/PythonUI_rc.py", line 41, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-14516.py", line 3, in <module>
    Preprocessor('SnowVoxelsLoader').generate('/tmp/yade-test-14516.xml')
RuntimeError: Generator reported error: cannot load txt yet, or nothing to load
Running script /tmp/yade-test-14516.py

################################################################################
USCTGen: simulation CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `yadeus'
yade-svn1593: extra/Brefcom.cpp:155: virtual void BrefcomLaw::action(MetaBody*): Assertion `contGeom->hasShear' failed.
Running script /tmp/yade-test-14516.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1593/gdb_crash_batch-pid15214'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0x7f31b06eb730 (LWP 15214)]
[New Thread 0x4183b950 (LWP 15231)]
[New Thread 0x4103a950 (LWP 15224)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 0000000000000120
0x00007f31aff90e81 in nanosleep () from /lib/libpthread.so.0
No symbol "info" in current context.

Thread 3 (Thread 0x4103a950 (LWP 15224)):
#0  0x00007f31aff907fb in accept () from /lib/libpthread.so.0
#1  0x00007f317a509947 in ?? () from /usr/lib/python2.5/lib-dynload/_socket.so
#2  0x00007f31b0256b57 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#3  0x00007f31b0257893 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#4  0x00007f31b0257893 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#5  0x00007f31b0257893 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#6  0x00007f31b0258a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#7  0x00007f31b01f870a in ?? () from /usr/lib/libpython2.5.so.1.0
#8  0x00007f31b01d6f23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#9  0x00007f31b01de65f in ?? () from /usr/lib/libpython2.5.so.1.0
#10 0x00007f31b01d6f23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007f31b0251a1e in PyEval_CallObjectWithKeywords () from /usr/lib/libpython2.5.so.1.0
#12 0x00007f31b0286eed in ?? () from /usr/lib/libpython2.5.so.1.0
#13 0x00007f31aff893f7 in start_thread () from /lib/libpthread.so.0
#14 0x00007f31ac3bbb3d in clone () from /lib/libc.so.6
#15 0x0000000000000000 in ?? ()

Thread 2 (Thread 0x4183b950 (LWP 15231)):
#0  0x00007f31ac3814df in waitpid () from /lib/libc.so.6
#1  0x00007f31ac322461 in ?? () from /lib/libc.so.6
#2  0x00007f31ac3227e7 in system () from /lib/libc.so.6
#3  0x000000000057f4c8 in sigHandler (sig=6) at core/yade.cpp:60
#4  <signal handler called>
#5  0x00007f31ac316095 in raise () from /lib/libc.so.6
#6  0x00007f31ac317af0 in abort () from /lib/libc.so.6
#7  0x00007f31ac30f2df in __assert_fail () from /lib/libc.so.6
#8  0x00007f319eb887a6 in BrefcomLaw::action (this=0xe63dc0, _rootBody=0x8bd190) at extra/Brefcom.cpp:155
#9  0x000000000052179f in MetaBody::moveToNextTimeStep (this=0x8bd190) at core/MetaBody.cpp:96
#10 0x000000000057640b in SimulationFlow::singleAction (this=0x822c10) at core/SimulationFlow.cpp:18
#11 0x000000000057835f in ThreadWorker::callSingleAction (this=0x822c10) at core/ThreadWorker.cpp:71
#12 0x0000000000577b52 in ThreadRunner::call (this=0xee8450) at core/ThreadRunner.cpp:44
#13 0x0000000000577bb8 in ThreadRunner::run (this=0xee8450) at core/ThreadRunner.cpp:23
#14 0x0000000000578030 in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x4183b0c8, p=0xee8450) at /usr/include/boost/bind/mem_fn_template.hpp:49
#15 0x000000000057809d in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x4183b0d8, f=@0x4183b0c8, a=@0x4183b02f) at /usr/include/boost/bind.hpp:231
#16 0x00000000005780da in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x4183b0c8) at /usr/include/boost/bind/bind_template.hpp:20
#17 0x00000000005780f9 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x4183b0c8) at /usr/include/boost/function/function_template.hpp:155
#18 0x00007f31af92a537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#19 0x00007f31af92a1a2 in ?? () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#20 0x00007f31aff893f7 in start_thread () from /lib/libpthread.so.0
#21 0x00007f31ac3bbb3d in clone () from /lib/libc.so.6
#22 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7f31b06eb730 (LWP 15214)):
#0  0x00007f31aff90e81 in nanosleep () from /lib/libpthread.so.0
#1  0x00007f317f066c9b in pyOmega::wait (this=0xe4f560) at gui/py/yadeControl.cpp:435
#2  0x00007f317ef56fe3 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0xa6d618, tc=@0x7fffb8729680) at /usr/include/boost/python/detail/invoke.hpp:94
#3  0x00007f317effcde4 in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0xa6d618, args_=0x10ec650) at /usr/include/boost/python/detail/caller.hpp:199
#4  0x00007f317effce37 in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0xa6d610, args=0x10ec650, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#5  0x00007f31adca7abe in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#6  0x00007f31adca7de8 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#7  0x00007f31af92a537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#8  0x00007f31adcaf9f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#9  0x00007f31adca5127 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#10 0x00007f31b01d6f23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007f31b0254bb0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#12 0x00007f31b0258a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#13 0x00007f31b0258ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#14 0x00007f31b027bda1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#15 0x00007f31b02508d6 in ?? () from /usr/lib/libpython2.5.so.1.0
#16 0x00007f31b0257940 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0x00007f31b0258a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0x00007f31b0258ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#19 0x00007f31b027bda1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#20 0x00007f31b027c03b in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#21 0x00007f319cefa786 in PythonUI::execScript (script={static npos = 18446744073709551615, _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7fffb872a6d0 "x&?"}}) at gui/py/PythonUI.cpp:44
#22 0x00007f319cefbad5 in PythonUI::pythonSession () at gui/py/PythonUI.cpp:96
#23 0x00007f319cefca93 in PythonUI::run (this=0x823800, argc=4, argv=0x7fffb872b3f0) at gui/py/PythonUI.cpp:128
#24 0x000000000057ee29 in main (argc=4, argv=0x7fffb872b3f0) at core/yade.cpp:253
#0  0x00007f31aff90e81 in nanosleep () from /lib/libpthread.so.0

-------------- next part --------------
_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From janek_listy at wp.pl  Sun Dec  7 00:47:44 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Sun, 7 Dec 2008 00:47:44 +0100
Subject: [deprecated list] [Yade-dev] compiling with boost 1.3.3
Message-ID: <20081207004744.681e214a@szpak>

I just discovered that it is possible to compile yade on etch with
boost 1.3.3, there must be just one thing changed:


pkg/dem/SConscript:

#       env.SharedLibrary('SQLiteRecorder',
#               ['Engine/StandAloneEngine/SQLiteRecorder.cpp'],
#               LIBS=env['LIBS']+['sqlite3x']),


That is, we cannot compile SQLiteRecorder, because algorithm/join is
not present in boost 1.3.3 (and cannot be imported as easily as
foreach).

Vaclav, maybe you could make some #if BOOST_VERSION >= 103400 in
SConscript, on SQLiteRecorder? I don't know how to do that in python.


-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Sun Dec  7 09:10:53 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Sun, 07 Dec 2008 09:10:53 +0100
Subject: [deprecated list] [Yade-dev] compiling with boost 1.3.3
In-Reply-To: <20081207004744.681e214a@szpak>
References: <20081207004744.681e214a@szpak>
Message-ID: <493B850D.10804@arcig.cz>


> Vaclav, maybe you could make some #if BOOST_VERSION >= 103400 in
> SConscript, on SQLiteRecorder? I don't know how to do that in python.
>   
I don't know how to do that in python either, but given that till no
there wasn't any complaint in this respect, I would stay with 1.3.34,
since lenny is (maybe) just a few months away. If it is just this
particular machine, you can comment out SQLiteRecorder and set (IIRC)
svn:ignore property on the SConscript file so that this change is not
commited or overwritten by updates. V.



_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From janek_listy at wp.pl  Sun Dec  7 09:49:21 2008
From: janek_listy at wp.pl (Janek Kozicki)
Date: Sun, 7 Dec 2008 09:49:21 +0100
Subject: [deprecated list] [Yade-dev] compiling with boost 1.3.3
In-Reply-To: <493B850D.10804@arcig.cz>
References: <20081207004744.681e214a@szpak>
	<493B850D.10804@arcig.cz>
Message-ID: <20081207094921.721c79c3@szpak>

V?clav S(milauer said:     (by the date of Sun, 07 Dec 2008 09:10:53 +0100)

> 
> > Vaclav, maybe you could make some #if BOOST_VERSION >= 103400 in
> > SConscript, on SQLiteRecorder? I don't know how to do that in python.
> >   
> I don't know how to do that in python either, but given that till no
> there wasn't any complaint in this respect, I would stay with 1.3.34,
> since lenny is (maybe) just a few months away. If it is just this
> particular machine, you can comment out SQLiteRecorder and set (IIRC)
> svn:ignore property on the SConscript file so that this change is not
> commited or overwritten by updates. V.

sounds good. thx


-- 
Janek Kozicki                                                         |

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Mon Dec  8 10:17:04 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Mon, 8 Dec 2008 10:17:04 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1594 - in trunk: core extra
	extra/usct	lib/serialization pkg/common/Engine/DeusExMachina
Message-ID: <200812080917.mB89H438026686@sheep.berlios.de>

Author: eudoxos
Date: 2008-12-08 10:17:00 +0100 (Mon, 08 Dec 2008)
New Revision: 1594

Modified:
   trunk/core/Body.cpp
   trunk/core/Body.hpp
   trunk/core/BodyContainer.cpp
   trunk/core/BodyContainer.hpp
   trunk/core/BoundingVolume.cpp
   trunk/core/BoundingVolume.hpp
   trunk/core/DeusExMachina.cpp
   trunk/core/DeusExMachina.hpp
   trunk/core/DisplayParameters.hpp
   trunk/core/Engine.hpp
   trunk/core/EngineUnit.hpp
   trunk/core/EngineUnit1D.hpp
   trunk/core/EngineUnit2D.hpp
   trunk/core/FileGenerator.cpp
   trunk/core/FileGenerator.hpp
   trunk/core/FrontEnd.hpp
   trunk/core/GeometricalModel.cpp
   trunk/core/GeometricalModel.hpp
   trunk/core/InteractingGeometry.cpp
   trunk/core/InteractingGeometry.hpp
   trunk/core/Interaction.cpp
   trunk/core/Interaction.hpp
   trunk/core/InteractionContainer.cpp
   trunk/core/InteractionContainer.hpp
   trunk/core/InteractionGeometry.hpp
   trunk/core/MetaBody.cpp
   trunk/core/MetaBody.hpp
   trunk/core/MetaEngine.cpp
   trunk/core/MetaEngine.hpp
   trunk/core/MetaEngine1D.hpp
   trunk/core/MetaEngine2D.hpp
   trunk/core/NullGUI.hpp
   trunk/core/PhysicalAction.hpp
   trunk/core/PhysicalActionContainer.cpp
   trunk/core/PhysicalActionContainer.hpp
   trunk/core/PhysicalParameters.hpp
   trunk/core/Preferences.cpp
   trunk/core/Preferences.hpp
   trunk/core/RenderingEngine.hpp
   trunk/core/TimeStepper.hpp
   trunk/extra/Brefcom.hpp
   trunk/extra/usct/UniaxialStrainControlledTest.hpp
   trunk/lib/serialization/Serializable.hpp
   trunk/pkg/common/Engine/DeusExMachina/Se3Interpolator.hpp
Log:
1. Modify REGISTER_ATTRIBUTES macro so that it work with or without base class given. Change all headers in core to use that. It should help us if we ever make the transition to boost::serialization.
2. User REGISTER_CLASS_AND_BASE instead of REGISTER_CLASS_NAME and REGISTER_BASE_CLASS in core and at a few other places.



Modified: trunk/core/Body.cpp
===================================================================
--- trunk/core/Body.cpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/Body.cpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -43,17 +43,3 @@
 {
 }
 
-
-void Body::registerAttributes()
-{
-	REGISTER_ATTRIBUTE(id);
-	REGISTER_ATTRIBUTE(groupMask);
-	REGISTER_ATTRIBUTE(isDynamic); // FIXME? : only used for interaction : no collision between 2 non dynamic objects
-
-	REGISTER_ATTRIBUTE(physicalParameters);
-	REGISTER_ATTRIBUTE(geometricalModel);
-	REGISTER_ATTRIBUTE(interactingGeometry);
-	REGISTER_ATTRIBUTE(boundingVolume);
-	REGISTER_ATTRIBUTE(clumpId);
-}
-

Modified: trunk/core/Body.hpp
===================================================================
--- trunk/core/Body.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/Body.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -89,8 +89,17 @@
 
 		// Serialization
 	protected:
-		void registerAttributes();
-	REGISTER_CLASS_NAME(Body);
-	REGISTER_BASE_CLASS_NAME(Serializable);
+		REGISTER_ATTRIBUTES(/*no base*/,
+			(id)
+			(groupMask)
+			(isDynamic) // FIXME? : only used for interaction : no collision between 2 non dynamic objects
+			(physicalParameters)
+			(geometricalModel)
+			(interactingGeometry)
+			(boundingVolume)
+			(clumpId)
+		);
+
+	REGISTER_CLASS_AND_BASE(Body,Serializable);
 };
 REGISTER_SERIALIZABLE(Body);

Modified: trunk/core/BodyContainer.cpp
===================================================================
--- trunk/core/BodyContainer.cpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/BodyContainer.cpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -23,12 +23,6 @@
 }
 
 
-void BodyContainer::registerAttributes()
-{
-	REGISTER_ATTRIBUTE(body);
-}
-
-
 void BodyContainer::preProcessAttributes(bool deserializing)
 {
 	if(deserializing)

Modified: trunk/core/BodyContainer.hpp
===================================================================
--- trunk/core/BodyContainer.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/BodyContainer.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -99,14 +99,13 @@
 	protected :
 		void setId(shared_ptr<Body>& , unsigned int);
 
-	REGISTER_CLASS_NAME(BodyContainer);
-	REGISTER_BASE_CLASS_NAME(Serializable);
+	REGISTER_CLASS_AND_BASE(BodyContainer,Serializable);
 
 	// local storage for uniform serialization of all possible container concrete implementations.
 	private :
 		vector<shared_ptr<Body> > body; 
 	public :
-		virtual void registerAttributes();
+		REGISTER_ATTRIBUTES(/*no base*/,(body));
 	protected :
 		virtual void preProcessAttributes(bool deserializing);
 		virtual void postProcessAttributes(bool deserializing);

Modified: trunk/core/BoundingVolume.cpp
===================================================================
--- trunk/core/BoundingVolume.cpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/BoundingVolume.cpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -9,8 +9,4 @@
 #include "BoundingVolume.hpp"
 
 
-void BoundingVolume::registerAttributes()
-{
-	REGISTER_ATTRIBUTE(diffuseColor);
-}
 

Modified: trunk/core/BoundingVolume.hpp
===================================================================
--- trunk/core/BoundingVolume.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/BoundingVolume.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -26,9 +26,8 @@
 				,max;			/// Maximum of the bounding volume
 		BoundingVolume(): diffuseColor(Vector3r(1,1,1)), min(Vector3r(0,0,0)), max(Vector3r(0,0,0)) {}
 
-		void registerAttributes();
-	REGISTER_CLASS_NAME(BoundingVolume);
-	REGISTER_BASE_CLASS_NAME(Serializable Indexable);
+	REGISTER_ATTRIBUTES(/*no base*/,(diffuseColor));
+	REGISTER_CLASS_AND_BASE(BoundingVolume,Serializable Indexable);
 	REGISTER_INDEX_COUNTER(BoundingVolume);
 };
 REGISTER_SERIALIZABLE(BoundingVolume);

Modified: trunk/core/DeusExMachina.cpp
===================================================================
--- trunk/core/DeusExMachina.cpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/DeusExMachina.cpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -9,14 +9,8 @@
 #include "DeusExMachina.hpp"
 
 DeusExMachina::DeusExMachina() : Engine() {
-	subscribedBodies.resize(0);
+	subscribedBodies.resize(0); // what is this good for?
 }
-
-void DeusExMachina::registerAttributes() {
-	Engine::registerAttributes();
-	REGISTER_ATTRIBUTE(subscribedBodies);
-}
-
 void DeusExMachina::action(MetaBody* b) {
 	this->applyCondition(b);
 }

Modified: trunk/core/DeusExMachina.hpp
===================================================================
--- trunk/core/DeusExMachina.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/DeusExMachina.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -31,9 +31,8 @@
 		virtual void applyCondition(MetaBody*) { throw; };
 	//	virtual bool isActivated();
 	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(DeusExMachina);
-	REGISTER_BASE_CLASS_NAME(Engine);
+	REGISTER_ATTRIBUTES(Engine,(subscribedBodies));
+	REGISTER_CLASS_AND_BASE(DeusExMachina,Engine);
 };
 
 REGISTER_SERIALIZABLE(DeusExMachina);

Modified: trunk/core/DisplayParameters.hpp
===================================================================
--- trunk/core/DisplayParameters.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/DisplayParameters.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -21,8 +21,7 @@
 		void setValue(std::string displayType, std::string value){assert(values.size()==displayTypes.size()); vector<string>::iterator I=std::find(displayTypes.begin(),displayTypes.end(),displayType); if(I==displayTypes.end()){displayTypes.push_back(displayType); values.push_back(value);} else {values[std::distance(displayTypes.begin(),I)]=value;};}
 	DisplayParameters(){}
 	virtual ~DisplayParameters(){}
-	virtual void registerAttributes(){ REGISTER_ATTRIBUTE(displayTypes); REGISTER_ATTRIBUTE(values); }
-	REGISTER_CLASS_NAME(DisplayParameters);
-	REGISTER_BASE_CLASS_NAME(Serializable);
+	REGISTER_ATTRIBUTES(/*no base*/,(displayTypes)(values));
+	REGISTER_CLASS_AND_BASE(DisplayParameters,Serializable);
 };
 REGISTER_SERIALIZABLE(DisplayParameters);

Modified: trunk/core/Engine.hpp
===================================================================
--- trunk/core/Engine.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/Engine.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -27,11 +27,9 @@
 		virtual void action(MetaBody*) { throw; };
 		/* returns all BodyExternalVariable's (Bex; formerly PhysicalActions) that this engine needs */
 		virtual list<string> getNeededBex(){return list<string>();}
-		virtual void registerAttributes(){REGISTER_ATTRIBUTE(label);}
+	REGISTER_ATTRIBUTES(/*no base*/,(label));
+	REGISTER_CLASS_AND_BASE(Engine,Serializable);
 
-	REGISTER_CLASS_NAME(Engine);
-	REGISTER_BASE_CLASS_NAME(Serializable);
-
 };
 
 REGISTER_SERIALIZABLE(Engine);

Modified: trunk/core/EngineUnit.hpp
===================================================================
--- trunk/core/EngineUnit.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/EngineUnit.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -17,8 +17,7 @@
 {
 	public: virtual vector<std::string> getFunctorTypes(){throw;}
 		virtual list<string> getNeededBex(){return list<string>();}
-	REGISTER_CLASS_NAME(EngineUnit);
-	REGISTER_BASE_CLASS_NAME(Serializable);
+	REGISTER_CLASS_AND_BASE(EngineUnit,Serializable);
 };
 
 REGISTER_SERIALIZABLE(EngineUnit);

Modified: trunk/core/EngineUnit1D.hpp
===================================================================
--- trunk/core/EngineUnit1D.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/EngineUnit1D.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -26,8 +26,7 @@
 	public:
 		virtual std::string get1DFunctorType1(void){throw runtime_error("Class "+this->getClassName()+" did not use FUNCTOR1D to declare its argument type?"); }
 		virtual vector<string> getFunctorTypes(void){vector<string> ret; ret.push_back(get1DFunctorType1()); return ret;};
-	REGISTER_CLASS_NAME(EngineUnit1D);
-	REGISTER_BASE_CLASS_NAME(EngineUnit FunctorWrapper);
+	REGISTER_CLASS_AND_BASE(EngineUnit1D,EngineUnit FunctorWrapper);
 };
 
 #endif // ENGINEUNIT1D_HPP

Modified: trunk/core/EngineUnit2D.hpp
===================================================================
--- trunk/core/EngineUnit2D.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/EngineUnit2D.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -28,8 +28,7 @@
 		virtual std::string get2DFunctorType1(void){throw runtime_error("Class "+this->getClassName()+" did not use FUNCTOR2D to declare its argument types?");}
 		virtual std::string get2DFunctorType2(void){throw runtime_error("Class "+this->getClassName()+" did not use FUNCTOR2D to declare its argument types?");}
 		virtual vector<string> getFunctorTypes(){vector<string> ret; ret.push_back(get2DFunctorType1()); ret.push_back(get2DFunctorType2()); return ret;};
-	REGISTER_CLASS_NAME(EngineUnit2D);
-	REGISTER_BASE_CLASS_NAME(EngineUnit FunctorWrapper);
+	REGISTER_CLASS_AND_BASE(EngineUnit2D,EngineUnit FunctorWrapper);
 };
 
 #endif // ENGINEUNIT2D_HPP

Modified: trunk/core/FileGenerator.cpp
===================================================================
--- trunk/core/FileGenerator.cpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/FileGenerator.cpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -36,19 +36,6 @@
 }
 
 
-void FileGenerator::postProcessAttributes(bool) 
-{
-
-}
-
-
-void FileGenerator::registerAttributes() 
-{	
-	REGISTER_ATTRIBUTE(outputFileName);
-	REGISTER_ATTRIBUTE(serializationDynlib);
-}
-
-
 bool FileGenerator::generate() 
 {
 	message="FileGenerator (base class) generates nothing.";

Modified: trunk/core/FileGenerator.hpp
===================================================================
--- trunk/core/FileGenerator.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/FileGenerator.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -40,15 +40,13 @@
 		virtual void singleAction();
 
 	protected :
-		//! Returns whether the generation was successful; message for user is in FileGenerator::message
-		virtual bool generate();
+	//! Returns whether the generation was successful; message for user is in FileGenerator::message
+	virtual bool generate();
+	virtual void postProcessAttributes(){};
 
-		virtual void postProcessAttributes(bool);
-		virtual void registerAttributes();
-
+	REGISTER_ATTRIBUTES(/*no base*/,(outputFileName)(serializationDynlib));
 	DECLARE_LOGGER;
-	REGISTER_CLASS_NAME(FileGenerator);
-	REGISTER_BASE_CLASS_NAME(Serializable);
+	REGISTER_CLASS_AND_BASE(FileGenerator,Serializable);
 };
 
 REGISTER_SERIALIZABLE(FileGenerator);

Modified: trunk/core/FrontEnd.hpp
===================================================================
--- trunk/core/FrontEnd.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/FrontEnd.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -22,8 +22,7 @@
 
 		virtual int run(int , char * []) { return -1;};
 
-	REGISTER_CLASS_NAME(FrontEnd);
-	REGISTER_BASE_CLASS_NAME(Factorable);
+	REGISTER_CLASS_AND_BASE(FrontEnd,Factorable);
 };
 
 REGISTER_FACTORABLE(FrontEnd);

Modified: trunk/core/GeometricalModel.cpp
===================================================================
--- trunk/core/GeometricalModel.cpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/GeometricalModel.cpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -10,11 +10,4 @@
 
 #include "GeometricalModel.hpp"
 
-void GeometricalModel::registerAttributes()
-{
-	REGISTER_ATTRIBUTE(diffuseColor);
-	REGISTER_ATTRIBUTE(wire);
-	REGISTER_ATTRIBUTE(visible);
-	REGISTER_ATTRIBUTE(shadowCaster);
-}
 

Modified: trunk/core/GeometricalModel.hpp
===================================================================
--- trunk/core/GeometricalModel.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/GeometricalModel.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -28,11 +28,8 @@
 
 		GeometricalModel(): visible(true),wire(false),shadowCaster(false),diffuseColor(Vector3r(1,1,1)){}
 
-	protected : 
-		void registerAttributes();
-
-	REGISTER_CLASS_NAME(GeometricalModel);
-	REGISTER_BASE_CLASS_NAME(Serializable Indexable);
+	REGISTER_ATTRIBUTES(/*no base*/,(visible)(wire)(shadowCaster)(diffuseColor));
+	REGISTER_CLASS_AND_BASE(GeometricalModel,Serializable Indexable);
 	REGISTER_INDEX_COUNTER(GeometricalModel);
 };
 

Modified: trunk/core/InteractingGeometry.cpp
===================================================================
--- trunk/core/InteractingGeometry.cpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/InteractingGeometry.cpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -10,7 +10,3 @@
 
 #include "InteractingGeometry.hpp"
 
-void InteractingGeometry::registerAttributes()
-{
-	REGISTER_ATTRIBUTE(diffuseColor);
-}

Modified: trunk/core/InteractingGeometry.hpp
===================================================================
--- trunk/core/InteractingGeometry.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/InteractingGeometry.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -30,11 +30,8 @@
 					// bool wire; even though GeometricalModel has bool wire ?
 	
 /// Serialization
-	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(InteractingGeometry);
-	REGISTER_BASE_CLASS_NAME(Serializable Indexable);
-	
+	REGISTER_ATTRIBUTES(/*no base*/,(diffuseColor));
+	REGISTER_CLASS_AND_BASE(InteractingGeometry,Serializable Indexable);
 /// Indexable
 	REGISTER_INDEX_COUNTER(InteractingGeometry);
 };

Modified: trunk/core/Interaction.cpp
===================================================================
--- trunk/core/Interaction.cpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/Interaction.cpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -32,16 +32,6 @@
 }
 
 
-void Interaction::registerAttributes()
-{
-	REGISTER_ATTRIBUTE(id1);
-	REGISTER_ATTRIBUTE(id2);
-	REGISTER_ATTRIBUTE(isNew);
-	REGISTER_ATTRIBUTE(isReal);
-	REGISTER_ATTRIBUTE(interactionGeometry);
-	REGISTER_ATTRIBUTE(interactionPhysics);
-}
-
 void Interaction::swapOrder(){
 	if(interactionGeometry || interactionPhysics || !isNew){
 		throw std::logic_error("Bodies in interaction cannot be swapped if !isNew, have interactionGeometry or have interactionPhysics.");

Modified: trunk/core/Interaction.hpp
===================================================================
--- trunk/core/Interaction.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/Interaction.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -46,10 +46,15 @@
 			bool maskAnyOK(int mask, MetaBody* rootBody=NULL){return (mask==0) || Body::byId(id1,rootBody)->maskOK(mask) || Body::byId(id2,rootBody)->maskOK(mask);}
 		#endif
 
-	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(Interaction);
-	REGISTER_BASE_CLASS_NAME(Serializable);
+	REGISTER_ATTRIBUTES(/*no base*/,
+		(id1)
+		(id2)
+		(isNew)
+		(isReal)
+		(interactionGeometry)
+		(interactionPhysics)
+	);
+	REGISTER_CLASS_AND_BASE(Interaction,Serializable);
 };
 
 REGISTER_SERIALIZABLE(Interaction);

Modified: trunk/core/InteractionContainer.cpp
===================================================================
--- trunk/core/InteractionContainer.cpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/InteractionContainer.cpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -12,12 +12,7 @@
 #include "Interaction.hpp"
 
 
-void InteractionContainer::registerAttributes()
-{
-	REGISTER_ATTRIBUTE(interaction);
-}
 
-
 void InteractionContainer::preProcessAttributes(bool deserializing)
 {
 	if(deserializing)

Modified: trunk/core/InteractionContainer.hpp
===================================================================
--- trunk/core/InteractionContainer.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/InteractionContainer.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -105,11 +105,10 @@
 		vector<shared_ptr<Interaction> > interaction;
 
 	protected :
-		virtual void registerAttributes();
 		virtual void preProcessAttributes(bool deserializing);
 		virtual void postProcessAttributes(bool deserializing);
-	REGISTER_CLASS_NAME(InteractionContainer);
-	REGISTER_BASE_CLASS_NAME(Serializable);
+	REGISTER_ATTRIBUTES(/*no base*/,(interaction));
+	REGISTER_CLASS_AND_BASE(InteractionContainer,Serializable);
 };
 
 REGISTER_SERIALIZABLE(InteractionContainer);

Modified: trunk/core/InteractionGeometry.hpp
===================================================================
--- trunk/core/InteractionGeometry.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/InteractionGeometry.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -17,7 +17,6 @@
 {
 	REGISTER_CLASS_NAME(InteractionGeometry);
 	REGISTER_BASE_CLASS_NAME(Serializable Indexable);
-	
 	REGISTER_INDEX_COUNTER(InteractionGeometry);
 };
 

Modified: trunk/core/MetaBody.cpp
===================================================================
--- trunk/core/MetaBody.cpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/MetaBody.cpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -68,25 +68,7 @@
 }
 
 
-void MetaBody::registerAttributes()
-{
-	Body::registerAttributes();
-	REGISTER_ATTRIBUTE(tags);
-	REGISTER_ATTRIBUTE(engines);
-	REGISTER_ATTRIBUTE(initializers);
-	REGISTER_ATTRIBUTE(bodies);
-	REGISTER_ATTRIBUTE(transientInteractions);
-	REGISTER_ATTRIBUTE(persistentInteractions);
-	REGISTER_ATTRIBUTE(physicalActions); // FIXME - needed or not ? - Olivier : yes it is needed if there is no default initialization into constructor
-	REGISTER_ATTRIBUTE(miscParams);
-	REGISTER_ATTRIBUTE(dispParams);
-	REGISTER_ATTRIBUTE(dt);
-	REGISTER_ATTRIBUTE(currentIteration);
-	REGISTER_ATTRIBUTE(simulationTime);
-	REGISTER_ATTRIBUTE(stopAtIteration);
-}
 
-
 void MetaBody::moveToNextTimeStep()
 {
 	if(needsInitializers){

Modified: trunk/core/MetaBody.hpp
===================================================================
--- trunk/core/MetaBody.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/MetaBody.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -50,9 +50,22 @@
 /// Serialization
 	protected :
 		virtual void postProcessAttributes(bool deserializing);
-		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(MetaBody);
-	REGISTER_BASE_CLASS_NAME(Body);
+	REGISTER_ATTRIBUTES(Body,
+		(tags)
+		(engines)
+		(initializers)
+		(bodies)
+		(transientInteractions)
+		(persistentInteractions)
+		(physicalActions) // FIXME - needed or not ? - Olivier : yes it is needed if there is no default initialization into constructor
+		(miscParams)
+		(dispParams)
+		(dt)
+		(currentIteration)
+		(simulationTime)
+		(stopAtIteration)
+	);
+	REGISTER_CLASS_AND_BASE(MetaBody,Body);
 };
 
 REGISTER_SERIALIZABLE(MetaBody);

Modified: trunk/core/MetaEngine.cpp
===================================================================
--- trunk/core/MetaEngine.cpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/MetaEngine.cpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -41,14 +41,7 @@
 }
 
 
-void MetaEngine::registerAttributes()
-{
-	Engine::registerAttributes();
-	REGISTER_ATTRIBUTE(functorNames);
-	REGISTER_ATTRIBUTE(functorArguments);
-}
 
-
 vector<vector<string> >& MetaEngine::getFunctorNames()
 {
 	return functorNames;

Modified: trunk/core/MetaEngine.hpp
===================================================================
--- trunk/core/MetaEngine.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/MetaEngine.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -46,11 +46,10 @@
 		virtual int getDimension() { throw; };
 		virtual string getBaseClassType(unsigned int ) { throw; };
 
-	protected :
-		virtual void registerAttributes();
+	protected:
 		virtual void postProcessAttributes(bool deserializing);
-	REGISTER_CLASS_NAME(MetaEngine);
-	REGISTER_BASE_CLASS_NAME(Engine);
+	REGISTER_ATTRIBUTES(Engine,(functorNames)(functorArguments));
+	REGISTER_CLASS_AND_BASE(MetaEngine,Engine);
 };
 
 REGISTER_SERIALIZABLE(MetaEngine);

Modified: trunk/core/MetaEngine1D.hpp
===================================================================
--- trunk/core/MetaEngine1D.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/MetaEngine1D.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -80,10 +80,6 @@
 		}
 
 	protected :
-		void registerAttributes()
-		{
-			MetaEngine::registerAttributes();
-		}
 		void postProcessAttributes(bool deserializing)
 		{
 			MetaEngine::postProcessAttributes(deserializing);
@@ -93,8 +89,8 @@
 					add1DEntry(functorNames[i][0],functorNames[i][1],static_pointer_cast<EngineUnitType>(findFunctorArguments(functorNames[i][1])));	
 			}
 		}
-	REGISTER_CLASS_NAME(MetaEngine1D);
-	REGISTER_BASE_CLASS_NAME(MetaEngine DynLibDispatcher);
+	REGISTER_ATTRIBUTES(MetaEngine,);
+	REGISTER_CLASS_AND_BASE(MetaEngine1D,MetaEngine DynLibDispatcher);
 };
 
 #endif // METADISPATCHINGENGINE1D_HPP

Modified: trunk/core/MetaEngine2D.hpp
===================================================================
--- trunk/core/MetaEngine2D.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/MetaEngine2D.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -99,14 +99,9 @@
 					add2DEntry(functorNames[i][0],functorNames[i][1],functorNames[i][2],static_pointer_cast<EngineUnitType>(findFunctorArguments(functorNames[i][2])));
 			}
 		}
+	REGISTER_ATTRIBUTES(MetaEngine,);
+	REGISTER_CLASS_AND_BASE(MetaEngine2D,MetaEngine DynLibDispatcher);
 
-		void registerAttributes()
-		{
-			MetaEngine::registerAttributes();
-		}
-	REGISTER_CLASS_NAME(MetaEngine2D);
-	REGISTER_BASE_CLASS_NAME(MetaEngine DynLibDispatcher);
-
 };
 
 //REGISTER_SERIALIZABLE(MetaEngine2D);

Modified: trunk/core/NullGUI.hpp
===================================================================
--- trunk/core/NullGUI.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/NullGUI.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -36,8 +36,7 @@
 		virtual ~NullGUI ();
 		virtual int run(int argc, char *argv[]);
 	
-	REGISTER_CLASS_NAME(NullGUI);
-	REGISTER_BASE_CLASS_NAME(FrontEnd);
+	REGISTER_CLASS_AND_BASE(NullGUI,FrontEnd);
 };
 
 REGISTER_FACTORABLE(NullGUI);

Modified: trunk/core/PhysicalAction.hpp
===================================================================
--- trunk/core/PhysicalAction.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/PhysicalAction.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -28,12 +28,8 @@
 		virtual void reset() 				{throw;};
 		virtual shared_ptr<PhysicalAction> clone()	{throw;};
 	
-/// Serialization										///
-	REGISTER_CLASS_NAME(PhysicalAction);
-
-/// Indexable											///
 	REGISTER_INDEX_COUNTER(PhysicalAction);
-	REGISTER_BASE_CLASS_NAME(Serializable Indexable);
+	REGISTER_CLASS_AND_BASE(PhysicalAction,Serializable Indexable);
 };
 
 REGISTER_SERIALIZABLE(PhysicalAction);

Modified: trunk/core/PhysicalActionContainer.cpp
===================================================================
--- trunk/core/PhysicalActionContainer.cpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/PhysicalActionContainer.cpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -23,9 +23,3 @@
 
 }
 
-
-void PhysicalActionContainer::registerAttributes()
-{
-	REGISTER_ATTRIBUTE(action);
-};
-

Modified: trunk/core/PhysicalActionContainer.hpp
===================================================================
--- trunk/core/PhysicalActionContainer.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/PhysicalActionContainer.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -104,11 +104,8 @@
 		virtual PhysicalActionContainer::iterator begin()			{throw;};
 		virtual PhysicalActionContainer::iterator end()			{throw;};
 
-/// Serialization										///
-	protected :
-		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(PhysicalActionContainer);
-	REGISTER_BASE_CLASS_NAME(Serializable);
+	REGISTER_ATTRIBUTES(/*no base*/,(action));
+	REGISTER_CLASS_AND_BASE(PhysicalActionContainer,Serializable);
 
 	// local storage for uniform serialization of all possible container concrete implementations.
 	private	:

Modified: trunk/core/PhysicalParameters.hpp
===================================================================
--- trunk/core/PhysicalParameters.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/PhysicalParameters.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -24,14 +24,9 @@
 		static const unsigned DOF_XYZ=DOF_X|DOF_Y|DOF_Z; //! shorthand for all displacements blocked
 		static const unsigned DOF_RXRYRZ=DOF_RX|DOF_RY|DOF_RZ; //! shorthand for all rotations blocked
 		static unsigned axisDOF(int axis, bool rotationalDOF=false){return 1<<(axis+(rotationalDOF?3:0));} //! Return DOF_* constant for given axis?{0,1,2} and rotationalDOF?{false(default),true}; e.g. axisDOF(0,true)==DOF_RX
-	protected :
-		void registerAttributes(){
-			REGISTER_ATTRIBUTE(se3);
-			REGISTER_ATTRIBUTE(refSe3);
-			REGISTER_ATTRIBUTE(blockedDOFs);
-		}
-	REGISTER_CLASS_NAME(PhysicalParameters);
-	REGISTER_BASE_CLASS_NAME(Serializable Indexable);
+
+	REGISTER_ATTRIBUTES(/*no base*/,(se3)(refSe3)(blockedDOFs));
+	REGISTER_CLASS_AND_BASE(PhysicalParameters,Serializable Indexable);
 	REGISTER_INDEX_COUNTER(PhysicalParameters);
 };
 

Modified: trunk/core/Preferences.cpp
===================================================================
--- trunk/core/Preferences.cpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/Preferences.cpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -14,11 +14,3 @@
 	version = 1;
 }
 
-
-void Preferences::registerAttributes()
-{
-	REGISTER_ATTRIBUTE(version);
-	REGISTER_ATTRIBUTE(dynlibDirectories);
-	REGISTER_ATTRIBUTE(defaultGUILibName);
-}
-

Modified: trunk/core/Preferences.hpp
===================================================================
--- trunk/core/Preferences.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/Preferences.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -25,11 +25,8 @@
 		string		 defaultGUILibName;
 		Preferences ();
 
-/// Serialization										///
-	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(Preferences);
-	REGISTER_BASE_CLASS_NAME(Serializable);
+	REGISTER_ATTRIBUTES(,(version)(dynlibDirectories)(defaultGUILibName));
+	REGISTER_CLASS_AND_BASE(Preferences,Serializable);
 };
 
 REGISTER_SERIALIZABLE(Preferences);

Modified: trunk/core/RenderingEngine.hpp
===================================================================
--- trunk/core/RenderingEngine.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/RenderingEngine.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -22,8 +22,7 @@
 		virtual void renderWithNames(const shared_ptr<MetaBody>& ) {throw;};
 		virtual void init() {throw;};
 
-	REGISTER_CLASS_NAME(RenderingEngine);
-	REGISTER_BASE_CLASS_NAME(Serializable);
+	REGISTER_CLASS_AND_BASE(RenderingEngine,Serializable);
 };
 
 REGISTER_SERIALIZABLE(RenderingEngine);

Modified: trunk/core/TimeStepper.hpp
===================================================================
--- trunk/core/TimeStepper.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/core/TimeStepper.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -30,8 +30,7 @@
 
 	protected :
 		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(TimeStepper);
-	REGISTER_BASE_CLASS_NAME(StandAloneEngine);
+	REGISTER_CLASS_AND_BASE(TimeStepper,StandAloneEngine);
 };
 
 REGISTER_SERIALIZABLE(TimeStepper);

Modified: trunk/extra/Brefcom.hpp
===================================================================
--- trunk/extra/Brefcom.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/extra/Brefcom.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -29,10 +29,12 @@
 		void compute(MetaBody* rb, bool useMax=false);
 		virtual void action(MetaBody* rb){compute(rb,useMaxForce);}
 		BrefcomGlobalCharacteristics(){};
-	void registerAttributes(){ PeriodicEngine::registerAttributes(); REGISTER_ATTRIBUTE(unbalancedForce); REGISTER_ATTRIBUTE(useMaxForce);}
+	REGISTER_ATTRIBUTES(PeriodicEngine,
+		(unbalancedForce)
+		(useMaxForce)
+	);
 	DECLARE_LOGGER;
-	REGISTER_CLASS_NAME(BrefcomGlobalCharacteristics);
-	REGISTER_BASE_CLASS_NAME(PeriodicEngine);
+	REGISTER_CLASS_AND_BASE(BrefcomGlobalCharacteristics,PeriodicEngine);
 };
 REGISTER_SERIALIZABLE(BrefcomGlobalCharacteristics);
 
@@ -90,41 +92,37 @@
 		//	BrefcomContact(Real _E, Real _G, Real _tanFrictionAngle, Real _undamagedCohesion, Real _equilibriumDist, Real _crossSection, Real _epsCrackOnset, Real _epsFracture, Real _expBending, Real _xiShear, Real _tau=0, Real _expDmgRate=1): InteractionPhysics(), E(_E), G(_G), tanFrictionAngle(_tanFrictionAngle), undamagedCohesion(_undamagedCohesion), equilibriumDist(_equilibriumDist), crossSection(_crossSection), epsCrackOnset(_epsCrackOnset), epsFracture(_epsFracture), expBending(_expBending), xiShear(_xiShear), tau(_tau), expDmgRate(_expDmgRate) { epsT=Vector3r::ZERO; kappaD=0; isCohesive=false; neverDamage=false; omega=0; Fn=0; Fs=Vector3r::ZERO; /*TRVAR5(epsCrackOnset,epsFracture,Kn,crossSection,equilibriumDist); */ }
 		virtual ~BrefcomContact();
 
+		REGISTER_ATTRIBUTES(NormalShearInteraction,
+			(E)
+			(G)
+			(tanFrictionAngle)
+			(undamagedCohesion)
+			(crossSection)
+			(epsCrackOnset)
+			(epsFracture)
+			(omegaThreshold)
+			(xiShear)
+			(tau)
+			(expDmgRate)
+			(transStrainCoeff)
 
-		virtual void registerAttributes(){
-			NormalShearInteraction::registerAttributes();
-			REGISTER_ATTRIBUTE(E);
-			REGISTER_ATTRIBUTE(G);
-			REGISTER_ATTRIBUTE(tanFrictionAngle);
-			REGISTER_ATTRIBUTE(undamagedCohesion);
-			REGISTER_ATTRIBUTE(crossSection);
-			REGISTER_ATTRIBUTE(epsCrackOnset);
-			REGISTER_ATTRIBUTE(epsFracture);
-			REGISTER_ATTRIBUTE(omegaThreshold);
-			REGISTER_ATTRIBUTE(xiShear);
-			REGISTER_ATTRIBUTE(tau);
-			REGISTER_ATTRIBUTE(expDmgRate);
-			REGISTER_ATTRIBUTE(transStrainCoeff);
+			(kappaD)
+			(neverDamage)
+			(epsT)
+			(epsTrans)
 
-			REGISTER_ATTRIBUTE(kappaD);
-			REGISTER_ATTRIBUTE(neverDamage);
-			REGISTER_ATTRIBUTE(epsT);
-			REGISTER_ATTRIBUTE(epsTrans);
+			(isCohesive)
 
-			REGISTER_ATTRIBUTE(isCohesive);
-
-			// auxiliary params, to make them accessible from python
-			REGISTER_ATTRIBUTE(omega);
-			REGISTER_ATTRIBUTE(Fn);
-			REGISTER_ATTRIBUTE(Fs);
-			REGISTER_ATTRIBUTE(epsN);
-			REGISTER_ATTRIBUTE(sigmaN);
-			REGISTER_ATTRIBUTE(sigmaT);
-			REGISTER_ATTRIBUTE(relResidualStrength);
-		};
-
-	REGISTER_CLASS_NAME(BrefcomContact);
-	REGISTER_BASE_CLASS_NAME(NormalShearInteraction);
+			// auxiliary params to make them accessible from python
+			(omega)
+			(Fn)
+			(Fs)
+			(epsN)
+			(sigmaN)
+			(sigmaT)
+			(relResidualStrength)
+		);
+	REGISTER_CLASS_AND_BASE(BrefcomContact,NormalShearInteraction);
 	DECLARE_LOGGER;
 };
 REGISTER_SERIALIZABLE(BrefcomContact);
@@ -141,9 +139,8 @@
 		//! average damage including already deleted contacts
 		Real normDmg;
 		BrefcomPhysParams(): epsVolumetric(0.), numBrokenCohesive(0), numContacts(0), normDmg(0.) {createIndex();};
-		virtual void registerAttributes(){BodyMacroParameters::registerAttributes(); REGISTER_ATTRIBUTE(epsVolumetric); REGISTER_ATTRIBUTE(numBrokenCohesive); REGISTER_ATTRIBUTE(numContacts); REGISTER_ATTRIBUTE(normDmg); }
-		REGISTER_CLASS_NAME(BrefcomPhysParams);
-		REGISTER_BASE_CLASS_NAME(BodyMacroParameters);
+		REGISTER_ATTRIBUTES(BodyMacroParameters, (epsVolumetric) (numBrokenCohesive) (numContacts) (normDmg) );
+		REGISTER_CLASS_AND_BASE(BrefcomPhysParams,BodyMacroParameters);
 };
 REGISTER_SERIALIZABLE(BrefcomPhysParams);
 
@@ -167,11 +164,8 @@
 		BrefcomLaw() { Shop::Bex::initCache(); };
 		void action(MetaBody*);
 	protected: 
-		virtual void registerAttributes(){InteractionSolver::registerAttributes();};
-		void postProcessAttributes(bool deserializing){}
 	NEEDS_BEX("Force","Momentum");
-	REGISTER_CLASS_NAME(BrefcomLaw);
-	REGISTER_BASE_CLASS_NAME(InteractionSolver);
+	REGISTER_CLASS_AND_BASE(BrefcomLaw,InteractionSolver);
 	DECLARE_LOGGER;
 };
 REGISTER_SERIALIZABLE(BrefcomLaw);
@@ -207,26 +201,23 @@
 		}
 
 		virtual void go(const shared_ptr<PhysicalParameters>& pp1, const shared_ptr<PhysicalParameters>& pp2, const shared_ptr<Interaction>& interaction);
-		virtual void registerAttributes(){
-			InteractionPhysicsEngineUnit::registerAttributes();
-			REGISTER_ATTRIBUTE(cohesiveThresholdIter);
+		REGISTER_ATTRIBUTES(InteractionPhysicsEngineUnit,
+			(cohesiveThresholdIter)
+			(G_over_E)
+			(expBending)
+			(xiShear)
+			(sigmaT)
+			(neverDamage)
+			(epsCrackOnset)
+			(relDuctility)
+			(tau)
+			(expDmgRate)
+			(omegaThreshold)
+			(transStrainCoeff)
+		);
 
-			REGISTER_ATTRIBUTE(G_over_E);
-			REGISTER_ATTRIBUTE(expBending);
-			REGISTER_ATTRIBUTE(xiShear);
-			REGISTER_ATTRIBUTE(sigmaT);
-			REGISTER_ATTRIBUTE(neverDamage);
-			REGISTER_ATTRIBUTE(epsCrackOnset);
-			REGISTER_ATTRIBUTE(relDuctility);
-			REGISTER_ATTRIBUTE(tau);
-			REGISTER_ATTRIBUTE(expDmgRate);
-			REGISTER_ATTRIBUTE(omegaThreshold);
-			REGISTER_ATTRIBUTE(transStrainCoeff);
-		}
-
 		FUNCTOR2D(BrefcomPhysParams,BrefcomPhysParams);
-		REGISTER_CLASS_NAME(BrefcomMakeContact);
-		REGISTER_BASE_CLASS_NAME(InteractionPhysicsEngineUnit);
+		REGISTER_CLASS_AND_BASE(BrefcomMakeContact,InteractionPhysicsEngineUnit);
 		DECLARE_LOGGER;
 };
 REGISTER_SERIALIZABLE(BrefcomMakeContact);
@@ -234,10 +225,9 @@
 class GLDrawBrefcomContact: public GLDrawInteractionPhysicsFunctor {
 	public: virtual void go(const shared_ptr<InteractionPhysics>&,const shared_ptr<Interaction>&,const shared_ptr<Body>&,const shared_ptr<Body>&,bool wireFrame);
 	virtual ~GLDrawBrefcomContact() {};
-	virtual void registerAttributes(){ REGISTER_ATTRIBUTE(contactLine); REGISTER_ATTRIBUTE(dmgLabel); REGISTER_ATTRIBUTE(dmgPlane); REGISTER_ATTRIBUTE(epsT); REGISTER_ATTRIBUTE(epsTAxes); REGISTER_ATTRIBUTE(normal); REGISTER_ATTRIBUTE(colorStrain); REGISTER_ATTRIBUTE(epsNLabel);}
+	REGISTER_ATTRIBUTES(/*no base*/,(contactLine)(dmgLabel)(dmgPlane)(epsT)(epsTAxes)(normal)(colorStrain)(epsNLabel));
 	RENDERS(BrefcomContact);
-	REGISTER_CLASS_NAME(GLDrawBrefcomContact);
-	REGISTER_BASE_CLASS_NAME(GLDrawInteractionPhysicsFunctor);
+	REGISTER_CLASS_AND_BASE(GLDrawBrefcomContact,GLDrawInteractionPhysicsFunctor);
 	DECLARE_LOGGER;
 	static bool contactLine,dmgLabel,dmgPlane,epsT,epsTAxes,normal,colorStrain,epsNLabel;
 };
@@ -249,9 +239,8 @@
 		Real maxOmega;
 		BrefcomDamageColorizer(){maxOmega=0;}
 		virtual void action(MetaBody*);
-	virtual void registerAttributes(){ PeriodicEngine::registerAttributes(); REGISTER_ATTRIBUTE(maxOmega);}
-	REGISTER_CLASS_NAME(BrefcomDamageColorizer);
-	REGISTER_BASE_CLASS_NAME(PeriodicEngine);
+	REGISTER_ATTRIBUTES(PeriodicEngine,(maxOmega));
+	REGISTER_CLASS_AND_BASE(BrefcomDamageColorizer,PeriodicEngine);
 };
 REGISTER_SERIALIZABLE(BrefcomDamageColorizer);
 

Modified: trunk/extra/usct/UniaxialStrainControlledTest.hpp
===================================================================
--- trunk/extra/usct/UniaxialStrainControlledTest.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/extra/usct/UniaxialStrainControlledTest.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -133,7 +133,7 @@
 		virtual void applyCondition(MetaBody* rootBody);
 		UniaxialStrainer(){axis=2; asymmetry=0; currentStrainRate=0; originalLength=-1; limitStrain=0; notYetReversed=true; crossSectionArea=-1; needsInit=true; /* sensorsPusher=shared_ptr<UniaxialStrainSensorPusher>(); */ recordFile="/tmp/usct.data"; strain=avgStress=/*avgTransStrain=*/0; blockRotations=false; blockDisplacements=false;  stopStrain=numeric_limits<Real>::quiet_NaN(); active=true; idleIterations=0; };
 		virtual ~UniaxialStrainer(){};
-		REGISTER_ATTRIBUTES_WITH_BASE(DeusExMachina,
+		REGISTER_ATTRIBUTES(DeusExMachina,
 				(strainRate) 
 				(stopStrain) 
 				(active)

Modified: trunk/lib/serialization/Serializable.hpp
===================================================================
--- trunk/lib/serialization/Serializable.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/lib/serialization/Serializable.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -43,13 +43,17 @@
                 registerAttribute( #attribute, attribute );
 
 
+// placeholder function for registration with empty base
+namespace{
+	void registerAttributes(){}
+};
 
 #define _REGISTER_ATTRIBUTES_BODY(x,y,z) registerAttribute(BOOST_PP_STRINGIZE(z),z);
 #define REGISTER_ATTRIBUTES_MANY(attrs) BOOST_PP_SEQ_FOR_EACH(_REGISTER_ATTRIBUTES_BODY,~,attrs)
 //! create member function that register attributes; must be parenthesized, without commas: (attr1) (attr2) (attr3) ...
-#define REGISTER_ATTRIBUTES(attrs) protected: void registerAttributes(){ REGISTER_ATTRIBUTES_MANY(attrs) }
+//#define REGISTER_ATTRIBUTES(attrs) protected: void registerAttributes(){ REGISTER_ATTRIBUTES_MANY(attrs) }
 //! Same as REGISTER_ATTRIBUTES, but with first argument of base class, of which registerAttributes will be called first
-#define REGISTER_ATTRIBUTES_WITH_BASE(baseClass,attrs) protected: void registerAttributes(){ baseClass::registerAttributes(); REGISTER_ATTRIBUTES_MANY(attrs) }
+#define REGISTER_ATTRIBUTES(baseClass,attrs) protected: void registerAttributes(){ baseClass::registerAttributes(); REGISTER_ATTRIBUTES_MANY(attrs) }
 
 
 // for both fundamental and non-fundamental cases

Modified: trunk/pkg/common/Engine/DeusExMachina/Se3Interpolator.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/Se3Interpolator.hpp	2008-12-03 10:04:10 UTC (rev 1593)
+++ trunk/pkg/common/Engine/DeusExMachina/Se3Interpolator.hpp	2008-12-08 09:17:00 UTC (rev 1594)
@@ -37,7 +37,7 @@
 		virtual ~Se3Interpolator(){};
 		virtual void applyCondition(MetaBody* mb);
 	protected:
-		REGISTER_ATTRIBUTES_WITH_BASE(DeusExMachina,
+		REGISTER_ATTRIBUTES(DeusExMachina,
 			(done)
 			(started)
 			(start)


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at mail.berlios.de  Mon Dec  8 10:27:08 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Mon, 8 Dec 2008 10:27:08 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1595 - trunk/gui/qt3
Message-ID: <200812080927.mB89R8jt027976@sheep.berlios.de>

Author: eudoxos
Date: 2008-12-08 10:27:08 +0100 (Mon, 08 Dec 2008)
New Revision: 1595

Modified:
   trunk/gui/qt3/GLViewer.cpp
Log:
1. Removed cerr garbage from glviewer (use LOG_DEBUG if needed)


Modified: trunk/gui/qt3/GLViewer.cpp
===================================================================
--- trunk/gui/qt3/GLViewer.cpp	2008-12-08 09:17:00 UTC (rev 1594)
+++ trunk/gui/qt3/GLViewer.cpp	2008-12-08 09:27:08 UTC (rev 1595)
@@ -433,7 +433,6 @@
 	int nSegments=((int)(wholeDiameter/gridStep))+1;
 	Real realSize=nSegments*gridStep;
 	LOG_DEBUG("nSegments="<<nSegments<<",gridStep="<<gridStep<<",realSize="<<realSize);
-	std::cerr << "gridStep="<<gridStep<<"\n";
 	glPushMatrix();
 
 	// XYZ grids


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From bruno.chareyre at hmg.inpg.fr  Mon Dec  8 15:07:30 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Mon, 08 Dec 2008 15:07:30 +0100
Subject: [deprecated list] [Yade-dev] Yade wiki
Message-ID: <493D2A22.8020502@hmg.inpg.fr>

Hello

3SR now has a wiki for internal documentation about procedures and 
softwares.
Recently, after I sent a link to Yade wiki to illustrate the use of a 
wiki, a colleague told me he was surprised to see commercial adds in it.
I didn't notice those adds before because I have adblock plugin 
installed in firefox...

I must admit this a bit annoying to see ads for cars and such in Yade's 
documentation.
What do you think about moving the wiki to a 3SR server, or to another 
hosting service?

R?my Cailletaud confirmed that we are using the same software 
(mediawiki) for Yade and 3SR, so the transfer could be easy.

Bruno

-- 
 
_______________
Chareyre Bruno
Maitre de conference

Grenoble INP
Laboratoire 3SR - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Mon Dec  8 15:34:32 2008
From: eudoxos at arcig.cz (=?ISO-8859-1?Q?V=E1clav_S=28milauer?=)
Date: Mon, 08 Dec 2008 15:34:32 +0100
Subject: [deprecated list] [Yade-dev] Yade wiki
In-Reply-To: <493D2A22.8020502@hmg.inpg.fr>
References: <493D2A22.8020502@hmg.inpg.fr>
Message-ID: <493D3078.40602@arcig.cz>


> 3SR now has a wiki for internal documentation about procedures and
> softwares.
> Recently, after I sent a link to Yade wiki to illustrate the use of a
> wiki, a colleague told me he was surprised to see commercial adds in it.
> I didn't notice those adds before because I have adblock plugin
> installed in firefox...
>
> I must admit this a bit annoying to see ads for cars and such in
> Yade's documentation.
> What do you think about moving the wiki to a 3SR server, or to another
> hosting service?
I would advice people to install adblock in the first place (although,
arguably, ads are what wikia.com makes living from, but I clicked on an
internet ad about once in my life, so I don't think it is necessarily an
issue).

Self-made hosting normally has uptime inferior to commercial hostings
(and that is not to say Remy is a bad admin, but they have redundancy on
all level, from power supply to servers, I imagine). I don't know of any
ad-free hosting commercial-grade service, though I haven't searched
(just by reasoning, they have to make money somehow). OTOH, having
hosting at 3SR would give us the benefit of greater flexibility and
storage for big files (like videos).

I was hoping that launchad.net will have wiki hosting service, which
could nicely consolidate scattered services we have now (launchpad for
bugs, packaging, mailing lists and mirroring code, berlios for svn and
wikia for wiki...). There is some demand for that (google: launchpad
wiki hosting) but nothing definitive for now unfortunately.

I think it can be tried, there are database dumps available somewhere
from wikia, which could be directly imported to mediawiki at 3sr, AFAIK.

Regards, vaclav



_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From bruno.chareyre at hmg.inpg.fr  Mon Dec  8 16:22:14 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Mon, 08 Dec 2008 16:22:14 +0100
Subject: [deprecated list] [Yade-dev] Yade wiki
In-Reply-To: <493D3078.40602@arcig.cz>
References: <493D2A22.8020502@hmg.inpg.fr> <493D3078.40602@arcig.cz>
Message-ID: <493D3BA6.6010508@hmg.inpg.fr>

Thank you.
All we need is to ask R?mi to make the transfer (and perhaps to give him 
few technical details that I don't imagine yet).
We could at least try a simple duplication for now, then switch to 3SR 
server if everything works fine.

Bruno

> Self-made hosting normally has uptime inferior to commercial hostings
> (and that is not to say Remy is a bad admin, but they have redundancy on
> all level, from power supply to servers, I imagine). I don't know of any
> ad-free hosting commercial-grade service, though I haven't searched
> (just by reasoning, they have to make money somehow). OTOH, having
> hosting at 3SR would give us the benefit of greater flexibility and
> storage for big files (like videos).
>
> I was hoping that launchad.net will have wiki hosting service, which
> could nicely consolidate scattered services we have now (launchpad for
> bugs, packaging, mailing lists and mirroring code, berlios for svn and
> wikia for wiki...). There is some demand for that (google: launchpad
> wiki hosting) but nothing definitive for now unfortunately.
>
> I think it can be tried, there are database dumps available somewhere
> from wikia, which could be directly imported to mediawiki at 3sr, AFAIK.
>
> Regards, vaclav
>
>
>
> _______________________________________________
> Mailing list: https://launchpad.net/~yade-dev
> Post to     : yade-dev at lists.launchpad.net
> Unsubscribe : https://launchpad.net/~yade-dev
> More help   : https://help.launchpad.net/ListHelp
>
>   


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Grenoble INP
Laboratoire 3SR - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From bruno.chareyre at hmg.inpg.fr  Mon Dec  8 17:48:31 2008
From: bruno.chareyre at hmg.inpg.fr (Bruno Chareyre)
Date: Mon, 08 Dec 2008 17:48:31 +0100
Subject: [deprecated list] [Yade-dev] Yade wiki
In-Reply-To: <493D3BA6.6010508@hmg.inpg.fr>
References: <493D2A22.8020502@hmg.inpg.fr> <493D3078.40602@arcig.cz>
	<493D3BA6.6010508@hmg.inpg.fr>
Message-ID: <493D4FDF.40800@hmg.inpg.fr>

Ahhh... Janek just explained what "uptime" is, I was thinking about ping 
delay / browsing speed initially.
Are you saying 3SR server is down very often? ;-)

Well, I don't think the wiki is as critical as svn server, it can be off 
from time to time without big prejudice.
Remy, could you please try and clone the current yade wiki?

Bruno
 


Bruno Chareyre a ?crit :
> Thank you.
> All we need is to ask R?mi to make the transfer (and perhaps to give 
> him few technical details that I don't imagine yet).
> We could at least try a simple duplication for now, then switch to 3SR 
> server if everything works fine.
>
> Bruno
>
>> Self-made hosting normally has uptime inferior to commercial hostings
>> (and that is not to say Remy is a bad admin, but they have redundancy on
>> all level, from power supply to servers, I imagine). I don't know of any
>> ad-free hosting commercial-grade service, though I haven't searched
>> (just by reasoning, they have to make money somehow). OTOH, having
>> hosting at 3SR would give us the benefit of greater flexibility and
>> storage for big files (like videos).
>>
>> I was hoping that launchad.net will have wiki hosting service, which
>> could nicely consolidate scattered services we have now (launchpad for
>> bugs, packaging, mailing lists and mirroring code, berlios for svn and
>> wikia for wiki...). There is some demand for that (google: launchpad
>> wiki hosting) but nothing definitive for now unfortunately.
>>
>> I think it can be tried, there are database dumps available somewhere
>> from wikia, which could be directly imported to mediawiki at 3sr, AFAIK.
>>
>> Regards, vaclav
>>
>>
>>
>> _______________________________________________
>> Mailing list: https://launchpad.net/~yade-dev
>> Post to     : yade-dev at lists.launchpad.net
>> Unsubscribe : https://launchpad.net/~yade-dev
>> More help   : https://help.launchpad.net/ListHelp
>>
>>   
>
>


-- 
 
_______________
Chareyre Bruno
Maitre de conference

Grenoble INP
Laboratoire 3SR - bureau E145
BP 53 - 38041, Grenoble cedex 9 - France
T?l : 33 4 56 52 86 21
Fax : 33 4 76 82 70 43
________________


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Tue Dec  9 12:43:31 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Tue, 9 Dec 2008 12:43:31 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1596 - in trunk: extra/clump
	gui/py gui/qt3	pkg/common/Engine/DeusExMachina
Message-ID: <200812091143.mB9BhVcW001851@sheep.berlios.de>

Author: eudoxos
Date: 2008-12-09 12:43:29 +0100 (Tue, 09 Dec 2008)
New Revision: 1596

Modified:
   trunk/extra/clump/Shop.cpp
   trunk/extra/clump/Shop.hpp
   trunk/gui/py/_eudoxos.cpp
   trunk/gui/py/_utils.cpp
   trunk/gui/py/eudoxos.py
   trunk/gui/py/utils.py
   trunk/gui/qt3/GLViewer.cpp
   trunk/pkg/common/Engine/DeusExMachina/GravityEngines.cpp
Log:
1. Fix warnings in GLViewer
2. Add (35.4%)-style counter if stopAtIteration is set to the OSD in gl view
3. Add utils.downCast to downcast object to its derived class and copying all attributes.
4. Add utils.SpherePWaveTimeStep to compute critical dt from a few parameters only
5. Add routine to compute overall kinetic energy to Shop (indirectly to utils as well)
6. Add routine to sum torque (momentum) with respect to an axis from forces and torques on given set of bodies.


Modified: trunk/extra/clump/Shop.cpp
===================================================================
--- trunk/extra/clump/Shop.cpp	2008-12-08 09:27:08 UTC (rev 1595)
+++ trunk/extra/clump/Shop.cpp	2008-12-09 11:43:29 UTC (rev 1596)
@@ -135,10 +135,23 @@
 	return (useMaxForce?maxF:meanF)/maxContactF;
 }
 
+Real Shop::kineticEnergy(MetaBody* _rb){
+	MetaBody* rb=_rb ? _rb : Omega::instance().getRootBody().get();
+	Real ret=0.;
+	FOREACH(const shared_ptr<Body>& b, *rb->bodies){
+		if(!b->isDynamic) continue;
+		shared_ptr<RigidBodyParameters> rbp=YADE_PTR_CAST<RigidBodyParameters>(b->physicalParameters); assert(pp);
+		Matrix3r inertiaMatrix(rbp->inertia[0],rbp->inertia[1],rbp->inertia[2]);
+		// ?(mv?+?I?)
+		ret+=.5*(rbp->mass*rbp->velocity.SquaredLength()+rbp->angularVelocity.Dot(diagMult(rbp->inertia,rbp->angularVelocity)));
+	}
+	return ret;
+}
 
 
 
 
+
 template <typename valType> valType Shop::getDefault(const string& key) {
 	ensureInit();
 	try{return boost::any_cast<valType>(defaults[key]);}

Modified: trunk/extra/clump/Shop.hpp
===================================================================
--- trunk/extra/clump/Shop.hpp	2008-12-08 09:27:08 UTC (rev 1595)
+++ trunk/extra/clump/Shop.hpp	2008-12-09 11:43:29 UTC (rev 1596)
@@ -101,6 +101,7 @@
 
 		//! Get unbalanced force of the whole simulation
 		static Real unbalancedForce(bool useMaxForce=false, MetaBody* _rb=NULL);
+		static Real kineticEnergy(MetaBody* _rb=NULL);
 
 		//! create transientInteraction between 2 bodies, using existing MetaEngine in Omega
 		static shared_ptr<Interaction> createExplicitInteraction(body_id_t id1, body_id_t id2);

Modified: trunk/gui/py/_eudoxos.cpp
===================================================================
--- trunk/gui/py/_eudoxos.cpp	2008-12-08 09:27:08 UTC (rev 1595)
+++ trunk/gui/py/_eudoxos.cpp	2008-12-09 11:43:29 UTC (rev 1596)
@@ -1,6 +1,6 @@
 #include<yade/extra/Brefcom.hpp>
 #include<boost/python.hpp>
-using namespace boost;
+using namespace boost::python;
 using namespace std;
 # if 0
 Real elasticEnergyDensityInAABB(python::tuple AABB){
@@ -27,3 +27,34 @@
 }
 #endif
 
+// copied from _utils.cpp
+Vector3r tuple2vec(const python::tuple& t){return Vector3r(extract<double>(t[0])(),extract<double>(t[1])(),extract<double>(t[2])());}
+
+/*! Set velocity of all dynamic particles so that if their motion were unconstrained,
+ * axis given by axisPoint and axisDirection would be reached in timeToAxis
+ * (or, point at distance subtractDist from axis would be reached).
+ *
+ * The code is analogous to AxialGravityEngine and is intended to give initial motion
+ * to particles subject to axial compaction to speed up the process. */
+void velocityTowardsAxis(python::tuple _axisPoint, python::tuple _axisDirection, Real timeToAxis, Real subtractDist=0.){
+	Vector3r axisPoint=tuple2vec(_axisPoint), axisDirection=tuple2vec(_axisDirection);
+	FOREACH(const shared_ptr<Body>&b, *(Omega::instance().getRootBody()->bodies)){
+		if(!b->isDynamic) continue;
+		ParticleParameters* pp=YADE_CAST<ParticleParameters*>(b->physicalParameters.get());
+		const Vector3r& x0=pp->se3.position;
+		const Vector3r& x1=axisPoint;
+		const Vector3r x2=axisPoint+axisDirection;
+		Vector3r closestAxisPoint=(x2-x1) * /* t */ (-(x1-x0).Dot(x2-x1))/((x2-x1).SquaredLength());
+		Vector3r toAxis=closestAxisPoint-x0;
+		if(subtractDist>0) toAxis*=(toAxis.Length()-subtractDist)/toAxis.Length();
+		pp->velocity=toAxis/timeToAxis;
+	}
+}
+BOOST_PYTHON_FUNCTION_OVERLOADS(velocityTowardsAxis_overloads,velocityTowardsAxis,3,4);
+
+
+
+BOOST_PYTHON_MODULE(_eudoxos){
+	def("velocityTowardsAxis",velocityTowardsAxis,velocityTowardsAxis_overloads(args("axisPoint","axisDirection","timeToAxis","subtractDist")));
+}
+

Modified: trunk/gui/py/_utils.cpp
===================================================================
--- trunk/gui/py/_utils.cpp	2008-12-08 09:27:08 UTC (rev 1595)
+++ trunk/gui/py/_utils.cpp	2008-12-09 11:43:29 UTC (rev 1596)
@@ -171,7 +171,7 @@
  * is position relative to axisPt; moment from moment is m; such moment per body is
  * projected onto axis.
  */
-Real sumBexMoments(int mask, python::tuple _axis, python::tuple _axisPt){
+Real sumBexTorques(int mask, python::tuple _axis, python::tuple _axisPt){
 	Shop::Bex::initCache();
 	shared_ptr<MetaBody> rb=Omega::instance().getRootBody();
 	Real ret;
@@ -264,6 +264,7 @@
 void Shop__createExplicitInteraction(body_id_t id1, body_id_t id2){ (void) Shop::createExplicitInteraction(id1,id2);}
 
 BOOST_PYTHON_FUNCTION_OVERLOADS(unbalancedForce_overloads,Shop::unbalancedForce,0,1);
+Real Shop__kineticEnergy(){return Shop::kineticEnergy();}
 
 BOOST_PYTHON_MODULE(_utils){
 	// http://numpy.scipy.org/numpydoc/numpy-13.html mentions this must be done in module init, otherwise we will crash
@@ -279,8 +280,9 @@
 	def("elasticEnergy",elasticEnergyInAABB);
 	def("inscribedCircleCenter",inscribedCircleCenter);
 	def("unbalancedForce",&Shop::unbalancedForce,unbalancedForce_overloads(args("useMaxForce")));
+	def("kineticEnergy",Shop__kineticEnergy);
 	def("sumBexForces",sumBexForces);
-	def("sumBexMoments",sumBexMoments);
+	def("sumBexTorques",sumBexTorques);
 	def("createInteraction",Shop__createExplicitInteraction);
 	def("spiralProject",spiralProject,spiralProject_overloads(args("axis","theta0")));
 	def("pointInsidePolygon",pointInsidePolygon);

Modified: trunk/gui/py/eudoxos.py
===================================================================
--- trunk/gui/py/eudoxos.py	2008-12-08 09:27:08 UTC (rev 1595)
+++ trunk/gui/py/eudoxos.py	2008-12-09 11:43:29 UTC (rev 1596)
@@ -5,6 +5,7 @@
 #
 from yade.wrapper import *
 from math import *
+from yade._eudoxos import * ## c++ implementations
 
 def estimateStress(strain,cutoff=0.):
 	"""Use summed stored energy in contacts to compute macroscopic stress over the same volume, provided known strain."""

Modified: trunk/gui/py/utils.py
===================================================================
--- trunk/gui/py/utils.py	2008-12-08 09:27:08 UTC (rev 1595)
+++ trunk/gui/py/utils.py	2008-12-09 11:43:29 UTC (rev 1596)
@@ -16,7 +16,7 @@
 # c++ implementations for performance reasons
 from yade._utils import *
 
-def saveVars(mark='',**kw):
+def saveVars(mark='',loadNow=False,**kw):
 	"""Save passed variables into the simulation so that it can be recovered when the simulation is loaded again.
 
 	For example, variables a=5, b=66 and c=7.5e-4 are defined. To save those, use
@@ -26,12 +26,15 @@
 	those variables will be save in the .xml file, when the simulation itself is saved. To recover those variables once
 	the .xml is loaded again, use
 
-	 utils.loadVars()
+	 utils.loadVars(mark)
 
 	and they will be defined in the __builtin__ namespace (i.e. available from anywhere in the python code).
+
+	If loadParam==True, variables will be loaded immediately after saving. That effectively makes **kw available in builtin namespace.
 	"""
 	import cPickle
 	Omega().tags['pickledPythonVariablesDictionary'+mark]=cPickle.dumps(kw)
+	if loadNow: loadVars(mark)
 
 def loadVars(mark=''):
 	import cPickle
@@ -40,10 +43,21 @@
 	for k in d: __builtin__.__dict__[k]=d[k]
 
 
+def SpherePWaveTimeStep(radius,density,young):
+	"""Compute P-wave critical timestep for a single sphere.
+	If you want to compute minimum critical timestep for all spheres in the simulation, use utils.PWaveTimeStep() instead."""
+	from math import sqrt
+	return radius/sqrt(young/density)
+
 def randomColor(): return [random.random(),random.random(),random.random()]
 
 def typedEngine(name): return [e for e in Omega().engines if e.name==name][0]
 
+def downCast(obj,newClassName):
+	"""Cast given object to class deriving from the same yade root class and copy all parameters from given object.
+	Obj should be up in the inheritance tree, otherwise some attributes may not be defined in the new class."""
+	return obj.__class__(newClassName,dict([ (key,obj[key]) for key in obj.keys() ]))
+
 def sphere(center,radius,density=1,young=30e9,poisson=.3,frictionAngle=0.5236,dynamic=True,wire=False,color=None,physParamsClass='BodyMacroParameters'):
 	"""Create default sphere, with given parameters. Physical properties such as mass and inertia are calculated automatically."""
 	s=Body()

Modified: trunk/gui/qt3/GLViewer.cpp
===================================================================
--- trunk/gui/qt3/GLViewer.cpp	2008-12-08 09:27:08 UTC (rev 1595)
+++ trunk/gui/qt3/GLViewer.cpp	2008-12-09 11:43:29 UTC (rev 1596)
@@ -149,7 +149,7 @@
 
 string GLViewer::getState(){
 	QString origStateFileName=stateFileName();
-	char tmpnam_str [L_tmpnam]; tmpnam(tmpnam_str);
+	char tmpnam_str [L_tmpnam]; char* result=tmpnam(tmpnam_str); if(!result) throw runtime_error("Failure getting temporary filename.");
 	setStateFileName(tmpnam_str); saveStateToFile(); setStateFileName(origStateFileName);
 	LOG_DEBUG("State saved to temp file "<<tmpnam_str);
 	// read tmp file contents and return it as string
@@ -160,7 +160,7 @@
 }
 
 void GLViewer::setState(string state){
-	char tmpnam_str [L_tmpnam]; tmpnam(tmpnam_str);
+	char tmpnam_str [L_tmpnam]; char* result=tmpnam(tmpnam_str); if(!result) throw runtime_error("Failure getting temporary filename.");
 	std::ofstream out(tmpnam_str);
 	if(!out.good()){ LOG_ERROR("Error opening temp file `"<<tmpnam_str<<"', loading aborted."); return; }
 	out<<state; out.close();
@@ -492,7 +492,8 @@
 			drawArrow(wholeDiameter/6);
 		glPopMatrix();
 	}
-
+	
+	MetaBody* rb=Omega::instance().getRootBody().get();
 	#define _W3 setw(3)<<setfill('0')
 	#define _W2 setw(2)<<setfill('0')
 	if(timeDispMask!=0){
@@ -519,6 +520,7 @@
 		if(timeDispMask & GLViewer::TIME_ITER){
 			ostringstream oss;
 			oss<<"#"<<Omega::instance().getCurrentIteration();
+			if(rb->stopAtIteration>rb->currentIteration) oss<<" ("<<setiosflags(ios::fixed)<<setw(3)<<setprecision(1)<<setfill('0')<<(100.*rb->currentIteration)/rb->stopAtIteration<<"%)";
 			QGLViewer::drawText(x,y,oss.str());
 			y-=lineHt;
 		}
@@ -530,7 +532,7 @@
 	ostringstream oss;
 	time_duration t=Omega::instance().getComputationDuration();
 	unsigned d=t.hours()/24,h=t.hours()%24,m=t.minutes(),s=t.seconds();
-	oss<<"wall ";
+	oss<<"clock ";
 	if(d>0) oss<<d<<"days "<<_W2<<h<<":"<<_W2<<m<<":"<<_W2<<s;
 	else if(h>0) oss<<_W2<<h<<":"<<_W2<<m<<":"<<_W2<<s;
 	else oss<<_W2<<m<<":"<<_W2<<s;

Modified: trunk/pkg/common/Engine/DeusExMachina/GravityEngines.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/GravityEngines.cpp	2008-12-08 09:27:08 UTC (rev 1595)
+++ trunk/pkg/common/Engine/DeusExMachina/GravityEngines.cpp	2008-12-09 11:43:29 UTC (rev 1596)
@@ -40,9 +40,7 @@
 }
 
 void AxialGravityEngine::applyCondition(MetaBody* rootBody){
-	BodyContainer::iterator Iend=rootBody->bodies->end();
-	for(BodyContainer::iterator I=rootBody->bodies->begin(); I!=Iend; ++I){
-		const shared_ptr<Body>& b(*I);
+	FOREACH(const shared_ptr<Body>&b, *rootBody->bodies){
 		if(b->isClumpMember()) continue;
 		Real myMass=YADE_PTR_CAST<ParticleParameters>(b->physicalParameters)->mass;
 		/* http://mathworld.wolfram.com/Point-LineDistance3-Dimensional.html */


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at arcig.cz  Sun Dec 14 00:01:42 2008
From: eudoxos at arcig.cz (Vaclav Smilauer)
Date: Sun, 14 Dec 2008 00:01:42 +0100 (CET)
Subject: [deprecated list] [Yade-dev] [robot] build failed
Message-ID: <20081213230143.86FA398086@delta>

Compiling current svn failed, log is http://beta.arcig.cz/~eudoxos/yade/testlog-20081214:0000.fail.bz2

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at mail.berlios.de  Sun Dec 14 11:32:09 2008
From: eudoxos at mail.berlios.de (eudoxos at BerliOS)
Date: Sun, 14 Dec 2008 11:32:09 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1598 - in trunk: extra/clump
	gui/py
Message-ID: <200812141032.mBEAW9OD017005@sheep.berlios.de>

Author: eudoxos
Date: 2008-12-14 11:32:09 +0100 (Sun, 14 Dec 2008)
New Revision: 1598

Modified:
   trunk/extra/clump/Shop.cpp
   trunk/gui/py/eudoxos.py
   trunk/gui/py/yadeControl.cpp
Log:
Fix typo (compilation error in debug mode) in Shop::kineticEnergy


Modified: trunk/extra/clump/Shop.cpp
===================================================================
--- trunk/extra/clump/Shop.cpp	2008-12-12 16:04:51 UTC (rev 1597)
+++ trunk/extra/clump/Shop.cpp	2008-12-14 10:32:09 UTC (rev 1598)
@@ -140,7 +140,7 @@
 	Real ret=0.;
 	FOREACH(const shared_ptr<Body>& b, *rb->bodies){
 		if(!b->isDynamic) continue;
-		shared_ptr<RigidBodyParameters> rbp=YADE_PTR_CAST<RigidBodyParameters>(b->physicalParameters); assert(pp);
+		shared_ptr<RigidBodyParameters> rbp=YADE_PTR_CAST<RigidBodyParameters>(b->physicalParameters); assert(rbp);
 		Matrix3r inertiaMatrix(rbp->inertia[0],rbp->inertia[1],rbp->inertia[2]);
 		// ?(mv?+?I?)
 		ret+=.5*(rbp->mass*rbp->velocity.SquaredLength()+rbp->angularVelocity.Dot(diagMult(rbp->inertia,rbp->angularVelocity)));

Modified: trunk/gui/py/eudoxos.py
===================================================================
--- trunk/gui/py/eudoxos.py	2008-12-12 16:04:51 UTC (rev 1597)
+++ trunk/gui/py/eudoxos.py	2008-12-14 10:32:09 UTC (rev 1598)
@@ -96,6 +96,41 @@
 	f.write('\n'.join(material+["%d %d"%(len(bodies),len(interactions))]+bodies+interactions))
 	f.close()
 
+def oofemPrescribedDisplacementsExport(fileName):
+	f=open(fileName,'w')
+	f.write(fileName+'.out\n'+'''All Yade displacements prescribed as boundary conditions
+NonLinearStatic nsteps 2 contextOutputStep 1 rtolv 1.e-2 stiffMode 2 maxiter 50 controllmode 1 nmodules 0
+domain 3dshell
+OutputManager tstep_all dofman_all element_all
+''')
+	inters=[i for i in O.interactions if (i.geom and i.phys)]
+	f.write("ndofman %d nelem %d ncrosssect 1 nmat 1 nbc %d nic 0 nltf 1 nbarrier 0\n"%(len(O.bodies),len(inters),len(O.bodies)*6))
+	bcMax=0; bcMap={}
+	for b in O.bodies:
+		f.write("Particle %d coords 3 %.15e %.15e %.15e rad %g"%(b.id+1,b.phys['se3'][0],b.phys['se3'][1],b.phys['se3'][2],b.shape['radius']))
+		bcMap[b.id]=tuple([bcMax+i for i in [1,2,3,4,5,6]])
+		bcMax+=6
+		f.write(' bc '+' '.join([str(i) for i in bcMap[b.id]])+'\n')
+	for j,i in enumerate(inters):
+		f.write('CohSur3d %d nodes 2 %d %d mat 1 crossSect 1 area %g\n'%(j+1,i.id1+1,i.id2+1,i.phys['crossSection']))
+	# crosssection
+	f.write("SimpleCS 1 thick 1.0 width 1.0\n")
+	# material
+	ph=inters[0].phys
+	f.write("CohInt 1 kn %g ks %g e0 %g ef %g c 0. ksi %g coh %g tanphi %g d 1.0 conf 0.0 maxdist 0.0\n"%(ph['E'],ph['G'],ph['epsCrackOnset'],ph['epsFracture'],ph['xiShear'],ph['undamagedCohesion'],ph['tanFrictionAngle']))
+	# boundary conditions
+	for b in O.bodies:
+		displ=b.phys.displ; rot=b.phys.rot
+		dofs=[displ[0],displ[1],displ[2],rot[0],rot[1],rot[2]]
+		f.write('# body #%d\n'%b.id)
+		for dof in range(6):
+			f.write('BoundaryCondition %d loadTimeFunction 1 prescribedvalue %.15e\n'%(bcMap[b.id][dof],dofs[dof]))
+	#f.write('PiecewiseLinFunction 1 npoints 3 t 3 0. 10. 1000.  f(t) 3 0. 10. 1000.\n')
+	f.write('ConstantFunction 1 f(t) 1.0\n')
+
+
+
+
 def oofemDirectExport(fileBase,title=None,negIds=[],posIds=[]):
 	from yade.wrapper import Omega
 	material,bodies,interactions=[],[],[]

Modified: trunk/gui/py/yadeControl.cpp
===================================================================
--- trunk/gui/py/yadeControl.cpp	2008-12-12 16:04:51 UTC (rev 1597)
+++ trunk/gui/py/yadeControl.cpp	2008-12-14 10:32:09 UTC (rev 1598)
@@ -149,6 +149,8 @@
 			throw std::invalid_argument("Invalid  DOF specification `"+s+"', must be ?{x,y,z,rx,ry,rz}.");
 		}
 	}
+	python::tuple displ_get(){Vector3r ret=proxee->se3.position-proxee->refSe3.position; return python::make_tuple(ret[0],ret[1],ret[2]);}
+	python::tuple rot_get(){Quaternionr relRot=proxee->refSe3.orientation.Conjugate()*proxee->se3.orientation; Vector3r axis; Real angle; relRot.ToAxisAngle(axis,angle); axis*=angle; return python::make_tuple(axis[0],axis[1],axis[2]); }
 	python::tuple pos_get(){const Vector3r& p=proxee->se3.position; return python::make_tuple(p[0],p[1],p[2]);}
 	python::tuple refPos_get(){const Vector3r& p=proxee->refSe3.position; return python::make_tuple(p[0],p[1],p[2]);}
 	python::tuple ori_get(){Vector3r axis; Real angle; proxee->se3.orientation.ToAxisAngle(axis,angle); return python::make_tuple(axis[0],axis[1],axis[2],angle);}
@@ -619,6 +621,8 @@
 		.add_property("pos",&pyPhysicalParameters::pos_get,&pyPhysicalParameters::pos_set)
 		.add_property("ori",&pyPhysicalParameters::ori_get,&pyPhysicalParameters::ori_set)
 		.add_property("refPos",&pyPhysicalParameters::refPos_get,&pyPhysicalParameters::refPos_set)
+		.add_property("displ",&pyPhysicalParameters::displ_get)
+		.add_property("rot",&pyPhysicalParameters::rot_get)
 		;
 	BASIC_PY_PROXY_WRAPPER(pyBoundingVolume,"BoundingVolume");
 	BASIC_PY_PROXY_WRAPPER(pyInteractionGeometry,"InteractionGeometry");


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at arcig.cz  Sun Dec 14 16:14:27 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Sun, 14 Dec 2008 16:14:27 +0100
Subject: [deprecated list] [Yade-dev] detecting cut&paste in yade
Message-ID: <494522D3.2080203@arcig.cz>

Hi, using http://pmd.sourceforge.net, I got results on code that is
duplicated in our codebase. See the results here:
http://beta.arcig.cz/~eudoxos/yade/cut-and-paste.detected.txt.gz ... Vaclav

_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From richefeu at mail.berlios.de  Mon Dec 15 16:08:12 2008
From: richefeu at mail.berlios.de (richefeu at BerliOS)
Date: Mon, 15 Dec 2008 16:08:12 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1599 - trunk/extra/mgpost/src
Message-ID: <200812151508.mBFF8CQb009709@sheep.berlios.de>

Author: richefeu
Date: 2008-12-15 16:08:12 +0100 (Mon, 15 Dec 2008)
New Revision: 1599

Modified:
   trunk/extra/mgpost/src/Makefile.linux
   trunk/extra/mgpost/src/display_funcs.c
   trunk/extra/mgpost/src/ihm.c
   trunk/extra/mgpost/src/mgpost.c
Log:
- set menus in english mode


Modified: trunk/extra/mgpost/src/Makefile.linux
===================================================================
--- trunk/extra/mgpost/src/Makefile.linux	2008-12-14 10:32:09 UTC (rev 1598)
+++ trunk/extra/mgpost/src/Makefile.linux	2008-12-15 15:08:12 UTC (rev 1599)
@@ -14,8 +14,8 @@
 #  _LINUX     : compil on linux OS
 #  _WITH_TIFF : linked with libtiff
 
-CC      =g++
-CFLAGS  =-Wall -O3 -D_FR -D_GNU_SOURCE -D_LIBXML2 -D_LINUX -D_WITH_TIFF
+CC      =gcc
+CFLAGS  =-Wall -O3 -D_GNU_SOURCE -D_LIBXML2 -D_LINUX -D_WITH_TIFF
 LIBS    =-lGL -lGLU -lglut -lm -lxml2 -ltiff -lX11 -lXmu -lXi
 LIBSDIR =-L/usr/X11R6/lib 
 INC_DIR =-I/usr/include/libxml2

Modified: trunk/extra/mgpost/src/display_funcs.c
===================================================================
--- trunk/extra/mgpost/src/display_funcs.c	2008-12-14 10:32:09 UTC (rev 1598)
+++ trunk/extra/mgpost/src/display_funcs.c	2008-12-15 15:08:12 UTC (rev 1599)
@@ -2053,8 +2053,7 @@
   GLdouble Xcam = Xviewp * TRANS_CAM_FACTOR, Ycam = Yviewp * TRANS_CAM_FACTOR;
   int coul;
   float save_valc_bleu, save_valc_rouge;
-  double dist;
-  double l, ls, lc, sina, cosa;
+  double l;
 
   save_valc_bleu = valc_bleu;
   save_valc_rouge = valc_rouge;

Modified: trunk/extra/mgpost/src/ihm.c
===================================================================
--- trunk/extra/mgpost/src/ihm.c	2008-12-14 10:32:09 UTC (rev 1598)
+++ trunk/extra/mgpost/src/ihm.c	2008-12-15 15:08:12 UTC (rev 1599)
@@ -1974,184 +1974,190 @@
 void 
 mgp_buildmenu()
 {
-  int popupmenu, submenu1, submenu2, submenu3, submenu4, submenu5, submenu6;
+        int popupmenu, submenu1, submenu2, submenu3, submenu4, submenu5, submenu6;
   
 #ifdef _FR
-  submenu1 = glutCreateMenu(traitsubmenu1);	/* OPTIONS */
-  glutAddMenuEntry("Fond blanc", 0);
-  glutAddMenuEntry("Fond fun", 1);
-  glutAddMenuEntry("Fond Noir", 2);
-  glutAddMenuEntry("Traits blanc", 5);
-  glutAddMenuEntry("Traits bleu", 6);
-  glutAddMenuEntry("Traits Noir", 7);
-  glutAddMenuEntry("Transparence ON/OFF", 3);
-  glutAddMenuEntry("Section ON/OFF", 4);
-  
-  submenu2 = glutCreateMenu(traitsubmenu2);	/* outils */
-  glutAddMenuEntry("Informations sur l'echantillon", 15);
-  glutAddMenuEntry("Quadrillage de l'echantillon", 2);
-  if (with_layers) glutAddMenuEntry("Couches geologiques", 34);
-  glutAddMenuEntry("Champ de vitesses", 12);
-  glutAddMenuEntry("Anisotropie", 22);
-  glutAddMenuEntry("Evolution Anisotropie", 24);
-  glutAddMenuEntry("Informations sur les gaps", 26);
-  glutAddMenuEntry("Direction des contacts", 30);
-  glutAddMenuEntry("fn vs ft", 16);
-  glutAddMenuEntry("pdf(fn)", 14);
-  glutAddMenuEntry("Granulometrie", 27);
-  glutAddMenuEntry("Forces locales", 35);
-  
-  submenu3 = glutCreateMenu(traitsubmenu2);	/* rendu des corps */
-  glutAddMenuEntry("Rien", 10);
-  glutAddMenuEntry("Nombre de coordination", 32);
- 	glutAddMenuEntry("Contour", 13);
-  glutAddMenuEntry("Couleurs", 19);
-  glutAddMenuEntry("Tailles", 36);
-    /* 	glutAddMenuEntry("Deformations 11", 27); */
-    /* 	glutAddMenuEntry("Deformations 22", 28); */
-	glutAddMenuEntry("Vitesses angulaires (2D)", 8);
-	glutAddMenuEntry("Norme vitesses", 11);
-	/* glutAddMenuEntry ("Deplacements X cumul?s", 19); */
-	/* glutAddMenuEntry ("Deplacements Y cumul?s", 20); */
-	glutAddMenuEntry("Distance / reference", 21);
-    
-	submenu4 = glutCreateMenu(traitsubmenu2);	/* rendu des
-      * interactions */
-	glutAddMenuEntry("Rien", 0);
-	glutAddMenuEntry("Liste de Verlet", 1);
-	glutAddMenuEntry("Liens colles", 9);
+        submenu1 = glutCreateMenu(traitsubmenu1);
+        glutAddMenuEntry("Fond blanc", 0);
+        glutAddMenuEntry("Fond fun", 1);
+        glutAddMenuEntry("Fond Noir", 2);
+        glutAddMenuEntry("Traits blanc", 5);
+        glutAddMenuEntry("Traits bleu", 6);
+        glutAddMenuEntry("Traits Noir", 7);
+        glutAddMenuEntry("Transparence ON/OFF", 3);
+        glutAddMenuEntry("Section ON/OFF", 4);
+        
+        submenu2 = glutCreateMenu(traitsubmenu2);
+        glutAddMenuEntry("Informations sur l'echantillon", 15);
+        glutAddMenuEntry("Quadrillage de l'echantillon", 2);
+        if (with_layers) glutAddMenuEntry("Couches geologiques", 34);
+        glutAddMenuEntry("Champ de vitesses", 12);
+        glutAddMenuEntry("Anisotropie", 22);
+        glutAddMenuEntry("Evolution Anisotropie", 24);
+        glutAddMenuEntry("Informations sur les gaps", 26);
+        glutAddMenuEntry("Direction des contacts", 30);
+        glutAddMenuEntry("fn vs ft", 16);
+        glutAddMenuEntry("pdf(fn)", 14);
+        glutAddMenuEntry("Granulometrie", 27);
+        glutAddMenuEntry("Forces locales", 35);
+        
+        submenu3 = glutCreateMenu(traitsubmenu2);
+        glutAddMenuEntry("Rien", 10);
+        glutAddMenuEntry("Nombre de coordination", 32);
+        glutAddMenuEntry("Contour", 13);
+        glutAddMenuEntry("Couleurs", 19);
+        glutAddMenuEntry("Tailles", 36);
+        glutAddMenuEntry("Vitesses angulaires (2D)", 8);
+        glutAddMenuEntry("Norme vitesses", 11);
+        glutAddMenuEntry("Distance / reference", 21);
+        
+        submenu4 = glutCreateMenu(traitsubmenu2);
+        glutAddMenuEntry("Rien", 0);
+        glutAddMenuEntry("Liste de Verlet", 1);
+        glutAddMenuEntry("Liens colles", 9);
         glutAddMenuEntry("Fissures", 28);
-	/* glutAddMenuEntry ("Efforts normaux", 3); */
-	glutAddMenuEntry("Forces normales sup. seuil", 31);
-	glutAddMenuEntry("Forces", 33);
-  glutAddMenuEntry("Forces des fichiers for.out.xxx", 3);
-  glutAddMenuEntry("lignes de couleur pour fn", 20);
-  glutAddMenuEntry("Forces en compression et en traction", 7);
-	glutAddMenuEntry("Forces normales positives", 5);
-	glutAddMenuEntry("Forces normales negatives", 6);
-	glutAddMenuEntry("Forces tangentielles (val. abs.)", 4);
-	glutAddMenuEntry("Efforts de couple", 25);
-	glutAddMenuEntry("Vitesse relative tangente", 17);
-	glutAddMenuEntry("Volumes des ponts liquides", 29);
-    /* 	glutAddMenuEntry("Forces de cohesion", 34); */
-    
-	submenu5 = glutCreateMenu(traitsubmenu4);	/* Screenshots -
-      * exportations */
-	glutAddMenuEntry("Image TIFF", 0);
-	glutAddMenuEntry("Serie d'images(TIFF)", 1);
-	glutAddMenuEntry("Image EPS avec gl2ps", 2);
-	glutAddMenuEntry("Image EPS (2D)", 6);
-	glutAddMenuEntry("Fichier 'BODIES.DAT'", 3);
-	glutAddMenuEntry("Fichier 'export.cin'", 4);
-	glutAddMenuEntry("Fichier 'shot.pov'", 5);
+        glutAddMenuEntry("Forces normales sup. seuil", 31);
+        glutAddMenuEntry("Forces", 33);
+        glutAddMenuEntry("Forces des fichiers for.out.xxx", 3);
+        glutAddMenuEntry("lignes de couleur pour fn", 20);
+        glutAddMenuEntry("Forces en compression et en traction", 7);
+        glutAddMenuEntry("Forces normales positives", 5);
+        glutAddMenuEntry("Forces normales negatives", 6);
+        glutAddMenuEntry("Forces tangentielles (val. abs.)", 4);
+        glutAddMenuEntry("Efforts de couple", 25);
+        glutAddMenuEntry("Vitesse relative tangente", 17);
+        glutAddMenuEntry("Volumes des ponts liquides", 29);
+        
+        submenu5 = glutCreateMenu(traitsubmenu4);
+        glutAddMenuEntry("Image TIFF", 0);
+        glutAddMenuEntry("Serie d'images(TIFF)", 1);
+        glutAddMenuEntry("Image EPS avec gl2ps", 2);
+        glutAddMenuEntry("Image EPS (2D)", 6);
+        glutAddMenuEntry("Fichier 'BODIES.DAT'", 3);
+        glutAddMenuEntry("Fichier 'export.cin'", 4);
+        glutAddMenuEntry("Fichier 'shot.pov'", 5);
         glutAddMenuEntry("Fichier 'particles.Rxy'", 7);
         glutAddMenuEntry("Fichier 'deplacement.txt'", 8); 
-  
+        
         submenu6 = glutCreateMenu(traitsubmenuFluid);
         glutAddMenuEntry("Rien", 0);
         glutAddMenuEntry("Vitesses horizontales", 1);
         glutAddMenuEntry("Vitesses verticales", 2);
         glutAddMenuEntry("Norme vitesses", 3);
         glutAddMenuEntry("Pressions", 4);
+        
+        popupmenu = glutCreateMenu(traitmenu);
+        glutAddMenuEntry("defiler les etats", 5);
+        if (multifiles) {
+                glutAddMenuEntry("Etat Precedent", 7);
+                glutAddMenuEntry("Etat Suivant", 8);
+        }
+        glutAddMenuEntry("Editer mgconf", 6);
+        glutAddMenuEntry("Recharger mgconf", 4);
+        glutAddMenuEntry("Sauver mgpview", 9);
+        glutAddMenuEntry("Recharger mgpview", 10);
+        glutAddMenuEntry("Vue 3D", 3);
+        glutAddMenuEntry("Plan XY", 2);
+        glutAddMenuEntry("Plan XZ", 1);
+        glutAddSubMenu("Options", submenu1);
+        glutAddSubMenu("Outils", submenu2);
+        glutAddSubMenu("Rendu des corps", submenu3);
+        glutAddSubMenu("Rendu des interactions", submenu4);
+        glutAddSubMenu("Exportations", submenu5);
+        if (with_fluid) glutAddSubMenu("Fluide", submenu6);
+        glutAddMenuEntry("Quitter", 0);
     
-	popupmenu = glutCreateMenu(traitmenu);	/* menu PRINCIPAL */
-	glutAddMenuEntry("defiler les etats", 5);
-	if (multifiles) {
-      glutAddMenuEntry("Etat Precedent", 7);
-      glutAddMenuEntry("Etat Suivant", 8);
-	}
-	glutAddMenuEntry("Editer mgconf", 6);
-	glutAddMenuEntry("Recharger mgconf", 4);
-	glutAddMenuEntry("Sauver mgpview", 9);
-	glutAddMenuEntry("Recharger mgpview", 10);
-	glutAddMenuEntry("Vue 3D", 3);
-	glutAddMenuEntry("Plan XY", 2);
-	glutAddMenuEntry("Plan XZ", 1);
-	glutAddSubMenu("Options", submenu1);
-	glutAddSubMenu("Outils", submenu2);
-	glutAddSubMenu("Rendu des corps", submenu3);
-	glutAddSubMenu("Rendu des interactions", submenu4);
-	glutAddSubMenu("Exportations", submenu5);
-  if (with_fluid) glutAddSubMenu("Fluide", submenu6);
-	glutAddMenuEntry("Quitter", 0);
+#else	/* English */
     
-#else				/* English */
-    
-	submenu1 = glutCreateMenu(traitsubmenu1);	/* OPTIONS */
-	glutAddMenuEntry("White background", 0);
-	glutAddMenuEntry("Blue background", 1);
-	glutAddMenuEntry("Black background", 2);
-	glutAddMenuEntry("White foreground", 5);
-	glutAddMenuEntry("Blue foreground", 6);
-	glutAddMenuEntry("Black foreground", 7);
-	glutAddMenuEntry("Transparency ON/OFF", 3);
-	glutAddMenuEntry("Section      ON/OFF", 4);
-    
-	submenu2 = glutCreateMenu(traitsubmenu2);	/* tools */
-	glutAddMenuEntry("Sample informations", 15);
-	glutAddMenuEntry("Squared sample", 2);
-	glutAddMenuEntry("Velocity field", 12);
-	glutAddMenuEntry("Anisotropy", 22);
-	glutAddMenuEntry("Anisotropy evolution", 24);
-	glutAddMenuEntry("Informations on gaps", 26);
-	glutAddMenuEntry("Contacts direction", 30);
-    
-	submenu3 = glutCreateMenu(traitsubmenu2);	/* bodies render */
-	glutAddMenuEntry("Nothing", 10);
-	glutAddMenuEntry("Coordination Number", 32);
-    /* 	glutAddMenuEntry("Stresses 11", 13); */
-    /* 	glutAddMenuEntry("Stresses 22", 14); */
-    /* 	glutAddMenuEntry("Strains 11", 27); */
-    /* 	glutAddMenuEntry("Strains 22", 28); */
-	glutAddMenuEntry("Angular Velocity (2D)", 8);
-	glutAddMenuEntry("Velocity magnitude", 11);
-    /* 	glutAddMenuEntry("Cumulated X deplacements", 19); */
-    /* 	glutAddMenuEntry("Cumulated Y deplacements", 20); */
-	glutAddMenuEntry("Cumulated deplacements", 21);
-    
-	submenu4 = glutCreateMenu(traitsubmenu2);	/* interactions render */
-	glutAddMenuEntry("Nothing", 0);
-	glutAddMenuEntry("Verlet list", 1);
-	glutAddMenuEntry("Sticks links", 9);
-	/* glutAddMenuEntry ("Normal strength", 3); */
-	glutAddMenuEntry("Strong/weak Networks", 31);
-	glutAddMenuEntry("Strength", 33);
-	glutAddMenuEntry("Positives normal strength", 5);
-	glutAddMenuEntry("Negatives normal strength", 6);
-	glutAddMenuEntry("Tangentials strength", 4);
-	glutAddMenuEntry("Couple strength", 25);
-	glutAddMenuEntry("tangentials relatives velocities", 17);
-	glutAddMenuEntry("Volume of liquid bonds", 29);
-    
-	submenu5 = glutCreateMenu(traitsubmenu4);	/* Screenshots */
-	glutAddMenuEntry("Picture TIFF", 0);
-	glutAddMenuEntry("List of pictures TIFF", 1);
-	glutAddMenuEntry("Picture EPS using gl2ps", 2);
-	glutAddMenuEntry("Picture EPS (2D)", 6);
-	glutAddMenuEntry("File 'BODIES.DAT'", 3);
-	glutAddMenuEntry("File 'export.cin'", 4);
-	glutAddMenuEntry("File 'shot.pov'", 5);
+        submenu1 = glutCreateMenu(traitsubmenu1);
+        glutAddMenuEntry("White background", 0);
+        glutAddMenuEntry("Custom background", 1);
+        glutAddMenuEntry("Black background", 2);
+        glutAddMenuEntry("White foreground", 5);
+        glutAddMenuEntry("Blue foreground", 6);
+        glutAddMenuEntry("Black foreground", 7);
+        glutAddMenuEntry("Transparency ON/OFF", 3);
+        glutAddMenuEntry("Section      ON/OFF", 4);
+        
+        submenu2 = glutCreateMenu(traitsubmenu2);
+        glutAddMenuEntry("Sample informations", 15);
+        glutAddMenuEntry("Squared sample", 2);
+        if (with_layers) glutAddMenuEntry("Geologic layers", 34);
+        glutAddMenuEntry("Velocity field", 12);
+        glutAddMenuEntry("Anisotropy", 22);
+        glutAddMenuEntry("Anisotropy evolution", 24);
+        glutAddMenuEntry("Informations on gaps", 26);
+        glutAddMenuEntry("Contacts direction", 30);
+        glutAddMenuEntry("fn vs ft", 16);
+        glutAddMenuEntry("pdf(fn)", 14);
+        glutAddMenuEntry("Granulometry", 27);
+        glutAddMenuEntry("Local forces", 35);
+                
+        submenu3 = glutCreateMenu(traitsubmenu2);
+        glutAddMenuEntry("Nothing", 10);
+        glutAddMenuEntry("Coordination Number", 32);
+        glutAddMenuEntry("Outline", 13);
+        glutAddMenuEntry("Colors", 19);
+        glutAddMenuEntry("Sizes", 36);
+        glutAddMenuEntry("Angular Velocity (2D)", 8);
+        glutAddMenuEntry("Velocity magnitude", 11);
+        glutAddMenuEntry("Cumulated displacements", 21);
+        
+        submenu4 = glutCreateMenu(traitsubmenu2);
+        glutAddMenuEntry("Nothing", 0);
+        glutAddMenuEntry("Verlet list", 1);
+        glutAddMenuEntry("Sticks links", 9);
+        glutAddMenuEntry("Cracks", 28);
+        glutAddMenuEntry("Strong/weak Networks", 31);
+        glutAddMenuEntry("Forces", 33);
+        glutAddMenuEntry("Forces from files for.out.xxx", 3);
+        glutAddMenuEntry("Color lines for normal force", 20);
+        glutAddMenuEntry("Compressive and tensile force", 7);
+        glutAddMenuEntry("Positives normal force", 5);
+        glutAddMenuEntry("Negatives normal force", 6);
+        glutAddMenuEntry("Tangentials force", 4);
+        glutAddMenuEntry("Moment", 25);
+        glutAddMenuEntry("Tangential relative velocity", 17);
+        glutAddMenuEntry("Liquid bond Volume", 29);
+        
+        submenu5 = glutCreateMenu(traitsubmenu4);
+        glutAddMenuEntry("Picture TIFF", 0);
+        glutAddMenuEntry("List of pictures TIFF", 1);
+        glutAddMenuEntry("Picture EPS using gl2ps", 2);
+        glutAddMenuEntry("Picture EPS (2D)", 6);
+        glutAddMenuEntry("File 'BODIES.DAT'", 3);
+        glutAddMenuEntry("File 'export.cin'", 4);
+        glutAddMenuEntry("File 'shot.pov'", 5);
+        glutAddMenuEntry("File 'particles.Rxy'", 7);
         glutAddMenuEntry("File 'deplacement.txt'", 8);        
-    
-	popupmenu = glutCreateMenu(traitmenu);	/* main menu */
-	glutAddMenuEntry("Run the states", 5);
-	if (multifiles) {
-      glutAddMenuEntry("Previous state", 7);
-      glutAddMenuEntry("Next state", 8);
-	}
-	glutAddMenuEntry("Edit mgconf", 6);
-	glutAddMenuEntry("Reload mgconf", 4);
-	glutAddMenuEntry("Save mgpview", 9);
-	glutAddMenuEntry("Reload mgpview", 10);
-	glutAddMenuEntry("3D view", 3);
-	glutAddMenuEntry("XY plan", 2);
-	glutAddMenuEntry("XZ plan", 1);
-	glutAddSubMenu("Options", submenu1);
-	glutAddSubMenu("Tools", submenu2);
-	glutAddSubMenu("Bodies render", submenu3);
-	glutAddSubMenu("Interactions render", submenu4);
-	glutAddSubMenu("Export", submenu5);
-	glutAddMenuEntry("Quit", 0);
+        
+        submenu6 = glutCreateMenu(traitsubmenuFluid);
+        glutAddMenuEntry("Nothing", 0);
+        glutAddMenuEntry("Horizontal velocity", 1);
+        glutAddMenuEntry("Vertical velocity", 2);
+        glutAddMenuEntry("Velocity magnitude", 3);
+        glutAddMenuEntry("Pressure", 4);
+        
+        popupmenu = glutCreateMenu(traitmenu);
+        glutAddMenuEntry("Run", 5);
+        if (multifiles) {
+                glutAddMenuEntry("Previous state", 7);
+                glutAddMenuEntry("Next state", 8);
+        }
+        glutAddMenuEntry("Edit mgconf", 6);
+        glutAddMenuEntry("Reload mgconf", 4);
+        glutAddMenuEntry("Save mgpview", 9);
+        glutAddMenuEntry("Reload mgpview", 10);
+        glutAddMenuEntry("3D view", 3);
+        glutAddMenuEntry("XY plan", 2);
+        glutAddMenuEntry("XZ plan", 1);
+        glutAddSubMenu("Options", submenu1);
+        glutAddSubMenu("Tools", submenu2);
+        glutAddSubMenu("Body rendering", submenu3);
+        glutAddSubMenu("Interaction rendering", submenu4);
+        glutAddSubMenu("Export", submenu5);
+        if (with_fluid) glutAddSubMenu("Fluide", submenu6);
+        glutAddMenuEntry("Quit", 0);
 #endif
     
 }

Modified: trunk/extra/mgpost/src/mgpost.c
===================================================================
--- trunk/extra/mgpost/src/mgpost.c	2008-12-14 10:32:09 UTC (rev 1598)
+++ trunk/extra/mgpost/src/mgpost.c	2008-12-15 15:08:12 UTC (rev 1599)
@@ -72,7 +72,7 @@
 
 	mgpost_init(argc, argv);
 
-	sprintf(mgpost_string, "mgpost %s, 2001-2008 V.Richefeu <richefeu at lmgc.univ-montp2.fr>", MGP_VERSION);
+	sprintf(mgpost_string, "mgpost %s, 2001-2008 V.Richefeu <vincent.richefeu at hmg.inpg.fr>", MGP_VERSION);
 
 	fprintf(stdout, "\n    mgpost version %s,\n", MGP_VERSION);
 	fprintf(stdout, "    Vincent Richefeu\n");


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp

From eudoxos at arcig.cz  Mon Dec 15 20:03:27 2008
From: eudoxos at arcig.cz (=?ISO-8859-2?Q?V=E1clav_=A9milauer?=)
Date: Mon, 15 Dec 2008 20:03:27 +0100
Subject: [deprecated list] [Yade-dev] [Yade-users] dissipating all
	energy in a packing
In-Reply-To: <494635D6.5090303@univ-nantes.fr>
References: <49462BB8.8050605@arcig.cz> <494635D6.5090303@univ-nantes.fr>
Message-ID: <4946A9FF.1020401@arcig.cz>


> Whatever the method you use to damp particle movements I suspect the
> system to reach a vanishing value of kinetic energy asymptotically.
> Thus, if it the case, you can wait a very long time to obtain values
> of kinetic energy as small as you want...
Sorry to be unclear: the kinetic energy doesn't decrease from the point
where it hits some bottom line (around 1e-9 in this case), and
oscillates around this value. I suspect the way Cundall damps motion to
be blamed. Well, I will try and see. Best, Vaclav
>
> But DEM is not the only method to perform discrete computations and
> static method based only on geometrical aspects without integrating
> Newton's law, allow to perform very accurate computations (for
> instance about the definitions of contact). See for intance the works
> done by Roux and Combe.


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From richefeu at mail.berlios.de  Tue Dec 16 14:50:57 2008
From: richefeu at mail.berlios.de (richefeu at BerliOS)
Date: Tue, 16 Dec 2008 14:50:57 +0100
Subject: [deprecated list] [Yade-dev] [svn] r1601 - trunk/extra/mgpost/doc
Message-ID: <200812161350.mBGDovci027112@sheep.berlios.de>

Author: richefeu
Date: 2008-12-16 14:50:57 +0100 (Tue, 16 Dec 2008)
New Revision: 1601

Added:
   trunk/extra/mgpost/doc/refart.cls
Log:
a forgotten file in mgpost/doc



Added: trunk/extra/mgpost/doc/refart.cls
===================================================================
--- trunk/extra/mgpost/doc/refart.cls	2008-12-16 13:45:18 UTC (rev 1600)
+++ trunk/extra/mgpost/doc/refart.cls	2008-12-16 13:50:57 UTC (rev 1601)
@@ -0,0 +1,901 @@
+%%
+%% This is file `refart.cls',
+%% generated with the docstrip utility.
+%%
+%% The original source files were:
+%%
+%% refman.dtx  (with options: `refart')
+%% 
+%% Copyright (C) 1988-1994 by H. Partl.
+%% Copyright (C) 1994-1999 by Axel Kielhorn.  All rights reserved.
+%% For additional copyright information see further down in this file.
+%% 
+%% This file is to be used with the LaTeX2e system.
+%% ------------------------------------------------
+%% 
+%% This program can be redistributed and/or modified under the terms
+%% of the LaTeX Project Public License Distributed from CTAN
+%% archives in directory macros/latex/base/lppl.txt; either
+%% version 1 of the License, or any later version.
+%% 
+%% \CharacterTable
+%%  {Upper-case    \A\B\C\D\E\F\G\H\I\J\K\L\M\N\O\P\Q\R\S\T\U\V\W\X\Y\Z
+%%   Lower-case    \a\b\c\d\e\f\g\h\i\j\k\l\m\n\o\p\q\r\s\t\u\v\w\x\y\z
+%%   Digits        \0\1\2\3\4\5\6\7\8\9
+%%   Exclamation   \!     Double quote  \"     Hash (number) \#
+%%   Dollar        \$     Percent       \%     Ampersand     \&
+%%   Acute accent  \'     Left paren    \(     Right paren   \)
+%%   Asterisk      \*     Plus          \+     Comma         \,
+%%   Minus         \-     Point         \.     Solidus       \/
+%%   Colon         \:     Semicolon     \;     Less than     \<
+%%   Equals        \=     Greater than  \>     Question mark \?
+%%   Commercial at \@     Left bracket  \[     Backslash     \\
+%%   Right bracket \]     Circumflex    \^     Underscore    \_
+%%   Grave accent  \`     Left brace    \{     Vertical bar  \|
+%%   Right brace   \}     Tilde         \~}
+\NeedsTeXFormat{LaTeX2e}[1995/12/01]
+\ProvidesClass{refart}
+              [2006/11/13 v2.0e
+     LaTeX document class]
+\newcommand\@ptsize{}
+\newif\if at restonecol
+\newif\if at titlepage
+\@titlepagefalse
+\DeclareOption{a4paper}
+   {\setlength\paperheight {297mm}%
+    \setlength\paperwidth  {210mm}}
+\DeclareOption{a5paper}
+   {\setlength\paperheight {210mm}%
+    \setlength\paperwidth  {148mm}}
+\DeclareOption{b5paper}
+   {\setlength\paperheight {250mm}%
+    \setlength\paperwidth  {176mm}}
+\DeclareOption{letterpaper}
+   {\setlength\paperheight {11in}%
+    \setlength\paperwidth  {8.5in}}
+\DeclareOption{legalpaper}
+   {\setlength\paperheight {14in}%
+    \setlength\paperwidth  {8.5in}}
+\DeclareOption{executivepaper}
+   {\setlength\paperheight {10.5in}%
+    \setlength\paperwidth  {7.25in}}
+\newlength\papermarginwidth
+\setlength\papermarginwidth  {1in}
+\DeclareOption{smallborder}
+   {\setlength\papermarginwidth  {0.25in}}
+\DeclareOption{landscape}
+   {\setlength\@tempdima   {\paperheight}%
+    \setlength\paperheight {\paperwidth}%
+    \setlength\paperwidth  {\@tempdima}}
+\DeclareOption{square}
+   {\setlength\paperheight {\paperwidth}}
+\DeclareOption{dvips}{\AtBeginDocument{\AtBeginDvi{%
+      \special{papersize=\the\paperwidth,\the\paperheight}}}}
+
+\DeclareOption{pdftex}{\AtBeginDocument{%
+    \pdfpagewidth=\paperwidth \pdfpageheight=\paperheight}}
+\newcommand{\ref at ifpdfoutput}[2]{%
+  \begingroup\@ifundefined{pdfoutput}{\endgroup #2}{\endgroup%
+    \ifnum\pdfoutput>0\relax #1\else #2\fi}}%
+\@ifundefined{ifpdfoutput}{%
+  \let\ifpdfoutput\ref at ifpdfoutput}{%
+\PackageInfo{refart}
+    {\string\ifpdfoutput\space already defined.\MessageBreak
+    If \string\ifpdfoutput\space does not behave like\MessageBreak
+    is is described at the Refman manual, try find out\MessageBreak
+    at which package \string\ifpdfoutput\space was defined.}}
+\DeclareOption{pagesize}{\AtBeginDocument{%
+    \ref at ifpdfoutput
+    {\pdfpagewidth=\paperwidth\pdfpageheight=\paperheight}
+    {\AtBeginDvi{\special{papersize=\the\paperwidth,\the\paperheight}}}}}
+\DeclareOption{10pt}{\renewcommand\@ptsize{0}}
+\DeclareOption{11pt}{\renewcommand\@ptsize{1}}
+\DeclareOption{12pt}{\renewcommand\@ptsize{2}}
+\DeclareOption{oneside}{\@twosidefalse \@mparswitchfalse}
+\DeclareOption{twoside}{\@twosidetrue  \@mparswitchtrue}
+\DeclareOption{draft}{\setlength\overfullrule{5pt}}
+\DeclareOption{final}{\setlength\overfullrule{0pt}}
+\DeclareOption{titlepage}  {\@titlepagetrue}
+\DeclareOption{notitlepage}{\@titlepagefalse}
+\DeclareOption{onecolumn}{\@twocolumnfalse}
+\DeclareOption{twocolumn}{%
+    \ClassError{Refart}
+    {There is no twocolumn layout in this class!}
+    {Can you imagine how twocolumn layout will look\MessageBreak
+     in this class? That's why!}
+    \@twocolumnfalse}
+\DeclareOption{leqno}{\input{leqno.clo}}
+\DeclareOption{fleqn}{\input{fleqn.clo}}
+\DeclareOption{openbib}{%
+  \AtEndOfClass{%
+   \renewcommand\@openbib at code{%
+      \advance\leftmargin\bibindent
+      \itemindent -\bibindent
+      \listparindent \itemindent
+      \parsep \z@
+      }%
+   \renewcommand\newblock{\par}}%
+}
+\newif\ifdescriptioncolon \descriptioncolontrue
+\newif\ifdescriptionleft  \descriptionleftfalse
+\newif\ifmaxipagerule     \maxipageruletrue
+\ExecuteOptions{letterpaper,10pt,oneside,onecolumn,final}
+\ProcessOptions
+\input{size1\@ptsize.clo}
+\setlength\lineskip{1\p@}
+\setlength\normallineskip{1\p@}
+\renewcommand\baselinestretch{}
+\setlength\parskip   {0.5\baselineskip \@plus 2\p@}
+\setlength\parindent {\z@}
+\@lowpenalty   51
+\@medpenalty  151
+\@highpenalty 301
+\setlength\headsep   {\baselineskip}
+\newdimen\leftmarginwidth
+\newdimen\fullwidth
+\newdimen\emptyfoottopmargin
+\newdimen\emptyheadtopmargin
+\newcommand\settextfraction[1]%
+{
+  \setlength\fullwidth{\paperwidth}
+  \addtolength\fullwidth{-2\papermarginwidth}
+  \@settopoint\fullwidth
+  \if at twocolumn
+      \setlength\textwidth{\fullwidth}
+  \else
+      \setlength\textwidth{#1\fullwidth}
+  \fi
+  \@settopoint\textwidth
+  \setlength\leftmarginwidth{\fullwidth}
+  \addtolength\leftmarginwidth{-\textwidth}
+  \setlength\oddsidemargin    {-1in}
+  \addtolength\oddsidemargin  {\papermarginwidth}
+  \addtolength\oddsidemargin  {\leftmarginwidth}
+  \@settopoint\oddsidemargin
+  \setlength\evensidemargin  {\oddsidemargin}
+  \setlength\marginparwidth  {\leftmarginwidth
+  }
+  \addtolength\marginparwidth {-\marginparsep}
+  \setlength\marginparpush    {0\p@}
+}
+\@onlypreamble\settextfraction
+\settextfraction {0.7}
+
+\setlength\@tempdima  {\paperheight}
+\addtolength\@tempdima{-2\papermarginwidth}
+\addtolength\@tempdima{-.5in}
+\divide\@tempdima\baselineskip
+\@tempcnta=\@tempdima
+\setlength\textheight{\@tempcnta\baselineskip}
+\advance\textheight by \topskip
+\setlength\topmargin  {\paperheight}
+\addtolength\topmargin{-\headheight}
+\addtolength\topmargin{-\headsep}
+\addtolength\topmargin{-\textheight}
+\addtolength\topmargin{-\footskip}     % this might be wrong!
+\addtolength\topmargin{-.5\topmargin}
+\addtolength\topmargin{-1in}
+\@settopoint\topmargin
+\setlength\emptyfoottopmargin  {\topmargin}
+\addtolength\emptyfoottopmargin{\baselineskip}
+\setlength\emptyheadtopmargin  {\topmargin}
+\addtolength\emptyheadtopmargin{-\baselineskip}
+\setcounter{topnumber}    {2}
+\renewcommand\topfraction {.7}
+\setcounter{bottomnumber} {1}
+\renewcommand\bottomfraction{.3}
+\setcounter{totalnumber}  {3}
+\renewcommand\textfraction{.2}
+\renewcommand\floatpagefraction{.5}
+\setcounter{dbltopnumber} {2}
+\renewcommand\dbltopfraction{.7}
+\renewcommand\dblfloatpagefraction{.5}
+\if at twoside
+  \def\ps at plain{%
+    \let\@mkboth\@gobbletwo
+    \let\@oddhead\@empty
+    \let\@evenhead\@empty
+    \def\@oddfoot{\normalfont\hfil\thepage}
+    \def\@evenfoot{\normalfont\thepage\hfil}}
+\else
+  \def\ps at plain{%
+    \let\@mkboth\@gobbletwo
+    \let\@oddhead\@empty
+    \let\@evenhead\@empty
+    \def\@oddfoot{\normalfont\hfil\thepage}
+    \let\@evenfoot\@oddfoot}
+\fi
+\if at twoside
+    \def\ps at headings{%
+      \let\@oddfoot\@empty\let\@evenfoot\@empty
+      \def\@evenhead{\hss\vbox to \z@{\vss\hsize=\fullwidth
+      \hb at xt@\fullwidth{\thepage\hfil\slshape\leftmark}
+      \vskip 3\p@ \hrule}}%
+      \def\@oddhead{\hss\vbox to \z@{\vss\hsize=\fullwidth
+      \hb at xt@\fullwidth{{\slshape\rightmark}\hfil\thepage}
+      \vskip 3\p@ \hrule}}%
+      \let\@mkboth\markboth
+      \topmargin\emptyfoottopmargin
+      \def\sectionmark##1{%
+        \markboth {\ifnum \c at secnumdepth >\z@
+            \thesection\quad\fi
+            ##1}{}}%
+      \def\subsectionmark##1{%
+        \markright {\ifnum \c at secnumdepth >\@ne
+            \thesubsection\quad\fi
+            ##1}}}
+\else
+    \def\ps at headings{%
+      \let\@oddfoot\@empty
+      \def\@oddhead{\hss\vbox to \z@{\vss\hsize=\fullwidth
+      \hb at xt@\fullwidth{{\slshape\rightmark}\hfil\thepage}
+      \vskip 3\p@ \hrule}}%
+      \let\@mkboth\markboth
+      \topmargin\emptyfoottopmargin
+      \def\sectionmark##1{%
+        \markright {\ifnum \c at secnumdepth >\m at ne
+            \thesection\quad\fi
+            ##1}}}
+\fi
+
+\if at twoside
+    \def\ps at footings{%
+      \let\@oddhead\@empty\let\@evenhead\@empty
+      \def\@evenfoot{\hss\vbox to \z@{\vss\hsize=\fullwidth
+      \hrule \vskip 3\p@
+      \hb at xt@\fullwidth{\thepage\hfil\slshape\leftmark}}}%
+      \def\@oddfoot{\hss\vbox to \z@{\vss\hsize=\fullwidth
+      \hrule \vskip 3\p@
+      \hb at xt@\fullwidth{{\slshape\rightmark}\hfil\thepage}}}%
+      \let\@mkboth\markboth
+      \topmargin\emptyheadtopmargin
+      \def\sectionmark##1{%
+        \markboth {\ifnum \c at secnumdepth >\z@
+            \thesection\quad\fi
+            ##1}{}}%
+      \def\subsectionmark##1{%
+        \markright {\ifnum \c at secnumdepth >\@ne
+            \thesubsection\quad\fi
+            ##1}}}
+\else
+    \def\ps at footings{%
+      \let\@oddhead\@empty
+      \def\@oddfoot{\hss\vbox to \z@{\vss\hsize=\fullwidth
+      \hrule \vskip 3\p@
+      \hb at xt@\fullwidth{{\slshape\rightmark}\hfil\thepage}}}%
+      \let\@mkboth\markboth
+      \topmargin\emptyheadtopmargin
+      \def\sectionmark##1{%
+        \markright {\ifnum \c at secnumdepth >\m at ne
+            \thesection\quad\fi
+            ##1}}}
+\fi
+\def\ps at myheadings{%
+    \let\@oddfoot\@empty\let\@evenfoot\@empty
+    \def\@evenhead{\hss\vbox to \z@{\vss\hsize=\fullwidth
+    \hb at xt@\fullwidth{\thepage\hfil\slshape\leftmark}
+    \vskip 3\p@ \hrule}}%
+    \def\@oddhead{\hss\vbox to \z@{\vss\hsize=\fullwidth
+    \hb at xt@\fullwidth{{\slshape\rightmark}\hfil\thepage}
+    \vskip 3\p@ \hrule}}%
+    \let\@mkboth\@gobbletwo
+    \let\sectionmark\@gobble
+    \let\subsectionmark\@gobble
+    \topmargin\emptyfoottopmargin
+    }
+\def\ps at myfootings{%
+      \let\@oddhead\@empty\let\@evenhead\@empty
+      \def\@evenfoot{\hss\vbox to \z@{\vss\hsize=\fullwidth
+      \hrule \vskip 3\p@
+      \hb at xt@\fullwidth{\thepage\hfil\slshape\leftmark}}}%
+      \def\@oddfoot{\hss\vbox to \z@{\vss\hsize=\fullwidth
+      \hrule \vskip 3\p@
+      \hb at xt@\fullwidth{{\slshape\rightmark}\hfil\thepage}}}%
+    \let\@mkboth\@gobbletwo
+    \let\sectionmark\@gobble
+    \let\subsectionmark\@gobble
+    \topmargin\emptyheadtopmargin
+    }
+\if at titlepage
+  \newcommand\maketitle{\begin{titlepage}%
+  \let\footnotesize\small
+  \let\footnoterule\relax
+  \let\footnote\thanks
+  \renewcommand\thefootnote{\@fnsymbol\c at footnote}%
+  \def\@makefnmark%
+      {\rlap{\@textsuperscript{\normalfont\@thefnmark}}}%
+  \long\def\@makefntext##1{%
+       \@setpar{\@@par
+          \@tempdima = \hsize
+          \advance\@tempdima -1em
+          \parshape \@ne 1em \@tempdima}%
+       \par\parindent 1em \noindent
+       \hb at xt@\z@{\hss\@textsuperscript{\normalfont\@thefnmark}\,}##1}
+  \null\vfil
+  \vskip 60\p@
+  \begin{center}%
+    {\LARGE \@title \par}%
+    \vskip 3em%
+    {\large
+     \lineskip .75em%
+      \begin{tabular}[t]{c}%
+        \@author
+      \end{tabular}\par}%
+      \vskip 1.5em%
+    {\large \@date \par}%       % Set date in \large size.
+  \end{center}\par
+  \@thanks
+  \vfil\null
+  \end{titlepage}%
+  \setcounter{footnote}{0}%
+  \global\let\thanks\relax
+  \global\let\maketitle\relax
+  \global\let\@thanks\@empty
+  \global\let\@author\@empty
+  \global\let\@date\@empty
+  \global\let\@title\@empty
+  \global\let\title\relax
+  \global\let\author\relax
+  \global\let\date\relax
+  \global\let\and\relax
+  }
+\else
+  \newcommand\maketitle{\par
+    \begingroup
+      \renewcommand\thefootnote{\@fnsymbol\c at footnote}%
+      \def\@makefnmark%
+          {\rlap{\@textsuperscript{\normalfont\@thefnmark}}}%
+      \long\def\@makefntext##1{%
+         \@setpar{\@@par
+            \@tempdima = \hsize
+            \advance\@tempdima -1em
+            \parshape \@ne 1em \@tempdima}%
+         \par\parindent 1em \noindent
+         \hb at xt@\z@{\hss\@textsuperscript{\normalfont\@thefnmark}\,}##1}
+      \if at twocolumn
+        \ifnum \col at number=\@ne
+          \@maketitle
+        \else
+          \twocolumn[\@maketitle]%
+        \fi
+      \else
+        \newpage
+        \global\@topnum\z@   % Prevents figures from going at top of page.
+        \@maketitle
+      \fi
+      \thispagestyle{empty}\@thanks
+    \endgroup
+    \setcounter{footnote}{0}%
+  \global\let\thanks\relax
+  \global\let\maketitle\relax
+  \global\let\@maketitle\relax
+  \global\let\@thanks\@empty
+  \global\let\@author\@empty
+  \global\let\@date\@empty
+  \global\let\@title\@empty
+  \global\let\title\relax
+  \global\let\author\relax
+  \global\let\date\relax
+  \global\let\and\relax
+}
+  \def\@maketitle{%
+    \newpage
+    \null
+    \longthickrule\vskip1.5em%
+    \let \footnote \thanks
+    {\secshape \parskip\z@ \parindent\z@
+    \Large\bfseries \@title \par}%
+    \vskip1.5em\longthickrule\vskip1.5em%
+    {\normalsize
+      \lineskip .5em%
+      \begin{flushright}%
+        {\slshape\@author\par}
+        \vskip 1em%
+        {\@date}%
+      \end{flushright}\par}%
+    \vskip 1.5em}
+\fi
+\setcounter{secnumdepth}{3}
+\newcounter {part}
+\newcounter {section}
+\newcounter {subsection}[section]
+\newcounter {subsubsection}[subsection]
+\newcounter {paragraph}[subsubsection]
+\newcounter {subparagraph}[paragraph]
+\renewcommand\thepart          {\@Roman\c at part}
+\renewcommand\thesection       {\@arabic\c at section}
+\renewcommand\thesubsection    {\thesection.\@arabic\c at subsection}
+\renewcommand\thesubsubsection {\thesubsection .\@arabic\c at subsubsection}
+\renewcommand\theparagraph     {\thesubsubsection.\@arabic\c at paragraph}
+\renewcommand\thesubparagraph  {\theparagraph.\@arabic\c at subparagraph}
+\newcommand\part{%
+   \if at noskipsec \leavevmode \fi
+   \par
+   \addvspace{4ex}%
+   \@afterindentfalse
+   \secdef\@part\@spart}
+
+\def\@part[#1]#2{%
+    \ifnum \c at secnumdepth >\m at ne
+      \refstepcounter{part}%
+      \addcontentsline{toc}{part}{\thepart\hspace{1em}#1}%
+    \else
+      \addcontentsline{toc}{part}{#1}%
+    \fi
+     \longrule\medskip
+    {\parindent \z@ \raggedright
+     \interlinepenalty \@M
+     \normalfont
+     \Large
+     \ifnum \c at secnumdepth >\m at ne
+     \thepart.\quad
+     \fi
+     #2\par \medskip
+     \longrule\bigskip%
+     \markboth{}{}\par}%
+    \nobreak
+    \vskip 3ex
+    \@afterheading}
+\def\@spart#1{%
+    \longrule\medskip
+    {\parindent \z@ \raggedright
+     \interlinepenalty \@M
+     \normalfont
+     \Large #1\par}%
+    \medskip\longrule
+     \nobreak
+     \vskip 3ex
+     \@afterheading}
+\newcommand\secshape{\leftskip=-\leftmarginwidth%
+                     \rightskip=\@flushglue%
+                     \hyphenpenalty=2000}
+\newcommand\section{\@startsection {section}{1}{\z@}%
+                                   {-2ex \@plus -1ex \@minus -.2ex}%
+                                   {0.5ex \@plus .2ex}%
+                                   {\secshape\normalfont\large\bfseries}}
+\newcommand\subsection{\@startsection{subsection}{2}{\z@}%
+                                     {-1.5ex\@plus -.5ex \@minus -.2ex}%
+                                     {0.5ex \@plus .2ex}%
+                                     {\secshape\normalfont\normalsize\bfseries}}
+\newcommand\subsubsection{\@startsection{subsubsection}{3}{\z@}%
+                                     {-1.5ex\@plus -.5ex \@minus -.2ex}%
+                                     {0.5ex \@plus .2ex}%
+                                     {\secshape\normalfont\normalsize\mdseries}}
+\newcommand\paragraph{\@startsection{paragraph}{4}{\z@}%
+                                    {2ex\@plus 1ex \@minus .2ex}%
+                                    {-1em}%
+                                    {\normalfont\normalsize\bfseries}}
+\newcommand\subparagraph{\@startsection{subparagraph}{5}{\parindent}%
+                                       {2ex \@plus 1ex \@minus .2ex}%
+                                       {-1em}%
+                                       {\normalfont\normalsize\bfseries}}
+\if at twocolumn
+  \setlength\leftmargini  {2em}
+\else
+  \setlength\leftmargini  {2.5em}
+\fi
+\setlength\leftmarginii  {2.2em}
+\setlength\leftmarginiii {1.87em}
+\setlength\leftmarginiv  {1.7em}
+\if at twocolumn
+  \setlength\leftmarginv  {.5em}
+  \setlength\leftmarginvi {.5em}
+\else
+  \setlength\leftmarginv  {1em}
+  \setlength\leftmarginvi {1em}
+\fi
+\setlength\leftmargin    {\leftmargini}
+\setlength  \labelsep  {.5em}
+\setlength  \labelwidth{\leftmargini}
+\addtolength\labelwidth{-\labelsep}
+\@beginparpenalty -\@lowpenalty
+\@endparpenalty   -\@lowpenalty
+\@itempenalty     -\@lowpenalty
+\def\@listI{\leftmargin\leftmargini
+            \parsep \parskip
+            \topsep \z@
+            \itemsep\z@}
+\let\@listi\@listI
+\@listi
+\def\@listii {\leftmargin\leftmarginii
+              \labelwidth\leftmarginii
+              \advance\labelwidth-\labelsep
+              \topsep    \z@
+              \parsep    \parskip
+              \itemsep   \z@}
+\def\@listiii{\leftmargin\leftmarginiii
+              \labelwidth\leftmarginiii
+              \advance\labelwidth-\labelsep
+              \topsep    \z@
+              \parsep    \parskip
+              \partopsep \z@
+              \itemsep   \topsep}
+\def\@listiv {\leftmargin\leftmarginiv
+              \labelwidth\leftmarginiv
+              \advance\labelwidth-\labelsep}
+\def\@listv  {\leftmargin\leftmarginv
+              \labelwidth\leftmarginv
+              \advance\labelwidth-\labelsep}
+\def\@listvi {\leftmargin\leftmarginvi
+              \labelwidth\leftmarginvi
+              \advance\labelwidth-\labelsep}
+\renewcommand\theenumi  {\@arabic\c at enumi}
+\renewcommand\theenumii {\@alph\c at enumii}
+\renewcommand\theenumiii{\@roman\c at enumiii}
+\renewcommand\theenumiv {\@Alph\c at enumiv}
+\newcommand\labelenumi  {\theenumi.}
+\newcommand\labelenumii {(\theenumii)}
+\newcommand\labelenumiii{\theenumiii.}
+\newcommand\labelenumiv {\theenumiv.}
+\renewcommand\p at enumii  {\theenumi}
+\renewcommand\p at enumiii {\theenumi(\theenumii)}
+\renewcommand\p at enumiv  {\p at enumiii\theenumiii}
+\newcommand\labelitemi  {\textbullet}
+\newcommand\labelitemii {\normalfont\bfseries \textendash}
+\newcommand\labelitemiii{\textasteriskcentered}
+\newcommand\labelitemiv {\textperiodcentered}
+\newenvironment{description}
+               {\list{}{%
+                    \labelsep\marginparsep
+                    \labelwidth\leftmarginwidth
+                    \advance\labelwidth by \leftmargin
+                    \advance\labelwidth by -\labelsep
+                    \let\makelabel\descriptionlabel}}
+               {\endlist}
+\newcommand*\descriptionlabel[1]{%
+            \ifdescriptionleft\else \hfil\fi
+            \normalfont #1 \ifdescriptioncolon :\fi
+            \ifdescriptionleft \hfil \fi}
+\if at titlepage
+  \newenvironment{abstract}{%
+      \titlepage
+      \null\vfil
+      \@beginparpenalty\@lowpenalty
+      \begin{center}
+        \bfseries \abstractname
+        \@endparpenalty\@M
+      \end{center}}
+     {\par\vfil\null\endtitlepage}
+\else
+  \newenvironment{abstract}{%
+      \if at twocolumn
+        \section*{\abstractname}%
+      \else
+        \small
+        \begin{center}%
+          {\bfseries \abstractname\vspace{-.5em}\vspace{\z@}}%
+        \end{center}%
+        \quote
+      \fi}
+      {\if at twocolumn\else\endquote\fi}
+\fi
+\newenvironment{verse}
+               {\let\\=\@centercr
+                \list{}{\itemsep      \z@
+                        \itemindent   -1.5em%
+                        \listparindent\itemindent
+                        \rightmargin  \leftmargin
+                        \advance\leftmargin 1.5em}%
+                \item\relax}
+               {\endlist}
+\newenvironment{quotation}
+               {\list{}{\listparindent 1.5em%
+                        \itemindent    \listparindent
+                        \rightmargin   \leftmargin
+                        \parsep        \z@ \@plus\p@}%
+                \item\relax}
+               {\endlist}
+\newenvironment{quote}
+               {\list{}{\rightmargin\leftmargin}%
+                \item\relax}
+               {\endlist}
+\newenvironment{example}
+               {\@beginparpenalty=\@highpenalty
+               \let\\=\@centercr
+                \list{}{\itemsep      \z@
+                        \itemindent   -1.5em%
+                        \listparindent\itemindent
+                        \rightmargin  \leftmargin
+                        \advance\leftmargin 1.5em}%
+                \ttfamily
+                \item\relax}
+               {\endlist}
+\newenvironment{titlepage}
+               {\if at twocolumn
+                  \@restonecoltrue\onecolumn
+                \else
+                  \@restonecolfalse\newpage
+                \fi
+                \thispagestyle{empty}%
+                \setcounter{page}\@ne
+               }
+               {\if at restonecol\twocolumn \else \newpage \fi
+                \if at twoside\else
+                  \setcounter{page}\@ne
+                \fi
+               }
+\newcommand\appendix{\par
+  \setcounter{section}{0}%
+  \setcounter{subsection}{0}%
+  \gdef\thesection{\@Alph\c at section}}
+\setlength\arraycolsep   {5\p@}
+\setlength\tabcolsep     {6\p@}
+\setlength\arrayrulewidth{.4\p@}
+\setlength\doublerulesep {2\p@}
+\setlength\tabbingsep    {\labelsep}
+\skip\@mpfootins = \skip\footins
+\setlength\fboxsep {3\p@}
+\setlength\fboxrule{.4\p@}
+\renewcommand\theequation{\@arabic\c at equation}
+\newcounter{figure}
+\renewcommand \thefigure {\@arabic\c at figure}
+\def\fps at figure{tbp}
+\def\ftype at figure{1}
+\def\ext at figure{lof}
+\def\fnum at figure{\figurename~\thefigure}
+\newenvironment{figure}
+               {\@float{figure}}
+               {\end at float}
+\newenvironment{figure*}
+               {\@dblfloat{figure}}
+               {\end at dblfloat}
+\newcounter{table}
+\renewcommand\thetable{\@arabic\c at table}
+\def\fps at table{tbp}
+\def\ftype at table{2}
+\def\ext at table{lot}
+\def\fnum at table{\tablename~\thetable}
+\newenvironment{table}
+               {\@float{table}}
+               {\end at float}
+\newenvironment{table*}
+               {\@dblfloat{table}}
+               {\end at dblfloat}
+\newlength\abovecaptionskip
+\newlength\belowcaptionskip
+\setlength\abovecaptionskip{10\p@}
+\setlength\belowcaptionskip{0\p@}
+\long\def\@makecaption#1#2{%
+  \vskip\abovecaptionskip
+  \sbox\@tempboxa{#1: #2}%
+  \ifdim \wd\@tempboxa >\hsize
+    #1: #2\par
+  \else
+    \global \@minipagefalse
+    \hb at xt@\hsize{\hfil\box\@tempboxa\hfil}%
+  \fi
+  \vskip\belowcaptionskip}
+\DeclareOldFontCommand{\rm}{\normalfont\rmfamily}{\mathrm}
+\DeclareOldFontCommand{\sf}{\normalfont\sffamily}{\mathsf}
+\DeclareOldFontCommand{\tt}{\normalfont\ttfamily}{\mathtt}
+\DeclareOldFontCommand{\bf}{\normalfont\bfseries}{\mathbf}
+\DeclareOldFontCommand{\it}{\normalfont\itshape}{\mathit}
+\DeclareOldFontCommand{\sl}{\normalfont\slshape}{\@nomath\sl}
+\DeclareOldFontCommand{\sc}{\normalfont\scshape}{\@nomath\sc}
+\DeclareRobustCommand*{\cal}{\@fontswitch\relax\mathcal}
+\DeclareRobustCommand*{\mit}{\@fontswitch\relax\mathnormal}
+\newcommand\@pnumwidth{1.55em}
+\newcommand\@tocrmarg {2.55em}
+\newcommand\@dotsep   {4.5}
+\setcounter{tocdepth}{3}
+\newcommand\tableofcontents{%
+    \section*{\contentsname
+        \@mkboth{\contentsname}{\contentsname}}%
+    \@starttoc{toc}%
+    \if at restonecol\twocolumn\fi
+    }
+\newcommand*\l at part[2]{%
+  \ifnum \c at tocdepth >-2\relax
+    \addpenalty\@secpenalty
+    \addvspace{2.25em \@plus\p@}%
+    \begingroup
+      \parindent \z@ \rightskip \@pnumwidth
+      \parfillskip -\@pnumwidth
+      {\leavevmode
+       \large \bfseries #1\hfil \hbox to\@pnumwidth{\hss #2}}\par
+       \nobreak
+         \global\@nobreaktrue
+         \everypar{\global\@nobreakfalse\everypar{}}%
+      \endgroup
+  \fi}
+\newcommand*\l at section[2]{%
+  \ifnum \c at tocdepth >\z@
+    \addpenalty\@secpenalty
+    \addvspace{1.0em \@plus\p@}%
+    \setlength\@tempdima{1.5em}%
+    \begingroup
+    \parindent \z@ \rightskip \@pnumwidth
+    \parfillskip -\@pnumwidth
+    \leavevmode \bfseries
+    \advance\leftskip\@tempdima
+    \hskip -\leftskip
+    #1\nobreak\hfil \nobreak\hb at xt@\@pnumwidth{\hss #2}\par
+   \endgroup
+ \fi}
+\newcommand*\l at subsection   {\@dottedtocline{2}{1.5em}{2.3em}}
+\newcommand*\l at subsubsection{\@dottedtocline{3}{3.8em}{3.2em}}
+\newcommand*\l at paragraph    {\@dottedtocline{4}{7.0em}{4.1em}}
+\newcommand*\l at subparagraph {\@dottedtocline{5}{10em}{5em}}
+\newcommand\listoffigures{%
+    \section*{\listfigurename
+      \@mkboth{\listfigurename}%
+              {\listfigurename}}%
+    \@starttoc{lof}%
+    }
+\newcommand*\l at figure{\@dottedtocline{1}{1.5em}{2.3em}}
+\newcommand\listoftables{%
+    \section*{\listtablename
+      \@mkboth{\listtablename}{\listtablename}}%
+    \@starttoc{lot}%
+    }
+\let\l at table\l at figure
+\newdimen\bibindent
+\bibindent=1.5em
+\newenvironment{thebibliography}[1]
+     {\section*{\refname
+         \@mkboth{\refname}{\refname}}%
+      \list{\@biblabel{\@arabic\c at enumiv}}%
+           {\settowidth\labelwidth{\@biblabel{#1}}%
+            \leftmargin\labelwidth
+            \advance\leftmargin\labelsep
+            \@openbib at code
+            \usecounter{enumiv}%
+            \let\p at enumiv\@empty
+            \renewcommand\theenumiv{\@arabic\c at enumiv}}%
+            \sloppy
+            \clubpenalty4000
+            \@clubpenalty \clubpenalty
+            \widowpenalty4000%
+      \sfcode`\.=\@m}
+     {\def\@noitemerr
+       {\@latex at warning{Empty `thebibliography' environment}}%
+      \endlist}
+\newcommand\newblock{\hskip .11em\@plus.33em\@minus.07em}
+\let\@openbib at code\@empty
+\newenvironment{theindex}
+               {\if at twocolumn
+                  \@restonecolfalse
+                \else
+                  \@restonecoltrue
+                \fi
+                \begin{fullpage}
+                \let\twocolumn\REF at twocolumn
+                \columnseprule \z@
+                \columnsep 35\p@
+                \twocolumn[\section*{\indexname}]%
+                \@mkboth{\indexname}%
+                        {\indexname}%
+                \parindent\z@
+                \parskip\z@ \@plus .3\p@\relax
+                \let\item\@idxitem}
+               {\end{fullpage}\if at restonecol\onecolumn\else\clearpage\fi}
+\newcommand\@idxitem  {\par\hangindent 40\p@}
+\newcommand\subitem   {\@idxitem \hspace*{20\p@}}
+\newcommand\subsubitem{\@idxitem \hspace*{30\p@}}
+\newcommand\indexspace{\par \vskip 10\p@ \@plus5\p@ \@minus3\p@\relax}
+\renewcommand\footnoterule{%
+  \kern-3\p@
+  \hrule\@width.4\columnwidth
+  \kern 2.6\p@}
+\long\def\@makefntext#1{%
+   \@setpar{\@@par
+      \@tempdima = \hsize
+      \advance\@tempdima -1em
+      \parshape \@ne 1em \@tempdima}%
+    \par\parindent 1em \noindent
+    \hb at xt@\z@{\hss\@textsuperscript{\normalfont\@thefnmark}\,}#1}
+\def\@addmarginpar{\@next\@marbox\@currlist{\@cons\@freelist\@marbox
+    \@cons\@freelist\@currbox}\@latexbug\@tempcnta\@ne
+    \if at twocolumn
+       \if at firstcolumn \@tempcnta\m at ne \fi
+    \else
+       \@tempcnta\m at ne
+    \fi
+    \ifnum\@tempcnta <\z@  \global\setbox\@marbox\box\@currbox \fi
+    \@tempdima\@mparbottom
+    \advance\@tempdima -\@pageht
+    \advance\@tempdima\ht\@marbox
+    \ifdim\@tempdima >\z@
+       \@@warning{Marginpar on page \thepage\space moved}%
+    \else
+       \@tempdima\z@
+    \fi
+    \global\@mparbottom\@pageht
+    \global\advance\@mparbottom\@tempdima
+    \global\advance\@mparbottom\dp\@marbox
+    \global\advance\@mparbottom\marginparpush
+    \advance\@tempdima -\ht\@marbox
+    \global\setbox \@marbox
+    \vbox {\vskip \@tempdima \box \@marbox}%
+    \global \ht\@marbox \z@
+    \global \dp\@marbox \z@
+    \kern -\@pagedp
+    \nointerlineskip
+    \hb at xt@\columnwidth
+      {\ifnum \@tempcnta >\z@
+          \hskip\columnwidth \hskip\marginparsep
+       \else
+          \hskip -\marginparsep \hskip -\marginparwidth
+       \fi
+       \box\@marbox \hss}%
+    \nointerlineskip
+    \hbox{\vrule \@height\z@ \@width\z@ \@depth\@pagedp}}
+\newcommand*{\marginlabel}[1]
+{\mbox{}\marginpar{\raggedleft #1}\ignorespaces}
+\newcommand*{\seealso}[1]
+    {\mbox{}\marginpar{\small $\rightarrow$ #1}\ignorespaces}
+\newcommand*{\attention}[1][\attentionsymbol]
+    {\mbox{}\marginpar{\raggedleft #1}}
+\newcommand*{\attentionsymbol}{\large\bfseries ! $\rightarrow$}
+\def\longrule{\par\hb at xt@\linewidth{\hss
+              \vrule width \fullwidth height 0.4\p@ depth \z@}\par}
+\def\longthickrule{\par\hb at xt@\linewidth{\hss
+              \vrule width \fullwidth height 1.0\p@ depth \z@}\par}
+\newenvironment{maxipage}{\par
+              \mbox{}\kern-\leftmarginwidth %\kern-\@totalleftmargin
+              \begin{minipage}{\fullwidth}
+                \medskip \ifmaxipagerule \hrule\medskip \fi
+                \parskip = 0.5\baselineskip
+                \def\marginpar{%
+                \ClassError{Refart}
+                {Marginpar not allowed within Maxipage.}
+                {Where should I put them?\MessageBreak
+                 I'm using the full pagewidth.}}}
+              {\par \vskip\parskip
+                 \medskip \ifmaxipagerule \hrule\medskip \fi
+               \end{minipage}\par}
+\newenvironment{fullpage}{%
+              \clearpage
+              \textwidth=\fullwidth
+              \addtolength\oddsidemargin  {-\leftmarginwidth}
+              \setlength\evensidemargin{\oddsidemargin}
+              \leftmarginwidth=\z@
+              \hsize=\fullwidth
+              \linewidth=\fullwidth
+              \columnwidth=\fullwidth
+              \def\marginpar{%
+                \ClassError{Refart}
+                {Marginpar not allowed within Fullpage.}
+                {Where should I put them? I'm already\MessageBreak
+                 using the whole page for text.}}}
+              {\clearpage}
+\def\condbreak#1{\vskip \z@ plus #1\pagebreak[3]\vskip \z@ plus -#1\relax}
+\def\noparskip{\vskip-\parskip}
+\let\REF at twocolumn\twocolumn
+\def\twocolumn{%
+\ClassError{Refart}
+{Sorry, there is no twocolumn layout in this class}
+{Can you imagine how twocolumn layout will look?\MessageBreak
+ That's why!}}
+\newcommand\contentsname{Contents}
+\newcommand\listfigurename{List of Figures}
+\newcommand\listtablename{List of Tables}
+\newcommand\refname{References}
+\newcommand\indexname{Index}
+\newcommand\figurename{Figure}
+\newcommand\tablename{Table}
+\newcommand\partname{Part}
+\newcommand\appendixname{Appendix}
+\newcommand\abstractname{Abstract}
+\def\today{\ifcase\month\or
+  January\or February\or March\or April\or May\or June\or
+  July\or August\or September\or October\or November\or December\fi
+  \space\number\day, \number\year}
+\setlength\columnsep{10\p@}
+\setlength\columnseprule{0\p@}
+\pagestyle{plain}
+\pagenumbering{arabic}      % Arabic page numbers
+\if at twoside
+\else
+  \raggedbottom
+\fi
+\if at twocolumn
+  \twocolumn
+  \sloppy
+  \flushbottom
+\else
+  \onecolumn
+\fi
+\endinput
+%%
+%% End of file `refart.cls'.


_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


From eudoxos at arcig.cz  Sun Dec 21 00:13:17 2008
From: eudoxos at arcig.cz (eudoxos at arcig.cz)
Date: Sun, 21 Dec 2008 00:13:17 +0100 (CET)
Subject: [deprecated list] [Yade-dev] Automated crash report
	for	/tmp/yade-30952/bin/yade-svn1601:	DirectShearCis, FEMBeam,
	HydraulicTest, SDECImpactTest, STLImporterTest, SimpleShear,
	SnowVoxelsLoader, USCTGen
Message-ID: <20081220231318.0281798096@delta>

################################################################################
DirectShearCis: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `kascye'
Running script /tmp/yade-test-10173.py
Cannot find input file
Traceback (most recent call last):
  File "/tmp/yade-30952/lib/yade-svn1601/gui/PythonUI_rc.py", line 41, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-10173.py", line 3, in <module>
    Preprocessor('DirectShearCis').generate('/tmp/yade-test-10173.xml')
RuntimeError: Generator reported error: Cannot find input file

################################################################################
FEMBeam: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `sackdu'
Running script /tmp/yade-test-10173.py
/tmp/yade-30952/build-svn1601/include/yade-svn1601/yade/core/MetaEngine1D.hpp:57 WARNING! dynamic cast of engine unit FEMTetrahedronStiffness failed, will use static_cast. Go figure why.
/tmp/yade-30952/build-svn1601/include/yade-svn1601/yade/core/MetaEngine2D.hpp:61 WARNING! dynamic cast of engine unit FEMSet2Tetrahedrons failed, will use static_cast. Go figure why.
Traceback (most recent call last):
  File "/tmp/yade-30952/lib/yade-svn1601/gui/PythonUI_rc.py", line 41, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-10173.py", line 3, in <module>
    Preprocessor('FEMBeam').generate('/tmp/yade-test-10173.xml')
RuntimeError: Generator reported error: Cannot find input file, you can copy it from examples/ directory

################################################################################
HydraulicTest: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `kceyas'
Traceback (most recent call last):
  File "/tmp/yade-30952/lib/yade-svn1601/gui/PythonUI_rc.py", line 41, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-10173.py", line 3, in <module>
    Preprocessor('HydraulicTest').generate('/tmp/yade-test-10173.xml')
RuntimeError: Generator reported error: Error: cannot load the file that should contain spheres
Running script /tmp/yade-test-10173.py

################################################################################
SDECImpactTest: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `uysdca'
Traceback (most recent call last):
  File "/tmp/yade-30952/lib/yade-svn1601/gui/PythonUI_rc.py", line 41, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-10173.py", line 3, in <module>
    Preprocessor('SDECImpactTest').generate('/tmp/yade-test-10173.xml')
RuntimeError: Generator reported error: Cannot find input file, you can copy it from examples/ directory
Running script /tmp/yade-test-10173.py

################################################################################
STLImporterTest: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `dcuksa'
Running script /tmp/yade-test-10173.py
Import walls geometry from file: hourglass.stl
984 [139641089570608] ERROR yade.STLImporter  - lib/import/STLImporter.cpp:27 open: Can't open file: hourglass.stl
ERROR: Bad file: hourglass.stl
Traceback (most recent call last):
  File "/tmp/yade-30952/lib/yade-svn1601/gui/PythonUI_rc.py", line 41, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-10173.py", line 3, in <module>
    Preprocessor('STLImporterTest').generate('/tmp/yade-test-10173.xml')
RuntimeError: Generator reported error: Input file not found, you can copy it from examples/ directory or make one using blender 3D modelling

################################################################################
SimpleShear: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `sukcde'
Running script /tmp/yade-test-10173.py
Cannot find input file
Traceback (most recent call last):
  File "/tmp/yade-30952/lib/yade-svn1601/gui/PythonUI_rc.py", line 41, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-10173.py", line 3, in <module>
    Preprocessor('SimpleShear').generate('/tmp/yade-test-10173.xml')
RuntimeError: Generator reported error: Cannot find input file

################################################################################
SnowVoxelsLoader: generator CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `uksaye'
Traceback (most recent call last):
  File "/tmp/yade-30952/lib/yade-svn1601/gui/PythonUI_rc.py", line 41, in <module>
    try: execfile(runtime.script)
  File "/tmp/yade-test-10173.py", line 3, in <module>
    Preprocessor('SnowVoxelsLoader').generate('/tmp/yade-test-10173.xml')
RuntimeError: Generator reported error: cannot load txt yet, or nothing to load
Running script /tmp/yade-test-10173.py

################################################################################
USCTGen: simulation CRASH
################################################################################
Python TCP server listening on localhost:9001, auth cookie is `ksdecy'
yade-svn1601: extra/Brefcom.cpp:155: virtual void BrefcomLaw::action(MetaBody*): Assertion `contGeom->hasShear' failed.
Running script /tmp/yade-test-10173.py
SIGSEGV/SIGABRT handler called; gdb batch file is `/home/profesori/eudoxos/.yade-svn1601/gdb_crash_batch-pid11379'
GNU gdb 6.8-debian
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
[Thread debugging using libthread_db enabled]
[New Thread 0x7f9b37435730 (LWP 11379)]
[New Thread 0x42602950 (LWP 11390)]
[New Thread 0x41e01950 (LWP 11388)]
warning: Lowest section in /usr/lib/libicudata.so.38 is .hash at 0000000000000120
0x00007f9b36cdae81 in nanosleep () from /lib/libpthread.so.0
No symbol "info" in current context.

Thread 3 (Thread 0x41e01950 (LWP 11388)):
#0  0x00007f9b36cda7fb in accept () from /lib/libpthread.so.0
#1  0x00007f9b00632947 in ?? () from /usr/lib/python2.5/lib-dynload/_socket.so
#2  0x00007f9b36fa0b57 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#3  0x00007f9b36fa1893 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#4  0x00007f9b36fa1893 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#5  0x00007f9b36fa1893 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#6  0x00007f9b36fa2a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#7  0x00007f9b36f4270a in ?? () from /usr/lib/libpython2.5.so.1.0
#8  0x00007f9b36f20f23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#9  0x00007f9b36f2865f in ?? () from /usr/lib/libpython2.5.so.1.0
#10 0x00007f9b36f20f23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007f9b36f9ba1e in PyEval_CallObjectWithKeywords () from /usr/lib/libpython2.5.so.1.0
#12 0x00007f9b36fd0eed in ?? () from /usr/lib/libpython2.5.so.1.0
#13 0x00007f9b36cd33f7 in start_thread () from /lib/libpthread.so.0
#14 0x00007f9b33105b3d in clone () from /lib/libc.so.6
#15 0x0000000000000000 in ?? ()

Thread 2 (Thread 0x42602950 (LWP 11390)):
#0  0x00007f9b330cb4df in waitpid () from /lib/libc.so.6
#1  0x00007f9b3306c461 in ?? () from /lib/libc.so.6
#2  0x00007f9b3306c7e7 in system () from /lib/libc.so.6
#3  0x000000000057f56e in sigHandler (sig=6) at core/yade.cpp:60
#4  <signal handler called>
#5  0x00007f9b33060095 in raise () from /lib/libc.so.6
#6  0x00007f9b33061af0 in abort () from /lib/libc.so.6
#7  0x00007f9b330592df in __assert_fail () from /lib/libc.so.6
#8  0x00007f9b256b70dc in BrefcomLaw::action (this=0xed8850, _rootBody=0x91de40) at extra/Brefcom.cpp:155
#9  0x000000000051f517 in MetaBody::moveToNextTimeStep (this=0x91de40) at core/MetaBody.cpp:78
#10 0x00000000005764a1 in SimulationFlow::singleAction (this=0x832c10) at core/SimulationFlow.cpp:18
#11 0x00000000005783fb in ThreadWorker::callSingleAction (this=0x832c10) at core/ThreadWorker.cpp:71
#12 0x0000000000577bee in ThreadRunner::call (this=0xedbd20) at core/ThreadRunner.cpp:44
#13 0x0000000000577c54 in ThreadRunner::run (this=0xedbd20) at core/ThreadRunner.cpp:23
#14 0x00000000005780cc in boost::_mfi::mf0<void, ThreadRunner>::operator() (this=0x426020c8, p=0xedbd20) at /usr/include/boost/bind/mem_fn_template.hpp:49
#15 0x0000000000578139 in boost::_bi::list1<boost::_bi::value<ThreadRunner*> >::operator()<boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list0> (this=0x426020d8, f=@0x426020c8, a=@0x4260202f) at /usr/include/boost/bind.hpp:231
#16 0x0000000000578176 in boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >::operator() (this=0x426020c8) at /usr/include/boost/bind/bind_template.hpp:20
#17 0x0000000000578195 in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, ThreadRunner>, boost::_bi::list1<boost::_bi::value<ThreadRunner*> > >, void>::invoke (function_obj_ptr=@0x426020c8) at /usr/include/boost/function/function_template.hpp:155
#18 0x00007f9b36674537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#19 0x00007f9b366741a2 in ?? () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#20 0x00007f9b36cd33f7 in start_thread () from /lib/libpthread.so.0
#21 0x00007f9b33105b3d in clone () from /lib/libc.so.6
#22 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7f9b37435730 (LWP 11379)):
#0  0x00007f9b36cdae81 in nanosleep () from /lib/libpthread.so.0
#1  0x00007f9b051b08bd in pyOmega::wait (this=0x111c200) at gui/py/yadeControl.cpp:437
#2  0x00007f9b05096f51 in boost::python::detail::invoke<int, void (pyOmega::*)(), boost::python::arg_from_python<pyOmega&> > (f=@0x9e5c98, tc=@0x7fff3f4753d0) at /usr/include/boost/python/detail/invoke.hpp:94
#3  0x00007f9b05146bba in boost::python::detail::caller_arity<1u>::impl<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> >::operator() (this=0x9e5c98, args_=0x1101710) at /usr/include/boost/python/detail/caller.hpp:199
#4  0x00007f9b05146c0d in boost::python::objects::caller_py_function_impl<boost::python::detail::caller<void (pyOmega::*)(), boost::python::default_call_policies, boost::mpl::vector2<void, pyOmega&> > >::operator() (this=0x9e5c90, args=0x1101710, kw=0x0) at /usr/include/boost/python/object/py_function.hpp:38
#5  0x00007f9b349f1abe in boost::python::objects::function::call () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#6  0x00007f9b349f1de8 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#7  0x00007f9b36674537 in boost::function0<void, std::allocator<boost::function_base> >::operator() () from /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1
#8  0x00007f9b349f99f8 in boost::python::handle_exception_impl () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#9  0x00007f9b349ef127 in ?? () from /usr/lib/libboost_python-gcc42-mt-1_34_1.so.1.34.1
#10 0x00007f9b36f20f23 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0x00007f9b36f9ebb0 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#12 0x00007f9b36fa2a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#13 0x00007f9b36fa2ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#14 0x00007f9b36fc5da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#15 0x00007f9b36f9a8d6 in ?? () from /usr/lib/libpython2.5.so.1.0
#16 0x00007f9b36fa1940 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0x00007f9b36fa2a86 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0x00007f9b36fa2ba2 in PyEval_EvalCode () from /usr/lib/libpython2.5.so.1.0
#19 0x00007f9b36fc5da1 in PyRun_FileExFlags () from /usr/lib/libpython2.5.so.1.0
#20 0x00007f9b36fc603b in PyRun_SimpleFileExFlags () from /usr/lib/libpython2.5.so.1.0
#21 0x00007f9b236fb5cc in PythonUI::execScript (script={static npos = 18446744073709551615, _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7fff3f476420 "?8\203"}}) at gui/py/PythonUI.cpp:44
#22 0x00007f9b236fc91b in PythonUI::pythonSession () at gui/py/PythonUI.cpp:96
#23 0x00007f9b236fd8d9 in PythonUI::run (this=0x833800, argc=4, argv=0x7fff3f477140) at gui/py/PythonUI.cpp:128
#24 0x000000000057eecf in main (argc=4, argv=0x7fff3f477140) at core/yade.cpp:253
#0  0x00007f9b36cdae81 in nanosleep () from /lib/libpthread.so.0

-------------- next part --------------
_______________________________________________
Mailing list: https://launchpad.net/~yade-dev
Post to     : yade-dev at lists.launchpad.net
Unsubscribe : https://launchpad.net/~yade-dev
More help   : https://help.launchpad.net/ListHelp


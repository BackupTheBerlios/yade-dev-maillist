<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [deprecated list] [Yade-dev] [svn] r1738 - in trunk: core	core/containers examples	examples/SpheresFactory	examples/dynamic_simulation_tests	examples/rod_penetration	extra extra/clump	extra/spherical-dem-simulator extra/tetra	extra/usct gui/py	pkg/common pkg/common/Container	pkg/common/DataClass	pkg/common/Engine	pkg/common/Engine/DeusExMachina	pkg/common/Engine/EngineUnit	pkg/common/Engine/MetaEngine	pkg/common/Engine/StandAloneEngine	pkg/dem pkg/dem/DataClass	pkg/dem/Engine/DeusExMachina	pkg/dem/Engine/EngineUnit	pkg/dem/Engine/StandAloneEngine	pkg/dem/PreProcessor pkg/fem	pkg/fem/Engine/StandAloneEngine	pkg/fem/PreProcessor	pkg/lattice	pkg/lattice/DataClass/PhysicalParameters	pkg/lattice/Engine/StandAloneEngine	pkg/lattice/PreProcessor	pkg/mass-spring	pkg/mass-spring/Engine/StandAloneEngine	pkg/mass-spring/PreProcessor	pkg/realtime-rigidbody	pkg/realtime-rigidbody/Engine/StandAloneEngine	pkg/realtime-rigidbody/PreProcessor	pkg/snow pkg/snow/Engine	pkg/snow/PreProcessor scripts
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/yade-dev/2009/index.html" >
   <LINK REL="made" HREF="mailto:yade-dev%40lists.berlios.de?Subject=Re%3A%20%5Bdeprecated%20list%5D%20%5BYade-dev%5D%20%5Bsvn%5D%20r1738%20-%20in%20trunk%3A%20core%0A%09core/containers%20examples%09examples/SpheresFactory%0A%09examples/dynamic_simulation_tests%09examples/rod_penetration%0A%09extra%20extra/clump%09extra/spherical-dem-simulator%20extra/tetra%0A%09extra/usct%20gui/py%09pkg/common%20pkg/common/Container%0A%09pkg/common/DataClass%09pkg/common/Engine%0A%09pkg/common/Engine/DeusExMachina%09pkg/common/Engine/EngineUnit%0A%09pkg/common/Engine/MetaEngine%09pkg/common/Engine/StandAloneEngine%0A%09pkg/dem%20pkg/dem/DataClass%09pkg/dem/Engine/DeusExMachina%0A%09pkg/dem/Engine/EngineUnit%09pkg/dem/Engine/StandAloneEngine%0A%09pkg/dem/PreProcessor%20pkg/fem%09pkg/fem/Engine/StandAloneEngine%0A%09pkg/fem/PreProcessor%09pkg/lattice%0A%09pkg/lattice/DataClass/PhysicalParameters%09pkg/lattice/Engine/StandAloneEngine%0A%09pkg/lattice/PreProcessor%09pkg/mass-spring%0A%09pkg/mass-spring/Engine/StandAloneEngine%09pkg/mass-spring/PreProcessor%0A%09pkg/realtime-rigidbody%09pkg/realtime-rigidbody/Engine/StandAloneEngine%09pkg/realtime-rigidbody/PreProcessor%0A%09pkg/snow%20pkg/snow/Engine%09pkg/snow/PreProcessor%20scripts&In-Reply-To=%3C200903301710.n2UHAbPU016220%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000899.html">
   <LINK REL="Next"  HREF="000900.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[deprecated list] [Yade-dev] [svn] r1738 - in trunk: core	core/containers examples	examples/SpheresFactory	examples/dynamic_simulation_tests	examples/rod_penetration	extra extra/clump	extra/spherical-dem-simulator extra/tetra	extra/usct gui/py	pkg/common pkg/common/Container	pkg/common/DataClass	pkg/common/Engine	pkg/common/Engine/DeusExMachina	pkg/common/Engine/EngineUnit	pkg/common/Engine/MetaEngine	pkg/common/Engine/StandAloneEngine	pkg/dem pkg/dem/DataClass	pkg/dem/Engine/DeusExMachina	pkg/dem/Engine/EngineUnit	pkg/dem/Engine/StandAloneEngine	pkg/dem/PreProcessor pkg/fem	pkg/fem/Engine/StandAloneEngine	pkg/fem/PreProcessor	pkg/lattice	pkg/lattice/DataClass/PhysicalParameters	pkg/lattice/Engine/StandAloneEngine	pkg/lattice/PreProcessor	pkg/mass-spring	pkg/mass-spring/Engine/StandAloneEngine	pkg/mass-spring/PreProcessor	pkg/realtime-rigidbody	pkg/realtime-rigidbody/Engine/StandAloneEngine	pkg/realtime-rigidbody/PreProcessor	pkg/snow pkg/snow/Engine	pkg/snow/PreProcessor scripts</H1>
    <B>eudoxos at BerliOS</B> 
    <A HREF="mailto:yade-dev%40lists.berlios.de?Subject=Re%3A%20%5Bdeprecated%20list%5D%20%5BYade-dev%5D%20%5Bsvn%5D%20r1738%20-%20in%20trunk%3A%20core%0A%09core/containers%20examples%09examples/SpheresFactory%0A%09examples/dynamic_simulation_tests%09examples/rod_penetration%0A%09extra%20extra/clump%09extra/spherical-dem-simulator%20extra/tetra%0A%09extra/usct%20gui/py%09pkg/common%20pkg/common/Container%0A%09pkg/common/DataClass%09pkg/common/Engine%0A%09pkg/common/Engine/DeusExMachina%09pkg/common/Engine/EngineUnit%0A%09pkg/common/Engine/MetaEngine%09pkg/common/Engine/StandAloneEngine%0A%09pkg/dem%20pkg/dem/DataClass%09pkg/dem/Engine/DeusExMachina%0A%09pkg/dem/Engine/EngineUnit%09pkg/dem/Engine/StandAloneEngine%0A%09pkg/dem/PreProcessor%20pkg/fem%09pkg/fem/Engine/StandAloneEngine%0A%09pkg/fem/PreProcessor%09pkg/lattice%0A%09pkg/lattice/DataClass/PhysicalParameters%09pkg/lattice/Engine/StandAloneEngine%0A%09pkg/lattice/PreProcessor%09pkg/mass-spring%0A%09pkg/mass-spring/Engine/StandAloneEngine%09pkg/mass-spring/PreProcessor%0A%09pkg/realtime-rigidbody%09pkg/realtime-rigidbody/Engine/StandAloneEngine%09pkg/realtime-rigidbody/PreProcessor%0A%09pkg/snow%20pkg/snow/Engine%09pkg/snow/PreProcessor%20scripts&In-Reply-To=%3C200903301710.n2UHAbPU016220%40sheep.berlios.de%3E"
       TITLE="[deprecated list] [Yade-dev] [svn] r1738 - in trunk: core	core/containers examples	examples/SpheresFactory	examples/dynamic_simulation_tests	examples/rod_penetration	extra extra/clump	extra/spherical-dem-simulator extra/tetra	extra/usct gui/py	pkg/common pkg/common/Container	pkg/common/DataClass	pkg/common/Engine	pkg/common/Engine/DeusExMachina	pkg/common/Engine/EngineUnit	pkg/common/Engine/MetaEngine	pkg/common/Engine/StandAloneEngine	pkg/dem pkg/dem/DataClass	pkg/dem/Engine/DeusExMachina	pkg/dem/Engine/EngineUnit	pkg/dem/Engine/StandAloneEngine	pkg/dem/PreProcessor pkg/fem	pkg/fem/Engine/StandAloneEngine	pkg/fem/PreProcessor	pkg/lattice	pkg/lattice/DataClass/PhysicalParameters	pkg/lattice/Engine/StandAloneEngine	pkg/lattice/PreProcessor	pkg/mass-spring	pkg/mass-spring/Engine/StandAloneEngine	pkg/mass-spring/PreProcessor	pkg/realtime-rigidbody	pkg/realtime-rigidbody/Engine/StandAloneEngine	pkg/realtime-rigidbody/PreProcessor	pkg/snow pkg/snow/Engine	pkg/snow/PreProcessor scripts">eudoxos at mail.berlios.de
       </A><BR>
    <I>Mon Mar 30 19:10:37 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000899.html">[deprecated list] [Yade-dev] [svn] r1737 -	trunk/pkg/dem/Engine/StandAloneEngine
</A></li>
        <LI>Next message: <A HREF="000900.html">[deprecated list] [Yade-dev] [svn] r1739 - in trunk: extra	extra/clump gui/py	pkg/common/Engine/DeusExMachina	pkg/dem/Engine/StandAloneEngine
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#918">[ date ]</a>
              <a href="thread.html#918">[ thread ]</a>
              <a href="subject.html#918">[ subject ]</a>
              <a href="author.html#918">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: eudoxos
Date: 2009-03-30 19:10:27 +0200 (Mon, 30 Mar 2009)
New Revision: 1738

Removed:
   trunk/core/PhysicalAction.hpp
   trunk/core/PhysicalActionContainer.cpp
   trunk/core/PhysicalActionContainer.hpp
   trunk/core/containers/PhysicalActionVectorVector.cpp
   trunk/core/containers/PhysicalActionVectorVector.hpp
   trunk/pkg/common/Container/PhysicalActionVectorVector.hpp
   trunk/pkg/common/DataClass/PhysicalAction/
   trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.cpp
   trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.hpp
   trunk/pkg/dem/DataClass/PhysicalAction/
   trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.cpp
   trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.hpp
   trunk/pkg/dem/Engine/DeusExMachina/ResultantForceEngine.cpp
   trunk/pkg/dem/Engine/DeusExMachina/ResultantForceEngine.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.hpp
Modified:
   trunk/core/BexContainer.hpp
   trunk/core/Body.hpp
   trunk/core/MetaBody.cpp
   trunk/core/MetaBody.hpp
   trunk/core/SConscript
   trunk/core/yade.cpp
   trunk/examples/STLImporterTest.py
   trunk/examples/SpheresFactory/model.py
   trunk/examples/dynamic_simulation_tests/ringCundallDamping.py
   trunk/examples/dynamic_simulation_tests/ringSimpleViscoelastic.py
   trunk/examples/rod_penetration/model.py
   trunk/extra/Brefcom.cpp
   trunk/extra/Brefcom.hpp
   trunk/extra/BrefcomTestGen.cpp
   trunk/extra/SConscript
   trunk/extra/SimpleScene.cpp
   trunk/extra/SimpleScene.hpp
   trunk/extra/clump/Shop.cpp
   trunk/extra/clump/Shop.hpp
   trunk/extra/spherical-dem-simulator/SphericalDEMSimulator.cpp
   trunk/extra/tetra/Tetra.cpp
   trunk/extra/tetra/Tetra.hpp
   trunk/extra/usct/UniaxialStrainControlledTest.cpp
   trunk/extra/usct/UniaxialStrainControlledTest.hpp
   trunk/gui/py/_utils.cpp
   trunk/gui/py/utils.py
   trunk/gui/py/yadeControl.cpp
   trunk/pkg/common/Engine/DeusExMachina/CinemCNCEngine.cpp
   trunk/pkg/common/Engine/DeusExMachina/CinemCNCEngine.hpp
   trunk/pkg/common/Engine/DeusExMachina/CinemKNCEngine.cpp
   trunk/pkg/common/Engine/DeusExMachina/CinemKNCEngine.hpp
   trunk/pkg/common/Engine/DeusExMachina/DisplacementToForceEngine.cpp
   trunk/pkg/common/Engine/DeusExMachina/DisplacementToForceEngine.hpp
   trunk/pkg/common/Engine/DeusExMachina/ForceEngine.cpp
   trunk/pkg/common/Engine/DeusExMachina/ForceEngine.hpp
   trunk/pkg/common/Engine/DeusExMachina/GravityEngines.cpp
   trunk/pkg/common/Engine/DeusExMachina/GravityEngines.hpp
   trunk/pkg/common/Engine/DeusExMachina/MomentEngine.cpp
   trunk/pkg/common/Engine/DeusExMachina/MomentEngine.hpp
   trunk/pkg/common/Engine/EngineUnit/CundallNonViscousDamping.cpp
   trunk/pkg/common/Engine/EngineUnit/CundallNonViscousDamping.hpp
   trunk/pkg/common/Engine/EngineUnit/NewtonsForceLaw.cpp
   trunk/pkg/common/Engine/EngineUnit/NewtonsForceLaw.hpp
   trunk/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw.cpp
   trunk/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw.hpp
   trunk/pkg/common/Engine/MetaEngine/ConstitutiveLaw.hpp
   trunk/pkg/common/Engine/MetaEngine/PhysicalActionApplier.cpp
   trunk/pkg/common/Engine/MetaEngine/PhysicalActionApplier.hpp
   trunk/pkg/common/Engine/MetaEngine/PhysicalActionApplierUnit.hpp
   trunk/pkg/common/Engine/MetaEngine/PhysicalActionDamper.cpp
   trunk/pkg/common/Engine/MetaEngine/PhysicalActionDamper.hpp
   trunk/pkg/common/Engine/MetaEngine/PhysicalActionDamperUnit.hpp
   trunk/pkg/common/Engine/ParallelEngine.cpp
   trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter.cpp
   trunk/pkg/common/SConscript
   trunk/pkg/dem/Engine/DeusExMachina/CapillaryRecorder.cpp
   trunk/pkg/dem/Engine/DeusExMachina/CapillaryRecorder.hpp
   trunk/pkg/dem/Engine/DeusExMachina/ContactStressRecorder.cpp
   trunk/pkg/dem/Engine/DeusExMachina/ContactStressRecorder.hpp
   trunk/pkg/dem/Engine/DeusExMachina/HydraulicForceEngine.cpp
   trunk/pkg/dem/Engine/DeusExMachina/HydraulicForceEngine.hpp
   trunk/pkg/dem/Engine/DeusExMachina/NewtonsDampedLaw.cpp
   trunk/pkg/dem/Engine/DeusExMachina/NewtonsDampedLaw.hpp
   trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp
   trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.hpp
   trunk/pkg/dem/Engine/DeusExMachina/TriaxialStateRecorder.cpp
   trunk/pkg/dem/Engine/DeusExMachina/TriaxialStateRecorder.hpp
   trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.cpp
   trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.hpp
   trunk/pkg/dem/Engine/DeusExMachina/WallStressRecorder.cpp
   trunk/pkg/dem/Engine/DeusExMachina/WallStressRecorder.hpp
   trunk/pkg/dem/Engine/EngineUnit/ef2_Spheres_NormalShear_ElasticFrictionalLaw.hpp
   trunk/pkg/dem/Engine/EngineUnit/ef2_Spheres_Viscoelastic_SimpleViscoelasticContactLaw.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/CapillaryCohesiveLaw.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/CapillaryCohesiveLaw.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/CohesiveFrictionalContactLaw.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/CohesiveFrictionalContactLaw.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/ContactLaw1.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/ContactLaw1.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/ForceRecorder.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/ForceRecorder.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/MicroMacroAnalyser.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/MicroMacroAnalyser.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/ViscousForceDamping.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/ViscousForceDamping.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.hpp
   trunk/pkg/dem/PreProcessor/CohesiveTriaxialTest.cpp
   trunk/pkg/dem/PreProcessor/DirectShearCis.cpp
   trunk/pkg/dem/PreProcessor/Funnel.cpp
   trunk/pkg/dem/PreProcessor/HydraulicTest.cpp
   trunk/pkg/dem/PreProcessor/MembraneTest.cpp
   trunk/pkg/dem/PreProcessor/ModifiedTriaxialTest.cpp
   trunk/pkg/dem/PreProcessor/SDECImpactTest.cpp
   trunk/pkg/dem/PreProcessor/SDECLinkedSpheres.cpp
   trunk/pkg/dem/PreProcessor/SDECMovingWall.cpp
   trunk/pkg/dem/PreProcessor/SDECSpheresPlane.cpp
   trunk/pkg/dem/PreProcessor/STLImporterTest.cpp
   trunk/pkg/dem/PreProcessor/SimpleShear.cpp
   trunk/pkg/dem/PreProcessor/TestSimpleViscoelastic.cpp
   trunk/pkg/dem/PreProcessor/TetrahedronsTest.cpp
   trunk/pkg/dem/PreProcessor/ThreePointBending.cpp
   trunk/pkg/dem/PreProcessor/TriaxialTest.cpp
   trunk/pkg/dem/PreProcessor/TriaxialTest.hpp
   trunk/pkg/dem/PreProcessor/TriaxialTestWater.cpp
   trunk/pkg/dem/PreProcessor/TriaxialTestWater.hpp
   trunk/pkg/dem/SConscript
   trunk/pkg/fem/Engine/StandAloneEngine/FEMLaw.cpp
   trunk/pkg/fem/Engine/StandAloneEngine/FEMLaw.hpp
   trunk/pkg/fem/PreProcessor/FEMBeam.cpp
   trunk/pkg/fem/SConscript
   trunk/pkg/lattice/DataClass/PhysicalParameters/LatticeBeamParameters.hpp
   trunk/pkg/lattice/Engine/StandAloneEngine/BeamRecorder.hpp
   trunk/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.hpp
   trunk/pkg/lattice/Engine/StandAloneEngine/MovingSupport.hpp
   trunk/pkg/lattice/Engine/StandAloneEngine/NodeRecorder.hpp
   trunk/pkg/lattice/Engine/StandAloneEngine/StrainRecorder.hpp
   trunk/pkg/lattice/PreProcessor/LatticeExample.cpp
   trunk/pkg/lattice/SConscript
   trunk/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw.cpp
   trunk/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw.hpp
   trunk/pkg/mass-spring/PreProcessor/HangingCloth.cpp
   trunk/pkg/mass-spring/SConscript
   trunk/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw.cpp
   trunk/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw.hpp
   trunk/pkg/realtime-rigidbody/PreProcessor/BoxStack.cpp
   trunk/pkg/realtime-rigidbody/PreProcessor/RotatingBox.cpp
   trunk/pkg/realtime-rigidbody/SConscript
   trunk/pkg/snow/Engine/ElawSnowLayersDeformation.cpp
   trunk/pkg/snow/Engine/ElawSnowLayersDeformation.hpp
   trunk/pkg/snow/PreProcessor/SnowCreepTest.cpp
   trunk/pkg/snow/PreProcessor/SnowVoxelsLoader.cpp
   trunk/pkg/snow/SConscript
   trunk/scripts/chain-distant-interactions.py
   trunk/scripts/constitutive-law.py
   trunk/scripts/cylindrical-layer-packing.py
   trunk/scripts/exact-rot-facet.py
   trunk/scripts/exact-rot.py
   trunk/scripts/multi.py
   trunk/scripts/simple-scene-graph.py
   trunk/scripts/simple-scene-parallel.py
   trunk/scripts/simple-scene-player.py
   trunk/scripts/simple-scene-video.py
   trunk/scripts/simple-scene.py
   trunk/scripts/test-sphere-facet-corner.py
   trunk/scripts/test-sphere-facet.py
Log:
1. Remove all traces of physical actions:

PhysicalAction, GlobalStiffness, Force, Momentum, MakeItFlat,
ResultantForceEngine, GlobalStiffnessCounter,
PhysicalActionVectorVector, PhysicalActionContainer.

2. All code now uses BexContainer.

Please check that your code works correctly (I tried to do my best and double-checked, though).

Make sure you remove (rm -rf ...) all plugins before recompiling as old plugins will _not_ be deleted automatically. 




Modified: trunk/core/BexContainer.hpp
===================================================================
--- trunk/core/BexContainer.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/core/BexContainer.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -10,7 +10,35 @@
 #ifdef YADE_OPENMP
 
 #include&lt;omp.h&gt;
+/*! Container for Body External Variables (bex), typically forces and torques from interactions.
+ * Values should be reset at every iteration by calling BexContainer::reset();
+ * If you want to add your own bex, you need to:
+ *
+ * 	1. Create storage vector
+ * 	2. Create accessor function
+ * 	3. Update the resize function
+ * 	4. Update the reset function
+ * 	5. update the sync function (for the multithreaded implementation)
+ *
+ * This class exists in two flavors: non-parallel and parallel. The parallel one stores
+ * bex increments separately for every thread and sums those when sync() is called.
+ * The reason of this design is that the container is not truly random-access, but rather
+ * is written to everywhere in one phase and read in the next one. Adding to force/torque
+ * marks the container as dirty and sync() must be performed before reading the stored data.
+ * Calling getForce/getTorque when the container is not synchronized throws an exception.
+ *
+ * It is intentional that sync() needs to be called exlicitly, since syncs are expensive and
+ * the programmer should be aware of that. Sync is however performed only if the container
+ * is dirty. Every full sync increments the syncCount variable, that should ideally equal
+ * the number of steps (one per step).
+ *
+ * The number of threads (omp_get_max_threads) may not change once BexContainer is constructed.
+ *
+ * The non-parallel flavor has the same interface, but sync() is no-op and synchronization
+ * is not enforced at all.
+ */
 
+//! This is the parallel flavor of BexContainer
 class BexContainer{
 	private:
 		typedef std::vector&lt;Vector3r&gt; vvector;
@@ -30,7 +58,8 @@
 		inline void ensureSynced(){ if(!synced) throw runtime_error(&quot;BexContainer not thread-synchronized; call sync() first!&quot;); }
 
 		/*! Function to allow friend classes to get force even if not synced.
-		* Dangerous! The caller must know what it is doing! */
+		* Dangerous! The caller must know what it is doing! (i.e. don't read after write
+		* for a particular body id. */
 		const Vector3r&amp; getForceUnsynced (body_id_t id){ensureSize(id); return _force[id];}
 		const Vector3r&amp; getTorqueUnsynced(body_id_t id){ensureSize(id); return _force[id];}
 		friend class PhysicalActionDamperUnit;
@@ -48,10 +77,9 @@
 		const Vector3r&amp; getTorque(body_id_t id)        { ensureSize(id); ensureSynced(); return _torque[id]; }
 		void addTorque(body_id_t id, const Vector3r&amp; f){ ensureSize(id); synced=false;   _torqueData[omp_get_thread_num()][id]+=f;}
 
-		/* Sum contributions from all threads, save to the 0th thread storage.
-		 * Locks globalMutex, since one thread modifies other threads' data.
-		 * Must be called before get* methods are used. Exception is thrown otherwise, since data are not consistent.
-		 */
+		/* Sum contributions from all threads, save to _force&amp;_torque.
+		 * Locks globalMutex, since one thread modifies common data (_force&amp;_torque).
+		 * Must be called before get* methods are used. Exception is thrown otherwise, since data are not consistent. */
 		inline void sync(){
 			if(synced) return;
 			boost::mutex::scoped_lock lock(globalMutex);
@@ -68,8 +96,7 @@
 
 		/* Change size of containers (number of bodies).
 		 * Locks globalMutex, since on threads modifies other threads' data.
-		 * Called very rarely (a few times at the beginning of the simulation)
-		 */
+		 * Called very rarely (a few times at the beginning of the simulation). */
 		void resize(size_t newSize){
 			boost::mutex::scoped_lock lock(globalMutex);
 			if(size&gt;=newSize) return; // in case on thread was waiting for resize, but it was already satisfied by another one
@@ -80,7 +107,8 @@
 			_force.resize(newSize); _torque.resize(newSize);
 			size=newSize;
 		}
-
+		/*! Reset all data, also reset summay forces/torques and mark the container clean. */
+		// perhaps should be private and friend MetaBody or whatever the only caller should be
 		void reset(){
 			for(int thread=0; thread&lt;nThreads; thread++){
 				memset(_forceData [thread][0], 0,sizeof(Vector3r)*size);
@@ -92,16 +120,7 @@
 };
 
 #else
-/* Container for Body External Variables (bex), typically forces and torques from interactions.
- * Values should be reset at every iteration by BexResetter.
- * If you want to add your own bex, there are 4 steps:
- *
- * 	1. Create storage vector
- * 	2. Create accessor function
- * 	3. Update the resize function
- * 	4. Update the reset function
- *
- */
+//! This is the non-parallel flavor of BexContainer
 class BexContainer {
 	private:
 		std::vector&lt;Vector3r&gt; _force;
@@ -131,7 +150,6 @@
 			_force.resize(newSize);
 			_torque.resize(newSize);
 			size=newSize;
-			// std::cerr&lt;&lt;&quot;[DEBUG] BexContainer: Resized to &quot;&lt;&lt;size&lt;&lt;std::endl;
 		}
 };
 

Modified: trunk/core/Body.hpp
===================================================================
--- trunk/core/Body.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/core/Body.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -16,7 +16,6 @@
 #include&quot;PhysicalParameters.hpp&quot;
 #include&quot;InteractionContainer.hpp&quot;
 #include&quot;Interaction.hpp&quot;
-#include&quot;PhysicalActionContainer.hpp&quot;
 
 #include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
 #include&lt;yade/lib-serialization/Serializable.hpp&gt;

Modified: trunk/core/MetaBody.cpp
===================================================================
--- trunk/core/MetaBody.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/core/MetaBody.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -24,7 +24,6 @@
  * and different type of containers can still be used instead by explicit assignment */
 #include&lt;yade/core/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/core/InteractionVecMap.hpp&gt;
-#include&lt;yade/core/PhysicalActionVectorVector.hpp&gt;
 
 // POSIX-only
 #include&lt;pwd.h&gt;
@@ -36,9 +35,6 @@
 
 MetaBody::MetaBody() :
 	Body(),bodies(new BodyRedirectionVector), interactions(new InteractionVecMap), persistentInteractions(interactions),transientInteractions(interactions)
-	#ifndef BEX_CONTAINER
-	  	,physicalActions(new PhysicalActionVectorVector)
-	#endif
 {	
 	engines.clear();
 	initializers.clear();
@@ -83,8 +79,10 @@
 {
 	if(needsInitializers){
 		FOREACH(shared_ptr&lt;Engine&gt; e, initializers){ if(e-&gt;isActivated()) e-&gt;action(this); }
+		bex.resize(bodies-&gt;size());
 		needsInitializers=false;
 	}
+	//bex.reset(); // uncomment if PhysicalActionContainerReseter is removed
 	TimingInfo::delta last=TimingInfo::getNow();
 	FOREACH(const shared_ptr&lt;Engine&gt;&amp; e, engines){
 		if(e-&gt;isActivated()){

Modified: trunk/core/MetaBody.hpp
===================================================================
--- trunk/core/MetaBody.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/core/MetaBody.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -14,7 +14,7 @@
 #include&quot;BodyContainer.hpp&quot;
 #include&quot;Engine.hpp&quot;
 #include&quot;DisplayParameters.hpp&quot;
-#include&quot;PhysicalActionContainer.hpp&quot;
+#include&quot;BexContainer.hpp&quot;
 //#include&quot;groupRelationData.hpp&quot;
 
 class MetaBody : public Body
@@ -29,11 +29,8 @@
 		__attribute__((__deprecated__)) shared_ptr&lt;InteractionContainer&gt;&amp;	persistentInteractions; // disappear, reappear according to physical (or any other non-spatial) criterion
 		shared_ptr&lt;InteractionContainer&gt;&amp;	transientInteractions;	// disappear, reappear according to spatial criterion
 
-		#ifdef BEX_CONTAINER
-			BexContainer bex;
-		#else
-			shared_ptr&lt;PhysicalActionContainer&gt;	physicalActions;
-		#endif
+		BexContainer bex;
+
 		vector&lt;shared_ptr&lt;Serializable&gt; &gt; miscParams; // will set static parameters during deserialization (primarily for GLDraw functors which otherwise have no attribute access)
 		//! tags like mp3 tags: author, date, version, description etc.
 		list&lt;string&gt; tags;
@@ -66,9 +63,6 @@
 		(initializers)
 		(bodies)
 		(transientInteractions)
-		#ifndef BEX_CONTAINER
-			(physicalActions)
-		#endif
 		(miscParams)
 		(dispParams)
 		(dt)

Deleted: trunk/core/PhysicalAction.hpp
===================================================================
--- trunk/core/PhysicalAction.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/core/PhysicalAction.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -1,33 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#pragma once
-
-
-#include&lt;yade/lib-serialization/Serializable.hpp&gt;
-#include&lt;yade/lib-multimethods/Indexable.hpp&gt;
-
-/* Helper macro for Engines and Engine units to declare what PhysicalParameters (Bex, BodyExternalVariables) they want to use */
-#define NEEDS_BEX(...) public: virtual std::list&lt;std::string&gt; getNeededBex(){ const char* bex[]={ __VA_ARGS__ &quot;&quot;, NULL}; std::list&lt;std::string&gt; ret; for(int i=0; bex[i]!=NULL;i++){ret.push_back(std::string(bex[i]));} return ret; }
-
-class PhysicalAction : public Serializable, public Indexable
-{
-	public :
-
-		virtual void reset() 				{throw;};
-		virtual shared_ptr&lt;PhysicalAction&gt; clone()	{throw;};
-	
-	REGISTER_INDEX_COUNTER(PhysicalAction);
-	REGISTER_CLASS_AND_BASE(PhysicalAction,Serializable Indexable);
-};
-
-REGISTER_SERIALIZABLE(PhysicalAction);
-
-

Deleted: trunk/core/PhysicalActionContainer.cpp
===================================================================
--- trunk/core/PhysicalActionContainer.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/core/PhysicalActionContainer.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -1,25 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;PhysicalActionContainer.hpp&quot;
-#include &quot;PhysicalAction.hpp&quot;
-
-
-PhysicalActionContainer::PhysicalActionContainer() : Serializable()
-{
-	action.clear();
-}
-
-
-PhysicalActionContainer::~PhysicalActionContainer()
-{
-
-}
-

Deleted: trunk/core/PhysicalActionContainer.hpp
===================================================================
--- trunk/core/PhysicalActionContainer.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/core/PhysicalActionContainer.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -1,125 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#pragma once
-
-#include&lt;yade/lib-serialization/Serializable.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
-#include&lt;iostream&gt;
-
-// experimental
-#ifndef NO_BEX
-#	define BEX_CONTAINER
-#endif
-
-#ifdef BEX_CONTAINER
-	#include&lt;yade/core/BexContainer.hpp&gt;
-#endif
-
-using namespace boost;
-using namespace std;
-
-class PhysicalActionContainerIterator 
-{
-	public :
-		int currentIndex;
-
-		PhysicalActionContainerIterator() 		{};
-		virtual ~PhysicalActionContainerIterator()	{};
-	
-		virtual bool isDifferent(const PhysicalActionContainerIterator&amp;)	{ throw;};
-		virtual void affect(const PhysicalActionContainerIterator&amp;)		{ throw;};
-		virtual void increment()						{ throw;};
-		virtual shared_ptr&lt;PhysicalAction&gt; getValue()				{ throw;};
-		virtual shared_ptr&lt;PhysicalActionContainerIterator&gt; createPtr()		{ throw;};
-		virtual int getCurrentIndex()						{ throw;};
-};
-
-class PhysicalActionContainerIteratorPointer
-{
-	private :
-		shared_ptr&lt;PhysicalActionContainerIterator&gt; ptr;
-		void allocate(const PhysicalActionContainerIteratorPointer&amp; bi)
-		{
-			if (ptr==0) ptr = bi.get()-&gt;createPtr();
-		}
-
-	public :
-		PhysicalActionContainerIterator&amp; getRef() {return *ptr;};
-		PhysicalActionContainerIterator&amp; getRef() const {return *ptr;};
-		shared_ptr&lt;PhysicalActionContainerIterator&gt; get() {return ptr;};
-		shared_ptr&lt;PhysicalActionContainerIterator&gt; get() const {return ptr;};
-
-		PhysicalActionContainerIteratorPointer(const PhysicalActionContainerIteratorPointer&amp; bi)
-		{
-			allocate(bi);
-			ptr-&gt;affect(bi.getRef());
-		};
-
-		PhysicalActionContainerIteratorPointer(const shared_ptr&lt;PhysicalActionContainerIterator&gt;&amp; i) { ptr = i; };
-		PhysicalActionContainerIteratorPointer()  { ptr = shared_ptr&lt;PhysicalActionContainerIterator&gt;(); };
-		bool operator!=(const PhysicalActionContainerIteratorPointer&amp; bi) { return ptr-&gt;isDifferent(bi.getRef()); };
-
-		PhysicalActionContainerIteratorPointer&amp; operator=(const PhysicalActionContainerIteratorPointer&amp; bi)
-		{
-			allocate(bi);
-			ptr-&gt;affect(bi.getRef());
-			return *this;
-		};
-
-		PhysicalActionContainerIteratorPointer&amp; operator++()	{ ptr-&gt;increment(); return *this; };
-		PhysicalActionContainerIteratorPointer&amp; operator++(int);  // disabled
-		shared_ptr&lt;PhysicalAction&gt; operator*()			{ return ptr-&gt;getValue(); };
-		int getCurrentIndex()					{ return ptr-&gt;getCurrentIndex(); };
-
-};
-
-
-
-// this container is different: it has ALWAYS data inside, not empty pointers at all. Every field has
-// inside the right pointer type so it can be safely (and quickly) static_casted, so that the user himself
-// is doing addition, substraction, and whatever he wants.
-//
-// you should never have to create new PhysicalAction ! (that takes too much time), except for calling prepare, which is done only once
- 
-class PhysicalActionContainer : public Serializable
-{
-	public :
-		PhysicalActionContainer();
-		virtual ~PhysicalActionContainer();
-
-		virtual void clear() 							{throw;};
-	
-		// doesn't delete all, just resets data
-		virtual void reset() 							{throw;};
-		virtual unsigned int size() 						{throw;};
-		// fills container with resetted fields. argument here, should be all PhysicalAction types that are planned to use
-		virtual void prepare(std::vector&lt;shared_ptr&lt;PhysicalAction&gt; &gt;&amp; )			{throw;};
-	
-		// finds and returns action of given polymorphic type, for body of given Id,
-		// should be always succesfull. if it is not - you forgot to call prepare()
-		virtual shared_ptr&lt;PhysicalAction&gt;&amp; find(
-					  unsigned int /*Body-&gt;getId() */
-					, int /*Force::getClassIndexStatic()*/)		{throw;};
-
-		typedef PhysicalActionContainerIteratorPointer iterator;
-		virtual PhysicalActionContainer::iterator begin()			{throw;};
-		virtual PhysicalActionContainer::iterator end()			{throw;};
-
-	REGISTER_ATTRIBUTES(/*no base*/,(action));
-	REGISTER_CLASS_AND_BASE(PhysicalActionContainer,Serializable);
-
-	// local storage for uniform serialization of all possible container concrete implementations.
-	private	:
-		vector&lt;shared_ptr&lt;PhysicalAction&gt; &gt; action;
-};
-
-REGISTER_SERIALIZABLE(PhysicalActionContainer);
-

Modified: trunk/core/SConscript
===================================================================
--- trunk/core/SConscript	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/core/SConscript	2009-03-30 17:10:27 UTC (rev 1738)
@@ -17,7 +17,6 @@
 			'MetaEngine.cpp',
 			'NullGUI.cpp',
 			'Omega.cpp',
-			'PhysicalActionContainer.cpp',
 			'PhysicalParameters.cpp',
 			'Preferences.cpp',
 			'SimulationFlow.cpp',
@@ -32,7 +31,6 @@
 			'containers/InteractionVecSet.cpp',
 			'containers/InteractionHashMap.cpp',
 			'containers/InteractionVecMap.cpp',
-			'containers/PhysicalActionVectorVector.cpp',
 			],
 		LIBS=env['LIBS']+['yade-base',
 			'yade-serialization',

Deleted: trunk/core/containers/PhysicalActionVectorVector.cpp
===================================================================
--- trunk/core/containers/PhysicalActionVectorVector.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/core/containers/PhysicalActionVectorVector.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -1,227 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include&quot;PhysicalActionVectorVector.hpp&quot;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
-
-PhysicalActionVectorVectorIterator::PhysicalActionVectorVectorIterator() : PhysicalActionContainerIterator()
-{
-	currentIndex = -1;
-}
-
-
-PhysicalActionVectorVectorIterator::~PhysicalActionVectorVectorIterator()
-{
-
-}
-
-
-bool PhysicalActionVectorVectorIterator::isDifferent(const PhysicalActionContainerIterator&amp; i)
-{
-	const PhysicalActionVectorVectorIterator&amp; it = static_cast&lt;const PhysicalActionVectorVectorIterator&amp;&gt;(i);
-	if (it.vvi==it.vviEnd)
-		return !(vvi==vviEnd);
-	else
-		return (vi != it.vi );
-}
-
-
-void PhysicalActionVectorVectorIterator::increment()
-{
-	++vi;
-	if(vi == viEnd)
-	{
-		++vvi;
-		++currentIndex;
-		while(!(*usedIds)[currentIndex] &amp;&amp; vvi != vviEnd)
-		{
-			++currentIndex;
-			++vvi;
-		}
-		if(vvi != vviEnd)
-		{
-			vi	= (*vvi).begin();
-			viEnd	= (*vvi).end();
-		}
-	}
-}
-
-
-void PhysicalActionVectorVectorIterator::affect(const PhysicalActionContainerIterator&amp; i)
-{
-	const PhysicalActionVectorVectorIterator&amp; tmpi = static_cast&lt;const PhysicalActionVectorVectorIterator&amp;&gt;(i);
-	vi     = tmpi.vi;
-	viEnd  = tmpi.viEnd;
-	vvi    = tmpi.vvi;
-	vviEnd = tmpi.vviEnd;
-	currentIndex = tmpi.currentIndex;
-	usedIds	= tmpi.usedIds;
-}
-
-
-shared_ptr&lt;PhysicalAction&gt; PhysicalActionVectorVectorIterator::getValue()
-{	
-	return *vi;
-}
-
-
-int PhysicalActionVectorVectorIterator::getCurrentIndex()
-{
-	return currentIndex;
-}
-
-
-shared_ptr&lt;PhysicalActionContainerIterator&gt; PhysicalActionVectorVectorIterator::createPtr()
-{
-	return shared_ptr&lt;PhysicalActionContainerIterator&gt;(new PhysicalActionVectorVectorIterator());
-}
-
-
-/**************************************************************************/
-/**************************************************************************/
-/**************************************************************************/
-/**************************************************************************/
-
-PhysicalActionVectorVector::PhysicalActionVectorVector()
-{
-	clear();
-//	currentIndex = -1;
-	current_size = 0;
-}
-
-
-PhysicalActionVectorVector::~PhysicalActionVectorVector()
-{
-}
-
-
-void PhysicalActionVectorVector::clear()
-{
-	physicalActions.clear();
-	usedIds.clear();
-	current_size = physicalActions.size();
-}
-
-
-// doesn't not delete all, just resets data
-void PhysicalActionVectorVector::reset()
-{
-	#if 1
-		vector&lt; vector&lt; shared_ptr&lt;PhysicalAction&gt; &gt; &gt;::iterator vvi    = physicalActions.begin();
-		vector&lt; vector&lt; shared_ptr&lt;PhysicalAction&gt; &gt; &gt;::iterator vviEnd = physicalActions.end();
-		for( ; vvi != vviEnd ; ++vvi )
-		{
-			vector&lt; shared_ptr&lt;PhysicalAction&gt; &gt;::iterator vi    = (*vvi).begin();
-			vector&lt; shared_ptr&lt;PhysicalAction&gt; &gt;::iterator viEnd = (*vvi).end();
-			for( ; vi != viEnd ; ++vi)
-			//if(*vi) // FIXME ?? do not check - all fields are NOT empty.
-				(*vi)-&gt;reset();
-		}
-	#else
-		FOREACH(int idx, usedBexIndices){
-			// reset everything
-			FOREACH(shared_ptr&lt;PhysicalAction&gt;&amp; pa,physicalActions[idx]){ pa-&gt;reset();}
-		}
-	#endif
-}
-
-
-unsigned int PhysicalActionVectorVector::size()
-{
-	return current_size;
-}
-
-
-// fills container with resetted fields. argument here, should be all PhysicalAction types that are planned to use
-void PhysicalActionVectorVector::prepare(std::vector&lt;shared_ptr&lt;PhysicalAction&gt; &gt;&amp; actionTypes)
-{
-	unsigned int size = actionTypes.size();
-	int maxSize = 0;
-	for(unsigned int i = 0 ; i &lt; size ; ++i)
-		maxSize = max(maxSize , actionTypes[i]-&gt;getClassIndex() );
-	++maxSize;
-	actionTypesResetted.resize(maxSize);
-	usedBexIndices.clear();
-	for(unsigned int i = 0 ; i &lt; size ; ++i )
-	{
-		int idx=actionTypes[i]-&gt;getClassIndex();
-		actionTypesResetted[idx] = actionTypes[i]-&gt;clone();
-		actionTypesResetted[idx] -&gt; reset();
-		usedBexIndices.push_back(idx);
-	}
-}
-
-
-// finds and returns action of given polymorphic type, for body of given Id,
-// should be always succesfull. if it is not - you forgot to call prepare()
-shared_ptr&lt;PhysicalAction&gt;&amp; PhysicalActionVectorVector::find(unsigned int id , int actionIndex )
-{
-	#ifdef BEX_CONTAINER
-		cerr&lt;&lt;&quot;FATAL: This build of yade uses nex BexContainer instead of PhysicalActionContainer.\nFATAL: However, your simulation still uses PhysicalActionContainer.\nFATAL: Update your code, see backtrace (if in debug build) to find where the old container is used.&quot;&lt;&lt;endl;
-		throw std::runtime_error(&quot;Deprecated PhysicalActionContainer is not supported in this build!&quot;);
-	#endif
-	if( current_size &lt;= id ) // this is very rarely executed, only at beginning.
-	// somebody is accesing out of bounds, make sure he will find, what he needs - a resetted PhysicalAction of his type
-	{
-		unsigned int oldSize = physicalActions.size();
-		unsigned int newSize = id+1;
-		current_size = newSize;
-		usedIds.resize(newSize,false);
-		physicalActions.resize(newSize);
-		for(unsigned int i = oldSize ; i &lt; newSize ; ++i )
-		{
-			unsigned int actionTypesSize = actionTypesResetted.size();
-			physicalActions[i].resize(actionTypesSize);
-			for( unsigned int j = 0 ; j &lt; actionTypesSize ; ++j )
-				physicalActions[i][j] = actionTypesResetted[j]-&gt;clone();
-		}
-	}
-	usedIds[id] = true;
-	return physicalActions[id][actionIndex];
-}
-
-
-PhysicalActionContainer::iterator PhysicalActionVectorVector::begin()
-{
-	shared_ptr&lt;PhysicalActionVectorVectorIterator&gt; it(new PhysicalActionVectorVectorIterator());
-	it-&gt;currentIndex = 0;
-	it-&gt;usedIds	 = &usedIds;
-	it-&gt;vvi		 = physicalActions.begin();
-	it-&gt;vviEnd	 = physicalActions.end();
-	while(it-&gt;vvi!=it-&gt;vviEnd &amp;&amp; !usedIds[it-&gt;currentIndex])
-	{
-		++(it-&gt;currentIndex);
-		++(it-&gt;vvi);
-	}
-	if(it-&gt;vvi != it-&gt;vviEnd)
-	{
-		it-&gt;vi     = (*it-&gt;vvi).begin();
-		it-&gt;viEnd  = (*it-&gt;vvi).end();
-	}
-
-	return PhysicalActionContainer::iterator(it);
-}
-
-
-PhysicalActionContainer::iterator PhysicalActionVectorVector::end()
-{
-	shared_ptr&lt;PhysicalActionVectorVectorIterator&gt; it(new PhysicalActionVectorVectorIterator());
-	it-&gt;currentIndex = physicalActions.size();
-	it-&gt;vvi		 = physicalActions.end();
-	it-&gt;vviEnd	 = physicalActions.end();
-	/* Using nested iterator when the first one is end() already would be error, therefore we leave it-&gt;vi and it-&gt;viEnd alone.
-	 * (see PhysicalActionVectorVectorIterator::isDifferent for exact implementation of !=end()) */
-	return PhysicalActionContainer::iterator(it);
-
-}
-
-
-// YADE_PLUGIN();

Deleted: trunk/core/containers/PhysicalActionVectorVector.hpp
===================================================================
--- trunk/core/containers/PhysicalActionVectorVector.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/core/containers/PhysicalActionVectorVector.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -1,90 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#pragma once
-
-#include&lt;yade/core/PhysicalActionContainer.hpp&gt;
-#include&lt;list&gt;
-#include&lt;vector&gt;
-
-class PhysicalAction;
-
-using namespace boost;
-using namespace std;
-
-class PhysicalActionVectorVectorIterator : public PhysicalActionContainerIterator
-{
-	public :
-		vector&lt; vector&lt; shared_ptr&lt;PhysicalAction&gt; &gt; &gt;::iterator vvi;
-		vector&lt; vector&lt; shared_ptr&lt;PhysicalAction&gt; &gt; &gt;::iterator vviEnd;
-			vector&lt; shared_ptr&lt;PhysicalAction&gt; &gt;  ::iterator vi;
-		vector&lt; shared_ptr&lt;PhysicalAction&gt; &gt;  ::iterator viEnd;
-		vector&lt; bool &gt; * usedIds;
-
-	public :
-		PhysicalActionVectorVectorIterator();
-		~PhysicalActionVectorVectorIterator();
-
-		virtual bool isDifferent(const PhysicalActionContainerIterator&amp; i);
-		virtual void affect(const PhysicalActionContainerIterator&amp; i);
-		virtual void increment();
-		virtual shared_ptr&lt;PhysicalAction&gt; getValue();
-		virtual shared_ptr&lt;PhysicalActionContainerIterator&gt; createPtr();
-		virtual int getCurrentIndex();
-};
-
-
-
-class PhysicalActionVectorVector : public PhysicalActionContainer
-{
-	private	:
-	// this in fact should be also a RedirectionVector in respect to the Body.id
-	// this container is memory-consuming, because size of this vector is depending on highest id
-	// from all bodies, not on the number of bodies
-	
-	// in this two-dimensional table:
-	// 	- first  dimension is Body-&gt;getId() number
-	//	- second dimension is PhysicalAction-&gt;getClassIndex() number
-		vector&lt; vector&lt; shared_ptr&lt;PhysicalAction&gt; &gt; &gt; physicalActions;
-			vector&lt; shared_ptr&lt;PhysicalAction&gt; &gt;   actionTypesResetted;
-		vector&lt; bool &gt; usedIds;
-		unsigned int current_size;
-		vector&lt;int&gt; usedBexIndices;
-	
-	public :
-		PhysicalActionVectorVector();
-		virtual ~PhysicalActionVectorVector();
-
-		virtual void clear();
-
-		// doesn't delete all, just resets data
-		virtual void reset();
-		virtual unsigned int size();
-		// fills container with resetted fields. argument here, should be all PhysicalAction types that are planned to use
-		virtual void prepare(std::vector&lt;shared_ptr&lt;PhysicalAction&gt; &gt;&amp; );
-	
-		// finds and returns action of given polymorphic type, for body of given Id,
-		// should be always succesfull. if it is not - you forgot to call prepare()
-		virtual shared_ptr&lt;PhysicalAction&gt;&amp; find(
-					  unsigned int /*Body-&gt;getId() */
-					, int /*ActionForce::getClassIndexStatic()*/);
-
-		virtual PhysicalActionContainer::iterator begin();
-		virtual PhysicalActionContainer::iterator end();
-
-/// Serialization
-	REGISTER_CLASS_NAME(PhysicalActionVectorVector);
-	REGISTER_BASE_CLASS_NAME(PhysicalActionContainer);
-
-};
-
-REGISTER_SERIALIZABLE(PhysicalActionVectorVector);
-
-

Modified: trunk/core/yade.cpp
===================================================================
--- trunk/core/yade.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/core/yade.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -160,9 +160,6 @@
 	#ifdef LOG4CXX
 		&quot;   LOG4CXX       configurable logging framework enabled (~/.yade-suffix/logging.conf)&quot;
 	#endif
-	#ifdef BEX_CONTAINER
-		&quot;   BEX_CONTAINER (uses BexContainer instead of PhysicalActionContainer)\n&quot;
-	#endif
 	&quot;\n&quot;;
 }
 

Modified: trunk/examples/STLImporterTest.py
===================================================================
--- trunk/examples/STLImporterTest.py	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/examples/STLImporterTest.py	2009-03-30 17:10:27 UTC (rev 1738)
@@ -38,8 +38,6 @@
 
 ## Initializers 
 o.initializers=[
-	## Create and reset to zero container of all PhysicalActions that will be used
-	StandAloneEngine('PhysicalActionContainerInitializer'),
 	## Create bounding boxes. They are needed to zoom the 3d view properly before we start the simulation.
 	MetaEngine('BoundingVolumeMetaEngine',[EngineUnit('InteractingSphere2AABB'),EngineUnit('InteractingFacet2AABB'),EngineUnit('MetaInteractingGeometry2AABB')])
 	]

Modified: trunk/examples/SpheresFactory/model.py
===================================================================
--- trunk/examples/SpheresFactory/model.py	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/examples/SpheresFactory/model.py	2009-03-30 17:10:27 UTC (rev 1738)
@@ -21,11 +21,10 @@
 
 ## Initializers 
 o.initializers=[
-	StandAloneEngine('PhysicalActionContainerInitializer'),
 	MetaEngine('BoundingVolumeMetaEngine',
 		[EngineUnit('InteractingSphere2AABB'),
 			EngineUnit('InteractingFacet2AABB'),
-			EngineUnit('MetaInteractingGeometry2AABB')])
+			EngineUnit('MetaInteractingGeometry2AABB')]),
 	]
 
 ## Engines 

Modified: trunk/examples/dynamic_simulation_tests/ringCundallDamping.py
===================================================================
--- trunk/examples/dynamic_simulation_tests/ringCundallDamping.py	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/examples/dynamic_simulation_tests/ringCundallDamping.py	2009-03-30 17:10:27 UTC (rev 1738)
@@ -35,11 +35,10 @@
 
 ## Initializers 
 o.initializers=[
-	StandAloneEngine('PhysicalActionContainerInitializer'),
 	MetaEngine('BoundingVolumeMetaEngine',
 		[EngineUnit('InteractingSphere2AABB'),
 			EngineUnit('InteractingFacet2AABB'),
-			EngineUnit('MetaInteractingGeometry2AABB')])
+			EngineUnit('MetaInteractingGeometry2AABB')]),
 	]
 
 ## Engines 

Modified: trunk/examples/dynamic_simulation_tests/ringSimpleViscoelastic.py
===================================================================
--- trunk/examples/dynamic_simulation_tests/ringSimpleViscoelastic.py	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/examples/dynamic_simulation_tests/ringSimpleViscoelastic.py	2009-03-30 17:10:27 UTC (rev 1738)
@@ -40,11 +40,10 @@
 
 ## Initializers 
 o.initializers=[
-	StandAloneEngine('PhysicalActionContainerInitializer'),
 	MetaEngine('BoundingVolumeMetaEngine',
 		[EngineUnit('InteractingSphere2AABB'),
 			EngineUnit('InteractingFacet2AABB'),
-			EngineUnit('MetaInteractingGeometry2AABB')])
+			EngineUnit('MetaInteractingGeometry2AABB')]),
 	]
 
 ## Engines 

Modified: trunk/examples/rod_penetration/model.py
===================================================================
--- trunk/examples/rod_penetration/model.py	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/examples/rod_penetration/model.py	2009-03-30 17:10:27 UTC (rev 1738)
@@ -45,11 +45,10 @@
 
 ## Initializers 
 o.initializers=[
-	StandAloneEngine('PhysicalActionContainerInitializer'),
 	MetaEngine('BoundingVolumeMetaEngine',[
 		EngineUnit('InteractingSphere2AABB'),
 		EngineUnit('InteractingFacet2AABB'),
-		EngineUnit('MetaInteractingGeometry2AABB')])
+		EngineUnit('MetaInteractingGeometry2AABB')]),
 	]
 
 ## Engines 

Modified: trunk/extra/Brefcom.cpp
===================================================================
--- trunk/extra/Brefcom.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/extra/Brefcom.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -12,12 +12,7 @@
 CREATE_LOGGER(BrefcomGlobalCharacteristics);
 
 void BrefcomGlobalCharacteristics::compute(MetaBody* rb, bool useMaxForce){
-	//Shop::Bex::initCache();
-	#ifdef BEX_CONTAINER
-		rb-&gt;bex.sync();
-	#else
-		throw runtime_error(&quot;Brefcom can run only with BexContainer&quot;);
-	#endif
+	rb-&gt;bex.sync();
 
 	// 1. reset volumetric strain (cummulative in the next loop)
 	// 2. get maximum force on a body and sum of all forces (for averaging)
@@ -26,9 +21,7 @@
 	BrefcomPhysParams* bpp(YADE_CAST&lt;BrefcomPhysParams*&gt;(b-&gt;physicalParameters.get()));
 		bpp-&gt;epsVolumetric=0;
 		bpp-&gt;numContacts=0;
-		#ifdef BEX_CONTAINER
-			currF=rb-&gt;bex.getForce(b-&gt;id).Length(); maxF=max(currF,maxF); sumF+=currF;
-		#endif
+		currF=rb-&gt;bex.getForce(b-&gt;id).Length(); maxF=max(currF,maxF); sumF+=currF;
 	}
 	Real meanF=sumF/rb-&gt;bodies-&gt;size(); 
 
@@ -133,14 +126,10 @@
 CREATE_LOGGER(BrefcomLaw);
 
 void BrefcomLaw::applyForce(const Vector3r&amp; force, const body_id_t&amp; id1, const body_id_t&amp; id2){
-#ifdef BEX_CONTAINER
 	rootBody-&gt;bex.addForce(id1,force);
 	rootBody-&gt;bex.addForce(id2,-force);
 	rootBody-&gt;bex.addTorque(id1,(contGeom-&gt;contactPoint-contGeom-&gt;pos1).Cross(force));
 	rootBody-&gt;bex.addTorque(id2,(contGeom-&gt;contactPoint-contGeom-&gt;pos2).Cross(-force));
-#else
-	throw runtime_error(&quot;Brefcom can run only with BexContainer&quot;);
-#endif
 }
 
 CREATE_LOGGER(ef2_Spheres_Brefcom_BrefcomLaw);
@@ -222,7 +211,6 @@
 		LOG_DEBUG(&quot;Contact #&quot;&lt;&lt;I-&gt;getId1()&lt;&lt;&quot;=#&quot;&lt;&lt;I-&gt;getId2()&lt;&lt;&quot; is damaged over thershold (&quot;&lt;&lt;omega&lt;&lt;&quot;&gt;&quot;&lt;&lt;omegaThreshold&lt;&lt;&quot;) and has been deleted (isReal=&quot;&lt;&lt;I-&gt;isReal&lt;&lt;&quot;)&quot;);
 		return;
 	}
-	// store Fn (and Fs?), for use with GlobalStiffnessCounter?
 	NNAN(sigmaN); NNANV(sigmaT); NNAN(crossSection);
 
 	Fn=sigmaN*crossSection; BC-&gt;normalForce=Fn*contGeom-&gt;normal;

Modified: trunk/extra/Brefcom.hpp
===================================================================
--- trunk/extra/Brefcom.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/extra/Brefcom.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -6,14 +6,11 @@
 #include&lt;yade/core/FileGenerator.hpp&gt;
 #include&lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
 #include&lt;yade/pkg-dem/BodyMacroParameters.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
 #include&lt;yade/pkg-common/InteractionPhysicsEngineUnit.hpp&gt;
 #include&lt;yade/pkg-dem/SpheresContactGeometry.hpp&gt;
 #include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 #include&lt;yade/pkg-common/PeriodicEngines.hpp&gt;
 #include&lt;yade/pkg-common/NormalShearInteractions.hpp&gt;
-#include&lt;yade/pkg-dem/GlobalStiffness.hpp&gt;
 #include&lt;yade/pkg-common/ConstitutiveLaw.hpp&gt;
 
 /* Engine encompassing several computations looping over all bodies/interactions
@@ -206,7 +203,6 @@
 		BrefcomLaw(): logStrain(false) { Shop::Bex::initCache(); };
 		void action(MetaBody*);
 	protected: 
-	NEEDS_BEX(&quot;Force&quot;,&quot;Momentum&quot;);
 	REGISTER_CLASS_AND_BASE(BrefcomLaw,InteractionSolver);
 	REGISTER_ATTRIBUTES(InteractionSolver,(logStrain));
 	DECLARE_LOGGER;

Modified: trunk/extra/BrefcomTestGen.cpp
===================================================================
--- trunk/extra/BrefcomTestGen.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/extra/BrefcomTestGen.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -9,7 +9,6 @@
 
 
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 #include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
 #include&lt;yade/pkg-common/BoundingVolumeMetaEngine.hpp&gt;
 #include&lt;yade/pkg-common/AABB.hpp&gt;
@@ -36,12 +35,6 @@
 void BrefcomTestGen::createEngines(){
 	rootBody-&gt;initializers.clear();
 
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;GlobalStiffness&quot;);
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
-	
 	shared_ptr&lt;BoundingVolumeMetaEngine&gt; boundingVolumeDispatcher	= shared_ptr&lt;BoundingVolumeMetaEngine&gt;(new BoundingVolumeMetaEngine);
 	boundingVolumeDispatcher-&gt;add(new InteractingSphere2AABB);
 	boundingVolumeDispatcher-&gt;add(new MetaInteractingGeometry2AABB);

Modified: trunk/extra/SConscript
===================================================================
--- trunk/extra/SConscript	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/extra/SConscript	2009-03-30 17:10:27 UTC (rev 1738)
@@ -36,13 +36,11 @@
          'RigidBodyParameters',
 			'ElasticBodyParameters',
 			'BodyMacroParameters',
-			'Momentum',
-			'Force',
          'AABB']),
 	
 	env.SharedLibrary('TetraTestGen',['tetra/TetraTestGen.cpp'],LIBS=env['LIBS']+['Shop','Tetra']),
 
-	env.SharedLibrary('UniaxialStrainControlledTest',['usct/UniaxialStrainControlledTest.cpp'],LIBS=env['LIBS']+['Shop','GlobalStiffnessTimeStepper','GlobalStiffnessCounter','Brefcom','PositionOrientationRecorder']),
+	env.SharedLibrary('UniaxialStrainControlledTest',['usct/UniaxialStrainControlledTest.cpp'],LIBS=env['LIBS']+['Shop','GlobalStiffnessTimeStepper','Brefcom','PositionOrientationRecorder']),
 
 	env.SharedLibrary('Brefcom',['Brefcom.cpp'],CXXFLAGS=env['CXXFLAGS']+brefcomInclude,LIBS=env['LIBS']+['Shop','InteractingSphere2InteractingSphere4SpheresContactGeometry']),
 
@@ -65,7 +63,6 @@
 			'GravityEngines',
 			'yade-serialization',
 			'yade-base',	
-			'PhysicalActionContainerInitializer',
 			'PhysicalActionContainerReseter',
 			'InteractionGeometryMetaEngine',
 			'InteractionPhysicsMetaEngine',
@@ -80,7 +77,6 @@
 			'ParticleParameters',
 			'MetaInteractingGeometry',
 			'MetaInteractingGeometry2AABB',
-			'GlobalStiffness',
 			'InteractingSphere2AABB',\
 			'InteractingBox2AABB',
 			'NewtonsMomentumLaw',
@@ -88,8 +84,6 @@
 			'LeapFrogPositionIntegrator',
 			'LeapFrogOrientationIntegrator',
 			'InteractingBox2InteractingSphere4SpheresContactGeometry',
-			'Momentum',
-			'Force',
 			'InteractingSphere2InteractingSphere4SpheresContactGeometry',
 			#'Clump',
 			'yade-multimethods',

Modified: trunk/extra/SimpleScene.cpp
===================================================================
--- trunk/extra/SimpleScene.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/extra/SimpleScene.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -6,21 +6,17 @@
 #include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
 #include&lt;yade/pkg-common/MetaInteractingGeometry2AABB.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
 #include&lt;yade/pkg-common/AABB.hpp&gt;
 #include&lt;yade/pkg-common/Box.hpp&gt;
 #include&lt;yade/pkg-common/Sphere.hpp&gt;
 #include&lt;yade/pkg-common/InteractingBox.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
 #include&lt;yade/pkg-common/NewtonsForceLaw.hpp&gt;
 #include&lt;yade/pkg-common/NewtonsMomentumLaw.hpp&gt;
 #include&lt;yade/pkg-common/LeapFrogPositionIntegrator.hpp&gt;
 #include&lt;yade/pkg-common/LeapFrogOrientationIntegrator.hpp&gt;
 #include&lt;yade/pkg-dem/InteractingSphere2InteractingSphere4SpheresContactGeometry.hpp&gt;
 #include&lt;yade/pkg-dem/InteractingBox2InteractingSphere4SpheresContactGeometry.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
 #include&lt;yade/pkg-common/InteractionGeometryMetaEngine.hpp&gt;
 #include&lt;yade/pkg-common/InteractionPhysicsMetaEngine.hpp&gt;
@@ -47,8 +43,6 @@
 	/* initializers */
 		rootBody-&gt;initializers.clear();
 		//@
-		rootBody-&gt;initializers.push_back(shared_ptr&lt;PhysicalActionContainerInitializer&gt;(new PhysicalActionContainerInitializer));
-		//@
 		shared_ptr&lt;BoundingVolumeMetaEngine&gt; boundingVolumeDispatcher	= shared_ptr&lt;BoundingVolumeMetaEngine&gt;(new BoundingVolumeMetaEngine);
 			boundingVolumeDispatcher-&gt;add(new InteractingSphere2AABB);
 			boundingVolumeDispatcher-&gt;add(new InteractingBox2AABB);

Modified: trunk/extra/SimpleScene.hpp
===================================================================
--- trunk/extra/SimpleScene.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/extra/SimpleScene.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -1,6 +1,5 @@
 #pragma once
 #include&lt;yade/core/FileGenerator.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
 #include&lt;yade/extra/Shop.hpp&gt;
 
 

Modified: trunk/extra/clump/Shop.cpp
===================================================================
--- trunk/extra/clump/Shop.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/extra/clump/Shop.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -18,7 +18,6 @@
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 #include&lt;yade/pkg-common/InteractingBox.hpp&gt;
 #include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
@@ -27,8 +26,6 @@
 #include&lt;yade/pkg-common/InteractingBox2AABB.hpp&gt;
 #include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
 #include&lt;yade/pkg-common/MetaInteractingGeometry2AABB.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
 #include&lt;yade/pkg-common/NewtonsForceLaw.hpp&gt;
 #include&lt;yade/pkg-common/NewtonsMomentumLaw.hpp&gt;
 #include&lt;yade/pkg-common/LeapFrogPositionIntegrator.hpp&gt;
@@ -38,8 +35,6 @@
 #include&lt;yade/pkg-dem/MacroMicroElasticRelationships.hpp&gt;
 #include&lt;yade/pkg-dem/SimpleViscoelasticBodyParameters.hpp&gt;
 
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
 /*class InteractingSphere2AABB;
 class InteractingBox2AABB;
 class MetaInteractingGeometry;
@@ -47,7 +42,6 @@
 
 
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
 
 #include&lt;yade/pkg-common/InteractionGeometryMetaEngine.hpp&gt;
@@ -85,57 +79,30 @@
 
 map&lt;string,boost::any&gt; Shop::defaults;
 
-int Shop::Bex::forceIdx=-1;
-int Shop::Bex::momentumIdx=-1;
+void Shop::Bex::initCache(){}
 
-void Shop::Bex::initCache(){
-	if(Shop::Bex::forceIdx&lt;0){
-		Shop::Bex::forceIdx=shared_ptr&lt;PhysicalAction&gt;(new Force())-&gt;getClassIndex();
-		Shop::Bex::momentumIdx=shared_ptr&lt;PhysicalAction&gt;(new Momentum())-&gt;getClassIndex();
-	}
-}
-#ifdef BEX_CONTAINER
-	const Vector3r&amp; Shop::Bex::force(body_id_t id,MetaBody* rb){  rb-&gt;bex.sync();  return rb-&gt;bex.getForce(id);}
-	const Vector3r&amp; Shop::Bex::momentum(body_id_t id,MetaBody* rb){ rb-&gt;bex.sync(); return rb-&gt;bex.getTorque(id);}
-#else
-	#define __BEX_ACCESS(retType,shopBexMember,bexClass,bexIdx,bexAttribute) retType&amp; Shop::Bex::shopBexMember(body_id_t id,MetaBody* mb){ assert(bexIdx&gt;=0); shared_ptr&lt;PhysicalActionContainer&gt; pac=(mb?mb:Omega::instance().getRootBody().get())-&gt;physicalActions; /*if((long)pac-&gt;size()&lt;=id) throw invalid_argument(&quot;No &quot; #shopBexMember &quot; for #&quot;+lexical_cast&lt;string&gt;(id)+&quot; (max=&quot;+lexical_cast&lt;string&gt;(((long)pac-&gt;size()-1))+&quot;)&quot;);*/ return static_pointer_cast&lt;bexClass&gt;(pac-&gt;find(id,bexIdx))-&gt;bexAttribute; }
-	__BEX_ACCESS(Vector3r,force,Force,forceIdx,force);
-	__BEX_ACCESS(Vector3r,momentum,Momentum,momentumIdx,momentum);
-	#undef __BEX_ACCESS
-#endif
+const Vector3r&amp; Shop::Bex::force(body_id_t id,MetaBody* rb){  rb-&gt;bex.sync();  return rb-&gt;bex.getForce(id);}
+const Vector3r&amp; Shop::Bex::momentum(body_id_t id,MetaBody* rb){ rb-&gt;bex.sync(); return rb-&gt;bex.getTorque(id);}
 
 /* Apply force on contact point to 2 bodies; the force is oriented as it applies on the first body and is reversed on the second.
  *
  * Shop::Bex::initCache must have been called at some point. */
 void Shop::applyForceAtContactPoint(const Vector3r&amp; force, const Vector3r&amp; contPt, body_id_t id1, const Vector3r&amp; pos1, body_id_t id2, const Vector3r&amp; pos2, MetaBody* rootBody){
-#ifdef BEX_CONTAINER
 	rootBody-&gt;bex.addForce(id1,force);
 	rootBody-&gt;bex.addForce(id2,-force);
 	rootBody-&gt;bex.addTorque(id1,(contPt-pos1).Cross(force));
 	rootBody-&gt;bex.addTorque(id2,-(contPt-pos2).Cross(force));
-#else
-	Shop::Bex::force(id1,rootBody)+=force;
-	Shop::Bex::force(id2,rootBody)-=force;
-	Shop::Bex::momentum(id1,rootBody)+=(contPt-pos1).Cross(force);
-	Shop::Bex::momentum(id2,rootBody)-=(contPt-pos2).Cross(force);
-#endif
 }
 
 
 Real Shop::unbalancedForce(bool useMaxForce, MetaBody* _rb){
 	MetaBody* rb=_rb ? _rb : Omega::instance().getRootBody().get();
-	#ifdef BEX_CONTAINER
-		rb-&gt;bex.sync();
-	#endif
+	rb-&gt;bex.sync();
 	// get maximum force on a body and sum of all forces (for averaging)
 	Real sumF=0,maxF=0,currF;
 	FOREACH(const shared_ptr&lt;Body&gt;&amp; b, *rb-&gt;bodies){
 		if(!b-&gt;isDynamic) continue;
-		#ifdef BEX_CONTAINER
-			currF=rb-&gt;bex.getForce(b-&gt;id).Length(); maxF=max(currF,maxF); sumF+=currF;
-		#else
-			currF=Shop::Bex::force(b-&gt;id,rb).Length(); maxF=max(currF,maxF); sumF+=currF;
-		#endif
+		currF=rb-&gt;bex.getForce(b-&gt;id).Length(); maxF=max(currF,maxF); sumF+=currF;
 	}
 	Real meanF=sumF/rb-&gt;bodies-&gt;size(); 
 	// get max force on contacts
@@ -243,11 +210,6 @@
 	// initializers	
 	rootBody-&gt;initializers.clear();
 
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
-	
 	shared_ptr&lt;BoundingVolumeMetaEngine&gt; boundingVolumeDispatcher	= shared_ptr&lt;BoundingVolumeMetaEngine&gt;(new BoundingVolumeMetaEngine);
 	boundingVolumeDispatcher-&gt;add(new InteractingSphere2AABB);
 	boundingVolumeDispatcher-&gt;add(new InteractingBox2AABB);

Modified: trunk/extra/clump/Shop.hpp
===================================================================
--- trunk/extra/clump/Shop.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/extra/clump/Shop.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -86,15 +86,9 @@
 		 */
 		class Bex{
 			public:
-			static int forceIdx,momentumIdx;
 			static void initCache();
-			#ifdef BEX_CONTAINER
-				static const Vector3r&amp; force(body_id_t, MetaBody* mb=NULL);
-				static const Vector3r&amp; momentum(body_id_t, MetaBody* mb=NULL);
-			#else
-				static Vector3r&amp; force(body_id_t, MetaBody* mb=NULL);
-				static Vector3r&amp; momentum(body_id_t, MetaBody* mb=NULL);
-			#endif
+			static const Vector3r&amp; force(body_id_t, MetaBody* mb=NULL);
+			static const Vector3r&amp; momentum(body_id_t, MetaBody* mb=NULL);
 		};
 
 		//! Estimate timestep based on P-wave propagation speed

Modified: trunk/extra/spherical-dem-simulator/SphericalDEMSimulator.cpp
===================================================================
--- trunk/extra/spherical-dem-simulator/SphericalDEMSimulator.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/extra/spherical-dem-simulator/SphericalDEMSimulator.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -206,19 +206,10 @@
 		shared_ptr&lt;PhysicalActionDamper&gt; pade = dynamic_pointer_cast&lt;PhysicalActionDamper&gt;(e);
 		if (pade)
 		{	
-		#ifdef BEX_CONTAINER
 			shared_ptr&lt;CundallNonViscousForceDamping&gt; cnvfd = YADE_PTR_CAST&lt;CundallNonViscousForceDamping&gt;(pade-&gt;getExecutor(&quot;RigidBodyParameters&quot;));
 			assert(cnvfd);
 			forceDamping=cnvfd-&gt;damping;
 			momentumDamping=forceDamping;
-		#else
-			shared_ptr&lt;CundallNonViscousForceDamping&gt; cnvfd = YADE_PTR_CAST&lt;CundallNonViscousForceDamping&gt;(pade-&gt;getExecutor(&quot;Force&quot;,&quot;RigidBodyParameters&quot;));
-			shared_ptr&lt;CundallNonViscousMomentumDamping&gt; cnvmd = YADE_PTR_CAST&lt;CundallNonViscousMomentumDamping&gt;(pade-&gt;getExecutor(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;));
-			assert(cnvfd);
-			assert(cnvmd);
-			forceDamping 	= cnvfd-&gt;damping;
-			momentumDamping = cnvmd-&gt;damping;
-		#endif
 		}
 	}
 }

Modified: trunk/extra/tetra/Tetra.cpp
===================================================================
--- trunk/extra/tetra/Tetra.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/extra/tetra/Tetra.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -7,7 +7,6 @@
 
 
 #include&lt;yade/core/Interaction.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
 #include&lt;yade/core/Omega.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
 
@@ -405,17 +404,10 @@
 		TRWM3VEC(F);
 		TRWM3VEC((physB-&gt;se3.position-contactGeom-&gt;contactPoint).Cross(F));
 
-		#ifdef BEX_CONTAINER
-			rootBody-&gt;bex.addForce (idA,-F);
-			rootBody-&gt;bex.addForce (idB, F);
-			rootBody-&gt;bex.addTorque(idA,-(physA-&gt;se3.position-contactGeom-&gt;contactPoint).Cross(F));
-			rootBody-&gt;bex.addTorque(idB, (physA-&gt;se3.position-contactGeom-&gt;contactPoint).Cross(F));
-		#else
-			static_pointer_cast&lt;Force&gt;(rootBody-&gt;physicalActions-&gt;find(idA,actionForce-&gt;getClassIndex()))-&gt;force-=F;
-			static_pointer_cast&lt;Force&gt;(rootBody-&gt;physicalActions-&gt;find(idB,actionForce-&gt;getClassIndex()))-&gt;force+=F;
-			static_pointer_cast&lt;Momentum&gt;(rootBody-&gt;physicalActions-&gt;find(idA,actionMomentum-&gt;getClassIndex()))-&gt;momentum-=(physA-&gt;se3.position-contactGeom-&gt;contactPoint).Cross(F);
-			static_pointer_cast&lt;Momentum&gt;(rootBody-&gt;physicalActions-&gt;find(idB,actionMomentum-&gt;getClassIndex()))-&gt;momentum+=(physB-&gt;se3.position-contactGeom-&gt;contactPoint).Cross(F);
-		#endif
+		rootBody-&gt;bex.addForce (idA,-F);
+		rootBody-&gt;bex.addForce (idB, F);
+		rootBody-&gt;bex.addTorque(idA,-(physA-&gt;se3.position-contactGeom-&gt;contactPoint).Cross(F));
+		rootBody-&gt;bex.addTorque(idB, (physA-&gt;se3.position-contactGeom-&gt;contactPoint).Cross(F));
 	}
 }
 

Modified: trunk/extra/tetra/Tetra.hpp
===================================================================
--- trunk/extra/tetra/Tetra.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/extra/tetra/Tetra.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -7,7 +7,6 @@
 #include&lt;yade/core/InteractingGeometry.hpp&gt;
 #include&lt;yade/core/InteractionGeometry.hpp&gt;
 #include&lt;yade/core/InteractionSolver.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
 
 #include&lt;yade/pkg-common/Tetrahedron.hpp&gt;
 #include&lt;yade/pkg-common/AABB.hpp&gt;
@@ -16,9 +15,6 @@
 #include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 #include&lt;yade/pkg-common/InteractionGeometryEngineUnit.hpp&gt;
 
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
-
 #include&lt;Wm3Math.h&gt;
 #include&lt;Wm3Vector3.h&gt;
 
@@ -135,15 +131,8 @@
 
 class TetraLaw: public InteractionSolver {
 	public:
-		//! @fixme: those two are here only because this class needs to access
-		/// the ID number of Force and Momentum. Those variables are actually not used to store a value of
-		/// Force and Momentum, just to get ID, although normally they are
-		/// used to store this value. I already have a better solution for that.
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-		shared_ptr&lt;PhysicalAction&gt; actionMomentum;
+		TetraLaw():InteractionSolver(){};
 
-		TetraLaw():InteractionSolver(),actionForce(new Force),actionMomentum(new Momentum){};
-
 		int sdecGroupMask; // probably unused?!
 
 		void action(MetaBody*);
@@ -151,7 +140,6 @@
 		DECLARE_LOGGER;
 	protected:
 		void registerAttributes(){InteractionSolver::registerAttributes(); /* &#8230; */ }
-		NEEDS_BEX(&quot;Force&quot;,&quot;Momentum&quot;);
 		REGISTER_CLASS_NAME(TetraLaw);
 		REGISTER_BASE_CLASS_NAME(InteractionSolver);
 };

Modified: trunk/extra/usct/UniaxialStrainControlledTest.cpp
===================================================================
--- trunk/extra/usct/UniaxialStrainControlledTest.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/extra/usct/UniaxialStrainControlledTest.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -1,6 +1,5 @@
 // 2008 &#169; V&#225;clav &#352;milauer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">eudoxos at arcig.cz</A>&gt; 
 #include&quot;UniaxialStrainControlledTest.hpp&quot;
-#include&lt;yade/pkg-common/Force.hpp&gt;
 #include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
 #include&lt;yade/pkg-common/Box.hpp&gt;
 #include&lt;yade/pkg-common/InteractingBox.hpp&gt;
@@ -128,14 +127,9 @@
 
 void UniaxialStrainer::computeAxialForce(MetaBody* rootBody){
 	sumPosForces=sumNegForces=0;
-	#ifdef BEX_CONTAINER
-		rootBody-&gt;bex.sync();
-		FOREACH(body_id_t id, negIds) sumNegForces+=rootBody-&gt;bex.getForce(id)[axis];
-		FOREACH(body_id_t id, posIds) sumNegForces-=rootBody-&gt;bex.getForce(id)[axis];
-	#else
-		FOREACH(body_id_t id, negIds) sumNegForces+=Shop::Bex::force(id)[axis];
-		FOREACH(body_id_t id, posIds) sumPosForces-=Shop::Bex::force(id)[axis];
-	#endif
+	rootBody-&gt;bex.sync();
+	FOREACH(body_id_t id, negIds) sumNegForces+=rootBody-&gt;bex.getForce(id)[axis];
+	FOREACH(body_id_t id, posIds) sumPosForces-=rootBody-&gt;bex.getForce(id)[axis];
 }
 
 /***************************************** USCTGen **************************/
@@ -201,14 +195,11 @@
 #include&lt;yade/extra/Brefcom.hpp&gt;
 
 #include&lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
 #include&lt;yade/pkg-common/InteractionPhysicsEngineUnit.hpp&gt;
 #include&lt;yade/pkg-dem/SpheresContactGeometry.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
 #include&lt;yade/pkg-dem/BodyMacroParameters.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 #include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
 #include&lt;yade/pkg-common/BoundingVolumeMetaEngine.hpp&gt;
 #include&lt;yade/pkg-common/AABB.hpp&gt;
@@ -225,7 +216,6 @@
 #include&lt;yade/pkg-common/LeapFrogPositionIntegrator.hpp&gt;
 #include&lt;yade/pkg-common/LeapFrogOrientationIntegrator.hpp&gt;
 #include&lt;yade/pkg-common/PersistentSAPCollider.hpp&gt;
-#include&lt;yade/pkg-dem/GlobalStiffnessCounter.hpp&gt;
 #include&lt;yade/pkg-dem/PositionOrientationRecorder.hpp&gt;
 #include&lt;yade/pkg-dem/GlobalStiffnessTimeStepper.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
@@ -237,12 +227,6 @@
 void USCTGen::createEngines(){
 	rootBody-&gt;initializers.clear();
 
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;GlobalStiffness&quot;);
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
-	
 	shared_ptr&lt;BoundingVolumeMetaEngine&gt; boundingVolumeDispatcher	= shared_ptr&lt;BoundingVolumeMetaEngine&gt;(new BoundingVolumeMetaEngine);
 		boundingVolumeDispatcher-&gt;add(new InteractingSphere2AABB);
 		boundingVolumeDispatcher-&gt;add(new MetaInteractingGeometry2AABB);
@@ -294,21 +278,7 @@
 	shared_ptr&lt;PhysicalParametersMetaEngine&gt; orientationIntegrator(new PhysicalParametersMetaEngine);
 		orientationIntegrator-&gt;add(new LeapFrogOrientationIntegrator);
 		rootBody-&gt;engines.push_back(orientationIntegrator);
-#if 0
-	shared_ptr&lt;GlobalStiffnessCounter&gt; globalStiffnessCounter(new GlobalStiffnessCounter);
-	globalStiffnessCounter-&gt;sdecGroupMask=1023;
-	globalStiffnessCounter-&gt;interval=100;
-	globalStiffnessCounter-&gt;assumeElasticSpheres=false;
 
-	shared_ptr&lt;GlobalStiffnessTimeStepper&gt; globalStiffnessTimeStepper(new GlobalStiffnessTimeStepper);
-	globalStiffnessTimeStepper-&gt;sdecGroupMask=1023; // BIN 111111111, should always match
-	globalStiffnessTimeStepper-&gt;timeStepUpdateInterval=100;
-	globalStiffnessTimeStepper-&gt;defaultDt=1e-6;
-	rootBody-&gt;engines.push_back(globalStiffnessTimeStepper);
-
-	rootBody-&gt;engines.push_back(globalStiffnessCounter);
-#endif
-
 	rootBody-&gt;engines.push_back(shared_ptr&lt;BrefcomDamageColorizer&gt;(new BrefcomDamageColorizer));
 
 }

Modified: trunk/extra/usct/UniaxialStrainControlledTest.hpp
===================================================================
--- trunk/extra/usct/UniaxialStrainControlledTest.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/extra/usct/UniaxialStrainControlledTest.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -5,7 +5,6 @@
 #include&lt;yade/extra/Shop.hpp&gt;
 #include&lt;yade/core/FileGenerator.hpp&gt;
 #include&lt;yade/core/DeusExMachina.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
 
 #ifndef FOREACH
 #define FOREACH BOOST_FOREACH
@@ -54,7 +53,6 @@
 		DeusExMachina::registerAttributes();
 		REGISTER_ATTRIBUTE(forces);
 	}
-	NEEDS_BEX(&quot;Force&quot;);
 	REGISTER_CLASS_NAME(UniaxialStrainSensorPusher);
 	REGISTER_BASE_CLASS_NAME(DeusExMachina);
 	//DECLARE_LOGGER;
@@ -156,7 +154,6 @@
 		);
 		void prepareRecStream(void){ if(!recordFile.empty()) recStream.open(recordFile.c_str()); }
 		void postProcessAttributes(bool deserializing){ if(deserializing) prepareRecStream(); } 	
-	NEEDS_BEX(&quot;Force&quot;,&quot;Momentum&quot;,&quot;GlobalStiffness&quot;);
 	REGISTER_CLASS_AND_BASE(UniaxialStrainer,DeusExMachina);
 	DECLARE_LOGGER;
 };

Modified: trunk/gui/py/_utils.cpp
===================================================================
--- trunk/gui/py/_utils.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/gui/py/_utils.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -194,13 +194,8 @@
 	Vector3r axis=tuple2vec(_axis), axisPt=tuple2vec(_axisPt);
 	FOREACH(const shared_ptr&lt;Body&gt; b, *rb-&gt;bodies){
 		if(!b-&gt;maskOk(mask)) continue;
-		#ifdef BEX_CONTAINER
-			const Vector3r&amp; m=rb-&gt;bex.getTorque(b-&gt;getId());
-			const Vector3r&amp; f=rb-&gt;bex.getForce(b-&gt;getId());
-		#else
-			const Vector3r&amp; m=Shop::Bex::momentum(b-&gt;getId(),rb.get());
-			const Vector3r&amp; f=Shop::Bex::force(b-&gt;getId(),rb.get());
-		#endif
+		const Vector3r&amp; m=rb-&gt;bex.getTorque(b-&gt;getId());
+		const Vector3r&amp; f=rb-&gt;bex.getForce(b-&gt;getId());
 		Vector3r r=b-&gt;physicalParameters-&gt;se3.position-axisPt;
 		ret+=axis.Dot(m+r.Cross(f));
 	}
@@ -219,11 +214,7 @@
 	Vector3r direction=tuple2vec(_direction);
 	FOREACH(const shared_ptr&lt;Body&gt; b, *rb-&gt;bodies){
 		if(!b-&gt;maskOk(mask)) continue;
-		#ifdef BEX_CONTAINER
-			const Vector3r&amp; f=rb-&gt;bex.getForce(b-&gt;getId());
-		#else
-			const Vector3r&amp; f=Shop::Bex::force(b-&gt;getId(),rb.get());
-		#endif
+		const Vector3r&amp; f=rb-&gt;bex.getForce(b-&gt;getId());
 		ret+=direction.Dot(f);
 	}
 	return ret;

Modified: trunk/gui/py/utils.py
===================================================================
--- trunk/gui/py/utils.py	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/gui/py/utils.py	2009-03-30 17:10:27 UTC (rev 1738)
@@ -378,7 +378,6 @@
 	engines, however. By default, no gravity is applied.
 	&quot;&quot;&quot;
 	O.initializers=[
-		StandAloneEngine('PhysicalActionContainerInitializer'),
 		MetaEngine('BoundingVolumeMetaEngine',[EngineUnit('InteractingSphere2AABB'),EngineUnit('InteractingBox2AABB'),EngineUnit('InteractingFacet2AABB'),EngineUnit('MetaInteractingGeometry2AABB')])
 	]
 	O.engines=[

Modified: trunk/gui/py/yadeControl.cpp
===================================================================
--- trunk/gui/py/yadeControl.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/gui/py/yadeControl.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -405,37 +405,6 @@
 
 Vector3r tuple2vec(const python::tuple&amp; t){return Vector3r(python::extract&lt;double&gt;(t[0])(),python::extract&lt;double&gt;(t[1])(),python::extract&lt;double&gt;(t[2])());}
 
-BASIC_PY_PROXY(pyPhysicalAction,PhysicalAction);
-
-class pyPhysicalActionContainer{
-	public:
-		const shared_ptr&lt;PhysicalActionContainer&gt; proxee;
-		pyPhysicalActionContainer(const shared_ptr&lt;PhysicalActionContainer&gt;&amp; _proxee): proxee(_proxee){}
-		pyPhysicalAction pyGetitem(python::object action_and_id){
-			if(!PySequence_Check(action_and_id.ptr())) throw invalid_argument(&quot;Key must be a tuple&quot;);
-			if(python::len(action_and_id)!=2) throw invalid_argument(&quot;Key must be a 2-tuple: [action-name , body id].&quot;);
-			python::extract&lt;string&gt; actionName_(PySequence_GetItem(action_and_id.ptr(),0));
-			python::extract&lt;body_id_t&gt; id_(PySequence_GetItem(action_and_id.ptr(),1));
-			if(!actionName_.check()) throw invalid_argument(&quot;Could not extract action-name.&quot;);
-			if(!id_.check()) throw invalid_argument(&quot;Could not extract body id.&quot;);
-			// FIXME: this may be rather slow (at every lookup!)
-			int actionClassIndex=dynamic_pointer_cast&lt;Indexable&gt;(ClassFactory::instance().createShared(actionName_()))-&gt;getClassIndex();
-			LOG_DEBUG(&quot;Got class index &quot;&lt;&lt;actionClassIndex&lt;&lt;&quot; for &quot;&lt;&lt;actionName_());
-			return pyPhysicalAction(proxee-&gt;find(id_(),actionClassIndex));
-		}
-	python::tuple force_get(long id){ Shop::Bex::initCache(); Vector3r f=Shop::Bex::force(id); return python::make_tuple(f[0],f[1],f[2]);}
-	python::tuple momentum_get(long id){ Shop::Bex::initCache(); Vector3r m=Shop::Bex::momentum(id); return python::make_tuple(m[0],m[1],m[2]);}
-	#ifndef BEX_CONTAINER
-		void force_add(long id, python::tuple f){ Shop::Bex::initCache(); Shop::Bex::force(id)+=tuple2vec(f);}
-		void torque_add(long id, python::tuple m){ Shop::Bex::initCache(); Shop::Bex::momentum(id)+=tuple2vec(m);}
-	#else
-		void force_add(long id, python::tuple f){ throw runtime_error(&quot;ActionContainer not supported with BexContainer&quot;);}
-		void torque_add(long id, python::tuple m){ throw runtime_error(&quot;ActionContainer not supported with BexContainer&quot;);}
-	#endif
-};
-
-
-#ifdef BEX_CONTAINER
 class pyBexContainer{
 	public:
 		pyBexContainer(){}
@@ -444,9 +413,7 @@
 		void force_add(long id, python::tuple f){  MetaBody* rb=Omega::instance().getRootBody().get(); rb-&gt;bex.addForce (id,tuple2vec(f)); }
 		void torque_add(long id, python::tuple t){ MetaBody* rb=Omega::instance().getRootBody().get(); rb-&gt;bex.addTorque(id,tuple2vec(t));}
 };
-#endif
 
-
 class pyOmega{
 	private:
 		// can be safely removed now, since pyOmega makes an empty rootBody in the constructor, if there is none
@@ -502,10 +469,8 @@
 
 	bool timingEnabled_get(){return TimingInfo::enabled;}
 	void timingEnabled_set(bool enabled){TimingInfo::enabled=enabled;}
-	#ifdef BEX_CONTAINER
-		unsigned long bexSyncCount_get(){ return OMEGA.getRootBody()-&gt;bex.syncCount;}
-		void bexSyncCount_set(unsigned long count){ OMEGA.getRootBody()-&gt;bex.syncCount=count;}
-	#endif
+	unsigned long bexSyncCount_get(){ return OMEGA.getRootBody()-&gt;bex.syncCount;}
+	void bexSyncCount_set(unsigned long count){ OMEGA.getRootBody()-&gt;bex.syncCount=count;}
 
 	void run(long int numIter=-1,bool doWait=false){
 		if(numIter&gt;0) OMEGA.getRootBody()-&gt;stopAtIteration=OMEGA.getCurrentIteration()+numIter;
@@ -599,11 +564,7 @@
 	pyBodyContainer bodies_get(void){assertRootBody(); return pyBodyContainer(OMEGA.getRootBody()-&gt;bodies); }
 	pyInteractionContainer interactions_get(void){assertRootBody(); return pyInteractionContainer(OMEGA.getRootBody()-&gt;interactions); }
 	
-	#ifdef BEX_CONTAINER
-		pyBexContainer actions_get(void){return pyBexContainer();}
-	#else
-		pyPhysicalActionContainer actions_get(void){return pyPhysicalActionContainer(OMEGA.getRootBody()-&gt;physicalActions); }
-	#endif
+	pyBexContainer actions_get(void){return pyBexContainer();}
 	
 
 	boost::python::list listChildClasses(const string&amp; base){
@@ -633,14 +594,6 @@
 		rb-&gt;bodies=bc;
 	}
 	string bodyContainer_get(string clss){ return OMEGA.getRootBody()-&gt;bodies-&gt;getClassName(); }
-	#ifndef BEX_CONTAINER
-		void physicalActionContainer_set(string clss){
-			MetaBody* rb=OMEGA.getRootBody().get();
-			shared_ptr&lt;PhysicalActionContainer&gt; pac=dynamic_pointer_cast&lt;PhysicalActionContainer&gt;(ClassFactory::instance().createShared(clss));
-			rb-&gt;physicalActions=pac;
-		}
-		string physicalActionContainer_get(string clss){ return OMEGA.getRootBody()-&gt;physicalActions-&gt;getClassName(); }
-	#endif
 
 };
 BOOST_PYTHON_MEMBER_FUNCTION_OVERLOADS(omega_run_overloads,run,0,2);
@@ -700,9 +653,7 @@
 		.add_property(&quot;bodyContainer&quot;,&amp;pyOmega::bodyContainer_get,&amp;pyOmega::bodyContainer_set)
 		.add_property(&quot;interactionContainer&quot;,&amp;pyOmega::interactionContainer_get,&amp;pyOmega::interactionContainer_set)
 		.add_property(&quot;timingEnabled&quot;,&amp;pyOmega::timingEnabled_get,&amp;pyOmega::timingEnabled_set)
-		#ifdef BEX_CONTAINER
-			.add_property(&quot;bexSyncCount&quot;,&amp;pyOmega::bexSyncCount_get,&amp;pyOmega::bexSyncCount_set)
-		#endif
+		.add_property(&quot;bexSyncCount&quot;,&amp;pyOmega::bexSyncCount_get,&amp;pyOmega::bexSyncCount_set)
 		;
 	boost::python::class_&lt;pyTags&gt;(&quot;TagsWrapper&quot;,python::init&lt;pyTags&amp;&gt;())
 		.def(&quot;__getitem__&quot;,&amp;pyTags::getItem)
@@ -725,21 +676,12 @@
 		.def(&quot;__iter__&quot;,&amp;pyInteractionIterator::pyIter)
 		.def(&quot;next&quot;,&amp;pyInteractionIterator::pyNext);
 
-	boost::python::class_&lt;pyPhysicalActionContainer&gt;(&quot;ActionContainer&quot;,python::init&lt;pyPhysicalActionContainer&amp;&gt;())
-		.def(&quot;__getitem__&quot;,&amp;pyPhysicalActionContainer::pyGetitem)
-		.def(&quot;f&quot;,&amp;pyPhysicalActionContainer::force_get)
-		.def(&quot;m&quot;,&amp;pyPhysicalActionContainer::momentum_get)
-		.def(&quot;addF&quot;,&amp;pyPhysicalActionContainer::force_add)
-		.def(&quot;addT&quot;,&amp;pyPhysicalActionContainer::torque_add);
-
-	#ifdef BEX_CONTAINER
 	boost::python::class_&lt;pyBexContainer&gt;(&quot;BexContainer&quot;,python::init&lt;pyBexContainer&amp;&gt;())
 		.def(&quot;f&quot;,&amp;pyBexContainer::force_get)
 		.def(&quot;t&quot;,&amp;pyBexContainer::torque_get)
 		.def(&quot;m&quot;,&amp;pyBexContainer::torque_get) // for compatibility with ActionContainer
 		.def(&quot;addF&quot;,&amp;pyBexContainer::force_add)
 		.def(&quot;addT&quot;,&amp;pyBexContainer::torque_add);
-	#endif
 
 	boost::python::class_&lt;pyTimingDeltas&gt;(&quot;TimingDeltas&quot;,python::init&lt;pyTimingDeltas&amp;&gt;())
 		.def(&quot;reset&quot;,&amp;pyTimingDeltas::reset)
@@ -803,8 +745,6 @@
 		.add_property(&quot;id1&quot;,&amp;pyInteraction::id1_get)
 		.add_property(&quot;id2&quot;,&amp;pyInteraction::id2_get);
 
-	BASIC_PY_PROXY_WRAPPER(pyPhysicalAction,&quot;Action&quot;);
-
 	BASIC_PY_PROXY_WRAPPER(pyFileGenerator,&quot;Preprocessor&quot;)
 		.def(&quot;generate&quot;,&amp;pyFileGenerator::generate)
 		.def(&quot;load&quot;,&amp;pyFileGenerator::load);

Deleted: trunk/pkg/common/Container/PhysicalActionVectorVector.hpp
===================================================================
--- trunk/pkg/common/Container/PhysicalActionVectorVector.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Container/PhysicalActionVectorVector.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -1 +0,0 @@
-#include&lt;yade/core/PhysicalActionVectorVector.hpp&gt;

Modified: trunk/pkg/common/Engine/DeusExMachina/CinemCNCEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/CinemCNCEngine.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/DeusExMachina/CinemCNCEngine.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -10,14 +10,13 @@
 #include &quot;CinemCNCEngine.hpp&quot;
 #include&lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
 #include&lt;yade/pkg-common/InteractingBox.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
 #include&lt;yade/pkg-dem/ElasticContactInteraction.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
 #include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
 #include &lt;yade/lib-miniWm3/Wm3Math.h&gt;
 
 
-CinemCNCEngine::CinemCNCEngine() : actionForce(new Force), leftbox(new Body), rightbox(new Body), frontbox(new Body), backbox(new Body), topbox(new Body), boxbas(new Body)
+CinemCNCEngine::CinemCNCEngine() : leftbox(new Body), rightbox(new Body), frontbox(new Body), backbox(new Body), topbox(new Body), boxbas(new Body)
 {
 	prevF_sup=Vector3r(0,0,0);
 	firstRun=true;
@@ -187,11 +186,7 @@
 
 void CinemCNCEngine::computeDu(MetaBody* ncb)
 {
-	#ifdef BEX_CONTAINER
-		ncb-&gt;bex.sync(); Vector3r F_sup=ncb-&gt;bex.getForce(id_boxhaut);
-	#else
-		Vector3r&amp; F_sup = dynamic_cast&lt;Force*&gt;(ncb-&gt;physicalActions-&gt;find(id_boxhaut,actionForce-&gt;getClassIndex()) . get() )-&gt;force;
-	#endif
+	ncb-&gt;bex.sync(); Vector3r F_sup=ncb-&gt;bex.getForce(id_boxhaut);
 	
 	if(firstRun)
 	{

Modified: trunk/pkg/common/Engine/DeusExMachina/CinemCNCEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/CinemCNCEngine.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/DeusExMachina/CinemCNCEngine.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -33,7 +33,6 @@
 class CinemCNCEngine : public DeusExMachina
 {
 	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
 		shared_ptr&lt;ContactLaw1&gt; myLdc;
 		Real	coeff_dech;	// in the case of the use of &quot;ContactLaw1&quot; for ex where kn(unload)#kn(load). The engine cares to find the value at the first run
 		Real	alpha	// angle from the lower plate to the left box (trigo wise), the Engine finds itself its value

Modified: trunk/pkg/common/Engine/DeusExMachina/CinemKNCEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/CinemKNCEngine.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/DeusExMachina/CinemKNCEngine.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -10,14 +10,13 @@
 #include &quot;CinemKNCEngine.hpp&quot;
 #include&lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
 #include&lt;yade/pkg-common/InteractingBox.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
 #include&lt;yade/pkg-dem/ElasticContactInteraction.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
 #include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
 #include &lt;yade/lib-miniWm3/Wm3Math.h&gt;
 
 
-CinemKNCEngine::CinemKNCEngine() : actionForce(new Force), leftbox(new Body), rightbox(new Body), frontbox(new Body), backbox(new Body), topbox(new Body), boxbas(new Body)
+CinemKNCEngine::CinemKNCEngine() : leftbox(new Body), rightbox(new Body), frontbox(new Body), backbox(new Body), topbox(new Body), boxbas(new Body)
 {
 	prevF_sup=Vector3r(0,0,0);
 	firstRun=true;
@@ -180,11 +179,7 @@
 void CinemKNCEngine::computeDu(MetaBody* ncb)
 {
 
-	#ifdef BEX_CONTAINER
-		ncb-&gt;bex.sync(); Vector3r F_sup=ncb-&gt;bex.getForce(id_boxhaut);
-	#else
-		Vector3r&amp; F_sup = dynamic_cast&lt;Force*&gt;(ncb-&gt;physicalActions-&gt;find(id_boxhaut,actionForce-&gt;getClassIndex()) . get() )-&gt;force;
-	#endif
+	ncb-&gt;bex.sync(); Vector3r F_sup=ncb-&gt;bex.getForce(id_boxhaut);
 	
 	if(firstRun)
 	{

Modified: trunk/pkg/common/Engine/DeusExMachina/CinemKNCEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/CinemKNCEngine.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/DeusExMachina/CinemKNCEngine.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -31,7 +31,6 @@
 class CinemKNCEngine : public DeusExMachina
 {
 	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
 		shared_ptr&lt;ContactLaw1&gt; myLdc;
 		Real	coeff_dech;	// the engine cares about it
 		Real	alpha	// angle from the lower plate to the left box (trigo wise), the Engine finds itself its value

Modified: trunk/pkg/common/Engine/DeusExMachina/DisplacementToForceEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/DisplacementToForceEngine.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/DeusExMachina/DisplacementToForceEngine.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -9,9 +9,8 @@
 #include&quot;DisplacementToForceEngine.hpp&quot;
 #include&lt;yade/core/MetaBody.hpp&gt;
 #include&lt;yade/pkg-common/ParticleParameters.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
 
-DisplacementToForceEngine::DisplacementToForceEngine() : actionParameterForce(new Force), targetForce(Vector3r::ZERO), targetForceMask(Vector3r::ZERO) 
+DisplacementToForceEngine::DisplacementToForceEngine() : targetForce(Vector3r::ZERO), targetForceMask(Vector3r::ZERO) 
 {
 	direction=1.0;
 	old_direction=1.0;
@@ -56,18 +55,12 @@
 	std::vector&lt;int&gt;::const_iterator ii = subscribedBodies.begin();
 	std::vector&lt;int&gt;::const_iterator iiEnd = subscribedBodies.end();
 
-	#ifdef BEX_CONTAINER
-		ncb-&gt;bex.sync();
-	#endif
+	ncb-&gt;bex.sync();
 
 	for(;ii!=iiEnd;++ii)
 		if( bodies-&gt;exists(*ii) )
 		{
-			#ifdef BEX_CONTAINER
-				Vector3r current_force=ncb-&gt;bex.getForce(*ii);
-			#else
-				Vector3r current_force=static_cast&lt;Force*&gt;( ncb-&gt;physicalActions-&gt;find(*ii,actionParameterForce-&gt;getClassIndex() ).get() )-&gt;force;
-			#endif
+			Vector3r current_force=ncb-&gt;bex.getForce(*ii);
 
 			Real current_length_sq = 
 				  (targetForceMask[0] != 0) ? current_force[0]*current_force[0]:0.0 

Modified: trunk/pkg/common/Engine/DeusExMachina/DisplacementToForceEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/DisplacementToForceEngine.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/DeusExMachina/DisplacementToForceEngine.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -12,12 +12,9 @@
 #include&lt;Wm3Vector3.h&gt;
 #include&lt;yade/lib-base/yadeWm3.hpp&gt;
 
-class Force;
-
 class DisplacementToForceEngine : public DeusExMachina
 {
 	private :
-		shared_ptr&lt;Force&gt;	actionParameterForce;
 		Real			target_length_sq,direction,old_direction,oscillations;
 	public :
 		Vector3r		targetForce,targetForceMask;

Modified: trunk/pkg/common/Engine/DeusExMachina/ForceEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/ForceEngine.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/DeusExMachina/ForceEngine.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -8,13 +8,12 @@
 
 #include&quot;ForceEngine.hpp&quot;
 #include&lt;yade/pkg-common/ParticleParameters.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
 
 #include&lt;boost/foreach.hpp&gt;
 
 
-ForceEngine::ForceEngine() : actionParameterForce(new Force), force(Vector3r::ZERO)
+ForceEngine::ForceEngine() : force(Vector3r::ZERO)
 {
 }
 
@@ -33,11 +32,7 @@
 void ForceEngine::applyCondition(MetaBody* ncb){
 	FOREACH(body_id_t id, subscribedBodies){
 		assert(ncb-&gt;bodies-&gt;exists(id));
-		#ifdef BEX_CONTAINER
-			ncb-&gt;bex.addForce(id,force);
-		#else
-			static_pointer_cast&lt;Force&gt;(ncb-&gt;physicalActions-&gt;find(id,actionParameterForce-&gt;getClassIndex()))-&gt;force+=force;	
-		#endif
+		ncb-&gt;bex.addForce(id,force);
 	}
 }
 

Modified: trunk/pkg/common/Engine/DeusExMachina/ForceEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/ForceEngine.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/DeusExMachina/ForceEngine.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -10,12 +10,8 @@
 
 #include&lt;yade/core/DeusExMachina.hpp&gt;
 
-class Force;
-
 class ForceEngine : public DeusExMachina 
 {
-	private :
-		shared_ptr&lt;Force&gt;	actionParameterForce;
 	public :
 		Vector3r		force;
 
@@ -26,7 +22,6 @@
 	
 	protected :
 		virtual void registerAttributes();
-	NEEDS_BEX(&quot;Force&quot;);
 	REGISTER_CLASS_NAME(ForceEngine);
 	REGISTER_BASE_CLASS_NAME(DeusExMachina);
 };

Modified: trunk/pkg/common/Engine/DeusExMachina/GravityEngines.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/GravityEngines.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/DeusExMachina/GravityEngines.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -24,11 +24,7 @@
 		if(b-&gt;isClumpMember()) continue;
 		shared_ptr&lt;ParticleParameters&gt; p=YADE_PTR_CAST&lt;ParticleParameters&gt;(b-&gt;physicalParameters);
 		if(p!=0) //not everything derives from ParticleParameters; this line was    assert(p); - Janek
-		#ifdef BEX_CONTAINER
-			ncb-&gt;bex.addForce(b-&gt;getId(),gravity*p-&gt;mass);
-		#else
-			static_cast&lt;Force*&gt;(ncb-&gt;physicalActions-&gt;find(b-&gt;getId(),cachedForceClassIndex).get())-&gt;force+=gravity*p-&gt;mass;
-		#endif
+		ncb-&gt;bex.addForce(b-&gt;getId(),gravity*p-&gt;mass);
 	}
 }
 
@@ -38,13 +34,8 @@
 		if(b-&gt;isClumpMember() || b-&gt;getId()==centralBody) continue; // skip clump members and central body
 		Real F=accel*YADE_PTR_CAST&lt;ParticleParameters&gt;(b-&gt;physicalParameters)-&gt;mass;
 		Vector3r toCenter=centralPos-b-&gt;physicalParameters-&gt;se3.position; toCenter.Normalize();
-		#ifdef BEX_CONTAINER
-			rootBody-&gt;bex.addForce(b-&gt;getId(),F*toCenter);
-			if(reciprocal) rootBody-&gt;bex.addForce(centralBody,-F*toCenter);
-		#else
-			static_cast&lt;Force*&gt;(rootBody-&gt;physicalActions-&gt;find(b-&gt;getId(),cachedForceClassIndex).get())-&gt;force+=F*toCenter;
-			if(reciprocal) static_cast&lt;Force*&gt;(rootBody-&gt;physicalActions-&gt;find(centralBody,cachedForceClassIndex).get())-&gt;force-=F*toCenter;
-		#endif
+		rootBody-&gt;bex.addForce(b-&gt;getId(),F*toCenter);
+		if(reciprocal) rootBody-&gt;bex.addForce(centralBody,-F*toCenter);
 	}
 }
 
@@ -58,11 +49,6 @@
 		const Vector3r x2=axisPoint+axisDirection;
 		Vector3r closestAxisPoint=(x2-x1) * /* t */ (-(x1-x0).Dot(x2-x1))/((x2-x1).SquaredLength());
 		Vector3r toAxis=closestAxisPoint-x0; toAxis.Normalize();
-		#ifdef BEX_CONTAINER
-			rootBody-&gt;bex.addForce(b-&gt;getId(),acceleration*myMass*toAxis);
-		#else
-			static_pointer_cast&lt;Force&gt;(rootBody-&gt;physicalActions-&gt;find(b-&gt;getId(),cachedForceClassIndex))-&gt;force+=acceleration*myMass*toAxis;
-			//if(b-&gt;getId()==20){ TRVAR3(toAxis,acceleration*myMass*toAxis,static_pointer_cast&lt;Force&gt;(rootBody-&gt;physicalActions-&gt;find(b-&gt;getId(),cachedForceClassIndex))-&gt;force); }
-		#endif
+		rootBody-&gt;bex.addForce(b-&gt;getId(),acceleration*myMass*toAxis);
 	}
 }

Modified: trunk/pkg/common/Engine/DeusExMachina/GravityEngines.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/GravityEngines.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/DeusExMachina/GravityEngines.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -2,21 +2,18 @@
 // 2007,2008 &#169; V&#225;clav &#352;milauer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">eudoxos at arcig.cz</A>&gt; 
 #pragma once
 #include&lt;yade/core/DeusExMachina.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
 
 /* Homogeneous gravity field; applies gravity*mass force on all bodies.
  *
  * @bug is a DeusExMachina, but doesn't care about subscribedBodies.
  */
 class GravityEngine : public DeusExMachina{
-		int cachedForceClassIndex;
 	public :
 		Vector3r gravity;
-		GravityEngine(): gravity(Vector3r::ZERO){shared_ptr&lt;Force&gt; f(new Force); cachedForceClassIndex=f-&gt;getClassIndex();};
+		GravityEngine(): gravity(Vector3r::ZERO){};
 		virtual ~GravityEngine(){};
 		virtual void applyCondition(MetaBody*);
 	protected :
-	NEEDS_BEX(&quot;Force&quot;);
 	REGISTER_ATTRIBUTES(DeusExMachina,(gravity));
 	REGISTER_CLASS_AND_BASE(GravityEngine,DeusExMachina);
 };
@@ -29,8 +26,6 @@
  * @bug is a DeusExMachina, but doesn't care about subscribedBodies.
  */
 class CentralGravityEngine: public DeusExMachina {
-	private:
-		int cachedForceClassIndex;
 	public:
 		//! The body towards which all other bodies are attracted.
 		body_id_t centralBody;
@@ -38,12 +33,11 @@
 		Real accel;
 		//! Whether to apply reciprocal force to the central body as well
 		bool reciprocal;
-		CentralGravityEngine(){ shared_ptr&lt;Force&gt; f(new Force); cachedForceClassIndex=f-&gt;getClassIndex(); reciprocal=false; }
+		CentralGravityEngine(){ reciprocal=false; }
 		virtual ~CentralGravityEngine(){};
 		virtual void applyCondition(MetaBody*);
 	protected:
 		virtual void registerAttributes(){DeusExMachina::registerAttributes(); REGISTER_ATTRIBUTE(centralBody); REGISTER_ATTRIBUTE(accel); REGISTER_ATTRIBUTE(reciprocal); }
-		NEEDS_BEX(&quot;Force&quot;);
 		REGISTER_CLASS_NAME(CentralGravityEngine);
 		REGISTER_BASE_CLASS_NAME(DeusExMachina);
 };
@@ -54,8 +48,6 @@
  * @bug is a DeusExMachina, but doesn't care about subscribedBodies.
  */
 class AxialGravityEngine: public DeusExMachina {
-	private:
-		int cachedForceClassIndex;
 	public:
 		//! point through which the axis is passing
 		Vector3r axisPoint;
@@ -63,12 +55,11 @@
 		Vector3r axisDirection;
 		//! magnitude of acceleration that will be applied
 		Real acceleration;
-		AxialGravityEngine(){ shared_ptr&lt;Force&gt; f(new Force); cachedForceClassIndex=f-&gt;getClassIndex(); }
+		AxialGravityEngine(){ }
 		virtual ~AxialGravityEngine(){};
 		virtual void applyCondition(MetaBody*);
 	protected:
 		virtual void registerAttributes(){DeusExMachina::registerAttributes(); REGISTER_ATTRIBUTE(axisPoint); REGISTER_ATTRIBUTE(axisDirection); REGISTER_ATTRIBUTE(acceleration); }
-		NEEDS_BEX(&quot;Force&quot;);
 		REGISTER_CLASS_NAME(AxialGravityEngine);
 		REGISTER_BASE_CLASS_NAME(DeusExMachina);
 };

Modified: trunk/pkg/common/Engine/DeusExMachina/MomentEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/MomentEngine.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/DeusExMachina/MomentEngine.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -8,13 +8,12 @@
 
 #include&quot;MomentEngine.hpp&quot;
 #include&lt;yade/pkg-common/ParticleParameters.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
 
 
 #include&lt;yade/core/MetaBody.hpp&gt;
 
 
-MomentEngine::MomentEngine() : actionParameterMoment(new Momentum), moment(Vector3r::ZERO)
+MomentEngine::MomentEngine() : moment(Vector3r::ZERO)
 {
 }
 
@@ -40,11 +39,7 @@
 	{
 		if(ncb-&gt;bodies-&gt;exists( *ii ))
 		{
-			#ifdef BEX_CONTAINER
-				ncb-&gt;bex.addTorque(*ii,moment);
-			#else
-				static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( *ii        , actionParameterMoment-&gt;getClassIndex() ).get() )-&gt;momentum += moment;
-			#endif
+			ncb-&gt;bex.addTorque(*ii,moment);
 		} else {
 			std::cerr &lt;&lt; &quot;MomentEngine: body &quot; &lt;&lt; *ii &lt;&lt; &quot;doesn't exist, cannot apply moment.&quot;;
 		}

Modified: trunk/pkg/common/Engine/DeusExMachina/MomentEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/MomentEngine.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/DeusExMachina/MomentEngine.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -10,12 +10,9 @@
 
 #include&lt;yade/core/DeusExMachina.hpp&gt;
 
-class Momentum;
 
 class MomentEngine : public DeusExMachina 
 {
-	private :
-		shared_ptr&lt;Momentum&gt;	actionParameterMoment;
 	public :
 		Vector3r		moment;
 
@@ -26,7 +23,6 @@
 	
 	protected :
 		virtual void registerAttributes();
-	NEEDS_BEX(&quot;Momentum&quot;);
 	REGISTER_CLASS_NAME(MomentEngine);
 	REGISTER_BASE_CLASS_NAME(DeusExMachina);
 };

Modified: trunk/pkg/common/Engine/EngineUnit/CundallNonViscousDamping.cpp
===================================================================
--- trunk/pkg/common/Engine/EngineUnit/CundallNonViscousDamping.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/EngineUnit/CundallNonViscousDamping.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -2,13 +2,10 @@
 
 #include&lt;yade/pkg-common/ParticleParameters.hpp&gt;
 #include&lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
 #include&quot;CundallNonViscousDamping.hpp&quot;
 
 YADE_PLUGIN(&quot;CundallNonViscousForceDamping&quot;,&quot;CundallNonViscousMomentumDamping&quot;);
 
-#ifdef BEX_CONTAINER
 //! damping of force, for bodies that have only ParticleParameters
 void CundallNonViscousForceDamping::go(const shared_ptr&lt;PhysicalParameters&gt;&amp; pp, const Body* body, MetaBody* rb){
 	if(body-&gt;isClump()) return;
@@ -31,39 +28,3 @@
 	}
 	rb-&gt;bex.addForce(id,df); rb-&gt;bex.addTorque(id,dt);
 }
-#else
-// this is Cundall non-viscous local damping, applied to force (Force)
-void CundallNonViscousForceDamping::go(    const shared_ptr&lt;PhysicalAction&gt;&amp; a
-						, const shared_ptr&lt;PhysicalParameters&gt;&amp; b
-						, const Body* body)
-{
-	if(body-&gt;isClump()) return;
-	Force * af = static_cast&lt;Force*&gt;(a.get());
-	ParticleParameters * p = static_cast&lt;ParticleParameters*&gt;(b.get());
-	
-	for (int i=0; i&lt;3; ++i)
-	{
-		af-&gt;force[i] *= 1 - damping*Mathr::Sign(af-&gt;force[i]*p-&gt;velocity[i]);	
-	}
-}
-
-// this is Cundall non-viscous local damping, applied to momentum (Momentum)
-void CundallNonViscousMomentumDamping::go( 	  const shared_ptr&lt;PhysicalAction&gt;&amp; a
-						, const shared_ptr&lt;PhysicalParameters&gt;&amp; b
-						, const Body* body)
-{
-	if(body-&gt;isClump()) return;
-	Momentum * am = static_cast&lt;Momentum*&gt;(a.get());
-	RigidBodyParameters * rb = static_cast&lt;RigidBodyParameters*&gt;(b.get());
-	
-	Vector3r&amp; m  = am-&gt;momentum;
-	
-	for (int i=0; i&lt;3; ++i){
-		m[i] *= 1 - damping*Mathr::Sign(m[i]*rb-&gt;angularVelocity[i]);	
-	}
-}
-#endif
-
-
-
-

Modified: trunk/pkg/common/Engine/EngineUnit/CundallNonViscousDamping.hpp
===================================================================
--- trunk/pkg/common/Engine/EngineUnit/CundallNonViscousDamping.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/EngineUnit/CundallNonViscousDamping.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -7,14 +7,8 @@
 		Real damping;
 		CundallNonViscousForceDamping(): damping(0){};
 		virtual void registerAttributes(){PhysicalActionDamperUnit::registerAttributes();REGISTER_ATTRIBUTE(damping);}
-	#ifdef BEX_CONTAINER
-		virtual void go(const shared_ptr&lt;PhysicalParameters&gt;&amp;, const Body*, MetaBody*);
-		FUNCTOR1D(ParticleParameters);
-	#else
-		virtual void go(const shared_ptr&lt;PhysicalAction&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp; , const Body*);
-		NEEDS_BEX(&quot;Force&quot;);
-		FUNCTOR2D(Force,ParticleParameters);
-	#endif
+	virtual void go(const shared_ptr&lt;PhysicalParameters&gt;&amp;, const Body*, MetaBody*);
+	FUNCTOR1D(ParticleParameters);
 	REGISTER_CLASS_AND_BASE(CundallNonViscousForceDamping,PhysicalActionDamperUnit);
 };
 REGISTER_SERIALIZABLE(CundallNonViscousForceDamping);
@@ -24,14 +18,8 @@
 		Real damping;
 		CundallNonViscousMomentumDamping(): damping(0){};
 		virtual void registerAttributes(){PhysicalActionDamperUnit::registerAttributes();REGISTER_ATTRIBUTE(damping); }
-	#ifdef BEX_CONTAINER
 		virtual void go(const shared_ptr&lt;PhysicalParameters&gt;&amp;, const Body*, MetaBody*);
-		FUNCTOR1D(RigidBodyParameters);
-	#else
-		virtual void go(const shared_ptr&lt;PhysicalAction&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;, const Body*);
-		NEEDS_BEX(&quot;Momentum&quot;);
-		FUNCTOR2D(Momentum,RigidBodyParameters);
-	#endif
+	FUNCTOR1D(RigidBodyParameters);
 	REGISTER_CLASS_AND_BASE(CundallNonViscousMomentumDamping,PhysicalActionDamperUnit);
 };
 REGISTER_SERIALIZABLE(CundallNonViscousMomentumDamping);

Modified: trunk/pkg/common/Engine/EngineUnit/NewtonsForceLaw.cpp
===================================================================
--- trunk/pkg/common/Engine/EngineUnit/NewtonsForceLaw.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/EngineUnit/NewtonsForceLaw.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -11,19 +11,10 @@
 #include&quot;NewtonsForceLaw.hpp&quot;
 #include&lt;yade/pkg-common/ParticleParameters.hpp&gt;
 #include&lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
 
-#ifdef BEX_CONTAINER
 void NewtonsForceLaw::go(const shared_ptr&lt;PhysicalParameters&gt;&amp; b, const Body* bb, MetaBody* rb){
 	Vector3r f=rb-&gt;bex.getForce(bb-&gt;getId());
-#else
-void NewtonsForceLaw::go( const shared_ptr&lt;PhysicalAction&gt;&amp; a
-			, const shared_ptr&lt;PhysicalParameters&gt;&amp; b
-			, const Body* bb)
-{
-	const Vector3r&amp; f = YADE_CAST&lt;Force*&gt;(a.get())-&gt;force;
-#endif
 	ParticleParameters * p = YADE_CAST&lt;ParticleParameters*&gt;(b.get());
 	
 	// normal behavior of a standalone particle or a clump itself

Modified: trunk/pkg/common/Engine/EngineUnit/NewtonsForceLaw.hpp
===================================================================
--- trunk/pkg/common/Engine/EngineUnit/NewtonsForceLaw.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/EngineUnit/NewtonsForceLaw.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -10,28 +10,12 @@
 
 #include&lt;yade/pkg-common/PhysicalActionApplierUnit.hpp&gt;
 
-#ifdef BEX_CONTAINER
-	class NewtonsForceLaw: public PhysicalActionApplierUnit{
-		public:
-			virtual void go(const shared_ptr&lt;PhysicalParameters&gt;&amp;, const Body*, MetaBody*);
-			FUNCTOR1D(ParticleParameters);
-			REGISTER_CLASS_AND_BASE(NewtonsForceLaw,PhysicalActionApplierUnit);
-	};
-
-#else
-	class NewtonsForceLaw : public PhysicalActionApplierUnit
-	{
-		public :
-			virtual void go( 	  const shared_ptr&lt;PhysicalAction&gt;&amp;
-						, const shared_ptr&lt;PhysicalParameters&gt;&amp;
-						, const Body*);
-		NEEDS_BEX(&quot;Force&quot;);
-		FUNCTOR2D(Force,ParticleParameters);
-		REGISTER_CLASS_NAME(NewtonsForceLaw);
-		REGISTER_BASE_CLASS_NAME(PhysicalActionApplierUnit);
-	};
-#endif
-
+class NewtonsForceLaw: public PhysicalActionApplierUnit{
+	public:
+		virtual void go(const shared_ptr&lt;PhysicalParameters&gt;&amp;, const Body*, MetaBody*);
+		FUNCTOR1D(ParticleParameters);
+		REGISTER_CLASS_AND_BASE(NewtonsForceLaw,PhysicalActionApplierUnit);
+};
 REGISTER_SERIALIZABLE(NewtonsForceLaw);
 
 

Modified: trunk/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw.cpp
===================================================================
--- trunk/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -10,12 +10,10 @@
 
 #include &quot;NewtonsMomentumLaw.hpp&quot;
 #include&lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
 #include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
 
-#ifdef BEX_CONTAINER
-//! Newtons law for both force and momentum
+//! Newtons law for both force and torque
 void NewtonsMomentumLaw::go(const shared_ptr&lt;PhysicalParameters&gt;&amp; b, const Body* bb, MetaBody* rb){
 	body_id_t id=bb-&gt;getId();
 	Vector3r f=rb-&gt;bex.getForce(id); Vector3r m=rb-&gt;bex.getTorque(id);
@@ -32,24 +30,5 @@
 		clumpRBP-&gt;angularAcceleration+=diagDiv(m,clumpRBP-&gt;inertia);
 	}
 }
-#else
-void NewtonsMomentumLaw::go( 	  const shared_ptr&lt;PhysicalAction&gt;&amp; a
-				, const shared_ptr&lt;PhysicalParameters&gt;&amp; b
-				, const Body* bb)
-{
-	Momentum * am = static_cast&lt;Momentum*&gt;(a.get());
-	RigidBodyParameters * rb = static_cast&lt;RigidBodyParameters*&gt;(b.get());
-	
-	//FIXME : should be += and we should add an Engine that reset acceleration at the beginning
-	if(bb-&gt;isStandalone()) rb-&gt;angularAcceleration=diagDiv(am-&gt;momentum,rb-&gt;inertia);
-	else if(bb-&gt;isClump()) rb-&gt;angularAcceleration+=diagDiv(am-&gt;momentum,rb-&gt;inertia);
-	else { // isClumpMember()
-		const shared_ptr&lt;Body&gt;&amp; clump(Body::byId(bb-&gt;clumpId));
-		RigidBodyParameters* clumpRBP=YADE_CAST&lt;RigidBodyParameters*&gt;(clump-&gt;physicalParameters.get());
-		/* angularAcceleration is reset by ClumpMemberMover engine */
-		clumpRBP-&gt;angularAcceleration+=diagDiv(am-&gt;momentum,clumpRBP-&gt;inertia);
-	}
-}
-#endif
 
 YADE_PLUGIN();

Modified: trunk/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw.hpp
===================================================================
--- trunk/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -9,27 +9,12 @@
 #pragma once
 
 #include&lt;yade/pkg-common/PhysicalActionApplierUnit.hpp&gt;
-#ifdef BEX_CONTAINER
-	class NewtonsMomentumLaw: public PhysicalActionApplierUnit{
-		public:
-			virtual void go(const shared_ptr&lt;PhysicalParameters&gt;&amp;, const Body*, MetaBody*);
-			FUNCTOR1D(RigidBodyParameters);
-			REGISTER_CLASS_AND_BASE(NewtonsMomentumLaw,PhysicalActionApplierUnit);
-	};
-#else
-class NewtonsMomentumLaw : public PhysicalActionApplierUnit
-{
-	public :
-		virtual void go( 	  const shared_ptr&lt;PhysicalAction&gt;&amp;
-					, const shared_ptr&lt;PhysicalParameters&gt;&amp;
-					, const Body*);
-	
-	NEEDS_BEX(&quot;Momentum&quot;);
-	FUNCTOR2D(Momentum,RigidBodyParameters);
-	REGISTER_CLASS_NAME(NewtonsMomentumLaw);
-	REGISTER_BASE_CLASS_NAME(PhysicalActionApplierUnit);
+class NewtonsMomentumLaw: public PhysicalActionApplierUnit{
+	public:
+		virtual void go(const shared_ptr&lt;PhysicalParameters&gt;&amp;, const Body*, MetaBody*);
+		FUNCTOR1D(RigidBodyParameters);
+		REGISTER_CLASS_AND_BASE(NewtonsMomentumLaw,PhysicalActionApplierUnit);
 };
-#endif
 REGISTER_SERIALIZABLE(NewtonsMomentumLaw);
 
 

Modified: trunk/pkg/common/Engine/MetaEngine/ConstitutiveLaw.hpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/ConstitutiveLaw.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/MetaEngine/ConstitutiveLaw.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -3,37 +3,16 @@
 #include&lt;yade/core/Interaction.hpp&gt;
 #include&lt;yade/core/EngineUnit2D.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
 
 class ConstitutiveLaw: public EngineUnit2D &lt;
 		void, TYPELIST_4(shared_ptr&lt;InteractionGeometry&gt;&amp;, shared_ptr&lt;InteractionPhysics&gt;&amp;, Interaction*, MetaBody*)
 	&gt;{
-	#ifndef BEX_CONTAINER
-		int forceIdx, torqueIdx;
-	#endif
 	public:
-		ConstitutiveLaw(){
-			// cache force/torque indices for fast access in bodyForce and bodyTorque
-			#ifndef BEX_CONTAINER
-				forceIdx=shared_ptr&lt;PhysicalAction&gt;(new Force())-&gt;getClassIndex();
-				torqueIdx=shared_ptr&lt;PhysicalAction&gt;(new Momentum())-&gt;getClassIndex();
-			#endif
-		}
+		ConstitutiveLaw(){}
 	REGISTER_CLASS_AND_BASE(ConstitutiveLaw,EngineUnit2D);
-	/*! Convenience functions to get forces/torques quickly.
-	 * They are not strictly necessary and for simulation that have nodes with only translational DOFs,
-	 * It creates no overhead runtime overhead, since intialization of Forces/Momentums
-	 * is done only if the derived ConstitutiveLaw says NEEDS_BEX(&quot;Force&quot;,&quot;Momentum&quot;), for example.
-	 */
-#ifdef BEX_CONTAINER
+	/*! Convenience functions to get forces/torques quickly. */
 	void addForce (const body_id_t id, const Vector3r&amp; f,MetaBody* rb){rb-&gt;bex.addForce (id,f);}
 	void addTorque(const body_id_t id, const Vector3r&amp; t,MetaBody* rb){rb-&gt;bex.addTorque(id,t);}
-#else
-	void addForce (const body_id_t id, const Vector3r&amp; f,MetaBody* rb){static_pointer_cast&lt;Force&gt;(rb-&gt;physicalActions-&gt;find(id,forceIdx))-&gt;force+=f; };
-	void addTorque(const body_id_t id, const Vector3r&amp; t,MetaBody* rb){static_pointer_cast&lt;Momentum&gt;(rb-&gt;physicalActions-&gt;find(id,torqueIdx))-&gt;momentum+=t; };
-#endif
-
 	/*! Convenience function to apply force and torque from one force at contact point. Not sure if this is the right place for it. */
 	void applyForceAtContactPoint(const Vector3r&amp; force, const Vector3r&amp; contactPoint, const body_id_t id1, const Vector3r&amp; pos1, const body_id_t id2, const Vector3r&amp; pos2, MetaBody* rb){
 		addForce(id1,force,rb);

Modified: trunk/pkg/common/Engine/MetaEngine/PhysicalActionApplier.cpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/PhysicalActionApplier.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/MetaEngine/PhysicalActionApplier.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -9,28 +9,9 @@
 #include&quot;PhysicalActionApplier.hpp&quot;
 #include&lt;yade/core/MetaBody.hpp&gt;
 
-#ifdef BEX_CONTAINER
 void PhysicalActionApplier::action(MetaBody* ncb){
 	FOREACH(const shared_ptr&lt;Body&gt;&amp; b, *ncb-&gt;bodies){
 		operator()(b-&gt;physicalParameters,b.get(),ncb);
 	}
 }
-#else
-void PhysicalActionApplier::action(MetaBody* ncb)
-{
-		throw logic_error(&quot;PhysicalActionApplier cannot be used with BexContainer. Use NewtonsDampedLaw instead (or recompile with NO_BEX).&quot;);
-		shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-
-		PhysicalActionContainer::iterator pai    = ncb-&gt;physicalActions-&gt;begin();
-		PhysicalActionContainer::iterator paiEnd = ncb-&gt;physicalActions-&gt;end(); 
-		for( ; pai!=paiEnd ; ++pai)
-		{
-			shared_ptr&lt;PhysicalAction&gt; action = *pai;
-			int id = pai.getCurrentIndex();
-			operator()( action , (*bodies)[id]-&gt;physicalParameters , (*bodies)[id].get() );
-		}
-}
-#endif
-
-
 YADE_PLUGIN();

Modified: trunk/pkg/common/Engine/MetaEngine/PhysicalActionApplier.hpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/PhysicalActionApplier.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/MetaEngine/PhysicalActionApplier.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -14,36 +14,13 @@
 #include&lt;yade/core/MetaEngine2D.hpp&gt;
 #include&lt;yade/core/MetaEngine1D.hpp&gt;
 #include&lt;yade/lib-multimethods/DynLibDispatcher.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionApplierUnit.hpp&gt;
 
 class Body;
-#ifdef BEX_CONTAINER
 class PhysicalActionApplier: public MetaEngine1D&lt;PhysicalParameters,PhysicalActionApplierUnit,void,TYPELIST_3(const shared_ptr&lt;PhysicalParameters&gt;&amp;,const Body*, MetaBody*)&gt;{
 	public: virtual void action(MetaBody*);
 	REGISTER_CLASS_AND_BASE(PhysicalActionApplier,MetaEngine1D);
 };
 REGISTER_SERIALIZABLE(PhysicalActionApplier);
-#else
-class PhysicalActionApplier :	public MetaEngine2D
-				&lt;
-					PhysicalAction ,					// base classe for dispatch
-					PhysicalParameters,					// base classe for dispatch
-					PhysicalActionApplierUnit,				// class that provides multivirtual call
-					void,							// return type
-					TYPELIST_3(	  const shared_ptr&lt;PhysicalAction&gt;&amp;	// function arguments
-							, const shared_ptr&lt;PhysicalParameters&gt;&amp; 
-							, const Body *
-				    		  )
-				&gt;
-{
-	public :
-		virtual void action(MetaBody*);
 
-	REGISTER_CLASS_NAME(PhysicalActionApplier);
-	REGISTER_BASE_CLASS_NAME(MetaEngine2D);
-};
-REGISTER_SERIALIZABLE(PhysicalActionApplier);
-#endif
-

Modified: trunk/pkg/common/Engine/MetaEngine/PhysicalActionApplierUnit.hpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/PhysicalActionApplierUnit.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/MetaEngine/PhysicalActionApplierUnit.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -8,30 +8,13 @@
 
 #pragma once
 
-#include&lt;yade/core/PhysicalAction.hpp&gt;
 #include&lt;yade/core/PhysicalParameters.hpp&gt;
 #include&lt;yade/core/Body.hpp&gt;
 #include&lt;yade/core/EngineUnit2D.hpp&gt;
 #include&lt;yade/core/EngineUnit1D.hpp&gt;
 
-#ifdef BEX_CONTAINER
 class PhysicalActionApplierUnit: public EngineUnit1D&lt;void,TYPELIST_3(const shared_ptr&lt;PhysicalParameters&gt;&amp;,const Body*, MetaBody*)&gt;{
 	REGISTER_CLASS_AND_BASE(PhysicalActionApplierUnit,EngineUnit1D);
 };
 REGISTER_SERIALIZABLE(PhysicalActionApplierUnit);
-#else
-class PhysicalActionApplierUnit :	public EngineUnit2D
-					&lt;
-		 				void ,
-		 				TYPELIST_3(	  const shared_ptr&lt;PhysicalAction&gt;&amp;
-								, const shared_ptr&lt;PhysicalParameters&gt;&amp;
-								, const Body*
-			   				)
-					&gt;
-{
-	REGISTER_CLASS_NAME(PhysicalActionApplierUnit);
-	REGISTER_BASE_CLASS_NAME(EngineUnit2D);
-};
-REGISTER_SERIALIZABLE(PhysicalActionApplierUnit);
-#endif
 

Modified: trunk/pkg/common/Engine/MetaEngine/PhysicalActionDamper.cpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/PhysicalActionDamper.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/MetaEngine/PhysicalActionDamper.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -11,27 +11,10 @@
 #include &quot;PhysicalActionDamper.hpp&quot;
 #include&lt;yade/core/MetaBody.hpp&gt;
 
-#ifdef BEX_CONTAINER
 void PhysicalActionDamper::action(MetaBody* ncb){
+	ncb-&gt;bex.sync();
 	FOREACH(const shared_ptr&lt;Body&gt;&amp; b, *ncb-&gt;bodies){
 		operator()(b-&gt;physicalParameters,b.get(),ncb);
 	}
 }
-#else
-void PhysicalActionDamper::action(MetaBody* ncb)
-{
-		shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-		PhysicalActionContainer::iterator pai    = ncb-&gt;physicalActions-&gt;begin();
-		PhysicalActionContainer::iterator paiEnd = ncb-&gt;physicalActions-&gt;end();
-		for( ; pai!=paiEnd ; ++pai)
-		{
-			shared_ptr&lt;PhysicalAction&gt; action = *pai;
-			int id = pai.getCurrentIndex();
-			// FIXME - solve the problem of Body's id
-			operator()( action , (*bodies)[id]-&gt;physicalParameters , (*bodies)[id].get() );
-		}
-}
-#endif
-
-
 YADE_PLUGIN();

Modified: trunk/pkg/common/Engine/MetaEngine/PhysicalActionDamper.hpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/PhysicalActionDamper.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/MetaEngine/PhysicalActionDamper.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -11,36 +11,12 @@
 #include&lt;yade/core/MetaEngine2D.hpp&gt;
 #include&lt;yade/core/MetaEngine1D.hpp&gt;
 #include&lt;yade/lib-multimethods/DynLibDispatcher.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalActionDamperUnit.hpp&gt;
 
 class Body;
 class MetaBody;
-#ifdef BEX_CONTAINER
-	class PhysicalActionDamper: public MetaEngine1D&lt;PhysicalParameters,PhysicalActionDamperUnit,void,TYPELIST_3(const shared_ptr&lt;PhysicalParameters&gt;&amp;, const Body*, MetaBody*)&gt;{
-		public: virtual void action(MetaBody*);
-		REGISTER_CLASS_AND_BASE(PhysicalActionDamper,MetaEngine1D);
-	};
-	REGISTER_SERIALIZABLE(PhysicalActionDamper);
-#else
-	class PhysicalActionDamper : public MetaEngine2D
-					&lt;	PhysicalAction,						// base classe for dispatch
-						PhysicalParameters,					// base classe for dispatch
-						PhysicalActionDamperUnit,				// class that provides multivirtual call
-						void,							// return type
-						TYPELIST_3(	  const shared_ptr&lt;PhysicalAction&gt;&amp;	// function arguments
-								, const shared_ptr&lt;PhysicalParameters&gt;&amp; 
-								, const Body *
-							  )
-					&gt;
-	{
-		public :
-			virtual void action(MetaBody*);
-
-		REGISTER_CLASS_NAME(PhysicalActionDamper);
-		REGISTER_BASE_CLASS_NAME(MetaEngine2D);
-	};
-	REGISTER_SERIALIZABLE(PhysicalActionDamper);
-#endif
-
-
+class PhysicalActionDamper: public MetaEngine1D&lt;PhysicalParameters,PhysicalActionDamperUnit,void,TYPELIST_3(const shared_ptr&lt;PhysicalParameters&gt;&amp;, const Body*, MetaBody*)&gt;{
+	public: virtual void action(MetaBody*);
+	REGISTER_CLASS_AND_BASE(PhysicalActionDamper,MetaEngine1D);
+};
+REGISTER_SERIALIZABLE(PhysicalActionDamper);

Modified: trunk/pkg/common/Engine/MetaEngine/PhysicalActionDamperUnit.hpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/PhysicalActionDamperUnit.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/MetaEngine/PhysicalActionDamperUnit.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -8,14 +8,12 @@
 
 #pragma once
 
-#include&lt;yade/core/PhysicalAction.hpp&gt;
 #include&lt;yade/core/PhysicalParameters.hpp&gt;
 #include&lt;yade/core/Body.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
 #include&lt;yade/core/EngineUnit2D.hpp&gt;
 #include&lt;yade/core/EngineUnit1D.hpp&gt;
 
-#ifdef BEX_CONTAINER
 class PhysicalActionDamperUnit: public EngineUnit1D&lt;void,TYPELIST_3(const shared_ptr&lt;PhysicalParameters&gt;&amp;,const Body*, MetaBody*)&gt;{
 	REGISTER_CLASS_AND_BASE(PhysicalActionDamperUnit,EngineUnit1D);
 	/* We are friend of BexContainer. These functions can be used safely provided that bex is NEVER read after being modified. */
@@ -23,18 +21,3 @@
 	Vector3r getTorqueUnsynced(body_id_t id, MetaBody* rb){ return rb-&gt;bex.getTorqueUnsynced(id);}
 };
 REGISTER_SERIALIZABLE(PhysicalActionDamperUnit);
-#else
-class PhysicalActionDamperUnit : public EngineUnit2D
-				 &lt;
-		 			void ,
-		 			TYPELIST_3(	  const shared_ptr&lt;PhysicalAction&gt;&amp;
-							, const shared_ptr&lt;PhysicalParameters&gt;&amp;
-							, const Body*
-						   )
-				&gt;
-{
-	REGISTER_CLASS_NAME(PhysicalActionDamperUnit);
-	REGISTER_BASE_CLASS_NAME(EngineUnit2D);
-};
-REGISTER_SERIALIZABLE(PhysicalActionDamperUnit);
-#endif

Modified: trunk/pkg/common/Engine/ParallelEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/ParallelEngine.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/ParallelEngine.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -15,7 +15,9 @@
 void ParallelEngine::action(MetaBody* rootBody){
 	// openMP warns if the iteration variable is unsigned...
 	const int size=(int)slaves.size();
-	#pragma omp parallel for
+	#ifdef YADE_OPENMP
+		#pragma omp parallel for
+	#endif
 	for(int i=0; i&lt;size; i++){
 		// run every slave group sequentially
 		FOREACH(const shared_ptr&lt;Engine&gt;&amp; e, slaves[i]) {

Deleted: trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.cpp
===================================================================
--- trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -1,64 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;PhysicalActionContainerInitializer.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/lib-factory/ClassFactory.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
-#include&lt;yade/core/Engine.hpp&gt;
-#include&lt;boost/foreach.hpp&gt;
-
-CREATE_LOGGER(PhysicalActionContainerInitializer);
-
-PhysicalActionContainerInitializer::PhysicalActionContainerInitializer() 
-{
-	physicalActionNames.clear();
-}
-
-PhysicalActionContainerInitializer::~PhysicalActionContainerInitializer() 
-{
-}
-
-void PhysicalActionContainerInitializer::registerAttributes()
-{
-	REGISTER_ATTRIBUTE(physicalActionNames);
-}
-
-void PhysicalActionContainerInitializer::action(MetaBody* ncb)
-{
-	#ifdef BEX_CONTAINER
-		// this is not necessary, since BexContainer grows upon request.
-		// But it takes about 10 resizes to get to 2000 bodies (only at the beginning), so you can save a few milliseconds here
-		ncb-&gt;bex.resize(ncb-&gt;bodies-&gt;size());
-	#else
-		list&lt;string&gt; allNames;
-		// copy physical action names that were passed by the user directly
-		allNames.insert(allNames.end(),physicalActionNames.begin(),physicalActionNames.end());
-		LOG_DEBUG(&quot;allNames as defined by the user: &quot;);	FOREACH(string an,allNames) LOG_DEBUG(an);
-		// loop over all engines, get Bex from them
-		FOREACH(shared_ptr&lt;Engine&gt; e, ncb-&gt;engines){
-			list&lt;string&gt; bex=e-&gt;getNeededBex();
-			allNames.insert(allNames.end(),bex.begin(),bex.end());
-			LOG_DEBUG(&quot;The following engines were inserted by &quot;&lt;&lt;e-&gt;getClassName()&lt;&lt;&quot;:&quot;); FOREACH(string b,bex) LOG_DEBUG(b);
-		}
-		LOG_DEBUG(&quot;allNames after loop over engines: &quot;);	FOREACH(string an,allNames) LOG_DEBUG(an);
-		// eliminate all duplicates
-		allNames.sort();
-		allNames.unique();
-		LOG_DEBUG(&quot;allNames after sort and unique: &quot;);	FOREACH(string an,allNames) LOG_DEBUG(an);
-
-		vector&lt;shared_ptr&lt;PhysicalAction&gt; &gt; physicalActions;
-		FOREACH(string physicalActionName, allNames){
-			physicalActions.push_back(YADE_PTR_CAST&lt;PhysicalAction&gt;(ClassFactory::instance().createShared(physicalActionName)));
-		}
-		ncb-&gt;physicalActions-&gt;prepare(physicalActions);
-	#endif
-}
-
-
-YADE_PLUGIN();

Deleted: trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.hpp
===================================================================
--- trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -1,38 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#pragma once
-
-#include&lt;yade/core/StandAloneEngine.hpp&gt;
-
-#include &lt;vector&gt;
-#include &lt;string&gt;
-
-class Body;
-
-class PhysicalActionContainerInitializer : public StandAloneEngine
-{
-	public :
-		std::vector&lt;std::string&gt; physicalActionNames;
-	
-		PhysicalActionContainerInitializer();
-		virtual ~PhysicalActionContainerInitializer();
-		virtual void action(MetaBody*);
-	
-	protected : 
-		virtual void registerAttributes();
-
-	DECLARE_LOGGER;
-
-	REGISTER_CLASS_NAME(PhysicalActionContainerInitializer);
-	REGISTER_BASE_CLASS_NAME(StandAloneEngine);
-};
-
-REGISTER_SERIALIZABLE(PhysicalActionContainerInitializer);
-
-

Modified: trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter.cpp
===================================================================
--- trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -20,11 +20,7 @@
 
 void PhysicalActionContainerReseter::action(MetaBody* ncb)
 {
-	#ifdef BEX_CONTAINER
-		ncb-&gt;bex.reset();
-	#else
-		ncb-&gt;physicalActions-&gt;reset();
-	#endif
+	ncb-&gt;bex.reset();
 }
 
 

Modified: trunk/pkg/common/SConscript
===================================================================
--- trunk/pkg/common/SConscript	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/common/SConscript	2009-03-30 17:10:27 UTC (rev 1738)
@@ -18,8 +18,6 @@
 	env.SharedLibrary('ElasticBodyParameters',['DataClass/PhysicalParameters/ElasticBodyParameters.cpp'],
 		LIBS=env['LIBS']+['RigidBodyParameters','ParticleParameters',]),
 	env.SharedLibrary('ClosestFeatures',['DataClass/InteractionGeometry/ClosestFeatures.cpp']),
-	env.SharedLibrary('Force',['DataClass/PhysicalAction/Force.cpp']),
-	env.SharedLibrary('Momentum',['DataClass/PhysicalAction/Momentum.cpp']),
 	env.SharedLibrary('Box',['DataClass/GeometricalModel/Box.cpp']),
 	env.SharedLibrary('Mesh2D',['DataClass/GeometricalModel/Mesh2D.cpp']),
 	env.SharedLibrary('Sphere',['DataClass/GeometricalModel/Sphere.cpp']),
@@ -28,13 +26,13 @@
 	env.SharedLibrary('Facet',['DataClass/GeometricalModel/Facet.cpp']),
 	env.SharedLibrary('ColorScale',['DataClass/Widgets/ColorScale.cpp']),
 	env.SharedLibrary('MomentEngine',['Engine/DeusExMachina/MomentEngine.cpp'],
-		LIBS=env['LIBS']+['Momentum','ParticleParameters']),
+		LIBS=env['LIBS']+['ParticleParameters']),
 	env.SharedLibrary('ForceEngine',['Engine/DeusExMachina/ForceEngine.cpp'],
-		LIBS=env['LIBS']+['Force','ParticleParameters']),
+		LIBS=env['LIBS']+['ParticleParameters']),
 	env.SharedLibrary('DisplacementToForceEngine',['Engine/DeusExMachina/DisplacementToForceEngine.cpp'],
-		LIBS=env['LIBS']+['Force','ParticleParameters']),
+		LIBS=env['LIBS']+['ParticleParameters']),
 	env.SharedLibrary('GravityEngines',['Engine/DeusExMachina/GravityEngines.cpp'],
-		LIBS=env['LIBS']+['Force','ParticleParameters']),
+		LIBS=env['LIBS']+['ParticleParameters']),
 	env.SharedLibrary('JumpChangeSe3',['Engine/DeusExMachina/JumpChangeSe3.cpp'], LIBS=env['LIBS']+['RigidBodyParameters']),
 	env.SharedLibrary('Se3Interpolator',['Engine/DeusExMachina/Se3Interpolator.cpp'], LIBS=env['LIBS']+['RigidBodyParameters']),
 	env.SharedLibrary('RotationEngine',['Engine/DeusExMachina/RotationEngine.cpp'],
@@ -51,7 +49,6 @@
 			'RigidBodyParameters',
 			'yade-factory',
 			'yade-base',
-			'Force',
 			'ContactLaw1',
 			'ElasticContactInteraction',
 			'InteractingBox',
@@ -68,7 +65,6 @@
 			'RigidBodyParameters',
 			'yade-factory',
 			'yade-base',
-			'Force',
 			'ContactLaw1',
 			'ElasticContactInteraction',
 			'InteractingBox',
@@ -103,7 +99,7 @@
 	env.SharedLibrary('InteractionPhysicsMetaEngine',['Engine/MetaEngine/InteractionPhysicsMetaEngine.cpp']),
 	env.SharedLibrary('PhysicalActionApplier',['Engine/MetaEngine/PhysicalActionApplier.cpp']),
 	env.SharedLibrary('PhysicalActionDamper',['Engine/MetaEngine/PhysicalActionDamper.cpp']),
-	env.SharedLibrary('ConstitutiveLawDispatcher',['Engine/MetaEngine/ConstitutiveLawDispatcher.cpp'],LIBS=env['LIBS']+['Force','Momentum']),
+	env.SharedLibrary('ConstitutiveLawDispatcher',['Engine/MetaEngine/ConstitutiveLawDispatcher.cpp']),
 	env.SharedLibrary('InteractionDispatchers',['Engine/MetaEngine/InteractionDispatchers.cpp'],LIBS=env['LIBS']+['InteractionGeometryMetaEngine','InteractionPhysicsMetaEngine','ConstitutiveLawDispatcher']),
 	env.SharedLibrary('InteractingBox2AABB',['Engine/EngineUnit/InteractingBox2AABB.cpp'],
 		LIBS=env['LIBS']+['BoundingVolumeMetaEngine','InteractingBox','AABB','Box',]),
@@ -116,21 +112,21 @@
 	env.SharedLibrary('LeapFrogPositionIntegrator',['Engine/EngineUnit/LeapFrogPositionIntegrator.cpp'],
 		LIBS=env['LIBS']+['PhysicalParametersMetaEngine','ParticleParameters','RigidBodyParameters']),
 	env.SharedLibrary('NewtonsForceLaw',['Engine/EngineUnit/NewtonsForceLaw.cpp'],
-		LIBS=env['LIBS']+['PhysicalActionApplier','Force','ParticleParameters','RigidBodyParameters']),
+		LIBS=env['LIBS']+['PhysicalActionApplier','ParticleParameters','RigidBodyParameters']),
 	env.SharedLibrary('NewtonsMomentumLaw',['Engine/EngineUnit/NewtonsMomentumLaw.cpp'],
-		LIBS=env['LIBS']+['PhysicalActionApplier','Momentum','RigidBodyParameters',]),
+		LIBS=env['LIBS']+['PhysicalActionApplier','RigidBodyParameters',]),
 	env.SharedLibrary('InteractingSphere2AABB',['Engine/EngineUnit/InteractingSphere2AABB.cpp'],
 		LIBS=env['LIBS']+['BoundingVolumeMetaEngine','InteractingSphere','AABB']),
 	env.SharedLibrary('CundallNonViscousDamping',
 		['Engine/EngineUnit/CundallNonViscousDamping.cpp'],
-		LIBS=env['LIBS']+['PhysicalActionDamper','Force','Momentum','ParticleParameters','RigidBodyParameters']),
+		LIBS=env['LIBS']+['PhysicalActionDamper','ParticleParameters','RigidBodyParameters']),
 	env.SharedLibrary('ElasticBodySimpleRelationship',['Engine/EngineUnit/ElasticBodySimpleRelationship.cpp'],
 		LIBS=env['LIBS']+['ElasticBodyParameters','RigidBodyParameters','ParticleParameters','InteractionPhysicsMetaEngine','NormalShearInteractions']),
 	env.SharedLibrary('NormalShearInteractions',['DataClass/InteractionPhysics/NormalShearInteractions.cpp']),
 
 	#env.SharedLibrary('VelocityDamping',
 	#	['Engine/EngineUnit/VelocityDamping.cpp'],
-	#	LIBS=env['LIBS']+['Force','Momentum','RigidBodyParameters']),
+	#	LIBS=env['LIBS']+['RigidBodyParameters']),
 
 	#env.SharedLibrary('PersistentTriangulationCollider',
 	#	['Engine/StandAloneEngine/PersistentTriangulationCollider.cpp'],
@@ -143,7 +139,6 @@
 	env.SharedLibrary('SpatialQuickSortCollider',['Engine/StandAloneEngine/SpatialQuickSortCollider.cpp']),
 	env.SharedLibrary('PersistentSAPCollider',['Engine/StandAloneEngine/PersistentSAPCollider.cpp']),
 	env.SharedLibrary('DistantPersistentSAPCollider',['Engine/StandAloneEngine/DistantPersistentSAPCollider.cpp']),
-	env.SharedLibrary('PhysicalActionContainerInitializer',['Engine/StandAloneEngine/PhysicalActionContainerInitializer.cpp']),
 	env.SharedLibrary('PhysicalActionContainerReseter',['Engine/StandAloneEngine/PhysicalActionContainerReseter.cpp']),
 	env.SharedLibrary('GLDrawAABB',['RenderingEngine/GLDrawBoundingVolume/GLDrawAABB.cpp'],
 		LIBS=env['LIBS']+['yade-base','AABB','yade-opengl']),

Modified: trunk/pkg/dem/Engine/DeusExMachina/CapillaryRecorder.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/CapillaryRecorder.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/DeusExMachina/CapillaryRecorder.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -11,14 +11,13 @@
 #include &quot;CapillaryRecorder.hpp&quot;
 #include &lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
 #include &lt;yade/pkg-common/ParticleParameters.hpp&gt;
-#include &lt;yade/pkg-common/Force.hpp&gt;
 #include &lt;yade/pkg-dem/CapillaryParameters.hpp&gt;
 #include &lt;yade/core/Omega.hpp&gt;
 #include &lt;yade/core/MetaBody.hpp&gt;
 #include &lt;boost/lexical_cast.hpp&gt;
 
 
-CapillaryRecorder::CapillaryRecorder () : DataRecorder(), actionForce(new Force)
+CapillaryRecorder::CapillaryRecorder () : DataRecorder()
 {
 	outputFile = &quot;&quot;;
 	interval = 1;
@@ -53,12 +52,8 @@
 {
 	Real fx=0, fy=0, fz=0;
 	
-	#ifdef BEX_CONTAINER
-		ncb-&gt;bex.sync();
-		Vector3r force=ncb-&gt;bex.getForce(bigBallId);
-	#else
-		Vector3r force = static_cast&lt;Force*&gt;(ncb-&gt;physicalActions-&gt;find(bigBallId, actionForce-&gt;getClassIndex() ) . get() )-&gt;force;
-	#endif
+	ncb-&gt;bex.sync();
+	Vector3r force=ncb-&gt;bex.getForce(bigBallId);
 	
 		
 		fx=force[0];

Modified: trunk/pkg/dem/Engine/DeusExMachina/CapillaryRecorder.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/CapillaryRecorder.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/DeusExMachina/CapillaryRecorder.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -13,12 +13,10 @@
 #include &lt;string&gt;
 #include &lt;fstream&gt;
 
-class PhysicalAction;
 
 class CapillaryRecorder : public DataRecorder
 {
 	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
 		std::ofstream ofile; 
 
 		bool changed;
@@ -37,7 +35,6 @@
 
 	protected :
 		virtual void postProcessAttributes(bool deserializing);
-	NEEDS_BEX(&quot;Force&quot;);
 	REGISTER_CLASS_NAME(CapillaryRecorder);
 	REGISTER_BASE_CLASS_NAME(DataRecorder);
 };

Modified: trunk/pkg/dem/Engine/DeusExMachina/ContactStressRecorder.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/ContactStressRecorder.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/DeusExMachina/ContactStressRecorder.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -9,7 +9,6 @@
 #include &quot;ContactStressRecorder.hpp&quot;
 #include &lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
 #include &lt;yade/pkg-common/ParticleParameters.hpp&gt;
-#include &lt;yade/pkg-common/Force.hpp&gt;
 #include &lt;yade/pkg-common/Sphere.hpp&gt;
 #include &lt;yade/pkg-dem/BodyMacroParameters.hpp&gt;
 #include &lt;yade/pkg-dem/ElasticContactLaw.hpp&gt;
@@ -25,7 +24,7 @@
 
 CREATE_LOGGER(ContactStressRecorder);
 
-ContactStressRecorder::ContactStressRecorder () : DataRecorder(), actionForce(new Force)
+ContactStressRecorder::ContactStressRecorder () : DataRecorder()
 
 {
 	outputFile = &quot;&quot;;

Modified: trunk/pkg/dem/Engine/DeusExMachina/ContactStressRecorder.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/ContactStressRecorder.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/DeusExMachina/ContactStressRecorder.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -13,7 +13,6 @@
 #include &lt;string&gt;
 #include &lt;fstream&gt;
 
-class PhysicalAction;
 class GeometricalModel;
 class TriaxialCompressionEngine;
 // class SampleCapillaryPressureEngine;
@@ -22,7 +21,6 @@
 class ContactStressRecorder : public DataRecorder
 {
 	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce; // ??? 
 		
 		shared_ptr&lt;GeometricalModel&gt; sphere_ptr;
 		int SpheresClassIndex;

Modified: trunk/pkg/dem/Engine/DeusExMachina/HydraulicForceEngine.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/HydraulicForceEngine.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/DeusExMachina/HydraulicForceEngine.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -8,8 +8,6 @@
 
 #include &quot;HydraulicForceEngine.hpp&quot;
 #include &lt;yade/pkg-common/ParticleParameters.hpp&gt;
-#include &lt;yade/pkg-common/Force.hpp&gt;
-#include &lt;yade/pkg-common/Momentum.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
 #include &lt;yade/pkg-dem/CohesiveFrictionalBodyParameters.hpp&gt;
 #include &lt;vector&gt;
@@ -18,7 +16,7 @@
 bool HFinverted = false;
 vector&lt;Real&gt; initialPositions;
 
-HydraulicForceEngine::HydraulicForceEngine() : actionParameterForce(new Force), actionParameterMomentum(new Momentum), gravity(Vector3r::ZERO), isActivated(false)
+HydraulicForceEngine::HydraulicForceEngine() : gravity(Vector3r::ZERO), isActivated(false)
 {
 dummyParameter = false;
 }
@@ -73,11 +71,7 @@
                     //cerr &lt;&lt; &quot;translate it&quot; &lt;&lt; endl;
                     if ((static_cast&lt;CohesiveFrictionalBodyParameters*&gt; (b-&gt;physicalParameters.get()))-&gt;isBroken == true)
                     {
-                        #ifdef BEX_CONTAINER
-									ncb-&gt;bex.addForce(b-&gt;getId(),Vector3r(0,5,0));
-								#else
-									static_cast&lt;Force*&gt;( ncb-&gt;physicalActions-&gt;find( b-&gt;getId() , actionParameterForce-&gt;getClassIndex() ).get() )-&gt;force += Vector3r(0,5,0);
-								#endif
+								ncb-&gt;bex.addForce(b-&gt;getId(),Vector3r(0,5,0));
                     }
                     // else  b-&gt;geometricalModel-&gt;diffuseColor= Vector3r(0.5,0.9,0.3);
                 }
@@ -103,14 +97,8 @@
                     Vector3r t (mx,my,mz);
                     //f /= -10000;
                     //t *= 0;
-						  #ifdef BEX_CONTAINER
-						  		ncb-&gt;bex.addForce(id,f);
-								ncb-&gt;bex.addTorque(id,t);
-						  #else
-	                    static_cast&lt;Force*&gt;( ncb-&gt;physicalActions-&gt;find( id , actionParameterForce-&gt;getClassIndex() ).get() )-&gt;force += f;
-	                    //cerr &lt;&lt; &quot;added force = &quot; &lt;&lt; f &lt;&lt; endl;
-	                    static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id , actionParameterMomentum-&gt;getClassIndex() ).get() )-&gt;momentum += t;
-						  #endif
+						  	ncb-&gt;bex.addForce(id,f);
+							ncb-&gt;bex.addTorque(id,t);
 
                 }
             }

Modified: trunk/pkg/dem/Engine/DeusExMachina/HydraulicForceEngine.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/HydraulicForceEngine.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/DeusExMachina/HydraulicForceEngine.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -10,15 +10,8 @@
 
 #include&lt;yade/core/DeusExMachina.hpp&gt;
 
-class Force;
-class Momentum;
-
 class HydraulicForceEngine : public DeusExMachina 
 {
-	private	:
-		shared_ptr&lt;Force&gt; actionParameterForce;
-		shared_ptr&lt;Momentum&gt; actionParameterMomentum;
-
 	public :
 		Vector3r gravity;
 		bool isActivated;
@@ -30,7 +23,6 @@
 	
 	protected :
 		virtual void registerAttributes();
-	NEEDS_BEX(&quot;Force&quot;,&quot;Momentum&quot;);
 	REGISTER_CLASS_NAME(HydraulicForceEngine);
 	REGISTER_BASE_CLASS_NAME(DeusExMachina);
 };

Deleted: trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -1,69 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &lt;yade/pkg-dem/MakeItFlat.hpp&gt;
-#include &lt;yade/pkg-common/ParticleParameters.hpp&gt;
-#include &lt;yade/pkg-common/Force.hpp&gt;
-#include &lt;yade/core/MetaBody.hpp&gt;
-
-MakeItFlat::MakeItFlat() : actionParameterForce(new Force)
-{
-	direction=1;
-	plane_position=0;
-	reset_force=true;
-}
-
-
-MakeItFlat::~MakeItFlat()
-{
-}
-
-
-void MakeItFlat::registerAttributes()
-{
-	REGISTER_ATTRIBUTE(direction);
-	REGISTER_ATTRIBUTE(plane_position);
-	REGISTER_ATTRIBUTE(reset_force);
-}
-
-
-void MakeItFlat::applyCondition(MetaBody* ncb)
-{
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-
-	BodyContainer::iterator bi    = bodies-&gt;begin();
-	BodyContainer::iterator biEnd = bodies-&gt;end();
-	for( ; bi!=biEnd ; ++bi )
-	{
-		shared_ptr&lt;Body&gt; b = *bi;
-		/* skip bodies that are within a clump;
-		 * even if they are marked isDynamic==false, forces applied to them are passed to the clump, which is dynamic;
-		 * and since clump is a body with mass equal to the sum of masses of its components, it would have HydraulicForce applied twice.
-		 *
-		 * The choice is to skip (b-&gt;isClumpMember()) or (b-&gt;isClump()). We rather skip members,
-		 * since that will apply smaller number of forces and (theoretically) improve numerical stability ;-) */
-		if(b-&gt;isClumpMember()) continue;
-
-		if(b-&gt;geometricalModel-&gt;getClassName()==&quot;Sphere&quot;)
-		{
-			ParticleParameters* p = dynamic_cast&lt;ParticleParameters*&gt;(b-&gt;physicalParameters.get());
-			if (p)
-			{
-				p-&gt;se3.position[direction]=plane_position;
-				if(reset_force)
-					#ifdef BEX_CONTAINER
-						throw runtime_error(&quot;BexContainer doesn't work with MakeIfFlat resetting forces, since it would have to sync() frequently. Use PhysicalParameters::blockedDOFs instead, MakeItFlat will be removed.&quot;);
-					#else
-						static_cast&lt;Force*&gt;( ncb-&gt;physicalActions-&gt;find( b-&gt;getId() , actionParameterForce-&gt;getClassIndex() ).get() )-&gt;force[direction]=0;// 
-					#endif
-			}
-		}
-	}
-}
-
-YADE_PLUGIN();

Deleted: trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -1,39 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#pragma once
-
-#include&lt;yade/core/DeusExMachina.hpp&gt;
-
-class Force;
-
-class MakeItFlat : public DeusExMachina 
-{
-	private	:
-		shared_ptr&lt;Force&gt; actionParameterForce;
-
-	public :
-		MakeItFlat();
-		virtual ~MakeItFlat();
-	
-		virtual void applyCondition(MetaBody*);
-
-		int direction;
-		Real plane_position;
-		bool reset_force;
-	
-	protected :
-		virtual void registerAttributes();
-	NEEDS_BEX(&quot;Force&quot;);
-	REGISTER_CLASS_NAME(MakeItFlat);
-	REGISTER_BASE_CLASS_NAME(DeusExMachina);
-};
-
-REGISTER_SERIALIZABLE(MakeItFlat);
-
-

Modified: trunk/pkg/dem/Engine/DeusExMachina/NewtonsDampedLaw.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/NewtonsDampedLaw.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/DeusExMachina/NewtonsDampedLaw.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -9,8 +9,6 @@
 #include&quot;NewtonsDampedLaw.hpp&quot;
 #include&lt;yade/core/MetaBody.hpp&gt;
 #include&lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
 #include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
 
 YADE_PLUGIN(&quot;NewtonsDampedLaw&quot;);
@@ -25,29 +23,18 @@
 NewtonsDampedLaw::NewtonsDampedLaw()
 {
 	damping = 0.2;
-	forceClassIndex = (new Force)-&gt;getClassIndex();
-	momentumClassIndex = (new Momentum)-&gt;getClassIndex();
 }
 
 void NewtonsDampedLaw::applyCondition ( MetaBody * ncb )
 {
-	#ifdef BEX_CONTAINER
-		#ifdef YADE_OPENMP
-			ncb-&gt;bex.sync();
-		#endif
-	#endif
+	ncb-&gt;bex.sync();
 	FOREACH(const shared_ptr&lt;Body&gt;&amp; b, *ncb-&gt;bodies){
 		if (!b-&gt;isDynamic) continue;
 		
 		RigidBodyParameters* rb = YADE_CAST&lt;RigidBodyParameters*&gt;(b-&gt;physicalParameters.get());
 		unsigned int id = b-&gt;getId();
-		#ifdef BEX_CONTAINER
-			const Vector3r&amp; m=ncb-&gt;bex.getTorque(id);
-			const Vector3r&amp; f=ncb-&gt;bex.getForce(id);
-		#else
-			const Vector3r&amp; m = ( static_cast&lt;Momentum*&gt; ( ncb-&gt;physicalActions-&gt;find ( id, momentumClassIndex ).get() ) )-&gt;momentum;
-			const Vector3r&amp; f = ( static_cast&lt;Force*&gt; ( ncb-&gt;physicalActions-&gt;find ( id, forceClassIndex ).get() ) )-&gt;force;
-		#endif
+		const Vector3r&amp; m=ncb-&gt;bex.getTorque(id);
+		const Vector3r&amp; f=ncb-&gt;bex.getForce(id);
 
 		Real dt = Omega::instance().getTimeStep();
 

Modified: trunk/pkg/dem/Engine/DeusExMachina/NewtonsDampedLaw.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/NewtonsDampedLaw.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/DeusExMachina/NewtonsDampedLaw.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -38,10 +38,6 @@
 	public :
 		///damping coefficient for Cundall's non viscous damping
 		Real damping;
-		
-	private :
-		int forceClassIndex, momentumClassIndex;
-				
 	public :
 		virtual	void applyCondition(MetaBody *);		
 		NewtonsDampedLaw();
@@ -49,7 +45,6 @@
 	protected :
 		virtual void registerAttributes();
 
-	NEEDS_BEX(&quot;Force&quot;,&quot;Momentum&quot;);	
 	REGISTER_CLASS_NAME(NewtonsDampedLaw);
 	REGISTER_BASE_CLASS_NAME(DeusExMachina);
 };

Deleted: trunk/pkg/dem/Engine/DeusExMachina/ResultantForceEngine.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/ResultantForceEngine.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/DeusExMachina/ResultantForceEngine.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -1,100 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">cosurgi at berlios.de</A>                                                    *
-*  Copyright (C) 2006 by Bruno Chareyre                                  *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">bruno.chareyre at hmg.inpg.fr</A>                                            *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-#include&quot;ResultantForceEngine.hpp&quot;
-
-#ifndef BEX_CONTAINER
-
-	#include&lt;yade/pkg-common/ParticleParameters.hpp&gt;
-	#include&lt;yade/pkg-common/Force.hpp&gt;
-	#include&lt;yade/pkg-dem/GlobalStiffness.hpp&gt;
-	#include&lt;Wm3Math.h&gt;
-	#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-	#include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
-
-
-
-	#include&lt;yade/core/MetaBody.hpp&gt;
-
-
-	ResultantForceEngine::ResultantForceEngine() : actionParameterGlobalStiffness(new GlobalStiffness), actionParameterForce(new Force)
-	{
-		interval =1;
-		damping = 0.1;
-		force = Vector3r::ZERO;
-		previoustranslation = Vector3r::ZERO;
-		stiffness = Vector3r::ZERO;
-		max_vel = 0.001;
-	}
-
-	ResultantForceEngine::~ResultantForceEngine()
-	{
-	}
-
-
-	void ResultantForceEngine::registerAttributes()
-	{
-		DeusExMachina::registerAttributes();
-		REGISTER_ATTRIBUTE(interval);
-		REGISTER_ATTRIBUTE(damping);
-		REGISTER_ATTRIBUTE(force);
-		REGISTER_ATTRIBUTE(previoustranslation);
-		REGISTER_ATTRIBUTE(stiffness);
-		REGISTER_ATTRIBUTE(max_vel);
-	}
-
-
-
-	void ResultantForceEngine::applyCondition(MetaBody* ncb)
-	{
-		//cerr &lt;&lt; &quot;void ResultantForceEngine::applyCondition(Body* body)&quot; &lt;&lt; std::endl;
-		shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-		
-		std::vector&lt;int&gt;::const_iterator ii = subscribedBodies.begin();
-		std::vector&lt;int&gt;::const_iterator iiEnd = subscribedBodies.end();
-		
-		//cerr &lt;&lt; &quot;std::vector&lt;int&gt;::const_iterator iiEnd = subscribedBodies.end();&quot; &lt;&lt; Omega::instance().getCurrentIteration() &lt;&lt; std::endl;
-		
-		
-		
-		for(;ii!=iiEnd;++ii)
-		{
-		//cerr &lt;&lt; &quot;for(;ii!=iiEnd;++ii)&quot; &lt;&lt; std::endl;
-		//if( bodies-&gt;exists(*ii) ) 
-		//{
-			//Update stiffness only if it has been computed by StiffnessCounter (see &quot;interval&quot;)
-			if (Omega::instance().getCurrentIteration() % interval == 0)	stiffness =
-			(static_cast&lt;GlobalStiffness*&gt;( ncb-&gt;physicalActions-&gt;find (*ii, actionParameterGlobalStiffness-&gt;getClassIndex() ).get() ))-&gt;stiffness;
-		
-			//cerr &lt;&lt; &quot;static_cast&lt;GlobalStiffness*&gt;( ncb-&gt;physicalActions-&gt;find (*ii, actionParameterGlobalStiffness-&gt;getClassIndex() ).get() ))-&gt;stiffness&quot; &lt;&lt; std::endl;
-			
-			if(PhysicalParameters* p = dynamic_cast&lt;PhysicalParameters*&gt;((*bodies)[*ii]-&gt;physicalParameters.get()))
-			{
-				//cerr &lt;&lt; &quot;dynamic_cast&lt;PhysicalParameters*&gt;((*bodies)[*ii]-&gt;physicalParameters.get()&quot; &lt;&lt; std::endl;
-	//			GlobalStiffness* sm = static_cast&lt;GlobalStiffness*&gt;( ncb-&gt;physicalActions-&gt;find (*ii, actionParameterGlobalStiffness-&gt;getClassIndex() ).get() );
-				
-				Vector3r effectiveforce =
-					static_cast&lt;Force*&gt;( ncb-&gt;physicalActions-&gt;find( *ii,actionParameterForce-&gt;getClassIndex() ).get() )-&gt;force; 
-				Vector3r deltaf (effectiveforce - force);
-				Vector3r translation 
-					(stiffness.X()==0 ? Mathr::Sign(deltaf.X())*max_vel : Mathr::Sign(deltaf.X())*std::min( abs(deltaf.X()/stiffness.X()), max_vel),
-					stiffness.Y()==0 ? Mathr::Sign(deltaf.Y())*max_vel : Mathr::Sign(deltaf.Y())*std::min( abs(deltaf.Y()/stiffness.Y()), max_vel),
-					stiffness.Z()==0 ? Mathr::Sign(deltaf.Z())*max_vel : Mathr::Sign(deltaf.Z())*std::min( abs(deltaf.Z()/stiffness.Z()), max_vel) );
-				previoustranslation = (1-damping)*translation + 0.9*previoustranslation;// formula for &quot;steady-flow&quot; evolution with fluctuations
-				p-&gt;se3.position	+= previoustranslation;
-				//p-&gt;velocity		=  previoustranslation/dt;//FIXME : useless???	
-			}		
-		//}
-		}
-	}
-
-
-	YADE_PLUGIN();
-
-#endif

Deleted: trunk/pkg/dem/Engine/DeusExMachina/ResultantForceEngine.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/ResultantForceEngine.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/DeusExMachina/ResultantForceEngine.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -1,53 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">cosurgi at berlios.de</A>                                                    *
-*  Copyright (C) 2006 by Bruno Chareyre                                  *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">bruno.chareyre at hmg.inpg.fr</A>                                            *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#pragma once
-#include&lt;yade/core/DeusExMachina.hpp&gt;
-#ifndef BEX_CONTAINER
-
-	class PhysicalAction;
-
-	class ResultantForceEngine : public DeusExMachina 
-	{
-		private :
-			shared_ptr&lt;PhysicalAction&gt; actionParameterGlobalStiffness;
-			shared_ptr&lt;PhysicalAction&gt; actionParameterForce;
-			
-				
-		public :
-			//! CAUTION : interval must be equal to the interval of the StiffnessCounter, it is used here to check if stiffness has been computed 
-			unsigned int interval;
-			//! Defines the prescibed resultant force 
-			Vector3r		force;	
-			//! Stores the value of the translation at the previous time step
-			Vector3r 		previoustranslation;
-			//! The value of stiffness (updated according to interval) 
-			Vector3r		stiffness;
-			//! damping coefficient - damping=1 implies a &quot;perfect&quot; control of the resultant force
-			Real			damping;
-			//! maximum velocity (usefull to prevent explosions when stiffness is very low...) 
-			Real			max_vel;
-
-			ResultantForceEngine();
-			virtual ~ResultantForceEngine();
-		
-			virtual void applyCondition(MetaBody*);
-			
-		
-		protected :
-			virtual void registerAttributes();
-		NEEDS_BEX(&quot;Force&quot;,&quot;GlobalStiffness&quot;);
-		REGISTER_CLASS_NAME(ResultantForceEngine);
-		REGISTER_BASE_CLASS_NAME(DeusExMachina);
-	};
-
-	REGISTER_SERIALIZABLE(ResultantForceEngine);
-#endif
-

Modified: trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -9,7 +9,6 @@
 #include &quot;TriaxialCompressionEngine.hpp&quot;
 #include&lt;yade/core/MetaBody.hpp&gt;
 #include&lt;yade/core/Omega.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
 #include&lt;yade/pkg-dem/BodyMacroParameters.hpp&gt;
 #include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
 #include&lt;boost/lexical_cast.hpp&gt;
@@ -24,7 +23,7 @@
 
 CREATE_LOGGER(TriaxialCompressionEngine);
 
-TriaxialCompressionEngine::TriaxialCompressionEngine() : actionForce(new Force), uniaxialEpsilonCurr(strain[1])
+TriaxialCompressionEngine::TriaxialCompressionEngine() : uniaxialEpsilonCurr(strain[1])
 {
 	translationAxis=TriaxialStressController::normal[wall_bottom_id];
 	translationAxisx=Vector3r(1,0,0);

Modified: trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -17,7 +17,6 @@
 
 
 
-class PhysicalAction;
 
 
 
@@ -51,7 +50,6 @@
 class TriaxialCompressionEngine : public TriaxialStressController
 {
 	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
 		std::string Phase1End;//used to name output files based on current state
 				
 	public :

Modified: trunk/pkg/dem/Engine/DeusExMachina/TriaxialStateRecorder.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/TriaxialStateRecorder.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/DeusExMachina/TriaxialStateRecorder.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -12,7 +12,6 @@
 //#include &lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
 #include &lt;yade/pkg-common/ParticleParameters.hpp&gt;
 //#include &lt;yade/pkg-dem/BodyMacroParameters.hpp&gt;
-//#include &lt;yade/pkg-common/Force.hpp&gt;
 //#include &lt;yade/pkg-dem/ElasticContactLaw.hpp&gt;
 //#include &lt;yade/pkg-dem/TriaxialStressController.hpp&gt;
 #include &lt;yade/pkg-dem/TriaxialCompressionEngine.hpp&gt;

Modified: trunk/pkg/dem/Engine/DeusExMachina/TriaxialStateRecorder.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/TriaxialStateRecorder.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/DeusExMachina/TriaxialStateRecorder.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -24,13 +24,11 @@
  */
 
 
-class PhysicalAction;
 class TriaxialCompressionEngine;
 
 class TriaxialStateRecorder : public DataRecorder
 {
 	private :
-		//shared_ptr&lt;PhysicalAction&gt; actionForce; // ??? 
 		shared_ptr&lt;TriaxialCompressionEngine&gt; triaxialCompressionEngine;
 		std::ofstream ofile;
 		

Modified: trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -12,7 +12,6 @@
 #include&lt;yade/pkg-common/InteractingBox.hpp&gt;
 #include&lt;yade/pkg-dem/SpheresContactGeometry.hpp&gt;
 #include&lt;yade/pkg-dem/ElasticContactInteraction.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
 #include&lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
 
 
@@ -24,9 +23,6 @@
 
 TriaxialStressController::TriaxialStressController(): wall_bottom_id(wall_id[0]), wall_top_id(wall_id[1]), wall_left_id(wall_id[2]), wall_right_id(wall_id[3]), wall_front_id(wall_id[4]), wall_back_id(wall_id[5])
 {
-	//StiffnessMatrixClassIndex = actionParameterStiffnessMatrix-&gt;getClassIndex();
-	shared_ptr&lt;Force&gt; tmpF(new Force);
-	ForceClassIndex=tmpF-&gt;getClassIndex();
 	firstRun = true;
 	
 	previousStress = 0;
@@ -197,10 +193,9 @@
 void TriaxialStressController::applyCondition(MetaBody* ncb)
 {
 	//cerr &lt;&lt; &quot;TriaxialStressController::applyCondition&quot; &lt;&lt; endl;
-	#ifdef BEX_CONTAINER
-		// sync thread storage of BexContainer
-		ncb-&gt;bex.sync();
-	#endif
+
+	// sync thread storage of BexContainer
+	ncb-&gt;bex.sync();
 	
 	
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
@@ -382,9 +377,7 @@
  */
 Real TriaxialStressController::ComputeUnbalancedForce(MetaBody * ncb, bool maxUnbalanced)
 {
-	#ifdef BEX_CONTAINER
-		ncb-&gt;bex.sync();
-	#endif
+	ncb-&gt;bex.sync();
 	//compute the mean contact force
 	Real MeanForce = 0.f;
 	long nForce = 0;
@@ -406,7 +399,6 @@
 	}
 	if (nForce!=0) MeanForce /= nForce;
 
-//	int actionForceIndex = actionForce-&gt;getClassIndex();
 
 	if (!maxUnbalanced) {
 		//compute mean Unbalanced Force

Modified: trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -11,11 +11,9 @@
 #include&lt;yade/core/DeusExMachina.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
 #include&lt;yade/lib-base/yadeWm3.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
 
 
 #define TR {if (Omega::instance().getCurrentIteration()%100==0) TRACE; }
-class PhysicalAction;
 class MetaBody;
 class PhysicalParameters;
 
@@ -28,18 +26,9 @@
 class TriaxialStressController : public DeusExMachina 
 {
 	private :
-		//shared_ptr&lt;PhysicalAction&gt; actionParameterForce;
-		//int cachedForceClassIndex;
-		int ForceClassIndex;
 		Real previousStress, previousMultiplier; //previous mean stress and size multiplier		
 		bool firstRun;
-		inline const Vector3r getForce(MetaBody* rb, body_id_t id){
-			#ifdef BEX_CONTAINER
-				return rb-&gt;bex.getForce(id); // needs sync, which is done at the beginning of applyCondition
-			#else
-				return static_cast&lt;Force*&gt;(rb-&gt;physicalActions-&gt;find(id,ForceClassIndex).get())-&gt;force;
-			#endif
-		}
+		inline const Vector3r getForce(MetaBody* rb, body_id_t id){ return rb-&gt;bex.getForce(id); /* needs sync, which is done at the beginning of applyCondition */ }
 		
 		 	
 	public :
@@ -111,7 +100,6 @@
 	
 	protected :
 		virtual void registerAttributes();
-	NEEDS_BEX(&quot;Force&quot;);
 	REGISTER_CLASS_NAME(TriaxialStressController);
 	REGISTER_BASE_CLASS_NAME(DeusExMachina);
 };

Modified: trunk/pkg/dem/Engine/DeusExMachina/WallStressRecorder.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/WallStressRecorder.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/DeusExMachina/WallStressRecorder.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -10,7 +10,6 @@
 #include &lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
 #include &lt;yade/pkg-common/ParticleParameters.hpp&gt;
 #include &lt;yade/pkg-dem/BodyMacroParameters.hpp&gt;
-#include &lt;yade/pkg-common/Force.hpp&gt;
 #include &lt;yade/pkg-dem/ElasticContactLaw.hpp&gt;
 
 #include &lt;yade/pkg-dem/SpheresContactGeometry.hpp&gt;
@@ -21,7 +20,7 @@
 #include &lt;boost/lexical_cast.hpp&gt;
 
 
-WallStressRecorder::WallStressRecorder () : DataRecorder(), actionForce(new Force)
+WallStressRecorder::WallStressRecorder () : DataRecorder()
 
 {
 	outputFile = &quot;&quot;;
@@ -91,16 +90,10 @@
 	/// calcul des contraintes via forces resultantes sur murs
 	
 	Real SIG_wall_11 = 0, SIG_wall_22 = 0, SIG_wall_33 = 0;
-	#ifdef BEX_CONTAINER
-		ncb-&gt;bex.sync();
-		Vector3r F_wall_11=ncb-&gt;bex.getForce(wall_left_id);
-		Vector3r F_wall_22=ncb-&gt;bex.getForce(wall_top_id);
-		Vector3r F_wall_33=ncb-&gt;bex.getForce(wall_front_id);
-	#else
-		Vector3r F_wall_11 = static_cast&lt;Force*&gt;( ncb-&gt;physicalActions-&gt;find(wall_left_id, actionForce-&gt;getClassIndex() ). get() )-&gt;force;
-		Vector3r F_wall_22 = static_cast&lt;Force*&gt;( ncb-&gt;physicalActions-&gt;find(wall_top_id, actionForce-&gt;getClassIndex() ). get() )-&gt;force;
-		Vector3r F_wall_33 = static_cast&lt;Force*&gt;( ncb-&gt;physicalActions-&gt;find(wall_front_id, actionForce-&gt;getClassIndex() ). get() )-&gt;force;
-	#endif
+	ncb-&gt;bex.sync();
+	Vector3r F_wall_11=ncb-&gt;bex.getForce(wall_left_id);
+	Vector3r F_wall_22=ncb-&gt;bex.getForce(wall_top_id);
+	Vector3r F_wall_33=ncb-&gt;bex.getForce(wall_front_id);
 	
 	SIG_wall_11 = F_wall_11[0]/(depth*height);
 	SIG_wall_22 = F_wall_22[1]/(depth*width);

Modified: trunk/pkg/dem/Engine/DeusExMachina/WallStressRecorder.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/WallStressRecorder.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/DeusExMachina/WallStressRecorder.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -13,12 +13,10 @@
 #include &lt;string&gt;
 #include &lt;fstream&gt;
 
-class PhysicalAction;
 
 class WallStressRecorder : public DataRecorder
 {
 	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce; // ??? 
 		std::ofstream ofile;
 		
 		bool changed;
@@ -41,7 +39,6 @@
 
 	protected :
 		virtual void postProcessAttributes(bool deserializing);
-	NEEDS_BEX(&quot;Force&quot;);
 	REGISTER_CLASS_NAME(WallStressRecorder);
 	REGISTER_BASE_CLASS_NAME(DataRecorder);
 };

Modified: trunk/pkg/dem/Engine/EngineUnit/ef2_Spheres_NormalShear_ElasticFrictionalLaw.hpp
===================================================================
--- trunk/pkg/dem/Engine/EngineUnit/ef2_Spheres_NormalShear_ElasticFrictionalLaw.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/EngineUnit/ef2_Spheres_NormalShear_ElasticFrictionalLaw.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -4,7 +4,6 @@
  * Has only purely elastic normal and shear components. */
 class ef2_Spheres_NormalShear_ElasticFrictionalLaw: public ConstitutiveLaw {
 	virtual void go(shared_ptr&lt;InteractionGeometry&gt;&amp;, shared_ptr&lt;InteractionPhysics&gt;&amp;, Interaction*, MetaBody*);
-	NEEDS_BEX(&quot;Force&quot;,&quot;Momentum&quot;);
 	FUNCTOR2D(SpheresContactGeometry,NormalShearInteraction);
 	REGISTER_CLASS_AND_BASE(ef2_Spheres_NormalShear_ElasticFrictionalLaw,ConstitutiveLaw);
 };

Modified: trunk/pkg/dem/Engine/EngineUnit/ef2_Spheres_Viscoelastic_SimpleViscoelasticContactLaw.hpp
===================================================================
--- trunk/pkg/dem/Engine/EngineUnit/ef2_Spheres_Viscoelastic_SimpleViscoelasticContactLaw.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/EngineUnit/ef2_Spheres_Viscoelastic_SimpleViscoelasticContactLaw.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -15,7 +15,6 @@
 {
 	public :
 		virtual void go(shared_ptr&lt;InteractionGeometry&gt;&amp;, shared_ptr&lt;InteractionPhysics&gt;&amp;, Interaction*, MetaBody*);
-		NEEDS_BEX(&quot;Force&quot;,&quot;Momentum&quot;);
 		FUNCTOR2D(SpheresContactGeometry,ViscoelasticInteraction);
 		REGISTER_CLASS_AND_BASE(ef2_Spheres_Viscoelastic_SimpleViscoelasticContactLaw,ConstitutiveLaw);
 };

Modified: trunk/pkg/dem/Engine/StandAloneEngine/CapillaryCohesiveLaw.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/CapillaryCohesiveLaw.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/CapillaryCohesiveLaw.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -18,9 +18,6 @@
 #include &lt;yade/pkg-dem/CapillaryParameters.hpp&gt;
 #include &lt;yade/core/Omega.hpp&gt;
 #include &lt;yade/core/MetaBody.hpp&gt;
-#include &lt;yade/pkg-common/Force.hpp&gt;
-#include &lt;yade/pkg-common/Momentum.hpp&gt;
-#include &lt;yade/core/PhysicalAction.hpp&gt;
 #include &lt;Wm3Vector3.h&gt;
 #include &lt;yade/lib-base/yadeWm3.hpp&gt;
 
@@ -35,7 +32,7 @@
 //int compteur1 = 0;
 //int compteur2 = 0;
 
-CapillaryCohesiveLaw::CapillaryCohesiveLaw() : InteractionSolver() , actionForce(new Force) , actionMomentum(new Momentum)
+CapillaryCohesiveLaw::CapillaryCohesiveLaw() : InteractionSolver()
 {
         sdecGroupMask=1;
 
@@ -291,13 +288,8 @@
 					else if (currentContactPhysics-&gt;fusionNumber !=0)
 						currentContactPhysics-&gt;Fcap /= (currentContactPhysics-&gt;fusionNumber+1);
                                 }
-											#ifdef BEX_CONTAINER
-												ncb-&gt;bex.addForce((*ii)-&gt;getId1(), currentContactPhysics-&gt;Fcap);
-												ncb-&gt;bex.addForce((*ii)-&gt;getId2(),-currentContactPhysics-&gt;Fcap);
-											#else
-	                                static_cast&lt;Force*&gt;   (ncb-&gt;physicalActions-&gt;find( (*ii)-&gt;getId1() , actionForce  -&gt;getClassIndex()).get())-&gt;force    += currentContactPhysics-&gt;Fcap;
-	                                static_cast&lt;Force*&gt;   (ncb-&gt;physicalActions-&gt;find( (*ii)-&gt;getId2() , actionForce  -&gt;getClassIndex()).get())-&gt;force    -= currentContactPhysics-&gt;Fcap;
-											#endif
+											ncb-&gt;bex.addForce((*ii)-&gt;getId1(), currentContactPhysics-&gt;Fcap);
+											ncb-&gt;bex.addForce((*ii)-&gt;getId2(),-currentContactPhysics-&gt;Fcap);
 
 				//cerr &lt;&lt; &quot;id1/id2 &quot; &lt;&lt; (*ii)-&gt;getId1() &lt;&lt; &quot;/&quot; &lt;&lt; (*ii)-&gt;getId2() &lt;&lt; &quot; Fcap= &quot; &lt;&lt; currentContactPhysics-&gt;Fcap &lt;&lt; endl;
 

Modified: trunk/pkg/dem/Engine/StandAloneEngine/CapillaryCohesiveLaw.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/CapillaryCohesiveLaw.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/CapillaryCohesiveLaw.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -42,7 +42,6 @@
 
 const int NB_R_VALUES = 10;
 
-class PhysicalAction;
 class capillarylaw; // fait appel a la classe def plus bas
 class Interaction;
 
@@ -71,10 +70,6 @@
 
 class CapillaryCohesiveLaw : public InteractionSolver
 {
-	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-		shared_ptr&lt;PhysicalAction&gt; actionMomentum;
-		
 	public :
 		int sdecGroupMask;
 		Real CapillaryPressure;
@@ -90,7 +85,6 @@
 	protected : 
 		void registerAttributes();
 		virtual void postProcessAttributes(bool deserializing);
-	NEEDS_BEX(&quot;Force&quot;,&quot;Momentum&quot;);
 	REGISTER_CLASS_NAME(CapillaryCohesiveLaw);
 	REGISTER_BASE_CLASS_NAME(InteractionSolver);
 

Modified: trunk/pkg/dem/Engine/StandAloneEngine/CohesiveFrictionalContactLaw.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/CohesiveFrictionalContactLaw.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/CohesiveFrictionalContactLaw.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -13,15 +13,12 @@
 #include&lt;yade/pkg-dem/SDECLinkPhysics.hpp&gt;
 #include&lt;yade/core/Omega.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
 
 
 Vector3r translation_vect (0.10,0,0);
 
 
-CohesiveFrictionalContactLaw::CohesiveFrictionalContactLaw() : InteractionSolver() , actionForce(new Force) , actionMomentum(new Momentum)
+CohesiveFrictionalContactLaw::CohesiveFrictionalContactLaw() : InteractionSolver()
 {
 	sdecGroupMask=1;
 	momentRotationLaw = true;
@@ -255,17 +252,10 @@
                 //  cerr &lt;&lt; &quot;shearForce &quot; &lt;&lt; shearForce &lt;&lt; endl;
                 // cerr &lt;&lt; &quot;f= &quot; &lt;&lt; f &lt;&lt; endl;
                 // it will be some macro(	body-&gt;physicalActions,	ActionType , bodyId )
-					#ifdef BEX_CONTAINER
-						ncb-&gt;bex.addForce (id1, f);
-						ncb-&gt;bex.addForce (id2,-f);
-						ncb-&gt;bex.addTorque(id1, c1x.Cross(f));
-						ncb-&gt;bex.addTorque(id2,-c2x.Cross(f));
-					#else
-                static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id1 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    -= f;
-                static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id2 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    += f;
-                static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id1 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum -= c1x.Cross(f);
-                static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id2 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum += c2x.Cross(f);
-					#endif
+					ncb-&gt;bex.addForce (id1, f);
+					ncb-&gt;bex.addForce (id2,-f);
+					ncb-&gt;bex.addTorque(id1, c1x.Cross(f));
+					ncb-&gt;bex.addTorque(id2,-c2x.Cross(f));
 
 /////	/// Moment law					 	 ///
 /////		if(momentRotationLaw /*&amp;&amp; currentContactPhysics-&gt;cohesionBroken == false*/ )
@@ -364,13 +354,8 @@
 	Vector3r moment = moment_twist + moment_bending;
 currentContactPhysics-&gt;moment_twist = moment_twist;
 currentContactPhysics-&gt;moment_bending = moment_bending;
-			#ifdef BEX_CONTAINER
-				ncb-&gt;bex.addTorque(id1,-moment);
-				ncb-&gt;bex.addTorque(id2, moment);
-			#else
-				static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id1 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum -= moment;
-				static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id2 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum += moment;
-			#endif
+			ncb-&gt;bex.addTorque(id1,-moment);
+			ncb-&gt;bex.addTorque(id2, moment);
 		}
 	/// Moment law	END				 	 ///
 

Modified: trunk/pkg/dem/Engine/StandAloneEngine/CohesiveFrictionalContactLaw.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/CohesiveFrictionalContactLaw.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/CohesiveFrictionalContactLaw.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -13,15 +13,10 @@
 #include &lt;set&gt;
 #include &lt;boost/tuple/tuple.hpp&gt;
 
-class PhysicalAction;
 
 class CohesiveFrictionalContactLaw : public InteractionSolver
 {
 /// Attributes
-	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-		shared_ptr&lt;PhysicalAction&gt; actionMomentum;
-
 	public :
 		int sdecGroupMask;
 		bool momentRotationLaw, erosionActivated, detectBrokenBodies,always_use_moment_law;
@@ -34,7 +29,6 @@
 
 	protected :
 		void registerAttributes();
-	NEEDS_BEX(&quot;Force&quot;,&quot;Momentum&quot;);
 	REGISTER_CLASS_NAME(CohesiveFrictionalContactLaw);
 	REGISTER_BASE_CLASS_NAME(InteractionSolver);
 };

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ContactLaw1.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ContactLaw1.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ContactLaw1.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -13,16 +13,13 @@
 #include&lt;yade/pkg-dem/SDECLinkPhysics.hpp&gt;
 #include&lt;yade/core/Omega.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
 
 #include &lt;yade/lib-miniWm3/Wm3Math.h&gt;
 
 Vector3r translation_vect (0.10,0,0);
 
 
-ContactLaw1::ContactLaw1() : InteractionSolver() , actionForce(new Force) , actionMomentum(new Momentum)
+ContactLaw1::ContactLaw1() : InteractionSolver()
 {
 	sdecGroupMask=1;
 	momentRotationLaw = true;
@@ -214,17 +211,10 @@
                 //  cerr &lt;&lt; &quot;shearForce &quot; &lt;&lt; shearForce &lt;&lt; endl;
                 // cerr &lt;&lt; &quot;f= &quot; &lt;&lt; f &lt;&lt; endl;
                 // it will be some macro(	body-&gt;physicalActions,	ActionType , bodyId )
-					#ifdef BEX_CONTAINER
-						ncb-&gt;bex.addForce (id1,-f);
-						ncb-&gt;bex.addForce (id2,+f);
-						ncb-&gt;bex.addTorque(id1,-c1x.Cross(f));
-						ncb-&gt;bex.addTorque(id2, c2x.Cross(f));
-					#else
-	               static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id1 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    -= f;
-   	            static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id2 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    += f;
-      	         static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id1 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum -= c1x.Cross(f);
-         	      static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id2 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum += c2x.Cross(f);
-					#endif
+					ncb-&gt;bex.addForce (id1,-f);
+					ncb-&gt;bex.addForce (id2,+f);
+					ncb-&gt;bex.addTorque(id1,-c1x.Cross(f));
+					ncb-&gt;bex.addTorque(id2, c2x.Cross(f));
 
 /////	/// Moment law					 	 ///
 /////		if(momentRotationLaw /*&amp;&amp; currentContactPhysics-&gt;cohesionBroken == false*/ )
@@ -313,13 +303,8 @@
 					nbreInteracMomPlastif++;
 					}
 			}
-			#ifdef BEX_CONTAINER
-				ncb-&gt;bex.addTorque(id1,-moment);
-				ncb-&gt;bex.addTorque(id2,+moment);
-			#else
-				static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id1 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum -= moment;
-				static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id2 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum += moment;
-			#endif
+			ncb-&gt;bex.addTorque(id1,-moment);
+			ncb-&gt;bex.addTorque(id2,+moment);
 		}
 	/// Moment law	END				 	 ///
 

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ContactLaw1.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ContactLaw1.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ContactLaw1.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -26,15 +26,9 @@
  */
 
 
-class PhysicalAction;
-
 class ContactLaw1 : public InteractionSolver
 {
 /// Attributes
-	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-		shared_ptr&lt;PhysicalAction&gt; actionMomentum;
-
 	public :
 		int sdecGroupMask;
 		Real coeff_dech;	// = kn(unload) / kn(load)

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -16,15 +16,12 @@
 
 #include&lt;yade/core/Omega.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
 
 #include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
 
 
 
-ElasticCohesiveLaw::ElasticCohesiveLaw() : InteractionSolver() , actionForce(new Force) , actionMomentum(new Momentum)
+ElasticCohesiveLaw::ElasticCohesiveLaw() : InteractionSolver()
 {
 	sdecGroupMask=1;
 	first=true;
@@ -113,17 +110,10 @@
 			currentContactPhysics-&gt;shearForce      -= currentContactPhysics-&gt;ks*shearDisplacement;
 	
 			Vector3r f = currentContactPhysics-&gt;normalForce + currentContactPhysics-&gt;shearForce;
-			#ifdef BEX_CONTAINER
-				ncb-&gt;bex.addForce (id1,-f);
-				ncb-&gt;bex.addForce (id2,+f);
-				ncb-&gt;bex.addTorque(id1,-c1x.Cross(f));
-				ncb-&gt;bex.addTorque(id2, c2x.Cross(f));
-			#else
-				static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id1 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    -= f;
-				static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id2 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    += f;
-				static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id1 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum -= c1x.Cross(f);
-				static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id2 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum += c2x.Cross(f);
-			#endif
+			ncb-&gt;bex.addForce (id1,-f);
+			ncb-&gt;bex.addForce (id2,+f);
+			ncb-&gt;bex.addTorque(id1,-c1x.Cross(f));
+			ncb-&gt;bex.addTorque(id2, c2x.Cross(f));
 	
 	
 	
@@ -219,13 +209,8 @@
 	
 			//if (normElastic&lt;=normMPlastic)
 			//{
-			#ifdef BEX_CONTAINER
-				ncb-&gt;bex.addTorque(id1,-q_n_i*mElastic);
-				ncb-&gt;bex.addTorque(id2, q_n_i*mElastic);
-			#else
-				static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id1 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum -= q_n_i*mElastic;
-				static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id2 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum += q_n_i*mElastic;
-			#endif
+			ncb-&gt;bex.addTorque(id1,-q_n_i*mElastic);
+			ncb-&gt;bex.addTorque(id2, q_n_i*mElastic);
 	
 			//}  
 			//else

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -13,14 +13,11 @@
 #include &lt;set&gt;
 #include &lt;boost/tuple/tuple.hpp&gt;
 
-class PhysicalAction;
 
 class ElasticCohesiveLaw : public InteractionSolver
 {
 	private :
 		bool first; // FIXME - remove that!
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-		shared_ptr&lt;PhysicalAction&gt; actionMomentum;
 
 	public :
 		int sdecGroupMask;

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -13,9 +13,6 @@
 #include&lt;yade/pkg-dem/SDECLinkPhysics.hpp&gt;
 #include&lt;yade/core/Omega.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
 
 #include&lt;yade/extra/Shop.hpp&gt;
 
@@ -46,15 +43,8 @@
 		Shop::applyForceAtContactPoint(force,contGeom-&gt;contactPoint,i-&gt;getId1(),contGeom-&gt;pos1,i-&gt;getId2(),contGeom-&gt;pos2,rb);
 
 		Vector3r bendAbs; Real torsionAbs; contGeom-&gt;bendingTorsionAbs(bendAbs,torsionAbs);
-		#ifdef BEX_CONTAINER
-			rb-&gt;bex.addTorque(i-&gt;getId1(), contGeom-&gt;normal*torsionAbs*ktor+bendAbs*kb);
-			rb-&gt;bex.addTorque(i-&gt;getId2(),-contGeom-&gt;normal*torsionAbs*ktor-bendAbs*kb);
-		#else
-			Shop::Bex::momentum(i-&gt;getId1(),rb)+=contGeom-&gt;normal*torsionAbs*ktor;
-			Shop::Bex::momentum(i-&gt;getId2(),rb)-=contGeom-&gt;normal*torsionAbs*ktor;
-			Shop::Bex::momentum(i-&gt;getId1(),rb)+=bendAbs*kb;
-			Shop::Bex::momentum(i-&gt;getId2(),rb)-=bendAbs*kb;
-		#endif
+		rb-&gt;bex.addTorque(i-&gt;getId1(), contGeom-&gt;normal*torsionAbs*ktor+bendAbs*kb);
+		rb-&gt;bex.addTorque(i-&gt;getId2(),-contGeom-&gt;normal*torsionAbs*ktor-bendAbs*kb);
 	}
 }
 
@@ -62,16 +52,9 @@
 
 
 ElasticContactLaw::ElasticContactLaw() : InteractionSolver()
-#ifndef BEX_CONTAINER
-	, actionForce(new Force) , actionMomentum(new Momentum)
-#endif
 {
 	sdecGroupMask=1;
 	momentRotationLaw = true;
-	#ifndef BEX_CONTAINER
-		actionForceIndex = actionForce-&gt;getClassIndex();
-		actionMomentumIndex = actionMomentum-&gt;getClassIndex();
-	#endif
 	#ifdef SCG_SHEAR
 		useShear=false;
 	#endif
@@ -94,9 +77,6 @@
 	if(!functor) functor=shared_ptr&lt;ef2_Spheres_Elastic_ElasticLaw&gt;(new ef2_Spheres_Elastic_ElasticLaw);
 	functor-&gt;momentRotationLaw=momentRotationLaw;
 	functor-&gt;sdecGroupMask=sdecGroupMask;
-	#ifndef BEX_CONTAINER
-		functor-&gt;actionForceIndex=actionForceIndex; functor-&gt;actionMomentumIndex=actionMomentumIndex;
-	#endif
 	#ifdef SCG_SHEAR
 		functor-&gt;useShear=useShear;
 	#endif
@@ -158,17 +138,10 @@
 			Vector3r f=currentContactPhysics-&gt;normalForce + shearForce;
 			Vector3r _c1x(currentContactGeometry-&gt;contactPoint-de1-&gt;se3.position),
 				_c2x(currentContactGeometry-&gt;contactPoint-de2-&gt;se3.position);
-			#ifdef BEX_CONTAINER
-				ncb-&gt;bex.addForce (id1,-f);
-				ncb-&gt;bex.addForce (id2,+f);
-				ncb-&gt;bex.addTorque(id1,-_c1x.Cross(f));
-				ncb-&gt;bex.addTorque(id2, _c2x.Cross(f));
-			#else
-				static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id1 , actionForceIndex).get() )-&gt;force    -= f;
-				static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id2 , actionForceIndex ).get() )-&gt;force    += f;
-				static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id1 , actionMomentumIndex ).get() )-&gt;momentum -= _c1x.Cross(f);
-				static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id2 , actionMomentumIndex ).get() )-&gt;momentum += _c2x.Cross(f);
-			#endif
+			ncb-&gt;bex.addForce (id1,-f);
+			ncb-&gt;bex.addForce (id2,+f);
+			ncb-&gt;bex.addTorque(id1,-_c1x.Cross(f));
+			ncb-&gt;bex.addTorque(id2, _c2x.Cross(f));
 			currentContactPhysics-&gt;prevNormal = currentContactGeometry-&gt;normal;
 }
 

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -9,7 +9,6 @@
 #pragma once
 
 #include&lt;yade/core/InteractionSolver.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
 
 // only to see whether SCG_SHEAR is defined, may be removed in the future
 #include&lt;yade/pkg-dem/SpheresContactGeometry.hpp&gt;
@@ -18,7 +17,6 @@
 #include &lt;set&gt;
 #include &lt;boost/tuple/tuple.hpp&gt;
 
-class PhysicalAction;
 
 class ElasticContactLaw2: public InteractionSolver{
 	public:
@@ -31,7 +29,6 @@
 		InteractionSolver::registerAttributes();
 		REGISTER_ATTRIBUTE(isCohesive);
 	}
-	NEEDS_BEX(&quot;Force&quot;,&quot;Momentum&quot;);
 	REGISTER_CLASS_NAME(ElasticContactLaw2);
 	REGISTER_BASE_CLASS_NAME(InteractionSolver);
 };
@@ -42,9 +39,6 @@
 	virtual void go(shared_ptr&lt;InteractionGeometry&gt;&amp; _geom, shared_ptr&lt;InteractionPhysics&gt;&amp; _phys, Interaction* I, MetaBody* rootBody);
 	int sdecGroupMask;
 	bool momentRotationLaw;
-	#ifndef BEX_CONTAINER
-		int actionForceIndex,actionMomentumIndex;
-	#endif
 	#ifdef SCG_SHEAR
 		bool useShear;
 	#endif
@@ -67,14 +61,6 @@
 {
 /// Attributes
 	private :
-	#ifndef BEX_CONTAINER
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-		shared_ptr&lt;PhysicalAction&gt; actionMomentum;
-		int actionForceIndex;
-		int actionMomentumIndex;
-		NEEDS_BEX(&quot;Force&quot;,&quot;Momentum&quot;);
-	#endif
-		
 	public :
 		int sdecGroupMask;
 		bool momentRotationLaw;

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ForceRecorder.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ForceRecorder.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ForceRecorder.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -12,13 +12,12 @@
 #include&lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
 #include&lt;yade/core/Omega.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
 #include&lt;boost/lexical_cast.hpp&gt;
 #include&lt;boost/filesystem/operations.hpp&gt;
 
 CREATE_LOGGER(ForceRecorder);
 
-ForceRecorder::ForceRecorder () : DataRecorder(), actionForce(new Force)
+ForceRecorder::ForceRecorder () : DataRecorder()
 {
 	outputFile = &quot;&quot;;
 	interval = 50;
@@ -69,9 +68,7 @@
 void ForceRecorder::action(MetaBody * ncb)
 {
 	if (first) init();
-	#ifdef BEX_CONTAINER
-		ncb-&gt;bex.sync();
-	#endif
+	ncb-&gt;bex.sync();
 
 	Real x=0, y=0, z=0;
 	
@@ -79,11 +76,7 @@
 	{
 		if(ncb-&gt;bodies-&gt;exists(i))
 		{
-			#ifdef BEX_CONTAINER
-				Vector3r force=ncb-&gt;bex.getForce(i);
-			#else
-				Vector3r force = YADE_CAST&lt;Force*&gt;(ncb-&gt;physicalActions-&gt;find( i , actionForce-&gt;getClassIndex() ) . get() )-&gt;force;
-			#endif
+			Vector3r force=ncb-&gt;bex.getForce(i);
 		
 			x+=force[0];
 			y+=force[1];

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ForceRecorder.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ForceRecorder.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ForceRecorder.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -13,12 +13,10 @@
 #include &lt;string&gt;
 #include &lt;fstream&gt;
 
-class PhysicalAction;
 
 class ForceRecorder : public DataRecorder
 {
 	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
 		std::ofstream ofile; 
 
 		bool changed;
@@ -40,7 +38,6 @@
 		virtual void postProcessAttributes(bool deserializing);
 		void init();
 	DECLARE_LOGGER;
-	NEEDS_BEX(&quot;Force&quot;);
 	REGISTER_CLASS_NAME(ForceRecorder);
 	REGISTER_BASE_CLASS_NAME(DataRecorder);
 };

Modified: trunk/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -10,13 +10,12 @@
 #include&lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
 #include&lt;yade/core/Omega.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
 #include &lt;boost/lexical_cast.hpp&gt;
 #include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
 //#include &lt;Wm3Vector3r.hpp&gt;
 
 
-GeometricalModelForceColorizer::GeometricalModelForceColorizer () : StandAloneEngine(), actionForce(new Force)
+GeometricalModelForceColorizer::GeometricalModelForceColorizer () : StandAloneEngine()
 {
 }
 
@@ -31,9 +30,7 @@
 void GeometricalModelForceColorizer::action(MetaBody * ncb)
 {
 	// FIXME the same in GLDrawLatticeBeamState.cpp
-	#ifdef BEX_CONTAINER
-		ncb-&gt;bex.sync();
-	#endif
+	ncb-&gt;bex.sync();
 
 	BodyContainer* bodies = ncb-&gt;bodies.get();
 	
@@ -47,11 +44,7 @@
 		if(body-&gt;isDynamic)
 		{
 			unsigned int i = body -&gt; getId();
-			#ifdef BEX_CONTAINER
-				Vector3r force=ncb-&gt;bex.getForce(i);
-			#else
-				Vector3r force = YADE_CAST&lt;Force*&gt;(ncb-&gt;physicalActions-&gt;find( i , actionForce-&gt;getClassIndex() ) . get() )-&gt;force;
-			#endif
+			Vector3r force=ncb-&gt;bex.getForce(i);
 			min = std::min( force[0] , std::min( force[1] , std::min( force[2], min ) ) );
 			max = std::max( force[0] , std::max( force[1] , std::max( force[2], max ) ) );
 		}
@@ -67,11 +60,7 @@
 		{
 			GeometricalModel* gm = body-&gt;geometricalModel.get();
 			unsigned int i = body -&gt; getId();
-			#ifdef BEX_CONTAINER
-				Vector3r force=ncb-&gt;bex.getForce(i);
-			#else
-				Vector3r force = YADE_CAST&lt;Force*&gt;(ncb-&gt;physicalActions-&gt;find( i , actionForce-&gt;getClassIndex() ) . get() )-&gt;force;
-			#endif
+			Vector3r force=ncb-&gt;bex.getForce(i);
 
 			gm-&gt;diffuseColor[0] = (force[2]-min)/(max-min);
 			gm-&gt;diffuseColor[1] = (force[2]-min)/(max-min);

Modified: trunk/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -10,20 +10,14 @@
 
 #include&lt;yade/core/StandAloneEngine.hpp&gt;
 
-class PhysicalAction;
-
 class GeometricalModelForceColorizer : public StandAloneEngine
 {
-	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-	
 	public :
 		GeometricalModelForceColorizer ();
 
 		virtual void action(MetaBody*);
 		virtual bool isActivated();
 	
-	NEEDS_BEX(&quot;Force&quot;);	
 	REGISTER_CLASS_NAME(GeometricalModelForceColorizer);
 	REGISTER_BASE_CLASS_NAME(StandAloneEngine);
 };

Deleted: trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -1,114 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Bruno Chareyre                                  *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">bruno.chareyre at hmg.inpg.fr</A>                                            *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include&lt;yade/pkg-dem/SpheresContactGeometry.hpp&gt;
-#include&lt;yade/pkg-common/NormalShearInteractions.hpp&gt;
-#include&lt;yade/pkg-dem/ElasticContactInteraction.hpp&gt;
-#include&lt;yade/core/Omega.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
-#include&lt;yade/pkg-dem/GlobalStiffness.hpp&gt;
-#include&quot;GlobalStiffnessCounter.hpp&quot;
-
-GlobalStiffnessCounter::GlobalStiffnessCounter() : InteractionSolver()
-{
-	interval=100;
-	//sdecGroupMask=1;
-	actionForceIndex=shared_ptr&lt;Force&gt;(new Force)-&gt;getClassIndex();
-	actionMomentumIndex=shared_ptr&lt;Momentum&gt;(new Momentum)-&gt;getClassIndex();
-	actionStiffnessIndex=shared_ptr&lt;GlobalStiffness&gt;(new GlobalStiffness)-&gt;getClassIndex();
-}
-
-
-void GlobalStiffnessCounter::registerAttributes()
-{
-	InteractionSolver::registerAttributes();
-	REGISTER_ATTRIBUTE(interval);
-	//REGISTER_ATTRIBUTE(sdecGroupMask);
-}
-
-bool GlobalStiffnessCounter::isActivated()
-{
-	return ((Omega::instance().getCurrentIteration() % interval == 0) || (Omega::instance().getCurrentIteration() &lt; (long int) 2));
-}
-
-#if 0
-bool GlobalStiffnessCounter::getSphericalElasticInteractionParameters(const shared_ptr&lt;Interaction&gt;&amp; contact, Vector3r&amp; normal, Real&amp; kn, Real&amp; ks, Real&amp; radius1, Real&amp; radius2){
-	shared_ptr&lt;SpheresContactGeometry&gt; currentContactGeometry=YADE_PTR_CAST&lt;SpheresContactGeometry&gt;(contact-&gt;interactionGeometry);
-	shared_ptr&lt;ElasticContactInteraction&gt; currentContactPhysics=YADE_PTR_CAST&lt;ElasticContactInteraction&gt;(contact-&gt;interactionPhysics);
-
-	Real fn=currentContactPhysics-&gt;normalForce.SquaredLength();
-	if(fn==0) return false;//This test means : is something happening at this contact : no question about numerical error
-	normal=currentContactGeometry-&gt;normal;
-	radius1=currentContactGeometry-&gt;radius1; radius2=currentContactGeometry-&gt;radius2;
-	kn=currentContactPhysics-&gt;kn; ks=currentContactPhysics-&gt;ks;
-	return true;
-}
-#endif
-
-void GlobalStiffnessCounter::traverseInteractions(MetaBody* ncb, const shared_ptr&lt;InteractionContainer&gt;&amp; interactions){
-	#ifdef BEX_CONTAINER
-		return;
-	#else
-		FOREACH(const shared_ptr&lt;Interaction&gt;&amp; contact, *interactions){
-			if(!contact-&gt;isReal) continue;
-
-			SpheresContactGeometry* geom=YADE_CAST&lt;SpheresContactGeometry*&gt;(contact-&gt;interactionGeometry.get()); assert(geom);
-			NormalShearInteraction* phys=YADE_CAST&lt;NormalShearInteraction*&gt;(contact-&gt;interactionPhysics.get()); assert(phys);
-			// all we need for getting stiffness
-			Vector3r&amp; normal=geom-&gt;normal; Real&amp; kn=phys-&gt;kn; Real&amp; ks=phys-&gt;ks; Real&amp; radius1=geom-&gt;radius1; Real&amp; radius2=geom-&gt;radius2;
-			// FIXME? NormalShearInteraction knows nothing about whether the contact is &quot;active&quot; (force!=0) or not;
-			// former code: if(force==0) continue; /* disregard this interaction, it is not active */.
-			// It seems though that in such case either the interaction is accidentally at perfect equilibrium (unlikely)
-			// or it should have been deleted already. Right? 
-			//ANSWER : some interactions can exist without fn, e.g. distant capillary force, wich does not contribute to the overall stiffness via kn. The test is needed.
-			Real fn = (static_cast&lt;ElasticContactInteraction *&gt; (contact-&gt;interactionPhysics.get()))-&gt;normalForce.SquaredLength();
-
-			if (fn!=0) {
-
-			//Diagonal terms of the translational stiffness matrix
-			Vector3r diag_stiffness = Vector3r(std::pow(normal.X(),2),std::pow(normal.Y(),2),std::pow(normal.Z(),2));
-			diag_stiffness *= kn-ks;
-			diag_stiffness = diag_stiffness + Vector3r(1,1,1)*ks;
-
-			//diagonal terms of the rotational stiffness matrix
-			// Vector3r branch1 = currentContactGeometry-&gt;normal*currentContactGeometry-&gt;radius1;
-			// Vector3r branch2 = currentContactGeometry-&gt;normal*currentContactGeometry-&gt;radius2;
-			Vector3r diag_Rstiffness =
-				Vector3r(std::pow(normal.Y(),2)+std::pow(normal.Z(),2),
-					std::pow(normal.X(),2)+std::pow(normal.Z(),2),
-					std::pow(normal.X(),2)+std::pow(normal.Y(),2));
-			diag_Rstiffness *= ks;
-			//cerr &lt;&lt; &quot;diag_Rstifness=&quot; &lt;&lt; diag_Rstiffness &lt;&lt; endl;
-
-			PhysicalAction* st = ncb-&gt;physicalActions-&gt;find(contact-&gt;getId1(),actionStiffnessIndex).get();
-			GlobalStiffness* s = static_cast&lt;GlobalStiffness*&gt;(st);
-			s-&gt;stiffness += diag_stiffness;
-			s-&gt;Rstiffness += diag_Rstiffness*pow(radius1,2);	
-			st = ncb-&gt;physicalActions-&gt;find(contact-&gt;getId2(),actionStiffnessIndex).get();
-			s = static_cast&lt;GlobalStiffness*&gt;(st);
-			s-&gt;stiffness += diag_stiffness;
-			s-&gt;Rstiffness += diag_Rstiffness*pow(radius2,2);
-			
-			}
-		}
-	#endif
-}
-
-void GlobalStiffnessCounter::action(MetaBody* ncb)
-{
-	// transient Links
-	traverseInteractions(ncb,ncb-&gt;transientInteractions);
-	// ignore pesistent links, unused and deprecated
-}
-
-
-
-YADE_PLUGIN();

Deleted: trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -1,50 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Bruno Chareyre                                  *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">bruno.chareyre at hmg.inpg.fr</A>                                            *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#pragma once
-
-#include&lt;yade/core/InteractionSolver.hpp&gt;
-
-#include &lt;set&gt;
-#include &lt;boost/tuple/tuple.hpp&gt;
-
-class PhysicalAction;
-
-
-class GlobalStiffnessCounter : public InteractionSolver
-{
-/// Attributes
-	private :
-		int actionForceIndex;
-		int actionMomentumIndex;
-		int actionStiffnessIndex;
-
-		bool getInteractionParameters(const shared_ptr&lt;Interaction&gt;&amp; contact, Vector3r&amp; normal, Real&amp; kn, Real&amp; ks, Real&amp; radius1, Real&amp; radius2);
-		bool getSphericalElasticInteractionParameters(const shared_ptr&lt;Interaction&gt;&amp; contact, Vector3r&amp; normal, Real&amp; kn, Real&amp; ks, Real&amp; radius1, Real&amp; radius2);
-		void traverseInteractions(MetaBody* ncb, const shared_ptr&lt;InteractionContainer&gt;&amp; interactions);
-
-	public :
-		unsigned int interval;
-		//int sdecGroupMask;
-	
-		GlobalStiffnessCounter();
-		void action(MetaBody*);
-		virtual bool isActivated();
-
-	protected :
-		void registerAttributes();
-	NEEDS_BEX(&quot;Force&quot;,&quot;Momentum&quot;,&quot;GlobalStiffness&quot;);
-	REGISTER_CLASS_NAME(GlobalStiffnessCounter);
-	REGISTER_BASE_CLASS_NAME(InteractionSolver);
-};
-
-REGISTER_SERIALIZABLE(GlobalStiffnessCounter);
-
-
-
-

Modified: trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -14,15 +14,13 @@
 #include&lt;yade/core/Interaction.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
 #include&lt;yade/pkg-common/Sphere.hpp&gt;
-#include&lt;yade/pkg-dem/GlobalStiffness.hpp&gt;
 
 CREATE_LOGGER(GlobalStiffnessTimeStepper);
 YADE_PLUGIN(&quot;GlobalStiffnessTimeStepper&quot;);
 
-GlobalStiffnessTimeStepper::GlobalStiffnessTimeStepper() : TimeStepper() , sdecContactModel(new MacroMicroElasticRelationships), actionParameterGlobalStiffness(new GlobalStiffness)
+GlobalStiffnessTimeStepper::GlobalStiffnessTimeStepper() : TimeStepper() , sdecContactModel(new MacroMicroElasticRelationships)
 {
 //cerr &lt;&lt; &quot;GlobalStiffnessTimeStepper()&quot;  &lt;&lt; endl;
-	globalStiffnessClassIndex = actionParameterGlobalStiffness-&gt;getClassIndex();
 	sdecGroupMask = 1;
 	timestepSafetyCoefficient = 0.8;
 	computedOnce = false;
@@ -55,15 +53,9 @@
 	
 	// Sphere* sphere = static_cast&lt;Sphere*&gt;(body-&gt;geometricalModel.get());
 	
-	#ifdef BEX_CONTAINER
-		Vector3r&amp;  stiffness= stiffnesses[body-&gt;getId()];
-		Vector3r&amp; Rstiffness=Rstiffnesses[body-&gt;getId()];
-	#else
-		Vector3r&amp; stiffness = (static_cast&lt;GlobalStiffness*&gt;( ncb-&gt;physicalActions-&gt;find (body-&gt;getId(), globalStiffnessClassIndex).get()))-&gt;stiffness;
-		Vector3r&amp; Rstiffness = (static_cast&lt;GlobalStiffness*&gt;( ncb-&gt;physicalActions-&gt;find (body-&gt;getId(), globalStiffnessClassIndex).get()))-&gt;Rstiffness;
-	#endif
+	Vector3r&amp;  stiffness= stiffnesses[body-&gt;getId()];
+	Vector3r&amp; Rstiffness=Rstiffnesses[body-&gt;getId()];
 
-	//cerr &lt;&lt; &quot;Vector3r&amp; stiffness = (static_cast&lt;GlobalStiffness*&gt;( ncb&quot; &lt;&lt; endl;
 	if(! ( /* sphere &amp;&amp; */ sdec &amp;&amp; stiffness) )
 		return; // not possible to compute!
 	//cerr &lt;&lt; &quot;return; // not possible to compute!&quot; &lt;&lt; endl;
@@ -137,11 +129,8 @@
 
 void GlobalStiffnessTimeStepper::computeTimeStep(MetaBody* ncb)
 {
+	computeStiffnesses(ncb);
 
-	#ifdef BEX_CONTAINER
-		computeStiffnesses(ncb);
-	#endif
-
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 // 	shared_ptr&lt;InteractionContainer&gt;&amp; transientInteractions = ncb-&gt;transientInteractions;
 
@@ -189,53 +178,50 @@
 			string(&quot;, BUT timestep is &quot;)+lexical_cast&lt;string&gt;(Omega::instance().getTimeStep()))&lt;&lt;&quot;.&quot;);
 }
 
-#ifdef BEX_CONTAINER
-	void GlobalStiffnessTimeStepper::computeStiffnesses(MetaBody* rb){
-		/* check size */
-		size_t size=stiffnesses.size();
-		if(size&lt;rb-&gt;bodies-&gt;size()){
-			size=rb-&gt;bodies-&gt;size();
-			stiffnesses.resize(size); Rstiffnesses.resize(size);
-		}
-		/* reset stored values */
-		memset(stiffnesses[0], 0,sizeof(Vector3r)*size);
-		memset(Rstiffnesses[0],0,sizeof(Vector3r)*size);
-		/* loop copied verbatim from GlobalStiffnessCounter */
-		FOREACH(const shared_ptr&lt;Interaction&gt;&amp; contact, *rb-&gt;interactions){
-			if(!contact-&gt;isReal) continue;
+void GlobalStiffnessTimeStepper::computeStiffnesses(MetaBody* rb){
+	/* check size */
+	size_t size=stiffnesses.size();
+	if(size&lt;rb-&gt;bodies-&gt;size()){
+		size=rb-&gt;bodies-&gt;size();
+		stiffnesses.resize(size); Rstiffnesses.resize(size);
+	}
+	/* reset stored values */
+	memset(stiffnesses[0], 0,sizeof(Vector3r)*size);
+	memset(Rstiffnesses[0],0,sizeof(Vector3r)*size);
+	FOREACH(const shared_ptr&lt;Interaction&gt;&amp; contact, *rb-&gt;interactions){
+		if(!contact-&gt;isReal) continue;
 
-			SpheresContactGeometry* geom=YADE_CAST&lt;SpheresContactGeometry*&gt;(contact-&gt;interactionGeometry.get()); assert(geom);
-			NormalShearInteraction* phys=YADE_CAST&lt;NormalShearInteraction*&gt;(contact-&gt;interactionPhysics.get()); assert(phys);
-			// all we need for getting stiffness
-			Vector3r&amp; normal=geom-&gt;normal; Real&amp; kn=phys-&gt;kn; Real&amp; ks=phys-&gt;ks; Real&amp; radius1=geom-&gt;radius1; Real&amp; radius2=geom-&gt;radius2;
-			// FIXME? NormalShearInteraction knows nothing about whether the contact is &quot;active&quot; (force!=0) or not;
-			// former code: if(force==0) continue; /* disregard this interaction, it is not active */.
-			// It seems though that in such case either the interaction is accidentally at perfect equilibrium (unlikely)
-			// or it should have been deleted already. Right? 
-			//ANSWER : some interactions can exist without fn, e.g. distant capillary force, wich does not contribute to the overall stiffness via kn. The test is needed.
-			Real fn = (static_cast&lt;NormalShearInteraction *&gt; (contact-&gt;interactionPhysics.get()))-&gt;normalForce.SquaredLength();
+		SpheresContactGeometry* geom=YADE_CAST&lt;SpheresContactGeometry*&gt;(contact-&gt;interactionGeometry.get()); assert(geom);
+		NormalShearInteraction* phys=YADE_CAST&lt;NormalShearInteraction*&gt;(contact-&gt;interactionPhysics.get()); assert(phys);
+		// all we need for getting stiffness
+		Vector3r&amp; normal=geom-&gt;normal; Real&amp; kn=phys-&gt;kn; Real&amp; ks=phys-&gt;ks; Real&amp; radius1=geom-&gt;radius1; Real&amp; radius2=geom-&gt;radius2;
+		// FIXME? NormalShearInteraction knows nothing about whether the contact is &quot;active&quot; (force!=0) or not;
+		// former code: if(force==0) continue; /* disregard this interaction, it is not active */.
+		// It seems though that in such case either the interaction is accidentally at perfect equilibrium (unlikely)
+		// or it should have been deleted already. Right? 
+		//ANSWER : some interactions can exist without fn, e.g. distant capillary force, wich does not contribute to the overall stiffness via kn. The test is needed.
+		Real fn = (static_cast&lt;NormalShearInteraction *&gt; (contact-&gt;interactionPhysics.get()))-&gt;normalForce.SquaredLength();
 
-			if (fn!=0) {
-				//Diagonal terms of the translational stiffness matrix
-				Vector3r diag_stiffness = Vector3r(std::pow(normal.X(),2),std::pow(normal.Y(),2),std::pow(normal.Z(),2));
-				diag_stiffness *= kn-ks;
-				diag_stiffness = diag_stiffness + Vector3r(1,1,1)*ks;
+		if (fn!=0) {
+			//Diagonal terms of the translational stiffness matrix
+			Vector3r diag_stiffness = Vector3r(std::pow(normal.X(),2),std::pow(normal.Y(),2),std::pow(normal.Z(),2));
+			diag_stiffness *= kn-ks;
+			diag_stiffness = diag_stiffness + Vector3r(1,1,1)*ks;
 
-				//diagonal terms of the rotational stiffness matrix
-				// Vector3r branch1 = currentContactGeometry-&gt;normal*currentContactGeometry-&gt;radius1;
-				// Vector3r branch2 = currentContactGeometry-&gt;normal*currentContactGeometry-&gt;radius2;
-				Vector3r diag_Rstiffness =
-					Vector3r(std::pow(normal.Y(),2)+std::pow(normal.Z(),2),
-						std::pow(normal.X(),2)+std::pow(normal.Z(),2),
-						std::pow(normal.X(),2)+std::pow(normal.Y(),2));
-				diag_Rstiffness *= ks;
-				//cerr &lt;&lt; &quot;diag_Rstifness=&quot; &lt;&lt; diag_Rstiffness &lt;&lt; endl;
-				
-				stiffnesses [contact-&gt;getId1()]+=diag_stiffness;
-				Rstiffnesses[contact-&gt;getId1()]+=diag_Rstiffness*pow(radius1,2);
-				stiffnesses [contact-&gt;getId2()]+=diag_stiffness;
-				Rstiffnesses[contact-&gt;getId2()]+=diag_Rstiffness*pow(radius2,2);
-			}
+			//diagonal terms of the rotational stiffness matrix
+			// Vector3r branch1 = currentContactGeometry-&gt;normal*currentContactGeometry-&gt;radius1;
+			// Vector3r branch2 = currentContactGeometry-&gt;normal*currentContactGeometry-&gt;radius2;
+			Vector3r diag_Rstiffness =
+				Vector3r(std::pow(normal.Y(),2)+std::pow(normal.Z(),2),
+					std::pow(normal.X(),2)+std::pow(normal.Z(),2),
+					std::pow(normal.X(),2)+std::pow(normal.Y(),2));
+			diag_Rstiffness *= ks;
+			//cerr &lt;&lt; &quot;diag_Rstifness=&quot; &lt;&lt; diag_Rstiffness &lt;&lt; endl;
+			
+			stiffnesses [contact-&gt;getId1()]+=diag_stiffness;
+			Rstiffnesses[contact-&gt;getId1()]+=diag_Rstiffness*pow(radius1,2);
+			stiffnesses [contact-&gt;getId2()]+=diag_stiffness;
+			Rstiffnesses[contact-&gt;getId2()]+=diag_Rstiffness*pow(radius2,2);
 		}
 	}
-#endif
+}

Modified: trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -21,23 +21,18 @@
 class BodyContainer;
 class MacroMicroElasticRelationships;
 class MetaBody;
-class PhysicalAction;
 
 class GlobalStiffnessTimeStepper : public TimeStepper
 {
 	private :
-	#ifdef BEX_CONTAINER
 		vector&lt;Vector3r&gt; stiffnesses;
 		vector&lt;Vector3r&gt; Rstiffnesses;
-		void computeStiffnesses(MetaBody*); // what GlobalStiffnessCounter used to do
-	#endif
+		void computeStiffnesses(MetaBody*);
 
 		Real		newDt, previousDt;
 		bool		computedSomething,
 				computedOnce;
 		shared_ptr&lt;MacroMicroElasticRelationships&gt; sdecContactModel;
-		shared_ptr&lt;PhysicalAction&gt; actionParameterGlobalStiffness;
-		int globalStiffnessClassIndex;
 
 		void findTimeStepFromBody(const shared_ptr&lt;Body&gt;&amp; body, MetaBody * ncb);
 		void findTimeStepFromInteraction(const shared_ptr&lt;Interaction&gt;&amp; , shared_ptr&lt;BodyContainer&gt;&amp;);
@@ -60,7 +55,6 @@
 	protected :
 		virtual void registerAttributes();
 
-	NEEDS_BEX(&quot;GlobalStiffness&quot;);
 	REGISTER_CLASS_NAME(GlobalStiffnessTimeStepper);
 	REGISTER_BASE_CLASS_NAME(TimeStepper);
 };

Modified: trunk/pkg/dem/Engine/StandAloneEngine/MicroMacroAnalyser.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/MicroMacroAnalyser.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/MicroMacroAnalyser.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -14,9 +14,6 @@
 
 #include&lt;yade/core/Omega.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
 
 #include &lt;yade/pkg-common/InteractingSphere.hpp&gt;
 
@@ -29,10 +26,8 @@
 
 CREATE_LOGGER(MicroMacroAnalyser);
 
-MicroMacroAnalyser::MicroMacroAnalyser() : StandAloneEngine() , actionForce(new Force) , actionMomentum(new Momentum)
+MicroMacroAnalyser::MicroMacroAnalyser() : StandAloneEngine()
 {
-	actionForceIndex = actionForce-&gt;getClassIndex();
-	actionMomentumIndex = actionMomentum-&gt;getClassIndex();
 	analyser = shared_ptr&lt;KinematicLocalisationAnalyser&gt; (new KinematicLocalisationAnalyser);
 	analyser-&gt;SetConsecutive (true);
 	analyser-&gt;SetNO_ZERO_ID (false);

Modified: trunk/pkg/dem/Engine/StandAloneEngine/MicroMacroAnalyser.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/MicroMacroAnalyser.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/MicroMacroAnalyser.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -21,17 +21,12 @@
 	This class is using a separate library built from extra/triangulation sources		
  */
 
-class PhysicalAction;
 class KinematicLocalisationAnalyser;
 
 class MicroMacroAnalyser : public StandAloneEngine
 {
 /// Attributes
 	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-		shared_ptr&lt;PhysicalAction&gt; actionMomentum;
-		int actionForceIndex;
-		int actionMomentumIndex;
 		std::ofstream ofile;
 		
 		shared_ptr&lt;TriaxialCompressionEngine&gt; triaxialCompressionEngine;

Modified: trunk/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -12,12 +12,8 @@
 #include&lt;yade/pkg-common/NormalShearInteractions.hpp&gt;
 #include&lt;yade/core/Omega.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
 
-
-MyTetrahedronLaw::MyTetrahedronLaw() : InteractionSolver() , actionForce(new Force) , actionMomentum(new Momentum)
+MyTetrahedronLaw::MyTetrahedronLaw() : InteractionSolver()
 {
 }
 
@@ -73,17 +69,10 @@
 						Vector3r x			= currentContactGeometry-&gt;contactPoints[i][j];
 						Vector3r c1x			= (x - de1-&gt;se3.position);
 						Vector3r c2x			= (x - de2-&gt;se3.position);
-						#ifdef BEX_CONTAINER
-							ncb-&gt;bex.addForce (id1,-force);
-							ncb-&gt;bex.addForce (id2,+force);
-							ncb-&gt;bex.addTorque(id1,-c1x.Cross(force));
-							ncb-&gt;bex.addTorque(id2, c2x.Cross(force));
-						#else
-							static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id1 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    -= force;
-							static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id2 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    += force;
-							static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id1 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum -= c1x.Cross(force);
-							static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id2 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum += c2x.Cross(force);
-						#endif
+						ncb-&gt;bex.addForce (id1,-force);
+						ncb-&gt;bex.addForce (id2,+force);
+						ncb-&gt;bex.addTorque(id1,-c1x.Cross(force));
+						ncb-&gt;bex.addTorque(id2, c2x.Cross(force));
 
 					}
 				}

Modified: trunk/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -25,30 +25,14 @@
  *    tetrahedron's center on direction perpendicular to the acting force.
 */
 
-class PhysicalAction;
-
 class MyTetrahedronLaw : public InteractionSolver
 {
-	private :
-		/// those two are here only because this class needs to access
-		/// the ID number of Force and Momentum
-		///
-		/// those variables are actually not used to store a value of
-		/// Force and Momentum, just to get ID, although normally they are
-		/// used to store this value. 
-		/// 
-		/// I already have a better solution for that.
-		///
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-		shared_ptr&lt;PhysicalAction&gt; actionMomentum;
-
 	public :
 		MyTetrahedronLaw();
 		void action(MetaBody*);
 
 	protected :
 		void registerAttributes();
-	NEEDS_BEX(&quot;Force&quot;,&quot;Momentum&quot;);
 	REGISTER_CLASS_NAME(MyTetrahedronLaw);
 	REGISTER_BASE_CLASS_NAME(InteractionSolver);
 };

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ViscousForceDamping.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ViscousForceDamping.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ViscousForceDamping.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -16,12 +16,8 @@
 #include&lt;yade/pkg-dem/SDECLinkPhysics.hpp&gt;
 #include&lt;yade/core/Omega.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
 
-
-ViscousForceDamping::ViscousForceDamping() : InteractionSolver() , actionForce(new Force) , actionMomentum(new Momentum), betaNormal(0.0), betaShear(0.0)
+ViscousForceDamping::ViscousForceDamping() : InteractionSolver() ,betaNormal(0.0), betaShear(0.0)
 {
 	sdecGroupMask=1;
 	momentRotationLaw = true;
@@ -140,17 +136,10 @@
 			Vector3r viscousDampingForce	= normalDampingForce + shearDampingForce;
 			
 //	Add forces
-			#ifdef BEX_CONTAINER
-				ncb-&gt;bex.addForce (id1,-viscousDampingForce);
-				ncb-&gt;bex.addForce (id2,+viscousDampingForce);
-				ncb-&gt;bex.addTorque(id1,-c1x.Cross(viscousDampingForce));
-				ncb-&gt;bex.addTorque(id2, c2x.Cross(viscousDampingForce));
-			#else
-				static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id1 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    -= viscousDampingForce;
-				static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id2 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    += viscousDampingForce;
-				static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id1 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum -= c1x.Cross(viscousDampingForce);
-				static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id2 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum += c2x.Cross(viscousDampingForce);
-			#endif
+			ncb-&gt;bex.addForce (id1,-viscousDampingForce);
+			ncb-&gt;bex.addForce (id2,+viscousDampingForce);
+			ncb-&gt;bex.addTorque(id1,-c1x.Cross(viscousDampingForce));
+			ncb-&gt;bex.addTorque(id2, c2x.Cross(viscousDampingForce));
 			currentContactPhysics-&gt;prevNormal = currentContactGeometry-&gt;normal;
 		}
 	}

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ViscousForceDamping.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ViscousForceDamping.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ViscousForceDamping.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -16,15 +16,9 @@
 #include &lt;set&gt;
 #include &lt;boost/tuple/tuple.hpp&gt;
 
-class PhysicalAction;
-
 class ViscousForceDamping : public InteractionSolver
 {
 /// Attributes
-	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-		shared_ptr&lt;PhysicalAction&gt; actionMomentum;
-
 	public :
 		
 		Real betaNormal;

Modified: trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -13,11 +13,7 @@
 #include&lt;yade/pkg-dem/SDECLinkPhysics.hpp&gt;
 #include&lt;yade/core/Omega.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
 
-
 #include &lt;yade/pkg-common/InteractingSphere.hpp&gt;
 #include &quot;VolumicContactLaw.hpp&quot;
 //#include&lt;yade/extra/TesselationWrapper.h&gt;
@@ -29,14 +25,11 @@
 //../../YADE/trunk/examples/sphere_100_poly.txt
 
 
-VolumicContactLaw::VolumicContactLaw() : InteractionSolver() , actionForce(new Force) , actionMomentum(new Momentum)
+VolumicContactLaw::VolumicContactLaw() : InteractionSolver()
 //, T1(new TesselationWrapper)
 {
 	sdecGroupMask=1;
 	momentRotationLaw = true;
-	actionForceIndex = actionForce-&gt;getClassIndex();
-	actionMomentumIndex = actionMomentum-&gt;getClassIndex();
-	
 }
 
 
@@ -479,17 +472,10 @@
 	
 			Vector3r f				= currentContactPhysics-&gt;normalForce + shearForce;
 			
-			#ifdef BEX_CONTAINER
-				ncb-&gt;bex.addForce (id1,-f);
-				ncb-&gt;bex.addForce (id2,+f);
-				ncb-&gt;bex.addTorque(id1,-c1x.Cross(f));
-				ncb-&gt;bex.addTorque(id2, c2x.Cross(f));
-			#else
-				static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id1 , actionForceIndex).get() )-&gt;force    -= f;
-				static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id2 , actionForceIndex ).get() )-&gt;force    += f;
-				static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id1 , actionMomentumIndex ).get() )-&gt;momentum -= c1x.Cross(f);
-				static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id2 , actionMomentumIndex ).get() )-&gt;momentum += c2x.Cross(f);
-			#endif
+			ncb-&gt;bex.addForce (id1,-f);
+			ncb-&gt;bex.addForce (id2,+f);
+			ncb-&gt;bex.addTorque(id1,-c1x.Cross(f));
+			ncb-&gt;bex.addTorque(id2, c2x.Cross(f));
 			
 			currentContactPhysics-&gt;prevNormal = currentContactGeometry-&gt;normal;
 		}

Modified: trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -13,17 +13,9 @@
 #include &lt;set&gt;
 #include &lt;boost/tuple/tuple.hpp&gt;
 
-class PhysicalAction;
-
 class VolumicContactLaw : public InteractionSolver
 {
 /// Attributes
-	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-		shared_ptr&lt;PhysicalAction&gt; actionMomentum;
-		int actionForceIndex;
-		int actionMomentumIndex;
-		
 	public :
 		int sdecGroupMask;
 		bool momentRotationLaw;
@@ -44,7 +36,6 @@
 
 	protected :
 		void registerAttributes();
-	NEEDS_BEX(&quot;Force&quot;,&quot;Momentum&quot;);
 	REGISTER_CLASS_NAME(VolumicContactLaw);
 	REGISTER_BASE_CLASS_NAME(InteractionSolver);
 };

Modified: trunk/pkg/dem/PreProcessor/CohesiveTriaxialTest.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/CohesiveTriaxialTest.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/PreProcessor/CohesiveTriaxialTest.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -16,7 +16,6 @@
 #include&lt;yade/pkg-dem/CohesiveFrictionalRelationships.hpp&gt;
 #include&lt;yade/pkg-dem/CohesiveFrictionalBodyParameters.hpp&gt;
 #include&lt;yade/pkg-dem/SDECLinkPhysics.hpp&gt;
-#include&lt;yade/pkg-dem/GlobalStiffnessCounter.hpp&gt;
 #include&lt;yade/pkg-dem/GlobalStiffnessTimeStepper.hpp&gt;
 #include&lt;yade/pkg-dem/PositionOrientationRecorder.hpp&gt;
 
@@ -54,14 +53,12 @@
 #include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
 #include&lt;yade/pkg-common/InteractionHashMap.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 #include&lt;yade/extra/Shop.hpp&gt;
 
@@ -274,7 +271,6 @@
 		createBox(body,center,halfSize,wall_bottom_wire);
 	 	if(wall_bottom) {
 			rootBody-&gt;bodies-&gt;insert(body);
-			//(resultantforceEngine-&gt;subscribedBodies).push_back(body-&gt;getId());
 			triaxialcompressionEngine-&gt;wall_bottom_id = body-&gt;getId();
 			//triaxialStateRecorder-&gt;wall_bottom_id = body-&gt;getId();
 			forcerec-&gt;startId = body-&gt;getId();
@@ -570,11 +566,6 @@
 	velocityRecorder-&gt; outputFile 	= velocityRecordFile;
 	velocityRecorder-&gt; interval 	= recordIntervalIter;
 
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	//physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;StiffnessMatrix&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;GlobalStiffness&quot;);
 	
 	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
 	shared_ptr&lt;InteractionGeometryEngineUnit&gt; s1(new InteractingSphere2InteractingSphere4SpheresContactGeometry);
@@ -638,10 +629,6 @@
 	//stiffnesscounter-&gt;sdecGroupMask = 2;
 	//stiffnesscounter-&gt;interval = timeStepUpdateInterval;
 	
-	shared_ptr&lt;GlobalStiffnessCounter&gt; globalStiffnessCounter(new GlobalStiffnessCounter);
-	//globalStiffnessCounter-&gt;sdecGroupMask = 2;
-	globalStiffnessCounter-&gt;interval = timeStepUpdateInterval;
-	
 	// moving walls to regulate the stress applied + compress when the packing is dense an stable
 	//cerr &lt;&lt; &quot;triaxialcompressionEngine = shared_ptr&lt;TriaxialCompressionEngine&gt; (new TriaxialCompressionEngine);&quot; &lt;&lt; std::endl;
 	triaxialcompressionEngine = shared_ptr&lt;TriaxialCompressionEngine&gt; (new TriaxialCompressionEngine);
@@ -693,7 +680,6 @@
 	rootBody-&gt;engines.push_back(triaxialcompressionEngine);
 	//rootBody-&gt;engines.push_back(stiffnesscounter);
 	//rootBody-&gt;engines.push_back(stiffnessMatrixTimeStepper);
-	rootBody-&gt;engines.push_back(globalStiffnessCounter);
 	rootBody-&gt;engines.push_back(globalStiffnessTimeStepper);
 	rootBody-&gt;engines.push_back(triaxialStateRecorder);
 	rootBody-&gt;engines.push_back(hydraulicForceEngine);//&lt;-------------HYDRAULIC ENGINE HERE
@@ -702,7 +688,6 @@
 	rootBody-&gt;engines.push_back(positionIntegrator);
 	if(!rotationBlocked)
 		rootBody-&gt;engines.push_back(orientationIntegrator);
-	//rootBody-&gt;engines.push_back(resultantforceEngine);
 	//rootBody-&gt;engines.push_back(triaxialstressController);
 	
 		
@@ -716,7 +701,6 @@
 	rootBody-&gt;engines.push_back(positionOrientationRecorder);}
 	
 	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
 	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 	
 }

Modified: trunk/pkg/dem/PreProcessor/DirectShearCis.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/DirectShearCis.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/PreProcessor/DirectShearCis.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -39,7 +39,6 @@
 #include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
@@ -59,7 +58,6 @@
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 #include &lt;boost/filesystem/convenience.hpp&gt;
 #include &lt;utility&gt;
@@ -313,9 +311,6 @@
 	shared_ptr&lt;CinemDNCEngine&gt; kinematic = shared_ptr&lt;CinemDNCEngine&gt;(new CinemDNCEngine);
 	kinematic-&gt;shearSpeed  = shearSpeed;
 
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
 	
 	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
 	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
@@ -375,7 +370,6 @@
 	rootBody-&gt;engines.push_back(possnap);
 	rootBody-&gt;engines.push_back(forcesnap);
 	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
 	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 }
 

Modified: trunk/pkg/dem/PreProcessor/Funnel.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/Funnel.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/PreProcessor/Funnel.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -26,7 +26,6 @@
 #include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
@@ -44,7 +43,6 @@
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 
 Funnel::Funnel () : FileGenerator()
@@ -265,9 +263,6 @@
 
 void Funnel::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
 {
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
 	
 	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
 	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
@@ -322,7 +317,6 @@
 		rootBody-&gt;engines.push_back(orientationIntegrator);
 	
 	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
 	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 }
 

Modified: trunk/pkg/dem/PreProcessor/HydraulicTest.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/HydraulicTest.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/PreProcessor/HydraulicTest.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -44,12 +44,10 @@
 #include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 #include&lt;yade/pkg-common/TranslationEngine.hpp&gt;
 

Modified: trunk/pkg/dem/PreProcessor/MembraneTest.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/MembraneTest.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/PreProcessor/MembraneTest.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -36,7 +36,6 @@
 #include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
@@ -56,7 +55,6 @@
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 #include&lt;yade/pkg-dem/SimpleViscoelasticBodyParameters.hpp&gt;
 
@@ -304,10 +302,6 @@
 
 void MembraneTest::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
 {
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-		
 	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
         interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere2BssSweptSphereLineSegment4SpheresContactGeometry&quot;);
 	
@@ -351,7 +345,6 @@
         rootBody-&gt;engines.push_back(orientationIntegrator);
 	
 	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
 	rootBody-&gt;initializers.push_back(interactingGeometryDispatcher);
 	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 }

Modified: trunk/pkg/dem/PreProcessor/ModifiedTriaxialTest.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/ModifiedTriaxialTest.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/PreProcessor/ModifiedTriaxialTest.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -16,7 +16,6 @@
 #include&lt;yade/pkg-dem/SimpleElasticRelationships.hpp&gt;
 #include&lt;yade/pkg-dem/BodyMacroParameters.hpp&gt;
 #include&lt;yade/pkg-dem/SDECLinkPhysics.hpp&gt;
-#include&lt;yade/pkg-dem/GlobalStiffnessCounter.hpp&gt;
 #include&lt;yade/pkg-dem/GlobalStiffnessTimeStepper.hpp&gt;
 #include&lt;yade/pkg-dem/PositionOrientationRecorder.hpp&gt;
 
@@ -40,7 +39,6 @@
 
 #include&lt;yade/pkg-common/GravityEngines.hpp&gt;
 #include&lt;yade/pkg-common/HydraulicForceEngine.hpp&gt;
-#include&lt;yade/pkg-common/MakeItFlat.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
 #include&lt;yade/pkg-common/CundallNonViscousDamping.hpp&gt;
@@ -53,14 +51,12 @@
 #include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
 #include&lt;yade/pkg-common/InteractionHashMap.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 #include &lt;boost/filesystem/convenience.hpp&gt;
 #include &lt;boost/lexical_cast.hpp&gt;
@@ -355,7 +351,6 @@
 		createBox(body,center,halfSize,wall_bottom_wire);
 	 	if(wall_bottom) {
 			rootBody-&gt;bodies-&gt;insert(body);
-			//(resultantforceEngine-&gt;subscribedBodies).push_back(body-&gt;getId());
 			triaxialcompressionEngine-&gt;wall_bottom_id = body-&gt;getId();
 			wallStressRecorder-&gt;wall_bottom_id = body-&gt;getId();
 			forcerec-&gt;startId = body-&gt;getId();
@@ -571,12 +566,6 @@
 	velocityRecorder-&gt; outputFile 	= velocityRecordFile;
 	velocityRecorder-&gt; interval 	= recordIntervalIter;
 
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	//physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;StiffnessMatrix&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;GlobalStiffness&quot;);
-	
 	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
 	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
 	interactionGeometryDispatcher-&gt;add(&quot;InteractingBox2InteractingSphere4SpheresContactGeometry&quot;);
@@ -631,9 +620,6 @@
 	//stiffnesscounter-&gt;sdecGroupMask = 2;
 	//stiffnesscounter-&gt;interval = timeStepUpdateInterval;
 	
-	shared_ptr&lt;GlobalStiffnessCounter&gt; globalStiffnessCounter(new GlobalStiffnessCounter);
-	globalStiffnessCounter-&gt;sdecGroupMask = 2;
-	globalStiffnessCounter-&gt;interval = timeStepUpdateInterval;
 	
 	// moving walls to regulate the stress applied + compress when the packing is dense an stable
 	//cerr &lt;&lt; &quot;triaxialcompressionEngine = shared_ptr&lt;TriaxialCompressionEngine&gt; (new TriaxialCompressionEngine);&quot; &lt;&lt; std::endl;
@@ -681,23 +667,15 @@
 	rootBody-&gt;engines.push_back(triaxialcompressionEngine);
 	//rootBody-&gt;engines.push_back(stiffnesscounter);
 	//rootBody-&gt;engines.push_back(stiffnessMatrixTimeStepper);
-	rootBody-&gt;engines.push_back(globalStiffnessCounter);
 	rootBody-&gt;engines.push_back(globalStiffnessTimeStepper);
 	rootBody-&gt;engines.push_back(wallStressRecorder);
 	rootBody-&gt;engines.push_back(gravityCondition);
 	// replaced by PhysicalParameters::blockedDOFs
-	#if 0
-		if(want_2d){
-	  		shared_ptr&lt;MakeItFlat&gt; makeItFlat(new MakeItFlat);
-			rootBody-&gt;engines.push_back(makeItFlat);
-		}
-	#endif
 	rootBody-&gt;engines.push_back(actionDampingDispatcher);
 	rootBody-&gt;engines.push_back(applyActionDispatcher);
 	rootBody-&gt;engines.push_back(positionIntegrator);
 	if(!rotationBlocked)
 		rootBody-&gt;engines.push_back(orientationIntegrator);
-	//rootBody-&gt;engines.push_back(resultantforceEngine);
 	//rootBody-&gt;engines.push_back(triaxialstressController);
 	
 		
@@ -711,7 +689,6 @@
 	rootBody-&gt;engines.push_back(positionOrientationRecorder);}
 	
 	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
 	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 	
 }

Modified: trunk/pkg/dem/PreProcessor/SDECImpactTest.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/SDECImpactTest.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/PreProcessor/SDECImpactTest.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -44,13 +44,11 @@
 #include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 
 #include &lt;boost/filesystem/convenience.hpp&gt;
@@ -464,9 +462,6 @@
 	velocityRecorder-&gt; outputFile 	= velocityRecordFile;
 	velocityRecorder-&gt; interval 	= recordIntervalIter;
 
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
 	
 	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
 	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
@@ -530,7 +525,6 @@
 	rootBody-&gt;engines.push_back(forcerec);
 	
 	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
 	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 	
 }

Modified: trunk/pkg/dem/PreProcessor/SDECLinkedSpheres.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/SDECLinkedSpheres.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/PreProcessor/SDECLinkedSpheres.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -48,12 +48,10 @@
 #include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 
 SDECLinkedSpheres::SDECLinkedSpheres () : FileGenerator()
@@ -313,10 +311,6 @@
 
 void SDECLinkedSpheres::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
 {
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	
 	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
 	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
 	interactionGeometryDispatcher-&gt;add(&quot;InteractingBox2InteractingSphere4SpheresContactGeometry&quot;);
@@ -378,7 +372,6 @@
 	rootBody-&gt;engines.push_back(orientationIntegrator);
 
 	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
 	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 }
 	

Modified: trunk/pkg/dem/PreProcessor/SDECMovingWall.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/SDECMovingWall.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/PreProcessor/SDECMovingWall.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -29,7 +29,6 @@
 #include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
@@ -49,7 +48,6 @@
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 
 SDECMovingWall::SDECMovingWall () : FileGenerator()
@@ -348,10 +346,6 @@
 
 void SDECMovingWall::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
 {
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	
 	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
 	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
 	interactionGeometryDispatcher-&gt;add(&quot;InteractingBox2InteractingSphere4SpheresContactGeometry&quot;);
@@ -417,7 +411,6 @@
 	rootBody-&gt;engines.push_back(kinematic);
 	
 	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
 	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 }
 

Modified: trunk/pkg/dem/PreProcessor/SDECSpheresPlane.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/SDECSpheresPlane.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/PreProcessor/SDECSpheresPlane.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -30,7 +30,6 @@
 #include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
@@ -48,7 +47,6 @@
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 
 SDECSpheresPlane::SDECSpheresPlane () : FileGenerator()
@@ -318,9 +316,6 @@
 
 void SDECSpheresPlane::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
 {
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
 	
 	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
 	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
@@ -379,7 +374,6 @@
 	//rootBody-&gt;engines.push_back(positionOrientationRecorder);
 
 	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
 	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 }
 

Modified: trunk/pkg/dem/PreProcessor/STLImporterTest.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/STLImporterTest.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/PreProcessor/STLImporterTest.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -26,10 +26,8 @@
 #include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
 #include&lt;yade/pkg-common/MetaInteractingGeometry2AABB.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
 #include&lt;yade/pkg-common/Sphere.hpp&gt;
 #include&lt;yade/pkg-dem/BodyMacroParameters.hpp&gt;
@@ -223,9 +221,6 @@
 
 void STLImporterTest::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
 {
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
 	
 	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
 	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
@@ -291,7 +286,6 @@
 	rootBody-&gt;engines.push_back(kinematic);
  	
 	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
 	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 }
 

Modified: trunk/pkg/dem/PreProcessor/SimpleShear.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/SimpleShear.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/PreProcessor/SimpleShear.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -18,7 +18,6 @@
 #include &lt;yade/pkg-dem/CohesiveFrictionalBodyParameters.hpp&gt;
 #include &lt;yade/pkg-dem/ContactLaw1.hpp&gt;
 #include &lt;yade/pkg-dem/CL1Relationships.hpp&gt;
-#include&lt;yade/pkg-dem/GlobalStiffnessCounter.hpp&gt;
 #include&lt;yade/pkg-dem/GlobalStiffnessTimeStepper.hpp&gt;
 #include &lt;yade/pkg-dem/PositionOrientationRecorder.hpp&gt;
 
@@ -39,7 +38,6 @@
 #include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 
 #include&lt;yade/pkg-dem/NewtonsDampedLaw.hpp&gt;
 #include&lt;yade/pkg-common/GravityEngines.hpp&gt;
@@ -55,7 +53,6 @@
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 #include &lt;boost/filesystem/convenience.hpp&gt;
 #include &lt;utility&gt;
@@ -306,10 +303,6 @@
 	shared_ptr&lt;CinemDNCEngine&gt; kinematic = shared_ptr&lt;CinemDNCEngine&gt;(new CinemDNCEngine);
 	kinematic-&gt;shearSpeed  = shearSpeed;
 
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;GlobalStiffness&quot;);
 	
 	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
 	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
@@ -333,14 +326,11 @@
 	globalStiffnessTimeStepper-&gt;timeStepUpdateInterval = timeStepUpdateInterval;
 	globalStiffnessTimeStepper-&gt;defaultDt=1e-5;
 
-	shared_ptr&lt;GlobalStiffnessCounter&gt; globalStiffnessCounter(new GlobalStiffnessCounter);
-	globalStiffnessCounter-&gt;interval = timeStepUpdateInterval;
 
 
 
 	rootBody-&gt;engines.clear();
 	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PhysicalActionContainerReseter));
-	rootBody-&gt;engines.push_back(globalStiffnessCounter);
 	rootBody-&gt;engines.push_back(globalStiffnessTimeStepper);
 	rootBody-&gt;engines.push_back(boundingVolumeDispatcher);	
 	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PersistentSAPCollider));
@@ -355,7 +345,6 @@
 // 	rootBody-&gt;engines.push_back(possnap);
 // 	rootBody-&gt;engines.push_back(forcesnap);
 	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
 	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 }
 

Modified: trunk/pkg/dem/PreProcessor/TestSimpleViscoelastic.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/TestSimpleViscoelastic.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/PreProcessor/TestSimpleViscoelastic.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -24,9 +24,7 @@
 #include&lt;yade/pkg-common/MetaInteractingGeometry2AABB.hpp&gt;
 #include&lt;yade/pkg-common/PersistentSAPCollider.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
 #include&lt;yade/pkg-common/Sphere.hpp&gt;
 #include&lt;yade/pkg-common/Box.hpp&gt;
@@ -162,9 +160,6 @@
 
 void TestSimpleViscoelastic::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
 {
-    shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-    physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-    physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
     
     shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
     interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
@@ -216,7 +211,6 @@
     rootBody-&gt;engines.push_back(interactionRecorder);
 
     rootBody-&gt;initializers.clear();
-    rootBody-&gt;initializers.push_back(physicalActionInitializer);
     rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 }
 

Modified: trunk/pkg/dem/PreProcessor/TetrahedronsTest.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/TetrahedronsTest.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/PreProcessor/TetrahedronsTest.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -29,7 +29,6 @@
 #include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
@@ -48,7 +47,6 @@
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 
 TetrahedronsTest::TetrahedronsTest () : FileGenerator()
@@ -300,13 +298,7 @@
 
 void TetrahedronsTest::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
 {
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
 
-	// all the strings here are just class names
-	// those class names in each class are registered with REGISTER_CLASS_NAME(SomeClass);
-	//
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
 	
 	shared_ptr&lt;InteractionPhysicsMetaEngine&gt; interactionPhysicsDispatcher(new InteractionPhysicsMetaEngine);
 	// so for this simple example I use  ElasticBodyParameters           : to store young modulus,
@@ -387,7 +379,6 @@
 		rootBody-&gt;engines.push_back(orientationIntegrator);
 	
 	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
 	rootBody-&gt;initializers.push_back(interactingGeometryDispatcher);
 	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 }

Modified: trunk/pkg/dem/PreProcessor/ThreePointBending.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/ThreePointBending.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/PreProcessor/ThreePointBending.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -46,12 +46,10 @@
 #include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 #include&lt;yade/pkg-common/TranslationEngine.hpp&gt;
 
@@ -297,9 +295,6 @@
 
 void ThreePointBending::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
 {
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
 	
 	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
 	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
@@ -364,7 +359,6 @@
 	rootBody-&gt;engines.push_back(kinematic);
 
 	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
 	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 }
 	

Modified: trunk/pkg/dem/PreProcessor/TriaxialTest.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/TriaxialTest.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/PreProcessor/TriaxialTest.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -19,10 +19,8 @@
 #include&lt;yade/pkg-dem/SimpleElasticRelationships.hpp&gt;
 #include&lt;yade/pkg-dem/BodyMacroParameters.hpp&gt;
 #include&lt;yade/pkg-dem/SDECLinkPhysics.hpp&gt;
-#include&lt;yade/pkg-dem/GlobalStiffnessCounter.hpp&gt;
 #include&lt;yade/pkg-dem/GlobalStiffnessTimeStepper.hpp&gt;
 #include&lt;yade/pkg-dem/PositionOrientationRecorder.hpp&gt;
-#include&lt;yade/pkg-dem/MakeItFlat.hpp&gt;
 
 #include&lt;yade/pkg-dem/AveragePositionRecorder.hpp&gt;
 //#include&lt;yade/pkg-dem/ForceRecorder.hpp&gt;
@@ -56,13 +54,11 @@
 #include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 #include&lt;yade/pkg-common/InteractionDispatchers.hpp&gt;
 
@@ -166,9 +162,7 @@
 	isotropicCompaction=false;
 	fixedPorosity = 1;
 	
-	#ifdef BEX_CONTAINER
-		parallel=false;
-	#endif
+	parallel=false;
 
 	
 	
@@ -239,9 +233,7 @@
 	REGISTER_ATTRIBUTE(isotropicCompaction);
 	REGISTER_ATTRIBUTE(fixedPorosity);
 	REGISTER_ATTRIBUTE(fixedBoxDims);
-	#ifdef BEX_CONTAINER
-		REGISTER_ATTRIBUTE(parallel);
-	#endif
+	REGISTER_ATTRIBUTE(parallel);
 }
 
 
@@ -313,7 +305,6 @@
 		createBox(body,center,halfSize,wall_bottom_wire);
 	 	if(wall_bottom) {
 			rootBody-&gt;bodies-&gt;insert(body);
-			//(resultantforceEngine-&gt;subscribedBodies).push_back(body-&gt;getId());
 			triaxialcompressionEngine-&gt;wall_bottom_id = body-&gt;getId();
 			//triaxialStateRecorder-&gt;wall_bottom_id = body-&gt;getId();
 			}
@@ -522,11 +513,6 @@
 
 void TriaxialTest::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
 {
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	//physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;StiffnessMatrix&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;GlobalStiffness&quot;);
 	
 	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
 	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
@@ -543,13 +529,11 @@
 	boundingVolumeDispatcher-&gt;add(&quot;InteractingSphere2AABB&quot;);
 	boundingVolumeDispatcher-&gt;add(&quot;InteractingBox2AABB&quot;);
 	boundingVolumeDispatcher-&gt;add(&quot;MetaInteractingGeometry2AABB&quot;);
-
-	
-
 		
 	shared_ptr&lt;GravityEngine&gt; gravityCondition(new GravityEngine);
 	gravityCondition-&gt;gravity = gravity;
 	
+#if 0
 	shared_ptr&lt;CundallNonViscousForceDamping&gt; actionForceDamping(new CundallNonViscousForceDamping);
 	actionForceDamping-&gt;damping = dampingForce;
 	shared_ptr&lt;CundallNonViscousMomentumDamping&gt; actionMomentumDamping(new CundallNonViscousMomentumDamping);
@@ -561,37 +545,21 @@
 	shared_ptr&lt;PhysicalActionApplier&gt; applyActionDispatcher(new PhysicalActionApplier);
 	applyActionDispatcher-&gt;add(&quot;NewtonsForceLaw&quot;);
 	applyActionDispatcher-&gt;add(&quot;NewtonsMomentumLaw&quot;);
-		
 	shared_ptr&lt;PhysicalParametersMetaEngine&gt; positionIntegrator(new PhysicalParametersMetaEngine);
 	positionIntegrator-&gt;add(&quot;LeapFrogPositionIntegrator&quot;);
 	shared_ptr&lt;PhysicalParametersMetaEngine&gt; orientationIntegrator(new PhysicalParametersMetaEngine);
 	orientationIntegrator-&gt;add(&quot;LeapFrogOrientationIntegrator&quot;);
+#endif	
 
-	//shared_ptr&lt;ElasticCriterionTimeStepper&gt; sdecTimeStepper(new ElasticCriterionTimeStepper);
-	//sdecTimeStepper-&gt;sdecGroupMask = 2;
-	//sdecTimeStepper-&gt;timeStepUpdateInterval = timeStepUpdateInterval;
-	
-	//shared_ptr&lt;StiffnessMatrixTimeStepper&gt; stiffnessMatrixTimeStepper(new StiffnessMatrixTimeStepper);
-	//stiffnessMatrixTimeStepper-&gt;sdecGroupMask = 2;
-	//stiffnessMatrixTimeStepper-&gt;timeStepUpdateInterval = timeStepUpdateInterval;
-	
 	globalStiffnessTimeStepper=shared_ptr&lt;GlobalStiffnessTimeStepper&gt;(new GlobalStiffnessTimeStepper);
 	globalStiffnessTimeStepper-&gt;sdecGroupMask = 2;
 	globalStiffnessTimeStepper-&gt;timeStepUpdateInterval = timeStepUpdateInterval;
 	globalStiffnessTimeStepper-&gt;defaultDt = defaultDt;
 	
-	shared_ptr&lt;ElasticContactLaw&gt; elasticContactLaw(new ElasticContactLaw);
-	elasticContactLaw-&gt;sdecGroupMask = 2;
-
-	
 	//shared_ptr&lt;StiffnessCounter&gt; stiffnesscounter(new StiffnessCounter);
 	//stiffnesscounter-&gt;sdecGroupMask = 2;
 	//stiffnesscounter-&gt;interval = timeStepUpdateInterval;
 	
-	shared_ptr&lt;GlobalStiffnessCounter&gt; globalStiffnessCounter(new GlobalStiffnessCounter);
-	// globalStiffnessCounter-&gt;sdecGroupMask = 2;
-	globalStiffnessCounter-&gt;interval = timeStepUpdateInterval;
-	
 	// moving walls to regulate the stress applied + compress when the packing is dense an stable
 	//cerr &lt;&lt; &quot;triaxialcompressionEngine = shared_ptr&lt;TriaxialCompressionEngine&gt; (new TriaxialCompressionEngine);&quot; &lt;&lt; std::endl;
 	triaxialcompressionEngine = shared_ptr&lt;TriaxialCompressionEngine&gt; (new TriaxialCompressionEngine);
@@ -615,8 +583,6 @@
 	triaxialcompressionEngine-&gt;isotropicCompaction = isotropicCompaction;
 	
 	
-
-	
 	// recording global stress
 	if(recordIntervalIter&gt;0){
 		triaxialStateRecorder = shared_ptr&lt;TriaxialStateRecorder&gt;(new TriaxialStateRecorder);
@@ -642,64 +608,40 @@
 	
 	rootBody-&gt;engines.clear();
 	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PhysicalActionContainerReseter));
-//	rootBody-&gt;engines.push_back(sdecTimeStepper);	
 	rootBody-&gt;engines.push_back(boundingVolumeDispatcher);
 	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PersistentSAPCollider));
-	#ifdef BEX_CONTAINER
 	if(parallel){
-		#if 1
-			shared_ptr&lt;InteractionDispatchers&gt; ids(new InteractionDispatchers);
-				ids-&gt;geomDispatcher=interactionGeometryDispatcher;
-				ids-&gt;physDispatcher=interactionPhysicsDispatcher;
-				ids-&gt;constLawDispatcher=shared_ptr&lt;ConstitutiveLawDispatcher&gt;(new ConstitutiveLawDispatcher);
-				shared_ptr&lt;ef2_Spheres_Elastic_ElasticLaw&gt; see(new ef2_Spheres_Elastic_ElasticLaw);
-					see-&gt;sdecGroupMask=elasticContactLaw-&gt;sdecGroupMask;
-				ids-&gt;constLawDispatcher-&gt;add(see);
-			rootBody-&gt;engines.push_back(ids);
-		#else
-			rootBody-&gt;engines.push_back(interactionGeometryDispatcher);
-			rootBody-&gt;engines.push_back(interactionPhysicsDispatcher);
-			shared_ptr&lt;ConstitutiveLawDispatcher&gt; cld(new ConstitutiveLawDispatcher);
-				shared_ptr&lt;ef2_Spheres_Elastic_ElasticLaw&gt; see(new ef2_Spheres_Elastic_ElasticLaw);
-					see-&gt;sdecGroupMask=elasticContactLaw-&gt;sdecGroupMask;
-				cld-&gt;add(see);
-			rootBody-&gt;engines.push_back(cld);
-		#endif
+		shared_ptr&lt;InteractionDispatchers&gt; ids(new InteractionDispatchers);
+			ids-&gt;geomDispatcher=interactionGeometryDispatcher;
+			ids-&gt;physDispatcher=interactionPhysicsDispatcher;
+			ids-&gt;constLawDispatcher=shared_ptr&lt;ConstitutiveLawDispatcher&gt;(new ConstitutiveLawDispatcher);
+			shared_ptr&lt;ef2_Spheres_Elastic_ElasticLaw&gt; see(new ef2_Spheres_Elastic_ElasticLaw);
+				see-&gt;sdecGroupMask=2;
+			ids-&gt;constLawDispatcher-&gt;add(see);
+		rootBody-&gt;engines.push_back(ids);
 	} else {
-	#endif
 		rootBody-&gt;engines.push_back(interactionGeometryDispatcher);
 		rootBody-&gt;engines.push_back(interactionPhysicsDispatcher);
+		shared_ptr&lt;ElasticContactLaw&gt; elasticContactLaw(new ElasticContactLaw);
+		elasticContactLaw-&gt;sdecGroupMask = 2;
 		rootBody-&gt;engines.push_back(elasticContactLaw);
-	#ifdef BEX_CONTAINER
 	}
-	#endif
 	
 	//rootBody-&gt;engines.push_back(stiffnesscounter);
 	//rootBody-&gt;engines.push_back(stiffnessMatrixTimeStepper);
-	rootBody-&gt;engines.push_back(globalStiffnessCounter);
 	rootBody-&gt;engines.push_back(globalStiffnessTimeStepper);
 	rootBody-&gt;engines.push_back(triaxialcompressionEngine);
 	if(recordIntervalIter&gt;0) rootBody-&gt;engines.push_back(triaxialStateRecorder);
 	//rootBody-&gt;engines.push_back(gravityCondition);
 	
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt; (new NewtonsDampedLaw));
+	shared_ptr&lt;NewtonsDampedLaw&gt; newton(new NewtonsDampedLaw);
+	newton-&gt;damping=dampingMomentum;
+	rootBody-&gt;engines.push_back(newton);
 	
 	//if (0) rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new MicroMacroAnalyser));
 	
-	// replaced by PhysicalParameters::blockedDOFs
-	#if 0
-		if(biaxial2dTest){
-			shared_ptr&lt;MakeItFlat&gt; makeItFlat(new MakeItFlat);
-			makeItFlat-&gt;direction=2;
-			makeItFlat-&gt;plane_position = (lowerCorner[2]+upperCorner[2])*0.5;
-			makeItFlat-&gt;reset_force = false;	
-			rootBody-&gt;engines.push_back(makeItFlat);
-		}
-	#endif
-	
 	//if(!rotationBlocked)
 	//	rootBody-&gt;engines.push_back(orientationIntegrator);
-	//rootBody-&gt;engines.push_back(resultantforceEngine);
 	//rootBody-&gt;engines.push_back(triaxialstressController);
 	
 		
@@ -710,7 +652,6 @@
 	}
 	
 	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
 	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 	
 }

Modified: trunk/pkg/dem/PreProcessor/TriaxialTest.hpp
===================================================================
--- trunk/pkg/dem/PreProcessor/TriaxialTest.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/PreProcessor/TriaxialTest.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -37,7 +37,7 @@
 		
 	2/ The class TriaxialStateRecorder is used to write to a file the history of stresses and strains.
 	
-	3/ TriaxialTest is currently using a group of classes including GlobalStiffness (data), GlobalStiffnessCounter (updater) and GlobalStiffnessTimeStepper to compute an appropriate dt for the numerical scheme. The TriaxialTest is the only preprocessor using these classes in Yade because they have been developped AFTER most of preprocessor examples, BUT they can be used in principle in any situation and they have nothing specifically related to the triaxial test.
+	3/ TriaxialTest is currently using GlobalStiffnessTimeStepper to compute an appropriate dt for the numerical scheme. The TriaxialTest is the only preprocessor using these classes in Yade because they have been developped AFTER most of preprocessor examples, BUT they can be used in principle in any situation and they have nothing specifically related to the triaxial test.
 	
 	@note TriaxialStressController::ComputeUnbalancedForce(...) returns a value that can be usefull for evaluating the stability of the packing. It is defined as (mean force on particles)/(mean contact force), so that it tends to 0 in a stable packing. This parameter is checked by TriaxialCompressionEngine to switch from one stage of the simulation to the next one (e.g. stop isotropic confinment and start axial loading)
 	
@@ -106,10 +106,8 @@
 				//!flag to choose an isotropic compaction until a fixed porosity choosing a same translation speed for the six walls
 				,isotropicCompaction;
 
-		#ifdef BEX_CONTAINER
-			//! Generate parallel simulation, if it is supported
-			bool parallel;
-		#endif
+				//! Generate parallel simulation
+				bool parallel;
 
 		int		 recordIntervalIter
 				,timeStepUpdateInterval

Modified: trunk/pkg/dem/PreProcessor/TriaxialTestWater.cpp
===================================================================
--- trunk/pkg/dem/PreProcessor/TriaxialTestWater.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/PreProcessor/TriaxialTestWater.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -22,7 +22,6 @@
 #include&lt;yade/pkg-dem/BodyMacroParameters.hpp&gt;
 #include&lt;yade/pkg-dem/SDECLinkPhysics.hpp&gt;
 
-#include&lt;yade/pkg-dem/GlobalStiffnessCounter.hpp&gt;
 #include&lt;yade/pkg-dem/GlobalStiffnessTimeStepper.hpp&gt;
 
 #include&lt;yade/pkg-dem/PositionOrientationRecorder.hpp&gt;
@@ -60,14 +59,12 @@
 #include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
 #include&lt;yade/pkg-common/InteractionHashMap.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 #include&lt;yade/extra/Shop.hpp&gt;
 
@@ -297,7 +294,6 @@
 		createBox(body,center,halfSize,wall_bottom_wire);
 	 	if(wall_bottom) {
 			rootBody-&gt;bodies-&gt;insert(body);
-			//(resultantforceEngine-&gt;subscribedBodies).push_back(body-&gt;getId());
 			triaxialcompressionEngine-&gt;wall_bottom_id = body-&gt;getId();
 			//triaxialStateRecorder-&gt;wall_bottom_id = body-&gt;getId();
 			}
@@ -514,11 +510,6 @@
 
 void TriaxialTestWater::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
 {
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	//physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;StiffnessMatrix&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;GlobalStiffness&quot;);
 	
 	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
 	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
@@ -586,9 +577,6 @@
 	//stiffnesscounter-&gt;sdecGroupMask = 2;
 	//stiffnesscounter-&gt;interval = timeStepUpdateInterval;
 	
-	shared_ptr&lt;GlobalStiffnessCounter&gt; globalStiffnessCounter(new GlobalStiffnessCounter);
-	// globalStiffnessCounter-&gt;sdecGroupMask = 2;
-	globalStiffnessCounter-&gt;interval = timeStepUpdateInterval;
 	
 	// moving walls to regulate the stress applied + compress when the packing is dense an stable
 	//cerr &lt;&lt; &quot;triaxialcompressionEngine = shared_ptr&lt;TriaxialCompressionEngine&gt; (new TriaxialCompressionEngine);&quot; &lt;&lt; std::endl;
@@ -663,7 +651,6 @@
 	
 	//rootBody-&gt;engines.push_back(stiffnesscounter);
 	//rootBody-&gt;engines.push_back(stiffnessMatrixTimeStepper);
-	rootBody-&gt;engines.push_back(globalStiffnessCounter);
 	rootBody-&gt;engines.push_back(globalStiffnessTimeStepper);
 	if(water)
 	{
@@ -679,7 +666,6 @@
 	
 	//if(!rotationBlocked)
 	//	rootBody-&gt;engines.push_back(orientationIntegrator);
-	//rootBody-&gt;engines.push_back(resultantforceEngine);
 	//rootBody-&gt;engines.push_back(triaxialstressController);
 	
 		
@@ -689,7 +675,6 @@
 	rootBody-&gt;engines.push_back(positionOrientationRecorder);}
 	
 	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
 	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 	
 }

Modified: trunk/pkg/dem/PreProcessor/TriaxialTestWater.hpp
===================================================================
--- trunk/pkg/dem/PreProcessor/TriaxialTestWater.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/PreProcessor/TriaxialTestWater.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -38,7 +38,7 @@
 		
 	2/ The class TriaxialStateRecorder is used to write to a file the history of stresses and strains.
 	
-	3/ TriaxialTestWater is currently using a group of classes including GlobalStiffness (data), GlobalStiffnessCounter (updater) and GlobalStiffnessTimeStepper to compute an appropriate dt for the numerical scheme. The TriaxialTestWater is the only preprocessor using these classes in Yade because they have been developped AFTER most of preprocessor examples, BUT they can be used in principle in any situation and they have nothing specifically related to the triaxial test.
+	3/ TriaxialTestWater is currently using GlobalStiffnessTimeStepper to compute an appropriate dt for the numerical scheme. The TriaxialTestWater is the only preprocessor using these classes in Yade because they have been developped AFTER most of preprocessor examples, BUT they can be used in principle in any situation and they have nothing specifically related to the triaxial test.
 	
 	@note TriaxialStressController::ComputeUnbalancedForce(...) returns a value that can be usefull for evaluating the stability of the packing. It is defined as (mean force on particles)/(mean contact force), so that it tends to 0 in a stable packing. This parameter is checked by TriaxialCompressionEngine to switch from one stage of the simulation to the next one (e.g. stop isotropic confinment and start axial loading)
 	

Modified: trunk/pkg/dem/SConscript
===================================================================
--- trunk/pkg/dem/SConscript	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/dem/SConscript	2009-03-30 17:10:27 UTC (rev 1738)
@@ -18,8 +18,6 @@
 				'yade-base',
 				'GLDrawInteractingSphere',
 				'yade-multimethods',
-				'Force',
-				'Momentum',
 				'Sphere',
 				'RigidBodyParameters',
 				'InteractingSphere',
@@ -85,10 +83,6 @@
 		['DataClass/InteractionPhysics/SDECLinkPhysics.cpp'],
 		LIBS=env['LIBS']+['NormalShearInteractions']),
 
-	env.SharedLibrary('GlobalStiffness',
-		['DataClass/PhysicalAction/GlobalStiffness.cpp'],
-		LIBS=env['LIBS']+['yade-base']),
-
 	env.SharedLibrary('MacroMicroElasticRelationships',
 		['Engine/EngineUnit/MacroMicroElasticRelationships.cpp'],
 		LIBS=env['LIBS']+['SDECLinkPhysics',
@@ -194,8 +188,6 @@
 			'BodyMacroParameters',
 			'yade-base',
 			'yade-multimethods',
-			'Force',
-			'Momentum',
 			'Sphere',
 			'RigidBodyParameters']),
 			
@@ -232,8 +224,6 @@
 			'yade-base',
 			'GLDrawInteractingSphere',
 			'yade-multimethods',
-			'Force',
-			'Momentum',
 			'Sphere',
 			'RigidBodyParameters']),
 	
@@ -249,8 +239,6 @@
 			'yade-base',
 			
 			'yade-multimethods',
-			'Force',
-			'Momentum',
 			'Sphere',
 			'RigidBodyParameters']),
 
@@ -262,8 +250,6 @@
 			'yade-serialization',
 			'yade-base',
 			'yade-multimethods',
-			'Force',
-			'Momentum',
 			'Sphere',
 			'RigidBodyParameters']),
 
@@ -284,7 +270,7 @@
 
 	env.SharedLibrary('ForceRecorder',
 		['Engine/StandAloneEngine/ForceRecorder.cpp'],
-		LIBS=env['LIBS']+['RigidBodyParameters', 'Force']),
+		LIBS=env['LIBS']+['RigidBodyParameters']),
 
 	env.SharedLibrary('PositionOrientationRecorder',
 		['Engine/StandAloneEngine/PositionOrientationRecorder.cpp'],
@@ -307,22 +293,6 @@
 		['Engine/StandAloneEngine/VelocityRecorder.cpp'],
 		LIBS=env['LIBS']+['ParticleParameters']),
 
-	env.SharedLibrary('GlobalStiffnessCounter',
-		['Engine/StandAloneEngine/GlobalStiffnessCounter.cpp'],
-		LIBS=env['LIBS']+['SDECLinkPhysics',
-			'ElasticContactInteraction',
-			'SDECLinkGeometry',
-			'SpheresContactGeometry',
-			'BodyMacroParameters',
-			'yade-serialization',
-			'yade-base',		
-			'yade-multimethods',
-			'Force',
-			'Momentum',
-			'Sphere',
-			'RigidBodyParameters',
-			'GlobalStiffness' ]),
-
 	env.SharedLibrary('GlobalStiffnessTimeStepper',
 		['Engine/StandAloneEngine/GlobalStiffnessTimeStepper.cpp'],
 		LIBS=env['LIBS']+['yade-base',
@@ -331,25 +301,16 @@
 			'SpheresContactGeometry',
 			'MacroMicroElasticRelationships',
 			'Sphere',
-			'GlobalStiffness']),
+			]),
 
 	env.SharedLibrary('GeometricalModelForceColorizer',
 		['Engine/StandAloneEngine/GeometricalModelForceColorizer.cpp'],
-		LIBS=env['LIBS']+['RigidBodyParameters', 'Force']),
+		LIBS=env['LIBS']+['RigidBodyParameters',]),
 
-	env.SharedLibrary('ResultantForceEngine',
-		['Engine/DeusExMachina/ResultantForceEngine.cpp'],
-		LIBS=env['LIBS']+[
-			'yade-base',		
-			'Force',
-			'ParticleParameters',
-			'GlobalStiffness']),
-
 	env.SharedLibrary('TriaxialStressController',
 		['Engine/DeusExMachina/TriaxialStressController.cpp'],
 		LIBS=env['LIBS']+[
 			'yade-base',
-			'Force',
 			'ParticleParameters',
 			'RigidBodyParameters',
 			'ElasticContactInteraction',
@@ -362,7 +323,6 @@
 		['Engine/DeusExMachina/TriaxialCompressionEngine.cpp'],
 		LIBS=env['LIBS']+[
 			'yade-base',
-			'Force',
 			'ParticleParameters',
 			'ElasticContactInteraction',
 			'TriaxialStressController',
@@ -411,8 +371,6 @@
 			'GravityEngines',
 			'yade-serialization',
 			'yade-base',
-			
-			'PhysicalActionContainerInitializer',
 			'PhysicalActionContainerReseter',
 			'InteractionGeometryMetaEngine',
 			'InteractionPhysicsMetaEngine',
@@ -444,7 +402,6 @@
 			'MetaInteractingGeometry',
 			'GravityEngines',
 			'yade-serialization',
-			'PhysicalActionContainerInitializer',
 			'PhysicalActionContainerReseter',
 			'InteractionGeometryMetaEngine',
 			'InteractionPhysicsMetaEngine',
@@ -480,7 +437,6 @@
 			'CinemDNCEngine',
 			'yade-serialization',
 			'yade-base',
-			'PhysicalActionContainerInitializer',
 			'PhysicalActionContainerReseter',
 			'InteractionGeometryMetaEngine',
 			'InteractionPhysicsMetaEngine',
@@ -502,8 +458,6 @@
 			'CohesiveFrictionalBodyParameters',
 			'ContactLaw1',
 			'CL1Relationships',
-			'GlobalStiffness',
-			'GlobalStiffnessCounter',
 			'GlobalStiffnessTimeStepper',
 			'PositionOrientationRecorder',
 			'PositionRecorder',
@@ -518,7 +472,6 @@
 			'CinemDNCEngine',
 			'yade-serialization',
 			'yade-base',
-			'PhysicalActionContainerInitializer',
 			'PhysicalActionContainerReseter',
 			'InteractionGeometryMetaEngine',
 			'InteractionPhysicsMetaEngine',
@@ -551,7 +504,6 @@
 			'SpheresContactGeometry',
 			'yade-base',
 			
-			'PhysicalActionContainerInitializer',
 			'PhysicalActionContainerReseter',
 			'InteractionGeometryMetaEngine',
 			'InteractionPhysicsMetaEngine',
@@ -581,7 +533,6 @@
 			'GravityEngines',
 			'yade-serialization',
 			'yade-base',
-			'PhysicalActionContainerInitializer',
 			'PhysicalActionContainerReseter',
 			'InteractionGeometryMetaEngine',
 			'InteractionPhysicsMetaEngine',
@@ -612,7 +563,6 @@
 			'TranslationEngine',
 			'yade-serialization',
 			'yade-base',
-			'PhysicalActionContainerInitializer',
 			'PhysicalActionContainerReseter',
 			'InteractionGeometryMetaEngine',
 			'InteractionPhysicsMetaEngine',
@@ -639,7 +589,6 @@
 			'CundallNonViscousDamping',
 			'MetaInteractingGeometry',
 			'GravityEngines',
-			'PhysicalActionContainerInitializer',
 			'PhysicalActionContainerReseter',
 			'InteractionGeometryMetaEngine',
 			'InteractingGeometryMetaEngine',
@@ -677,7 +626,6 @@
                         'CundallNonViscousDamping',
                         'MetaInteractingGeometry',
                         'GravityEngines',
-                        'PhysicalActionContainerInitializer',
                         'PhysicalActionContainerReseter',
                         'InteractionGeometryMetaEngine',
                         'InteractingGeometryMetaEngine',
@@ -706,14 +654,12 @@
 #			'MicroMacroAnalyser',
 			'SimpleElasticRelationships',
 			'ElasticCriterionTimeStepper',
-			'MakeItFlat',
 			'InteractingSphere',
 			'InteractingBox',
 			'NewtonsDampedLaw',
 			'MetaInteractingGeometry',
 			'GravityEngines',
 			'yade-serialization',
-			'PhysicalActionContainerInitializer',
 			'PhysicalActionContainerReseter',
 			'InteractionGeometryMetaEngine',
 			'InteractionPhysicsMetaEngine',
@@ -726,9 +672,6 @@
 			'AABB',
 			'PersistentSAPCollider',
 			'MetaInteractingGeometry2AABB',
-			'GlobalStiffness',
-			'GlobalStiffnessCounter',
-			'ResultantForceEngine',
 			'TriaxialStressController',
 			'TriaxialCompressionEngine',
 			'GlobalStiffnessTimeStepper',
@@ -758,7 +701,6 @@
 			'MetaInteractingGeometry',
 			'GravityEngines',
 			'yade-serialization',
-			'PhysicalActionContainerInitializer',
 			'PhysicalActionContainerReseter',
 			'InteractionGeometryMetaEngine',
 			'InteractionPhysicsMetaEngine',
@@ -771,9 +713,6 @@
 			'AABB',
 			'DistantPersistentSAPCollider',
 			'MetaInteractingGeometry2AABB',
-			'GlobalStiffness',
-			'GlobalStiffnessCounter',
-			'ResultantForceEngine',
 			'TriaxialStressController',
 			'TriaxialCompressionEngine',
 			'GlobalStiffnessTimeStepper',
@@ -800,7 +739,6 @@
 			'yade-base',
 			'Shop',
 			
-			'PhysicalActionContainerInitializer',
 			'PhysicalActionContainerReseter',
 			'InteractionGeometryMetaEngine',
 			'InteractionPhysicsMetaEngine',
@@ -823,7 +761,6 @@
 			'ElasticContactInteraction',
 			'SpheresContactGeometry',
 			'BodyMacroParameters',
-			'Force',
 			'TriaxialStressController',
 			'TriaxialCompressionEngine',
 			'Sphere',
@@ -845,7 +782,6 @@
 			'CapillaryParameters',
 			'TriaxialStressController',
 			'TriaxialCompressionEngine',
-			'Force',
 			'CapillaryCohesiveLaw']),
 
 env.SharedLibrary('TriaxialTestWater',
@@ -870,7 +806,6 @@
         MetaInteractingGeometry
         GravityEngines
         yade-serialization
-        PhysicalActionContainerInitializer
         PhysicalActionContainerReseter
         InteractionGeometryMetaEngine
         InteractionPhysicsMetaEngine
@@ -883,9 +818,6 @@
         AABB
         PersistentSAPCollider
         MetaInteractingGeometry2AABB
-	GlobalStiffness
-	GlobalStiffnessCounter
-	ResultantForceEngine
 	TriaxialStressController
 	MacroMicroElasticRelationshipsWater
 	TriaxialCompressionEngine
@@ -897,7 +829,6 @@
 			'ElasticContactInteraction',
 			'SpheresContactGeometry',
 			'BodyMacroParameters',
-			'Force',
 			'TriaxialStressController',
 			'TriaxialCompressionEngine',
 			'Sphere',
@@ -910,8 +841,6 @@
 			'ElasticContactInteraction',
 			'SpheresContactGeometry',
 			'BodyMacroParameters',
-			'Force',
-			'Momentum',
 			'RigidBodyParameters',
 			'Sphere',
 			'ElasticContactLaw']),
@@ -951,20 +880,12 @@
 		
 env.SharedLibrary('HydraulicForceEngine',
 		['Engine/DeusExMachina/HydraulicForceEngine.cpp'],
-		LIBS=env['LIBS']+['yade-base',  'Force', 'Momentum', 'ParticleParameters', 'CohesiveFrictionalBodyParameters', 'TriaxialCompressionEngine', 'GravityEngines'],
+		LIBS=env['LIBS']+['yade-base',   'ParticleParameters', 'CohesiveFrictionalBodyParameters', 'TriaxialCompressionEngine', 'GravityEngines'],
 		CPPPATH=env['CPPPATH']+['Engine/DeusExMachina',
 			'DataClass/PhysicalAction',
 			'$PREFIX/include',
 			'DataClass/PhysicalParameters']),
 			
-env.SharedLibrary('MakeItFlat',
-		['Engine/DeusExMachina/MakeItFlat.cpp'],
-		LIBS=env['LIBS']+['yade-base',  'Force', 'ParticleParameters'],
-		CPPPATH=env['CPPPATH']+['Engine/DeusExMachina',
-			'DataClass/PhysicalAction',
-			'$PREFIX/include',
-			'DataClass/PhysicalParameters']),
-			
 env.SharedLibrary('StaticSpheresAttractionEngine',
 		['Engine/DeusExMachina/StaticSpheresAttractionEngine.cpp'],
 		LIBS=env['LIBS']+['yade-base',  'Sphere', 'StaticAttractionEngine', 'ElasticContactInteraction'],
@@ -988,7 +909,6 @@
 			'MetaInteractingGeometry',
 			'GravityEngines',
 			'yade-serialization',
-			'PhysicalActionContainerInitializer',
 			'PhysicalActionContainerReseter',
 			'InteractionGeometryMetaEngine',
 			'InteractionPhysicsMetaEngine',
@@ -1001,9 +921,6 @@
 			'AABB',
 			'DistantPersistentSAPCollider',
 			'MetaInteractingGeometry2AABB',
-			'GlobalStiffness',
-			'GlobalStiffnessCounter',
-			'ResultantForceEngine',
 			'TriaxialStressController',
 			'TriaxialCompressionEngine',
 			'GlobalStiffnessTimeStepper',
@@ -1011,7 +928,6 @@
 			'TriaxialStateRecorder',
 			'PositionOrientationRecorder',
 			'HydraulicForceEngine',
-			'MakeItFlat',
 			'TranslationEngine',]),
 
 
@@ -1020,8 +936,6 @@
 		LIBS=env['LIBS']+['yade-serialization',
 			'yade-base',		
 			'yade-multimethods',
-			'Force',
-			'Momentum',
 			'RigidBodyParameters'
 			 ]),
 
@@ -1054,8 +968,6 @@
 			'yade-serialization',
 			'yade-base',
 			'yade-multimethods',
-			'Force',
-			'Momentum',
 			'Sphere',
 			'RigidBodyParameters'])
 
@@ -1091,7 +1003,6 @@
 			    ,'ParticleParameters'
 			    ,'RigidBodyRecorder'
 			    ,'PhysicalActionApplier'
-			    ,'PhysicalActionContainerInitializer'
 			    ,'PhysicalActionContainerReseter'
 			    ,'PhysicalParametersMetaEngine'
 			    ,'PersistentSAPCollider'
@@ -1118,7 +1029,6 @@
 				,'MetaInteractingGeometry2AABB'
 				,'ParticleParameters'
 				,'PhysicalActionApplier'
-				,'PhysicalActionContainerInitializer'
 				,'PhysicalActionContainerReseter'
 				,'PhysicalParametersMetaEngine'
 				,'SpatialQuickSortCollider'
@@ -1145,8 +1055,6 @@
 			#'yade-base',
 			#'GLDrawInteractingSphere',
 			#'yade-multimethods',
-			#'Force',
-			#'Momentum',
 			#'Sphere',
 			#'RigidBodyParameters',
 			#'InteractingSphere',

Modified: trunk/pkg/fem/Engine/StandAloneEngine/FEMLaw.cpp
===================================================================
--- trunk/pkg/fem/Engine/StandAloneEngine/FEMLaw.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/fem/Engine/StandAloneEngine/FEMLaw.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -10,7 +10,6 @@
 #include &quot;FEMLaw.hpp&quot;
 #include&lt;yade/pkg-fem/FEMTetrahedronData.hpp&gt;
 #include&lt;yade/pkg-fem/FEMNodeData.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
 #include &lt;boost/numeric/ublas/matrix.hpp&gt;
 #include &lt;boost/numeric/ublas/vector.hpp&gt;
 #include &lt;boost/numeric/ublas/io.hpp&gt;
@@ -18,7 +17,7 @@
 using namespace boost::numeric;
 
 
-FEMLaw::FEMLaw() : InteractionSolver() , actionForce(new Force)
+FEMLaw::FEMLaw() : InteractionSolver()
 {
 	nodeGroupMask = 1;
 	tetrahedronGroupMask = 2;
@@ -75,11 +74,7 @@
 			Vector3r force = Vector3r(	  fe( i*3     , 0 )
 							, fe( i*3 + 1 , 0 )
 							, fe( i*3 + 2 , 0 ));
-			#ifdef BEX_CONTAINER
-				fem-&gt;bex.addForce(femTet-&gt;ids[i],force);
-			#else
-				static_cast&lt;Force*&gt;(fem-&gt;physicalActions-&gt;find( femTet-&gt;ids[i] , actionForce -&gt;getClassIndex() ).get() )-&gt;force  += force;
-			#endif
+			fem-&gt;bex.addForce(femTet-&gt;ids[i],force);
 					
 		}
 	}

Modified: trunk/pkg/fem/Engine/StandAloneEngine/FEMLaw.hpp
===================================================================
--- trunk/pkg/fem/Engine/StandAloneEngine/FEMLaw.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/fem/Engine/StandAloneEngine/FEMLaw.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -10,13 +10,9 @@
 
 #include&lt;yade/core/InteractionSolver.hpp&gt;
 
-class PhysicalAction;
-
 class FEMLaw : public InteractionSolver
 {
 /// Attributes
-	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
 	public :
 		int	 nodeGroupMask
 			,tetrahedronGroupMask;
@@ -30,7 +26,6 @@
 /// Serializtion
 	protected :
 		virtual void registerAttributes();
-	NEEDS_BEX(&quot;Force&quot;);
 	REGISTER_CLASS_NAME(FEMLaw);
 	REGISTER_BASE_CLASS_NAME(InteractionSolver);
 

Modified: trunk/pkg/fem/PreProcessor/FEMBeam.cpp
===================================================================
--- trunk/pkg/fem/PreProcessor/FEMBeam.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/fem/PreProcessor/FEMBeam.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -26,7 +26,6 @@
 // engines
 #include&lt;yade/pkg-common/CundallNonViscousDamping.hpp&gt;
 #include&lt;yade/pkg-common/CundallNonViscousDamping.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
 #include&lt;yade/pkg-common/GravityEngines.hpp&gt;
 #include&lt;yade/pkg-common/TranslationEngine.hpp&gt;
@@ -47,7 +46,6 @@
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 
 #include &lt;boost/filesystem/convenience.hpp&gt;
@@ -173,9 +171,6 @@
 	shared_ptr&lt;PhysicalActionApplier&gt; applyActionDispatcher(new PhysicalActionApplier);
 	applyActionDispatcher-&gt;add(&quot;NewtonsForceLaw&quot;);
 	
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;); // FIXME - should be unnecessery, but BUG in PhysicalActionVectorVector
 	
 	rootBody-&gt;engines.clear();
 	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PhysicalActionContainerReseter));
@@ -190,7 +185,6 @@
 	rootBody-&gt;initializers.push_back(bodyPhysicalParametersDispatcher);
 	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 	rootBody-&gt;initializers.push_back(geometricalModelDispatcher);
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
 	
 	femSetTextLoaderFunctor-&gt;go(rootBody-&gt;physicalParameters,rootBody.get()); // load FEM from file.
 

Modified: trunk/pkg/fem/SConscript
===================================================================
--- trunk/pkg/fem/SConscript	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/fem/SConscript	2009-03-30 17:10:27 UTC (rev 1738)
@@ -93,7 +93,6 @@
 		LIBS=env['LIBS']+['yade-base',
 			
 			'FEMTetrahedronData',
-			'Force',
 			'ParticleParameters'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
 			'DataClass/PhysicalParameters',
@@ -116,7 +115,6 @@
 			'yade-serialization',
 			'yade-base',
 			
-			'PhysicalActionContainerInitializer',
 			'PhysicalActionContainerReseter',
 			'InteractionGeometryMetaEngine',
 			'InteractionPhysicsMetaEngine',

Modified: trunk/pkg/lattice/DataClass/PhysicalParameters/LatticeBeamParameters.hpp
===================================================================
--- trunk/pkg/lattice/DataClass/PhysicalParameters/LatticeBeamParameters.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/lattice/DataClass/PhysicalParameters/LatticeBeamParameters.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -40,7 +40,6 @@
 
 
 		// where does it belong, what is it?
-		// a PhysicalAction !
 		Real 			 count
 					,torsionAngle;
 		Quaternionr		 bendingRotation

Modified: trunk/pkg/lattice/Engine/StandAloneEngine/BeamRecorder.hpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/BeamRecorder.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/BeamRecorder.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -15,7 +15,6 @@
 #include &lt;list&gt;
 #include &lt;vector&gt;
 
-//class PhysicalAction;
 
 class BeamRecorder : public DataRecorder
 { // given a section plane it records all the beams that cross it: their deformation projected

Modified: trunk/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.hpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -14,7 +14,6 @@
 #include&lt;yade/core/BodyContainer.hpp&gt;
 #include &lt;list&gt;
 
-class PhysicalAction;
 
 
 class LatticeLaw : public InteractionSolver

Modified: trunk/pkg/lattice/Engine/StandAloneEngine/MovingSupport.hpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/MovingSupport.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/MovingSupport.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -15,7 +15,6 @@
 #include &lt;list&gt;
 #include &lt;vector&gt;
 
-//class PhysicalAction;
 
 class MovingSupport : public DataRecorder
 { // given a section plane it deletes all the beams that cross it, and remembers the nodes that they did connect.

Modified: trunk/pkg/lattice/Engine/StandAloneEngine/NodeRecorder.hpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/NodeRecorder.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/NodeRecorder.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -15,7 +15,6 @@
 #include &lt;list&gt;
 #include &lt;vector&gt;
 
-//class PhysicalAction;
 
 class NodeRecorder : public DataRecorder
 { // records average position of nodes in a given region

Modified: trunk/pkg/lattice/Engine/StandAloneEngine/StrainRecorder.hpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/StrainRecorder.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/StrainRecorder.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -13,12 +13,10 @@
 #include &lt;string&gt;
 #include &lt;fstream&gt;
 
-//class PhysicalAction;
 
 class StrainRecorder : public DataRecorder
 {
 	private :
-//		shared_ptr&lt;PhysicalAction&gt; actionForce;
 		std::ofstream ofile; 
 
 	public :

Modified: trunk/pkg/lattice/PreProcessor/LatticeExample.cpp
===================================================================
--- trunk/pkg/lattice/PreProcessor/LatticeExample.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/lattice/PreProcessor/LatticeExample.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -36,13 +36,11 @@
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 #include&lt;yade/pkg-common/DisplacementEngine.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
 
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 #include&lt;yade/pkg-common/Quadrilateral.hpp&gt;
 #include&lt;yade/pkg-common/ParticleParameters.hpp&gt;
 

Modified: trunk/pkg/lattice/SConscript
===================================================================
--- trunk/pkg/lattice/SConscript	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/lattice/SConscript	2009-03-30 17:10:27 UTC (rev 1738)
@@ -169,7 +169,6 @@
 			'BoundingVolumeMetaEngine',
 			'PhysicalActionApplier',
 			'PhysicalParametersMetaEngine',
-			'PhysicalActionContainerInitializer',
 			'ParticleParameters',
 			'AABB',
 			'Quadrilateral',

Modified: trunk/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw.cpp
===================================================================
--- trunk/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -13,12 +13,10 @@
 #include&lt;yade/core/MetaBody.hpp&gt;
 #include&lt;yade/pkg-common/Mesh2D.hpp&gt;
 #include&lt;yade/pkg-common/ParticleParameters.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
 #include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
 
 
-MassSpringLaw::MassSpringLaw () : InteractionSolver(), actionForce(new Force) , actionMomentum(new Momentum)
+MassSpringLaw::MassSpringLaw () : InteractionSolver()
 {
 }
 
@@ -68,13 +66,8 @@
 			Real e  = (l-l0)/l0;
 			Real relativeVelocity = dir.Dot((p1-&gt;velocity-p2-&gt;velocity));
 			Vector3r f3 = (e*physics-&gt;stiffness + relativeVelocity* ( 1.0 - physics-&gt;damping )  )*dir;
-			#ifdef BEX_CONTAINER
-				massSpring-&gt;bex.addForce(id1,-f3);
-				massSpring-&gt;bex.addForce(id2, f3);
-			#else
-				static_cast&lt;Force*&gt;   ( massSpring-&gt;physicalActions-&gt;find( id1 , actionForce-&gt;getClassIndex() ).get() )-&gt;force    -= f3;
-				static_cast&lt;Force*&gt;   ( massSpring-&gt;physicalActions-&gt;find( id2 , actionForce-&gt;getClassIndex() ).get() )-&gt;force    += f3;
-			#endif
+			massSpring-&gt;bex.addForce(id1,-f3);
+			massSpring-&gt;bex.addForce(id2, f3);
 		}
 	}
 	

Modified: trunk/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw.hpp
===================================================================
--- trunk/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -9,14 +9,9 @@
 #pragma once
 
 #include&lt;yade/core/InteractionSolver.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
 
 class MassSpringLaw : public InteractionSolver
 {
-	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;	
-		shared_ptr&lt;PhysicalAction&gt; actionMomentum;
-
 	public :
 		int springGroupMask;
 		MassSpringLaw ();
@@ -24,7 +19,6 @@
 
 	protected :
 		void registerAttributes();
-	NEEDS_BEX(&quot;Force&quot;,&quot;Momentum&quot;);
 	REGISTER_CLASS_NAME(MassSpringLaw);
 	REGISTER_BASE_CLASS_NAME(InteractionSolver);
 };

Modified: trunk/pkg/mass-spring/PreProcessor/HangingCloth.cpp
===================================================================
--- trunk/pkg/mass-spring/PreProcessor/HangingCloth.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/mass-spring/PreProcessor/HangingCloth.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -52,14 +52,12 @@
 //#include&lt;yade/pkg-common/MassSpringBody2RigidBodyLaw.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 #include&lt;yade/pkg-common/GravityEngines.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 
 HangingCloth::HangingCloth () : FileGenerator()
@@ -150,9 +148,6 @@
 	rootBody-&gt;transientInteractions		= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
 	rootBody-&gt;bodies 			= shared_ptr&lt;BodyContainer&gt;(new BodyRedirectionVector);
 
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
 	
 	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
 	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
@@ -216,7 +211,6 @@
 	rootBody-&gt;engines.push_back(orientationIntegrator);
 
 	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
 	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 	rootBody-&gt;initializers.push_back(geometricalModelDispatcher);
 	

Modified: trunk/pkg/mass-spring/SConscript
===================================================================
--- trunk/pkg/mass-spring/SConscript	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/mass-spring/SConscript	2009-03-30 17:10:27 UTC (rev 1738)
@@ -29,8 +29,6 @@
 			'ParticleParameters',
 			'yade-serialization',
 			'yade-multimethods',
-			'Force',
-			'Momentum',
 			'Mesh2D'],
 		CPPPATH=env['CPPPATH']+['DataClass/InteractionPhysics',
 			'DataClass/InteractionGeometry']),
@@ -49,7 +47,6 @@
 			'MacroMicroElasticRelationships',
 			'yade-serialization',
 			'yade-base',
-			'PhysicalActionContainerInitializer',
 			'PhysicalActionContainerReseter',
 			'GravityEngines',
 			'InteractionGeometryMetaEngine',

Modified: trunk/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw.cpp
===================================================================
--- trunk/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -16,14 +16,12 @@
 #include&lt;yade/pkg-common/ClosestFeatures.hpp&gt;
 #include&lt;yade/core/Omega.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
 
 #include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
 
 
 
-FrictionLessElasticContactLaw::FrictionLessElasticContactLaw () : InteractionSolver(), actionForce(new Force) , actionMomentum(new Momentum)
+FrictionLessElasticContactLaw::FrictionLessElasticContactLaw () : InteractionSolver()
 {
 }
 
@@ -77,17 +75,10 @@
 				Vector3r v2 = rb2-&gt;velocity+rb2-&gt;angularVelocity.Cross(o2p);
 				Real relativeVelocity = dir.Dot(v2-v1);
 				Vector3r f = (elongation*stiffness+relativeVelocity*viscosity)/size*dir;
-				#ifdef BEX_CONTAINER
-					ncb-&gt;bex.addForce (id1, f);
-					ncb-&gt;bex.addForce (id2,-f);
-					ncb-&gt;bex.addTorque(id1, o1p.Cross(f));
-					ncb-&gt;bex.addTorque(id2,-o2p.Cross(f));
-				#else
-					static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id1 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    += f;
-					static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id2 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    -= f;
-					static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id1 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum += o1p.Cross(f);
-					static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id2 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum -= o2p.Cross(f);
-				#endif
+				ncb-&gt;bex.addForce (id1, f);
+				ncb-&gt;bex.addForce (id2,-f);
+				ncb-&gt;bex.addTorque(id1, o1p.Cross(f));
+				ncb-&gt;bex.addTorque(id2,-o2p.Cross(f));
 
 			}
 		}

Modified: trunk/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw.hpp
===================================================================
--- trunk/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -10,21 +10,15 @@
 
 #include&lt;yade/core/InteractionSolver.hpp&gt;
 
-class PhysicalAction;
 
 class FrictionLessElasticContactLaw : public InteractionSolver
 {
-	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-		shared_ptr&lt;PhysicalAction&gt; actionMomentum;
-
 	public :
 		FrictionLessElasticContactLaw ();
 		void action(MetaBody*);
 
 	protected :
 		 void registerAttributes();
-	NEEDS_BEX(&quot;Force&quot;,&quot;Momentum&quot;);
 	REGISTER_CLASS_NAME(FrictionLessElasticContactLaw);
 	REGISTER_BASE_CLASS_NAME(InteractionSolver);
 

Modified: trunk/pkg/realtime-rigidbody/PreProcessor/BoxStack.cpp
===================================================================
--- trunk/pkg/realtime-rigidbody/PreProcessor/BoxStack.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/realtime-rigidbody/PreProcessor/BoxStack.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -35,13 +35,11 @@
 #include&lt;yade/pkg-common/MetaInteractingGeometry2AABB.hpp&gt;
 #include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
 
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 #include&lt;yade/pkg-common/GravityEngines.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 
 BoxStack::BoxStack () : FileGenerator()
@@ -243,9 +241,6 @@
 
 void BoxStack::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
 {
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
 	
 	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
 	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere2InteractingSphere4ClosestFeatures&quot;);
@@ -300,7 +295,6 @@
 //		rootBody-&gt;engines.push_back(kinematic);
 	
 	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
 	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 	
 }

Modified: trunk/pkg/realtime-rigidbody/PreProcessor/RotatingBox.cpp
===================================================================
--- trunk/pkg/realtime-rigidbody/PreProcessor/RotatingBox.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/realtime-rigidbody/PreProcessor/RotatingBox.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -25,7 +25,6 @@
 #include&lt;yade/pkg-common/CundallNonViscousDamping.hpp&gt;
 #include&lt;yade/pkg-common/CundallNonViscousDamping.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 
 #include&lt;yade/pkg-common/BoundingVolumeMetaEngine.hpp&gt;
 #include&lt;yade/pkg-common/MetaInteractingGeometry2AABB.hpp&gt;
@@ -35,7 +34,6 @@
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
 #include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
@@ -262,9 +260,6 @@
 
 void RotatingBox::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
 {
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
 	
 	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
 	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere2InteractingSphere4ClosestFeatures&quot;);
@@ -320,7 +315,6 @@
 		rootBody-&gt;engines.push_back(kinematic);
 		
 	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
 	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 }
 

Modified: trunk/pkg/realtime-rigidbody/SConscript
===================================================================
--- trunk/pkg/realtime-rigidbody/SConscript	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/realtime-rigidbody/SConscript	2009-03-30 17:10:27 UTC (rev 1738)
@@ -36,8 +36,6 @@
 		LIBS=env['LIBS']+['yade-base',
 			'yade-serialization',
 			'yade-multimethods',
-			'Momentum',
-			'Force',
 			'ClosestFeatures',
 			'RigidBodyParameters']),
 
@@ -52,7 +50,6 @@
 			'CundallNonViscousDamping',
 			'GravityEngines',
 			'yade-serialization',
-			'PhysicalActionContainerInitializer',
 			'PhysicalActionContainerReseter',
 			'InteractionGeometryMetaEngine',
 			'PhysicalActionApplier',
@@ -78,7 +75,6 @@
 			'CundallNonViscousDamping',
 			'MetaInteractingGeometry',
 			'yade-serialization',
-			'PhysicalActionContainerInitializer',
 			'PhysicalActionContainerReseter',
 			'GravityEngines',
 			'InteractionGeometryMetaEngine',

Modified: trunk/pkg/snow/Engine/ElawSnowLayersDeformation.cpp
===================================================================
--- trunk/pkg/snow/Engine/ElawSnowLayersDeformation.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/snow/Engine/ElawSnowLayersDeformation.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -13,14 +13,11 @@
 #include&lt;yade/pkg-dem/SDECLinkPhysics.hpp&gt;
 #include&lt;yade/core/Omega.hpp&gt;
 #include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
 #include&lt;yade/pkg-snow/BssSnowGrain.hpp&gt;
 #include&lt;yade/pkg-snow/BshSnowGrain.hpp&gt;
 
 
-ElawSnowLayersDeformation::ElawSnowLayersDeformation() : InteractionSolver() , actionForce(new Force) , actionMomentum(new Momentum)
+ElawSnowLayersDeformation::ElawSnowLayersDeformation() : InteractionSolver()
 {
 	sdecGroupMask=1;
 	creep_viscosity = 1000.0;

Modified: trunk/pkg/snow/Engine/ElawSnowLayersDeformation.hpp
===================================================================
--- trunk/pkg/snow/Engine/ElawSnowLayersDeformation.hpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/snow/Engine/ElawSnowLayersDeformation.hpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -13,15 +13,10 @@
 #include &lt;set&gt;
 #include &lt;boost/tuple/tuple.hpp&gt;
 
-class PhysicalAction;
 
 class ElawSnowLayersDeformation : public InteractionSolver
 {
 /// Attributes
-	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-		shared_ptr&lt;PhysicalAction&gt; actionMomentum;
-
 	public :
 		int sdecGroupMask;
 		Real creep_viscosity;
@@ -31,7 +26,6 @@
 
 	protected :
 		void registerAttributes();
-	NEEDS_BEX(&quot;Force&quot;,&quot;Momentum&quot;);
 	REGISTER_CLASS_NAME(ElawSnowLayersDeformation);
 	REGISTER_BASE_CLASS_NAME(InteractionSolver);
 };

Modified: trunk/pkg/snow/PreProcessor/SnowCreepTest.cpp
===================================================================
--- trunk/pkg/snow/PreProcessor/SnowCreepTest.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/snow/PreProcessor/SnowCreepTest.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -16,7 +16,6 @@
 #include&lt;yade/pkg-dem/CohesiveFrictionalRelationships.hpp&gt;
 #include&lt;yade/pkg-dem/CohesiveFrictionalBodyParameters.hpp&gt;
 #include&lt;yade/pkg-dem/SDECLinkPhysics.hpp&gt;
-#include&lt;yade/pkg-dem/GlobalStiffnessCounter.hpp&gt;
 #include&lt;yade/pkg-dem/GlobalStiffnessTimeStepper.hpp&gt;
 #include&lt;yade/pkg-dem/PositionOrientationRecorder.hpp&gt;
 
@@ -54,14 +53,12 @@
 #include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
 #include&lt;yade/pkg-common/InteractionHashMap.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 
 #include&lt;yade/extra/Shop.hpp&gt;
 
@@ -282,7 +279,6 @@
 		createBox(body,center,halfSize,wall_bottom_wire);
 	 	if(wall_bottom) {
 			rootBody-&gt;bodies-&gt;insert(body);
-			//(resultantforceEngine-&gt;subscribedBodies).push_back(body-&gt;getId());
 			triaxialcompressionEngine-&gt;wall_bottom_id = body-&gt;getId();
 			//triaxialStateRecorder-&gt;wall_bottom_id = body-&gt;getId();
 			forcerec-&gt;startId = body-&gt;getId();
@@ -578,11 +574,6 @@
 	velocityRecorder-&gt; outputFile 	= velocityRecordFile;
 	velocityRecorder-&gt; interval 	= recordIntervalIter;
 
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	//physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;StiffnessMatrix&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;GlobalStiffness&quot;);
 	
 	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
 	shared_ptr&lt;InteractionGeometryEngineUnit&gt; s1(new InteractingSphere2InteractingSphere4SpheresContactGeometry);
@@ -649,9 +640,6 @@
 	//stiffnesscounter-&gt;sdecGroupMask = 2;
 	//stiffnesscounter-&gt;interval = timeStepUpdateInterval;
 	
-	shared_ptr&lt;GlobalStiffnessCounter&gt; globalStiffnessCounter(new GlobalStiffnessCounter);
-	// globalStiffnessCounter-&gt;sdecGroupMask = 2;
-	globalStiffnessCounter-&gt;interval = timeStepUpdateInterval;
 	
 	// moving walls to regulate the stress applied + compress when the packing is dense an stable
 	//cerr &lt;&lt; &quot;triaxialcompressionEngine = shared_ptr&lt;TriaxialCompressionEngine&gt; (new TriaxialCompressionEngine);&quot; &lt;&lt; std::endl;
@@ -704,7 +692,6 @@
 	rootBody-&gt;engines.push_back(triaxialcompressionEngine);
 	//rootBody-&gt;engines.push_back(stiffnesscounter);
 	//rootBody-&gt;engines.push_back(stiffnessMatrixTimeStepper);
-	rootBody-&gt;engines.push_back(globalStiffnessCounter);
 	rootBody-&gt;engines.push_back(globalStiffnessTimeStepper);
 	rootBody-&gt;engines.push_back(triaxialStateRecorder);
 //	rootBody-&gt;engines.push_back(hydraulicForceEngine);//&lt;-------------HYDRAULIC ENGINE HERE
@@ -713,7 +700,6 @@
 	rootBody-&gt;engines.push_back(positionIntegrator);
 	if(!rotationBlocked)
 		rootBody-&gt;engines.push_back(orientationIntegrator);
-	//rootBody-&gt;engines.push_back(resultantforceEngine);
 	//rootBody-&gt;engines.push_back(triaxialstressController);
 	
 		
@@ -727,7 +713,6 @@
 	rootBody-&gt;engines.push_back(positionOrientationRecorder);}
 	
 	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
 	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 	
 }

Modified: trunk/pkg/snow/PreProcessor/SnowVoxelsLoader.cpp
===================================================================
--- trunk/pkg/snow/PreProcessor/SnowVoxelsLoader.cpp	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/snow/PreProcessor/SnowVoxelsLoader.cpp	2009-03-30 17:10:27 UTC (rev 1738)
@@ -9,7 +9,6 @@
 #include&lt;yade/pkg-dem/CohesiveFrictionalRelationships.hpp&gt;
 #include&lt;yade/pkg-dem/CohesiveFrictionalBodyParameters.hpp&gt;
 #include&lt;yade/pkg-dem/SDECLinkPhysics.hpp&gt;
-#include&lt;yade/pkg-dem/GlobalStiffnessCounter.hpp&gt;
 #include&lt;yade/pkg-dem/GlobalStiffnessTimeStepper.hpp&gt;
 #include&lt;yade/pkg-dem/PositionOrientationRecorder.hpp&gt;
 
@@ -47,14 +46,12 @@
 #include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
 
 #include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
 
 #include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
 #include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
 #include&lt;yade/pkg-common/InteractionHashMap.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
 #include&lt;yade/pkg-snow/ElawSnowLayersDeformation.hpp&gt;
 
 #include&lt;yade/extra/Shop.hpp&gt;
@@ -396,11 +393,6 @@
 
 void SnowVoxelsLoader::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
 {
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;GlobalStiffness&quot;);
-	
 	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
 
 	shared_ptr&lt;InteractionGeometryEngineUnit&gt; s1(new Ef2_BssSnowGrain_BssSnowGrain_makeIstSnowLayersContact);
@@ -461,9 +453,6 @@
 	cohesiveFrictionalContactLaw-&gt;twist_creep = use_grain_twist_creep;
 	cohesiveFrictionalContactLaw-&gt;creep_viscosity = creep_viscosity;
 		
-	shared_ptr&lt;GlobalStiffnessCounter&gt; globalStiffnessCounter(new GlobalStiffnessCounter);
-	// globalStiffnessCounter-&gt;sdecGroupMask = 2;
-	globalStiffnessCounter-&gt;interval = timeStepUpdateInterval;
 	
 	// moving walls to regulate the stress applied + compress when the packing is dense an stable
 	//cerr &lt;&lt; &quot;triaxialcompressionEngine = shared_ptr&lt;TriaxialCompressionEngine&gt; (new TriaxialCompressionEngine);&quot; &lt;&lt; std::endl;
@@ -522,7 +511,6 @@
 	rootBody-&gt;engines.push_back(triaxialcompressionEngine);
 	//rootBody-&gt;engines.push_back(stiffnesscounter);
 	//rootBody-&gt;engines.push_back(stiffnessMatrixTimeStepper);
-	rootBody-&gt;engines.push_back(globalStiffnessCounter);
 	rootBody-&gt;engines.push_back(globalStiffnessTimeStepper);
 	rootBody-&gt;engines.push_back(triaxialStateRecorder);
 	if(use_gravity_engine)
@@ -534,7 +522,6 @@
 	rootBody-&gt;engines.push_back(positionIntegrator);
 	//if(!rotationBlocked)
 		rootBody-&gt;engines.push_back(orientationIntegrator);
-	//rootBody-&gt;engines.push_back(resultantforceEngine);
 	//rootBody-&gt;engines.push_back(triaxialstressController);
 	
 		
@@ -548,7 +535,6 @@
 	//rootBody-&gt;engines.push_back(positionOrientationRecorder);}
 	
 	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
 	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
 	
 }

Modified: trunk/pkg/snow/SConscript
===================================================================
--- trunk/pkg/snow/SConscript	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/pkg/snow/SConscript	2009-03-30 17:10:27 UTC (rev 1738)
@@ -59,8 +59,6 @@
 			'BssSnowGrain',
 			'BshSnowGrain',
 			'yade-multimethods',
-			'Force',
-			'Momentum',
 			'Sphere',
 			'RigidBodyParameters']),
 
@@ -95,7 +93,6 @@
 			'MetaInteractingGeometry',
 			'GravityEngines',
 			'yade-serialization',
-			'PhysicalActionContainerInitializer',
 			'PhysicalActionContainerReseter',
 			'InteractionGeometryMetaEngine',
 			'InteractionPhysicsMetaEngine',
@@ -108,9 +105,6 @@
 			'AABB',
 			'DistantPersistentSAPCollider',
 			'MetaInteractingGeometry2AABB',
-			'GlobalStiffness',
-			'GlobalStiffnessCounter',
-			'ResultantForceEngine',
 			'TriaxialStressController',
 			'TriaxialCompressionEngine',
 			'GlobalStiffnessTimeStepper',
@@ -138,7 +132,6 @@
 			'MetaInteractingGeometry',
 			'GravityEngines',
 			'yade-serialization',
-			'PhysicalActionContainerInitializer',
 			'PhysicalActionContainerReseter',
 			'InteractionGeometryMetaEngine',
 			'InteractionPhysicsMetaEngine',
@@ -152,9 +145,6 @@
 			'AABB',
 			'DistantPersistentSAPCollider',
 			'MetaInteractingGeometry2AABB',
-			'GlobalStiffness',
-			'GlobalStiffnessCounter',
-			'ResultantForceEngine',
 			'TriaxialStressController',
 			'TriaxialCompressionEngine',
 			'GlobalStiffnessTimeStepper',

Modified: trunk/scripts/chain-distant-interactions.py
===================================================================
--- trunk/scripts/chain-distant-interactions.py	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/scripts/chain-distant-interactions.py	2009-03-30 17:10:27 UTC (rev 1738)
@@ -3,7 +3,6 @@
 
 o=Omega()
 o.initializers=[
-	StandAloneEngine('PhysicalActionContainerInitializer'),
 	MetaEngine('BoundingVolumeMetaEngine',[EngineUnit('InteractingSphere2AABB'),EngineUnit('InteractingBox2AABB'),EngineUnit('MetaInteractingGeometry2AABB')])
 	]
 o.engines=[

Modified: trunk/scripts/constitutive-law.py
===================================================================
--- trunk/scripts/constitutive-law.py	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/scripts/constitutive-law.py	2009-03-30 17:10:27 UTC (rev 1738)
@@ -2,7 +2,6 @@
 # -*- encoding=utf-8 -*-
 
 O.initializers=[
-	StandAloneEngine('PhysicalActionContainerInitializer'),
 	MetaEngine('BoundingVolumeMetaEngine',[EngineUnit('InteractingSphere2AABB'),EngineUnit('InteractingBox2AABB'),EngineUnit('MetaInteractingGeometry2AABB')])
 	]
 O.engines=[

Modified: trunk/scripts/cylindrical-layer-packing.py
===================================================================
--- trunk/scripts/cylindrical-layer-packing.py	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/scripts/cylindrical-layer-packing.py	2009-03-30 17:10:27 UTC (rev 1738)
@@ -8,9 +8,7 @@
 # we will use this in both initializers and engines, so we save it to a temp variable to save typing
 aabbDispatcher=MetaEngine('BoundingVolumeMetaEngine',[EngineUnit('InteractingSphere2AABB'),EngineUnit('InteractingBox2AABB'),EngineUnit('MetaInteractingGeometry2AABB')])
 
-o.initializers=[
-	StandAloneEngine('PhysicalActionContainerInitializer',{'physicalActionNames':['Force','Momentum','GlobalStiffness']}),
-	aabbDispatcher]
+o.initializers=[aabbDispatcher]
 
 o.engines=[
 	StandAloneEngine('PhysicalActionContainerReseter'),

Modified: trunk/scripts/exact-rot-facet.py
===================================================================
--- trunk/scripts/exact-rot-facet.py	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/scripts/exact-rot-facet.py	2009-03-30 17:10:27 UTC (rev 1738)
@@ -7,7 +7,6 @@
 from math import *
 o=Omega()
 o.initializers=[
-	StandAloneEngine('PhysicalActionContainerInitializer'),
 	MetaEngine('BoundingVolumeMetaEngine',[EngineUnit('InteractingSphere2AABB'),EngineUnit('InteractingBox2AABB'),EngineUnit('MetaInteractingGeometry2AABB')])
 	]
 o.engines=[

Modified: trunk/scripts/exact-rot.py
===================================================================
--- trunk/scripts/exact-rot.py	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/scripts/exact-rot.py	2009-03-30 17:10:27 UTC (rev 1738)
@@ -3,7 +3,6 @@
 from math import *
 o=Omega()
 o.initializers=[
-	StandAloneEngine('PhysicalActionContainerInitializer'),
 	MetaEngine('BoundingVolumeMetaEngine',[EngineUnit('InteractingSphere2AABB'),EngineUnit('InteractingBox2AABB'),EngineUnit('MetaInteractingGeometry2AABB')])
 	]
 o.engines=[

Modified: trunk/scripts/multi.py
===================================================================
--- trunk/scripts/multi.py	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/scripts/multi.py	2009-03-30 17:10:27 UTC (rev 1738)
@@ -8,7 +8,6 @@
 
 o=Omega()
 o.initializers=[
-	StandAloneEngine('PhysicalActionContainerInitializer'),
 	MetaEngine('BoundingVolumeMetaEngine',[EngineUnit('InteractingSphere2AABB'),EngineUnit('InteractingFacet2AABB'),EngineUnit('MetaInteractingGeometry2AABB')])
 	]
 o.engines=[

Modified: trunk/scripts/simple-scene-graph.py
===================================================================
--- trunk/scripts/simple-scene-graph.py	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/scripts/simple-scene-graph.py	2009-03-30 17:10:27 UTC (rev 1738)
@@ -3,7 +3,6 @@
 
 o=Omega()
 o.initializers=[
-	StandAloneEngine('PhysicalActionContainerInitializer'),
 	MetaEngine('BoundingVolumeMetaEngine',[EngineUnit('InteractingSphere2AABB'),EngineUnit('InteractingBox2AABB'),EngineUnit('MetaInteractingGeometry2AABB')])
 	]
 o.engines=[

Modified: trunk/scripts/simple-scene-parallel.py
===================================================================
--- trunk/scripts/simple-scene-parallel.py	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/scripts/simple-scene-parallel.py	2009-03-30 17:10:27 UTC (rev 1738)
@@ -3,7 +3,6 @@
 o=Omega()
 
 o.initializers=[
-	StandAloneEngine('PhysicalActionContainerInitializer'),
 	MetaEngine('BoundingVolumeMetaEngine',[EngineUnit('InteractingSphere2AABB'),EngineUnit('InteractingBox2AABB'),EngineUnit('MetaInteractingGeometry2AABB')])
 	]
 o.engines=[

Modified: trunk/scripts/simple-scene-player.py
===================================================================
--- trunk/scripts/simple-scene-player.py	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/scripts/simple-scene-player.py	2009-03-30 17:10:27 UTC (rev 1738)
@@ -3,7 +3,6 @@
 
 o=Omega()
 o.initializers=[
-	StandAloneEngine('PhysicalActionContainerInitializer'),
 	MetaEngine('BoundingVolumeMetaEngine',[EngineUnit('InteractingSphere2AABB'),EngineUnit('InteractingBox2AABB'),EngineUnit('MetaInteractingGeometry2AABB')])
 	]
 o.engines=[

Modified: trunk/scripts/simple-scene-video.py
===================================================================
--- trunk/scripts/simple-scene-video.py	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/scripts/simple-scene-video.py	2009-03-30 17:10:27 UTC (rev 1738)
@@ -3,7 +3,6 @@
 
 o=Omega()
 o.initializers=[
-	StandAloneEngine('PhysicalActionContainerInitializer'),
 	MetaEngine('BoundingVolumeMetaEngine',[EngineUnit('InteractingSphere2AABB'),EngineUnit('InteractingBox2AABB'),EngineUnit('MetaInteractingGeometry2AABB')])
 	]
 o.engines=[

Modified: trunk/scripts/simple-scene.py
===================================================================
--- trunk/scripts/simple-scene.py	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/scripts/simple-scene.py	2009-03-30 17:10:27 UTC (rev 1738)
@@ -9,8 +9,6 @@
 
 ## Initializers are run before the simulation.
 o.initializers=[
-	## Create and reset to zero container of all PhysicalActions that will be used
-	StandAloneEngine('PhysicalActionContainerInitializer'),
 	## Create bounding boxes. They are needed to zoom the 3d view properly before we start the simulation.
 	MetaEngine('BoundingVolumeMetaEngine',[EngineUnit('InteractingSphere2AABB'),EngineUnit('InteractingBox2AABB'),EngineUnit('MetaInteractingGeometry2AABB')])
 	]
@@ -57,21 +55,21 @@
 	## This MetaEngine acts on all PhysicalActions and selects the right EngineUnit base on type of the PhysicalAction.
 	#
 	# note that following 4 engines (till the end) can be replaced by an optimized monolithic version:
-	DeusExMachina('NewtonsDampedLaw',{'damping':0.0}),
+#	DeusExMachina('NewtonsDampedLaw',{'damping':0.0}),
 	#
-#	MetaEngine('PhysicalActionDamper',[
-#		EngineUnit('CundallNonViscousForceDamping',{'damping':0.2}),
-#		EngineUnit('CundallNonViscousMomentumDamping',{'damping':0.2})
-#	]),
+	MetaEngine('PhysicalActionDamper',[
+		EngineUnit('CundallNonViscousForceDamping',{'damping':0.2}),
+		EngineUnit('CundallNonViscousMomentumDamping',{'damping':0.2})
+	]),
 	## Now we have forces and momenta acting on bodies. Newton's law calculates acceleration that corresponds to them.
-#	MetaEngine('PhysicalActionApplier',[
-#		EngineUnit('NewtonsForceLaw'),
-#		EngineUnit('NewtonsMomentumLaw'),
-#	]),
+	MetaEngine('PhysicalActionApplier',[
+		EngineUnit('NewtonsForceLaw'),
+		EngineUnit('NewtonsMomentumLaw'),
+	]),
 	## Acceleration results in velocity change. Integrating the velocity over dt, position of the body will change.
-#	MetaEngine('PhysicalParametersMetaEngine',[EngineUnit('LeapFrogPositionIntegrator')]),
+	MetaEngine('PhysicalParametersMetaEngine',[EngineUnit('LeapFrogPositionIntegrator')]),
 	## Angular acceleration changes angular velocity, resulting in position and/or orientation change of the body.
-#	MetaEngine('PhysicalParametersMetaEngine',[EngineUnit('LeapFrogOrientationIntegrator')]),
+	MetaEngine('PhysicalParametersMetaEngine',[EngineUnit('LeapFrogOrientationIntegrator')]),
 ]
 
 

Modified: trunk/scripts/test-sphere-facet-corner.py
===================================================================
--- trunk/scripts/test-sphere-facet-corner.py	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/scripts/test-sphere-facet-corner.py	2009-03-30 17:10:27 UTC (rev 1738)
@@ -17,7 +17,6 @@
 
 ## Initializers 
 o.initializers=[
-	StandAloneEngine('PhysicalActionContainerInitializer'),
 	MetaEngine('BoundingVolumeMetaEngine',[EngineUnit('InteractingSphere2AABB'),EngineUnit('InteractingFacet2AABB'),EngineUnit('MetaInteractingGeometry2AABB')])
 	]
 

Modified: trunk/scripts/test-sphere-facet.py
===================================================================
--- trunk/scripts/test-sphere-facet.py	2009-03-29 20:43:38 UTC (rev 1737)
+++ trunk/scripts/test-sphere-facet.py	2009-03-30 17:10:27 UTC (rev 1738)
@@ -18,7 +18,6 @@
 #
 
 O.initializers=[
-	StandAloneEngine('PhysicalActionContainerInitializer'),
 	MetaEngine('BoundingVolumeMetaEngine',[EngineUnit('InteractingSphere2AABB'),EngineUnit('InteractingBox2AABB'),EngineUnit('MetaInteractingGeometry2AABB')])
 	]
 O.engines=[


_______________________________________________
Mailing list: <A HREF="https://launchpad.net/~yade-dev">https://launchpad.net/~yade-dev</A>
Post to     : <A HREF="https://lists.berlios.de/mailman/listinfo/yade-dev">yade-dev at lists.launchpad.net</A>
Unsubscribe : <A HREF="https://launchpad.net/~yade-dev">https://launchpad.net/~yade-dev</A>
More help   : <A HREF="https://help.launchpad.net/ListHelp">https://help.launchpad.net/ListHelp</A>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000899.html">[deprecated list] [Yade-dev] [svn] r1737 -	trunk/pkg/dem/Engine/StandAloneEngine
</A></li>
	<LI>Next message: <A HREF="000900.html">[deprecated list] [Yade-dev] [svn] r1739 - in trunk: extra	extra/clump gui/py	pkg/common/Engine/DeusExMachina	pkg/dem/Engine/StandAloneEngine
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#918">[ date ]</a>
              <a href="thread.html#918">[ thread ]</a>
              <a href="subject.html#918">[ subject ]</a>
              <a href="author.html#918">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/yade-dev">More information about the yade-dev
mailing list</a><br>
</body></html>
